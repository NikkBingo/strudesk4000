var uh=Object.defineProperty;var ph=(e,t,n)=>t in e?uh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var nn=(e,t,n)=>ph(e,typeof t!="symbol"?t+"":t,n);typeof BigInt>"u"&&(BigInt=function(e){if(isNaN(e))throw new Error("");return e});const G=BigInt(0),z=BigInt(1),_=BigInt(2),Ne=BigInt(3),ve=BigInt(5),O=BigInt(10);BigInt(Number.MAX_SAFE_INTEGER);const dh=2e3,b={s:z,n:G,d:z};function oe(e,t){try{e=BigInt(e)}catch{throw le()}return e*t}function ne(e){return typeof e=="bigint"?e:Math.floor(e)}function W(e,t){if(t===G)throw wt();const n=Object.create(R.prototype);n.s=e<G?-z:z,e=e<G?-e:e;const s=ge(e,t);return n.n=e/s,n.d=t/s,n}const hh=[_*_,_,_*_,_,_*_,_*Ne,_,_*Ne];function Ge(e){const t=Object.create(null);if(e<=z)return t[e]=z,t;const n=s=>{t[s]=(t[s]||G)+z};for(;e%_===G;)n(_),e/=_;for(;e%Ne===G;)n(Ne),e/=Ne;for(;e%ve===G;)n(ve),e/=ve;for(let s=0,i=_+ve;i*i<=e;){for(;e%i===G;)n(i),e/=i;i+=hh[s],s=s+1&7}return e>z&&n(e),t}const P=function(e,t){let n=G,s=z,i=z;if(e!=null)if(t!==void 0){if(typeof e=="bigint")n=e;else{if(isNaN(e))throw le();if(e%1!==0)throw sn();n=BigInt(e)}if(typeof t=="bigint")s=t;else{if(isNaN(t))throw le();if(t%1!==0)throw sn();s=BigInt(t)}i=n*s}else if(typeof e=="object"){if("d"in e&&"n"in e)n=BigInt(e.n),s=BigInt(e.d),"s"in e&&(n*=BigInt(e.s));else if(0 in e)n=BigInt(e[0]),1 in e&&(s=BigInt(e[1]));else if(typeof e=="bigint")n=e;else throw le();i=n*s}else if(typeof e=="number"){if(isNaN(e))throw le();if(e<0&&(i=-z,e=-e),e%1===0)n=BigInt(e);else{let a=1,o=0,l=1,c=1,u=1,d=1e7;for(e>=1&&(a=10**Math.floor(1+Math.log10(e)),e/=a);l<=d&&u<=d;){let h=(o+c)/(l+u);if(e===h){l+u<=d?(n=o+c,s=l+u):u>l?(n=c,s=u):(n=o,s=l);break}else e>h?(o+=c,l+=u):(c+=o,u+=l),l>d?(n=c,s=u):(n=o,s=l)}n=BigInt(n)*BigInt(a),s=BigInt(s)}}else if(typeof e=="string"){let a=0,o=G,l=G,c=G,u=z,d=z,h=e.replace(/_/g,"").match(/\d+|./g);if(h===null)throw le();if(h[a]==="-"?(i=-z,a++):h[a]==="+"&&a++,h.length===a+1?l=oe(h[a++],i):h[a+1]==="."||h[a]==="."?(h[a]!=="."&&(o=oe(h[a++],i)),a++,(a+1===h.length||h[a+1]==="("&&h[a+3]===")"||h[a+1]==="'"&&h[a+3]==="'")&&(l=oe(h[a],i),u=O**BigInt(h[a].length),a++),(h[a]==="("&&h[a+2]===")"||h[a]==="'"&&h[a+2]==="'")&&(c=oe(h[a+1],i),d=O**BigInt(h[a+1].length)-z,a+=3)):h[a+1]==="/"||h[a+1]===":"?(l=oe(h[a],i),u=oe(h[a+2],z),a+=3):h[a+3]==="/"&&h[a+1]===" "&&(o=oe(h[a],i),l=oe(h[a+2],i),u=oe(h[a+4],z),a+=5),h.length<=a)s=u*d,i=n=c+s*o+d*l;else throw le()}else if(typeof e=="bigint")n=e,i=e,s=z;else throw le();if(s===G)throw wt();b.s=i<G?-z:z,b.n=n<G?-n:n,b.d=s<G?-s:s};function mh(e,t,n){let s=z;for(;t>G;e=e*e%n,t>>=z)t&z&&(s=s*e%n);return s}function fh(e,t){for(;t%_===G;t/=_);for(;t%ve===G;t/=ve);if(t===z)return G;let n=O%t,s=1;for(;n!==z;s++)if(n=n*O%t,s>dh)return G;return BigInt(s)}function yh(e,t,n){let s=z,i=mh(O,n,t);for(let a=0;a<300;a++){if(s===i)return BigInt(a);s=s*O%t,i=i*O%t}return 0}function ge(e,t){if(!e)return t;if(!t)return e;for(;;){if(e%=t,!e)return t;if(t%=e,!t)return e}}function R(e,t){if(P(e,t),this instanceof R)e=ge(b.d,b.n),this.s=b.s,this.n=b.n/e,this.d=b.d/e;else return W(b.s*b.n,b.d)}const wt=function(){return new Error("Division by Zero")},le=function(){return new Error("Invalid argument")},sn=function(){return new Error("Parameters must be integer")};R.prototype={s:z,n:G,d:z,abs:function(){return W(this.n,this.d)},neg:function(){return W(-this.s*this.n,this.d)},add:function(e,t){return P(e,t),W(this.s*this.n*b.d+b.s*this.d*b.n,this.d*b.d)},sub:function(e,t){return P(e,t),W(this.s*this.n*b.d-b.s*this.d*b.n,this.d*b.d)},mul:function(e,t){return P(e,t),W(this.s*b.s*this.n*b.n,this.d*b.d)},div:function(e,t){return P(e,t),W(this.s*b.s*this.n*b.d,this.d*b.n)},clone:function(){return W(this.s*this.n,this.d)},mod:function(e,t){if(e===void 0)return W(this.s*this.n%this.d,z);if(P(e,t),G===b.n*this.d)throw wt();return W(this.s*(b.d*this.n)%(b.n*this.d),b.d*this.d)},gcd:function(e,t){return P(e,t),W(ge(b.n,this.n)*ge(b.d,this.d),b.d*this.d)},lcm:function(e,t){return P(e,t),b.n===G&&this.n===G?W(G,z):W(b.n*this.n,ge(b.n,this.n)*ge(b.d,this.d))},inverse:function(){return W(this.s*this.d,this.n)},pow:function(e,t){if(P(e,t),b.d===z)return b.s<G?W((this.s*this.d)**b.n,this.n**b.n):W((this.s*this.n)**b.n,this.d**b.n);if(this.s<G)return null;let n=Ge(this.n),s=Ge(this.d),i=z,a=z;for(let o in n)if(o!=="1"){if(o==="0"){i=G;break}if(n[o]*=b.n,n[o]%b.d===G)n[o]/=b.d;else return null;i*=BigInt(o)**n[o]}for(let o in s)if(o!=="1"){if(s[o]*=b.n,s[o]%b.d===G)s[o]/=b.d;else return null;a*=BigInt(o)**s[o]}return b.s<G?W(a,i):W(i,a)},log:function(e,t){if(P(e,t),this.s<=G||b.s<=G)return null;const n=Object.create(null),s=Ge(b.n),i=Ge(b.d),a=Ge(this.n),o=Ge(this.d);for(const u in i)s[u]=(s[u]||G)-i[u];for(const u in o)a[u]=(a[u]||G)-o[u];for(const u in s)u!=="1"&&(n[u]=!0);for(const u in a)u!=="1"&&(n[u]=!0);let l=null,c=null;for(const u in n){const d=s[u]||G,h=a[u]||G;if(d===G){if(h!==G)return null;continue}let x=h,Z=d;const v=ge(x,Z);if(x/=v,Z/=v,l===null&&c===null)l=x,c=Z;else if(x*c!==l*Z)return null}return l!==null&&c!==null?W(l,c):null},equals:function(e,t){return P(e,t),this.s*this.n*b.d===b.s*b.n*this.d},lt:function(e,t){return P(e,t),this.s*this.n*b.d<b.s*b.n*this.d},lte:function(e,t){return P(e,t),this.s*this.n*b.d<=b.s*b.n*this.d},gt:function(e,t){return P(e,t),this.s*this.n*b.d>b.s*b.n*this.d},gte:function(e,t){return P(e,t),this.s*this.n*b.d>=b.s*b.n*this.d},compare:function(e,t){P(e,t);let n=this.s*this.n*b.d-b.s*b.n*this.d;return(G<n)-(n<G)},ceil:function(e){return e=O**BigInt(e||0),W(ne(this.s*e*this.n/this.d)+(e*this.n%this.d>G&&this.s>=G?z:G),e)},floor:function(e){return e=O**BigInt(e||0),W(ne(this.s*e*this.n/this.d)-(e*this.n%this.d>G&&this.s<G?z:G),e)},round:function(e){return e=O**BigInt(e||0),W(ne(this.s*e*this.n/this.d)+this.s*((this.s>=G?z:G)+_*(e*this.n%this.d)>this.d?z:G),e)},roundTo:function(e,t){P(e,t);const n=this.n*b.d,s=this.d*b.n,i=n%s;let a=ne(n/s);return i+i>=s&&a++,W(this.s*a*b.n,b.d)},divisible:function(e,t){return P(e,t),b.n===G?!1:this.n*b.d%(b.n*this.d)===G},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(e=15){let t=this.n,n=this.d,s=fh(t,n),i=yh(t,n,s),a=this.s<G?"-":"";if(a+=ne(t/n),t%=n,t*=O,t&&(a+="."),s){for(let o=i;o--;)a+=ne(t/n),t%=n,t*=O;a+="(";for(let o=s;o--;)a+=ne(t/n),t%=n,t*=O;a+=")"}else for(let o=e;t&&o--;)a+=ne(t/n),t%=n,t*=O;return a},toFraction:function(e=!1){let t=this.n,n=this.d,s=this.s<G?"-":"";if(n===z)s+=t;else{const i=ne(t/n);e&&i>G&&(s+=i,s+=" ",t%=n),s+=t,s+="/",s+=n}return s},toLatex:function(e=!1){let t=this.n,n=this.d,s=this.s<G?"-":"";if(n===z)s+=t;else{const i=ne(t/n);e&&i>G&&(s+=i,t%=n),s+="\\frac{",s+=t,s+="}{",s+=n,s+="}"}return s},toContinued:function(){let e=this.n,t=this.d;const n=[];for(;t;){n.push(ne(e/t));const s=e%t;e=t,t=s}return n},simplify:function(e=.001){const t=BigInt(Math.ceil(1/e)),n=this.abs(),s=n.toContinued();for(let i=1;i<s.length;i++){let a=W(s[i-1],z);for(let l=i-2;l>=0;l--)a=a.inverse().add(s[l]);let o=a.sub(n);if(o.n*t<o.d)return a.mul(this.s)}return this}};function rt(e,t){if(t||(t="assertion failed"),!e)throw new Error(t)}let M=class{constructor(t,n){this.type=t,n!==void 0&&(this.value=n),this.ins=[]}static parseInput(t,n){if(typeof t=="function"){if(!n)throw new Error("tried to parse function input without without passing node..");return t(n)}return typeof t=="object"?t:typeof t=="number"&&!isNaN(t)||typeof t=="string"?te(t):(console.log(`invalid input type "${typeof t}" for node of type "${n.type}", falling back to 0. The input was:`,t),0)}};const Ze=(e,t)=>new M(e,t);let J=new Map;const ue="poly",ct="exit";M.prototype.inherit=function(e){return e.inputOf&&(this.inputOf=e.inputOf),e.outputOf&&(this.outputOf=e.outputOf),this};M.prototype.toObject=function(){return JSON.parse(JSON.stringify(this))};M.prototype.stringify=function(){return JSON.stringify(this,null,2).replaceAll('"',"'")};function mn(e,...t){let n=1;if(t=t.map(i=>{if(Array.isArray(i)){if(i.length===1)return i[0];i=new M(ue).withIns(...i)}if(typeof i=="function"){const a=i(new M("peek"));a.type===ue&&(n=Math.max(a.ins.length,n))}return i.type===ue&&(n=Math.max(i.ins.length,n)),i}),n===1){const i=Ze(e);return i.withIns(...t.map(a=>M.parseInput(a,i)))}if(e===ct){const i=t.map(a=>a.type===ue?a.ins.map(o=>M.parseInput(o).inherit(o)):a).flat();return Ze(ct).withIns(...i)}const s=Array.from({length:n},(i,a)=>{const o=new M(e),l=t.map(c=>c.type===ue?M.parseInput(c.ins[a%c.ins.length],o).inherit(c):(c=M.parseInput(c,o),c.type===ue&&(c=c.ins[a]),c));return o.withIns(...l)});return new M(ue).withIns(...s)}function gh(e,t){var s;const n=J.get(e);return(s=n==null?void 0:n.ins)!=null&&s[t]?n.ins[t].name:""}let w=(e,t)=>U(e,(...n)=>mn(e,...n),t);J.set("register",{tags:["meta"],graph:!1,description:"Registers a new Node function. Sets it on the prototype + returns the function itself. Like `module` but doesn't hide complexity in graph viz.",examples:[`let kick = register('kick', gate => gate.adsr(0,.11,0,.11)
.apply(env => env.mul(env)
  .mul(158)
  .sine(env)
  .distort(.85)
))
impulse(2).kick().out()`]});let U=(e,t,n)=>(n&&J.set(e,n),M.prototype[e]=function(...s){return t(this,...s)},M.prototype["_"+e]=function(){return this},t);J.set("module",{tags:["meta"],graph:!0,description:"Creates a module. Like `register`, but the graph viz will hide the internal complexity of the module.",examples:[`let kick = module('kick', gate => gate.adsr(0,.11,0,.11)
.apply(env => env.mul(env)
  .mul(158)
  .sine(env)
  .distort(.85)
))
impulse(2).kick().out()`]});let bh=0;function ee(e,t,n){return U(e,(...s)=>{var a,o;const i=bh++;return s=s.map((l,c)=>{var u,d;return(d=(u=M.parseInput(l)).asModuleInput)==null?void 0:d.call(u,e,i,c)}),(o=(a=t(...s)).asModuleOutput)==null?void 0:o.call(a,e,i)},n)}J.set("n",{tags:["math"],description:"Constant value node. Turns a number into a Node.",ins:[{name:"value",default:0}]});function te(e){return Array.isArray(e)?poly(...e.map(t=>te(t))):typeof e=="object"?e:Ze("n",e)}J.set("out",{tags:["meta"],description:"Sends the node to the audio output"});J.set("withIns",{internal:!0,tags:["innards"],description:"Sets the inputs of a node. Returns the node itself",ins:[{name:"in",dynamic:!0}]});M.prototype.withIns=function(...e){return this.ins=e,this};J.set("flatten",{internal:!0,tags:["innards"],description:"Flattens the node to a list of all nodes in the graph, where each Node's ins are now indices"});M.prototype.flatten=function(){return Gh(this)};J.set("apply",{graph:!0,tags:["meta"],description:"Applies the given function to the Node. Useful when a node has to be used multiple times.",examples:[`impulse(4)
.apply(imp=>imp
  .seq(110,220,330,440)
  .sine()
  .mul( imp.ad(.1,.1) )
).out()`]});M.prototype.apply=function(e){return e(this)};J.set("clone",{internal:!0,tags:["innards"],description:"Clones the node"});M.prototype.clone=function(){return new M(this.type,this.value).withIns(...this.ins)};J.set("map",{tags:["meta"],description:"Applies the given function to all ins if it's poly node. Otherwise it applies the function to itself.",examples:[`n([110,220,330])
.map( freq=>freq.mul([1,1.007]).saw().mix() )
.mix(2).mul(.5).out()`]});M.prototype.map=function(e){return this.type!=="poly"?e(this):poly(...this.ins.map(e))};M.prototype.channel=function(e){return this.type!=="poly"?this:this.ins[e%this.ins.length]};J.set("select",{tags:["meta"],graph:!0,description:"Find the first occurence of the given type up in the graph and returns the match. Useful to exit a feedback loop at another point.",examples:[`sine(220).mul(impulse(1).ad(.001,.2))
.add( x=>x.delay(.2).mul(.8) )
.select('delay').out()
`]});M.prototype.select=function(e){for(let t of this.ins){if(t.type===e)return t;const n=t.select(e);if(n)return n}};J.set("debug",{tags:["meta"],description:"Logs the node to the console"});M.prototype.debug=function(e=t=>t){return console.log(e(this)),this};function wh(e){const t=modules.get(e),n=Array.from({length:t.length},(i,a)=>Ze(`$INPUT${a}`)),s=t(...n);return JSON.stringify(s,null,2)}function Gh(e){const t=[];return Gt(e,n=>(t.push(n),n)),t.map(n=>{let s={...n,type:n.type,ins:n.ins.map(i=>t.indexOf(i)+"")};return n.value!==void 0&&(s.value=n.value),n.to!==void 0&&(s.to=t.indexOf(n.to)),s})}let fn=w("exit",{internal:!0});function yn(e,t){let n=[];const s=U("out",function(i,a=[0,1]){return n.push(i.output(a)),i});return t?(t.out=s,Function(...Object.keys(t),e)(...Object.values(t))):(globalThis.out=s,Function(e)()),fn(...n)}M.prototype.over=function(e){return this.apply(t=>add(t,e(t)))};M.prototype.dfs=function(e,t){return this.apply(n=>Gt(n,e,t))};M.prototype.apply2=function(e){return e(this,this)};let Gt=(e,t,n=[])=>(e=t(e,n),n.push(e),e.ins=e.ins.map(s=>n.includes(s)?s:Gt(s,t,n)),e);M.prototype.asModuleInput=function(e,t,n){return this.inputOf=this.inputOf||[],this.inputOf.push([e,t,n]),this};M.prototype.asModuleOutput=function(e,t){return this.outputOf=[e,t],this};function vt(e,t={}){const{log:n=!1,lang:s="js",fallbackType:i="thru",constType:a="n",getRegister:o=v=>`r[${v}]`,getOutput:l=v=>`o[${v}]`,getSource:c=v=>`s[${v}]`}=t;n&&console.log("compile",e);const u=vh(e);let d=[],h=v=>u[v].type!==a?o(v):typeof u[v].value=="string"?`"${u[v].value}"`:u[v].value;const x=[];for(let v in u){const T=u[v],C=u[v].ins.map(j=>h(u.indexOf(j))),Y=x.length;let I=J.get(T.type);I||(console.warn(`unhandled node type "${u[v].type}". falling back to "${i}"`),I=J.get(i));const me={vars:C,node:T,nodes:u,id:v,ugenIndex:Y,ugen:I.ugen,name:h(v),lang:s,getRegister:o,getOutput:l,getSource:c};I.compile&&d.push(I.compile(me)),I.ugen&&x.push({type:I.ugen,inputs:C})}const Z=d.join(`
`);return n&&(console.log("compiled code:"),console.log(Z)),{src:Z,ugens:x,registers:u.length}}M.prototype.compile=function(e){return vt(this,e)};function vh(e){const t=[],n=new Set;function s(i){if(!(typeof i!="object"||n.has(i))){n.add(i);for(let a in i.ins)s(i.ins[a]);t.push(i)}}return s(e),t}const an=Object.freeze(Object.defineProperty({__proto__:null,compile:vt},Symbol.toStringTag,{value:"Module"}));let gn=class{constructor(){this._events={}}on(t,n){this._events[t]||(this._events[t]=[]);let s=this._events[t];rt(s.indexOf(n)==-1),s.push(n)}removeListener(t,n){let s=this._events[t],i=s.indexOf(n);i!=-1&&s.splice(i,1)}trigger(t,...n){let s=this._events[t]||[];for(let i=0;i<s.length;i++)s[i].apply(null,n)}},xh=class extends gn{constructor(t=navigator){super(),this.midiAccess=null,this.getMIDIAccess(t)}async getMIDIAccess(t){if("requestMIDIAccess"in t){this.midiAccess=await t.requestMIDIAccess({sysex:!1}),console.log("got MIDI access");for(let n of this.midiAccess.inputs.values())n.state=="connected"&&(n.onmidimessage=s=>this.trigger("midimessage",n.id,s.data));this.midiAccess.onstatechange=n=>{n.port.type=="input"&&n.port.state=="connected"&&(console.log("MIDI device connected:",n.port.name,"PORT:",n.port.id),n.port.onmidimessage=s=>this.trigger("midimessage",n.port.id,s.data))}}}broadcast(t,n){if(midi)for(let s of this.midiAccess.outputs.values())s.send(t,n)}};function Xh(e){let t=e[0]&240,n=(e[0]&15)+1;if(t==176&&e.length==3){let s=e[1],i=e[2]/127*2-1;return{type:"CC",channel:n,cc:s,value:i}}if(t==224&&e.length==3){let s=e[1],i=(e[2]<<7|s)/16383*2-1;return{type:"PITCHBEND",channel:n,value:i}}if(t==144&&e.length==3){let s=e[1],i=e[2]/127;return{type:"NOTE_ON",channel:n,note:s,velocity:i}}if(t==128&&e.length==3){let s=e[1];return{type:"NOTE_ON",channel:n,note:s,velocity:0}}}let Zh=class extends gn{constructor(){super(),this.attach()}attach(){typeof window<"u"&&(this.handleMouseMove=t=>{const n=t.clientX/document.body.clientWidth*2-1,s=t.clientY/document.body.clientHeight*2-1;this.trigger("move",n,s)},document.addEventListener("mousemove",this.handleMouseMove))}detach(){typeof window<"u"&&document.removeEventListener("mousemove",this.handleMouseMove)}};const kh="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIGcoaCx0KXtpZih0fHwodD0iYXNzZXJ0aW9uIGZhaWxlZCIpLCFoKXRocm93IG5ldyBFcnJvcih0KX1mdW5jdGlvbiBTKGgsdCxzKXtyZXR1cm4gaDw9MD90Omg+PTE/czp0K2gqKHMtdCl9ZnVuY3Rpb24gUChoLHQscyl7cmV0dXJuIGg8PXQ/MDpoPj1zPzE6cz09PXQ/MDooaC10KS8ocy10KX1mdW5jdGlvbiBFKGgsdCl7cmV0dXJuIGg8dD8oaC89dCxoK2gtaCpoLTEpOmg+MS10PyhoPShoLTEpL3QsaCpoK2graCsxKTowfWZ1bmN0aW9uIFUoaCl7cmV0dXJuIE1hdGguZmxvb3IoaCk9PT1ofWZ1bmN0aW9uIF8oaCl7cmV0dXJuIFUoaCkmJmg+MH1mdW5jdGlvbiBrKGgsdCl7dD1NYXRoLm1pbihNYXRoLm1heCh0LDApLDEpLHQtPS4wMTt2YXIgcz0yKnQvKDEtdCksZT0oMStzKSpoLygxK3MqTWF0aC5hYnMoaCkpO3JldHVybiBlfWZ1bmN0aW9uIHcoaCx0LHMpe3JldHVybiBoPj0xP3M6dCtoKihzLXQpfWZ1bmN0aW9uIFQoKXt0aGlzLnN0YXRlPSJvZmYiLHRoaXMuc3RhcnRUaW1lPTAsdGhpcy5zdGFydFZhbD0wfVQucHJvdG90eXBlLmV2YWw9ZnVuY3Rpb24oaCx0LHMsZSxpLG4pe3N3aXRjaCh0aGlzLnN0YXRlKXtjYXNlIm9mZiI6cmV0dXJuIHQ+MCYmKHRoaXMuc3RhdGU9ImF0dGFjayIsdGhpcy5zdGFydFRpbWU9aCx0aGlzLnN0YXJ0VmFsPTApLDA7Y2FzZSJhdHRhY2siOntsZXQgcj1oLXRoaXMuc3RhcnRUaW1lO3JldHVybiByPnM/KHRoaXMuc3RhdGU9ImRlY2F5Iix0aGlzLnN0YXJ0VGltZT1oLDEpOncoci9zLHRoaXMuc3RhcnRWYWwsMSl9Y2FzZSJkZWNheSI6e2xldCByPWgtdGhpcy5zdGFydFRpbWUsbD13KHIvZSwxLGkpO3JldHVybiB0PD0wPyh0aGlzLnN0YXRlPSJyZWxlYXNlIix0aGlzLnN0YXJ0VGltZT1oLHRoaXMuc3RhcnRWYWw9bCxsKTpyPmU/KHRoaXMuc3RhdGU9InN1c3RhaW4iLHRoaXMuc3RhcnRUaW1lPWgsaSk6bH1jYXNlInN1c3RhaW4iOnJldHVybiB0PD0wJiYodGhpcy5zdGF0ZT0icmVsZWFzZSIsdGhpcy5zdGFydFRpbWU9aCx0aGlzLnN0YXJ0VmFsPWkpLGk7Y2FzZSJyZWxlYXNlIjp7bGV0IHI9aC10aGlzLnN0YXJ0VGltZTtpZihyPm4pcmV0dXJuIHRoaXMuc3RhdGU9Im9mZiIsMDtsZXQgbD13KHIvbix0aGlzLnN0YXJ0VmFsLDApO3JldHVybiB0PjAmJih0aGlzLnN0YXRlPSJhdHRhY2siLHRoaXMuc3RhcnRUaW1lPWgsdGhpcy5zdGFydFZhbD1sKSxsfX10aHJvdyJpbnZhbGlkIGVudmVsb3BlIHN0YXRlIn07ZnVuY3Rpb24gdigpe3RoaXMuczA9MCx0aGlzLnMxPTB9di5wcm90b3R5cGUuYXBwbHk9ZnVuY3Rpb24oaCx0LHMpe2coIWlzTmFOKGgpLCJOYU4gdmFsdWUgZmVkIGluIFR3b1BvbGVGaWx0ZXIiKSx0PU1hdGgubWluKHQsMSkscz1NYXRoLm1heChzLDApO3ZhciBlPU1hdGgucG93KC41LCgxLXQpLy4xMjUpLGk9TWF0aC5wb3coLjUsKHMrLjEyNSkvLjEyNSksbj0xLWkqZSxyPXRoaXMuczAsbD10aGlzLnMxO3JldHVybiByPW4qci1lKmwrZSpoLGw9bipsK2UqcixoPWwsdGhpcy5zMD1yLHRoaXMuczE9bCxofTtsZXQgQT1jbGFzcyBDe2NvbnN0cnVjdG9yKHQscyl7dGhpcy5zYW1wbGVSYXRlPXQscz90aGlzLmJ1ZmZlcj1zLnNsaWNlKDApOih0aGlzLmJ1ZmZlcj1uZXcgRmxvYXQzMkFycmF5KDEwKnQpLHRoaXMuYnVmZmVyLmZpbGwoMCkpLHRoaXMud3JpdGVJZHg9MCx0aGlzLnJlYWRJZHg9MH1yZXNldCgpe3RoaXMuYnVmZmVyLmZpbGwoMCksdGhpcy53cml0ZUlkeD0wLHRoaXMucmVhZElkeD0wfWNsb25lKCl7Y29uc3QgdD1uZXcgQyh0aGlzLnNhbXBsZVJhdGUsdGhpcy5idWZmZXIpO3JldHVybiB0LndyaXRlSWR4PXRoaXMud3JpdGVJZHgsdC5yZWFkSWR4PXRoaXMucmVhZElkeCx0fXdyaXRlKHQscyl7dGhpcy53cml0ZUlkeD0odGhpcy53cml0ZUlkeCsxKSV0aGlzLmJ1ZmZlci5sZW5ndGgsdGhpcy5idWZmZXJbdGhpcy53cml0ZUlkeF09dDtsZXQgZT1NYXRoLm1pbihNYXRoLmZsb29yKHRoaXMuc2FtcGxlUmF0ZSpzKSx0aGlzLmJ1ZmZlci5sZW5ndGgtMSk7dGhpcy5yZWFkSWR4PXRoaXMud3JpdGVJZHgtZSx0aGlzLnJlYWRJZHg8MCYmKHRoaXMucmVhZElkeCs9dGhpcy5idWZmZXIubGVuZ3RoKX1yZWFkKCl7cmV0dXJuIHRoaXMuYnVmZmVyW3RoaXMucmVhZElkeF19fTtjb25zdCB5PTEvNDhlMyxNPTI0LE49TS80O2NsYXNzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7dGhpcy5ub2RlSWQ9dCx0aGlzLnN0YXRlPXMsdGhpcy5zYW1wbGVSYXRlPWUsdGhpcy5zYW1wbGVUaW1lPTEvZSx0aGlzLnNlbmQ9aX19Y2xhc3MgcSBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5lbnY9bmV3IFR9dXBkYXRlKHQscyxlLGksbixyKXtyZXR1cm4gdGhpcy5lbnYuZXZhbCh0LHMsZSxpLG4scil9fWNsYXNzIEYgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MH11cGRhdGUodCl7bGV0IHM9TSp0LzYwLGU9LjU7cmV0dXJuIHRoaXMucGhhc2UrPXRoaXMuc2FtcGxlVGltZSpzLHRoaXMucGhhc2UlMTxlPzE6LTF9fWNsYXNzIEQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMuaW5TZ249ITAsdGhpcy5vdXRTZ249ITAsdGhpcy5jbG9ja0NudD0wfXVwZGF0ZSh0LHMpe2xldCBlPXQ+MDtyZXR1cm4gdGhpcy5pblNnbiE9ZSYmKHRoaXMuY2xvY2tDbnQrKyx0aGlzLmNsb2NrQ250Pj1zJiYodGhpcy5jbG9ja0NudD0wLHRoaXMub3V0U2duPSF0aGlzLm91dFNnbikpLHRoaXMuaW5TZ249ZSx0aGlzLm91dFNnbj8xOi0xfX1jbGFzcyBMIGV4dGVuZHMgb3tjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLmluU2duPSExfXVwZGF0ZSh0LHMpe2xldCBlPXM+MDtyZXR1cm4gZSYmdGhpcy5pblNnbiE9ZSYmdGhpcy5zZW5kKHt0eXBlOiJDTE9DS19QVUxTRSIsbm9kZUlkOnRoaXMubm9kZUlkLHRpbWU6dH0pLHRoaXMuaW5TZ249ZSwwfX1jb25zdCBPPW5ldyBNYXA7Y2xhc3MgViBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSk7Y29uc3Qgbj1zLmlucHV0c1syXTtuJiZPLmhhcyhuKT90aGlzLmRlbGF5PU8uZ2V0KG4pLmNsb25lKCk6dGhpcy5kZWxheT1uZXcgQShlKSxuJiZPLnNldChuLHRoaXMuZGVsYXkpfXVwZGF0ZSh0LHMpe3JldHVybiB0aGlzLmRlbGF5LndyaXRlKHQscyksdGhpcy5kZWxheS5yZWFkKCl9fWNsYXNzIEcgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpfXVwZGF0ZSh0LHMpe3JldHVybiBrKHQscyl9fWNsYXNzIFIgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudmFsdWU9MCx0aGlzLnRyaWdTZ249ITF9d3JpdGUodCxzKXshdGhpcy50cmlnU2duJiZzPjAmJih0aGlzLnZhbHVlPXQpLHRoaXMudHJpZ1Nnbj1zPjB9cmVhZCgpe3JldHVybiB0aGlzLnZhbHVlfXVwZGF0ZSh0LHMpe3JldHVybiB0aGlzLndyaXRlKHQscyksdGhpcy5yZWFkKCl9fWNsYXNzIEJ7Y29uc3RydWN0b3IoKXt0aGlzLnZhbHVlPTB9dXBkYXRlKHQpe3JldHVybiB0aGlzLnZhbHVlPXQsdGhpcy52YWx1ZX19Y29uc3QgJD0zNDA7bGV0IEk9MDtjbGFzcyBIe2NvbnN0cnVjdG9yKCl7dGhpcy5jaD1JLHRoaXMuc3RhcnRfc2VlZD0kKih0aGlzLmNoKzEpPj4+MCx0aGlzLnN0YXRlPXRoaXMuc3RhcnRfc2VlZCx0aGlzLnZhbHVlPTAsdGhpcy5hPTE2NjQ1MjUsdGhpcy5jPTEwMTM5MDQyMjMsdGhpcy5tYXNrPTE2Nzc3MjE1LHRoaXMuc2NhbGU9MS8oMTw8MjQpLEkrK311cGRhdGUodCxzKXtpZighdClyZXR1cm4gdGhpcy52YWx1ZTtzJiYodGhpcy5zdGF0ZT10aGlzLnN0YXJ0X3NlZWQpLHRoaXMuc3RhdGU9dGhpcy5zdGF0ZSp0aGlzLmErdGhpcy5jPj4+MDtjb25zdCBlPSh0aGlzLnN0YXRlJnRoaXMubWFzaykqdGhpcy5zY2FsZTtyZXR1cm4gdGhpcy52YWx1ZT1lKjItMSx0aGlzLnZhbHVlfX1jbGFzcyBqe2NvbnN0cnVjdG9yKCl7dGhpcy52YWx1ZT1NYXRoLnJhbmRvbSgpKjItMX11cGRhdGUodCl7cmV0dXJuIHQ/KHRoaXMudmFsdWU9TWF0aC5yYW5kb20oKSoyLTEsdGhpcy52YWx1ZSk6dGhpcy52YWx1ZX19Y2xhc3MgS3t1cGRhdGUodCl7cmV0dXJuIE1hdGgucmFuZG9tKCk8dCp5P01hdGgucmFuZG9tKCk6MH19Y2xhc3MgV3tjb25zdHJ1Y3Rvcigpe3RoaXMub3V0PTB9dXBkYXRlKCl7bGV0IHQ9TWF0aC5yYW5kb20oKSoyLTE7cmV0dXJuIHRoaXMub3V0PSh0aGlzLm91dCsuMDIqdCkvMS4wMix0aGlzLm91dH19Y2xhc3MgWHtjb25zdHJ1Y3Rvcigpe3RoaXMuYjA9MCx0aGlzLmIxPTAsdGhpcy5iMj0wLHRoaXMuYjM9MCx0aGlzLmI0PTAsdGhpcy5iNT0wLHRoaXMuYjY9MH11cGRhdGUoKXtjb25zdCB0PU1hdGgucmFuZG9tKCkqMi0xO3RoaXMuYjA9Ljk5ODg2KnRoaXMuYjArdCouMDU1NTE3OSx0aGlzLmIxPS45OTMzMip0aGlzLmIxK3QqLjA3NTA3NTksdGhpcy5iMj0uOTY5KnRoaXMuYjIrdCouMTUzODUyLHRoaXMuYjM9Ljg2NjUqdGhpcy5iMyt0Ki4zMTA0ODU2LHRoaXMuYjQ9LjU1KnRoaXMuYjQrdCouNTMyOTUyMix0aGlzLmI1PS0uNzYxNip0aGlzLmI1LXQqLjAxNjg5ODtjb25zdCBzPXRoaXMuYjArdGhpcy5iMSt0aGlzLmIyK3RoaXMuYjMrdGhpcy5iNCt0aGlzLmI1K3RoaXMuYjYrdCouNTM2MjtyZXR1cm4gdGhpcy5iNj10Ki4xMTU5MjYscyouMTF9fWNsYXNzIFkgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MX11cGRhdGUodCl7dGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQ7bGV0IHM9dGhpcy5waGFzZT49MT8xOjA7cmV0dXJuIHRoaXMucGhhc2U9dGhpcy5waGFzZSUxLHN9fWNsYXNzIHogZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMucGhhc2U9MH11cGRhdGUodCxzKXtyZXR1cm4gdGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQsdGhpcy5waGFzZSUxPHM/MTotMX19Y2xhc3MgWiBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5waGFzZT0wfXVwZGF0ZSh0KXtyZXR1cm4gdGhpcy5waGFzZSs9dGhpcy5zYW1wbGVUaW1lKnQsdGhpcy5waGFzZSUxKjItMX19Y2xhc3MgSntjb25zdHJ1Y3Rvcigpe3RoaXMucGhhc2U9TWF0aC5yYW5kb20oKX11cGRhdGUodCl7Y29uc3Qgcz10L3NhbXBsZVJhdGU7bGV0IGU9RSh0aGlzLnBoYXNlLHMpLGk9Mip0aGlzLnBoYXNlLTEtZTtyZXR1cm4gdGhpcy5waGFzZSs9cyx0aGlzLnBoYXNlPjEmJih0aGlzLnBoYXNlLT0xKSxpfX1jbGFzcyBRIGV4dGVuZHMgb3tjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnBoYXNlPTAsdGhpcy5zeW5jU2duPSExfXVwZGF0ZSh0LHMsZSl7IXRoaXMuc3luY1NnbiYmcz4wJiYodGhpcy5waGFzZT0wKSx0aGlzLnN5bmNTZ249cz4wO2xldCBpPSh0aGlzLnBoYXNlK2UpJTE7cmV0dXJuIHRoaXMucGhhc2UrPXRoaXMuc2FtcGxlVGltZSp0LE1hdGguc2luKGkqMipNYXRoLlBJKX19Y2xhc3MgdHR7ZEJUb0xpbmVhcih0KXtyZXR1cm4gTWF0aC5wb3coMTAsdC8yMCl9bGluZWFyVG9EQih0KXtyZXR1cm4gMjAqTWF0aC5sb2cxMCh0KX11cGRhdGUodCxzLGUpe2xldCBpPXRoaXMubGluZWFyVG9EQihNYXRoLmFicyh0KSksbj0wO3JldHVybiBpPnMmJihuPShpLXMpKigxLTEvZSkpLHRoaXMuZEJUb0xpbmVhcigtbil9fWNsYXNzIHN0IGV4dGVuZHMgb3tjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnBoYXNlPTB9dXBkYXRlKHQpe3RoaXMucGhhc2UrPXRoaXMuc2FtcGxlVGltZSp0O2xldCBzPXRoaXMucGhhc2UlMTtyZXR1cm4oczwuNT8yKnM6MS0yKihzLS41KSkqMi0xfX1jbGFzcyBldCBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSk7Y29uc3Qgbj1lLzMwO2coXyhuKSksdGhpcy5idWZmZXI9bmV3IEZsb2F0MzJBcnJheShuKSx0aGlzLndyaXRlUG9zPTB9dXBkYXRlKHQscyxlLGkpe3JldHVybiB0aGlzLmJ1ZmZlclt0aGlzLndyaXRlUG9zXT10LHRoaXMud3JpdGVQb3MrKyx0aGlzLndyaXRlUG9zJXRoaXMuYnVmZmVyLmxlbmd0aD09MCYmKHRoaXMud3JpdGVQb3M9MCx0aGlzLnNlbmQoe3R5cGU6IlNFTkRfU0FNUExFUyIsaWQ6cyxzYW1wbGVzOnRoaXMuYnVmZmVyLGNoYW5uZWxzOmUsY2hhbm5lbDppfSkpLHR9fWNsYXNzIGl0e2NvbnN0cnVjdG9yKCl7dGhpcy5sYWdVbml0PTQ0MTAsdGhpcy5zPTB9dXBkYXRlKHQscyl7cmV0dXJuIHM9cyp0aGlzLmxhZ1VuaXQsczwxJiYocz0xKSx0aGlzLnMrPTEvcyoodC10aGlzLnMpLHRoaXMuc319Y2xhc3MgaHR7Y29uc3RydWN0b3IoKXt0aGlzLmxhc3Q9MH11cGRhdGUodCxzLGUpe2NvbnN0IGk9cyp5LG49ZSp5O2xldCByPXQtdGhpcy5sYXN0O3JldHVybiByPmk/cj1pOnI8LW4mJihyPS1uKSx0aGlzLmxhc3QrPXIsdGhpcy5sYXN0fX1jbGFzcyBhdCBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5zPTB9dXBkYXRlKHQscyl7cmV0dXJuIHM9cyoxZTMsczwxJiYocz0xKSx0aGlzLnMrPTEvcyoodC10aGlzLnMpLHRoaXMuc319Y2xhc3MgbnQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMuZmlsdGVyPW5ldyB2fXVwZGF0ZSh0LHMsZSl7cmV0dXJuIHRoaXMuZmlsdGVyLmFwcGx5KHQscyxlKSx0aGlzLmZpbHRlci5zMX19Y2xhc3MgcnQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMuZmlsdGVyPW5ldyB2fXVwZGF0ZSh0LHMsZSl7cmV0dXJuIHRoaXMuZmlsdGVyLmFwcGx5KHQscyxlKSx0aGlzLmZpbHRlci5zMH19Y2xhc3MgdXQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpfXVwZGF0ZSh0LHMpe3JldHVybiBzPDAmJihzPTApLHM9cysxLHQ9dCpzLDQqKE1hdGguYWJzKC4yNSp0Ky4yNS1NYXRoLnJvdW5kKC4yNSp0Ky4yNSkpLS4yNSl9fWNsYXNzIGx0IGV4dGVuZHMgb3t1cGRhdGUodCl7cmV0dXJuIHR9fWNsYXNzIG0gZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMubm90ZT0wLHRoaXMuZnJlcT0wLHRoaXMudmVsb2NpdHk9MCx0aGlzLmdhdGVTdGF0ZT0ib2ZmIix0aGlzLnR5cGU9Im1pZGlpbiIsdGhpcy5jaGFubmVsPS0xfWlzRnJlZSgpe3JldHVybiB0aGlzLmdhdGVTdGF0ZT09PSJvZmYifW5vdGVPbih0LHMpe3M+MD8odGhpcy5ub3RlPXQsdGhpcy52ZWxvY2l0eT1zLHRoaXMuZnJlcT0yKiooKHQtNjkpLzEyKSo0NDAsdGhpcy5nYXRlU3RhdGU9InByZXRyaWciKTp0aGlzLm5vdGVPZmYoKX1ub3RlT2ZmKCl7dGhpcy5ub3RlPTAsdGhpcy5nYXRlU3RhdGU9Im9mZiJ9Z2V0R2F0ZSgpe3N3aXRjaCh0aGlzLmdhdGVTdGF0ZSl7Y2FzZSJwcmV0cmlnIjpyZXR1cm4gdGhpcy5nYXRlU3RhdGU9Im9uIiwwO2Nhc2Uib24iOnJldHVybiAxO2Nhc2Uib2ZmIjpyZXR1cm4gMDtkZWZhdWx0OmcoITEpfX1nZXRGcmVxKCl7c3dpdGNoKHRoaXMuZ2F0ZVN0YXRlKXtjYXNlInByZXRyaWciOnJldHVybiB0aGlzLmdhdGVTdGF0ZT0ib24iLDA7Y2FzZSJvbiI6cmV0dXJuIHRoaXMuZnJlcTtjYXNlIm9mZiI6cmV0dXJuIHRoaXMuZnJlcTtkZWZhdWx0OmcoITEpfX1nZXRWZWxvY2l0eSgpe3N3aXRjaCh0aGlzLmdhdGVTdGF0ZSl7Y2FzZSJwcmV0cmlnIjpyZXR1cm4gdGhpcy5nYXRlU3RhdGU9Im9uIiwwO2Nhc2Uib24iOnJldHVybiB0aGlzLnZlbG9jaXR5O2Nhc2Uib2ZmIjpyZXR1cm4gdGhpcy52ZWxvY2l0eTtkZWZhdWx0OmcoITEpfX19Y2xhc3Mgb3QgZXh0ZW5kcyBte2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudHlwZT0ibWlkaWdhdGUifXVwZGF0ZSh0KXtyZXR1cm4gdGhpcy5jaGFubmVsPXQsdGhpcy5nZXRHYXRlKCl9fWNsYXNzIGN0IGV4dGVuZHMgbXtjb25zdHJ1Y3Rvcih0LHMsZSxpKXtzdXBlcih0LHMsZSxpKSx0aGlzLnR5cGU9Im1pZGlmcmVxIn11cGRhdGUodCl7cmV0dXJuIHRoaXMuY2hhbm5lbD10LHRoaXMuZ2V0RnJlcSgpfX1jbGFzcyBkdCBleHRlbmRzIG17Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy50eXBlPSJtaWRpdmVsIn11cGRhdGUodCl7cmV0dXJuIHRoaXMuY2hhbm5lbD10LHRoaXMuZ2V0VmVsb2NpdHkoKX19Y2xhc3MgZnR7Y29uc3RydWN0b3IodCxzLGUsaSl7dGhpcy51cD0hMSx0aGlzLnNlbmQ9aSx0aGlzLnZhbHVlPTAsdGhpcy50eXBlPSJjYyJ9c2V0VmFsdWUodCl7dGhpcy52YWx1ZT10fXVwZGF0ZSh0LHMsZSl7cmV0dXJuIHRoaXMuaWQ9cywhdGhpcy51cCYmdD4wPyh0aGlzLnVwPSEwLHRoaXMuc2VuZCh7dHlwZToiU0lHTkFMX1RSSUdHRVIiLGlkOnMsdGltZTplfSksdGhpcy52YWx1ZSk6KHRoaXMudXA9dD4wLHRoaXMudmFsdWUpfX1jbGFzcyBwdCBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy50eXBlPSJjYyIsdGhpcy52YWx1ZT1zLmlucHV0c1sxXT8/MH1zZXRWYWx1ZSh0KXt0aGlzLnZhbHVlPXR9dXBkYXRlKHQpe3JldHVybiB0aGlzLmlkPXQsdGhpcy52YWx1ZX19Y2xhc3MgYnQgZXh0ZW5kcyBve2NvbnN0cnVjdG9yKHQscyxlLGkpe3N1cGVyKHQscyxlLGkpLHRoaXMudHlwZT0ibWlkaWNjIix0aGlzLnZhbHVlPXMuaW5wdXRzWzJdPz8tMSx0aGlzLmNoYW5uZWw9LTEsdGhpcy5jY251bWJlcj0tMX1zZXRWYWx1ZSh0KXt0aGlzLnZhbHVlPXR9dXBkYXRlKHQscyl7cmV0dXJuIHRoaXMuY2NudW1iZXI9dCx0aGlzLmNoYW5uZWw9cyx0aGlzLnZhbHVlfX1jbGFzcyBndCBleHRlbmRzIG97Y29uc3RydWN0b3IodCxzLGUsaSl7c3VwZXIodCxzLGUsaSksdGhpcy5jbG9ja1Nnbj0hMCx0aGlzLnN0ZXA9MCx0aGlzLmZpcnN0PSEwfXVwZGF0ZSh0LC4uLnMpe3JldHVybiF0aGlzLmNsb2NrU2duJiZ0PjA/KHRoaXMuc3RlcD0odGhpcy5zdGVwKzEpJXMubGVuZ3RoLHRoaXMuY2xvY2tTZ249dD4wLDApOih0aGlzLmNsb2NrU2duPXQ+MCxzW3RoaXMuc3RlcF0pfX1jbGFzcyBtdCBleHRlbmRzIG97dXBkYXRlKHQsLi4ucyl7Y29uc3QgZT10JXMubGVuZ3RoK3MubGVuZ3RoO3JldHVybiBzW01hdGguZmxvb3IoZSklcy5sZW5ndGhdfX1jbGFzcyBTdHt1cGRhdGUodCxzLGUsaSxuKXtsZXQgcj1QKHQscyxlKTtyZXR1cm4gUyhyLGksbil9fWNsYXNzIHd0e3VwZGF0ZSh0LHMsZSl7cmV0dXJuIE1hdGgubWluKE1hdGgubWF4KHQscyksZSl9fWNsYXNzIHZ0e2NvbnN0cnVjdG9yKCl7dGhpcy5oaT0hMX11cGRhdGUodCl7cmV0dXJuIXRoaXMuaGkmJnQ+MD8odGhpcy5oaT0hMCwxKToodGhpcy5oaSYmdDw9MCYmKHRoaXMuaGk9ITEpLDApfX1jbGFzcyB5dHtjb25zdHJ1Y3Rvcigpe3RoaXMueDE9MCx0aGlzLngyPTAsdGhpcy55MT0wLHRoaXMueTI9MCx0aGlzLmEwPTEsdGhpcy5hMT0wLHRoaXMuYTI9MCx0aGlzLmIwPTEsdGhpcy5iMT0wLHRoaXMuYjI9MH11cGRhdGUodD0wLHM9MCxlPTUwMCxpPTEsbj0xKXtjb25zdCByPTIqTWF0aC5QSSplL3NhbXBsZVJhdGUsbD1NYXRoLnNpbihyKTtpPU1hdGgucG93KDEwLGkvMjApO2NvbnN0IHU9bC8oMippKSxjPU1hdGguY29zKHIpO2lmKHM9PT0wKXRoaXMuYjE9MS1jLHRoaXMuYjA9dGhpcy5iMS8yLHRoaXMuYjI9dGhpcy5iMCx0aGlzLmEwPTErdSx0aGlzLmExPS0yKmMsdGhpcy5hMj0xLXU7ZWxzZSBpZihzPT09MSl0aGlzLmIwPSgxK2MpLzIsdGhpcy5iMT0tKDErYyksdGhpcy5iMj10aGlzLmIwLHRoaXMuYTA9MSt1LHRoaXMuYTE9LTIqYyx0aGlzLmEyPTEtdTtlbHNlIGlmKHM9PT0yKXRoaXMuYjA9bC8yLHRoaXMuYjE9MCx0aGlzLmIyPS10aGlzLmIwLHRoaXMuYTA9MSt1LHRoaXMuYTE9LTIqYyx0aGlzLmEyPTEtdTtlbHNlIGlmKHM9PT0zKXRoaXMuYjA9MSx0aGlzLmIxPS0yKmMsdGhpcy5iMj0xLHRoaXMuYTA9MSt1LHRoaXMuYTE9LTIqYyx0aGlzLmEyPTEtdTtlbHNlIGlmKHM9PT00KXRoaXMuYjA9MS11LHRoaXMuYjE9LTIqYyx0aGlzLmIyPTErdSx0aGlzLmEwPTErdSx0aGlzLmExPS0yKmMsdGhpcy5hMj0xLXU7ZWxzZSBpZihzPT09NSl7Y29uc3QgYT1NYXRoLnBvdygxMCxuLzQwKTt0aGlzLmIwPTErdSphLHRoaXMuYjE9LTIqYyx0aGlzLmIyPTEtdSphLHRoaXMuYTA9MSt1L2EsdGhpcy5hMT0tMipjLHRoaXMuYTI9MS11L2F9ZWxzZSBpZihzPT09Nil7Y29uc3QgYT1NYXRoLnBvdygxMCxuLzQwKSxkPTIqTWF0aC5zcXJ0KGEpKnUsZj0oYS0xKSpjLHA9KGErMSkqYzt0aGlzLmIwPWEqKGErMS1mK2QpLHRoaXMuYjE9MiphKihhLTEtcCksdGhpcy5iMj1hKihhKzEtZi1kKSx0aGlzLmEwPWErMStmK2QsdGhpcy5hMT0tMiooYS0xK3ApLHRoaXMuYTI9YSsxK2YtZH1lbHNlIGlmKHM9PT03KXtjb25zdCBhPU1hdGgucG93KDEwLG4vNDApLGQ9MipNYXRoLnNxcnQoYSkqdSxmPShhLTEpKmMscD0oYSsxKSpjO3RoaXMuYjA9YSooYSsxK2YrZCksdGhpcy5iMT0tMiphKihhLTErcCksdGhpcy5iMj1hKihhKzErZi1kKSx0aGlzLmEwPWErMS1mK2QsdGhpcy5hMT0yKihhLTEtcCksdGhpcy5hMj1hKzEtZi1kfXRoaXMuYjAvPXRoaXMuYTAsdGhpcy5iMS89dGhpcy5hMCx0aGlzLmIyLz10aGlzLmEwLHRoaXMuYTEvPXRoaXMuYTAsdGhpcy5hMi89dGhpcy5hMCx0aGlzLmEwPTE7Y29uc3QgYj10aGlzLmIwKnQrdGhpcy5iMSp0aGlzLngxK3RoaXMuYjIqdGhpcy54Mi10aGlzLmExKnRoaXMueTEtdGhpcy5hMip0aGlzLnkyO3JldHVybiB0aGlzLngyPXRoaXMueDEsdGhpcy54MT10LHRoaXMueTI9dGhpcy55MSx0aGlzLnkxPWIsYn19Y29uc3QgTXQ9T2JqZWN0LmZyZWV6ZShPYmplY3QuZGVmaW5lUHJvcGVydHkoe19fcHJvdG9fXzpudWxsLEFEU1JOb2RlOnEsQXVkaW9JbjpsdCxBdWRpb05vZGU6byxCUEY6cnQsQmlxdWFkRmlsdGVyOnl0LEJyb3duTm9pc2VPc2M6VyxDQzpwdCxDTE9DS19QUFE6TSxDTE9DS19QUFM6TixDbGlwOnd0LENsb2NrOkYsQ2xvY2tEaXY6RCxDbG9ja091dDpMLERlbGF5OlYsRGlzdG9ydDpHLER1c3RPc2M6SyxGaWx0ZXI6bnQsRm9sZDp1dCxIb2xkOlIsSW1wdWxzZU9zYzpZLExhZzppdCxMY2dOb2lzZTpILE1pZGlDQzpidCxNaWRpRnJlcTpjdCxNaWRpR2F0ZTpvdCxNaWRpSW46bSxNaWRpVmVsOmR0LE5vaXNlT3NjOmosT3V0cHV0OkIsUGljazptdCxQaW5rTm9pc2U6WCxQdWxzZU9zYzp6LFJlbWFwOlN0LFNhd09zYzpKLFNjb3BlOmV0LFNlcXVlbmNlOmd0LFNpZGVjaGFpbkNvbXByZXNzb3I6dHQsU2lnbmFsOmZ0LFNpbmVPc2M6USxTbGV3Omh0LFNsaWRlOmF0LFRyaU9zYzpzdCxUcmlnOnZ0LFphd09zYzpafSxTeW1ib2wudG9TdHJpbmdUYWcse3ZhbHVlOiJNb2R1bGUifSkpLHg9bmV3IE1hcChPYmplY3QuZW50cmllcyhNdCkpO2NsYXNzIE90e2NvbnN0cnVjdG9yKHQscyl7Zyh0PT00OGUzKSx0aGlzLnNhbXBsZVJhdGU9dCx0aGlzLnBsYXlQb3M9MCx0aGlzLnNlbmQ9cyx0aGlzLnVuaXRzPVtdLHRoaXMudW5pdElEPTAsdGhpcy5mYWRlVGltZT0uMDEsdGhpcy5tYXhVbml0cz0xLHRoaXMucT1bXX1mYWRlT3V0VW5pdCh0KXt0LmZhZGVPdXQodGhpcy5wbGF5UG9zLHRoaXMuZmFkZVRpbWUpLHRoaXMuZnJlZVVuaXQodC5pZCx0aGlzLmZhZGVUaW1lKX1mYWRlT3V0VW5pdEJ5SWQodCl7Y29uc3Qgcz10aGlzLnVuaXRzLmZpbmQoZT0+ZS5pZD09PXQpO3MmJnRoaXMuZmFkZU91dFVuaXQocyl9ZmFkZU91dEFsbFVuaXRzKCl7dGhpcy51bml0cy5mb3JFYWNoKHQ9PnRoaXMuZmFkZU91dFVuaXQodCkpfWZhZGVPdXRPbGRVbml0cygpe2NvbnN0IHQ9dGhpcy51bml0cy5maWx0ZXIoZT0+ZS5hY3RpdmUpLHM9dC5sZW5ndGgtdGhpcy5tYXhVbml0cztzPD0wfHx0LnNsaWNlKDAscykuZm9yRWFjaChlPT50aGlzLmZhZGVPdXRVbml0KGUpKX1zdG9wKCl7dGhpcy5mYWRlT3V0QWxsVW5pdHMoKSx0aGlzLnNlbmQoe3R5cGU6IlNUT1AiLGZhZGVUaW1lOnRoaXMuZmFkZVRpbWV9KX1zcGF3blVuaXQodCxzKXtjb25zdCBlPW5ldyB4dCh0aGlzLnVuaXRJRCsrLHQsdGhpcy5zYW1wbGVSYXRlLHRoaXMuc2VuZCk7dGhpcy51bml0cy5wdXNoKGUpLGUuZmFkZUluKHRoaXMucGxheVBvcyx0aGlzLmZhZGVUaW1lKSx0aGlzLmZhZGVPdXRPbGRVbml0cygpLGNvbnNvbGUubG9nKGBzcGF3biB1bml0ICR7ZS5pZH0sIHVuaXRzIGFsaXZlOiAke3RoaXMudW5pdHMubGVuZ3RofWApLHMmJnRoaXMuc2NoZWR1bGVNZXNzYWdlKHttc2c6e3R5cGU6IkZBREVfT1VUX1VOSVQiLGlkOmUuaWR9LHRpbWU6c30pfWZyZWVVbml0KHQscyl7aWYocyl7dGhpcy5zY2hlZHVsZU1lc3NhZ2Uoe21zZzp7dHlwZToiRlJFRV9VTklUIixpZDp0fSx0aW1lOnN9KTtyZXR1cm59Y29uc3QgZT10aGlzLnVuaXRzLmxlbmd0aDt0aGlzLnVuaXRzPXRoaXMudW5pdHMuZmlsdGVyKGk9PmkuaWQhPT10KSxlPnRoaXMudW5pdHMubGVuZ3RoJiZjb25zb2xlLmxvZyhgZnJlZSB1bml0ICR7dH0sIHVuaXRzIGFsaXZlOiAke3RoaXMudW5pdHMubGVuZ3RofWApfXBhcnNlTXNnKHQpe3N3aXRjaCh0LnR5cGUpe2Nhc2UiU1BBV05fVU5JVCI6dGhpcy5zcGF3blVuaXQodC51bml0LHQuZHVyYXRpb24pO2JyZWFrO2Nhc2UiRlJFRV9VTklUIjp0aGlzLmZyZWVVbml0KHQuaWQpO2JyZWFrO2Nhc2UiRkFERV9PVVRfVU5JVCI6dGhpcy5mYWRlT3V0VW5pdEJ5SWQodC5pZCk7YnJlYWs7Y2FzZSJOT1RFX09OIjp0aGlzLm5vdGVPbih0KTticmVhaztjYXNlIkNDIjp0aGlzLm1pZGlDQyh0KTticmVhaztjYXNlIlNFVF9DT05UUk9MIjp0aGlzLnNldENvbnRyb2wodCk7YnJlYWs7Y2FzZSJGQURFX1RJTUUiOnRoaXMuZmFkZVRpbWU9TnVtYmVyKHQuZmFkZVRpbWUpO2JyZWFrO2Nhc2UiTUFYX1VOSVRTIjp0aGlzLm1heFVuaXRzPU51bWJlcih0Lm1heFVuaXRzKTticmVhaztjYXNlIlNUT1AiOnRoaXMuc3RvcCgpO2JyZWFrO2Nhc2UiU0VUX1VHRU4iOnRoaXMuYWRkVWdlbih0LmNsYXNzTmFtZSx0LnVnZW4pO2JyZWFrO2Nhc2UiU0NIRURVTEVfTVNHIjp0aGlzLnNjaGVkdWxlTWVzc2FnZSh0KTticmVhaztjYXNlIkJBVENIX01TRyI6dC5tZXNzYWdlcy5mb3JFYWNoKHM9PnRoaXMucGFyc2VNc2cocykpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IFR5cGVFcnJvcihgdW5rbm93biBtZXNzYWdlIHR5cGUgJHt0LnR5cGV9YCl9fW5vdGVPbih0KXt0aGlzLnVuaXRzLmZvckVhY2gocz0+cy5ub3RlT24odCkpfW1pZGlDQyh0KXt0aGlzLnVuaXRzLmZvckVhY2gocz0+cy5taWRpQ0ModCkpfXNldENvbnRyb2wodCl7dGhpcy51bml0cy5mb3JFYWNoKHM9PnMuc2V0Q29udHJvbCh0KSl9c2NoZWR1bGVNZXNzYWdlKHQpe2lmKHQudGltZT10aGlzLnBsYXlQb3MrdC50aW1lLCF0aGlzLnEubGVuZ3RoKXt0aGlzLnEucHVzaCh0KTtyZXR1cm59bGV0IHM9MDtmb3IoO3M8dGhpcy5xLmxlbmd0aCYmdGhpcy5xW3NdLnRpbWU8dC50aW1lOylzKys7dGhpcy5xLnNwbGljZShzLDAsdCl9Z2VuU2FtcGxlKHQpe2Zvcig7dGhpcy5xLmxlbmd0aD4wJiZ0aGlzLnFbMF0udGltZTw9dGhpcy5wbGF5UG9zOyl0aGlzLnBhcnNlTXNnKHRoaXMucVswXS5tc2cpLHRoaXMucS5zaGlmdCgpO2lmKCF0aGlzLnVuaXRzLmxlbmd0aClyZXR1cm5bMCwwXTtjb25zdCBzPVswLDBdO2ZvcihsZXQgZT0wO2U8dGhpcy51bml0cy5sZW5ndGg7ZSsrKXtjb25zdCBpPXRoaXMudW5pdHNbZV0sbj1pLmdldExldmVsKHRoaXMucGxheVBvcyk7aS5nZW5TYW1wbGUodGhpcy5wbGF5UG9zLGkubm9kZXMsdCxpLnJlZ2lzdGVycyxpLm91dHB1dHMsaS5zb3VyY2VzKSxzWzBdKz1pLm91dHB1dHNbMF0qbixzWzFdKz1pLm91dHB1dHNbMV0qbn1yZXR1cm4gdGhpcy5wbGF5UG9zKz0xLzQ4ZTMsc31hZGRVZ2VuKHQscyl7Y29uc3QgZT1uZXcgRnVuY3Rpb24oYCR7c307cmV0dXJuICR7dH1gKSgpO3guc2V0KHQsZSl9fWNsYXNzIHh0e2NvbnN0cnVjdG9yKHQscyxlLGkpe3RoaXMuaWQ9dCx0aGlzLnNhbXBsZVJhdGU9ZSx0aGlzLnNlbmQ9aSx0aGlzLm5vZGVzPVtdLHRoaXMuYWN0aXZlPSEwO2ZvcihsZXQgciBpbiBzLnVnZW5zKXtjb25zdCBsPXMudWdlbnNbcl07aWYoeC5oYXMobC50eXBlKSl7Y29uc3QgdT14LmdldChsLnR5cGUpLGM9TnVtYmVyKHIpO3RoaXMubm9kZXNbY109bmV3IHUoYyxsLHRoaXMuc2FtcGxlUmF0ZSx0aGlzLnNlbmQpfWVsc2UgY29uc29sZS53YXJuKGB1bmtub3duIHVnZW4gIiR7bC50eXBlfSJgKX10aGlzLnJlZ2lzdGVycz1uZXcgQXJyYXkocy5yZWdpc3RlcnMpLmZpbGwoMCk7bGV0IG49MTY7dGhpcy5vdXRwdXRzPW5ldyBBcnJheShuKS5maWxsKDApLHRoaXMuc291cmNlcz1uZXcgQXJyYXkobikuZmlsbCgwKSxzLnNyYz1gby5maWxsKDApOyAvLyByZXNldCBvdXRwdXRzCmArcy5zcmMsdGhpcy5nZW5TYW1wbGU9bmV3IEZ1bmN0aW9uKCJ0aW1lIiwibm9kZXMiLCJpbnB1dCIsInIiLCJvIiwicyIscy5zcmMpfW5vdGVPbih0KXt2YXIgdSxjLGI7Y29uc3R7Y2hhbm5lbDpzLG5vdGU6ZSx2ZWxvY2l0eTppfT10LG49dGhpcy5ub2Rlcy5maWx0ZXIoYT0+YS50eXBlPT09Im1pZGlmcmVxIiYmKGEuY2hhbm5lbD09PS0xfHxhLmNoYW5uZWw9PT1zKSkscj10aGlzLm5vZGVzLmZpbHRlcihhPT5hLnR5cGU9PT0ibWlkaWdhdGUiJiYoYS5jaGFubmVsPT09LTF8fGEuY2hhbm5lbD09PXMpKSxsPXRoaXMubm9kZXMuZmlsdGVyKGE9PmEudHlwZT09PSJtaWRpdmVsIiYmKGEuY2hhbm5lbD09PS0xfHxhLmNoYW5uZWw9PT1zKSk7aWYoaT4wKXtsZXQgYT1uLmZpbmQocD0+cC5pc0ZyZWUoKSl8fG5bMF0sZD1yLmZpbmQocD0+cC5pc0ZyZWUoKSl8fHJbMF0sZj1sLmZpbmQocD0+cC5pc0ZyZWUoKSl8fGxbMF07YT09bnVsbHx8YS5ub3RlT24oZSxpKSxkPT1udWxsfHxkLm5vdGVPbihlLGkpLGY9PW51bGx8fGYubm90ZU9uKGUsaSl9ZWxzZSh1PW4uZmluZChhPT5hLm5vdGU9PT1lKSk9PW51bGx8fHUubm90ZU9mZigpLChjPXIuZmluZChhPT5hLm5vdGU9PT1lKSk9PW51bGx8fGMubm90ZU9mZigpLChiPWwuZmluZChhPT5hLm5vdGU9PT1lKSk9PW51bGx8fGIubm90ZU9mZigpfW1pZGlDQyh0KXtjb25zdHtjaGFubmVsOnMsY2M6ZSx2YWx1ZTppfT10O3RoaXMubm9kZXMuZm9yRWFjaChuPT57bi50eXBlPT09Im1pZGljYyImJihuLmNoYW5uZWw9PT0tMXx8bi5jaGFubmVsPT09cykmJm4uY2NudW1iZXI9PT1lJiZuLnNldFZhbHVlKGkpfSl9c2V0Q29udHJvbCh0KXtjb25zdHt2YWx1ZTpzLGlkOmV9PXQsaT10aGlzLm5vZGVzLmZpbmQobj0+bi50eXBlPT09ImNjIiYmbi5pZD09PWUpO2kmJmkuc2V0VmFsdWUocyl9Z2V0TGV2ZWwodCl7cmV0dXJuIHRoaXMuZmFkZVN0YXJ0PT09dm9pZCAwPzA6dGhpcy5hY3RpdmU/UygodC10aGlzLmZhZGVTdGFydCkvdGhpcy5mYWRlVGltZSwwLC4zKTpTKCh0LXRoaXMuZmFkZVN0YXJ0KS90aGlzLmZhZGVUaW1lLHRoaXMuZmFkZUZyb20sMCl9ZmFkZUluKHQscyl7dGhpcy5mYWRlU3RhcnQ9dCx0aGlzLmZhZGVUaW1lPXN9ZmFkZU91dCh0LHMpe3RoaXMuZmFkZVRpbWU9cyx0aGlzLmZhZGVGcm9tPXRoaXMuZ2V0TGV2ZWwodCksdGhpcy5hY3RpdmU9ITEsdGhpcy5mYWRlU3RhcnQ9dH1pc0RvbmUodCl7cmV0dXJuIXRoaXMuYWN0aXZlJiZ0aGlzLmdldExldmVsKHQpPT09MH19Y2xhc3MgVHQgZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMucG9ydC5vbm1lc3NhZ2U9dGhpcy5vbm1lc3NhZ2UuYmluZCh0aGlzKSx0aGlzLmF1ZGlvR3JhcGg9bmV3IE90KDQ4ZTMsdGhpcy5wb3J0LnBvc3RNZXNzYWdlLmJpbmQodGhpcy5wb3J0KSl9b25tZXNzYWdlKHQpe2xldCBzPXQuZGF0YTt0aGlzLmF1ZGlvR3JhcGgucGFyc2VNc2cocyl9cHJvY2Vzcyh0LHMsZSl7Y29uc3QgaT1zWzBdLG49dFswXVswXSxyPWlbMF0sbD1pWzFdO2ZvcihsZXQgdT0wO3U8ci5sZW5ndGg7dSsrKXtsZXRbYyxiXT10aGlzLmF1ZGlvR3JhcGguZ2VuU2FtcGxlKG4/blt1XTowKTtyW3VdPWMsbFt1XT1ifXJldHVybiEwfX1yZWdpc3RlclByb2Nlc3Nvcigic2FtcGxlLWdlbmVyYXRvciIsVHQpfSkoKTsK",zh="data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2NsYXNzIG4gZXh0ZW5kcyBBdWRpb1dvcmtsZXRQcm9jZXNzb3J7c3RhdGljIGdldCBwYXJhbWV0ZXJEZXNjcmlwdG9ycygpe3JldHVyblt7bmFtZToiaXNSZWNvcmRpbmciLGRlZmF1bHRWYWx1ZTowfV19Y29uc3RydWN0b3IoKXtzdXBlcigpLHRoaXMuX2J1ZmZlclNpemU9MjA0OCx0aGlzLl9idWZmZXI9bmV3IEZsb2F0MzJBcnJheSh0aGlzLl9idWZmZXJTaXplKSx0aGlzLl9pbml0QnVmZmVyKCl9X2luaXRCdWZmZXIoKXt0aGlzLl9ieXRlc1dyaXR0ZW49MH1faXNCdWZmZXJFbXB0eSgpe3JldHVybiB0aGlzLl9ieXRlc1dyaXR0ZW49PT0wfV9pc0J1ZmZlckZ1bGwoKXtyZXR1cm4gdGhpcy5fYnl0ZXNXcml0dGVuPT09dGhpcy5fYnVmZmVyU2l6ZX1fYXBwZW5kVG9CdWZmZXIoZSl7dGhpcy5faXNCdWZmZXJGdWxsKCkmJnRoaXMuX2ZsdXNoKCksdGhpcy5fYnVmZmVyW3RoaXMuX2J5dGVzV3JpdHRlbl09ZSx0aGlzLl9ieXRlc1dyaXR0ZW4rPTF9X2ZsdXNoKCl7bGV0IGU9dGhpcy5fYnVmZmVyO3RoaXMuX2J5dGVzV3JpdHRlbjx0aGlzLl9idWZmZXJTaXplJiYoZT1lLnNsaWNlKDAsdGhpcy5fYnl0ZXNXcml0dGVuKSksdGhpcy5wb3J0LnBvc3RNZXNzYWdlKHtldmVudFR5cGU6ImRhdGEiLGF1ZGlvQnVmZmVyOmV9KSx0aGlzLl9pbml0QnVmZmVyKCl9X3JlY29yZGluZ1N0b3BwZWQoKXt0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe2V2ZW50VHlwZToic3RvcCJ9KX1wcm9jZXNzKGUsbyxoKXtjb25zdCBpPWguaXNSZWNvcmRpbmcsZj1vWzBdLHM9ZVswXSx1PWZbMF0sXz1mWzFdO2xldCByPSExO2ZvcihsZXQgdD0wO3Q8dS5sZW5ndGg7dCsrKXQ8aS5sZW5ndGgmJihyPWlbdF09PT0xKSwhciYmIXRoaXMuX2lzQnVmZmVyRW1wdHkoKSYmKHRoaXMuX2ZsdXNoKCksdGhpcy5fcmVjb3JkaW5nU3RvcHBlZCgpKSxyJiYodGhpcy5fYXBwZW5kVG9CdWZmZXIoc1swXVt0XSksdGhpcy5fYXBwZW5kVG9CdWZmZXIoc1sxXVt0XSkpLHVbdF09c1swXVt0XSxfW3RdPXNbMV1bdF07cmV0dXJuITB9fXJlZ2lzdGVyUHJvY2Vzc29yKCJyZWNvcmRlciIsbil9KSgpOwo=";function Mh(e,t,n){if(e.length<1)return;e[0];const s=3,i=32,a=e.map(x=>x.length).reduce((x,Z)=>x+Z,0),o=i/8,l=n*o,c=44,u=new ArrayBuffer(c+a*o),d=new DataView(u);$e(d,0,"RIFF"),d.setUint32(4,36+a*o,!0),$e(d,8,"WAVE"),$e(d,12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,s,!0),d.setUint16(22,n,!0),d.setUint32(24,t,!0),d.setUint32(28,t*l,!0),d.setUint16(32,l,!0),d.setUint16(34,i,!0),$e(d,36,"data"),d.setUint32(40,a*o,!0);let h=44;for(const x of e)Lh(d,h,x),h+=x.length*o;return u}function $e(e,t,n){for(let s=0;s<n.length;s++)e.setUint8(t+s,n.charCodeAt(s))}function Lh(e,t,n){for(var s=0;s<n.length;s++,t+=4)e.setFloat32(t,n[s],!0)}const on=Object.freeze(Object.defineProperty({__proto__:null,Node:M,compile:vt,evaluate:yn,exit:fn,exportModule:wh,getInletName:gh,getNode:mn,module:ee,n:te,node:Ze,nodeRegistry:J,outputType:ct,polyType:ue,register:U,registerNode:w},Symbol.toStringTag,{value:"Module"}));let Rh=e=>`Math.sin(${e})`,Sh=e=>`Math.cos(${e})`,Th=e=>`Math.tan(${e})`,Nh=e=>`Math.asin(${e})`,Wh=e=>`Math.acos(${e})`,Ch=e=>`Math.atan(${e})`,bn=(e,t,n)=>`${e} = ${t};${n?` /* ${n} */`:""}`,xt=(e,...t)=>bn(e.name,`nodes[${e.ugenIndex}].update(${t.join(",")})`,e.node.type),Vh=e=>`(2 ** ((${e} - 69) / 12) * 440)`,Hh=(e,t)=>`${e} ** ${t}`,Yh=e=>`Math.exp(${e})`,Ih=e=>`Math.log(${e})`,Kh=(e,t)=>`${e}%${t}`,Ph=e=>`Math.abs(${e})`,_h=e=>`Math.round(${e})`,Uh=e=>`Math.floor(${e})`,Bh=e=>`Math.sign(${e})`,jh=e=>`Math.ceil(${e})`,Jh=(e,t)=>`Math.min(${e}, ${t})`,$h=(e,t)=>`Math.max(${e}, ${t})`,Fh=(e,t)=>`[${e}, ${t}]`,We=e=>`${e}[0]`,Oh=e=>`${e}[1]`,Eh=(e,t)=>`(${We(e)} < ${We(t)} ? ${e} : ${t})`,Ah=(e,t)=>`(${We(e)} > ${We(t)} ? ${e} : ${t})`;const qh=Object.freeze(Object.defineProperty({__proto__:null,abs:Ph,ceil:jh,def:bn,defAcos:Wh,defAsin:Nh,defAtan:Ch,defCos:Sh,defSin:Rh,defTan:Th,defUgen:xt,exp:Yh,floor:Uh,log:Ih,max:$h,midinote:Vh,min:Jh,mod:Kh,pair_a:We,pair_a_max:Ah,pair_a_min:Eh,pair_b:Oh,pair_make:Fh,pow:Hh,round:_h,sign:Bh},Symbol.toStringTag,{value:"Module"}));class Qh{constructor(t=null){this.ugens=new Map,this.outputNode=t}async spawn(t,n){this.graph=t;const{src:s,ugens:i,registers:a}=t.compile({log:!1});!this.mouse&&s.includes("mouse")&&this.initMouse(),!this.midiInited&&i.some(o=>o.type.startsWith("Midi"))&&this.initMidi(),!this.audioIn&&i.some(o=>o.type==="AudioIn")&&await this.initAudioIn(),this.sendCustomUgens(),this.send({type:"SPAWN_UNIT",unit:{src:s,ugens:i,registers:a},duration:n})}registerUgen(t){this.ugens.set(t.name,t)}sendCustomUgens(){if(!this.ugens.size)return;let t=[];for(let[n,s]of this.ugens)t.push({type:"SET_UGEN",className:n,ugen:s+""});this.send({type:"BATCH_MSG",messages:t})}scheduleMessage(t,n){this.send({type:"SCHEDULE_MSG",msg:t,time:n})}setControl(t,n,s){const i={type:"SET_CONTROL",id:t,value:n};s?this.send({type:"SCHEDULE_MSG",time:s,msg:i}):this.send(i)}setControls(t){const n={type:"BATCH_MSG",messages:t.map(s=>{const i={type:"SET_CONTROL",id:s.id,value:s.value};return s.time===void 0?i:{type:"SCHEDULE_MSG",time:s.time,msg:i}})};this.send(n)}async initAudioIn(){console.log("init audio input...");const t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});this.audioCtx.createMediaStreamSource(t).connect(this.audioWorklet)}initMidi(){console.log("init midi input..."),this.midiInited=!0,new xh().on("midimessage",(t,n)=>{const s=Xh(n);s&&this.send(s)})}initMouse(){console.log("init mouse"),this.mouse=new Zh,this.mouse.on("move",(t,n)=>{this.setControl("mouseX",t),this.setControl("mouseY",n)})}send(t){rt(t instanceof Object),this.audioWorklet&&this.audioWorklet.port.postMessage(t)}async init(){var t;if(!this.audioCtx){if(rt(!this.audioCtx),this.audioCtx=((t=this.outputNode)==null?void 0:t.context)||new AudioContext({latencyHint:"interactive",sampleRate:48e3}),await this.audioCtx.resume(),!this.audioCtx.audioWorklet)throw new Error("Audio cannot be loaded: non-secure origin? (AudioContext.audioWorklet is undefined)");await this.audioCtx.audioWorklet.addModule(kh),await this.audioCtx.audioWorklet.addModule(zh),this.audioWorklet=new AudioWorkletNode(this.audioCtx,"sample-generator",{outputChannelCount:[2]}),this.audioWorklet.port.onmessage=n=>{const{id:s,time:i,type:a}=n.data;a==="SIGNAL_TRIGGER"?this.graph.dfs(o=>{if(o.type==="signal"&&o.id===s){const l=o.callback(i,s);isNaN(l)?l!==void 0&&console.warn(`expected number from "on" callback with id "${s}", got "${l}" instead.`):window.postMessage({type:"KABELSALAT_SET_CONTROL",value:l,id:s})}return o}):a==="STOP"?setTimeout(()=>this.destroy(),n.data.fadeTime*1e3+200):a==="SEND_SAMPLES"&&this.graph.dfs(o=>(o.type!=="scope"||o.ins.length<2||o.ins[1].value!==s||window.postMessage({type:"KABELSALAT_UPDATE_SCOPE",samples:n.data.samples,channels:n.data.channels,channel:n.data.channel,id:s}),o))},this.recorder=new window.AudioWorkletNode(this.audioCtx,"recorder"),this.audioWorklet.connect(this.recorder),this.sendCustomUgens(),this.recorder.connect(this.outputNode||this.audioCtx.destination),this.recorder.port.onmessage=n=>{if(n.data.eventType==="data"&&this.recordedBuffers.push(n.data.audioBuffer),n.data.eventType==="stop"){console.log("recording stopped");const s=Mh(this.recordedBuffers,this.audioCtx.sampleRate,2);Dh(s,"kabelsalat.wav","audio/wav"),this.recordedBuffers=[]}},this.recordOnPlay&&this.record()}}destroy(){var t,n,s;(t=this.audioWorklet)==null||t.disconnect(),this.audioWorklet=null,(n=this.recorder)==null||n.disconnect(),this.recorder=null,!this.outputNode&&((s=this.audioCtx)==null||s.close()),this.audioCtx=null}stop(){var t;this.audioCtx&&this.send({type:"STOP"}),(t=this.mouse)==null||t.detach()}record(){if(!this.audioCtx){this.recordOnPlay=!0;return}this.recordedBuffers=[],this.recorder.parameters.get("isRecording").setValueAtTime(1,0),console.log("recording started")}stopRecording(){this.recordOnPlay=!1,this.audioCtx&&this.recorder.parameters.get("isRecording").setValueAtTime(0,0)}set fadeTime(t){this.send({type:"FADE_TIME",fadeTime:t})}set maxUnits(t){this.send({type:"MAX_UNITS",maxUnits:t})}}function Dh(e,t,n){const s=new Blob([e],{type:n}),i=document.createElement("a");i.href=window.URL.createObjectURL(s),i.download=t,i.click()}let em=0;U("signal",(e,t)=>{const n=em++,s=getNode("signal",e,n);return s.callback=t,s.id=n,s},{ugen:"Signal",compile:({vars:[e,t],...n})=>xt(n,e,t,"time")});let tm=e=>`sin(${e})`,nm=e=>`cos(${e})`,sm=e=>`tan(${e})`,im=e=>`asin(${e})`,am=e=>`acos(${e})`,om=e=>`atan(${e})`,lt=(e,t,n)=>`${e} = ${t};${n?` /* ${n} */`:""}`,rm=(e,...t)=>{if(t.unshift(`nodes[${e.ugenIndex}]`),e.ugen==="Sequence"||e.ugen==="Pick"){const n=t.length-2,s=`(float[${n}]){${t.slice(2).join(",")}}`;return lt(e.name,`${e.ugen}_update(${t[0]}, ${t[1]}, ${n}, ${s})`,e.ugen)}return lt(e.name,`${e.ugen}_update(${t.join(",")})`,e.ugen)},cm=e=>`pow(2.0, ((${e} - 69.0) / 12.0)) * 440.0`,lm=(e,t)=>`pow(${e}, ${t})`,um=e=>`exp(${e})`,pm=e=>`log(${e})`,dm=(e,t)=>`${e}>=${t}?${e}-${t}:${e}`,hm=e=>`fabs(${e})`,mm=(e,t)=>`fmin(${e}, ${t})`,fm=(e,t)=>`fmax(${e}, ${t})`,ym=e=>`fround(${e})`,gm=e=>`floor(${e})`,bm=e=>`ceil(${e})`,wm=(e,t)=>`((pair) {${e}, ${t}})`,Ce=e=>`${e}.a`,Gm=e=>`${e}.b`,vm=(e,t)=>`(${Ce(e)} < ${Ce(t)} ? ${e} : ${t})`,xm=(e,t)=>`(${Ce(e)} > ${Ce(t)} ? ${e} : ${t})`;const Xm=Object.freeze(Object.defineProperty({__proto__:null,abs:hm,ceil:bm,def:lt,defAcos:am,defAsin:im,defAtan:om,defCos:nm,defSin:tm,defTan:sm,defUgen:rm,exp:um,floor:gm,log:pm,max:fm,midinote:cm,min:mm,mod:dm,pair_a:Ce,pair_a_max:xm,pair_a_min:vm,pair_b:Gm,pair_make:wm,pow:lm,round:ym},Symbol.toStringTag,{value:"Module"})),m={js:qh,c:Xm},wn=(e,t)=>w(e,{ugen:t,compile:({vars:n,...s})=>m[s.lang].defUgen(s,...n)});let Zm=U("time",e=>new M("time",e),{tags:["meta"],description:"Returns elapsed time in seconds",compile:({name:e,lang:t})=>m[t].def(e,"time")}),km=U("raw",(e,t)=>new M("raw",t).withIns(te(e)),{ins:[{name:"in"},{name:"code",description:"expression with variable `t` being the elapsed time and `$input` the input."}],tags:["meta"],description:"Raw code node, expects floats between -1 and 1",compile:({vars:e,node:t,name:n})=>`let $input = ${e[0]}; 
const ${n} = (${t.value}); // raw`,examples:[`sine(4).range(.5,1)
.raw("(time*110%1*2-1)*$input")
.out()`]}),zm=U("bytebeat",(e,t)=>new M("bytebeat",t).withIns(te(e)),{ins:[{name:"t",description:"time in samples"},{name:"code",description:"bytebeat code with variable `t`"}],tags:["meta"],description:"Bytebeat node, expects numbers from 0 to 255",examples:[`time().mul(8000).bytebeat\`
// Fractalized Past
// by: lhphr
// from: https://dollchan.net/btb/res/3.html#69

(t>>10^t>>11)%5*((t>>14&3^t>>15&1)+1)*t%99+((3+(t>>14&3)-(t>>16&1))/3*t%99&64)
\`.out()`],compile:({vars:e,node:t,name:n})=>`let t = ${e[0]}; 
const ${n} = ((${t.value}) & 255) / 127.5 - 1; // bytebeat`}),Mm=U("floatbeat",(e,t)=>new M("bytebeat",t).withIns(te(e)),{ins:[{name:"t",description:"time in samples"},{name:"code",description:"floatbeat code with variable `t`"}],tags:["meta"],description:"Raw code node, expects numbers from -1 to 1",compile:({vars:e,node:t,name:n})=>`let t = ${e[0]}; const ${n} = (${t.value}); // floatbeat`}),Lm=w("adsr",{ugen:"ADSRNode",tags:["envelope"],description:"ADSR envelope",examples:[`impulse(1).perc(.5)
.adsr(.01, .1, .5, .1)
.mul(sine(220)).out()`],ins:[{name:"gate",default:0,description:"gate input"},{name:"att",default:.02,description:"attack time"},{name:"dec",default:.1,description:"decay time"},{name:"sus",default:.2,description:"sustain level"},{name:"rel",default:.1,description:"release time"}],compile:({vars:[e=0,t=.02,n=.1,s=.2,i=.1],...a})=>m[a.lang].defUgen(a,"time",e,t,n,s,i)}),Rm=ee("ar",(e=0,t=.02,n=.1)=>e.adsr(t,0,1,n),{tags:["envelope"],description:"AR envelope",examples:["impulse(1).ad(.01, .1).mul(sine(220)).out()"],ins:[{name:"trig",default:0,description:"gate input"},{name:"att",default:.02,description:"attack time"},{name:"rel",default:.1,description:"release time"}]}),Sm=ee("ad",(e=0,t=.02,n=.1)=>e.adsr(t,n,0,n),{tags:["envelope"],description:"AD envelope",examples:["impulse(1).ad(.01, .1).mul(sine(220)).out()"],ins:[{name:"trig",default:0,description:"gate input"},{name:"att",default:.02,description:"attack time"},{name:"dec",default:.1,description:"decay time"}]}),Tm=w("clock",{ugen:"Clock",internal:!0,tags:["regular","clock"],description:"Clock source, with tempo in BPM",examples:["clock(120).clockdiv(16).mul(sine(220)).out()"],ins:[{name:"bpm",default:120,description:"clock tempo in bpm (beats per minute)"}],compile:({vars:[e=120],...t})=>m[t.lang].defUgen(t,e)}),Nm=w("clockdiv",{ugen:"ClockDiv",tags:["clock","trigger"],description:"Clock signal divider",examples:["impulse(8).clockdiv(2).ad(.1,.1).mul(sine(220)).out()"],ins:[{name:"clock",default:0,description:"clock input"},{name:"divisor",default:2,description:"tempo divisor"}],compile:({vars:[e=0,t=2],...n})=>m[n.lang].defUgen(n,e,t)}),Wm=w("distort",{ugen:"Distort",tags:["fx","distortion"],description:"Overdrive-style distortion",examples:[`sine(220)
.distort( saw(.5).range(0,1) )
.out()`],ins:[{name:"in",default:0},{name:"amt",default:0,description:"distortion amount"}],compile:({vars:[e=0,t=0],...n})=>m[n.lang].defUgen(n,e,t)}),Gn=w("noise",{ugen:"NoiseOsc",tags:["source","noise"],description:"White noise source",examples:["noise().mul(.25).out()"],ins:[{name:"next",default:1,description:"if 0, the noise will hold the previous value. defaults to 1."}],compile:({lang:e,vars:[t=1],...n})=>m[e].defUgen(n,t)}),Cm=w("lcgnoise",{ugen:"LcgNoise",tags:["source","noise"],description:"Lcg white noise source.",examples:["lcgnoise().mul(.25).out()"],ins:[{name:"next",default:1,description:"if 0, the noise will hold the previous value. defaults to 1."},{name:"reset",default:0,description:"if 1, the random number generator sequence will reset."}],compile:({lang:e,vars:[t=1,n=0],...s})=>m[e].defUgen(s,t,n)}),Vm=w("pink",{ugen:"PinkNoise",tags:["source","noise"],description:"Pink noise source",examples:["pink().mul(.5).out()"],ins:[],compile:({lang:e,...t})=>m[e].defUgen(t)}),Hm=w("brown",{ugen:"BrownNoiseOsc",tags:["source","noise"],description:"Brown noise source",examples:["brown().out()"],ins:[],compile:({lang:e,...t})=>m[e].defUgen(t)}),Ym=w("dust",{ugen:"DustOsc",tags:["trigger","noise","source"],description:"Generates random impulses from 0 to +1.",examples:["dust(200).out()"],ins:[{name:"density",default:0,description:"average impulses per second"}],compile:({vars:[e=0],...t})=>m[t.lang].defUgen(t,e)}),vn=w("impulse",{ugen:"ImpulseOsc",tags:["regular","trigger"],description:"Regular single sample impulses (0 - 1)",examples:["impulse(10).out()"],ins:[{name:"freq",default:0},{name:"phase",default:0}],compile:({vars:[e=0,t=0],...n})=>m[n.lang].defUgen(n,e,t)}),Im=w("saw",{ugen:"SawOsc",tags:["regular","waveform","source"],description:"Sawtooth wave oscillator with anti aliasing",examples:["saw(110).mul(.5).out()"],ins:[{name:"freq",default:0}],compile:({vars:[e=0],...t})=>m[t.lang].defUgen(t,e)}),Km=w("zaw",{ugen:"ZawOsc",tags:["regular","waveform","source"],description:"Sawtooth wave oscillator with sharp edges. Use saw for anti aliased variant.",examples:["zaw(110).mul(.5).out()"],ins:[{name:"freq",default:0}],compile:({vars:[e=0],...t})=>m[t.lang].defUgen(t,e)}),Pm=w("sine",{tags:["regular","waveform","source"],ugen:"SineOsc",description:"Sine wave oscillator",examples:["sine(220).out()"],ins:[{name:"freq",default:0},{name:"sync",default:0,description:"sync input"},{name:"phase",default:0,description:"phase offset"}],compile:({vars:[e=0,t=0,n=0],...s})=>m[s.lang].defUgen(s,e,t,n)}),_m=w("tri",{ugen:"TriOsc",tags:["regular","waveform","source"],description:"Triangle wave oscillator",examples:["tri(220).out()"],ins:[{name:"freq",default:0}],compile:({vars:[e=0],...t})=>m[t.lang].defUgen(t,e)}),Um=w("pulse",{ugen:"PulseOsc",tags:["regular","waveform","source"],description:"Pulse wave oscillator",examples:["pulse(220, sine(.1).range(.1,.5)).mul(.5).out()"],ins:[{name:"freq",default:0},{name:"pw",default:.5,description:"pulse width 0 - 1"}],compile:({vars:[e=0,t=.5],...n})=>m[n.lang].defUgen(n,e,t)}),Bm=w("slide",{ugen:"Slide",tags:["fx"],internal:!0,description:"Slide/portamento node",examples:[`impulse(2).seq(55,110,220,330)
.slide(4).sine().out()`],ins:[{name:"in",default:0},{name:"rate",default:1}],compile:({vars:[e=0,t=1],...n})=>m[n.lang].defUgen(n,e,t)}),jm=w("lag",{ugen:"Lag",tags:["fx"],description:"Smoothes a signal. Good for slide / portamento effects.",examples:[`impulse(2).seq(220,330,440,550)
.lag(.4).sine().out()`],ins:[{name:"in",default:0},{name:"rate",default:1,description:"60 dB lag time in seconds"}],compile:({vars:[e=0,t=1],...n})=>m[n.lang].defUgen(n,e,t)}),Jm=w("slew",{ugen:"Slew",tags:["fx"],description:"Limits the slope of an input signal. The slope is expressed in units per second.",examples:["pulse(800).slew(4000, 4000).out()"],ins:[{name:"in",default:0},{name:"up",default:1,description:"Maximum upward slope in units per second"},{name:"dn",default:1,description:"Maximum downward slope in units per second"}],compile:({vars:[e=0,t=1,n=1],...s})=>m[s.lang].defUgen(s,e,t,n)}),xn=w("filter",{ugen:"Filter",tags:["fx","filter"],internal:!0,description:"Two-pole low-pass filter",examples:["saw(55).lpf( sine(1).range(.4,.8) ).out()"],ins:[{name:"in",default:0},{name:"cutoff",default:1},{name:"reso",default:0}],compile:({vars:[e=0,t=1,n=0],...s})=>m[s.lang].defUgen(s,e,t,n)}),$m=w("fold",{ugen:"Fold",tags:["fx","distortion","limiter"],description:'Distort incoming audio signal by "folding"',examples:[`sine(55)
.fold( sine(.5).range(0.2,4) )
.out()`],ins:[{name:"in",default:0},{name:"rate",default:0}],compile:({vars:[e=0,t=0],...n})=>m[n.lang].defUgen(n,e,t)}),Fm=w("seq",{ugen:"Sequence",tags:["sequencer"],description:"Trigger controlled sequencer",examples:[`impulse(2).seq(220,330,440,550)
.sine().out()`],ins:[{name:"trig",default:0},{name:"step",default:0,dynamic:!0,description:"step inputs"}],compile:({vars:e,...t})=>m[t.lang].defUgen(t,...e)}),Om=w("delay",{ugen:"Delay",tags:["fx"],description:"Delay line node",examples:[`impulse(1).ad(.01,.2).mul(sine(220))
.add(x=>x.delay(.1).mul(.8)).out()`],ins:[{name:"in",default:0},{name:"time",default:0}],compile:({vars:[e=0,t=0],...n})=>m[n.lang].defUgen(n,e,t)}),Em=w("hold",{ugen:"Hold",tags:["fx"],description:"Sample and hold",examples:[`noise().hold(impulse(2))
.range(220,880).sine().out()`],ins:[{name:"in",default:0},{name:"trig",default:0}],compile:({vars:[e=0,t=0],...n})=>m[n.lang].defUgen(n,e,t)}),Am=w("midifreq",{ugen:"MidiFreq",tags:["external","midi"],description:"Outputs frequency of midi note in. Multiple instances will do voice allocation",examples:["midifreq().sine().out()"],ins:[{name:"channel",default:-1,description:"Channel filter. Defaults to all channels"}],compile:({vars:[e=-1],...t})=>m[t.lang].defUgen(t,e)}),qm=w("midigate",{ugen:"MidiGate",tags:["external","midi"],description:"outputs gate of midi note in. Multiple instances will do voice allocation",examples:["midigate().lag(1).mul(sine(220)).out()"],ins:[{name:"channel",default:-1}],compile:({vars:[e=-1],...t})=>m[t.lang].defUgen(t,e)}),Qm=w("midivel",{ugen:"MidiVel",tags:["external","midi"],description:"outputs velocity of midi note in. Multiple instances will do voice allocation",examples:["midigate().ar(0.01,0.2).mul(saw(midifreq())).mul(midivel()).mul(.8).out()"],ins:[{name:"channel",default:-1}],compile:({vars:[e=-1],...t})=>m[t.lang].defUgen(t,e)}),Dm=w("midicc",{ugen:"MidiCC",tags:["external","midi"],description:"Outputs bipolar value of given midi cc number. initValue can be set to be the output before getting first cc message.",examples:["midicc(74).range(100,200).sine().out()"],ins:[{name:"ccnumber",default:-1},{name:"channel",default:-1},{name:"initValue",default:-1}],compile:({vars:[e=-1,t=-1],...n})=>m[n.lang].defUgen(n,e,t)}),Xt=w("cc",{ugen:"CC",tags:["external"],description:"CC control",ins:[{name:"id",default:0},{name:"value",default:0}],compile:({vars:[e],...t})=>m[t.lang].defUgen(t,e)}),ef=w("audioin",{ugen:"AudioIn",tags:["source","external"],description:"External Audio Input, depends on your system input",examples:["audioin().add(x=>x.delay(.1).mul(.8)).out()"],ins:[],compile:e=>m[e.lang].defUgen(e,"input")}),ut=w("log",{tags:["math"],description:"calculates the logarithm (base 10) of the input signal",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].log(e))}),Xn=w("exp",{tags:["math"],description:"raises e to the power of the input signal",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].exp(e))}),tf=w("pow",{tags:["math"],description:"raises the input to the given power",ins:[{name:"in"},{name:"power"}],compile:({vars:[e=0,t=1],name:n,lang:s})=>m[s].def(n,m[s].pow(e,t))}),Zn=w("sin",{tags:["math"],description:"calculates the sine of the input signal",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].defSin(e))}),kn=w("cos",{tags:["math"],description:"calculates the cosine of the input signal",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].defCos(e))}),nf=w("tan",{tags:["math"],description:"calculates the tan of the input signal",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].defTan(e))}),sf=w("acos",{tags:["math"],description:"calculates the acos of the input signal",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].defAcos(e))}),af=w("asin",{tags:["math"],description:"calculates the asin of the input signal",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].defAsin(e))}),of=w("atan",{tags:["math"],description:"calculates the atan of the input signal",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].defAtan(e))}),rf=w("mul",{tags:["math"],description:"Multiplies the given signals.",examples:["sine(220).mul( sine(4).range(.25,1) ).out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,e.join(" * ")||0)}),Zt=w("add",{tags:["math"],description:"sums the given signals",examples:["n([0,3,7,10]).add(60).midinote().sine().mix(2).out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,e.join(" + ")||0)}),cf=w("div",{tags:["math"],description:"adds the given signals",ins:[{name:"in",dynamic:!0}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,e.join(" / ")||0)}),lf=w("sub",{tags:["math"],description:"subtracts the given signals",ins:[{name:"in",dynamic:!0}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,e.join(" - ")||0)}),uf=w("mod",{tags:["math"],description:"calculates the modulo",examples:["add(x=>x.add(.003).mod(1)).out()"],ins:[{name:"in"},{name:"modulo"}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,m[n].mod(...e)||0)}),pf=w("abs",{tags:["math"],description:"returns the absolute value of the signal",ins:[{name:"in"}],examples:["sine(440).abs().out()"],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].abs(e))}),df=w("round",{tags:["math"],description:"Rounds the signal to the nearest integer",ins:[{name:"in"}],examples:["sine(440.5).round().out()"],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].round(e))}),hf=w("clamp",{tags:["math"],description:"Clamps the signal to stay within the given range",ins:[{name:"in"},{name:"min"},{name:"max"}],examples:["sine(440.5).clamp(-.6,.6).out()"],compile:({vars:[e=0,t=-1,n=1],name:s,lang:i})=>{const a=m[i].min(t,n),o=m[i].max(t,n),l=m[i].min(m[i].max(e,a),o);return m[i].def(s,l)}}),mf=w("floor",{tags:["math"],description:"Rounds the signal down",ins:[{name:"in"}],examples:["sine(440.5).floor().out()"],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].floor(e))}),ff=w("ceil",{tags:["math"],description:"Rounds the signal up",ins:[{name:"in"}],examples:["sine(440.5).ceil().out()"],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].ceil(e))}),yf=w("sign",{tags:["math"],description:"Returns 1 if positive and -1 if negative. uses Math.sign",ins:[{name:"in"}],examples:["sine(440.5).ceil().out()"],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,m[n].sign(e))}),gf=w("min",{tags:["math"],description:"returns the minimum of the given signals",examples:["impulse(4).apply(x => min(x.seq(0,3,2), x.seq(0,7,0,5,0)).add(48).midinote().sine()).out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,e.reduce(m[n].min)||0)}),bf=w("max",{tags:["math"],description:"returns the maximum of the given signals",examples:["impulse(4).apply(x => max(x.seq(0,3,2), x.seq(0,7,0,5,0)).add(48).midinote().sine()).out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,e.reduce(m[n].max)||0)}),wf=w("argmin",{tags:["math"],description:"returns the index of the minimum of the given signals",examples:["argmin(saw(1), saw(3), saw(5)).mul(12).add(48).midinote().sine().out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,m[n].pair_b(e.map(m[n].pair_make).reduce(m[n].pair_a_min))||0)}),Gf=w("argmax",{tags:["math"],description:"returns the index of the maximum of the given signals",examples:["argmax(saw(1), saw(3), saw(5)).mul(12).add(48).midinote().sine().out()"],ins:[{name:"in",dynamic:!0}],compile:({vars:e,name:t,lang:n})=>m[n].def(t,m[n].pair_b(e.map(m[n].pair_make).reduce(m[n].pair_a_max))||0)}),zn=w("greater",{tags:["logic"],description:"returns 1 if input is greater then threshold",ins:[{name:"in"},{name:"threshold"}],examples:[`greater(sine(1),0)
.bipolar().range(100,200)
.sine().out()`],compile:({vars:[e=0,t=0],name:n,lang:s})=>m[s].def(n,`${e} > ${t}`)}),Mn=w("lower",{tags:["logic"],description:"returns 1 if input is lower then threshold",ins:[{name:"in"},{name:"threshold"}],examples:[`lower(sine(1),0)
.bipolar().range(100,200)
.sine().out()`],compile:({vars:[e=0,t=0],name:n,lang:s})=>m[s].def(n,`${e} < ${t}`)}),vf=zn,xf=Mn,Xf=w("xor",{tags:["logic"],description:"returns 1 if exactly one of the inputs is 1",ins:[{name:"a"},{name:"b"}],compile:({vars:[e=0,t=0],name:n,lang:s})=>m[s].def(n,`${e} != ${t} ? 1 : 0`)}),Zf=w("and",{tags:["logic"],description:"returns 1 if both inputs are 1",ins:[{name:"a"},{name:"b"}],compile:({vars:[e=0,t=0],name:n,lang:s})=>m[s].def(n,`${e} && ${t} ? 1 : 0`)}),kf=w("or",{tags:["logic"],description:"returns 1 if one or both inputs are 1",ins:[{name:"a"},{name:"b"}],compile:({vars:[e=0,t=0],name:n,lang:s})=>m[s].def(n,`${e} || ${t} ? 1 : 0`)}),zf=w("not",{tags:["logic"],description:"returns 1 if input is 0, otherwise 0",ins:[{name:"in"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,`(${e} === 0 ? 1 : 0)`)}),Mf=w("bool",{tags:["logic"],description:"returns 1 signal is non zero. inspired by genish",ins:[{name:"a"}],compile:({vars:[e=0],name:t,lang:n})=>m[n].def(t,`(${e} === 0 ? 0 : 1)`)}),Lf=w("ifelse",{tags:["logic"],description:"if control is 1, a is returned, otherwise b",ins:[{name:"control"},{name:"a"},{name:"b"}],compile:({vars:[e=0,t=0,n=0],name:s,lang:i})=>m[i].def(s,`(${e} === 1 ? ${t} : ${n})`),examples:["ifelse(pulse(1), sine(220), sine(330)).out()"]}),Rf=w("range",{tags:["math"],description:"Scales the incoming bipolar value to the given range.",examples:["sine(.5).range(.25,1).mul(sine(440)).out()"],ins:[{name:"in"},{name:"min"},{name:"max"}],compile:({vars:e,name:t,lang:n})=>{const[s,i,a,o=1]=e,l=`((${s} + 1) * 0.5)`,c=o===1?l:m[n].pow(l,o);return m[n].def(t,`${c} * (${a} - ${i}) + ${i}`)}}),Sf=w("remap",{ugen:"Remap",tags:["math"],description:"Remaps input from one value range to another",ins:[{name:"in"},{name:"inmin"},{name:"inmax"},{name:"outmin"},{name:"outmax"}],compile:({vars:[e=0,t=-1,n=1,s=-1,i=1],...a})=>m[a.lang].defUgen(a,e,t,n,s,i)}),Tf=w("thru",{compile:({name:e,vars:t,lang:n})=>m[n].def(e,t[0],"thru")}),Nf=ee("rangex",(e,t,n)=>{let s=ut(t),i=ut(n).sub(s),a=e.unipolar().mul(i).add(s);return Xn(a)},{tags:["math"],description:"exponential range",ins:[{name:"in"},{name:"min"},{name:"max"}],examples:["sine([1,3]).rangex(100, 2e3).sine().out()"]}),Wf=w("midinote",{compile:({vars:[e],name:t,lang:n})=>m[n].def(t,m[n].midinote(e)),tags:["math"],description:"convert midi number to frequency",ins:[{name:"midi"}],examples:[`impulse(4).seq(0,3,7,12).add(60)
.midinote().sine().out()`]}),Cf=w("src",{internal:!0,compile:({vars:[e=0],name:t,lang:n,...s})=>m[n].def(t,s.getSource(e),`read source ${e}`)}),Vf=w("output",{internal:!0,ugen:"Output",compile:({vars:[e,t=0],name:n,lang:s,...i})=>{const a=i.getOutput(t),o=i.getSource(t);return[m[s].def(a,[a,e].join(" + "),`+ output ${t}`),m[s].def(o,a,`write source ${t}`)].join(`
`)}}),Ln=w("poly"),Rn=te(Math.PI),Hf=U("fork",(e,t=1)=>Ln(...Array.from({length:t},()=>e.clone())),{ins:[{name:"in"},{name:"times"}],tags:["multi-channel"],description:"split the signal into n channels",examples:["dust(4).fork(2).adsr(.1).mul(sine(220)).out()"]}),Yf=ee("perc",(e,t)=>e.adsr(0,0,1,t),{tags:["envelope"],description:"percussive envelope. usable with triggers or gates",ins:[{name:"gate"},{name:"release"}],examples:["impulse(4).perc(.1).mul( pink() ).out()"]}),If=ee("hpf",(e,t,n=0)=>e.sub(e.lpf(t,n)),{ins:[{name:"in"},{name:"cutoff"},{name:"reso"}],description:"high pass filter",tags:["fx","filter"],examples:["tri([220,331,442]).mix().hpf(sine(.5).range(0,.9)).out()"]}),Kf=ee("lpf",xn,{ins:[{name:"in"},{name:"cutoff"},{name:"reso"}],description:"low pass filter",tags:["fx","filter"],examples:["saw(55).lpf( sine(1).range(.4,.8) ).out()"]}),Pf=w("bpf",{ugen:"BPF",ins:[{name:"in"},{name:"cutoff"},{name:"reso"}],description:"high pass filter",tags:["fx","filter"],compile:({vars:[e=0,t=1,n=0],...s})=>m[s.lang].defUgen(s,e,t,n)}),_f=ee("lfnoise",e=>Gn().hold(vn(e)),{ins:[{name:"freq"}],description:"low frequency stepped noise.",tags:["regular","noise"],examples:["lfnoise(4).range(200,800).sine().out()"]}),Uf=ee("bipolar",e=>te(e).mul(2).sub(1),{ins:[{name:"in"}],description:"convert unipolar [0,1] signal to bipolar [-1,1]",tags:["math"]}),Bf=ee("unipolar",e=>te(e).add(1).div(2),{ins:[{name:"in"}],description:"convert bipolar [-1,1] signal to unipolar [0,1]",tags:["math"]}),jf=ee("pan",(e,t)=>(t=te(t).add(1).mul(Rn,.25),e.mul([kn(t),Zn(t)])),{ins:[{name:"in"},{name:"pos",description:"bipolar position: -1 = left, 0 = center, 1 = right"}],description:"pans signal to stereo position. splits signal path in 2",tags:["multi-channel"],examples:["sine(220).pan(sine(.25)).out()"]}),Jf=w("pick",{tags:["multi-channel"],ugen:"Pick",description:"Pick",ins:[{name:"index"},{name:"inputs",dynamic:!0}],description:"picks input of given index",examples:[`sine(.25).range(0,2).round()
.pick(...sine([220,330,440]).ins)
.out()`],compile:({vars:e,...t})=>m[t.lang].defUgen(t,...e)}),$f=w("clip",{tags:["fx"],ugen:"Clip",description:"Hard limits the signal between lo and hi.",ins:[{name:"input"},{name:"lo"},{name:"hi"}],compile:({vars:[e=0,t=-1,n=1],...s})=>m[s.lang].defUgen(s,e,t,n)}),Ff=w("trig",{tags:["trigger"],ugen:"Trig",description:"Emits a trigger impulse whenever the signal becomes positive. Useful to turn gates into triggers.",ins:[{name:"input",default:0},{name:"lo",default:-1},{name:"hi",default:1}],compile:({vars:[e=0,t=-1,n=1],...s})=>m[s.lang].defUgen(s,e,t,n),examples:[`pulse(2)
.trig() // comment out to hear difference
.ar(.01,.2)
.mul(sine(200)).out()`]}),Of=w("qf",{tags:["fx","filter"],ugen:"BiquadFilter",description:"biQuad Filter.",ins:[{name:"input",default:0},{name:"type",default:0,description:"filter type: 0 = lowpass, 1 = highpass, 2 = band pass, 3 = notch, 4 = allpass, 5 = peaking, 6 = lowshelf, 7 = highshelf"},{name:"freq",default:500,description:"filter cutoff in Hz"},{name:"q",default:1,description:"q factor"},{name:"gain",default:1}],compile:({vars:e,...t})=>m[t.lang].defUgen(t,...e),examples:[`pink()
.qf(
 impulse(.5).seq(0,1,2,3,4,5,6,7), // type
  tri(0.5).rangex(100, 8000),  // freq
 10, // Q
 1, // gain (only relevant for types 5-7)
).div(4).out();`]}),Ef=U("qlpf",(e,t,n=10)=>e.qf(0,t,n),{description:"biQuad Low Pass Filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`pink().qlpf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),Af=U("qhpf",(e,t,n=10)=>e.qf(1,t,n),{description:"biQuad High pass filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`pink().qhpf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),qf=U("qbpf",(e,t,n=10)=>e.qf(2,t,n),{description:"biQuad Band Pass Filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`pink().qbpf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),Qf=U("qnf",(e,t,n=10)=>e.qf(3,t,n),{description:"biQuad Notch Filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`pink().qnf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),Df=U("qapf",(e,t,n=10)=>e.qf(3,t,n),{description:"biQuad All Pass Filter",ins:[{name:"input"},{name:"freq"},{name:"q",description:"resonance"}],tags:["fx","filter"],examples:[`impulse(1).qapf(
  tri(0.5).rangex(100, 8000), // cutoff freq
  10 // Q
).out()`]}),ey=U("split",(e,t)=>e.type!=="poly"?t([e]):t(e.ins),{ins:[{name:"input"},{name:"fn"}],tags:["multi-channel"],description:"apply fn to an array of signals, one for each channel in input",examples:["sine([220,330,550]).split(chs => add(...chs)).out()"]}),ty=U("mix",(e,t=1)=>{if([1,2].includes(t)||(t=2,console.warn("mix only supports 1 or 2 channels atm.. falling back to 2")),e.type!=="poly")return e;if(t===2){const n=e.ins.map((s,i,a)=>{const o=(i/(a.length-1)*2-1+1)*Math.PI/4;return s.mul([Math.cos(o),Math.sin(o)]).inherit(e)});return Zt(...n)}return e.ins=e.ins.map(n=>n.inherit(e)),Ze("mix").withIns(...e.ins)},{compile:({vars:e,name:t,lang:n})=>m[n].def(t,`(${e.join(" + ")})`),description:`mixes down multiple channels. Useful to make sure you get a mono or stereo signal out at the end. 
When mixing down to 2 channels, the input channels are equally distributed over the stereo image, e.g. 3 channels are panned [-1,0,1]`,ins:[{name:"in"},{name:"channels",default:1,description:"how many channels to mix down to. Only supports 1 and 2"}],tags:["multi-channel"],examples:["sine([220,330,440]).mix(2).out()"]});M.prototype.feedback=function(e){return this.add(e)};let ny=e=>Zt(e),sy=te,iy=te,ay=ee("mouseX",()=>Xt("mouseX"),{ins:[],description:"X position of mouse, bipolar range",tags:["external"],examples:["mouseX.range(100,800).sine().out()"]}),oy=ay(),ry=ee("mouseY",()=>Xt("mouseY"),{ins:[],description:"Y position of mouse, bipolar range",tags:["external"],examples:["mouseY.range(800,100).sine().out()"]}),cy=ry(),ly=U("scope",(e,t)=>{let n=1;e.type==="poly"&&(n=e.ins.length);const s=getNode("scope",e,t,n);return s.type!=="poly"?(s.ins.push({type:"n",value:0,ins:[]}),s):(s.ins.forEach((i,a)=>i.ins.push({type:"n",value:a,ins:[]})),s)},{ugen:"Scope",description:"renders an an oscilloscope of the current point in the graph. expects values between -1 and 1. warning: this feature is still experimental! when using it, make sure to not switch tabs, as it might fry your browser.",compile:({vars:[e,t,n,s],...i})=>xt(i,e,t,n,s)});const rn=Object.freeze(Object.defineProperty({__proto__:null,B:sy,PI:Rn,_:iy,abs:pf,acos:sf,ad:Sm,add:Zt,adsr:Lm,and:Zf,ar:Rm,argmax:Gf,argmin:wf,asin:af,atan:of,audioin:ef,bipolar:Uf,bool:Mf,bpf:Pf,brown:Hm,bytebeat:zm,cc:Xt,ceil:ff,clamp:hf,clip:$f,clock:Tm,clockdiv:Nm,cos:kn,delay:Om,distort:Wm,div:cf,dust:Ym,exp:Xn,feedback:ny,filter:xn,floatbeat:Mm,floor:mf,fold:$m,fork:Hf,greater:zn,gt:vf,hold:Em,hpf:If,ifelse:Lf,impulse:vn,lag:jm,lfnoise:_f,log:ut,lower:Mn,lpf:Kf,lt:xf,max:bf,midicc:Dm,midifreq:Am,midigate:qm,midinote:Wf,midivel:Qm,min:gf,mix:ty,mod:uf,mouseX:oy,mouseY:cy,mul:rf,noise:Gn,not:zf,or:kf,output:Vf,pan:jf,perc:Yf,pick:Jf,pink:Vm,poly:Ln,pow:tf,pulse:Um,qapf:Df,qbpf:qf,qf:Of,qhpf:Af,qlpf:Ef,qnf:Qf,range:Rf,rangex:Nf,raw:km,registerUgen:wn,remap:Sf,rng:Cm,round:df,saw:Im,scope:ly,seq:Fm,sign:yf,sin:Zn,sine:Pm,slew:Jm,slide:Bm,split:ey,src:Cf,sub:lf,tan:nf,thru:Tf,time:Zm,tri:_m,trig:Ff,unipolar:Bf,xor:Xf,zaw:Km},Symbol.toStringTag,{value:"Module"}));let uy=class{constructor({onToggle:t,onToggleRecording:n,beforeEval:s,transpiler:i,localScope:a=!1,outputNode:o=null}={}){this.outputNode=o,this.audio=new Qh(this.outputNode),this.onToggle=t,this.transpiler=i,this.onToggleRecording=n,this.beforeEval=s,this.localScope=a,typeof window<"u"&&(a||(Object.assign(globalThis,on),Object.assign(globalThis,rn),Object.assign(globalThis,an),Object.assign(globalThis,{repl:this})),window.addEventListener("message",c=>{c.data.type==="KABELSALAT_SET_CONTROL"&&this.audio.setControl(c.data.id,c.data.value)}));const l=this;M.prototype.spawn=function(c=[0,1],u){l.audio.spawn(this.output(c).exit(),u)}}registerUgen(t,n){return this.audio.registerUgen(n),wn(t,n.name)}evaluate(t){var i;this.localScope||(Object.assign(globalThis,{audio:this.audio}),Object.assign(globalThis,{addUgen:this.registerUgen.bind(this)}));let n;this.transpiler?n=this.transpiler(t):n={output:t},(i=this.beforeEval)==null||i.call(this,n);let s;return this.localScope&&(s={...on,...rn,...an,audio:this.audio,addUgen:this.registerUgen.bind(this),repl:this}),yn(n.output,s)}async play(t){var n;await this.audio.init(),t.ins.length&&this.audio.spawn(t),(n=this.onToggle)==null||n.call(this,!0)}run(t){const n=this.evaluate(t);this.play(n)}stop(){var t;this.stopRecording(),this.audio.stop(),(t=this.onToggle)==null||t.call(this,!1)}record(){var t;this.audio.record(),(t=this.onToggleRecording)==null||t.call(this,!0)}stopRecording(){var t;this.audio.stopRecording(),(t=this.onToggleRecording)==null||t.call(this,!1)}};const kt="strudel.log";let py=1e3,cn,ln;function Ee(e,t="cyclist"){$(`[${t}] error: ${e.message}`)}function $(e,t,n={}){let s=performance.now();cn===e&&s-ln<py||(cn=e,ln=s,console.log(`%c${e}`,"background-color: black;color:white;border-radius:15px"),typeof document<"u"&&typeof CustomEvent<"u"&&document.dispatchEvent(new CustomEvent(kt,{detail:{message:e,type:t,data:n}})))}$.key=kt;const dy=e=>/^[a-gA-G][#bsf]*[0-9]*$/.test(e),Ae=e=>/^[a-gA-G][#bsf]*-?[0-9]*$/.test(e),Sn=e=>{var i;if(typeof e!="string")return[];const[t,n="",s]=((i=e.match(/^([a-gA-G])([#bsf]*)(-?[0-9]*)$/))==null?void 0:i.slice(1))||[];return t?[t,n,s?Number(s):void 0]:[]},hy={c:0,d:2,e:4,f:5,g:7,a:9,b:11},my={"#":1,b:-1,s:1,f:-1},Tn=e=>(e==null?void 0:e.split("").reduce((t,n)=>t+my[n],0))||0,Ke=(e,t=3)=>{const[n,s,i=t]=Sn(e);if(!n)throw new Error('not a note: "'+e+'"');const a=hy[n.toLowerCase()],o=Tn(s);return(Number(i)+1)*12+a+o},Ve=e=>Math.pow(2,(e-69)/12)*440,Nn=e=>12*Math.log(e/440)/Math.LN2+69,fy=(e,t)=>{if(typeof e!="object")throw new Error("valueToMidi: expected object value");let{freq:n,note:s}=e;if(typeof n=="number")return Nn(n);if(typeof s=="string")return Ke(s);if(typeof s=="number")return s;if(!t)throw new Error("valueToMidi: expected freq or note to be set");return t},yy=(e,t)=>(e-t)*1e3,Wn=e=>Ve(typeof e=="number"?e:Ke(e)),gy=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],by=e=>{const t=Math.floor(e/12)-1;return gy[e%12]+t},Pe=(e,t)=>(e%t+t)%t,Cn=e=>e.reduce((t,n)=>t+n)/e.length;function Vn(e,t=0){return isNaN(Number(e))?($(`"${e}" is not a number, falling back to ${t}`,"warning"),t):e}const wy=(e,t)=>Pe(Math.round(Vn(e??0,0)),t),Gy=e=>{let{value:t,context:n}=e,s=t;if(typeof s=="object"&&!Array.isArray(s)&&(s=s.note||s.n||s.value,s===void 0))throw new Error(`cannot find a playable note for ${JSON.stringify(t)}`);if(typeof s=="number"&&n.type!=="frequency")s=Ve(e.value);else if(typeof s=="number"&&n.type==="frequency")s=e.value;else if(typeof s!="string"||!Ae(s))throw new Error("not a note: "+JSON.stringify(s));return s},vy=e=>{let{value:t,context:n}=e;if(typeof t=="object")return t.freq?t.freq:Wn(t.note||t.n||t.value);if(typeof t=="number"&&n.type!=="frequency")t=Ve(e.value);else if(typeof t=="string"&&Ae(t))t=Ve(Ke(e.value));else if(typeof t!="number")throw new Error("not a note or frequency: "+t);return t},Hn=(e,t)=>e.slice(t).concat(e.slice(0,t)),Yn=(...e)=>e.reduce((t,n)=>(...s)=>t(n(...s)),t=>t),xy=(...e)=>Yn(...e.reverse()),ze=e=>e.filter(t=>t!=null),re=e=>[].concat(...e),xe=e=>e,Xy=(e,t)=>e,_e=(e,t)=>Array.from({length:t-e+1},(n,s)=>s+e);function X(e,t,n=e.length){const s=function i(...a){if(a.length>=n)return e.apply(this,a);{const o=function(...l){return i.apply(this,a.concat(l))};return t&&t(o,a),o}};return t&&t(s,[]),s}function zt(e){const t=Number(e);if(!isNaN(t))return t;if(Ae(e))return Ke(e);throw new Error(`cannot parse as numeral: "${e}"`)}function Mt(e,t){return(...n)=>e(...n.map(t))}function q(e){return Mt(e,zt)}function In(e){const t=Number(e);if(!isNaN(t))return t;const n={pi:Math.PI,w:1,h:.5,q:.25,e:.125,s:.0625,t:1/3,f:.2,x:1/6}[e];if(typeof n<"u")return n;throw new Error(`cannot parse as fractional: "${e}"`)}const Zy=e=>Mt(e,In),Lt=function(e,t){return[t.slice(0,e),t.slice(e)]},qe=(e,t,n)=>t.map((s,i)=>e(s,n[i])),Kn=function(e){const t=[];for(let n=0;n<e.length-1;++n)t.push([e[n],e[n+1]]);return t},Pn=(e,t,n)=>Math.min(Math.max(e,t),n),ky=["Do","Reb","Re","Mib","Mi","Fa","Solb","Sol","Lab","La","Sib","Si"],zy=["Sa","Re","Ga","Ma","Pa","Dha","Ni"],My=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Hb","H"],Ly=["Ni","Pab","Pa","Voub","Vou","Ga","Dib","Di","Keb","Ke","Zob","Zo"],Ry=["I","Ro","Ha","Ni","Ho","He","To"],Sy=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ty=(e,t="letters")=>{const n=(t==="solfeggio"?ky:t==="indian"?zy:t==="german"?My:t==="byzantine"?Ly:t==="japanese"?Ry:Sy)[e%12],s=Math.floor(e/12)-1;return n+s};function Ny(e){var t={};return e.filter(function(n){return t.hasOwn(n)?!1:t[n]=!0})}function Wy(e){return e.sort().filter(function(t,n,s){return!n||t!=s[n-1]})}function _n(e){return e.sort((t,n)=>t.compare(n)).filter(function(t,n,s){return!n||t.ne(s[n-1])})}function Un(e){const t=new TextEncoder().encode(e);return btoa(String.fromCharCode(...t))}function Bn(e){const t=new Uint8Array(atob(e).split("").map(n=>n.charCodeAt(0)));return new TextDecoder().decode(t)}function Cy(e){return encodeURIComponent(Un(e))}function Vy(e){return Bn(decodeURIComponent(e))}function jn(e,t){return Array.isArray(e)?e.map(t):Object.fromEntries(Object.entries(e).map(([n,s],i)=>[n,t(s,n,i)]))}function pt(e,t){return e/t}class Jn{constructor({getTargetClockTime:t=Yy,weight:n=16,offsetDelta:s=.005,checkAfterTime:i=2,resetAfterTime:a=8}){this.offsetTime,this.timeAtPrevOffsetSample,this.prevOffsetTimes=[],this.getTargetClockTime=t,this.weight=n,this.offsetDelta=s,this.checkAfterTime=i,this.resetAfterTime=a,this.reset=()=>{this.prevOffsetTimes=[],this.offsetTime=null,this.timeAtPrevOffsetSample=null}}calculateOffset(t){const n=this.getTargetClockTime(),s=n-this.timeAtPrevOffsetSample,i=n-t;if(s>this.resetAfterTime&&this.reset(),this.offsetTime==null&&(this.offsetTime=i),this.prevOffsetTimes.push(i),this.prevOffsetTimes.length>this.weight&&this.prevOffsetTimes.shift(),this.timeAtPrevOffsetSample==null||s>this.checkAfterTime){this.timeAtPrevOffsetSample=n;const a=Cn(this.prevOffsetTimes);Math.abs(a-this.offsetTime)>this.offsetDelta&&(this.offsetTime=a)}return this.offsetTime}calculateTimestamp(t,n){return this.calculateOffset(t)+n}}function Hy(){return performance.now()*.001}function Yy(){return Date.now()*.001}const $n=new Map([["control","Control"],["ctrl","Control"],["alt","Alt"],["shift","Shift"],["down","ArrowDown"],["up","ArrowUp"],["left","ArrowLeft"],["right","ArrowRight"]]);let Se;function Fn(){if(Se==null){if(typeof window>"u")return;Se={},window.addEventListener("keydown",e=>{Se[e.key]=!0}),window.addEventListener("keyup",e=>{Se[e.key]=!1})}return{...Se}}function Rt(e,t=!1){return typeof e=="object"?t?JSON.stringify(e).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(e):e}R.prototype.sam=function(){return this.floor()};R.prototype.nextSam=function(){return this.sam().add(1)};R.prototype.wholeCycle=function(){return new H(this.sam(),this.nextSam())};R.prototype.cyclePos=function(){return this.sub(this.sam())};R.prototype.lt=function(e){return this.compare(e)<0};R.prototype.gt=function(e){return this.compare(e)>0};R.prototype.lte=function(e){return this.compare(e)<=0};R.prototype.gte=function(e){return this.compare(e)>=0};R.prototype.eq=function(e){return this.compare(e)==0};R.prototype.ne=function(e){return this.compare(e)!=0};R.prototype.max=function(e){return this.gt(e)?this:e};R.prototype.maximum=function(...e){return e=e.map(t=>new R(t)),e.reduce((t,n)=>n.max(t),this)};R.prototype.min=function(e){return this.lt(e)?this:e};R.prototype.mulmaybe=function(e){return e!==void 0?this.mul(e):void 0};R.prototype.divmaybe=function(e){return e!==void 0?this.div(e):void 0};R.prototype.addmaybe=function(e){return e!==void 0?this.add(e):void 0};R.prototype.submaybe=function(e){return e!==void 0?this.sub(e):void 0};R.prototype.show=function(){return this.s*this.n+"/"+this.d};R.prototype.or=function(e){return this.eq(0)?e:this};const g=e=>R(e),Iy=(...e)=>{if(e=ze(e),e.length!==0)return e.reduce((t,n)=>t.gcd(n),g(1))},be=(...e)=>{if(e=ze(e),e.length===0)return;const t=e.pop();return e.reduce((n,s)=>n===void 0||s===void 0?void 0:n.lcm(s),t)},Ky=e=>e instanceof R;g._original=R;class H{constructor(t,n){this.begin=g(t),this.end=g(n)}get spanCycles(){const t=[];var n=this.begin;const s=this.end,i=s.sam();if(n.equals(s))return[new H(n,s)];for(;s.gt(n);){if(n.sam().equals(i)){t.push(new H(n,this.end));break}const a=n.nextSam();t.push(new H(n,a)),n=a}return t}get duration(){return this.end.sub(this.begin)}cycleArc(){const t=this.begin.cyclePos(),n=t.add(this.duration);return new H(t,n)}withTime(t){return new H(t(this.begin),t(this.end))}withEnd(t){return new H(this.begin,t(this.end))}withCycle(t){const n=this.begin.sam(),s=n.add(t(this.begin.sub(n))),i=n.add(t(this.end.sub(n)));return new H(s,i)}intersection(t){const n=this.begin.max(t.begin),s=this.end.min(t.end);if(!n.gt(s)&&!(n.equals(s)&&(n.equals(this.end)&&this.begin.lt(this.end)||n.equals(t.end)&&t.begin.lt(t.end))))return new H(n,s)}intersection_e(t){const n=this.intersection(t);if(n==null)throw"TimeSpans do not intersect";return n}midpoint(){return this.begin.add(this.duration.div(g(2)))}equals(t){return this.begin.equals(t.begin)&&this.end.equals(t.end)}show(){return this.begin.show()+"  "+this.end.show()}}class S{constructor(t,n,s,i={},a=!1){this.whole=t,this.part=n,this.value=s,this.context=i,this.stateful=a,a&&console.assert(typeof this.value=="function","Stateful values must be functions")}get duration(){var n,s;let t;return typeof((n=this.value)==null?void 0:n.duration)=="number"?t=g(this.value.duration):t=this.whole.end.sub(this.whole.begin),typeof((s=this.value)==null?void 0:s.clip)=="number"?t.mul(this.value.clip):t}get endClipped(){return this.whole.begin.add(this.duration)}isActive(t){return this.whole.begin<=t&&this.endClipped>=t}isInPast(t){return t>this.endClipped}isInNearPast(t,n){return n-t<=this.endClipped}isInFuture(t){return t<this.whole.begin}isInNearFuture(t,n){return n<this.whole.begin&&n>this.whole.begin-t}isWithinTime(t,n){return this.whole.begin<=n&&this.endClipped>=t}wholeOrPart(){return this.whole?this.whole:this.part}withSpan(t){const n=this.whole?t(this.whole):void 0;return new S(n,t(this.part),this.value,this.context)}withValue(t){return new S(this.whole,this.part,t(this.value),this.context)}hasOnset(){return this.whole!=null&&this.whole.begin.equals(this.part.begin)}hasTag(t){var n;return(n=this.context.tags)==null?void 0:n.includes(t)}resolveState(t){if(this.stateful&&this.hasOnset()){console.log("stateful");const n=this.value,[s,i]=n(t);return[s,new S(this.whole,this.part,i,this.context,!1)]}return[t,this]}spanEquals(t){return this.whole==null&&t.whole==null||this.whole.equals(t.whole)}equals(t){return this.spanEquals(t)&&this.part.equals(t.part)&&this.value===t.value}show(t=!1){const n=typeof this.value=="object"?t?JSON.stringify(this.value).slice(1,-1).replaceAll('"',"").replaceAll(","," "):JSON.stringify(this.value):this.value;var s="";if(this.whole==null)s="~"+this.part.show;else{var i=this.whole.begin.equals(this.part.begin)&&this.whole.end.equals(this.part.end);this.whole.begin.equals(this.part.begin)||(s=this.whole.begin.show()+"  "),i||(s+="("),s+=this.part.show(),i||(s+=")"),this.whole.end.equals(this.part.end)||(s+="  "+this.whole.end.show())}return"[ "+s+" | "+n+" ]"}showWhole(t=!1){return`${this.whole==null?"~":this.whole.show()}: ${Rt(this.value,t)}`}combineContext(t){const n=this;return{...n.context,...t.context,locations:(n.context.locations||[]).concat(t.context.locations||[])}}setContext(t){return new S(this.whole,this.part,this.value,t)}ensureObjectValue(){if(typeof this.value!="object")throw new Error(`expected hap.value to be an object, but got "${this.value}". Hint: append .note() or .s() to the end`,"error")}}class ke{constructor(t,n={}){this.span=t,this.controls=n}setSpan(t){return new ke(t,this.controls)}withSpan(t){return this.setSpan(t(this.span))}setControls(t){return new ke(this.span,{...this.controls,...t})}}function Py(e,t,n){if((t==null?void 0:t.value)!==void 0&&Object.keys(t).length===1)return $("[warn]: Can't do arithmetic on control pattern."),e;const s=Object.keys(e).filter(i=>Object.keys(t).includes(i));return Object.assign({},e,t,Object.fromEntries(s.map(i=>[i,n(e[i],t[i])])))}X((e,t)=>e*t);X((e,t)=>t.map(e));function On(e,t=60){let n=0,s=g(0),i=[""],a="";for(;i[0].length<t;){const o=e.queryArc(n,n+1),l=o.filter(d=>d.hasOnset()).map(d=>d.duration),c=Iy(...l),u=c.inverse();i=i.map(d=>d+"|"),a+="|";for(let d=0;d<u;d++){const[h,x]=[s,s.add(c)],Z=o.filter(T=>T.whole.begin.lte(h)&&T.whole.end.gte(x)),v=Z.length-i.length;v>0&&(i=i.concat(Array(v).fill(a))),i=i.map((T,C)=>{const Y=Z[C];if(Y){const I=Y.whole.begin.eq(h)?""+Y.value:"-";return T+I}return T+"."}),a+=".",s=s.add(c)}n++}return i.join(`
`)}const St={},En=async(...e)=>{const t=await Promise.allSettled(e),n=t.filter(s=>s.status==="fulfilled").map(s=>s.value);return t.forEach((s,i)=>{s.status==="rejected"&&console.warn(`evalScope: module with index ${i} could not be loaded:`,s.reason)}),n.forEach(s=>{Object.entries(s).forEach(([i,a])=>{globalThis[i]=a,St[i]=a})}),n};function _y(e,t={}){const{wrapExpression:n=!0,wrapAsync:s=!0}=t;n&&(e=`{${e}}`),s&&(e=`(async ()=>${e})()`);const i=`"use strict";return (${e})`;return Function(i)()}const An=async(e,t,n)=>{let s={};if(t){const i=t(e,n);e=i.output,s=i}return{mode:"javascript",pattern:await _y(e,{wrapExpression:!!t}),meta:s}};let dt,Q=!0;const Uy=function(e){Q=!!e},By=e=>dt=e;class f{constructor(t,n=void 0){nn(this,"polyJoin",function(){const t=this;return t.fmap(n=>n.extend(t._steps.div(n._steps))).outerJoin()});this.query=t,this._Pattern=!0,this._steps=n}get _steps(){return this.__steps}set _steps(t){this.__steps=t===void 0?void 0:g(t)}setSteps(t){return this._steps=t,this}withSteps(t){return Q?new f(this.query,this._steps===void 0?void 0:t(this._steps)):this}get hasSteps(){return this._steps!==void 0}withValue(t){const n=new f(s=>this.query(s).map(i=>i.withValue(t)));return n._steps=this._steps,n}withState(t){return new f(n=>this.query(t(n)))}fmap(t){return this.withValue(t)}appWhole(t,n){const s=this,i=function(a){const o=s.query(a),l=n.query(a),c=function(u,d){const h=u.part.intersection(d.part);if(h!=null)return new S(t(u.whole,d.whole),h,u.value(d.value),d.combineContext(u))};return re(o.map(u=>ze(l.map(d=>c(u,d)))))};return new f(i)}appBoth(t){const n=this,s=function(a,o){if(!(a==null||o==null))return a.intersection_e(o)},i=n.appWhole(s,t);return Q&&(i._steps=be(t._steps,n._steps)),i}appLeft(t){const n=this,s=function(a){const o=[];for(const l of n.query(a)){const c=t.query(a.setSpan(l.wholeOrPart()));for(const u of c){const d=l.whole,h=l.part.intersection(u.part);if(h){const x=l.value(u.value),Z=u.combineContext(l),v=new S(d,h,x,Z);o.push(v)}}}return o},i=new f(s);return i._steps=this._steps,i}appRight(t){const n=this,s=function(a){const o=[];for(const l of t.query(a)){const c=n.query(a.setSpan(l.wholeOrPart()));for(const u of c){const d=l.whole,h=u.part.intersection(l.part);if(h){const x=u.value(l.value),Z=l.combineContext(u),v=new S(d,h,x,Z);o.push(v)}}}return o},i=new f(s);return i._steps=t._steps,i}bindWhole(t,n){const s=this,i=function(a){const o=function(c,u){return new S(t(c.whole,u.whole),u.part,u.value,Object.assign({},c.context,u.context,{locations:(c.context.locations||[]).concat(u.context.locations||[])}))},l=function(c){return n(c.value).query(a.setSpan(c.part)).map(u=>o(c,u))};return re(s.query(a).map(c=>l(c)))};return new f(i)}bind(t){const n=function(s,i){if(!(s==null||i==null))return s.intersection_e(i)};return this.bindWhole(n,t)}join(){return this.bind(xe)}outerBind(t){return this.bindWhole(n=>n,t).setSteps(this._steps)}outerJoin(){return this.outerBind(xe)}innerBind(t){return this.bindWhole((n,s)=>s,t)}innerJoin(){return this.innerBind(xe)}resetJoin(t=!1){const n=this;return new f(s=>n.discreteOnly().query(s).map(i=>i.value.late(t?i.whole.begin:i.whole.begin.cyclePos()).query(s).map(a=>new S(a.whole?a.whole.intersection(i.whole):void 0,a.part.intersection(i.part),a.value).setContext(i.combineContext(a))).filter(a=>a.part)).flat())}restartJoin(){return this.resetJoin(!0)}squeezeJoin(){const t=this;function n(s){const i=t.discreteOnly().query(s);function a(o){const l=o.value._focusSpan(o.wholeOrPart()).query(s.setSpan(o.part));function c(u,d){let h;if(d.whole&&u.whole&&(h=d.whole.intersection(u.whole),!h))return;const x=d.part.intersection(u.part);if(!x)return;const Z=d.combineContext(u);return new S(h,x,d.value,Z)}return l.map(u=>c(o,u))}return re(i.map(a)).filter(o=>o)}return new f(n)}squeezeBind(t){return this.fmap(t).squeezeJoin()}polyBind(t){return this.fmap(t).polyJoin()}queryArc(t,n,s={}){try{return this.query(new ke(new H(t,n),s))}catch(i){return Ee(i,"query"),[]}}splitQueries(){const t=this,n=s=>re(s.span.spanCycles.map(i=>t.query(s.setSpan(i))));return new f(n)}withQuerySpan(t){return new f(n=>this.query(n.withSpan(t)))}withQuerySpanMaybe(t){const n=this;return new f(s=>{const i=s.withSpan(t);return i.span?n.query(i):[]})}withQueryTime(t){return new f(n=>this.query(n.withSpan(s=>s.withTime(t))))}withHapSpan(t){return new f(n=>this.query(n).map(s=>s.withSpan(t)))}withHapTime(t){return this.withHapSpan(n=>n.withTime(t))}withHaps(t){const n=new f(s=>t(this.query(s),s));return n._steps=this._steps,n}withHap(t){return this.withHaps(n=>n.map(t))}setContext(t){return this.withHap(n=>n.setContext(t))}withContext(t){const n=this.withHap(s=>s.setContext(t(s.context)));return this.__pure!==void 0&&(n.__pure=this.__pure,n.__pure_loc=this.__pure_loc),n}stripContext(){return this.withHap(t=>t.setContext({}))}withLoc(t,n){const s={start:t,end:n},i=this.withContext(a=>{const o=(a.locations||[]).concat([s]);return{...a,locations:o}});return this.__pure&&(i.__pure=this.__pure,i.__pure_loc=s),i}filterHaps(t){return new f(n=>this.query(n).filter(t))}filterValues(t){return new f(n=>this.query(n).filter(s=>t(s.value))).setSteps(this._steps)}removeUndefineds(){return this.filterValues(t=>t!=null)}onsetsOnly(){return this.filterHaps(t=>t.hasOnset())}discreteOnly(){return this.filterHaps(t=>t.whole)}defragmentHaps(){return this.discreteOnly().withHaps(t=>{const n=[];for(var s=0;s<t.length;++s){for(var i=!0,a=t[s];i;){const c=JSON.stringify(t[s].value);for(var o=!1,l=s+1;l<t.length;l++){const u=t[l];if(a.whole.equals(u.whole)){if(a.part.begin.eq(u.part.end)){if(c===JSON.stringify(u.value)){a=new S(a.whole,new H(u.part.begin,a.part.end),a.value),t.splice(l,1),o=!0;break}}else if(u.part.begin.eq(a.part.end)&&c==JSON.stringify(u.value)){a=new S(a.whole,new H(a.part.begin,u.part.end),a.value),t.splice(l,1),o=!0;break}}}i=o}n.push(a)}return n})}firstCycle(t=!1){var n=this;return t||(n=n.stripContext()),n.query(new ke(new H(g(0),g(1))))}get firstCycleValues(){return this.firstCycle().map(t=>t.value)}get showFirstCycle(){return this.firstCycle().map(t=>`${t.value}: ${t.whole.begin.toFraction()} - ${t.whole.end.toFraction()}`)}sortHapsByPart(){return this.withHaps(t=>t.sort((n,s)=>n.part.begin.sub(s.part.begin).or(n.part.end.sub(s.part.end)).or(n.whole.begin.sub(s.whole.begin).or(n.whole.end.sub(s.whole.end)))))}asNumber(){return this.fmap(zt)}_opIn(t,n){return this.fmap(n).appLeft(y(t))}_opOut(t,n){return this.fmap(n).appRight(y(t))}_opMix(t,n){return this.fmap(n).appBoth(y(t))}_opSqueeze(t,n){const s=y(t);return this.fmap(i=>s.fmap(a=>n(i)(a))).squeezeJoin()}_opSqueezeOut(t,n){const s=this;return y(t).fmap(i=>s.fmap(a=>n(a)(i))).squeezeJoin()}_opReset(t,n){return y(t).fmap(s=>this.fmap(i=>n(i)(s))).resetJoin()}_opRestart(t,n){return y(t).fmap(s=>this.fmap(i=>n(i)(s))).restartJoin()}_opPoly(t,n){const s=y(t);return this.fmap(i=>s.fmap(a=>n(a)(i))).polyJoin()}layer(...t){return K(...t.map(n=>n(this)))}superimpose(...t){return this.stack(...t.map(n=>n(this)))}stack(...t){return K(this,...t)}sequence(...t){return ce(this,...t)}seq(...t){return ce(this,...t)}cat(...t){return He(this,...t)}fastcat(...t){return A(this,...t)}slowcat(...t){return de(this,...t)}onTrigger(t,n=!0){return this.withHap(s=>s.setContext({...s.context,onTrigger:(...i)=>{var a,o;(o=(a=s.context).onTrigger)==null||o.call(a,...i),t(...i)},dominantTrigger:s.context.dominantTrigger||n}))}log(t=s=>`[hap] ${s.showWhole(!0)}`,n=s=>({hap:s})){return this.onTrigger((...s)=>{$(t(...s),void 0,n(...s))},!1)}logValues(t=n=>`[hap] ${Rt(n,!0)}`){return this.log(n=>t(n.value))}drawLine(){return console.log(On(this)),this}unjoin(t,n=xe){return t.withHap(s=>s.withValue(i=>i?n(this.ribbon(s.whole.begin,s.whole.duration)):this))}into(t,n){return this.unjoin(t,n).innerJoin()}}function jy(e,t){let n=[];return t.forEach(s=>{const i=n.findIndex(([a])=>e(s,a));i===-1?n.push([s]):n[i].push(s)}),n}const Jy=(e,t)=>e.spanEquals(t);f.prototype.collect=function(){return this.withHaps(e=>jy(Jy,e).map(t=>new S(t[0].whole,t[0].part,t,{})))};const $y=p("arpWith",(e,t)=>t.collect().fmap(n=>y(e(n))).innerJoin().withHap(n=>new S(n.whole,n.part,n.value.value,n.combineContext(n.value)))),Fy=p("arp",(e,t)=>t.arpWith(n=>y(e).fmap(s=>n[s%n.length])),!1);function Fe(e){return!Array.isArray(e)&&typeof e=="object"&&!Ky(e)}function Oy(e,t,n){return Fe(e)||Fe(t)?(Fe(e)||(e={value:e}),Fe(t)||(t={value:t}),Py(e,t,n)):n(e,t)}(function(){const e={set:[(n,s)=>s],keep:[n=>n],keepif:[(n,s)=>s?n:void 0],add:[q((n,s)=>n+s)],sub:[q((n,s)=>n-s)],mul:[q((n,s)=>n*s)],div:[q((n,s)=>n/s)],mod:[q(Pe)],pow:[q(Math.pow)],log2:[q(Math.log2)],band:[q((n,s)=>n&s)],bor:[q((n,s)=>n|s)],bxor:[q((n,s)=>n^s)],blshift:[q((n,s)=>n<<s)],brshift:[q((n,s)=>n>>s)],lt:[(n,s)=>n<s],gt:[(n,s)=>n>s],lte:[(n,s)=>n<=s],gte:[(n,s)=>n>=s],eq:[(n,s)=>n==s],eqt:[(n,s)=>n===s],ne:[(n,s)=>n!=s],net:[(n,s)=>n!==s],and:[(n,s)=>n&&s],or:[(n,s)=>n||s],func:[(n,s)=>s(n)]},t=["In","Out","Mix","Squeeze","SqueezeOut","Reset","Restart","Poly"];for(const[n,[s,i]]of Object.entries(e)){f.prototype["_"+n]=function(a){return this.fmap(o=>s(o,a))},Object.defineProperty(f.prototype,n,{get:function(){const a=this,o=(...l)=>a[n].in(...l);for(const l of t)o[l.toLowerCase()]=function(...c){var u=a;c=ce(c),i&&(u=i(u),c=i(c));var d;return n==="keepif"?(d=u["_op"+l](c,h=>x=>s(h,x)),d=d.removeUndefineds()):d=u["_op"+l](c,h=>x=>Oy(h,x,s)),d};return o.squeezein=o.squeeze,o}});for(const a of t)f.prototype[a.toLowerCase()]=function(...o){return this.set[a.toLowerCase()](o)}}f.prototype.struct=function(...n){return this.keepif.out(...n)},f.prototype.structAll=function(...n){return this.keep.out(...n)},f.prototype.mask=function(...n){return this.keepif.in(...n)},f.prototype.maskAll=function(...n){return this.keep.in(...n)},f.prototype.reset=function(...n){return this.keepif.reset(...n)},f.prototype.resetAll=function(...n){return this.keep.reset(...n)},f.prototype.restart=function(...n){return this.keepif.restart(...n)},f.prototype.restartAll=function(...n){return this.keep.restart(...n)}})();const Ey=K,Ay=K,qy=Qe,Me=e=>new f(()=>[],e),L=Me(1),se=Me(0);function V(e){function t(s){return s.span.spanCycles.map(i=>new S(g(i.begin).wholeCycle(),i,e))}const n=new f(t,1);return n.__pure=e,n}function Tt(e){return e instanceof f||(e==null?void 0:e._Pattern)}function y(e){return Tt(e)?e:dt&&typeof e=="string"?dt(e):V(e)}function qn(e){let t=V([]);for(const n of e)t=t.bind(s=>n.fmap(i=>s.concat([i])));return t}function K(...e){e=e.map(s=>Array.isArray(s)?ce(...s):y(s));const t=s=>re(e.map(i=>i.query(s))),n=new f(t);return Q&&(n._steps=be(...e.map(s=>s._steps))),n}function Nt(e,t){if(t=t.map(a=>Array.isArray(a)?ce(...a):y(a)),t.length===0)return L;if(t.length===1)return t[0];const[n,...s]=t.map(a=>a._steps),i=Q?n.maximum(...s):void 0;return K(...e(i,t))}function Qn(...e){return Nt((t,n)=>n.map(s=>s._steps.eq(t)?s:E(s,Me(t.sub(s._steps)))),e)}function Dn(...e){return Nt((t,n)=>n.map(s=>s._steps.eq(t)?s:E(Me(t.sub(s._steps)),s)),e)}function es(...e){return Nt((t,n)=>n.map(s=>{if(s._steps.eq(t))return s;const i=Me(t.sub(s._steps).div(2));return E(i,s,i)}),e)}function Qy(e,...t){const[n,...s]=t.map(o=>o._steps),i=n.maximum(...s),a={centre:es,left:Qn,right:Dn,expand:K,repeat:(...o)=>Qe(...o).steps(i)};return e.inhabit(a).fmap(o=>o(...t)).innerJoin().setSteps(i)}function de(...e){if(e=e.map(s=>Array.isArray(s)?A(...s):y(s)),e.length==1)return e[0];const t=function(s){const i=s.span,a=Pe(i.begin.sam(),e.length),o=e[a];if(!o)return[];const l=i.begin.floor().sub(i.begin.div(e.length).floor());return o.withHapTime(c=>c.add(l)).query(s.setSpan(i.withTime(c=>c.sub(l))))},n=Q?be(...e.map(s=>s._steps)):void 0;return new f(t).splitQueries().setSteps(n)}function Wt(...e){e=e.map(y);const t=function(n){var i;const s=Math.floor(n.span.begin)%e.length;return((i=e[s])==null?void 0:i.query(n))||[]};return new f(t).splitQueries()}function He(...e){return de(...e)}function Dy(...e){const t=e.reduce((n,[s])=>n+s,0);return e=e.map(([n,s])=>[n,s.fast(n)]),E(...e).slow(t)}function eg(...e){let t=g(0);for(let n of e)n.length==2&&n.unshift(t),t=n[1];return K(...e.map(([n,s,i])=>V(y(i)).compress(g(n).div(t),g(s).div(t)))).slow(t).innerJoin()}function A(...e){let t=de(...e);return e.length>1&&(t=t._fast(e.length),t._steps=e.length),e.length==1&&e[0].__steps_source&&(e._steps=e[0]._steps),t}function ce(...e){return A(...e)}function ts(...e){return A(...e)}function ht(e){return Array.isArray(e)?e.length==0?[L,0]:e.length==1?ht(e[0]):[A(...e.map(t=>ht(t)[0])),e.length]:[y(e),1]}const tg=X((e,t)=>y(t).mask(e)),ng=X((e,t)=>y(t).struct(e)),sg=X((e,t)=>y(t).superimpose(...e)),ig=X((e,t)=>y(t).withValue(e)),ag=X((e,t)=>y(t).bind(e)),og=X((e,t)=>y(t).innerBind(e)),rg=X((e,t)=>y(t).outerBind(e)),cg=X((e,t)=>y(t).squeezeBind(e)),lg=X((e,t)=>y(t).stepBind(e)),ug=X((e,t)=>y(t).polyBind(e)),pg=X((e,t)=>y(t).set(e)),dg=X((e,t)=>y(t).keep(e)),hg=X((e,t)=>y(t).keepif(e)),mg=X((e,t)=>y(t).add(e)),fg=X((e,t)=>y(t).sub(e)),yg=X((e,t)=>y(t).mul(e)),gg=X((e,t)=>y(t).div(e)),bg=X((e,t)=>y(t).mod(e)),wg=X((e,t)=>y(t).pow(e)),Gg=X((e,t)=>y(t).band(e)),vg=X((e,t)=>y(t).bor(e)),xg=X((e,t)=>y(t).bxor(e)),Xg=X((e,t)=>y(t).blshift(e)),Zg=X((e,t)=>y(t).brshift(e)),kg=X((e,t)=>y(t).lt(e)),zg=X((e,t)=>y(t).gt(e)),Mg=X((e,t)=>y(t).lte(e)),Lg=X((e,t)=>y(t).gte(e)),Rg=X((e,t)=>y(t).eq(e)),Sg=X((e,t)=>y(t).eqt(e)),Tg=X((e,t)=>y(t).ne(e)),Ng=X((e,t)=>y(t).net(e)),Wg=X((e,t)=>y(t).and(e)),Cg=X((e,t)=>y(t).or(e)),Vg=X((e,t)=>y(t).func(e));function p(e,t,n=!0,s=!1,i=a=>a.innerJoin()){if(Array.isArray(e)){const c={};for(const u of e)c[u]=p(u,t,n,s,i);return c}const a=t.length;var o;n?o=function(...c){c=c.map(y);const u=c[c.length-1];let d;if(a===1)d=t(u);else{const h=c.slice(0,-1);if(h.every(x=>x.__pure!=null)){const x=h.map(v=>v.__pure),Z=h.filter(v=>v.__pure_loc).map(v=>v.__pure_loc);d=t(...x,u),d=d.withContext(v=>{const T=(v.locations||[]).concat(Z);return{...v,locations:T}})}else{const[x,...Z]=h;let v=(...T)=>t(...T,u);v=X(v,null,a-1),d=i(Z.reduce((T,C)=>T.appLeft(C),x.fmap(v)))}}return s&&(d._steps=u._steps),d}:o=function(...c){c=c.map(y);const u=t(...c);return s&&(u._steps=c[c.length-1]._steps),u},f.prototype[e]=function(...c){if(a===2&&c.length!==1)c=[ce(...c)];else if(a!==c.length+1)throw new Error(`.${e}() expects ${a-1} inputs but got ${c.length}.`);return c=c.map(y),o(...c,this)},a>1&&(f.prototype["_"+e]=function(...c){const u=t(...c,this);return s&&u.setSteps(this._steps),u});const l=X(o,null,a);return St[e]=l,l}function Le(e,t,n=!0,s=!1,i=a=>a.stepJoin()){return p(e,t,n,s,i)}const Hg=p("round",function(e){return e.asNumber().fmap(t=>Math.round(t))}),Yg=p("floor",function(e){return e.asNumber().fmap(t=>Math.floor(t))}),Ig=p("ceil",function(e){return e.asNumber().fmap(t=>Math.ceil(t))}),Kg=p("toBipolar",function(e){return e.fmap(t=>t*2-1)}),Pg=p("fromBipolar",function(e){return e.fmap(t=>(t+1)/2)}),_g=p("range",function(e,t,n){return n.mul(t-e).add(e)}),Ug=p("rangex",function(e,t,n){return n._range(Math.log(e),Math.log(t)).fmap(Math.exp)}),Bg=p("range2",function(e,t,n){return n.fromBipolar()._range(e,t)}),jg=p("ratio",e=>e.fmap(t=>Array.isArray(t)?t.slice(1).reduce((n,s)=>n/s,t[0]):t)),Jg=p("compress",function(e,t,n){return e=g(e),t=g(t),e.gt(t)||e.gt(1)||t.gt(1)||e.lt(0)||t.lt(0)?L:n._fastGap(g(1).div(t.sub(e)))._late(e)}),{compressSpan:$g,compressspan:Fg}=p(["compressSpan","compressspan"],function(e,t){return t._compress(e.begin,e.end)}),{fastGap:Og,fastgap:Eg}=p(["fastGap","fastgap"],function(e,t){const n=function(i){const a=i.begin.sam(),o=i.begin.sub(a).mul(e).min(1),l=i.end.sub(a).mul(e).min(1);if(!(o>=1))return new H(a.add(o),a.add(l))},s=function(i){const a=i.part.begin,o=i.part.end,l=a.sam(),c=a.sub(l).div(e).min(1),u=o.sub(l).div(e).min(1),d=new H(l.add(c),l.add(u)),h=i.whole?new H(d.begin.sub(a.sub(i.whole.begin).div(e)),d.end.add(i.whole.end.sub(o).div(e))):void 0;return new S(h,d,i.value,i.context)};return t.withQuerySpanMaybe(n).withHap(s).splitQueries()}),Ag=p("focus",function(e,t,n){return e=g(e),t=g(t),n._early(e.sam())._fast(g(1).div(t.sub(e)))._late(e)}),{focusSpan:qg,focusspan:Qg}=p(["focusSpan","focusspan"],function(e,t){return t._focus(e.begin,e.end)}),Dg=p("ply",function(e,t){const n=t.fmap(s=>V(s)._fast(e)).squeezeJoin();return Q&&(n._steps=g(e).mulmaybe(t._steps)),n}),{fast:e0,density:A1}=p(["fast","density"],function(e,t){return e===0?L:(e=g(e),t.withQueryTime(n=>n.mul(e)).withHapTime(n=>n.div(e)).setSteps(t._steps))},!0,!0),t0=p("hurry",function(e,t){return t._fast(e).mul(V({speed:e}))}),{slow:n0,sparsity:s0}=p(["slow","sparsity"],function(e,t){return e===0?L:t._fast(g(1).div(e))}),i0=p("inside",function(e,t,n){return t(n._slow(e))._fast(e)}),a0=p("outside",function(e,t,n){return t(n._fast(e))._slow(e)}),o0=p("lastOf",function(e,t,n){const s=Array(e-1).fill(n);return s.push(t(n)),Wt(...s)}),{firstOf:r0,every:c0}=p(["firstOf","every"],function(e,t,n){const s=Array(e-1).fill(n);return s.unshift(t(n)),Wt(...s)}),l0=p("apply",function(e,t){return e(t)}),u0=p("cpm",function(e,t){return t._fast(e/60/1)}),p0=p("early",function(e,t){return e=g(e),t.withQueryTime(n=>n.add(e)).withHapTime(n=>n.sub(e))},!0,!0),ns=p("late",function(e,t){return e=g(e),t._early(g(0).sub(e))},!0,!0),d0=p("zoom",function(e,t,n){var a;if(t=g(t),e=g(e),e.gte(t))return se;const s=t.sub(e),i=Q?(a=n._steps)==null?void 0:a.mulmaybe(s):void 0;return n.withQuerySpan(o=>o.withCycle(l=>l.mul(s).add(e))).withHapSpan(o=>o.withCycle(l=>l.sub(e).div(s))).splitQueries().setSteps(i)}),{zoomArc:h0,zoomarc:m0}=p(["zoomArc","zoomarc"],function(e,t){return t.zoom(e.begin,e.end)}),f0=p("bite",(e,t,n)=>t.fmap(s=>i=>{const a=g(s).div(i).mod(1),o=a.add(g(1).div(i));return n.zoom(a,o)}).appLeft(e).squeezeJoin(),!1),y0=p("linger",function(e,t){return e==0?L:e<0?t._zoom(e.add(1),1)._slow(e):t._zoom(0,e)._slow(e)},!0,!0),{segment:g0,seg:b0}=p(["segment","seg"],function(e,t){return t.struct(V(!0)._fast(e)).setSteps(e)}),w0=p("swingBy",(e,t,n)=>n.inside(t,ns(ts(0,e/2)))),G0=p("swing",(e,t)=>t.swingBy(1/3,e)),{invert:v0,inv:x0}=p(["invert","inv"],function(e){return e.fmap(t=>!t)},!0,!0),X0=p("when",function(e,t,n){return e?t(n):n}),Z0=p("off",function(e,t,n){return K(n,t(n.late(e)))}),k0=p("brak",function(e){return e.when(de(!1,!0),t=>A(t,L)._late(.25))}),ss=p("rev",function(e){const t=function(n){const s=n.span,i=s.begin.sam(),a=s.begin.nextSam(),o=function(l){const c=l.withTime(d=>i.add(a.sub(d))),u=c.begin;return c.begin=c.end,c.end=u,c};return e.query(n.setSpan(o(s))).map(l=>l.withSpan(o))};return new f(t).splitQueries()},!1,!0),z0=p("revv",function(e){const t=n=>new H(g(0).sub(n.end),g(0).sub(n.begin));return e.withQuerySpan(t).withHapSpan(t)}),M0=p("pressBy",function(e,t){return t.fmap(n=>V(n).compress(e,1)).squeezeJoin()}),L0=p("press",function(e){return e._pressBy(.5)});f.prototype.hush=function(){return L};const R0=p("palindrome",function(e){return e.lastOf(2,ss)},!0,!0),{juxBy:S0,juxby:T0}=p(["juxBy","juxby"],function(e,t,n){e/=2;const s=function(o,l,c){return l in o?o[l]:c},i=n.withValue(o=>Object.assign({},o,{pan:s(o,"pan",.5)-e})),a=t(n.withValue(o=>Object.assign({},o,{pan:s(o,"pan",.5)+e})));return K(i,a).setSteps(Q?be(i._steps,a._steps):void 0)}),N0=p("jux",function(e,t){return t._juxBy(1,e,t)}),{echoWith:W0,echowith:C0,stutWith:V0,stutwith:H0}=p(["echoWith","echowith","stutWith","stutwith"],function(e,t,n,s){return K(..._e(0,e-1).map(i=>n(s.late(g(t).mul(i)),i)))}),Y0=p("echo",function(e,t,n,s){return s._echoWith(e,t,(i,a)=>i.gain(Math.pow(n,a)))}),I0=p("stut",function(e,t,n,s){return s._echoWith(e,n,(i,a)=>i.gain(Math.pow(t,a)))}),is=p("applyN",function(e,t,n){let s=n;for(let i=0;i<e;i++)s=t(s);return s}),K0=p(["plyWith","plywith"],function(e,t,n){const s=n.fmap(i=>He(..._e(0,e-1).map(a=>is(a,t,i)))._fast(e)).squeezeJoin();return Q&&(s._steps=g(e).mulmaybe(n._steps)),s}),P0=p(["plyForEach","plyforeach"],function(e,t,n){const s=n.fmap(i=>He(He(V(i),..._e(1,e-1).map(a=>t(V(i),a))))._fast(e)).squeezeJoin();return Q&&(s._steps=g(e).mulmaybe(n._steps)),s}),Ct=function(e,t,n=!1){return e=g(e),de(..._e(0,e.sub(1)).map(s=>n?t.late(g(s).div(e)):t.early(g(s).div(e))))},_0=p("iter",function(e,t){return Ct(e,t,!1)},!0,!0),{iterBack:U0,iterback:B0}=p(["iterBack","iterback"],function(e,t){return Ct(e,t,!0)},!0,!0),{repeatCycles:j0}=p("repeatCycles",function(e,t){return new f(function(n){const s=n.span.begin.sam(),i=s.div(e).sam(),a=s.sub(i);return n=n.withSpan(o=>o.withTime(l=>l.sub(a))),t.query(n).map(o=>o.withSpan(l=>l.withTime(c=>c.add(a))))}).splitQueries()},!0,!0),Vt=function(e,t,n,s=!1,i=!1){const a=Array(e-1).fill(!1);a.unshift(!0);const o=Ct(e,ce(...a),!s);return i||(n=n.repeatCycles(e)),n.when(o,t)},{chunk:J0,slowchunk:$0,slowChunk:F0}=p(["chunk","slowchunk","slowChunk"],function(e,t,n){return Vt(e,t,n,!1,!1)},!0,!0),{chunkBack:O0,chunkback:E0}=p(["chunkBack","chunkback"],function(e,t,n){return Vt(e,t,n,!0)},!0,!0),{fastchunk:A0,fastChunk:q0}=p(["fastchunk","fastChunk"],function(e,t,n){return Vt(e,t,n,!1,!0)},!0,!0),{chunkinto:Q0,chunkInto:D0}=p(["chunkinto","chunkInto"],function(e,t,n){return n.into(A(!0,...Array(e-1).fill(!1))._iterback(e),t)}),{chunkbackinto:eb,chunkBackInto:tb}=p(["chunkbackinto","chunkBackInto"],function(e,t,n){return n.into(A(!0,...Array(e-1).fill(!1))._iter(e)._early(1),t)}),nb=p("bypass",function(e,t){return e=!!parseInt(e),e?L:t},!0,!0),{ribbon:sb,rib:ib}=p(["ribbon","rib"],(e,t,n)=>n.early(e).restart(V(1).slow(t))),ab=p("hsla",(e,t,n,s,i)=>i.color(`hsla(${e}turn,${t*100}%,${n*100}%,${s})`)),ob=p("hsl",(e,t,n,s)=>s.color(`hsl(${e}turn,${t*100}%,${n*100}%)`));f.prototype.tag=function(e){return this.withContext(t=>({...t,tags:(t.tags||[]).concat([e])}))};const rb=p("filter",(e,t)=>t.withHaps(n=>n.filter(e))),cb=p("filterWhen",(e,t)=>t.filter(n=>e(n.whole.begin))),lb=p("within",(e,t,n,s)=>K(n(s.filterWhen(i=>i.cyclePos()>=e&&i.cyclePos()<=t)),s.filterWhen(i=>i.cyclePos()<e||i.cyclePos()>t)));f.prototype.stepJoin=function(){const e=this,t=E(...mt(ft(e.queryArc(0,1))))._steps,n=function(s){const i=e.early(s.span.begin.sam()).query(s.setSpan(new H(g(0),g(1))));return E(...mt(ft(i))).query(s)};return new f(n,t)};f.prototype.stepBind=function(e){return this.fmap(e).stepJoin()};function mt(e){const t=e.filter((a,o)=>o.hasSteps).reduce((a,o)=>a.add(o),g(0)),n=ze(e.map((a,o)=>o._steps)).reduce((a,o)=>a.add(o),g(0)),s=t.eq(0)?void 0:n.div(t);function i(a,o){return o._steps===void 0?[a.mulmaybe(s),o]:[o._steps,o]}return e.map(a=>i(...a))}function ft(e){const t=re(e.map(s=>[s.part.begin,s.part.end])),n=_n([g(0),g(1),...t]);return Kn(n).map(s=>[s[1].sub(s[0]),K(...as(new H(...s),e).map(i=>i.value.withHap(a=>a.setContext(a.combineContext(i)))))])}function as(e,t){return ze(t.map(n=>os(e,n)))}function os(e,t){const n=e.intersection(t.part);if(n!=null)return new S(t.whole,n,t.value,t.context)}const rs=p("pace",function(e,t){return t._steps===void 0?t:t._steps.eq(g(0))?se:t._fast(g(e).div(t._steps)).setSteps(e)});function cs(e,...t){const n=t.map(i=>ht(i));if(n.length==0)return L;e==0&&(e=n[0][1]);const s=[];for(const i of n)i[1]!=0&&(e==i[1]?s.push(i[0]):s.push(i[0]._fast(g(e).div(g(i[1])))));return K(...s)}function Qe(...e){if(Array.isArray(e[0]))return cs(0,...e);if(e=e.filter(s=>s.hasSteps),e.length==0)return L;const t=be(...e.map(s=>s._steps));if(t.eq(g(0)))return se;const n=K(...e.map(s=>s.pace(t)));return n._steps=t,n}function E(...e){if(e.length===0)return se;const t=o=>Array.isArray(o)?o:[o._steps??1,o];if(e=e.map(t),e.find(o=>o[0]===void 0)){const o=e.map(c=>c[0]).filter(c=>c!==void 0);if(o.length===0)return A(...e.map(c=>c[1]));if(o.length===e.length)return se;const l=o.reduce((c,u)=>c.add(u),g(0)).div(o.length);for(let c of e)c[0]===void 0&&(c[0]=l)}if(e.length==1)return y(e[0][1]).withSteps(o=>e[0][0]);const n=e.map(o=>o[0]).reduce((o,l)=>o.add(l),g(0));let s=g(0);const i=[];for(const[o,l]of e){if(g(o).eq(0))continue;const c=s.add(o);i.push(y(l)._compress(s.div(n),c.div(n))),s=c}const a=K(...i);return a._steps=n,a}function ls(...e){e=e.map(i=>Array.isArray(i)?i.map(y):[y(i)]);const t=be(...e.map(i=>g(i.length)));let n=[];for(let i=0;i<t;++i)n.push(...e.map(a=>a.length==0?L:a[i%a.length]));n=n.filter(i=>i.hasSteps&&i._steps>0);const s=n.reduce((i,a)=>i.add(a._steps),g(0));return n=E(...n),n._steps=s,n}const us=Le("take",function(e,t){if(!t.hasSteps||t._steps.lte(0)||(e=g(e),e.eq(0)))return se;const n=e<0;n&&(e=e.abs());const s=e.div(t._steps);return s.lte(0)?se:s.gte(1)?t:n?t.zoom(g(1).sub(s),1):t.zoom(0,s)}),ps=Le("drop",function(e,t){return t.hasSteps?(e=g(e),e.lt(0)?t.take(t._steps.add(e)):t.take(g(0).sub(t._steps.sub(e)))):se}),ds=Le("extend",function(e,t){return t.fast(e).expand(e)}),ub=Le("replicate",function(e,t){return t.repeatCycles(e).fast(e).expand(e)}),hs=Le("expand",function(e,t){return t.withSteps(n=>n.mul(g(e)))}),ms=Le("contract",function(e,t){return t.withSteps(n=>n.div(g(e)))});f.prototype.shrinklist=function(e){const t=this;if(!t.hasSteps)return[t];let[n,s]=Array.isArray(e)?e:[e,t._steps];if(n=g(n),s===0||n===0)return[t];const i=n>0,a=[];if(i){const o=g(1).div(t._steps).mul(n);for(let l=0;l<s;++l){const c=o.mul(l);if(c.gt(1))break;a.push([c,1])}}else{n=g(0).sub(n);const o=g(1).div(t._steps).mul(n);for(let l=0;l<s;++l){const c=g(1).sub(o.mul(l));if(c.lt(0))break;a.push([g(0),c])}}return a.map(o=>t.zoom(...o))};const fs=(e,t)=>t.shrinklist(e),ys=p("shrink",function(e,t){if(!t.hasSteps)return se;const n=t.shrinklist(e),s=E(...n);return s._steps=n.reduce((i,a)=>i.add(a._steps),g(0)),s},!0,!1,e=>e.stepJoin()),pb=p("grow",function(e,t){if(!t.hasSteps)return se;const n=t.shrinklist(g(0).sub(e));n.reverse();const s=E(...n);return s._steps=n.reduce((i,a)=>i.add(a._steps),g(0)),s},!0,!1,e=>e.stepJoin()),gs=function(e,...t){return e.tour(...t)};f.prototype.tour=function(...e){return E(...[].concat(...e.map((t,n)=>[...e.slice(0,e.length-n),this,...e.slice(e.length-n)]),this,...e))};const bs=function(...e){e=e.filter(s=>s.hasSteps);const t=de(...e.map(s=>s._slow(s._steps))),n=be(...e.map(s=>s._steps));return t._fast(n).setSteps(n)},db=E,ws=E,hb=E,mb=ls,fb=Qe;f.prototype.s_polymeter=f.prototype.polymeter;const yb=ys;f.prototype.s_taper=f.prototype.shrink;const gb=fs;f.prototype.s_taperlist=f.prototype.shrinklist;const bb=us;f.prototype.s_add=f.prototype.take;const wb=ps;f.prototype.s_sub=f.prototype.drop;const Gb=hs;f.prototype.s_expand=f.prototype.expand;const vb=ds;f.prototype.s_extend=f.prototype.extend;const xb=ms;f.prototype.s_contract=f.prototype.contract;const Xb=gs;f.prototype.s_tour=f.prototype.tour;const Zb=bs;f.prototype.s_zip=f.prototype.zip;const kb=rs;f.prototype.steps=f.prototype.pace;const zb=p("chop",function(e,t){const n=Array.from({length:e},(a,o)=>o).map(a=>({begin:a/e,end:(a+1)/e})),s=function(a,o){if("begin"in a&&"end"in a&&a.begin!==void 0&&a.end!==void 0){const l=a.end-a.begin;o={begin:a.begin+o.begin*l,end:a.begin+o.end*l}}return Object.assign({},a,o)},i=function(a){return ce(n.map(o=>s(a,o)))};return t.squeezeBind(i).setSteps(Q?g(e).mulmaybe(t._steps):void 0)}),Mb=p("striate",function(e,t){const n=Array.from({length:e},(i,a)=>a).map(i=>({begin:i/e,end:(i+1)/e})),s=de(...n);return t.set(s)._fast(e).setSteps(Q?g(e).mulmaybe(t._steps):void 0)}),Gs=function(e,t,n=.5){return t.speed(1/e*n).unit("c").slow(e)},vs=p("slice",function(e,t,n){return e.innerBind(s=>t.outerBind(i=>n.outerBind(a=>{a=a instanceof Object?a:{s:a};const o=Array.isArray(s)?s[i]:i/s,l=Array.isArray(s)?s[i+1]:(i+1)/s;return V({begin:o,end:l,_slices:s,...a})}))).setSteps(t._steps)},!1);f.prototype.onTriggerTime=function(e){return this.onTrigger((t,n,s,i)=>{const a=i-n;window.setTimeout(()=>{e(t)},a*1e3)},!1)};const Lb=p("splice",function(e,t,n){const s=vs(e,t,n);return new f(i=>{const a=i.controls._cps||1;return s.query(i).map(o=>o.withValue(l=>({speed:a/l._slices/o.whole.duration*(l.speed||1),unit:"c",...l})))}).setSteps(t._steps)},!1),{loopAt:Rb,loopat:Sb}=p(["loopAt","loopat"],function(e,t){const n=t._steps?t._steps.div(e):void 0;return new f(s=>Gs(e,t,s.controls._cps).query(s),n)}),Tb=p("fit",e=>e.withHaps((t,n)=>t.map(s=>s.withValue(i=>{const a=("end"in i?i.end:1)-("begin"in i?i.begin:0);return{...i,speed:(n.controls._cps||1)/s.whole.duration*a,unit:"c"}})))),{loopAtCps:Nb,loopatcps:Wb}=p(["loopAtCps","loopatcps"],function(e,t,n){return Gs(e,n,t)}),Cb=e=>V(1).withValue(()=>y(e())).innerJoin();let un=e=>e<.5?1:1-(e-.5)/.5,xs=(e,t,n)=>{t=y(t),e=y(e),n=y(n);let s=t.fmap(a=>({gain:un(a)})),i=t.fmap(a=>({gain:un(1-a)}));return K(e.mul(s),n.mul(i))};f.prototype.xfade=function(e,t){return xs(this,e,t)};const Vb=e=>(t,n,s)=>{t=g(t).mod(n),n=g(n);const i=t.div(n),a=t.add(1).div(n);return e(s.fmap(o=>V(o)._compress(i,a)))},{beat:Hb}=p(["beat"],Vb(e=>e.innerJoin())),Ht=(e,t,n)=>{n=g(n);const s=g(1).div(e.length),i=l=>{const c=[];for(const[u,d]of l.entries())d&&c.push([g(u).div(l.length),d]);return c},a=qe(([l,c],[u,d])=>{const h=n.mul(u-l).add(l),x=h.add(s);return new H(h,x)},i(e),i(t));function o(l){const c=l.span.begin.sam(),u=l.span.cycleArc(),d=[];for(const h of a){const x=h.intersection(u);x!==void 0&&d.push(new S(h.withTime(Z=>Z.add(c)),x.withTime(Z=>Z.add(c)),!0))}return d}return new f(o).splitQueries()},Yb=(e,t,n)=>(e=y(e),t=y(t),n=y(n),e.innerBind(s=>t.innerBind(i=>n.innerBind(a=>Ht(s,i,a))))),he=function(e){const t=function(n,s){const i=y(n).fmap(a=>Array.isArray(a)?[...a,e]:[a,1,e]);return s?s.distort(i):V({}).distort(i)};return f.prototype[e]=function(n){return t(n,this)},t},Ib=he("soft"),Kb=he("hard"),Pb=he("cubic"),_b=he("diode"),Ub=he("asym"),Bb=he("fold"),jb=he("sinefold"),Jb=he("chebyshev"),Yt=e=>{let t=V(X((...n)=>n,null,e.length));for(const n of e)t=t.appBoth(y(n));return t},De=e=>Array.isArray(e)?Yt(e):y(e);f.prototype.partials=function(e){return this.withValue(t=>n=>({...t,partials:n})).appLeft(De(e))};const $b=e=>De(e).as("partials");f.prototype.phases=function(e){return this.withValue(t=>n=>({...t,phases:n})).appLeft(De(e))};const Fb=e=>De(e).as("phases");f.prototype.FX=function(...e){return e=e.map(y),this.withValue(t=>n=>{const s=t.FX??[];return{...t,FX:s.concat(n)}}).appLeft(Yt(e))};const Ob=e=>{let t=V(X((...n)=>n,null,e.length));for(const n of e)t=t.appLeft(n);return t};f.prototype.worklet=function(e,...t){return t=t.map(y),this.outerBind(n=>Ob(t).withValue(s=>{const i=n.workletInputs??[];return{...n,workletSrc:e,workletInputs:i.concat(s)}}))};const Eb=(...e)=>V({}).worklet(...e);function et(e){let t=Array.isArray(e);e=t?e:[e];const n=e[0],s=a=>{let o;if(typeof a=="object"&&a.value!==void 0&&(o={...a},a=a.value,delete o.value),t&&Array.isArray(a)){const l=o||{};return a.forEach((c,u)=>{u<e.length&&(l[e[u]]=c)}),l}else return o?(o[n]=a,o):{[n]:a}},i=function(a,o){return o?typeof a>"u"?o.fmap(s):o.set(y(a).withValue(s)):y(a).withValue(s)};return f.prototype[n]=function(a){return i(a,this)},i}const Ye=new Map;function Xs(e){return Ye.has(e)}function r(e,...t){const n=Array.isArray(e)?e[0]:e;let s={};return s[n]=et(e),Ye.set(n,n),t.forEach(i=>{s[i]=s[n],Ye.set(i,n),f.prototype[i]=f.prototype[n]}),s}function ie(e,t,...n){e=Array.isArray(e)?e:[e];let s={};for(let i=1;i<=t;i++){let a=[...n],o=[...e];if(i===1){const c=a.map(d=>`${d}1`),u=o.map(d=>`${d}1`);a=a.concat(c).concat(u)}else a=a.map(c=>`${c}${i}`),o=o.map(c=>`${c}${i}`);const l=r(o,...a);s={...s,...l}}return s}const{s:Zs,sound:ks}=r(["s","n","gain"],"sound"),{wt:zs,wavetablePosition:Ms}=r("wt","wavetablePosition"),{wtenv:Ls}=r("wtenv"),{wtattack:Rs,wtatt:Ss}=r("wtattack","wtatt"),{wtdecay:Ts,wtdec:Ns}=r("wtdecay","wtdec"),{wtsustain:Ws,wtsus:Cs}=r("wtsustain","wtsus"),{wtrelease:Vs,wtrel:Hs}=r("wtrelease","wtrel"),{wtrate:Ys}=r("wtrate"),{wtsync:Is}=r("wtsync"),{wtdepth:Ks}=r("wtdepth"),{wtshape:Ps}=r("wtshape"),{wtdc:_s}=r("wtdc"),{wtskew:Us}=r("wtskew"),{warp:Bs,wavetableWarp:js}=r("warp","wavetableWarp"),{warpattack:Js,warpatt:$s}=r("warpattack","warpatt"),{warpdecay:Fs,warpdec:Os}=r("warpdecay","warpdec"),{warpsustain:Es,warpsus:As}=r("warpsustain","warpsus"),{warprelease:qs,warprel:Qs}=r("warprelease","warprel"),{warprate:Ds}=r("warprate"),{warpdepth:ei}=r("warpdepth"),{warpshape:ti}=r("warpshape"),{warpdc:ni}=r("warpdc"),{warpskew:si}=r("warpskew"),{warpmode:ii,wavetableWarpMode:ai}=r("warpmode","wavetableWarpMode"),{wtphaserand:oi,wavetablePhaseRand:ri}=r("wtphaserand","wavetablePhaseRand"),{warpenv:ci}=r("warpenv"),{warpsync:li}=r("warpsync"),{source:ui,src:pi}=r("source","src"),{n:di}=r("n"),{note:hi}=r(["note","n"]),{accelerate:mi}=r("accelerate"),{velocity:fi,vel:yi}=r("velocity","vel"),{gain:gi}=r("gain"),{postgain:bi}=r("postgain"),{amp:wi}=r("amp"),{attack:Gi,att:vi}=r("attack","att"),{fmh:xi,fmh1:Xi,fmh2:Zi,fmh3:ki,fmh4:zi,fmh5:Mi,fmh6:Li,fmh7:Ri,fmh8:Si}=ie(["fmh","fmi"],8,"fmh"),{fmi:Ti,fmi1:Ni,fmi2:Wi,fmi3:Ci,fmi4:Vi,fmi5:Hi,fmi6:Yi,fmi7:Ii,fmi8:Ki,fm:Pi,fm1:_i,fm2:Ui,fm3:Bi,fm4:ji,fm5:Ji,fm6:$i,fm7:Fi,fm8:Oi}=ie(["fmi","fmh"],8,"fm"),{fmenv:Ei,fmenv1:Ai,fmenv2:qi,fmenv3:Qi,fmenv4:Di,fmenv5:ea,fmenv6:ta,fmenv7:na,fmenv8:sa}=ie("fmenv",8),{fmattack:ia,fmattack1:aa,fmattack2:oa,fmattack3:ra,fmattack4:ca,fmattack5:la,fmattack6:ua,fmattack7:pa,fmattack8:da,fmatt:ha,fmatt1:ma,fmatt2:fa,fmatt3:ya,fmatt4:ga,fmatt5:ba,fmatt6:wa,fmatt7:Ga,fmatt8:va}=ie("fmattack",8,"fmatt"),{fmwave:xa,fmwave1:Xa,fmwave2:Za,fmwave3:ka,fmwave4:za,fmwave5:Ma,fmwave6:La,fmwave7:Ra,fmwave8:Sa}=ie("fmwave",8),{fmdecay:Ta,fmdecay1:Na,fmdecay2:Wa,fmdecay3:Ca,fmdecay4:Va,fmdecay5:Ha,fmdecay6:Ya,fmdecay7:Ia,fmdecay8:Ka,fmdec:Pa,fmdec1:_a,fmdec2:Ua,fmdec3:Ba,fmdec4:ja,fmdec5:Ja,fmdec6:$a,fmdec7:Fa,fmdec8:Oa}=ie("fmdecay",8,"fmdec"),{fmsustain:Ea,fmsustain1:Aa,fmsustain2:qa,fmsustain3:Qa,fmsustain4:Da,fmsustain5:eo,fmsustain6:to,fmsustain7:no,fmsustain8:so,fmsus:io,fmsus1:ao,fmsus2:oo,fmsus3:ro,fmsus4:co,fmsus5:lo,fmsus6:uo,fmsus7:po,fmsus8:ho}=ie("fmsustain",8,"fmsus"),{fmrelease:mo,fmrelease1:fo,fmrelease2:yo,fmrelease3:go,fmrelease4:bo,fmrelease5:wo,fmrelease6:Go,fmrelease7:vo,fmrelease8:xo,fmrel:Xo,fmrel1:Zo,fmrel2:ko,fmrel3:zo,fmrel4:Mo,fmrel5:Lo,fmrel6:Ro,fmrel7:So,fmrel8:To}=ie("fmrelease",8,"fmrel");for(let e=0;e<=8;e++)for(let t=0;t<=8;t++)r(`fmi${e}${t}`,`fm${e}${t}`);const{bank:No}=r("bank"),{chorus:Wo}=r("chorus"),{analyze:Co}=r("analyze"),{fft:Vo}=r("fft"),{decay:Ho,dec:Yo}=r("decay","dec"),{sustain:Io,sus:Ko}=r("sustain","sus"),{release:Po,rel:_o}=r("release","rel"),{hold:Uo}=r("hold"),{bandf:Bo,bpf:jo,bp:Jo}=r(["bandf","bandq","bpenv"],"bpf","bp"),{bandq:$o,bpq:Fo}=r("bandq","bpq"),{begin:Oo}=r("begin"),{end:Eo}=r("end"),{loop:Ao}=r("loop"),{loopBegin:qo,loopb:Qo}=r("loopBegin","loopb"),{loopEnd:Do,loope:er}=r("loopEnd","loope"),{crush:tr}=r("crush"),{coarse:nr}=r("coarse"),{tremolo:sr,trem:ir}=r(["tremolo","tremolodepth","tremoloskew","tremolophase"],"trem"),{tremolosync:ar}=r(["tremolosync","tremolodepth","tremoloskew","tremolophase"],"tremsync"),{tremolodepth:or}=r("tremolodepth","tremdepth"),{tremoloskew:rr}=r("tremoloskew","tremskew"),{tremolophase:cr}=r("tremolophase","tremphase"),{tremoloshape:lr}=r("tremoloshape","tremshape"),{drive:ur}=r("drive"),{duck:pr}=r("duckorbit","duck"),{duckdepth:dr}=r("duckdepth"),{duckonset:hr}=r("duckonset","duckons"),{duckattack:mr}=r("duckattack","duckatt"),{byteBeatExpression:fr,bbexpr:yr}=r("byteBeatExpression","bbexpr"),{byteBeatStartTime:gr,bbst:br}=r("byteBeatStartTime","bbst"),{channels:wr,ch:Gr}=r("channels","ch"),{pw:vr}=r(["pw","pwrate","pwsweep"]),{pwrate:xr}=r("pwrate"),{pwsweep:Xr}=r("pwsweep"),{phaserrate:Zr,ph:kr,phaser:zr}=r(["phaserrate","phaserdepth","phasercenter","phasersweep"],"ph","phaser"),{phasersweep:Mr,phs:Lr}=r("phasersweep","phs"),{phasercenter:Rr,phc:Sr}=r("phasercenter","phc"),{phaserdepth:Tr,phd:Nr,phasdp:Wr}=r("phaserdepth","phd","phasdp"),{channel:Cr}=r("channel"),{cut:Vr}=r("cut"),{cutoff:Hr,ctf:Yr,lpf:Ir,lp:Kr}=r(["cutoff","resonance","lpenv"],"ctf","lpf","lp"),{lpenv:Pr,lpe:_r}=r("lpenv","lpe"),{hpenv:Ur,hpe:Br}=r("hpenv","hpe"),{bpenv:jr,bpe:Jr}=r("bpenv","bpe"),{lpattack:$r,lpa:Fr}=r("lpattack","lpa"),{hpattack:Or,hpa:Er}=r("hpattack","hpa"),{bpattack:Ar,bpa:qr}=r("bpattack","bpa"),{lpdecay:Qr,lpd:Dr}=r("lpdecay","lpd"),{hpdecay:ec,hpd:tc}=r("hpdecay","hpd"),{bpdecay:nc,bpd:sc}=r("bpdecay","bpd"),{lpsustain:ic,lps:ac}=r("lpsustain","lps"),{hpsustain:oc,hps:rc}=r("hpsustain","hps"),{bpsustain:cc,bps:lc}=r("bpsustain","bps"),{lprelease:uc,lpr:pc}=r("lprelease","lpr"),{hprelease:dc,hpr:hc}=r("hprelease","hpr"),{bprelease:mc,bpr:fc}=r("bprelease","bpr"),{ftype:yc}=r("ftype"),{fanchor:gc}=r("fanchor"),{lprate:bc}=r("lprate"),{lpsync:wc}=r("lpsync"),{lpdepth:Gc}=r("lpdepth"),{lpdepthfrequency:vc,lpdepthfreq:xc}=r("lpdepthfrequency","lpdepthfreq"),{lpshape:Xc}=r("lpshape"),{lpdc:Zc}=r("lpdc"),{lpskew:kc}=r("lpskew"),{bprate:zc}=r("bprate"),{bpsync:Mc}=r("bpsync"),{bpdepth:Lc}=r("bpdepth"),{bpdepthfrequency:Rc,bpdepthfreq:Sc}=r("bpdepthfrequency","bpdepthfreq"),{bpshape:Tc}=r("bpshape"),{bpdc:Nc}=r("bpdc"),{bpskew:Wc}=r("bpskew"),{hprate:Cc}=r("hprate"),{hpsync:Vc}=r("hpsync"),{hpdepth:Hc}=r("hpdepth"),{hpdepthfrequency:Yc,hpdepthfreq:Ic}=r("hpdepthfrequency","hpdepthfreq"),{hpshape:Kc}=r("hpshape"),{hpdc:Pc}=r("hpdc"),{hpskew:_c}=r("hpskew"),{vib:Uc,vibrato:Bc,v:jc}=r(["vib","vibmod"],"vibrato","v"),{noise:Jc}=r("noise"),{vibmod:$c,vmod:Fc}=r(["vibmod","vib"],"vmod"),{hcutoff:Oc,hpf:Ec,hp:Ac}=r(["hcutoff","hresonance","hpenv"],"hpf","hp"),{hresonance:qc,hpq:Qc}=r("hresonance","hpq"),{resonance:Dc,lpq:el}=r("resonance","lpq"),{djf:tl}=r("djf"),{delay:nl}=r(["delay","delaytime","delayfeedback"]),{delayfeedback:sl,delayfb:il,dfb:al}=r("delayfeedback","delayfb","dfb"),{delayspeed:ol}=r("delayspeed"),{delaytime:rl,delayt:cl,dt:ll}=r("delaytime","delayt","dt"),{delaysync:ul}=r("delaysync"),{lock:pl}=r("lock"),{detune:dl,det:hl}=r("detune","det"),{unison:ml}=r("unison"),{spread:fl}=r("spread"),{dry:yl}=r("dry"),{fadeTime:gl,fadeOutTime:bl}=r("fadeTime","fadeOutTime"),{fadeInTime:wl}=r("fadeInTime"),{freq:Gl}=r("freq"),{pattack:vl,patt:xl}=r("pattack","patt"),{pdecay:Xl,pdec:Zl}=r("pdecay","pdec"),{psustain:kl,psus:zl}=r("psustain","psus"),{prelease:Ml,prel:Ll}=r("prelease","prel"),{penv:Rl}=r("penv"),{pcurve:Sl}=r("pcurve"),{panchor:Tl}=r("panchor"),{gate:Nl,gat:Wl}=r("gate","gat"),{leslie:Cl}=r("leslie"),{lrate:Vl}=r("lrate"),{lsize:Hl}=r("lsize"),{activeLabel:Yl}=r("activeLabel"),{label:Il}=r(["label","activeLabel"]),{degree:Kl}=r("degree"),{mtranspose:Pl}=r("mtranspose"),{ctranspose:_l}=r("ctranspose"),{harmonic:Ul}=r("harmonic"),{stepsPerOctave:Bl}=r("stepsPerOctave"),{octaveR:jl}=r("octaveR"),{nudge:Jl}=r("nudge"),{octave:$l,oct:Fl}=r("octave","oct"),{orbit:Ol}=r("orbit","o"),{bus:El}=r("bus"),{busgain:Al,bgain:ql}=r("busgain","bgain"),{overgain:Ql}=r("overgain"),{overshape:Dl}=r("overshape"),{pan:eu}=r("pan"),{panspan:tu}=r("panspan"),{pansplay:nu}=r("pansplay"),{panwidth:su}=r("panwidth"),{panorient:iu}=r("panorient"),{slide:au}=r("slide"),{semitone:ou}=r("semitone"),{voice:ru}=r("voice"),{chord:cu}=r("chord"),{dictionary:lu,dict:uu}=r("dictionary","dict"),{anchor:pu}=r("anchor"),{offset:du}=r("offset"),{octaves:hu}=r("octaves"),{mode:mu}=r(["mode","anchor"]),{room:fu}=r(["room","size"]),{roomlp:yu,rlp:gu}=r("roomlp","rlp"),{roomdim:bu,rdim:wu}=r("roomdim","rdim"),{roomfade:Gu,rfade:vu}=r("roomfade","rfade"),{ir:xu,iresponse:Xu}=r(["ir","i"],"iresponse"),{irspeed:Zu}=r("irspeed"),{irbegin:ku}=r("irbegin"),{roomsize:zu,size:Mu,sz:Lu,rsize:Ru}=r("roomsize","size","sz","rsize"),{shape:Su}=r(["shape","shapevol"]),{distort:Tu,dist:Nu}=r(["distort","distortvol","distorttype"],"dist"),{distortvol:Wu}=r("distortvol","distvol"),{distorttype:Cu}=r("distorttype","disttype"),{compressor:Vu}=r(["compressor","compressorRatio","compressorKnee","compressorAttack","compressorRelease"]),{compressorKnee:Hu}=r("compressorKnee"),{compressorRatio:Yu}=r("compressorRatio"),{compressorAttack:Iu}=r("compressorAttack"),{compressorRelease:Ku}=r("compressorRelease"),{speed:It}=r("speed"),{stretch:Pu}=r("stretch"),{unit:_u}=r("unit"),{squiz:Uu}=r("squiz"),{vowel:Bu}=r("vowel"),{waveloss:ju}=r("waveloss"),{density:Ab}=r("density"),{expression:Ju}=r("expression"),{sustainpedal:$u}=r("sustainpedal"),{fshift:Fu}=r("fshift"),{fshiftnote:Ou}=r("fshiftnote"),{fshiftphase:Eu}=r("fshiftphase"),{triode:Au}=r("triode"),{krush:qu}=r("krush"),{kcutoff:Qu}=r("kcutoff"),{octer:Du}=r("octer"),{octersub:ep}=r("octersub"),{octersubsub:tp}=r("octersubsub"),{ring:np}=r("ring"),{ringf:sp}=r("ringf"),{ringdf:ip}=r("ringdf"),{freeze:ap}=r("freeze"),{xsdelay:op}=r("xsdelay"),{tsdelay:rp}=r("tsdelay"),{real:cp}=r("real"),{imag:lp}=r("imag"),{enhance:up}=r("enhance"),{comb:pp}=r("comb"),{smear:dp}=r("smear"),{scram:hp}=r("scram"),{binshift:mp}=r("binshift"),{hbrick:fp}=r("hbrick"),{lbrick:yp}=r("lbrick"),{frameRate:gp}=r("frameRate"),{frames:bp}=r("frames"),{hours:wp}=r("hours"),{minutes:Gp}=r("minutes"),{seconds:vp}=r("seconds"),{songPtr:xp}=r("songPtr"),{uid:Xp}=r("uid"),{val:Zp}=r("val"),{cps:kp}=r("cps"),{clip:zp,legato:Mp}=r("clip","legato"),{duration:Lp,dur:Rp}=r("duration","dur"),{zrand:Sp}=r("zrand"),{curve:Tp}=r("curve"),{deltaSlide:Np}=r("deltaSlide"),{pitchJump:Wp}=r("pitchJump"),{pitchJumpTime:Cp}=r("pitchJumpTime"),{znoise:Vp}=r("znoise"),{zmod:Hp}=r("zmod"),{zcrush:Yp}=r("zcrush"),{zdelay:Ip}=r("zdelay"),{zzfx:Kp}=r("zzfx"),{color:Pp,colour:_p}=r(["color","colour"]);let Up=(...e)=>e.reduce((t,n)=>Object.assign(t,{[n]:et(n)}),{});const Bp=p("adsr",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s,i,a]=e;return t.set({attack:n,decay:s,sustain:i,release:a})}),jp=p("ad",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.attack(n).decay(s)}),Jp=p("ds",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=0]=e;return t.set({decay:n,sustain:s})}),$p=p("ar",(e,t)=>{e=Array.isArray(e)?e:[e];const[n,s=n]=e;return t.set({attack:n,release:s})}),{midichan:Fp}=r("midichan"),{midimap:Op}=r("midimap"),{midiport:Ep}=r("midiport"),{midicmd:Ap}=r("midicmd"),qp=p("control",(e,t)=>{if(!Array.isArray(e))throw new Error("control expects an array of [ccn, ccv]");const[n,s]=e;return t.ccn(n).ccv(s)}),{ccn:Qp}=r("ccn"),{ccv:Dp}=r("ccv"),{ctlNum:ed}=r("ctlNum"),{nrpnn:td}=r("nrpnn"),{nrpv:nd}=r("nrpv"),{progNum:sd}=r("progNum"),id=p("sysex",(e,t)=>{if(!Array.isArray(e))throw new Error("sysex expects an array of [id, data]");const[n,s]=e;return t.sysexid(n).sysexdata(s)}),{sysexid:ad}=r("sysexid"),{sysexdata:od}=r("sysexdata"),{midibend:rd}=r("midibend"),{miditouch:cd}=r("miditouch"),{polyTouch:ld}=r("polyTouch"),{oschost:ud}=r("oschost"),{oscport:pd}=r("oscport"),Ie=e=>Ye.has(e)?Ye.get(e):e,dd=p("as",(e,t)=>(e=Array.isArray(e)?e:[e],t.fmap(n=>{n=Array.isArray(n)?n:[n];const s=[];for(let i=0;i<e.length;++i)n[i]!==void 0&&s.push([Ie(e[i]),n[i]]);return Object.fromEntries(s)}))),hd=p("scrub",(e,t)=>e.outerBind(n=>{Array.isArray(n)||(n=[n]);const[s,i=1]=n;return t.begin(s).mul(It(i)).clip(1)}),!1),yt=new Map,qb=(e,t,...n)=>{const s=yt.get(e)??new Map,i=new Set([t,...n]);for(const a of i)s.set(String(a).toLowerCase(),t);yt.set(e,s)},Kt=(e,t=[])=>{for(const[n,...s]of t)qb(e,n,...s)},Qb=(e,t)=>{const n=yt.get(e);return n?n.get(String(t).toLowerCase())??t:t};Kt("lfo",[["control","c"],["subControl","sc"],["rate","r"],["depth","dep","dr"],["depthabs","da"],["dcoffset","dc"],["shape","sh"],["skew","sk"],["curve","cu"],["sync","s"],["fxi"]]);Kt("env",[["control","c"],["subControl","sc"],["attack","att","a"],["decay","dec","d"],["sustain","sus","s"],["release","rel","r"],["depth","dep","dr"],["depthabs","da"],["acurve","ac"],["dcurve","dc"],["rcurve","rc"],["fxi"]]);Kt("bmod",[["bus","b"],["control","c"],["subControl","sc"],["depth","dep","dr"],["depthabs","da"],["dc"],["fxi"]]);f.prototype.modulate=function(e,t,n){t={control:void 0,...t};const s=["lfo","env","bmod"];if(!s.includes(e))return $(`[core] Modulation type ${e} not found. Please use one of 'lfo', 'env', 'bmod'`),this;let i=this,a;i=i.fmap(o=>l=>({v:o,id:l})).appLeft(y(n));for(const[o,l]of Object.entries(t)){const c=Qb(e,o),u=y(l);i=i.fmap(({v:d,id:h})=>x=>{if(a===void 0){let v=Ie(Object.keys(d).at(-1));s.includes(v)&&(v=`${v}_${[...d[v].__ids].at(-1)}`),a=v}d[e]??(d[e]={__ids:new Set});const Z=d[e];return h??(h=Z.__ids.size),Z[h]??(Z[h]={control:a}),Z.__ids.add(h),x===void 0?{v:d,id:h}:(c==="control"||c==="subControl"?Z[h][c]=Ie(x):Z[h][c]=x,{v:d,id:h})}).appLeft(u)}return i.fmap(({v:o})=>o)};f.prototype.lfo=function(e,t){return this.modulate("lfo",e,t)};const md=e=>V({}).lfo(e);f.prototype.env=function(e,t){return this.modulate("env",e,t)};const fd=e=>V({}).env(e);f.prototype.bmod=function(e,t){return this.modulate("bmod",e,t)};const yd=e=>V({}).bmod(e),{transient:gd}=r(["transient","transsustain"]),{FXrelease:bd,FXrel:wd,FXr:Gd,fxr:vd}=r("FXrelease","FXrel","FXr","fxr"),Db=Object.freeze(Object.defineProperty({__proto__:null,FXr:Gd,FXrel:wd,FXrelease:bd,accelerate:mi,activeLabel:Yl,ad:jp,adsr:Bp,amp:wi,analyze:Co,anchor:pu,ar:$p,as:dd,att:vi,attack:Gi,bandf:Bo,bandq:$o,bank:No,bbexpr:yr,bbst:br,begin:Oo,bgain:ql,binshift:mp,bmod:yd,bp:Jo,bpa:qr,bpattack:Ar,bpd:sc,bpdc:Nc,bpdecay:nc,bpdepth:Lc,bpdepthfreq:Sc,bpdepthfrequency:Rc,bpe:Jr,bpenv:jr,bpf:jo,bpq:Fo,bpr:fc,bprate:zc,bprelease:mc,bps:lc,bpshape:Tc,bpskew:Wc,bpsustain:cc,bpsync:Mc,bus:El,busgain:Al,byteBeatExpression:fr,byteBeatStartTime:gr,ccn:Qp,ccv:Dp,ch:Gr,channel:Cr,channels:wr,chord:cu,chorus:Wo,clip:zp,coarse:nr,color:Pp,colour:_p,comb:pp,compressor:Vu,compressorAttack:Iu,compressorKnee:Hu,compressorRatio:Yu,compressorRelease:Ku,control:qp,cps:kp,createParam:et,createParams:Up,crush:tr,ctf:Yr,ctlNum:ed,ctranspose:_l,curve:Tp,cut:Vr,cutoff:Hr,dec:Yo,decay:Ho,degree:Kl,delay:nl,delayfb:il,delayfeedback:sl,delayspeed:ol,delaysync:ul,delayt:cl,delaytime:rl,deltaSlide:Np,density:Ab,det:hl,detune:dl,dfb:al,dict:uu,dictionary:lu,dist:Nu,distort:Tu,distorttype:Cu,distortvol:Wu,djf:tl,drive:ur,dry:yl,ds:Jp,dt:ll,duck:pr,duckattack:mr,duckdepth:dr,duckonset:hr,dur:Rp,duration:Lp,end:Eo,enhance:up,env:fd,expression:Ju,fadeInTime:wl,fadeOutTime:bl,fadeTime:gl,fanchor:gc,fft:Vo,fm:Pi,fm1:_i,fm2:Ui,fm3:Bi,fm4:ji,fm5:Ji,fm6:$i,fm7:Fi,fm8:Oi,fmatt:ha,fmatt1:ma,fmatt2:fa,fmatt3:ya,fmatt4:ga,fmatt5:ba,fmatt6:wa,fmatt7:Ga,fmatt8:va,fmattack:ia,fmattack1:aa,fmattack2:oa,fmattack3:ra,fmattack4:ca,fmattack5:la,fmattack6:ua,fmattack7:pa,fmattack8:da,fmdec:Pa,fmdec1:_a,fmdec2:Ua,fmdec3:Ba,fmdec4:ja,fmdec5:Ja,fmdec6:$a,fmdec7:Fa,fmdec8:Oa,fmdecay:Ta,fmdecay1:Na,fmdecay2:Wa,fmdecay3:Ca,fmdecay4:Va,fmdecay5:Ha,fmdecay6:Ya,fmdecay7:Ia,fmdecay8:Ka,fmenv:Ei,fmenv1:Ai,fmenv2:qi,fmenv3:Qi,fmenv4:Di,fmenv5:ea,fmenv6:ta,fmenv7:na,fmenv8:sa,fmh:xi,fmh1:Xi,fmh2:Zi,fmh3:ki,fmh4:zi,fmh5:Mi,fmh6:Li,fmh7:Ri,fmh8:Si,fmi:Ti,fmi1:Ni,fmi2:Wi,fmi3:Ci,fmi4:Vi,fmi5:Hi,fmi6:Yi,fmi7:Ii,fmi8:Ki,fmrel:Xo,fmrel1:Zo,fmrel2:ko,fmrel3:zo,fmrel4:Mo,fmrel5:Lo,fmrel6:Ro,fmrel7:So,fmrel8:To,fmrelease:mo,fmrelease1:fo,fmrelease2:yo,fmrelease3:go,fmrelease4:bo,fmrelease5:wo,fmrelease6:Go,fmrelease7:vo,fmrelease8:xo,fmsus:io,fmsus1:ao,fmsus2:oo,fmsus3:ro,fmsus4:co,fmsus5:lo,fmsus6:uo,fmsus7:po,fmsus8:ho,fmsustain:Ea,fmsustain1:Aa,fmsustain2:qa,fmsustain3:Qa,fmsustain4:Da,fmsustain5:eo,fmsustain6:to,fmsustain7:no,fmsustain8:so,fmwave:xa,fmwave1:Xa,fmwave2:Za,fmwave3:ka,fmwave4:za,fmwave5:Ma,fmwave6:La,fmwave7:Ra,fmwave8:Sa,frameRate:gp,frames:bp,freeze:ap,freq:Gl,fshift:Fu,fshiftnote:Ou,fshiftphase:Eu,ftype:yc,fxr:vd,gain:gi,gat:Wl,gate:Nl,getControlName:Ie,harmonic:Ul,hbrick:fp,hcutoff:Oc,hold:Uo,hours:wp,hp:Ac,hpa:Er,hpattack:Or,hpd:tc,hpdc:Pc,hpdecay:ec,hpdepth:Hc,hpdepthfreq:Ic,hpdepthfrequency:Yc,hpe:Br,hpenv:Ur,hpf:Ec,hpq:Qc,hpr:hc,hprate:Cc,hprelease:dc,hps:rc,hpshape:Kc,hpskew:_c,hpsustain:oc,hpsync:Vc,hresonance:qc,imag:lp,ir:xu,irbegin:ku,iresponse:Xu,irspeed:Zu,isControlName:Xs,kcutoff:Qu,krush:qu,label:Il,lbrick:yp,legato:Mp,leslie:Cl,lfo:md,lock:pl,loop:Ao,loopBegin:qo,loopEnd:Do,loopb:Qo,loope:er,lp:Kr,lpa:Fr,lpattack:$r,lpd:Dr,lpdc:Zc,lpdecay:Qr,lpdepth:Gc,lpdepthfreq:xc,lpdepthfrequency:vc,lpe:_r,lpenv:Pr,lpf:Ir,lpq:el,lpr:pc,lprate:bc,lprelease:uc,lps:ac,lpshape:Xc,lpskew:kc,lpsustain:ic,lpsync:wc,lrate:Vl,lsize:Hl,midibend:rd,midichan:Fp,midicmd:Ap,midimap:Op,midiport:Ep,miditouch:cd,minutes:Gp,mode:mu,mtranspose:Pl,n:di,noise:Jc,note:hi,nrpnn:td,nrpv:nd,nudge:Jl,oct:Fl,octave:$l,octaveR:jl,octaves:hu,octer:Du,octersub:ep,octersubsub:tp,offset:du,orbit:Ol,oschost:ud,oscport:pd,overgain:Ql,overshape:Dl,pan:eu,panchor:Tl,panorient:iu,panspan:tu,pansplay:nu,panwidth:su,patt:xl,pattack:vl,pcurve:Sl,pdec:Zl,pdecay:Xl,penv:Rl,ph:kr,phasdp:Wr,phaser:zr,phasercenter:Rr,phaserdepth:Tr,phaserrate:Zr,phasersweep:Mr,phc:Sr,phd:Nr,phs:Lr,pitchJump:Wp,pitchJumpTime:Cp,polyTouch:ld,postgain:bi,prel:Ll,prelease:Ml,progNum:sd,psus:zl,psustain:kl,pw:vr,pwrate:xr,pwsweep:Xr,rdim:wu,real:cp,registerControl:r,registerMultiControl:ie,rel:_o,release:Po,resonance:Dc,rfade:vu,ring:np,ringdf:ip,ringf:sp,rlp:gu,room:fu,roomdim:bu,roomfade:Gu,roomlp:yu,roomsize:zu,rsize:Ru,s:Zs,scram:hp,scrub:hd,seconds:vp,semitone:ou,shape:Su,size:Mu,slide:au,smear:dp,songPtr:xp,sound:ks,source:ui,speed:It,spread:fl,squiz:Uu,src:pi,stepsPerOctave:Bl,stretch:Pu,sus:Ko,sustain:Io,sustainpedal:$u,sysex:id,sysexdata:od,sysexid:ad,sz:Lu,transient:gd,trem:ir,tremolo:sr,tremolodepth:or,tremolophase:cr,tremoloshape:lr,tremoloskew:rr,tremolosync:ar,triode:Au,tsdelay:rp,uid:Xp,unison:ml,unit:_u,v:jc,val:Zp,vel:yi,velocity:fi,vib:Uc,vibmod:$c,vibrato:Bc,vmod:Fc,voice:ru,vowel:Bu,warp:Bs,warpatt:$s,warpattack:Js,warpdc:ni,warpdec:Os,warpdecay:Fs,warpdepth:ei,warpenv:ci,warpmode:ii,warprate:Ds,warprel:Qs,warprelease:qs,warpshape:ti,warpskew:si,warpsus:As,warpsustain:Es,warpsync:li,waveloss:ju,wavetablePhaseRand:ri,wavetablePosition:Ms,wavetableWarp:js,wavetableWarpMode:ai,wt:zs,wtatt:Ss,wtattack:Rs,wtdc:_s,wtdec:Ns,wtdecay:Ts,wtdepth:Ks,wtenv:Ls,wtphaserand:oi,wtrate:Ys,wtrel:Hs,wtrelease:Vs,wtshape:Ps,wtskew:Us,wtsus:Cs,wtsustain:Ws,wtsync:Is,xsdelay:op,zcrush:Yp,zdelay:Ip,zmod:Hp,znoise:Vp,zrand:Sp,zzfx:Kp},Symbol.toStringTag,{value:"Module"})),ew=function(e,t){const[n,s]=e,[i,a]=t,[o,l]=Lt(s,i);return[[s,n-s],[qe((c,u)=>c.concat(u),o,a),l]]},tw=function(e,t){const[n,s]=e,[i,a]=t,[o,l]=Lt(n,a);return[[n,s-n],[qe((c,u)=>c.concat(u),i,o),l]]},xd=function(e,t){const[n,s]=e;return Math.min(n,s)<=1?[e,t]:xd(...n>s?ew(e,t):tw(e,t))},Pt=function(e,t){const n=e<0,s=Math.abs(e),i=t-s,a=Array(s).fill([1]),o=Array(i).fill([0]),l=xd([s,i],[a,o]),c=re(l[1][0]).concat(re(l[1][1]));return n?c.map(u=>1-u):c},tt=function(e,t,n){const s=Pt(e,t);return n?Hn(s,-n):s},nw=p("euclid",function(e,t,n){return n.struct(tt(e,t,0))}),sw=p("bjork",function(e,t){Array.isArray(e)||(e=[e]);const[n,s=n,i=0]=e;return t.struct(tt(n,s,i))}),{euclidrot:iw,euclidRot:aw}=p(["euclidrot","euclidRot"],function(e,t,n,s){return s.struct(tt(e,t,n))}),Xd=function(e,t,n,s){if(e<1)return L;const i=tt(e,t,0).join("").split("1").slice(1).map(a=>[a.length+1,!0]);return s.struct(ws(...i)).late(g(n).div(t))},ow=p(["euclidLegato"],function(e,t,n){return Xd(e,t,0,n)}),rw=p(["euclidLegatoRot"],function(e,t,n,s){return Xd(e,t,n,s)}),{euclidish:cw,eish:lw}=p(["euclidish","eish"],function(e,t,n,s){const i=Ht(Pt(e,t),new Array(e).fill(1),n);return s.struct(i).setSteps(t)});function Zd(e,t,n=.05,s=.1,i=.1,a=globalThis.setInterval,o=globalThis.clearInterval,l=!0){let c=0,u=0,d=10**4,h=.01;const x=Y=>n=Y(n);i=i||s/2;const Z=()=>{const Y=e(),I=Y+s+i;for(u===0&&(u=Y+h);u<I;)u=l?Math.round(u*d)/d:u,t(u,n,c,Y),u+=n,c++};let v;const T=()=>{C(),Z(),v=a(Z,s*1e3)},C=()=>{v!==void 0&&o(v),v=void 0};return{setDuration:x,start:T,stop:()=>{c=0,u=0,C()},pause:()=>C(),duration:n,interval:s,getPhase:()=>u,minLatency:h}}class kd{constructor({interval:t,onTrigger:n,onToggle:s,onError:i,getTime:a,latency:o=.1,setInterval:l,clearInterval:c,beforeStart:u}){this.started=!1,this.beforeStart=u,this.cps=.5,this.num_ticks_since_cps_change=0,this.lastTick=0,this.lastBegin=0,this.lastEnd=0,this.getTime=a,this.num_cycles_at_cps_change=0,this.seconds_at_cps_change,this.onToggle=s,this.latency=o,this.clock=Zd(a,(d,h,x,Z)=>{this.num_ticks_since_cps_change===0&&(this.num_cycles_at_cps_change=this.lastEnd,this.seconds_at_cps_change=d),this.num_ticks_since_cps_change++;const v=this.num_ticks_since_cps_change*h*this.cps;try{const T=this.lastEnd;this.lastBegin=T;const C=this.num_cycles_at_cps_change+v;if(this.lastEnd=C,this.lastTick=d,d<Z){console.log("skip query: too late");return}this.pattern.queryArc(T,C,{_cps:this.cps,cyclist:"cyclist"}).forEach(Y=>{if(Y.hasOnset()){const I=(Y.whole.begin-this.num_cycles_at_cps_change)/this.cps+this.seconds_at_cps_change+o,me=Y.duration/this.cps,j=I-d;n==null||n(Y,j,me,this.cps,I),Y.value.cps!==void 0&&this.cps!=Y.value.cps&&(this.cps=Y.value.cps,this.num_ticks_since_cps_change=0)}})}catch(T){Ee(T),i==null||i(T)}},t,.1,.1,l,c)}now(){if(!this.started)return 0;const t=this.getTime()-this.lastTick-this.clock.duration;return this.lastBegin+t*this.cps}setStarted(t){var n;this.started=t,(n=this.onToggle)==null||n.call(this,t)}async start(){var t;if(await((t=this.beforeStart)==null?void 0:t.call(this)),this.num_ticks_since_cps_change=0,this.num_cycles_at_cps_change=0,!this.pattern)throw new Error("Scheduler: no pattern set! call .setPattern first.");$("[cyclist] start"),this.clock.start(),this.setStarted(!0)}pause(){$("[cyclist] pause"),this.clock.pause(),this.setStarted(!1)}stop(){$("[cyclist] stop"),this.clock.stop(),this.lastEnd=0,this.setStarted(!1)}async setPattern(t,n=!1){this.pattern=t,n&&!this.started&&await this.start()}setCps(t=.5){this.cps!==t&&(this.cps=t,this.num_ticks_since_cps_change=0)}log(t,n,s){const i=s.filter(a=>a.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(i.length).fill("I").join("")}`)}}let Te={};const zd=function(){Md()},Md=function(){Te={}},uw=p("timeline",function(e,t){e=y(e);const n=function(s){const i=!!s.controls.cyclist,a=e.query(s),o=[];for(const l of a){const c=l.value;let u;if(c===0)u=0;else if(c in Te)u=Te[c];else{const h=l.wholeOrPart();!i||s.span.begin.lt(h.midpoint())?u=h.begin:u=h.end}i&&(Te[c]=u,c!==0&&delete Te[-c]);const d=t.late(u).query(s.setSpan(l.part)).map(h=>h.setContext(h.combineContext(l)));o.push(...d)}return o};return new f(n,t._steps)},!1),ae=function(e,t,n=!0){const s=Array.isArray(e),i=Object.keys(e).length;return e=jn(e,y),i===0?L:t.fmap(a=>{let o=a;return s&&(o=n?Math.round(o)%i:Pn(Math.round(o),0,e.length-1)),e[o]})},Ld=function(e,t){return Array.isArray(t)&&([t,e]=[e,t]),pw(e,t)},pw=p("pick",function(e,t){return ae(e,t,!1).innerJoin()}),Rd=p("pickmod",function(e,t){return ae(e,t,!0).innerJoin()}),dw=p("pickF",function(e,t,n){return n.apply(Ld(e,t))}),hw=p("pickmodF",function(e,t,n){return n.apply(Rd(e,t))}),mw=p("pickOut",function(e,t){return ae(e,t,!1).outerJoin()}),fw=p("pickmodOut",function(e,t){return ae(e,t,!0).outerJoin()}),yw=p("pickRestart",function(e,t){return ae(e,t,!1).restartJoin()}),gw=p("pickmodRestart",function(e,t){return ae(e,t,!0).restartJoin()}),bw=p("pickReset",function(e,t){return ae(e,t,!1).resetJoin()}),ww=p("pickmodReset",function(e,t){return ae(e,t,!0).resetJoin()}),{inhabit:Gw,pickSqueeze:vw}=p(["inhabit","pickSqueeze"],function(e,t){return ae(e,t,!1).squeezeJoin()}),{inhabitmod:xw,pickmodSqueeze:Xw}=p(["inhabitmod","pickmodSqueeze"],function(e,t){return ae(e,t,!0).squeezeJoin()}),Zw=(e,t)=>(t=t.map(y),t.length==0?L:e.fmap(n=>{const s=Pe(Math.round(n),t.length);return t[s]}).squeezeJoin());class kw{constructor({onTrigger:t,onToggle:n,getTime:s}){this.started=!1,this.cps=.5,this.getTime=s,this.time_at_last_tick_message=0,this.collator=new Jn({getTargetClockTime:s}),this.onToggle=n,this.latency=.1,this.cycle=0,this.id=Math.round(Date.now()*Math.random()),this.worker=new SharedWorker(new URL(""+new URL("data:text/javascript;base64,KGZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIEwoKXtyZXR1cm4gcGVyZm9ybWFuY2Uubm93KCkqLjAwMX1sZXQgXz0wLHI9MCxvPS41O2NvbnN0IGg9bmV3IE1hcCxtPS4xLE09bmV3IEJyb2FkY2FzdENoYW5uZWwoInN0cnVkZWx0aWNrIiksYj0ocyxlKT0+e00ucG9zdE1lc3NhZ2Uoe3R5cGU6cyxwYXlsb2FkOmV9KX0sQz1FKEwsKHMsZSx0LG4pPT57Y29uc3QgaT1yKmUsZD1zLW4sYz1uK2QsdT1pKm8sbD1fK3UsZz1uLWMtZSxmPWUqbyxwPWwrZix5PWwrZypvO2IoInRpY2siLHtiZWdpbjpsLGVuZDpwLGNwczpvLHRpbWU6bixjeWNsZTp5fSkscisrfSxtKTtsZXQgaz0hMTtjb25zdCBJPXM9PntoLnNldChzLHtzdGFydGVkOiEwfSksIWsmJihDLnN0YXJ0KCksaz0hMCl9LEE9YXN5bmMgcz0+e2guc2V0KHMse3N0YXJ0ZWQ6ITF9KTtjb25zdCBlPUFycmF5LmZyb20oaC52YWx1ZXMoKSkuc29tZSh0PT50LnN0YXJ0ZWQpOyFrfHxlfHwoQy5zdG9wKCksdygwKSxrPSExKX0sdz1zPT57cj0wLF89c30sRD1zPT57Y29uc3R7dHlwZTplLHBheWxvYWQ6dH09cztzd2l0Y2goZSl7Y2FzZSJjcHNjaGFuZ2UiOntpZih0LmNwcyE9PW8pe2NvbnN0IG49ciptO189XytuKm8sbz10LmNwcyxyPTB9YnJlYWt9Y2FzZSJzZXRjeWNsZSI6e3codC5jeWNsZSk7YnJlYWt9Y2FzZSJ0b2dnbGUiOnt0LnN0YXJ0ZWQ/SShzLmlkKTpBKHMuaWQpO2JyZWFrfX19O3NlbGYub25jb25uZWN0PWZ1bmN0aW9uKHMpe2NvbnN0IGU9cy5wb3J0c1swXTtlLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLGZ1bmN0aW9uKHQpe0QodC5kYXRhKX0pLGUuc3RhcnQoKX07ZnVuY3Rpb24gRShzLGUsdD0uMDUsbj0uMSxpPS4xKXtsZXQgZD0wLGM9MCx1PTEwKio0LGw9LjAxO2NvbnN0IGc9YT0+dD1hKHQpO2k9aXx8bi8yO2NvbnN0IGY9KCk9Pntjb25zdCBhPXMoKSxPPWErbitpO2ZvcihjPT09MCYmKGM9YStsKTtjPE87KWM9TWF0aC5yb3VuZChjKnUpL3UsYz49YSYmZShjLHQsZCxhKSxjPGEmJmNvbnNvbGUubG9nKCJUT08gTEFURSIsYyksYys9dCxkKyt9O2xldCBwO2NvbnN0IHk9KCk9PntUKCksZigpLHA9c2V0SW50ZXJ2YWwoZixuKjFlMyl9LFQ9KCk9PnAhPT12b2lkIDAmJmNsZWFySW50ZXJ2YWwocCk7cmV0dXJue3NldER1cmF0aW9uOmcsc3RhcnQ6eSxzdG9wOigpPT57ZD0wLGM9MCxUKCl9LHBhdXNlOigpPT5UKCksZHVyYXRpb246dCxpbnRlcnZhbDpuLGdldFBoYXNlOigpPT5jLG1pbkxhdGVuY3k6bH19fSkoKTsK",import.meta.url).href,import.meta.url)),this.worker.port.start(),this.channel=new BroadcastChannel("strudeltick");const i=o=>{const{cps:l,begin:c,end:u,cycle:d,time:h}=o;this.cps=l,this.cycle=d;const x=this.collator.calculateOffset(h)+h;a(c,u,x),this.time_at_last_tick_message=x},a=(o,l,c)=>{this.started!==!1&&this.pattern.queryArc(o,l,{_cps:this.cps,cyclist:"neocyclist"}).forEach(u=>{if(u.hasOnset()){const d=pt(u.whole.begin-this.cycle,this.cps)+c+this.latency,h=pt(u.duration,this.cps);t==null||t(u,0,h,this.cps,d)}})};this.channel.onmessage=o=>{if(!this.started)return;const{payload:l,type:c}=o.data;switch(c){case"tick":i(l)}}}sendMessage(t,n){this.worker.port.postMessage({type:t,payload:n,id:this.id})}now(){const t=(this.getTime()-this.time_at_last_tick_message)*this.cps;return this.cycle+t}setCps(t=1){this.sendMessage("cpschange",{cps:t})}setCycle(t){this.sendMessage("setcycle",{cycle:t})}setStarted(t){var n;this.sendMessage("toggle",{started:t}),this.started=t,(n=this.onToggle)==null||n.call(this,t)}start(){$("[cyclist] start"),this.setStarted(!0)}stop(){$("[cyclist] stop"),this.collator.reset(),this.setStarted(!1)}setPattern(t,n=!1){this.pattern=t,n&&!this.started&&this.start()}log(t,n,s){const i=s.filter(a=>a.hasOnset());console.log(`${t.toFixed(4)} - ${n.toFixed(4)} ${Array(i.length).fill("I").join("")}`)}}let gt,Oe,Sd,Td,Nd;function zw(){if(!gt)throw new Error("no time set! use setTime to define a time source");return gt()}function bt(e){gt=e}function Wd(e){Oe=e}function Mw(){return Oe==null?void 0:Oe()}function Cd(e){Sd=e}function Lw(){return Sd}function Vd(e){Td=e}function Rw(){return Td}function Hd(e){Nd=!!e}function Sw(){return Nd}function Tw({defaultOutput:e,onEvalError:t,beforeEval:n,beforeStart:s,afterEval:i,getTime:a,transpiler:o,onToggle:l,editPattern:c,onUpdateState:u,sync:d=!1,setInterval:h,clearInterval:x,id:Z,mondo:v=!1}){const T=new uy({localScope:!0}),C={schedulerError:void 0,evalError:void 0,code:"// LOADING",activeCode:"// LOADING",pattern:void 0,miniLocations:[],widgets:[],pending:!1,started:!1},Y={id:Z},I=k=>{Object.assign(C,k),C.isDirty=C.code!==C.activeCode,C.error=C.evalError||C.schedulerError,u==null||u(C)},me={onTrigger:Yd({defaultOutput:e,getTime:a}),getTime:a,onToggle:k=>{I({started:k}),Hd(k),l==null||l(k),k||zd()},setInterval:h,clearInterval:x,beforeStart:s},j=d&&typeof SharedWorker<"u"?new kw(me):new kd(me);Vd(me.onTrigger),Wd(()=>j.cps);let Be={},it=0,we;const qt=function(){return Be={},it=0,we=void 0,L},Dd=k=>T.evaluate(k).compile({log:!1});function Qt(k){return k._Pattern?k.__pure:k}const Dt=async(k,N=!0)=>(k=(c==null?void 0:c(k))||k,await j.setPattern(k,N),Cd(k),k);bt(()=>j.now());const eh=()=>j.stop(),th=()=>j.start(),nh=()=>j.pause(),sh=()=>j.toggle(),at=k=>(j.setCps(Qt(k)),L),en=k=>(j.setCps(Qt(k)/60),L);let je=[];const ih=function(k){return je.push(k),L},ah=function(k){return we=k,L},oh=()=>{f.prototype.p=function(N){return typeof N=="string"&&(N.startsWith("_")||N.endsWith("_"))?L:(N.includes("$")&&(N=`${N}${it}`,it++),Be[N]=this,this)},f.prototype.q=function(N){return L};try{for(let N=1;N<10;++N)Object.defineProperty(f.prototype,`d${N}`,{get(){return this.p(N)},configurable:!0}),Object.defineProperty(f.prototype,`p${N}`,{get(){return this.p(N)},configurable:!0}),f.prototype[`q${N}`]=L}catch(N){console.warn("injectPatternMethods: error:",N)}const k=p("cpm",function(N,ot){return ot._fast(N/60/j.cps)});return En({all:ih,each:ah,hush:qt,cpm:k,setCps:at,setcps:at,setCpm:en,setcpm:en,compileKabel:Dd})};return{scheduler:j,evaluate:async(k,N=!0,ot=!0)=>{if(!k)throw new Error("no code to evaluate");try{I({code:k,pending:!0}),await oh(),bt(()=>j.now()),await(n==null?void 0:n({code:k})),je=[],ot&&qt(),v&&(k=`mondolang\`${k}\``);let{pattern:B,meta:fe}=await An(k,o,Y);if(Object.keys(Be).length){let ye=[],Je=!1;for(const[Re,rh]of Object.entries(Be)){const tn=Re.length>1&&Re.startsWith("S");if(tn&&Je===!1&&(ye=[],Je=!0),!Je||Je&&tn){const ch=rh.withState(lh=>lh.setControls({id:Re}));ye.push(ch)}}we&&(ye=ye.map(Re=>we(Re))),B=K(...ye)}else we&&(B=we(B));if(je.length)for(const ye of je)B=ye(B);return Tt(B)||(B=L),$("[eval] code updated"),B=await Dt(B,N),I({miniLocations:(fe==null?void 0:fe.miniLocations)||[],widgets:(fe==null?void 0:fe.widgets)||[],activeCode:k,pattern:B,evalError:void 0,schedulerError:void 0,pending:!1}),i==null||i({code:k,pattern:B,meta:fe}),B}catch(B){$(`[eval] error: ${B.message}`,"error"),console.error(B),I({evalError:B,pending:!1}),t==null||t(B)}},start:th,stop:eh,pause:nh,setCps:at,setPattern:Dt,setCode:k=>I({code:k}),toggle:sh,state:C}}const Yd=({getTime:e,defaultOutput:t})=>async(n,s,i,a,o)=>{try{(!n.context.onTrigger||!n.context.dominantTrigger)&&await t(n,s,i,a,o),n.context.onTrigger&&await n.context.onTrigger(n,e(),a,o)}catch(l){Ee(l,"getTrigger")}};function Nw(e){return new f(t=>[new S(void 0,t.span,e)])}const F=e=>{const t=n=>[new S(void 0,n.span,e(n.span.begin,n.controls))];return new f(t)},Ue=F(e=>e%1),_t=Ue.toBipolar(),nt=F(e=>1-e%1),Ut=nt.toBipolar(),Bt=F(e=>Math.sin(Math.PI*2*e)),Id=Bt.fromBipolar(),Ww=Id._early(g(1).div(4)),Cw=Bt._early(g(1).div(4)),Kd=F(e=>Math.floor(e*2%2)),Vw=Kd.toBipolar(),Hw=A(Ue,nt),Yw=A(_t,Ut),Iw=A(nt,Ue),Kw=A(Ut,_t),Pw=F(xe);let jt=0,Jt=0;typeof window<"u"&&document.addEventListener("mousemove",e=>{jt=e.clientY/document.body.clientHeight,Jt=e.clientX/document.body.clientWidth});const _w=F(()=>jt),Uw=F(()=>jt),Bw=F(()=>Jt),jw=F(()=>Jt),Jw=e=>(e|=0,e^=e>>>16,e=Math.imul(e,2246822507),e^=e>>>13,e=Math.imul(e,3266489909),e^=e>>>16,e>>>0),$w=e=>Math.floor(e*536870912),Fw=(e,t=0,n=0)=>{const s=e>>>0>>>0,i=Math.floor(e/4294967296)>>>0;let a=s^Math.imul(i^2246822507,3266489909);return a^=Math.imul(t^2135587861,2654435769),a^=Math.imul(n^374761393,668265261),a>>>0},pn=(e,t=0,n=0)=>Jw(Fw(e,t,n))/4294967296,Ow=(e,t,n=0)=>{const s=$w(e);if(t===1)return pn(s,0,n);const i=new Array(t);for(let a=0;a<t;a++)i[a]=pn(s,a,n);return i},Pd=e=>{const t=e<<13^e,n=t>>17^t;return n<<5^n},Ew=e=>e-Math.trunc(e),Aw=e=>Pd(Math.trunc(Ew(e/300)*536870912)),dn=e=>e%536870912/536870912,qw=(e,t)=>{if(t===1)return Math.abs(dn(e));const n=[];for(let s=0;s<t;s++)n.push(dn(e)),e=Pd(e);return n},Qw=(e,t)=>qw(Aw(e),t);let _d="legacy";const pe=(e,t=1,n=0)=>_d==="legacy"?Qw(e+n,t):Ow(e,t,n),Dw=(e="legacy")=>_d=e,Ud=e=>Ue.range(0,e).round().segment(e),e1=e=>{const t=y(e).log2(0).floor().add(1);return Bd(e,t)},Bd=(e,t=16)=>{t=y(t);const n=Ud(t).mul(-1).add(t.sub(1));return y(e).segment(t).brshift(n).band(V(1))},t1=e=>{const t=y(e).log2(0).floor().add(1);return jd(e,t)},jd=(e,t=16)=>y(e).withValue(n=>s=>{const i=[];for(let a=s-1;a>=0;a--)i.push(n>>a&1);return i}).appLeft(y(t)),n1=e=>F(t=>n=>pe(t,n).map(Math.abs)).appLeft(y(e)),Jd=e=>F((t,n)=>{const s=pe(t.floor().add(.5),e,n.randSeed).map((a,o)=>[a,o]).sort((a,o)=>(a[0]>o[0])-(a[0]<o[0])).map(a=>a[1]),i=t.cyclePos().mul(e).floor()%e;return s[i]})._segment(e),$d=(e,t,n)=>{const s=[...Array(t).keys()].map(i=>n.zoom(g(i).div(t),g(i+1).div(t)));return e.fmap(i=>s[i].repeatCycles(t)._fast(t)).innerJoin()},s1=p("shuffle",(e,t)=>$d(Jd(e),e,t)),i1=p("scramble",(e,t)=>$d(Ft(e)._segment(e),e,t)),Fd=(e,t)=>new f(n=>{let{randSeed:s,...i}=n.controls;return s=e(s),t.query(n.setControls({...i,randSeed:s}))},t._steps),a1=p("seed",(e,t)=>Fd(()=>e,t)),D=F((e,t)=>pe(e,1,t.randSeed)),o1=D.toBipolar(),$t=e=>D.fmap(t=>t<e),r1=e=>y(e).fmap($t).innerJoin(),c1=$t(.5),Ft=e=>D.fmap(t=>Math.trunc(t*e)),l1=e=>y(e).fmap(Ft).innerJoin(),Ot=(e,t)=>(t=t.map(y),t.length==0?L:e.range(0,t.length).fmap(n=>{const s=Math.min(Math.max(Math.floor(n),0),t.length-1);return t[s]})),st=(e,t)=>Ot(e,t).outerJoin(),Et=(e,t)=>Ot(e,t).innerJoin(),Od=(...e)=>st(D,e),u1=(...e)=>Et(D,e),p1=Od;f.prototype.choose=function(...e){return st(this,e)};f.prototype.choose2=function(...e){return st(this.fromBipolar(),e)};const Ed=(...e)=>Et(D.segment(1),e),d1=Ed,Ad=function(e,...t){const n=t.map(l=>y(l[0])),s=[];let i=V(0);for(const l of t)i=i.add(l[1]),s.push(i);const a=qn(s),o=function(l){const c=i.mul(l);return a.fmap(u=>d=>n[u.findIndex(h=>h>d,u)]).appLeft(c)};return e.bind(o)},h1=(...e)=>Ad(...e).outerJoin(),m1=(...e)=>h1(D,...e),qd=(...e)=>Ad(D.segment(1),...e).innerJoin(),f1=qd;function y1(e,t=0){let n=Math.floor(e),s=n+1;const i=c=>6*c**5-15*c**4+10*c**3,a=c=>u=>d=>u+i(c)*(d-u),o=pe(n,1,t),l=pe(s,1,t);return a(e-n)(o)(l)}function g1(e,t=0){const n=Math.floor(e),s=n+1,i=pe(n,1,t),a=pe(s,1,t),o=i+a,l=(e-n)/(s-n);return((c,u,d)=>c+d*(u-c))(i,o,l)/2}const b1=F((e,t)=>y1(e,t.randSeed)),w1=F((e,t)=>g1(e,t.randSeed)),G1=p("degradeByWith",(e,t,n)=>n.fmap(s=>i=>s).appLeft(e.filterValues(s=>s>t)),!0,!0),v1=p("degradeBy",function(e,t){return t._degradeByWith(D,e)},!0,!0),x1=p("degrade",e=>e._degradeBy(.5),!0,!0),X1=p("undegradeBy",function(e,t){return t._degradeByWith(D.fmap(n=>1-n),e)},!0,!0),Z1=p("undegrade",e=>e._undegradeBy(.5),!0,!0),k1=p("sometimesBy",function(e,t,n){return y(e).fmap(s=>K(n._degradeBy(s),t(n._undegradeBy(1-s)))).innerJoin()}),z1=p("sometimes",function(e,t){return t._sometimesBy(.5,e)}),M1=p("someCyclesBy",function(e,t,n){return y(e).fmap(s=>K(n._degradeByWith(D._segment(1),s),t(n._degradeByWith(D.fmap(i=>1-i)._segment(1),1-s)))).innerJoin()}),L1=p("someCycles",function(e,t){return t._someCyclesBy(.5,e)}),R1=p("often",function(e,t){return t.sometimesBy(.75,e)}),S1=p("rarely",function(e,t){return t.sometimesBy(.25,e)}),T1=p("almostNever",function(e,t){return t.sometimesBy(.1,e)}),N1=p("almostAlways",function(e,t){return t.sometimesBy(.9,e)}),W1=p("never",function(e,t){return t}),C1=p("always",function(e,t){return e(t)});function At(e){Array.isArray(e)===!1&&(e=[e]);const t=Fn();return e.every(n=>{const s=$n.get(n)??n;return t[s]})}const V1=p("whenKey",function(e,t,n){return n.when(At(e),t)}),H1=p("keyDown",function(e){return e.fmap(At)}),Y1=new f(function(e){return[new S(void 0,e.span,e.span.duration)]}),Qd=new f(function(e){return[new S(void 0,e.span,g(1).div(e.span.duration))]}),I1=Qd,K1=new f(function(e){const t=g(1).div(e.span.duration);return[new S(void 0,e.span,Math.log(t)/Math.log(2)+1)]});let Xe;try{Xe=window==null?void 0:window.speechSynthesis}catch{console.warn("cannot use window: not in browser?")}let hn=Xe==null?void 0:Xe.getVoices();function P1(e,t,n){Xe.cancel();const s=new SpeechSynthesisUtterance(e);s.lang=t,hn=Xe.getVoices();const i=hn.filter(a=>a.lang.includes(t));typeof n=="number"?s.voice=i[n%i.length]:typeof n=="string"&&(s.voice=i.find(a=>a.name===a)),speechSynthesis.speak(s)}const _1=p("speak",function(e,t,n){return n.onTrigger(s=>{P1(s.value,e,t)})}),U1=function(e,t={}){const n=document.getElementById("code"),s="background-image:url("+e+");background-size:contain;";n.style=s;const{className:i}=n,a=(l,c)=>{({style:()=>n.style=s+";"+c,className:()=>n.className=c+" "+i})[l]()},o=Object.entries(t).filter(([l,c])=>typeof c=="function");Object.entries(t).filter(([l,c])=>typeof c=="string").forEach(([l,c])=>a(l,c)),o.length},B1=()=>{const e=document.getElementById("code");e&&(e.style="")};$(" @strudel/core loaded ");globalThis._strudelLoaded&&console.warn(`@strudel/core was loaded more than once...
This might happen when you have multiple versions of strudel installed. 
Please check with "npm ls @strudel/core".`);globalThis._strudelLoaded=!0;const q1=Object.freeze(Object.defineProperty({__proto__:null,ClockCollator:Jn,Cyclist:kd,FXr:Gd,FXrel:wd,FXrelease:bd,Fraction:g,Hap:S,Pattern:f,State:ke,TimeSpan:H,__chooseWith:Ot,_brandBy:$t,_fitslice:as,_irand:Ft,_keyDown:At,_match:os,_mod:Pe,_morph:Ht,_polymeterListSteps:cs,_retime:mt,_slices:ft,accelerate:mi,activeLabel:Yl,ad:jp,add:mg,adsr:Bp,almostAlways:N1,almostNever:T1,always:C1,amp:wi,analyze:Co,anchor:pu,and:Wg,apply:l0,applyN:is,ar:$p,arp:Fy,arpWith:$y,arrange:Dy,as:dd,asym:Ub,att:vi,attack:Gi,averageArray:Cn,backgroundImage:U1,band:Gg,bandf:Bo,bandq:$o,bank:No,base64ToUnicode:Bn,bbexpr:yr,bbst:br,beat:Hb,begin:Oo,berlin:w1,bgain:ql,binary:e1,binaryL:t1,binaryN:Bd,binaryNL:jd,bind:ag,binshift:mp,bite:f0,bjork:sw,bjorklund:Pt,blshift:Xg,bmod:yd,bor:vg,bp:Jo,bpa:qr,bpattack:Ar,bpd:sc,bpdc:Nc,bpdecay:nc,bpdepth:Lc,bpdepthfreq:Sc,bpdepthfrequency:Rc,bpe:Jr,bpenv:jr,bpf:jo,bpq:Fo,bpr:fc,bprate:zc,bprelease:mc,bps:lc,bpshape:Tc,bpskew:Wc,bpsustain:cc,bpsync:Mc,brak:k0,brand:c1,brandBy:r1,brshift:Zg,bus:El,busgain:Al,bxor:xg,bypass:nb,byteBeatExpression:fr,byteBeatStartTime:gr,calculateSteps:Uy,cat:He,ccn:Qp,ccv:Dp,ceil:Ig,ch:Gr,channel:Cr,channels:wr,chebyshev:Jb,choose:Od,chooseCycles:Ed,chooseIn:u1,chooseInWith:Et,chooseOut:p1,chooseWith:st,chop:zb,chord:cu,chorus:Wo,chunk:J0,chunkBack:O0,chunkBackInto:tb,chunkInto:D0,chunkback:E0,chunkbackinto:eb,chunkinto:Q0,clamp:Pn,cleanupUi:B1,clip:zp,coarse:nr,code2hash:Cy,color:Pp,colour:_p,comb:pp,compose:xy,compress:Jg,compressSpan:$g,compressor:Vu,compressorAttack:Iu,compressorKnee:Hu,compressorRatio:Yu,compressorRelease:Ku,compressspan:Fg,constant:Xy,contract:ms,control:qp,controls:Db,cosine:Ww,cosine2:Cw,cpm:u0,cps:kp,createClock:Zd,createParam:et,createParams:Up,crush:tr,ctf:Yr,ctlNum:ed,ctranspose:_l,cubic:Pb,curry:X,curve:Tp,cut:Vr,cutoff:Hr,cycleToSeconds:pt,cyclesPer:Y1,dec:Yo,decay:Ho,degrade:x1,degradeBy:v1,degradeByWith:G1,degree:Kl,delay:nl,delayfb:il,delayfeedback:sl,delayspeed:ol,delaysync:ul,delayt:cl,delaytime:rl,deltaSlide:Np,det:hl,detune:dl,dfb:al,dict:uu,dictionary:lu,diode:_b,dist:Nu,distort:Tu,distorttype:Cu,distortvol:Wu,div:gg,djf:tl,drawLine:On,drive:ur,drop:ps,dry:yl,ds:Jp,dt:ll,duck:pr,duckattack:mr,duckdepth:dr,duckonset:hr,dur:Rp,duration:Lp,early:p0,echo:Y0,echoWith:W0,echowith:C0,eish:lw,end:Eo,enhance:up,env:fd,eq:Rg,eqt:Sg,errorLogger:Ee,euclid:nw,euclidLegato:ow,euclidLegatoRot:rw,euclidRot:aw,euclidish:cw,euclidrot:iw,evalScope:En,evaluate:An,every:c0,expand:hs,expression:Ju,extend:ds,fadeInTime:wl,fadeOutTime:bl,fadeTime:gl,fanchor:gc,fast:e0,fastChunk:q0,fastGap:Og,fastcat:A,fastchunk:A0,fastgap:Eg,fft:Vo,filter:rb,filterWhen:cb,firstOf:r0,fit:Tb,flatten:re,floor:Yg,fm:Pi,fm1:_i,fm2:Ui,fm3:Bi,fm4:ji,fm5:Ji,fm6:$i,fm7:Fi,fm8:Oi,fmatt:ha,fmatt1:ma,fmatt2:fa,fmatt3:ya,fmatt4:ga,fmatt5:ba,fmatt6:wa,fmatt7:Ga,fmatt8:va,fmattack:ia,fmattack1:aa,fmattack2:oa,fmattack3:ra,fmattack4:ca,fmattack5:la,fmattack6:ua,fmattack7:pa,fmattack8:da,fmdec:Pa,fmdec1:_a,fmdec2:Ua,fmdec3:Ba,fmdec4:ja,fmdec5:Ja,fmdec6:$a,fmdec7:Fa,fmdec8:Oa,fmdecay:Ta,fmdecay1:Na,fmdecay2:Wa,fmdecay3:Ca,fmdecay4:Va,fmdecay5:Ha,fmdecay6:Ya,fmdecay7:Ia,fmdecay8:Ka,fmenv:Ei,fmenv1:Ai,fmenv2:qi,fmenv3:Qi,fmenv4:Di,fmenv5:ea,fmenv6:ta,fmenv7:na,fmenv8:sa,fmh:xi,fmh1:Xi,fmh2:Zi,fmh3:ki,fmh4:zi,fmh5:Mi,fmh6:Li,fmh7:Ri,fmh8:Si,fmi:Ti,fmi1:Ni,fmi2:Wi,fmi3:Ci,fmi4:Vi,fmi5:Hi,fmi6:Yi,fmi7:Ii,fmi8:Ki,fmrel:Xo,fmrel1:Zo,fmrel2:ko,fmrel3:zo,fmrel4:Mo,fmrel5:Lo,fmrel6:Ro,fmrel7:So,fmrel8:To,fmrelease:mo,fmrelease1:fo,fmrelease2:yo,fmrelease3:go,fmrelease4:bo,fmrelease5:wo,fmrelease6:Go,fmrelease7:vo,fmrelease8:xo,fmsus:io,fmsus1:ao,fmsus2:oo,fmsus3:ro,fmsus4:co,fmsus5:lo,fmsus6:uo,fmsus7:po,fmsus8:ho,fmsustain:Ea,fmsustain1:Aa,fmsustain2:qa,fmsustain3:Qa,fmsustain4:Da,fmsustain5:eo,fmsustain6:to,fmsustain7:no,fmsustain8:so,fmwave:xa,fmwave1:Xa,fmwave2:Za,fmwave3:ka,fmwave4:za,fmwave5:Ma,fmwave6:La,fmwave7:Ra,fmwave8:Sa,focus:Ag,focusSpan:qg,focusspan:Qg,fold:Bb,fractionalArgs:Zy,frameRate:gp,frames:bp,freeze:ap,freq:Gl,freqToMidi:Nn,fromBipolar:Pg,fshift:Fu,fshiftnote:Ou,fshiftphase:Eu,ftype:yc,func:Vg,fxr:vd,gain:gi,gap:Me,gat:Wl,gate:Nl,getAccidentalsOffset:Tn,getControlName:Ie,getCps:Mw,getCurrentKeyboardState:Fn,getEventOffsetMs:yy,getFreq:Wn,getFrequency:vy,getIsStarted:Sw,getPattern:Lw,getPerformanceTimeSeconds:Hy,getPlayableNoteValue:Gy,getRandsAtTime:pe,getSoundIndex:wy,getTime:zw,getTrigger:Yd,getTriggerFunc:Rw,grow:pb,gt:zg,gte:Lg,hard:Kb,harmonic:Ul,hash2code:Vy,hbrick:fp,hcutoff:Oc,hold:Uo,hours:wp,hp:Ac,hpa:Er,hpattack:Or,hpd:tc,hpdc:Pc,hpdecay:ec,hpdepth:Hc,hpdepthfreq:Ic,hpdepthfrequency:Yc,hpe:Br,hpenv:Ur,hpf:Ec,hpq:Qc,hpr:hc,hprate:Cc,hprelease:dc,hps:rc,hpshape:Kc,hpskew:_c,hpsustain:oc,hpsync:Vc,hresonance:qc,hsl:ob,hsla:ab,hurry:t0,id:xe,imag:lp,inhabit:Gw,inhabitmod:xw,innerBind:og,inside:i0,inv:x0,invert:v0,ir:xu,irand:l1,irbegin:ku,iresponse:Xu,irspeed:Zu,isControlName:Xs,isNote:Ae,isNoteWithOctave:dy,isPattern:Tt,isaw:nt,isaw2:Ut,iter:_0,iterBack:U0,iterback:B0,itri:Iw,itri2:Kw,jux:N0,juxBy:S0,juxby:T0,kcutoff:Qu,keep:dg,keepif:hg,keyAlias:$n,keyDown:H1,krush:qu,label:Il,lastOf:o0,late:ns,lbrick:yp,legato:Mp,leslie:Cl,lfo:md,linger:y0,listRange:_e,lock:pl,logKey:kt,logger:$,loop:Ao,loopAt:Rb,loopAtCps:Nb,loopBegin:qo,loopEnd:Do,loopat:Sb,loopatcps:Wb,loopb:Qo,loope:er,lp:Kr,lpa:Fr,lpattack:$r,lpd:Dr,lpdc:Zc,lpdecay:Qr,lpdepth:Gc,lpdepthfreq:xc,lpdepthfrequency:vc,lpe:_r,lpenv:Pr,lpf:Ir,lpq:el,lpr:pc,lprate:bc,lprelease:uc,lps:ac,lpshape:Xc,lpskew:kc,lpsustain:ic,lpsync:wc,lrate:Vl,lsize:Hl,lt:kg,lte:Mg,mapArgs:Mt,mask:tg,midi2note:by,midiToFreq:Ve,midibend:rd,midichan:Fp,midicmd:Ap,midimap:Op,midiport:Ep,miditouch:cd,minutes:Gp,mod:bg,mode:mu,morph:Yb,mouseX:jw,mouseY:Uw,mousex:Bw,mousey:_w,mtranspose:Pl,mul:yg,n:di,nanFallback:Vn,ne:Tg,net:Ng,never:W1,noise:Jc,note:hi,noteToMidi:Ke,nothing:se,nrpnn:td,nrpv:nd,nudge:Jl,numeralArgs:q,objectMap:jn,oct:Fl,octave:$l,octaveR:jl,octaves:hu,octer:Du,octersub:ep,octersubsub:tp,off:Z0,offset:du,often:R1,or:Cg,orbit:Ol,oschost:ud,oscport:pd,outerBind:rg,outside:a0,overgain:Ql,overshape:Dl,pace:rs,pairs:Kn,palindrome:R0,pan:eu,panchor:Tl,panorient:iu,panspan:tu,pansplay:nu,panwidth:su,parray:Yt,parseFractional:In,parseNumeral:zt,partials:$b,patt:xl,pattack:vl,pcurve:Sl,pdec:Zl,pdecay:Xl,penv:Rl,per:Qd,perCycle:I1,perlin:b1,perx:K1,ph:kr,phasdp:Wr,phaser:zr,phasercenter:Rr,phaserdepth:Tr,phaserrate:Zr,phasersweep:Mr,phases:Fb,phc:Sr,phd:Nr,phs:Lr,pick:Ld,pickF:dw,pickOut:mw,pickReset:bw,pickRestart:yw,pickSqueeze:vw,pickmod:Rd,pickmodF:hw,pickmodOut:fw,pickmodReset:ww,pickmodRestart:gw,pickmodSqueeze:Xw,pipe:Yn,pitchJump:Wp,pitchJumpTime:Cp,ply:Dg,plyForEach:P0,plyWith:K0,pm:qy,polyBind:ug,polyTouch:ld,polymeter:Qe,polyrhythm:Ey,postgain:bi,pow:wg,pr:Ay,prel:Ll,prelease:Ml,press:L0,pressBy:M0,progNum:sd,psus:zl,psustain:kl,pure:V,pw:vr,pwrate:xr,pwsweep:Xr,rand:D,rand2:o1,randL:n1,randcat:d1,randrun:Jd,range:_g,range2:Bg,rangex:Ug,rarely:S1,ratio:jg,rdim:wu,real:cp,ref:Cb,register:p,registerControl:r,registerMultiControl:ie,reify:y,rel:_o,release:Po,removeUndefineds:ze,repeatCycles:j0,repl:Tw,replicate:ub,reset_state:zd,reset_timelines:Md,resonance:Dc,rev:ss,revv:z0,rfade:vu,rib:ib,ribbon:sb,ring:np,ringdf:ip,ringf:sp,rlp:gu,room:fu,roomdim:bu,roomfade:Gu,roomlp:yu,roomsize:zu,rotate:Hn,round:Hg,rsize:Ru,run:Ud,s:Zs,s_add:bb,s_alt:mb,s_cat:hb,s_contract:xb,s_expand:Gb,s_extend:vb,s_polymeter:fb,s_sub:wb,s_taper:yb,s_taperlist:gb,s_tour:Xb,s_zip:Zb,saw:Ue,saw2:_t,scram:hp,scramble:i1,scrub:hd,seconds:vp,seed:a1,seg:b0,segment:g0,semitone:ou,seq:ts,seqPLoop:eg,sequence:ce,sequenceP:qn,set:pg,setCpsFunc:Wd,setIsStarted:Hd,setPattern:Cd,setStringParser:By,setTime:bt,setTriggerFunc:Vd,shape:Su,shrink:ys,shrinklist:fs,shuffle:s1,signal:F,silence:L,sine:Id,sine2:Bt,sinefold:jb,size:Mu,slice:vs,slide:au,slow:n0,slowChunk:F0,slowcat:de,slowcatPrime:Wt,slowchunk:$0,smear:dp,soft:Ib,sol2note:Ty,someCycles:L1,someCyclesBy:M1,sometimes:z1,sometimesBy:k1,songPtr:xp,sound:ks,source:ui,sparsity:s0,speak:_1,speed:It,splice:Lb,splitAt:Lt,spread:fl,square:Kd,square2:Vw,squeeze:Zw,squeezeBind:cg,squiz:Uu,src:pi,stack:K,stackBy:Qy,stackCentre:es,stackLeft:Qn,stackRight:Dn,steady:Nw,stepBind:lg,stepalt:ls,stepcat:E,steps:kb,stepsPerOctave:Bl,stretch:Pu,striate:Mb,stringifyValues:Rt,struct:ng,strudelScope:St,stut:I0,stutWith:V0,stutwith:H0,sub:fg,superimpose:sg,sus:Ko,sustain:Io,sustainpedal:$u,swing:G0,swingBy:w0,sysex:id,sysexdata:od,sysexid:ad,sz:Lu,take:us,time:Pw,timeCat:ws,timecat:db,timeline:uw,toBipolar:Kg,tokenizeNote:Sn,tour:gs,transient:gd,trem:ir,tremolo:sr,tremolodepth:or,tremolophase:cr,tremoloshape:lr,tremoloskew:rr,tremolosync:ar,tri:Hw,tri2:Yw,triode:Au,tsdelay:rp,uid:Xp,undegrade:Z1,undegradeBy:X1,unicodeToBase64:Un,uniq:Ny,uniqsort:Wy,uniqsortr:_n,unison:ml,unit:_u,useRNG:Dw,v:jc,val:Zp,valueToMidi:fy,vel:yi,velocity:fi,vib:Uc,vibmod:$c,vibrato:Bc,vmod:Fc,voice:ru,vowel:Bu,warp:Bs,warpatt:$s,warpattack:Js,warpdc:ni,warpdec:Os,warpdecay:Fs,warpdepth:ei,warpenv:ci,warpmode:ii,warprate:Ds,warprel:Qs,warprelease:qs,warpshape:ti,warpskew:si,warpsus:As,warpsustain:Es,warpsync:li,waveloss:ju,wavetablePhaseRand:ri,wavetablePosition:Ms,wavetableWarp:js,wavetableWarpMode:ai,wchoose:m1,wchooseCycles:qd,when:X0,whenKey:V1,withSeed:Fd,withValue:ig,within:lb,worklet:Eb,wrandcat:f1,wt:zs,wtatt:Ss,wtattack:Rs,wtdc:_s,wtdec:Ns,wtdecay:Ts,wtdepth:Ks,wtenv:Ls,wtphaserand:oi,wtrate:Ys,wtrel:Hs,wtrelease:Vs,wtshape:Ps,wtskew:Us,wtsus:Cs,wtsustain:Ws,wtsync:Is,xfade:xs,xsdelay:op,zcrush:Yp,zdelay:Ip,zip:bs,zipWith:qe,zmod:Hp,znoise:Vp,zoom:d0,zoomArc:h0,zoomarc:m0,zrand:Sp,zzfx:Kp},Symbol.toStringTag,{value:"Module"}));export{q1 as A,Up as C,$ as E,Ae as M,A as N,An as O,Et as P,ce as Q,zw as W,Tn as Y,Nn as Z,V as a,Pn as b,ze as c,K as d,Pe as e,f,Ke as g,D as h,Ve as i,y as j,r as k,p as l,g as m,ws as n,Cb as o,Tt as p,L as q,vy as r,yy as t,Ie as y,Ee as z};
