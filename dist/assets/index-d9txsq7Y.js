const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/strudel-web-D2TLs97f.js","assets/strudel-core-DKU3hnf1.js","assets/index-DqhuNayL.js"])))=>i.map(i=>d[i]);
import{Z as mu}from"./strudel-web-D2TLs97f.js";import{v as rf,z as gu,h as ra,c as qb,G as Wb,W as vg,g as Xb,L as Sg,B as Ou,d as po,E as Hb}from"./strudel-core-DKU3hnf1.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const Yb="modulepreload",Kb=function(n){return"/"+n},af={},rn=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let a=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=a(t.map(c=>{if(c=Kb(c),c in af)return;af[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Yb,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((f,m)=>{d.addEventListener("load",f),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})},zt={elements:[{id:"element-1",selector:'[data-sound-id="element-1"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-2",selector:'[data-sound-id="element-2"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-3",selector:'[data-sound-id="element-3"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-4",selector:'[data-sound-id="element-4"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-5",selector:'[data-sound-id="element-5"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-6",selector:'[data-sound-id="element-6"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-7",selector:'[data-sound-id="element-7"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-8",selector:'[data-sound-id="element-8"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-9",selector:'[data-sound-id="element-9"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-10",selector:'[data-sound-id="element-10"]',type:"strudel",pattern:"",description:"No sound assigned"}],defaults:{proximityThreshold:100,hoverEnabled:!0,proximityEnabled:!0,volume:.5,fadeInTime:.1,fadeOutTime:.2},controls:{"proximity-threshold":{type:"synthesized",pattern:'sound("cp cp ~ cp")',description:"Threshold tick"},volume:{type:"synthesized",pattern:'sound("~ cp cp cp")',description:"Volume tick"}},getElementConfig(n){return this.elements.find(e=>e.id===n)},getSynthesizedElements(){return this.elements.filter(n=>n.type==="synthesized")},getAudioElements(){return this.elements.filter(n=>n.type==="audio")},getControlConfig(n){return this.controls[n]}};function Jb(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function ev(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var wg=[0,2,4,-1,1,3,5],Cg=wg.map(n=>Math.floor(n*7/12));function tv(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=wg[e]+7*t;if(i===void 0)return[s*r];const a=i-Cg[e]-4*t;return[s*r,s*a]}var nv=[3,0,4,1,5,2,6];function iv(n){const[e,t,i]=n,s=nv[sv(e)],r=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:r,dir:i};const a=t+4*r+Cg[s];return{step:s,alt:r,oct:a,dir:i}}function sv(n){const e=(n+1)%7;return e<0?7+e:e}var of=(n,e)=>Array(Math.abs(e)+1).join(n),Fc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),rv="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",av="(AA|A|P|M|m|d|dd)([-+]?\\d+)",ov=new RegExp("^"+rv+"|"+av+"$");function lv(n){const e=ov.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var lf={};function tl(n){return typeof n=="string"?lf[n]||(lf[n]=uv(n)):ev(n)?tl(dv(n)):Jb(n)?tl(n.name):Fc}var uf=[0,2,4,5,7,9,11],Pg="PMMPPMM";function uv(n){const e=lv(n);if(e[0]==="")return Fc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=Pg[s];if(r==="M"&&i==="P")return Fc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=hv(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(uf[s]+u+12*h),f=(l*(uf[s]+u)%12+12)%12,m=tv({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function cv(n,e){const[t,i=0]=n,s=t*7+i*12<0,r=e||s?[-t,-i,-1]:[t,i,1];return tl(iv(r))}function hv(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function dv(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=Pg[e]==="M"?"majorable":"perfectable";return o+a+fv(l,t)}function fv(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?of("A",e):of("d",n==="perfectable"?e:e+1)}function pv(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function mv(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var Ag=[0,2,4,-1,1,3,5],xg=Ag.map(n=>Math.floor(n*7/12));function gv(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=Ag[e]+7*t;if(i===void 0)return[s*r];const a=i-xg[e]-4*t;return[s*r,s*a]}var Ov=[3,0,4,1,5,2,6];function yv(n){const[e,t,i]=n,s=Ov[bv(e)],r=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:r,dir:i};const a=t+4*r+xg[s];return{step:s,alt:r,oct:a,dir:i}}function bv(n){const e=(n+1)%7;return e<0?7+e:e}var cf=(n,e)=>Array(Math.abs(e)+1).join(n),Eg=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),hf=new Map,vv=n=>"CDEFGAB".charAt(n),Dl=n=>n<0?cf("b",-n):cf("#",n),Jh=n=>n[0]==="b"?-n.length:n.length;function Zt(n){const e=JSON.stringify(n),t=hf.get(e);if(t)return t;const i=typeof n=="string"?Pv(n):mv(n)?Zt(Av(n)):pv(n)?Zt(n.name):Eg;return hf.set(e,i),i}var Sv=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function ed(n){const e=Sv.exec(n);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function wv(n){return Zt(yv(n))}var Cv=(n,e)=>(n%e+e)%e,yu=[0,2,4,5,7,9,11];function Pv(n){const e=ed(n);if(e[0]===""||e[3]!=="")return Eg;const t=e[0],i=e[1],s=e[2],r=(t.charCodeAt(0)+3)%7,a=Jh(i),o=s.length?+s:void 0,l=gv({step:r,alt:a,oct:o}),c=t+i+s,u=t+i,h=(yu[r]+a+120)%12,d=o===void 0?Cv(yu[r]+a,12)-1188:yu[r]+a+12*(o+1),f=d>=0&&d<=127?d:null,m=o===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:h,coord:l,freq:m,height:d,letter:t,midi:f,name:c,oct:o,pc:u,step:r}}function Av(n){const{step:e,alt:t,oct:i}=n,s=vv(e);if(!s)return"";const r=s+Dl(t);return i||i===0?r+i:r}function os(n,e){const t=Zt(n),i=Array.isArray(e)?e:tl(e).coord;if(t.empty||!i||i.length<2)return"";const s=t.coord,r=s.length===1?[s[0]+i[0]]:[s[0]+i[0],s[1]+i[1]];return wv(r).name}function kg(n,e){const t=n.length;return i=>{if(!e)return"";const s=i<0?(t- -i%t)%t:i%t,r=Math.floor(i/t),a=os(e,[0,r]);return os(a,n[s])}}function td(n,e){const t=Zt(n),i=Zt(e);if(t.empty||i.empty)return"";const s=t.coord,r=i.coord,a=r[0]-s[0],o=s.length===2&&r.length===2?r[1]-s[1]:-Math.floor(a*7/12),l=i.height===t.height&&i.midi!==null&&t.oct===i.oct&&t.step>i.step;return cv([a,o],l).name}function xv(n,e){const t=[];for(;e--;t[e]=e+n);return t}function Ev(n,e){const t=[];for(;e--;t[e]=n-e);return t}function nd(n,e){return n<e?xv(n,e-n+1):Ev(n,n-e+1)}function Wr(n,e){const t=e.length,i=(n%t+t)%t;return e.slice(i,t).concat(e.slice(0,i))}function Mg(n){return n.filter(e=>e===0||e)}function kv(n,e=Math.random){let t,i,s=n.length;for(;s;)t=Math.floor(e()*s--),i=n[s],n[s]=n[t],n[t]=i;return n}function Dg(n){return n.length===0?[[]]:Dg(n.slice(1)).reduce((e,t)=>e.concat(n.map((i,s)=>{const r=t.slice();return r.splice(s,0,n[0]),r})),[])}var A5={compact:Mg,permutations:Dg,range:nd,rotate:Wr,shuffle:kv};function Mv(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function Dv(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var $g=[0,2,4,-1,1,3,5],$v=$g.map(n=>Math.floor(n*7/12));function Tv(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=$g[e]+7*t;if(i===void 0)return[s*r];const a=i-$v[e]-4*t;return[s*r,s*a]}var df=(n,e)=>Array(Math.abs(e)+1).join(n),Rc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),_v="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Nv="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Bv=new RegExp("^"+_v+"|"+Nv+"$");function Fv(n){const e=Bv.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var ff={};function Ic(n){return typeof n=="string"?ff[n]||(ff[n]=Rv(n)):Dv(n)?Ic(Lv(n)):Mv(n)?Ic(n.name):Rc}var pf=[0,2,4,5,7,9,11],Tg="PMMPPMM";function Rv(n){const e=Fv(n);if(e[0]==="")return Rc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=Tg[s];if(r==="M"&&i==="P")return Rc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=Iv(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(pf[s]+u+12*h),f=(l*(pf[s]+u)%12+12)%12,m=Tv({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function Iv(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function Lv(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=Tg[e]==="M"?"majorable":"perfectable";return o+a+Qv(l,t)}function Qv(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?df("A",e):df("d",n==="perfectable"?e:e+1)}var ls={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},id=n=>Number(n).toString(2).padStart(12,"0"),mf=n=>parseInt(n,2),Vv=/^[01]{12}$/;function sd(n){return Vv.test(n)}var zv=n=>typeof n=="number"&&n>=0&&n<=4095,jv=n=>n&&sd(n.chroma),gf={[ls.chroma]:ls};function On(n){const e=sd(n)?n:zv(n)?id(n):Array.isArray(n)?tS(n):jv(n)?n.chroma:ls.chroma;return gf[e]=gf[e]||eS(e)}var Zv=On,_g=n=>On(n).chroma,Gv=n=>On(n).intervals,Uv=n=>On(n).setNum,qv=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function Wv(n){const e=[];for(let t=0;t<12;t++)n.charAt(t)==="1"&&e.push(qv[t]);return e}function Xv(n){return On(n).intervals.map(e=>os("C",e))}function Hv(){return nd(2048,4095).map(id)}function Ng(n,e=!0){const i=On(n).chroma.split("");return Mg(i.map((s,r)=>{const a=Wr(r,i);return e&&a[0]==="0"?null:a.join("")}))}function Yv(n,e){return On(n).setNum===On(e).setNum}function rd(n){const e=On(n).setNum;return t=>{const i=On(t).setNum;return e&&e!==i&&(i&e)===i}}function Bg(n){const e=On(n).setNum;return t=>{const i=On(t).setNum;return e&&e!==i&&(i|e)===i}}function Fg(n){const e=On(n);return t=>{const i=Zt(t);return e&&!i.empty&&e.chroma.charAt(i.chroma)==="1"}}function Kv(n){const e=Fg(n);return t=>t.filter(e)}var x5={get:On,chroma:_g,num:Uv,intervals:Gv,chromas:Hv,isSupersetOf:Bg,isSubsetOf:rd,isNoteIncludedIn:Fg,isEqual:Yv,filter:Kv,modes:Ng,notes:Xv,pcset:Zv};function Jv(n){const e=n.split("");return e.map((t,i)=>Wr(i,e).join(""))}function eS(n){const e=mf(n),t=Jv(n).map(mf).filter(r=>r>=2048).sort()[0],i=id(t),s=Wv(n);return{empty:!1,name:"",setNum:e,chroma:n,normalized:i,intervals:s}}function tS(n){if(n.length===0)return ls.chroma;let e;const t=[0,0,0,0,0,0,0,0,0,0,0,0];for(let i=0;i<n.length;i++)e=Zt(n[i]),e.empty&&(e=Ic(n[i])),e.empty||(t[e.chroma]=1);return t.join("")}var nS=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],iS=nS;({...ls});var ad=[],Vo={};function E5(){return ad.slice()}function sS(n,e,t){const i=aS(n),s={...On(n),name:t||"",quality:i,intervals:n,aliases:e};ad.push(s),s.name&&(Vo[s.name]=s),Vo[s.setNum]=s,Vo[s.chroma]=s,s.aliases.forEach(r=>rS(s,r))}function rS(n,e){Vo[e]=n}function aS(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}iS.forEach(([n,e,t])=>sS(n.split(" "),t.split(" "),e));ad.sort((n,e)=>n.setNum-e.setNum);function $l(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}var Rg=[0,2,4,5,7,9,11],oS=({step:n,alt:e})=>(Rg[n]+e+120)%12,Ig=({step:n,alt:e,oct:t,dir:i=1})=>i*(Rg[n]+e+12*(t===void 0?-100:t)),lS=n=>{const e=Ig(n);return n.oct!==void 0&&e>=-12&&e<=115?e+12:null};function od(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"}var Lg=[0,2,4,-1,1,3,5],Qg=Lg.map(n=>Math.floor(n*7/12));function ld(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=Lg[e]+7*t;if(i===void 0)return[s*r];const a=i-Qg[e]-4*t;return[s*r,s*a]}var uS=[3,0,4,1,5,2,6];function ud(n){const[e,t,i]=n,s=uS[cS(e)],r=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:r,dir:i};const a=t+4*r+Qg[s];return{step:s,alt:r,oct:a,dir:i}}function cS(n){const e=(n+1)%7;return e<0?7+e:e}var Of=(n,e)=>Array(Math.abs(e)+1).join(n),Lc={empty:!0,name:"",acc:""},hS="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",dS="(AA|A|P|M|m|d|dd)([-+]?\\d+)",fS=new RegExp("^"+hS+"|"+dS+"$");function Vg(n){const e=fS.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var yf={};function Qn(n){return typeof n=="string"?yf[n]||(yf[n]=pS(n)):od(n)?Qn(gS(n)):$l(n)?Qn(n.name):Lc}var bf=[0,2,4,5,7,9,11],zg="PMMPPMM";function pS(n){const e=Vg(n);if(e[0]==="")return Lc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=zg[s];if(r==="M"&&i==="P")return Lc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=mS(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(bf[s]+u+12*h),f=(l*(bf[s]+u)%12+12)%12,m=ld({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function Tl(n,e){const[t,i=0]=n,s=t*7+i*12<0,r=e||s?[-t,-i,-1]:[t,i,1];return Qn(ud(r))}function mS(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function gS(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=zg[e]==="M"?"majorable":"perfectable";return o+a+OS(l,t)}function OS(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?Of("A",e):Of("d",n==="perfectable"?e:e+1)}var vf=(n,e)=>Array(Math.abs(e)+1).join(n),jg={empty:!0,name:"",pc:"",acc:""},Sf=new Map,Zg=n=>"CDEFGAB".charAt(n),Gg=n=>n<0?vf("b",-n):vf("#",n),Ug=n=>n[0]==="b"?-n.length:n.length;function dr(n){const e=JSON.stringify(n),t=Sf.get(e);if(t)return t;const i=typeof n=="string"?vS(n):od(n)?dr(SS(n)):$l(n)?dr(n.name):jg;return Sf.set(e,i),i}var yS=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function qg(n){const e=yS.exec(n);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function Wg(n){return dr(ud(n))}var bS=(n,e)=>(n%e+e)%e,bu=[0,2,4,5,7,9,11];function vS(n){const e=qg(n);if(e[0]===""||e[3]!=="")return jg;const t=e[0],i=e[1],s=e[2],r=(t.charCodeAt(0)+3)%7,a=Ug(i),o=s.length?+s:void 0,l=ld({step:r,alt:a,oct:o}),c=t+i+s,u=t+i,h=(bu[r]+a+120)%12,d=o===void 0?bS(bu[r]+a,12)-1188:bu[r]+a+12*(o+1),f=d>=0&&d<=127?d:null,m=o===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:h,coord:l,freq:m,height:d,letter:t,midi:f,name:c,oct:o,pc:u,step:r}}function SS(n){const{step:e,alt:t,oct:i}=n,s=Zg(e);if(!s)return"";const r=s+Gg(t);return i||i===0?r+i:r}function Qc(n,e){const t=dr(n),i=Array.isArray(e)?e:Qn(e).coord;if(t.empty||!i||i.length<2)return"";const s=t.coord,r=s.length===1?[s[0]+i[0]]:[s[0]+i[0],s[1]+i[1]];return Wg(r).name}function wS(n,e){const t=n.length;return i=>{if(!e)return"";const s=i<0?(t- -i%t)%t:i%t,r=Math.floor(i/t),a=Qc(e,[0,r]);return Qc(a,n[s])}}function CS(n,e){const t=dr(n),i=dr(e);if(t.empty||i.empty)return"";const s=t.coord,r=i.coord,a=r[0]-s[0],o=s.length===2&&r.length===2?r[1]-s[1]:-Math.floor(a*7/12),l=i.height===t.height&&i.midi!==null&&t.midi!==null&&t.step>i.step;return Tl([a,o],l).name}var PS=(n,e)=>Array(Math.abs(e)+1).join(n);function _l(n,e,t){return function(...i){return console.warn(`${n} is deprecated. Use ${e}.`),t.apply(this,i)}}var AS=_l("isNamed","isNamedPitch",$l);const k5=Object.freeze(Object.defineProperty({__proto__:null,accToAlt:Ug,altToAcc:Gg,chroma:oS,coordToInterval:Tl,coordToNote:Wg,coordinates:ld,deprecate:_l,distance:CS,fillStr:PS,height:Ig,interval:Qn,isNamed:AS,isNamedPitch:$l,isPitch:od,midi:lS,note:dr,pitch:ud,stepToLetter:Zg,tokenizeInterval:Vg,tokenizeNote:qg,tonicIntervalsTransposer:wS,transpose:Qc},Symbol.toStringTag,{value:"Module"}));var xS=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],ES=xS,kS={...ls,name:"",quality:"Unknown",intervals:[],aliases:[]},Xr=[],lr={};function Xg(n){return lr[n]||kS}var MS=_l("ChordType.chordType","ChordType.get",Xg);function DS(){return Xr.map(n=>n.name).filter(n=>n)}function $S(){return Xr.map(n=>n.aliases[0]).filter(n=>n)}function TS(){return Object.keys(lr)}function Hg(){return Xr.slice()}var _S=_l("ChordType.entries","ChordType.all",Hg);function NS(){Xr=[],lr={}}function Yg(n,e,t){const i=FS(n),s={...On(n),name:t||"",quality:i,intervals:n,aliases:e};Xr.push(s),s.name&&(lr[s.name]=s),lr[s.setNum]=s,lr[s.chroma]=s,s.aliases.forEach(r=>BS(s,r))}function BS(n,e){lr[e]=n}function FS(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}ES.forEach(([n,e,t])=>Yg(n.split(" "),t.split(" "),e));Xr.sort((n,e)=>n.setNum-e.setNum);var M5={names:DS,symbols:$S,get:Xg,all:Hg,add:Yg,removeAll:NS,keys:TS,entries:_S,chordType:MS},RS=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],IS=RS,LS={...ls,intervals:[],aliases:[]},Nl=[],ur={};function Kg(){return Nl.map(n=>n.name)}function Bl(n){return ur[n]||LS}var QS=Bl;function Ha(){return Nl.slice()}var VS=Ha;function zS(){return Object.keys(ur)}function jS(){Nl=[],ur={}}function Jg(n,e,t=[]){const i={...On(n),name:e,intervals:n,aliases:t};return Nl.push(i),ur[i.name]=i,ur[i.setNum]=i,ur[i.chroma]=i,i.aliases.forEach(s=>ZS(i,s)),i}function ZS(n,e){ur[e]=n}IS.forEach(([n,e,...t])=>Jg(n.split(" "),e,t));var D5={names:Kg,get:Bl,all:Ha,add:Jg,removeAll:jS,keys:zS,entries:VS,scaleType:QS},GS=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],US=GS,Fl=[];US.forEach(([n,e,t])=>JS(n,e,t));var qS={empty:!0,name:"",value:0,fraction:[0,0],shorthand:"",dots:"",names:[]};function WS(){return Fl.reduce((n,e)=>(e.names.forEach(t=>n.push(t)),n),[])}function XS(){return Fl.map(n=>n.shorthand)}var HS=/^([^.]+)(\.*)$/;function cd(n){const[e,t,i]=HS.exec(n)||[],s=Fl.find(o=>o.shorthand===t||o.names.includes(t));if(!s)return qS;const r=ew(s.fraction,i.length),a=r[0]/r[1];return{...s,name:n,dots:i,value:a,fraction:r}}var YS=n=>cd(n).value,KS=n=>cd(n).fraction,$5={names:WS,shorthands:XS,get:cd,value:YS,fraction:KS};function JS(n,e,t){Fl.push({empty:!1,dots:"",name:"",value:1/n,fraction:n<1?[1/n,1]:[1,n],shorthand:e,names:t})}function ew(n,e){const t=Math.pow(2,e);let i=n[0]*t,s=n[1]*t;const r=i;for(let a=0;a<e;a++)i+=r/Math.pow(2,a+1);for(;i%2===0&&s%2===0;)i/=2,s/=2;return[i,s]}function tw(){return"1P 2M 3M 4P 5P 6m 7m".split(" ")}var e0=Qn,nw=n=>Qn(n).name,iw=n=>Qn(n).semitones,sw=n=>Qn(n).q,rw=n=>Qn(n).num;function aw(n){const e=Qn(n);return e.empty?"":e.simple+e.q}function ow(n){const e=Qn(n);if(e.empty)return"";const t=(7-e.step)%7,i=e.type==="perfectable"?-e.alt:-(e.alt+1);return Qn({step:t,alt:i,oct:e.oct,dir:e.dir}).name}var lw=[1,2,2,3,3,4,5,5,6,6,7,7],uw="P m M m M P d P m M m M".split(" ");function cw(n){const e=n<0?-1:1,t=Math.abs(n),i=t%12,s=Math.floor(t/12);return e*(lw[i]+7*s)+uw[i]}var hw=td,t0=n0((n,e)=>[n[0]+e[0],n[1]+e[1]]),dw=n=>e=>t0(n,e),fw=n0((n,e)=>[n[0]-e[0],n[1]-e[1]]);function pw(n,e){const t=e0(n);if(t.empty)return"";const[i,s,r]=t.coord;return Tl([i+e,s,r]).name}var mw={names:tw,get:e0,name:nw,num:rw,semitones:iw,quality:sw,fromSemitones:cw,distance:hw,invert:ow,simplify:aw,add:t0,addTo:dw,substract:fw,transposeFifths:pw};function n0(n){return(e,t)=>{const i=Qn(e).coord,s=Qn(t).coord;if(i&&s){const r=n(i,s);return Tl(r).name}}}function i0(n){return+n>=0&&+n<=127}function gw(n){if(i0(n))return+n;const e=Zt(n);return e.empty?null:e.midi}function Ow(n,e=440){return Math.pow(2,(n-69)/12)*e}var yw=Math.log(2),bw=Math.log(440);function hd(n){const e=12*(Math.log(n)-bw)/yw+69;return Math.round(e*100)/100}var vw="C C# D D# E F F# G G# A A# B".split(" "),Sw="C Db D Eb E F Gb G Ab A Bb B".split(" ");function br(n,e={}){if(isNaN(n)||n===-1/0||n===1/0)return"";n=Math.round(n);const i=(e.sharps===!0?vw:Sw)[n%12];if(e.pitchClass)return i;const s=Math.floor(n/12)-1;return i+s}function dd(n){return n%12}function ww(n){return n.split("").reduce((e,t,i)=>(i<12&&t==="1"&&e.push(i),e),[])}function Cw(n){return n.map(dd).sort((e,t)=>e-t).filter((e,t,i)=>t===0||e!==i[t-1])}function fd(n){return Array.isArray(n)?Cw(n):ww(n)}function Pw(n){const e=fd(n);return t=>{const i=dd(t);for(let s=0;s<12;s++){if(e.includes(i+s))return t+s;if(e.includes(i-s))return t-s}}}function s0(n,e){const t=fd(n),i=t.length;return s=>{const r=s<0?(i- -s%i)%i:s%i,a=Math.floor(s/i);return t[r]+a*12+e}}function Aw(n,e){const t=s0(n,e);return i=>{if(i!==0)return t(i>0?i-1:i)}}var T5={chroma:dd,freqToMidi:hd,isMidi:i0,midiToFreq:Ow,midiToNoteName:br,pcsetNearest:Pw,pcset:fd,pcsetDegrees:Aw,pcsetSteps:s0,toMidi:gw},xw=["C","D","E","F","G","A","B"],r0=n=>n.name,a0=n=>n.map(Zt).filter(e=>!e.empty);function Ew(n){return n===void 0?xw.slice():Array.isArray(n)?a0(n).map(r0):[]}var Fi=Zt,kw=n=>Fi(n).name,Mw=n=>Fi(n).pc,Dw=n=>Fi(n).acc,$w=n=>Fi(n).oct,Tw=n=>Fi(n).midi,_w=n=>Fi(n).freq,Nw=n=>Fi(n).chroma;function o0(n){return br(n)}function Bw(n){return br(hd(n))}function Fw(n){return br(hd(n),{sharps:!0})}function Rw(n){return br(n,{sharps:!0})}var Iw=td,Bi=os,Lw=os,l0=n=>e=>Bi(e,n),Qw=l0,u0=n=>e=>Bi(n,e),Vw=u0;function nl(n,e){return Bi(n,[e,0])}var zw=nl;function jw(n,e){return Bi(n,[0,e])}var pd=(n,e)=>n.height-e.height,Zw=(n,e)=>e.height-n.height;function c0(n,e){return e=e||pd,a0(n).sort(e).map(r0)}function h0(n){return c0(n,pd).filter((e,t,i)=>t===0||e!==i[t-1])}var Gw=n=>{const e=Fi(n);return e.empty?"":br(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:e.midi===null})};function d0(n,e){const t=Fi(n);if(t.empty)return"";const i=Fi(e||br(t.midi||t.chroma,{sharps:t.alt<0,pitchClass:!0}));if(i.empty||i.chroma!==t.chroma)return"";if(t.oct===void 0)return i.pc;const s=t.chroma-t.alt,r=i.chroma-i.alt,a=s>11||r<0?-1:s<0||r>11?1:0,o=t.oct+a;return i.pc+o}var Vc={names:Ew,get:Fi,name:kw,pitchClass:Mw,accidentals:Dw,octave:$w,midi:Tw,ascending:pd,descending:Zw,distance:Iw,sortedNames:c0,sortedUniqNames:h0,fromMidi:o0,fromMidiSharps:Rw,freq:_w,fromFreq:Bw,fromFreqSharps:Fw,chroma:Nw,transpose:Bi,tr:Lw,transposeBy:l0,trBy:Qw,transposeFrom:u0,trFrom:Vw,transposeFifths:nl,transposeOctaves:jw,trFifths:zw,simplify:Gw,enharmonic:d0};function f0(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function p0(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var m0=[0,2,4,-1,1,3,5],Uw=m0.map(n=>Math.floor(n*7/12));function qw(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=m0[e]+7*t;if(i===void 0)return[s*r];const a=i-Uw[e]-4*t;return[s*r,s*a]}var wf=(n,e)=>Array(Math.abs(e)+1).join(n),zc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),Ww="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Xw="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Hw=new RegExp("^"+Ww+"|"+Xw+"$");function Yw(n){const e=Hw.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var Cf={};function jc(n){return typeof n=="string"?Cf[n]||(Cf[n]=Kw(n)):p0(n)?jc(eC(n)):f0(n)?jc(n.name):zc}var Pf=[0,2,4,5,7,9,11],g0="PMMPPMM";function Kw(n){const e=Yw(n);if(e[0]==="")return zc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=g0[s];if(r==="M"&&i==="P")return zc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=Jw(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(Pf[s]+u+12*h),f=(l*(Pf[s]+u)%12+12)%12,m=qw({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function Jw(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function eC(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=g0[e]==="M"?"majorable":"perfectable";return o+a+tC(l,t)}function tC(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?wf("A",e):wf("d",n==="perfectable"?e:e+1)}var O0={empty:!0,name:"",chordType:""},Af={};function Qs(n){return typeof n=="string"?Af[n]||(Af[n]=lC(n)):typeof n=="number"?Qs(Rl[n]||""):p0(n)?sC(n):f0(n)?Qs(n.name):O0}var nC=Qs;function iC(n=!0){return(n?Rl:oC).slice()}function sC(n){return Qs(Dl(n.alt)+Rl[n.step])}var rC=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function aC(n){return rC.exec(n)||["","","",""]}var y0="I II III IV V VI VII",Rl=y0.split(" "),oC=y0.toLowerCase().split(" ");function lC(n){const[e,t,i,s]=aC(n);if(!i)return O0;const r=i.toUpperCase(),a=Rl.indexOf(r),o=Jh(t),l=1;return{empty:!1,name:e,roman:i,interval:jc({step:a,alt:o,dir:l}).name,acc:t,chordType:s,alt:o,step:a,major:i===r,oct:0,dir:l}}var _5={names:iC,get:Qs,romanNumeral:nC},Pn=Object.freeze([]),b0={type:"major",tonic:"",alteration:0,keySignature:""},zo={tonic:"",grades:Pn,intervals:Pn,scale:Pn,triads:Pn,chords:Pn,chordsHarmonicFunction:Pn,chordScales:Pn,secondaryDominants:Pn,secondaryDominantSupertonics:Pn,substituteDominantsMinorRelative:Pn,substituteDominants:Pn,substituteDominantSupertonics:Pn,secondaryDominantsMinorRelative:Pn},uC={...b0,...zo,type:"major",minorRelative:"",scale:Pn,substituteDominants:Pn,secondaryDominantSupertonics:Pn,substituteDominantsMinorRelative:Pn},cC={...b0,type:"minor",relativeMajor:"",natural:zo,harmonic:zo,melodic:zo},vu=(n,e,t="")=>e.map((i,s)=>`${n[s]}${t}${i}`);function Il(n,e,t,i,s){return r=>{const a=n.map(f=>Qs(f).interval||""),o=a.map(f=>Bi(r,f)),l=vu(o,t),c=o.map(f=>Bi(f,"5P")).map(f=>o.includes(f)&&!l.includes(f+"7")?f+"7":""),u=xf(c,e),h=c.map(f=>{if(!f)return"";const m=f.slice(0,-1);return Bi(m,"5d")+"7"}),d=xf(h,e);return{tonic:r,grades:n,intervals:a,scale:o,triads:vu(o,e),chords:l,chordsHarmonicFunction:i.slice(),chordScales:vu(o,s," "),secondaryDominants:c,secondaryDominantSupertonics:u,substituteDominants:h,substituteDominantSupertonics:d,secondaryDominantsMinorRelative:u,substituteDominantsMinorRelative:d}}}var xf=(n,e)=>n.map((t,i)=>{if(!t)return"";const s=t.slice(0,-1),r=Bi(s,"5P");return e[i].endsWith("m")?r+"m7":r+"m7b5"}),v0=(n,e)=>{const t=Zt(n),i=Zt(e);return t.empty||i.empty?0:i.coord[0]-t.coord[0]},hC=Il("I II III IV V VI VII".split(" ")," m m   m dim".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),dC=Il("I II bIII IV V bVI bVII".split(" "),"m dim  m m  ".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),fC=Il("I II bIII IV V bVI VII".split(" "),"m dim aug m   dim".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),pC=Il("I II bIII IV V VI VII".split(" "),"m m aug   dim dim".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));function mC(n){const e=Zt(n).pc;if(!e)return uC;const t=hC(e),i=v0("C",e);return{...t,type:"major",minorRelative:Bi(e,"-3m"),alteration:i,keySignature:Dl(i)}}function gC(n){const e=Zt(n).pc;if(!e)return cC;const t=v0("C",e)-3;return{type:"minor",tonic:e,relativeMajor:Bi(e,"3m"),alteration:t,keySignature:Dl(t),natural:dC(e),harmonic:fC(e),melodic:pC(e)}}function OC(n){return typeof n=="number"?nl("C",n):typeof n=="string"&&/^b+|#+$/.test(n)?nl("C",Jh(n)):null}var N5={majorKey:mC,majorTonicFromKeySignature:OC,minorKey:gC};function yC(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function bC(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var S0=[0,2,4,-1,1,3,5],w0=S0.map(n=>Math.floor(n*7/12));function vC(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=S0[e]+7*t;if(i===void 0)return[s*r];const a=i-w0[e]-4*t;return[s*r,s*a]}var SC=[3,0,4,1,5,2,6];function wC(n){const[e,t,i]=n,s=SC[CC(e)],r=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:r,dir:i};const a=t+4*r+w0[s];return{step:s,alt:r,oct:a,dir:i}}function CC(n){const e=(n+1)%7;return e<0?7+e:e}var Ef=(n,e)=>Array(Math.abs(e)+1).join(n),Zc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),PC="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",AC="(AA|A|P|M|m|d|dd)([-+]?\\d+)",xC=new RegExp("^"+PC+"|"+AC+"$");function EC(n){const e=xC.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var kf={};function Fa(n){return typeof n=="string"?kf[n]||(kf[n]=kC(n)):bC(n)?Fa($C(n)):yC(n)?Fa(n.name):Zc}var Mf=[0,2,4,5,7,9,11],C0="PMMPPMM";function kC(n){const e=EC(n);if(e[0]==="")return Zc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=C0[s];if(r==="M"&&i==="P")return Zc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=DC(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(Mf[s]+u+12*h),f=(l*(Mf[s]+u)%12+12)%12,m=vC({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function MC(n,e){const[t,i=0]=n,r=t*7+i*12<0?[-t,-i,-1]:[t,i,1];return Fa(wC(r))}function DC(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function $C(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=C0[e]==="M"?"majorable":"perfectable";return o+a+TC(l,t)}function TC(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?Ef("A",e):Ef("d",n==="perfectable"?e:e+1)}var _C=Fa;function NC(n){const e=Fa(n);return e.empty?"":e.simple+e.q}function BC(n,e){const t=_C(n);if(t.empty)return"";const[i,s,r]=t.coord;return MC([i+e,s,r]).name}var md=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],Df={...ls,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},gd=md.map(LC),Gc={};gd.forEach(n=>{Gc[n.name]=n,n.aliases.forEach(e=>{Gc[e]=n})});function fr(n){return typeof n=="string"?Gc[n.toLowerCase()]||Df:n&&n.name?fr(n.name):Df}var FC=fr;function P0(){return gd.slice()}var RC=P0;function IC(){return gd.map(n=>n.name)}function LC(n){const[e,t,i,s,r,a,o]=n,l=o?[o]:[],c=Number(t).toString(2);return{empty:!1,intervals:Bl(s).intervals,modeNum:e,chroma:c,normalized:c,name:s,setNum:t,alt:i,triad:r,seventh:a,aliases:l}}function QC(n,e){return fr(n).intervals.map(t=>os(e,t))}function A0(n){return(e,t)=>{const i=fr(e);if(i.empty)return[];const s=Wr(i.modeNum,n),r=i.intervals.map(a=>os(t,a));return s.map((a,o)=>r[o]+a)}}var VC=A0(md.map(n=>n[4])),zC=A0(md.map(n=>n[5]));function x0(n,e){const t=fr(e),i=fr(n);return t.empty||i.empty?"":NC(BC("1P",i.alt-t.alt))}function jC(n,e,t){return os(t,x0(n,e))}var B5={get:fr,names:IC,all:P0,distance:x0,relativeTonic:jC,notes:QC,triads:VC,seventhChords:zC,entries:RC,mode:FC},ZC=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],GC=ZC;({...ls});var E0=[],jo={};function UC(n,e,t){const i=WC(n),s={...On(n),name:t||"",quality:i,intervals:n,aliases:e};E0.push(s),s.name&&(jo[s.name]=s),jo[s.setNum]=s,jo[s.chroma]=s,s.aliases.forEach(r=>qC(s,r))}function qC(n,e){jo[e]=n}function WC(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}GC.forEach(([n,e,t])=>UC(n.split(" "),t.split(" "),e));E0.sort((n,e)=>n.setNum-e.setNum);function XC(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function HC(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var k0=[0,2,4,-1,1,3,5],YC=k0.map(n=>Math.floor(n*7/12));function KC(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=k0[e]+7*t;if(i===void 0)return[s*r];const a=i-YC[e]-4*t;return[s*r,s*a]}var $f=(n,e)=>Array(Math.abs(e)+1).join(n),Uc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),JC="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",eP="(AA|A|P|M|m|d|dd)([-+]?\\d+)",tP=new RegExp("^"+JC+"|"+eP+"$");function nP(n){const e=tP.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var Tf={};function il(n){return typeof n=="string"?Tf[n]||(Tf[n]=iP(n)):HC(n)?il(rP(n)):XC(n)?il(n.name):Uc}var _f=[0,2,4,5,7,9,11],M0="PMMPPMM";function iP(n){const e=nP(n);if(e[0]==="")return Uc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=M0[s];if(r==="M"&&i==="P")return Uc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=sP(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(_f[s]+u+12*h),f=(l*(_f[s]+u)%12+12)%12,m=KC({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function sP(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function rP(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=M0[e]==="M"?"majorable":"perfectable";return o+a+aP(l,t)}function aP(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?$f("A",e):$f("d",n==="perfectable"?e:e+1)}function oP(n){const[e,t,i,s]=ed(n);return e===""?Su("",n):e==="A"&&s==="ug"?Su("","aug"):Su(e+t,i+s)}function Su(n,e){const t=e.split("/");if(t.length===1)return[n,t[0],""];const[i,s,r,a]=ed(t[1]);return i!==""&&r===""&&a===""?[n,t[0],i+s]:[n,e,""]}function lP(n,e){return e.map(Qs).map(i=>os(n,il(i))+i.chordType)}function uP(n,e){return e.map(t=>{const[i,s]=oP(t),r=td(n,i);return Qs(il(r)).name+s})}var cP={fromRomanNumerals:lP,toRomanNumerals:uP},hP=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],dP=hP;({...ls});var Od=[],Zo={};function fP(){return Od.slice()}function pP(n,e,t){const i=gP(n),s={...On(n),name:t||"",quality:i,intervals:n,aliases:e};Od.push(s),s.name&&(Zo[s.name]=s),Zo[s.setNum]=s,Zo[s.chroma]=s,s.aliases.forEach(r=>mP(s,r))}function mP(n,e){Zo[e]=n}function gP(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}dP.forEach(([n,e,t])=>pP(n.split(" "),t.split(" "),e));Od.sort((n,e)=>n.setNum-e.setNum);var OP={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function D0(n){if(typeof n!="string")return["",""];const e=n.indexOf(" "),t=Zt(n.substring(0,e));if(t.empty){const s=Zt(n);return s.empty?["",n.toLowerCase()]:[s.name,""]}const i=n.substring(t.name.length+1).toLowerCase();return[t.name,i.length?i:""]}var yP=Kg;function us(n){const e=Array.isArray(n)?n:D0(n),t=Zt(e[0]).name,i=Bl(e[1]);if(i.empty)return OP;const s=i.name,r=t?i.intervals.map(o=>os(t,o)):[],a=t?t+" "+s:s;return{...i,name:a,type:s,tonic:t,notes:r}}var bP=us;function vP(n,e={}){const t=_g(n),i=Zt(e.tonic??n[0]??""),s=i.chroma;if(s===void 0)return[];const r=t.split("");r[s]="1";const a=Wr(s,r).join(""),o=Ha().find(c=>c.chroma===a),l=[];return o&&l.push(i.name+" "+o.name),e.match==="exact"||$0(a).forEach(c=>{l.push(i.name+" "+c)}),l}function SP(n){const e=us(n),t=rd(e.chroma);return fP().filter(i=>t(i.chroma)).map(i=>i.aliases[0])}function $0(n){const e=sd(n)?n:us(n).chroma,t=Bg(e);return Ha().filter(i=>t(i.chroma)).map(i=>i.name)}function wP(n){const e=rd(us(n).chroma);return Ha().filter(t=>e(t.chroma)).map(t=>t.name)}function T0(n){const e=n.map(s=>Zt(s).pc).filter(s=>s),t=e[0],i=h0(e);return Wr(i.indexOf(t),i)}function CP(n){const e=us(n);if(e.empty)return[];const t=e.tonic?e.notes:e.intervals;return Ng(e.chroma).map((i,s)=>{const r=us(i).name;return r?[t[s],r]:["",""]}).filter(i=>i[0])}function PP(n){const e=Array.isArray(n)?T0(n):us(n).notes,t=e.map(i=>Zt(i).chroma);return i=>{const s=Zt(typeof i=="number"?o0(i):i),r=s.height;if(r===void 0)return;const a=r%12,o=t.indexOf(a);if(o!==-1)return d0(s.name,e[o])}}function AP(n){const e=PP(n);return(t,i)=>{const s=Zt(t).height,r=Zt(i).height;return s===void 0||r===void 0?[]:nd(s,r).map(e).filter(a=>a)}}function xP(n){const{intervals:e,tonic:t}=us(n),i=kg(e,t);return s=>s?i(s>0?s-1:s):""}function EP(n){const{intervals:e,tonic:t}=us(n);return kg(e,t)}var va={degrees:xP,detect:vP,extended:$0,get:us,modeNames:CP,names:yP,rangeOf:AP,reduced:wP,scaleChords:SP,scaleNotes:T0,steps:EP,tokenize:D0,scale:bP};class _i{constructor(e=!1){this.eventMap={},this.eventsSuspended=e==!0}addListener(e,t,i={}){if(typeof e=="string"&&e.length<1||e instanceof String&&e.length<1||typeof e!="string"&&!(e instanceof String)&&e!==_i.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(typeof t!="function")throw new TypeError("The callback must be a function.");const s=new Nf(e,this,t,i);return this.eventMap[e]||(this.eventMap[e]=[]),i.prepend?this.eventMap[e].unshift(s):this.eventMap[e].push(s),s}addOneTimeListener(e,t,i={}){i.remaining=1,this.addListener(e,t,i)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(e,t){return e===void 0?this.eventMap[_i.ANY_EVENT]&&this.eventMap[_i.ANY_EVENT].length>0?!0:Object.entries(this.eventMap).some(([,i])=>i.length>0):this.eventMap[e]&&this.eventMap[e].length>0?t instanceof Nf?this.eventMap[e].filter(s=>s===t).length>0:typeof t=="function"?this.eventMap[e].filter(s=>s.callback===t).length>0:t==null:!1}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach(t=>{t.suspended=!0})}unsuspendEvent(e){this.getListeners(e).forEach(t=>{t.suspended=!1})}getListenerCount(e){return this.getListeners(e).length}emit(e,...t){if(typeof e!="string"&&!(e instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let i=[],s=this.eventMap[_i.ANY_EVENT]||[];return this.eventMap[e]&&(s=s.concat(this.eventMap[e])),s.forEach(r=>{if(r.suspended)return;let a=[...t];Array.isArray(r.arguments)&&(a=a.concat(r.arguments)),r.remaining>0&&(i.push(r.callback.apply(r.context,a)),r.count++),--r.remaining<1&&r.remove()}),i}removeListener(e,t,i={}){if(e===void 0){this.eventMap={};return}else if(!this.eventMap[e])return;let s=this.eventMap[e].filter(r=>t&&r.callback!==t||i.remaining&&i.remaining!==r.remaining||i.context&&i.context!==r.context);s.length?this.eventMap[e]=s:delete this.eventMap[e]}async waitFor(e,t={}){return t.duration=parseInt(t.duration),(isNaN(t.duration)||t.duration<=0)&&(t.duration=1/0),new Promise((i,s)=>{let r,a=this.addListener(e,()=>{clearTimeout(r),i()},{remaining:1});t.duration!==1/0&&(r=setTimeout(()=>{a.remove(),s("The duration expired before the event was emitted.")},t.duration))})}get eventCount(){return Object.keys(this.eventMap).length}}class Nf{constructor(e,t,i,s={}){if(typeof e!="string"&&!(e instanceof String)&&e!==_i.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!t)throw new ReferenceError("The 'target' parameter is mandatory.");if(typeof i!="function")throw new TypeError("The 'callback' must be a function.");s.arguments!==void 0&&!Array.isArray(s.arguments)&&(s.arguments=[s.arguments]),s=Object.assign({context:t,remaining:1/0,arguments:void 0,duration:1/0},s),s.duration!==1/0&&setTimeout(()=>this.remove(),s.duration),this.arguments=s.arguments,this.callback=i,this.context=s.context,this.count=0,this.event=e,this.remaining=parseInt(s.remaining)>=1?parseInt(s.remaining):1/0,this.suspended=!1,this.target=t}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}/**
 * The `Enumerations` class contains enumerations and arrays of elements used throughout the
 * library. All its properties are static and should be referenced using the class name. For
 * example: `Enumerations.CHANNEL_MESSAGES`.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class ne{static get MIDI_CHANNEL_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MESSAGES enum instead."),ne.CHANNEL_MESSAGES}static get CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_NUMBERS(){return this.validation&&console.warn("The MIDI_CHANNEL_NUMBERS array has been deprecated. Use the Enumerations.CHANNEL_NUMBERS array instead."),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MODE_MESSAGES enum instead."),ne.CHANNEL_MODE_MESSAGES}static get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been deprecated. Use the Enumerations.CONTROL_CHANGE_MESSAGES array instead."),{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get CONTROL_CHANGE_MESSAGES(){return[{number:0,name:"bankselectcoarse",description:"Bank Select (Coarse)",position:"msb"},{number:1,name:"modulationwheelcoarse",description:"Modulation Wheel (Coarse)",position:"msb"},{number:2,name:"breathcontrollercoarse",description:"Breath Controller (Coarse)",position:"msb"},{number:3,name:"controller3",description:"Undefined",position:"msb"},{number:4,name:"footcontrollercoarse",description:"Foot Controller (Coarse)",position:"msb"},{number:5,name:"portamentotimecoarse",description:"Portamento Time (Coarse)",position:"msb"},{number:6,name:"dataentrycoarse",description:"Data Entry (Coarse)",position:"msb"},{number:7,name:"volumecoarse",description:"Channel Volume (Coarse)",position:"msb"},{number:8,name:"balancecoarse",description:"Balance (Coarse)",position:"msb"},{number:9,name:"controller9",description:"Controller 9 (Coarse)",position:"msb"},{number:10,name:"pancoarse",description:"Pan (Coarse)",position:"msb"},{number:11,name:"expressioncoarse",description:"Expression Controller (Coarse)",position:"msb"},{number:12,name:"effectcontrol1coarse",description:"Effect Control 1 (Coarse)",position:"msb"},{number:13,name:"effectcontrol2coarse",description:"Effect Control 2 (Coarse)",position:"msb"},{number:14,name:"controller14",description:"Undefined",position:"msb"},{number:15,name:"controller15",description:"Undefined",position:"msb"},{number:16,name:"generalpurposecontroller1",description:"General Purpose Controller 1 (Coarse)",position:"msb"},{number:17,name:"generalpurposecontroller2",description:"General Purpose Controller 2 (Coarse)",position:"msb"},{number:18,name:"generalpurposecontroller3",description:"General Purpose Controller 3 (Coarse)",position:"msb"},{number:19,name:"generalpurposecontroller4",description:"General Purpose Controller 4 (Coarse)",position:"msb"},{number:20,name:"controller20",description:"Undefined",position:"msb"},{number:21,name:"controller21",description:"Undefined",position:"msb"},{number:22,name:"controller22",description:"Undefined",position:"msb"},{number:23,name:"controller23",description:"Undefined",position:"msb"},{number:24,name:"controller24",description:"Undefined",position:"msb"},{number:25,name:"controller25",description:"Undefined",position:"msb"},{number:26,name:"controller26",description:"Undefined",position:"msb"},{number:27,name:"controller27",description:"Undefined",position:"msb"},{number:28,name:"controller28",description:"Undefined",position:"msb"},{number:29,name:"controller29",description:"Undefined",position:"msb"},{number:30,name:"controller30",description:"Undefined",position:"msb"},{number:31,name:"controller31",description:"Undefined",position:"msb"},{number:32,name:"bankselectfine",description:"Bank Select (Fine)",position:"lsb"},{number:33,name:"modulationwheelfine",description:"Modulation Wheel (Fine)",position:"lsb"},{number:34,name:"breathcontrollerfine",description:"Breath Controller (Fine)",position:"lsb"},{number:35,name:"controller35",description:"Undefined",position:"lsb"},{number:36,name:"footcontrollerfine",description:"Foot Controller (Fine)",position:"lsb"},{number:37,name:"portamentotimefine",description:"Portamento Time (Fine)",position:"lsb"},{number:38,name:"dataentryfine",description:"Data Entry (Fine)",position:"lsb"},{number:39,name:"channelvolumefine",description:"Channel Volume (Fine)",position:"lsb"},{number:40,name:"balancefine",description:"Balance (Fine)",position:"lsb"},{number:41,name:"controller41",description:"Undefined",position:"lsb"},{number:42,name:"panfine",description:"Pan (Fine)",position:"lsb"},{number:43,name:"expressionfine",description:"Expression Controller (Fine)",position:"lsb"},{number:44,name:"effectcontrol1fine",description:"Effect control 1 (Fine)",position:"lsb"},{number:45,name:"effectcontrol2fine",description:"Effect control 2 (Fine)",position:"lsb"},{number:46,name:"controller46",description:"Undefined",position:"lsb"},{number:47,name:"controller47",description:"Undefined",position:"lsb"},{number:48,name:"controller48",description:"General Purpose Controller 1 (Fine)",position:"lsb"},{number:49,name:"controller49",description:"General Purpose Controller 2 (Fine)",position:"lsb"},{number:50,name:"controller50",description:"General Purpose Controller 3 (Fine)",position:"lsb"},{number:51,name:"controller51",description:"General Purpose Controller 4 (Fine)",position:"lsb"},{number:52,name:"controller52",description:"Undefined",position:"lsb"},{number:53,name:"controller53",description:"Undefined",position:"lsb"},{number:54,name:"controller54",description:"Undefined",position:"lsb"},{number:55,name:"controller55",description:"Undefined",position:"lsb"},{number:56,name:"controller56",description:"Undefined",position:"lsb"},{number:57,name:"controller57",description:"Undefined",position:"lsb"},{number:58,name:"controller58",description:"Undefined",position:"lsb"},{number:59,name:"controller59",description:"Undefined",position:"lsb"},{number:60,name:"controller60",description:"Undefined",position:"lsb"},{number:61,name:"controller61",description:"Undefined",position:"lsb"},{number:62,name:"controller62",description:"Undefined",position:"lsb"},{number:63,name:"controller63",description:"Undefined",position:"lsb"},{number:64,name:"damperpedal",description:"Damper Pedal On/Off"},{number:65,name:"portamento",description:"Portamento On/Off"},{number:66,name:"sostenuto",description:"Sostenuto On/Off"},{number:67,name:"softpedal",description:"Soft Pedal On/Off"},{number:68,name:"legatopedal",description:"Legato Pedal On/Off"},{number:69,name:"hold2",description:"Hold 2 On/Off"},{number:70,name:"soundvariation",description:"Sound Variation",position:"lsb"},{number:71,name:"resonance",description:"Resonance",position:"lsb"},{number:72,name:"releasetime",description:"Release Time",position:"lsb"},{number:73,name:"attacktime",description:"Attack Time",position:"lsb"},{number:74,name:"brightness",description:"Brightness",position:"lsb"},{number:75,name:"decaytime",description:"Decay Time",position:"lsb"},{number:76,name:"vibratorate",description:"Vibrato Rate",position:"lsb"},{number:77,name:"vibratodepth",description:"Vibrato Depth",position:"lsb"},{number:78,name:"vibratodelay",description:"Vibrato Delay",position:"lsb"},{number:79,name:"controller79",description:"Undefined",position:"lsb"},{number:80,name:"generalpurposecontroller5",description:"General Purpose Controller 5",position:"lsb"},{number:81,name:"generalpurposecontroller6",description:"General Purpose Controller 6",position:"lsb"},{number:82,name:"generalpurposecontroller7",description:"General Purpose Controller 7",position:"lsb"},{number:83,name:"generalpurposecontroller8",description:"General Purpose Controller 8",position:"lsb"},{number:84,name:"portamentocontrol",description:"Portamento Control",position:"lsb"},{number:85,name:"controller85",description:"Undefined"},{number:86,name:"controller86",description:"Undefined"},{number:87,name:"controller87",description:"Undefined"},{number:88,name:"highresolutionvelocityprefix",description:"High Resolution Velocity Prefix",position:"lsb"},{number:89,name:"controller89",description:"Undefined"},{number:90,name:"controller90",description:"Undefined"},{number:91,name:"effect1depth",description:"Effects 1 Depth (Reverb Send Level)"},{number:92,name:"effect2depth",description:"Effects 2 Depth"},{number:93,name:"effect3depth",description:"Effects 3 Depth (Chorus Send Level)"},{number:94,name:"effect4depth",description:"Effects 4 Depth"},{number:95,name:"effect5depth",description:"Effects 5 Depth"},{number:96,name:"dataincrement",description:"Data Increment"},{number:97,name:"datadecrement",description:"Data Decrement"},{number:98,name:"nonregisteredparameterfine",description:"Non-Registered Parameter Number (Fine)",position:"lsb"},{number:99,name:"nonregisteredparametercoarse",description:"Non-Registered Parameter Number (Coarse)",position:"msb"},{number:100,name:"registeredparameterfine",description:"Registered Parameter Number (Fine)",position:"lsb"},{number:101,name:"registeredparametercoarse",description:"Registered Parameter Number (Coarse)",position:"msb"},{number:102,name:"controller102",description:"Undefined"},{number:103,name:"controller103",description:"Undefined"},{number:104,name:"controller104",description:"Undefined"},{number:105,name:"controller105",description:"Undefined"},{number:106,name:"controller106",description:"Undefined"},{number:107,name:"controller107",description:"Undefined"},{number:108,name:"controller108",description:"Undefined"},{number:109,name:"controller109",description:"Undefined"},{number:110,name:"controller110",description:"Undefined"},{number:111,name:"controller111",description:"Undefined"},{number:112,name:"controller112",description:"Undefined"},{number:113,name:"controller113",description:"Undefined"},{number:114,name:"controller114",description:"Undefined"},{number:115,name:"controller115",description:"Undefined"},{number:116,name:"controller116",description:"Undefined"},{number:117,name:"controller117",description:"Undefined"},{number:118,name:"controller118",description:"Undefined"},{number:119,name:"controller119",description:"Undefined"},{number:120,name:"allsoundoff",description:"All Sound Off"},{number:121,name:"resetallcontrollers",description:"Reset All Controllers"},{number:122,name:"localcontrol",description:"Local Control On/Off"},{number:123,name:"allnotesoff",description:"All Notes Off"},{number:124,name:"omnimodeoff",description:"Omni Mode Off"},{number:125,name:"omnimodeon",description:"Omni Mode On"},{number:126,name:"monomodeon",description:"Mono Mode On"},{number:127,name:"polymodeon",description:"Poly Mode On"}]}static get REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_REGISTERED_PARAMETERS(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETERS enum has been deprecated. Use the Enumerations.REGISTERED_PARAMETERS enum instead."),ne.MIDI_REGISTERED_PARAMETERS}static get SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been deprecated. Use the Enumerations.SYSTEM_MESSAGES enum instead."),ne.SYSTEM_MESSAGES}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-dataincrement","nrpn-datadecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-dataincrement","rpn-datadecrement","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn-databuttonincrement","rpn-databuttondecrement"]}}/**
 * The `Note` class represents a single musical note such as `"D3"`, `"G#4"`, `"F-1"`, `"Gb7"`, etc.
 *
 * `Note` objects can be played back on a single channel by calling
 * [`OutputChannel.playNote()`]{@link OutputChannel#playNote} or, on multiple channels of the same
 * output, by calling [`Output.playNote()`]{@link Output#playNote}.
 *
 * The note has [`attack`](#attack) and [`release`](#release) velocities set at `0.5` by default.
 * These can be changed by passing in the appropriate option. It is also possible to set a
 * system-wide default for attack and release velocities by using the
 * [`WebMidi.defaults`](WebMidi#defaults) property.
 *
 * If you prefer to work with raw MIDI values (`0` to `127`), you can use [`rawAttack`](#rawAttack) and
 * [`rawRelease`](#rawRelease) to both get and set the values.
 *
 * The note may have a [`duration`](#duration). If it does, playback will be automatically stopped
 * when the duration has elapsed by sending a `"noteoff"` event. By default, the duration is set to
 * `Infinity`. In this case, it will never stop playing unless explicitly stopped by calling a
 * method such as [`OutputChannel.stopNote()`]{@link OutputChannel#stopNote},
 * [`Output.stopNote()`]{@link Output#stopNote} or similar.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class _r{constructor(e,t={}){this.duration=ye.defaults.note.duration,this.attack=ye.defaults.note.attack,this.release=ye.defaults.note.release,t.duration!=null&&(this.duration=t.duration),t.attack!=null&&(this.attack=t.attack),t.rawAttack!=null&&(this.attack=be.from7bitToFloat(t.rawAttack)),t.release!=null&&(this.release=t.release),t.rawRelease!=null&&(this.release=be.from7bitToFloat(t.rawRelease)),Number.isInteger(e)?this.identifier=be.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const t=be.getNoteDetails(e);if(ye.validation&&!e)throw new Error("Invalid note identifier");this._name=t.name,this._accidental=t.accidental,this._octave=t.octave}get name(){return this._name}set name(e){if(ye.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(ye.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(ye.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(ye.validation&&(e=parseFloat(e),isNaN(e)||e===null||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(ye.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(ye.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return be.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=be.from7bitToFloat(e)}get rawRelease(){return be.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=be.from7bitToFloat(e)}get number(){return be.toNoteNumber(this.identifier)}getOffsetNumber(e=0,t=0){return ye.validation&&(e=parseInt(e)||0,t=parseInt(t)||0),Math.min(Math.max(this.number+e*12+t,0),127)}}/**
 * The `Utilities` class contains general-purpose utility methods. All methods are static and
 * should be called using the class name. For example: `Utilities.getNoteDetails("C4")`.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class be{static toNoteNumber(e,t=0){if(t=t==null?0:parseInt(t),isNaN(t))throw new RangeError("Invalid 'octaveOffset' value");typeof e!="string"&&(e="");const i=this.getNoteDetails(e);if(!i)throw new TypeError("Invalid note identifier");const s={C:0,D:2,E:4,F:5,G:7,A:9,B:11};let r=(i.octave+1+t)*12;if(r+=s[i.name],i.accidental&&(i.accidental.startsWith("b")?r-=i.accidental.length:r+=i.accidental.length),r<0||r>127)throw new RangeError("Invalid octaveOffset value");return r}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const t=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!t)throw new TypeError("Invalid note identifier");const i=t[1].toUpperCase(),s=parseInt(t[3]);let r=t[2].toLowerCase();return r=r===""?void 0:r,{accidental:r,identifier:i+(r||"")+s,name:i,octave:s}}static sanitizeChannels(e){let t;if(ye.validation){if(e==="all")t=["all"];else if(e==="none")return[]}return Array.isArray(e)?t=e:t=[e],t.indexOf("all")>-1&&(t=ne.MIDI_CHANNEL_NUMBERS),t.map(function(i){return parseInt(i)}).filter(function(i){return i>=1&&i<=16})}static toTimestamp(e){let t=!1;const i=parseFloat(e);return isNaN(i)?!1:(typeof e=="string"&&e.substring(0,1)==="+"?i>=0&&(t=ye.time+i):i>=0&&(t=i),t)}static guessNoteNumber(e,t){t=parseInt(t)||0;let i=!1;if(Number.isInteger(e)&&e>=0&&e<=127)i=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)i=parseInt(e);else if(typeof e=="string"||e instanceof String)try{i=this.toNoteNumber(e.trim(),t)}catch{return!1}return i}static toNoteIdentifier(e,t){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(t=t==null?0:parseInt(t),isNaN(t))throw new RangeError("Invalid octaveOffset value");const i=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],s=Math.floor(e/12-1)+t;return i[e%12]+s.toString()}static buildNote(e,t={}){if(t.octaveOffset=parseInt(t.octaveOffset)||0,e instanceof _r)return e;let i=this.guessNoteNumber(e,t.octaveOffset);if(i===!1)throw new TypeError(`The input could not be parsed as a note (${e})`);return t.octaveOffset=void 0,new _r(i,t)}static buildNoteArray(e,t={}){let i=[];return Array.isArray(e)||(e=[e]),e.forEach(s=>{i.push(this.buildNote(s,t))}),i}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(e*127),0),127)}static fromMsbLsbToFloat(e,t=0){ye.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),t=Math.min(Math.max(parseInt(t)||0,0),127));const i=((e<<7)+t)/16383;return Math.min(Math.max(i,0),1)}static fromFloatToMsbLsb(e){ye.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const t=Math.round(e*16383);return{msb:t>>7,lsb:t&127}}static offsetNumber(e,t=0,i=0){if(ye.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");t=parseInt(t)||0,i=parseInt(i)||0}return Math.min(Math.max(e+t*12+i,0),127)}static getPropertyByValue(e,t){return Object.keys(e).find(i=>e[i]===t)}static getCcNameByNumber(e){if(!(ye.validation&&(e=parseInt(e),!(e>=0&&e<=127))))return ne.CONTROL_CHANGE_MESSAGES[e].name}static getCcNumberByName(e){let t=ne.CONTROL_CHANGE_MESSAGES.find(i=>i.name===e);return t?t.number:ne.MIDI_CONTROL_CHANGE_MESSAGES[e]}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let t in ne.CHANNEL_MODE_MESSAGES)if(ne.CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===ne.CHANNEL_MODE_MESSAGES[t])return t;return!1}static get isNode(){return typeof process<"u"&&process.versions!=null&&process.versions.node!=null}static get isBrowser(){return typeof window<"u"&&typeof window.document<"u"}}/**
 * The `OutputChannel` class represents a single output MIDI channel. `OutputChannel` objects are
 * provided by an [`Output`](Output) port which, itself, is made available by a device. The
 * `OutputChannel` object is derived from the host's MIDI subsystem and should not be instantiated
 * directly.
 *
 * All 16 `OutputChannel` objects can be found inside the parent output's
 * [`channels`]{@link Output#channels} property.
 *
 * @param {Output} output The [`Output`](Output) this channel belongs to.
 * @param {number} number The MIDI channel number (`1` - `16`).
 *
 * @extends EventEmitter
 * @license Apache-2.0
 * @since 3.0.0
 */class kP extends _i{constructor(e,t){super(),this._output=e,this._number=t,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,t={time:0}){return this.output.send(e,t),this}sendKeyAftertouch(e,t,i={}){if(ye.validation){if(i.useRawValue&&(i.rawValue=i.useRawValue),isNaN(parseFloat(t)))throw new RangeError("Invalid key aftertouch value.");if(i.rawValue){if(!(t>=0&&t<=127&&Number.isInteger(t)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(t>=0&&t<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}i.rawValue||(t=be.fromFloatTo7Bit(t));const s=ye.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),be.buildNoteArray(e).forEach(r=>{this.send([(ne.CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),r.getOffsetNumber(s),t],{time:be.toTimestamp(i.time)})}),this}sendControlChange(e,t,i={}){if(typeof e=="string"&&(e=be.getCcNumberByName(e)),Array.isArray(t)||(t=[t]),ye.validation){if(e===void 0)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(t=t.map(s=>{const r=Math.min(Math.max(parseInt(s),0),127);if(isNaN(r))throw new TypeError("Values must be integers between 0 and 127");return r}),t.length===2&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return t.forEach((s,r)=>{this.send([(ne.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+r*32,t[r]],{time:be.toTimestamp(i.time)})}),this}_selectNonRegisteredParameter(e,t={}){return this.sendControlChange(99,e[0],t),this.sendControlChange(98,e[1],t),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,t={}){return this.sendControlChange(101,e[0],t),this.sendControlChange(100,e[1],t),this}_setCurrentParameter(e,t={}){return e=[].concat(e),this.sendControlChange(6,e[0],t),e.length<2?this:(this.sendControlChange(38,e[1],t),this)}sendRpnDecrement(e,t={}){if(Array.isArray(e)||(e=ne.REGISTERED_PARAMETERS[e]),ye.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let i=!1;if(Object.getOwnPropertyNames(ne.REGISTERED_PARAMETERS).forEach(s=>{ne.REGISTERED_PARAMETERS[s][0]===e[0]&&ne.REGISTERED_PARAMETERS[s][1]===e[1]&&(i=!0)}),!i)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(97,0,t),this._deselectRegisteredParameter(t),this}sendRpnIncrement(e,t={}){if(Array.isArray(e)||(e=ne.REGISTERED_PARAMETERS[e]),ye.validation){if(e===void 0)throw new TypeError("The specified registered parameter is invalid.");let i=!1;if(Object.getOwnPropertyNames(ne.REGISTERED_PARAMETERS).forEach(s=>{ne.REGISTERED_PARAMETERS[s][0]===e[0]&&ne.REGISTERED_PARAMETERS[s][1]===e[1]&&(i=!0)}),!i)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(96,0,t),this._deselectRegisteredParameter(t),this}playNote(e,t={}){this.sendNoteOn(e,t);const i=Array.isArray(e)?e:[e];for(let s of i)if(parseInt(s.duration)>0){const r={time:(be.toTimestamp(t.time)||ye.time)+parseInt(s.duration),release:s.release,rawRelease:s.rawRelease};this.sendNoteOff(s,r)}else if(parseInt(t.duration)>0){const r={time:(be.toTimestamp(t.time)||ye.time)+parseInt(t.duration),release:t.release,rawRelease:t.rawRelease};this.sendNoteOff(s,r)}return this}sendNoteOff(e,t={}){if(ye.validation){if(t.rawRelease!=null&&!(t.rawRelease>=0&&t.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(t.release!=null&&!(t.release>=0&&t.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");t.rawVelocity&&(t.rawRelease=t.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),t.velocity&&(t.release=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let i=64;t.rawRelease!=null?i=t.rawRelease:isNaN(t.release)||(i=Math.round(t.release*127));const s=ye.octaveOffset+this.output.octaveOffset+this.octaveOffset;return be.buildNoteArray(e,{rawRelease:parseInt(i)}).forEach(r=>{this.send([(ne.CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),r.getOffsetNumber(s),r.rawRelease],{time:be.toTimestamp(t.time)})}),this}stopNote(e,t={}){return this.sendNoteOff(e,t)}sendNoteOn(e,t={}){if(ye.validation){if(t.rawAttack!=null&&!(t.rawAttack>=0&&t.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(t.attack!=null&&!(t.attack>=0&&t.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");t.rawVelocity&&(t.rawAttack=t.velocity,t.rawRelease=t.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),t.velocity&&(t.attack=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let i=64;t.rawAttack!=null?i=t.rawAttack:isNaN(t.attack)||(i=Math.round(t.attack*127));const s=ye.octaveOffset+this.output.octaveOffset+this.octaveOffset;return be.buildNoteArray(e,{rawAttack:i}).forEach(r=>{this.send([(ne.CHANNEL_MESSAGES.noteon<<4)+(this.number-1),r.getOffsetNumber(s),r.rawAttack],{time:be.toTimestamp(t.time)})}),this}sendChannelMode(e,t=0,i={}){if(typeof e=="string"&&(e=ne.CHANNEL_MODE_MESSAGES[e]),ye.validation){if(e===void 0)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(t))||t<0||t>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(ne.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,t],{time:be.toTimestamp(i.time)}),this}sendOmniMode(e,t={}){return e===void 0||e?this.sendChannelMode("omnimodeon",0,t):this.sendChannelMode("omnimodeoff",0,t),this}sendChannelAftertouch(e,t={}){if(ye.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(t.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return t.rawValue||(e=be.fromFloatTo7Bit(e)),this.send([(ne.CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(e)],{time:be.toTimestamp(t.time)}),this}sendMasterTuning(e,t={}){if(e=parseFloat(e)||0,ye.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let i=Math.floor(e)+64,s=e-Math.floor(e);s=Math.round((s+1)/2*16383);let r=s>>7&127,a=s&127;return this.sendRpnValue("channelcoarsetuning",i,t),this.sendRpnValue("channelfinetuning",[r,a],t),this}sendModulationRange(e,t,i={}){if(ye.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(t!=null&&(!Number.isInteger(t)||!(t>=0&&t<=127)))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return t>=0&&t<=127||(t=0),this.sendRpnValue("modulationrange",[e,t],i),this}sendNrpnValue(e,t,i={}){if(t=[].concat(t),ye.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");t.forEach(s=>{if(!(s>=0&&s<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")})}return this._selectNonRegisteredParameter(e,i),this._setCurrentParameter(t,i),this._deselectNonRegisteredParameter(i),this}sendPitchBend(e,t={}){if(ye.validation)if(t.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(t.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||e===null)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend value must be a float between -1 and 1.")}let i=0,s=0;if(t.rawValue&&Array.isArray(e))i=e[0],s=e[1];else if(t.rawValue&&!Array.isArray(e))i=e;else{const r=be.fromFloatToMsbLsb((e+1)/2);i=r.msb,s=r.lsb}return this.send([(ne.CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),s,i],{time:be.toTimestamp(t.time)}),this}sendPitchBendRange(e,t,i={}){if(ye.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(t)||!(t>=0&&t<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,t],i),this}sendProgramChange(e,t={}){if(e=parseInt(e)||0,ye.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(ne.CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:be.toTimestamp(t.time)}),this}sendRpnValue(e,t,i={}){if(Array.isArray(e)||(e=ne.REGISTERED_PARAMETERS[e]),ye.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(t).forEach(s=>{if(!(s>=0&&s<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")})}return this._selectRegisteredParameter(e,i),this._setCurrentParameter(t,i),this._deselectRegisteredParameter(i),this}sendTuningBank(e,t={}){if(ye.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,t),this}sendTuningProgram(e,t={}){if(ye.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,t),this}sendLocalControl(e,t={}){return e?this.sendChannelMode("localcontrol",127,t):this.sendChannelMode("localcontrol",0,t)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,t={}){return e==="mono"?this.sendChannelMode("monomodeon",0,t):this.sendChannelMode("polymodeon",0,t)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}/**
 * The `Output` class represents a single MIDI output port (not to be confused with a MIDI channel).
 * A port is made available by a MIDI device. A MIDI device can advertise several input and output
 * ports. Each port has 16 MIDI channels which can be accessed via the [`channels`](#channels)
 * property.
 *
 * The `Output` object is automatically instantiated by the library according to the host's MIDI
 * subsystem and should not be directly instantiated.
 *
 * You can access all available `Output` objects by referring to the
 * [`WebMidi.outputs`](WebMidi#outputs) array or by using methods such as
 * [`WebMidi.getOutputByName()`](WebMidi#getOutputByName) or
 * [`WebMidi.getOutputById()`](WebMidi#getOutputById).
 *
 * @fires Output#opened
 * @fires Output#disconnected
 * @fires Output#closed
 *
 * @extends EventEmitter
 * @license Apache-2.0
 */class qc extends _i{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let t=1;t<=16;t++)this.channels[t]=new kP(this,t);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._midiOutput&&(this._midiOutput.onstatechange=null),await this.close(),this._midiOutput=null}_onStateChange(e){let t={timestamp:ye.time};e.port.connection==="open"?(t.type="opened",t.target=this,t.port=t.target,this.emit("opened",t)):e.port.connection==="closed"&&e.port.state==="connected"?(t.type="closed",t.target=this,t.port=t.target,this.emit("closed",t)):e.port.connection==="closed"&&e.port.state==="disconnected"?(t.type="disconnected",t.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,t={time:0},i=0){if(e instanceof _0&&(e=be.isNode?e.data:e.rawData),e instanceof Uint8Array&&be.isNode&&(e=Array.from(e)),ye.validation){if(!Array.isArray(e)&&!(e instanceof Uint8Array)&&(e=[e],Array.isArray(t)&&(e=e.concat(t)),t=isNaN(i)?{time:0}:{time:i}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach(s=>{if(s=parseInt(s),!(s>=0&&s<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")}),t||(t={time:0})}return this._midiOutput.send(e,be.toTimestamp(t.time)),this}sendSysex(e,t=[],i={}){if(e=[].concat(e),t instanceof Uint8Array){const s=new Uint8Array(1+e.length+t.length+1);s[0]=ne.SYSTEM_MESSAGES.sysex,s.set(Uint8Array.from(e),1),s.set(t,1+e.length),s[s.length-1]=ne.SYSTEM_MESSAGES.sysexend,this.send(s,{time:i.time})}else{const s=e.concat(t,ne.SYSTEM_MESSAGES.sysexend);this.send([ne.SYSTEM_MESSAGES.sysex].concat(s),{time:i.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():ye.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,t={}){if(ye.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([ne.SYSTEM_MESSAGES.timecode,e],{time:t.time}),this}sendSongPosition(e=0,t={}){e=Math.floor(e)||0;var i=e>>7&127,s=e&127;return this.send([ne.SYSTEM_MESSAGES.songposition,i,s],{time:t.time}),this}sendSongSelect(e=0,t={}){if(ye.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([ne.SYSTEM_MESSAGES.songselect,e],{time:t.time}),this}sendTuneRequest(e={}){return this.send([ne.SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([ne.SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([ne.SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([ne.SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([ne.SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([ne.SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([ne.SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return ye.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,t,i={}){return i.channels==null&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(i.channels).forEach(s=>{this.channels[s].sendKeyAftertouch(e,t,i)}),this}sendControlChange(e,t,i={},s={}){if(ye.validation&&(Array.isArray(i)||Number.isInteger(i)||i==="all")){const r=i;i=s,i.channels=r,i.channels==="all"&&(i.channels=ne.MIDI_CHANNEL_NUMBERS)}return i.channels==null&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(i.channels).forEach(r=>{this.channels[r].sendControlChange(e,t,i)}),this}sendPitchBendRange(e=0,t=0,i={}){return i.channels==null&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(i.channels).forEach(s=>{this.channels[s].sendPitchBendRange(e,t,i)}),this}setPitchBendRange(e=0,t=0,i="all",s={}){return ye.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),s.channels=i,s.channels==="all"&&(s.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,t,s)}sendRpnValue(e,t,i={}){return i.channels==null&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(i.channels).forEach(s=>{this.channels[s].sendRpnValue(e,t,i)}),this}setRegisteredParameter(e,t=[],i="all",s={}){return ye.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),s.channels=i,s.channels==="all"&&(s.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,t,s)}sendChannelAftertouch(e,t={},i={}){if(ye.validation&&(Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].sendChannelAftertouch(e,t)}),this}sendPitchBend(e,t={},i={}){if(ye.validation&&(Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].sendPitchBend(e,t)}),this}sendProgramChange(e=0,t={},i={}){if(ye.validation&&(Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].sendProgramChange(e,t)}),this}sendModulationRange(e,t,i={}){return i.channels==null&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(i.channels).forEach(s=>{this.channels[s].sendModulationRange(e,t,i)}),this}setModulationRange(e=0,t=0,i="all",s={}){return ye.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),s.channels=i,s.channels==="all"&&(s.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,t,s)}sendMasterTuning(e,t={}){return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(i=>{this.channels[i].sendMasterTuning(e,t)}),this}setMasterTuning(e,t={},i={}){return ye.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),i.channels=t,i.channels==="all"&&(i.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,i)}sendTuningProgram(e,t={}){return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(i=>{this.channels[i].sendTuningProgram(e,t)}),this}setTuningProgram(e,t="all",i={}){return ye.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),i.channels=t,i.channels==="all"&&(i.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,i)}sendTuningBank(e=0,t={}){return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(i=>{this.channels[i].sendTuningBank(e,t)}),this}setTuningBank(e,t="all",i={}){return ye.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),i.channels=t,i.channels==="all"&&(i.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,i)}sendChannelMode(e,t=0,i={},s={}){if(ye.validation&&(Array.isArray(i)||Number.isInteger(i)||i==="all")){const r=i;i=s,i.channels=r,i.channels==="all"&&(i.channels=ne.MIDI_CHANNEL_NUMBERS)}return i.channels==null&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(i.channels).forEach(r=>{this.channels[r].sendChannelMode(e,t,i)}),this}sendAllSoundOff(e={}){return e.channels==null&&(e.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(e.channels).forEach(t=>{this.channels[t].sendAllSoundOff(e)}),this}sendAllNotesOff(e={}){return e.channels==null&&(e.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(e.channels).forEach(t=>{this.channels[t].sendAllNotesOff(e)}),this}sendResetAllControllers(e={},t={}){if(ye.validation&&(Array.isArray(e)||Number.isInteger(e)||e==="all")){const i=e;e=t,e.channels=i,e.channels==="all"&&(e.channels=ne.MIDI_CHANNEL_NUMBERS)}return e.channels==null&&(e.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(e.channels).forEach(i=>{this.channels[i].sendResetAllControllers(e)}),this}sendPolyphonicMode(e,t={},i={}){if(ye.validation&&(Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].sendPolyphonicMode(e,t)}),this}sendLocalControl(e,t={},i={}){if(ye.validation&&(Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].sendLocalControl(e,t)}),this}sendOmniMode(e,t={},i={}){if(ye.validation&&(Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].sendOmniMode(e,t)}),this}sendNrpnValue(e,t,i={}){return i.channels==null&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(i.channels).forEach(s=>{this.channels[s].sendNrpnValue(e,t,i)}),this}setNonRegisteredParameter(e,t=[],i="all",s={}){return ye.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),s.channels=i,s.channels==="all"&&(s.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,t,s)}sendRpnIncrement(e,t={}){return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(i=>{this.channels[i].sendRpnIncrement(e,t)}),this}incrementRegisteredParameter(e,t="all",i={}){return ye.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),i.channels=t,i.channels==="all"&&(i.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,i)}sendRpnDecrement(e,t={}){return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(i=>{this.channels[i].sendRpnDecrement(e,t)}),this}decrementRegisteredParameter(e,t="all",i={}){return ye.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),i.channels=t,i.channels==="all"&&(i.channels=ne.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,i)}sendNoteOff(e,t={},i={}){if(ye.validation&&(Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].sendNoteOff(e,t)}),this}stopNote(e,t){return this.sendNoteOff(e,t)}playNote(e,t={},i={}){if(ye.validation&&(t.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),t.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].playNote(e,t)}),this}sendNoteOn(e,t={},i={}){if(ye.validation&&(Array.isArray(t)||Number.isInteger(t)||t==="all")){const s=t;t=i,t.channels=s,t.channels==="all"&&(t.channels=ne.MIDI_CHANNEL_NUMBERS)}return t.channels==null&&(t.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(t.channels).forEach(s=>{this.channels[s].sendNoteOn(e,t)}),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}/**
 * The `Forwarder` class allows the forwarding of MIDI messages to predetermined outputs. When you
 * call its [`forward()`](#forward) method, it will send the specified [`Message`](Message) object
 * to all the outputs listed in its [`destinations`](#destinations) property.
 *
 * If specific channels or message types have been defined in the [`channels`](#channels) or
 * [`types`](#types) properties, only messages matching the channels/types will be forwarded.
 *
 * While it can be manually instantiated, you are more likely to come across a `Forwarder` object as
 * the return value of the [`Input.addForwarder()`](Input#addForwarder) method.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class Bf{constructor(e=[],t={}){this.destinations=[],this.types=[...Object.keys(ne.SYSTEM_MESSAGES),...Object.keys(ne.CHANNEL_MESSAGES)],this.channels=ne.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),t.types&&!Array.isArray(t.types)&&(t.types=[t.types]),t.channels&&!Array.isArray(t.channels)&&(t.channels=[t.channels]),ye.validation&&(e.forEach(i=>{if(!(i instanceof qc))throw new TypeError("Destinations must be of type 'Output'.")}),t.types!==void 0&&t.types.forEach(i=>{if(!ne.SYSTEM_MESSAGES.hasOwnProperty(i)&&!ne.CHANNEL_MESSAGES.hasOwnProperty(i))throw new TypeError("Type must be a valid message type.")}),t.channels!==void 0&&t.channels.forEach(i=>{if(!ne.MIDI_CHANNEL_NUMBERS.includes(i))throw new TypeError("MIDI channel must be between 1 and 16.")})),this.destinations=e,t.types&&(this.types=t.types),t.channels&&(this.channels=t.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach(t=>{ye.validation&&!(t instanceof qc)||t.send(e)}))}}/**
 * The `InputChannel` class represents a single MIDI input channel (1-16) from a single input
 * device. This object is derived from the host's MIDI subsystem and should not be instantiated
 * directly.
 *
 * All 16 `InputChannel` objects can be found inside the input's [`channels`](Input#channels)
 * property.
 *
 * @fires InputChannel#midimessage
 * @fires InputChannel#unknownmessage
 *
 * @fires InputChannel#noteoff
 * @fires InputChannel#noteon
 * @fires InputChannel#keyaftertouch
 * @fires InputChannel#programchange
 * @fires InputChannel#channelaftertouch
 * @fires InputChannel#pitchbend
 *
 * @fires InputChannel#allnotesoff
 * @fires InputChannel#allsoundoff
 * @fires InputChannel#localcontrol
 * @fires InputChannel#monomode
 * @fires InputChannel#omnimode
 * @fires InputChannel#resetallcontrollers
 *
 * @fires InputChannel#event:nrpn
 * @fires InputChannel#event:nrpn-dataentrycoarse
 * @fires InputChannel#event:nrpn-dataentryfine
 * @fires InputChannel#event:nrpn-dataincrement
 * @fires InputChannel#event:nrpn-datadecrement
 * @fires InputChannel#event:rpn
 * @fires InputChannel#event:rpn-dataentrycoarse
 * @fires InputChannel#event:rpn-dataentryfine
 * @fires InputChannel#event:rpn-dataincrement
 * @fires InputChannel#event:rpn-datadecrement
 *
 * @fires InputChannel#controlchange
 * @fires InputChannel#event:controlchange-controllerxxx
 * @fires InputChannel#event:controlchange-bankselectcoarse
 * @fires InputChannel#event:controlchange-modulationwheelcoarse
 * @fires InputChannel#event:controlchange-breathcontrollercoarse
 * @fires InputChannel#event:controlchange-footcontrollercoarse
 * @fires InputChannel#event:controlchange-portamentotimecoarse
 * @fires InputChannel#event:controlchange-dataentrycoarse
 * @fires InputChannel#event:controlchange-volumecoarse
 * @fires InputChannel#event:controlchange-balancecoarse
 * @fires InputChannel#event:controlchange-pancoarse
 * @fires InputChannel#event:controlchange-expressioncoarse
 * @fires InputChannel#event:controlchange-effectcontrol1coarse
 * @fires InputChannel#event:controlchange-effectcontrol2coarse
 * @fires InputChannel#event:controlchange-generalpurposecontroller1
 * @fires InputChannel#event:controlchange-generalpurposecontroller2
 * @fires InputChannel#event:controlchange-generalpurposecontroller3
 * @fires InputChannel#event:controlchange-generalpurposecontroller4
 * @fires InputChannel#event:controlchange-bankselectfine
 * @fires InputChannel#event:controlchange-modulationwheelfine
 * @fires InputChannel#event:controlchange-breathcontrollerfine
 * @fires InputChannel#event:controlchange-footcontrollerfine
 * @fires InputChannel#event:controlchange-portamentotimefine
 * @fires InputChannel#event:controlchange-dataentryfine
 * @fires InputChannel#event:controlchange-channelvolumefine
 * @fires InputChannel#event:controlchange-balancefine
 * @fires InputChannel#event:controlchange-panfine
 * @fires InputChannel#event:controlchange-expressionfine
 * @fires InputChannel#event:controlchange-effectcontrol1fine
 * @fires InputChannel#event:controlchange-effectcontrol2fine
 * @fires InputChannel#event:controlchange-damperpedal
 * @fires InputChannel#event:controlchange-portamento
 * @fires InputChannel#event:controlchange-sostenuto
 * @fires InputChannel#event:controlchange-softpedal
 * @fires InputChannel#event:controlchange-legatopedal
 * @fires InputChannel#event:controlchange-hold2
 * @fires InputChannel#event:controlchange-soundvariation
 * @fires InputChannel#event:controlchange-resonance
 * @fires InputChannel#event:controlchange-releasetime
 * @fires InputChannel#event:controlchange-attacktime
 * @fires InputChannel#event:controlchange-brightness
 * @fires InputChannel#event:controlchange-decaytime
 * @fires InputChannel#event:controlchange-vibratorate
 * @fires InputChannel#event:controlchange-vibratodepth
 * @fires InputChannel#event:controlchange-vibratodelay
 * @fires InputChannel#event:controlchange-generalpurposecontroller5
 * @fires InputChannel#event:controlchange-generalpurposecontroller6
 * @fires InputChannel#event:controlchange-generalpurposecontroller7
 * @fires InputChannel#event:controlchange-generalpurposecontroller8
 * @fires InputChannel#event:controlchange-portamentocontrol
 * @fires InputChannel#event:controlchange-highresolutionvelocityprefix
 * @fires InputChannel#event:controlchange-effect1depth
 * @fires InputChannel#event:controlchange-effect2depth
 * @fires InputChannel#event:controlchange-effect3depth
 * @fires InputChannel#event:controlchange-effect4depth
 * @fires InputChannel#event:controlchange-effect5depth
 * @fires InputChannel#event:controlchange-dataincrement
 * @fires InputChannel#event:controlchange-datadecrement
 * @fires InputChannel#event:controlchange-nonregisteredparameterfine
 * @fires InputChannel#event:controlchange-nonregisteredparametercoarse
 * @fires InputChannel#event:controlchange-registeredparameterfine
 * @fires InputChannel#event:controlchange-registeredparametercoarse
 * @fires InputChannel#event:controlchange-allsoundoff
 * @fires InputChannel#event:controlchange-resetallcontrollers
 * @fires InputChannel#event:controlchange-localcontrol
 * @fires InputChannel#event:controlchange-allnotesoff
 * @fires InputChannel#event:controlchange-omnimodeoff
 * @fires InputChannel#event:controlchange-omnimodeon
 * @fires InputChannel#event:controlchange-monomodeon
 * @fires InputChannel#event:controlchange-polymodeon
 * @fires InputChannel#event:
 *
 * @extends EventEmitter
 * @license Apache-2.0
 * @since 3.0.0
 */class MP extends _i{constructor(e,t){super(),this._input=e,this._number=t,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const t=Object.assign({},e);t.port=this.input,t.target=this,t.type="midimessage",this.emit(t.type,t),this._parseEventForStandardMessages(t)}_parseEventForStandardMessages(e){const t=Object.assign({},e);t.type=t.message.type||"unknownmessage";const i=e.message.dataBytes[0],s=e.message.dataBytes[1];if(t.type==="noteoff"||t.type==="noteon"&&s===0)this.notesState[i]=!1,t.type="noteoff",t.note=new _r(be.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+ye.octaveOffset),{rawAttack:0,rawRelease:s}),t.value=be.from7bitToFloat(s),t.rawValue=s,t.velocity=t.note.release,t.rawVelocity=t.note.rawRelease;else if(t.type==="noteon")this.notesState[i]=!0,t.note=new _r(be.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+ye.octaveOffset),{rawAttack:s}),t.value=be.from7bitToFloat(s),t.rawValue=s,t.velocity=t.note.attack,t.rawVelocity=t.note.rawAttack;else if(t.type==="keyaftertouch")t.note=new _r(be.offsetNumber(i,this.octaveOffset+this.input.octaveOffset+ye.octaveOffset)),t.value=be.from7bitToFloat(s),t.rawValue=s,t.identifier=t.note.identifier,t.key=t.note.number,t.rawKey=i;else if(t.type==="controlchange"){t.controller={number:i,name:ne.CONTROL_CHANGE_MESSAGES[i].name,description:ne.CONTROL_CHANGE_MESSAGES[i].description,position:ne.CONTROL_CHANGE_MESSAGES[i].position},t.subtype=t.controller.name||"controller"+i,t.value=be.from7bitToFloat(s),t.rawValue=s;const r=Object.assign({},t);r.type=`${t.type}-controller${i}`,delete r.subtype,this.emit(r.type,r);const a=Object.assign({},t);a.type=`${t.type}-`+ne.CONTROL_CHANGE_MESSAGES[i].name,delete a.subtype,a.type.indexOf("controller")!==0&&this.emit(a.type,a),t.message.dataBytes[0]>=120&&this._parseChannelModeMessage(t),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(t.message.dataBytes[0])&&this._parseEventForParameterNumber(t)}else t.type==="programchange"?(t.value=i,t.rawValue=t.value):t.type==="channelaftertouch"?(t.value=be.from7bitToFloat(i),t.rawValue=i):t.type==="pitchbend"?(t.value=((s<<7)+i-8192)/8192,t.rawValue=(s<<7)+i):t.type="unknownmessage";this.emit(t.type,t)}_parseChannelModeMessage(e){const t=Object.assign({},e);t.type=t.controller.name,t.type==="localcontrol"&&(t.value=t.message.data[2]===127,t.rawValue=t.message.data[2]),t.type==="omnimodeon"?(t.type="omnimode",t.value=!0,t.rawValue=t.message.data[2]):t.type==="omnimodeoff"&&(t.type="omnimode",t.value=!1,t.rawValue=t.message.data[2]),t.type==="monomodeon"?(t.type="monomode",t.value=!0,t.rawValue=t.message.data[2]):t.type==="polymodeon"&&(t.type="monomode",t.value=!1,t.rawValue=t.message.data[2]),this.emit(t.type,t)}_parseEventForParameterNumber(e){const t=e.message.dataBytes[0],i=e.message.dataBytes[1];t===99||t===101?(this._nrpnBuffer=[],this._rpnBuffer=[],t===99?this._nrpnBuffer=[e.message]:i!==127&&(this._rpnBuffer=[e.message])):t===98||t===100?t===98?(this._rpnBuffer=[],this._nrpnBuffer.length===1?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],this._rpnBuffer.length===1&&i!==127?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):(t===6||t===38||t===96||t===97)&&(this._rpnBuffer.length===2?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):this._nrpnBuffer.length===2?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return e===6||e===38||e===96||e===97||e===98||e===99||e===100||e===101}_dispatchParameterNumberEvent(e,t,i,s){e=e==="nrpn"?"nrpn":"rpn";const r={target:s.target,timestamp:s.timestamp,message:s.message,parameterMsb:t,parameterLsb:i,value:be.from7bitToFloat(s.message.dataBytes[1]),rawValue:s.message.dataBytes[1]};e==="rpn"?r.parameter=Object.keys(ne.REGISTERED_PARAMETERS).find(l=>ne.REGISTERED_PARAMETERS[l][0]===t&&ne.REGISTERED_PARAMETERS[l][1]===i):r.parameter=(t<<7)+i;const a=ne.CONTROL_CHANGE_MESSAGES[s.message.dataBytes[0]].name;r.type=`${e}-${a}`,this.emit(r.type,r);const o=Object.assign({},r);o.type==="nrpn-dataincrement"?o.type="nrpn-databuttonincrement":o.type==="nrpn-datadecrement"?o.type="nrpn-databuttondecrement":o.type==="rpn-dataincrement"?o.type="rpn-databuttonincrement":o.type==="rpn-datadecrement"&&(o.type="rpn-databuttondecrement"),this.emit(o.type,o),r.type=e,r.subtype=a,this.emit(r.type,r)}getChannelModeByNumber(e){return ye.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),be.getChannelModeByNumber(e)}getCcNameByNumber(e){if(ye.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),e=parseInt(e),!(e>=0&&e<=127)))throw new RangeError("Invalid control change number.");return be.getCcNameByNumber(e)}getNoteState(e){e instanceof _r&&(e=e.identifier);const t=be.guessNoteNumber(e,ye.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[t]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}/**
 * The `Message` class represents a single MIDI message. It has several properties that make it
 * easy to make sense of the binary data it contains.
 *
 * @license Apache-2.0
 * @since 3.0.0
 */class _0{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=(this.statusByte&15)+1):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=be.getPropertyByValue(ne.CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=be.getPropertyByValue(ne.SYSTEM_MESSAGES,this.command)),this.statusByte===ne.SYSTEM_MESSAGES.sysex&&(this.dataBytes[0]===0?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}/**
 * The `Input` class represents a single MIDI input port. This object is automatically instantiated
 * by the library according to the host's MIDI subsystem and does not need to be directly
 * instantiated. Instead, you can access all `Input` objects by referring to the
 * [`WebMidi.inputs`](WebMidi#inputs) array. You can also retrieve inputs by using methods such as
 * [`WebMidi.getInputByName()`](WebMidi#getInputByName) and
 * [`WebMidi.getInputById()`](WebMidi#getInputById).
 *
 * Note that a single MIDI device may expose several inputs and/or outputs.
 *
 * **Important**: the `Input` class does not directly fire channel-specific MIDI messages
 * (such as [`noteon`](InputChannel#event:noteon) or
 * [`controlchange`](InputChannel#event:controlchange), etc.). The [`InputChannel`](InputChannel)
 * object does that. However, you can still use the
 * [`Input.addListener()`](#addListener) method to listen to channel-specific events on multiple
 * [`InputChannel`](InputChannel) objects at once.
 *
 * @fires Input#opened
 * @fires Input#disconnected
 * @fires Input#closed
 * @fires Input#midimessage
 *
 * @fires Input#sysex
 * @fires Input#timecode
 * @fires Input#songposition
 * @fires Input#songselect
 * @fires Input#tunerequest
 * @fires Input#clock
 * @fires Input#start
 * @fires Input#continue
 * @fires Input#stop
 * @fires Input#activesensing
 * @fires Input#reset
 *
 * @fires Input#unknownmidimessage
 *
 * @extends EventEmitter
 * @license Apache-2.0
 */class DP extends _i{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let t=1;t<=16;t++)this.channels[t]=new MP(this,t);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach(e=>e.destroy()),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),await this.close(),this._midiInput=null}_onStateChange(e){let t={timestamp:ye.time,target:this,port:this};e.port.connection==="open"?(t.type="opened",this.emit("opened",t)):e.port.connection==="closed"&&e.port.state==="connected"?(t.type="closed",this.emit("closed",t)):e.port.connection==="closed"&&e.port.state==="disconnected"?(t.type="disconnected",t.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):e.port.connection==="pending"&&e.port.state==="disconnected"||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const t=new _0(e.data),i={port:this,target:this,message:t,timestamp:e.timeStamp,type:"midimessage",data:t.data,rawData:t.data,statusByte:t.data[0],dataBytes:t.dataBytes};this.emit("midimessage",i),t.isSystemMessage?this._parseEvent(i):t.isChannelMessage&&this.channels[t.channel]._processMidiMessageEvent(i),this._forwarders.forEach(s=>s.forward(t))}_parseEvent(e){const t=Object.assign({},e);t.type=t.message.type||"unknownmidimessage",t.type==="songselect"&&(t.song=e.data[1]+1,t.value=e.data[1],t.rawValue=t.value),this.emit(t.type,t)}async open(){try{await this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}async close(){if(!this._midiInput)return Promise.resolve(this);try{await this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}getChannelModeByNumber(){ye.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,t,i={}){if(ye.validation&&typeof i=="function"){let s=t!=null?[].concat(t):void 0;t=i,i={channels:s}}if(ne.CHANNEL_EVENTS.includes(e)){i.channels===void 0&&(i.channels=ne.MIDI_CHANNEL_NUMBERS);let s=[];return be.sanitizeChannels(i.channels).forEach(r=>{s.push(this.channels[r].addListener(e,t,i))}),s}else return super.addListener(e,t,i)}addOneTimeListener(e,t,i={}){return i.remaining=1,this.addListener(e,t,i)}on(e,t,i,s){return this.addListener(e,t,i,s)}hasListener(e,t,i={}){if(ye.validation&&typeof i=="function"){let s=[].concat(t);t=i,i={channels:s}}return ne.CHANNEL_EVENTS.includes(e)?(i.channels===void 0&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),be.sanitizeChannels(i.channels).every(s=>this.channels[s].hasListener(e,t))):super.hasListener(e,t)}removeListener(e,t,i={}){if(ye.validation&&typeof i=="function"){let s=[].concat(t);t=i,i={channels:s}}if(i.channels===void 0&&(i.channels=ne.MIDI_CHANNEL_NUMBERS),e==null)return be.sanitizeChannels(i.channels).forEach(s=>{this.channels[s]&&this.channels[s].removeListener()}),super.removeListener();ne.CHANNEL_EVENTS.includes(e)?be.sanitizeChannels(i.channels).forEach(s=>{this.channels[s].removeListener(e,t,i)}):super.removeListener(e,t,i)}addForwarder(e,t={}){let i;return e instanceof Bf?i=e:i=new Bf(e,t),this._forwarders.push(i),i}removeForwarder(e){this._forwarders=this._forwarders.filter(t=>t!==e)}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return ye.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}/**
 * The `WebMidi` object makes it easier to work with the low-level Web MIDI API. Basically, it
 * simplifies sending outgoing MIDI messages and reacting to incoming MIDI messages.
 *
 * When using the WebMidi.js library, you should know that the `WebMidi` class has already been
 * instantiated. You cannot instantiate it yourself. If you use the **IIFE** version, you should
 * simply use the global object called `WebMidi`. If you use the **CJS** (CommonJS) or **ESM** (ES6
 * module) version, you get an already-instantiated object when you import the module.
 *
 * @fires WebMidi#connected
 * @fires WebMidi#disabled
 * @fires WebMidi#disconnected
 * @fires WebMidi#enabled
 * @fires WebMidi#error
 * @fires WebMidi#midiaccessgranted
 * @fires WebMidi#portschanged
 *
 * @extends EventEmitter
 * @license Apache-2.0
 */class $P extends _i{constructor(){super(),this.defaults={note:{attack:be.from7bitToFloat(64),release:be.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},t=!1){if(be.isNode)try{window.navigator}catch{let o=await Object.getPrototypeOf(async function(){}).constructor(`
        let jzz = await import("jzz");
        return jzz.default;
        `)();global.navigator||(global.navigator={}),Object.assign(global.navigator,o)}if(this.validation=e.validation!==!1,this.validation&&(typeof e=="function"&&(e={callback:e,sysex:t}),t&&(e.sysex=!0)),this.enabled)return typeof e.callback=="function"&&e.callback(),Promise.resolve();const i={timestamp:this.time,target:this,type:"error",error:void 0},s={timestamp:this.time,target:this,type:"midiaccessgranted"},r={timestamp:this.time,target:this,type:"enabled"};try{typeof e.requestMIDIAccessFunction=="function"?this.interface=await e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(a){return i.error=a,this.emit("error",i),typeof e.callback=="function"&&e.callback(a),Promise.reject(a)}this.emit("midiaccessgranted",s),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{await this._updateInputsAndOutputs()}catch(a){return i.error=a,this.emit("error",i),typeof e.callback=="function"&&e.callback(a),Promise.reject(a)}return this.emit("enabled",r),typeof e.callback=="function"&&e.callback(),Promise.resolve(this)}async disable(){return this.interface&&(this.interface.onstatechange=void 0),this._destroyInputsAndOutputs().then(()=>{navigator&&typeof navigator.close=="function"&&navigator.close(),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()})}getInputById(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(t.disconnected){for(let i=0;i<this._disconnectedInputs.length;i++)if(this._disconnectedInputs[i]._midiInput&&this._disconnectedInputs[i].id===e.toString())return this._disconnectedInputs[i]}else for(let i=0;i<this.inputs.length;i++)if(this.inputs[i]._midiInput&&this.inputs[i].id===e.toString())return this.inputs[i]}getInputByName(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(t.disconnected){for(let i=0;i<this._disconnectedInputs.length;i++)if(~this._disconnectedInputs[i].name.indexOf(e))return this._disconnectedInputs[i]}else for(let i=0;i<this.inputs.length;i++)if(~this.inputs[i].name.indexOf(e))return this.inputs[i]}getOutputByName(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(t.disconnected){for(let i=0;i<this._disconnectedOutputs.length;i++)if(~this._disconnectedOutputs[i].name.indexOf(e))return this._disconnectedOutputs[i]}else for(let i=0;i<this.outputs.length;i++)if(~this.outputs[i].name.indexOf(e))return this.outputs[i]}getOutputById(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(t.disconnected){for(let i=0;i<this._disconnectedOutputs.length;i++)if(this._disconnectedOutputs[i]._midiOutput&&this._disconnectedOutputs[i].id===e.toString())return this._disconnectedOutputs[i]}else for(let i=0;i<this.outputs.length;i++)if(this.outputs[i]._midiOutput&&this.outputs[i].id===e.toString())return this.outputs[i]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),be.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127?be.getNoteDetails(be.offsetNumber(e,this.octaveOffset)).octave:!1}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),be.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),be.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),be.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,t={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),be.buildNoteArray(e,t)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),be.toTimestamp(e)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach(t=>e.push(t.destroy())),this.outputs.forEach(t=>e.push(t.destroy())),Promise.all(e).then(()=>{this._inputs=[],this._outputs=[]})}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let t={timestamp:e.timeStamp,type:e.port.state,target:this};if(e.port.state==="connected"&&e.port.connection==="open"){e.port.type==="output"?t.port=this.getOutputById(e.port.id):e.port.type==="input"&&(t.port=this.getInputById(e.port.id)),this.emit(e.port.state,t);const i=Object.assign({},t);i.type="portschanged",this.emit(i.type,i)}else if(e.port.state==="disconnected"&&e.port.connection==="pending"){e.port.type==="input"?t.port=this.getInputById(e.port.id,{disconnected:!0}):e.port.type==="output"&&(t.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,t);const i=Object.assign({},t);i.type="portschanged",this.emit(i.type,i)}}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){if(!this.interface)return;for(let t=this._inputs.length-1;t>=0;t--){const i=this._inputs[t];Array.from(this.interface.inputs.values()).find(r=>r===i._midiInput)||(this._disconnectedInputs.push(i),this._inputs.splice(t,1))}let e=[];return this.interface.inputs.forEach(t=>{if(!this._inputs.find(i=>i._midiInput===t)){let i=this._disconnectedInputs.find(s=>s._midiInput===t);i||(i=new DP(t)),this._inputs.push(i),e.push(i.open())}}),Promise.all(e)}async _updateOutputs(){if(!this.interface)return;for(let t=this._outputs.length-1;t>=0;t--){const i=this._outputs[t];Array.from(this.interface.outputs.values()).find(r=>r===i._midiOutput)||(this._disconnectedOutputs.push(i),this._outputs.splice(t,1))}let e=[];return this.interface.outputs.forEach(t=>{if(!this._outputs.find(i=>i._midiOutput===t)){let i=this._disconnectedOutputs.find(s=>s._midiOutput===t);i||(i=new qc(t)),this._outputs.push(i),e.push(i.open())}}),Promise.all(e)}get enabled(){return this.interface!==null}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),be.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),be.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return typeof navigator<"u"&&!!navigator.requestMIDIAccess}get sysexEnabled(){return!!(this.interface&&this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.1.14"}get flavour(){return"esm"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),ne.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.SYSTEM_MESSAGES."),ne.SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.CHANNEL_MODE_MESSAGES."),ne.CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been replaced by the Enumerations.CONTROL_CHANGE_MESSAGES array."),ne.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.REGISTERED_PARAMETERS."),ne.REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}}const ye=new $P;ye.constructor=null;let wu=null,Ff=null,Rf=null,If=null,Lf=null,Qf=null;const TP=(n,e)=>{if(!n||!e)return n;try{return new URL(n,e).toString()}catch{return n}},Wc=(n,e)=>{if(typeof n=="string")return TP(n,e);if(Array.isArray(n))return n.map(t=>Wc(t,e));if(n&&typeof n=="object"){const t={};return Object.entries(n).forEach(([i,s])=>{t[i]=Wc(s,e)}),t}return n},_P=n=>{if(!n||typeof n!="object")return n;const e=n._base||"",t={};return Object.entries(n).forEach(([i,s])=>{i!=="_base"&&(t[i]=Wc(s,e))}),t},Cu="https://raw.githubusercontent.com/felixroos/dough-samples/main";async function aa(){return wu||(wu=Promise.all([rn(()=>import("./strudel-core-DKU3hnf1.js").then(n=>n.b),[]),rn(()=>import("./strudel-web-D2TLs97f.js").then(n=>n.a),__vite__mapDeps([0,1])),rn(()=>import("./strudel-web-D2TLs97f.js").then(n=>n.b),__vite__mapDeps([0,1])),rn(()=>import("./index-DqhuNayL.js"),__vite__mapDeps([2,1,0]))]).then(n=>(Ff=n[0],If=n[1],Rf=n[2],Lf=n[3],Qf=null,{coreModule:Ff,webModule:If,webaudioModule:Rf,tonalModule:Lf,samplerModule:Qf}))),wu}const Sa={superpiano:"piano",wood:"jazz"};function Pu(n){if(!n||typeof n!="string")return n;let e=n;for(const[t,i]of Object.entries(Sa)){const s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(\\.s\\(["'])${s}(["']\\))`,"gi");e=e.replace(r,(o,l,c)=>`${l}${i}${c}`);const a=new RegExp(`(sound\\(["'])${s}(["']\\))`,"gi");e=e.replace(a,(o,l,c)=>`${l}${i}${c}`)}return e}const Au={major:"major",minor:"minor",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic",ionian:"major",aeolian:"minor","melodic minor":"melodic minor","dorian b2":"dorian b2","lydian augmented":"lydian augmented","lydian dominant":"lydian dominant","mixolydian b6":"mixolydian b6","locrian #2":"locrian #2",altered:"altered","harmonic minor":"harmonic minor","locrian #6":"locrian #6","ionian #5":"ionian #5","dorian #4":"dorian #4","phrygian dominant":"phrygian dominant","lydian #2":"lydian #2",ultralocrian:"ultralocrian","harmonic major":"harmonic major","dorian b5":"dorian b5","phrygian b4":"phrygian b4","lydian b3":"lydian b3","mixolydian b2":"mixolydian b2","lydian augmented #2":"lydian augmented #2","locrian bb7":"locrian bb7","major pentatonic":"major pentatonic","suspended pentatonic":"suspended pentatonic","man gong":"man gong",ritusen:"ritusen","minor pentatonic mode 5":"minor pentatonic","minor pentatonic":"minor pentatonic","blues minor pentatonic":"minor pentatonic","major pentatonic mode 3":"major pentatonic",egyptian:"egyptian","minor pentatonic mode 5":"minor pentatonic","whole tone":"whole tone","half-whole diminished":"dominant diminished","whole-half diminished":"diminished","minor blues":"blues"};function Vf(n){const e=/(\s+|[,;:<>()[\]{}|\\/]+|\*+)/g,t=n.split(e);let i=!1,s=null;for(let r=0;r<t.length;r++){const a=t[r];if(!a||e.test(a)){e.lastIndex=0;continue}const o=a.match(/^([a-gA-G])([#b]?)(-?\d+)?(@[\d.]+)?$/);if(!o){e.lastIndex=0;continue}const l=o[1].toUpperCase(),c=o[2]||"",u=o[3]?parseInt(o[3],10):null,h=o[4]||"",d=[];u!==null&&!Number.isNaN(u)&&d.push(u),s!==null&&(d.push(Math.round(s/12)-1),d.push(Math.round(s/12)),d.push(Math.round(s/12)+1)),d.push(3,4,5);let f=null;for(const y of d){const b=`${l}${c}${y}`,P=Vc.get(b);if(P&&Number.isFinite(P.midi)){f=P;break}}if(!f||!Number.isFinite(f.midi))return null;const m=Math.round(f.midi);s===null&&(s=m);const g=m-s;t[r]=String(g)+h,i=!0,e.lastIndex=0}return i?t.join(""):null}function zf(n){if(!n||typeof n!="string")return n;const e=/\bnote\s*\(\s*([a-gA-G][^'"()]*?)\s*\)/gi;let t=n.replace(e,(s,r)=>{const a=(r||"").trim();if(!a)return s;const o=Vf(a);return o===null?s:`n("${o}")`});const i=/\bnote\s*\(\s*(['"])([\s\S]*?)\1\s*\)/gi;return t=t.replace(i,(s,r,a)=>{const o=Vf(a);return o===null?s:`n(${r}${o}${r})`}),t}let jf=!1,xu=null,Eu=null;function Js(){if(jf)return;jf=!0,xu=xu||console.error,Eu=Eu||console.warn;const n=e=>{if(e&&e.length>0){let t="",i=null;if(typeof e[0]=="string"?t=e[0]:e[0]instanceof Error||typeof e[0]=="object"&&e[0]!==null?(t=e[0].message||String(e[0]),i=e[0]):t=String(e[0]),t.includes("AudioContext")&&(t.includes("not allowed")||t.includes("start")||t.includes("resume")||t.includes("user gesture"))||t.includes("@strudel/core was loaded more than once")||t.includes("undefined instead of pattern")||t.includes('got "undefined" instead of pattern')||t.includes("got undefined instead of pattern")||t.includes("Pattern evaluation failed: got undefined"))return!0;let s=t;for(let a=0;a<e.length;a++)(typeof e[a]=="string"||e[a]&&e[a].toString)&&(s+=" "+String(e[a]));const r=s.toLowerCase();if(s.includes("not found! Is it loaded?")||s.includes("not found")||r.includes("not found")||s.includes("sound ")&&s.includes("not found")||s.includes("[getTrigger] error")||s.includes("[getTrigger]")||t.includes("[getTrigger]")||s.includes("[eval] error")||s.includes("[eval]")||t.includes("[eval]")||s.includes("Unexpected token")||s.includes("createPeriodicWave")||s.includes("length of the real array provided (0)")||s.includes("minimum bound (2)")||s.includes('got "undefined" instead of pattern')||s.includes("got undefined instead of pattern")||s.includes("undefined instead of pattern")||r.includes("undefined instead of pattern")||t.includes("undefined instead of pattern")||s.includes("RolandTR909")||s.includes("RolandTR808")||s.includes("RolandTR")||r.includes("rolandtr")||t.includes("RolandTR")||s.includes("[superdough]")||s.includes("cannot schedule sounds in the past")||t.includes("[superdough]")||t.includes("cannot schedule sounds in the past")||(t.includes("SyntaxError")||s.includes("SyntaxError"))&&(t.includes("JSON")||s.includes("JSON"))||t.includes("<!DOCTYPE")||s.includes("<!DOCTYPE")||t.includes("Unexpected token")&&t.includes("<")||s.includes("Unexpected token")&&s.includes("<")||t.includes("is not valid JSON")||s.includes("is not valid JSON")||s.includes("Unexpected non-whitespace character after JSON")||s.includes("Unexpected token")&&s.includes("JSON")||s.includes("error loading")&&(s.includes("CycleTones")||s.includes("strudel.json"))||s.includes("Failed to load default sound banks")||t.includes("Failed to load default sound banks")||i&&i.isUndefinedPattern===!0)return!0}return!1};console.error=(...e)=>{const t=n(e);if(!t&&e.length>0){const i=e[0],s=typeof i=="string"?i:String(i);if(s.includes("[eval]")||s.includes("[getTrigger]")||s.includes("RolandTR")||s.includes("undefined instead of pattern")||s.includes("not found")||s.includes("createPeriodicWave")||s.includes("length of the real array provided (0)")||s.includes("minimum bound (2)")||s.includes("Unexpected token"))return}t||xu.apply(console,e)},console.warn=(...e)=>{const t=n(e);if(!t&&e.length>0){const i=e[0],s=typeof i=="string"?i:String(i);if(s.includes("[eval]")||s.includes("[getTrigger]")||s.includes("RolandTR")||s.includes("undefined instead of pattern")||s.includes("not found")||s.includes("[superdough]")||s.includes("cannot schedule sounds in the past")||s.includes("CycleTones not available")||s.includes("falling back to dirt-samples")||s.includes("createPeriodicWave")||s.includes("length of the real array provided (0)")||s.includes("minimum bound (2)")||s.includes("Unexpected token"))return}t||Eu.apply(console,e)}}Js();function Cn(n,...e){try{n&&typeof n._logRoute=="function"&&n._logRoute(...e)}catch{}}class NP{constructor(){this.audioContext=null,this.appInstance=null,this.volume=zt.defaults.volume,this.activeSounds=new Map,this.audioBuffers=new Map,this.oscillators=new Map,this.elementGainNodes=new Map,this.elementPanNodes=new Map,this.elementGainValues=new Map,this.elementPanValues=new Map,this.currentEvaluatingSlot=null,this.initialized=!1,this.strudelSoundBanksLoaded=!1,this.strudelSoundBankLoading=!1,this.soundsPreloaded=!1,this.onSoundsReadyCallback=null,this.onMasterPatternUpdateCallback=null,this.onMasterStateChangeCallback=null,this.strudelLoading=!1,this.strudelLoaded=!1,this.strudelPatternSlots=new Map,this.patternSlotToElementId=new Map,this.nextPatternSlot=1,this.previewSlotName="d16",this.reservedSlots=new Set([this.previewSlotName]),this.loadedBanks=new Set,this.currentTempo=120,this.currentKey="C",this.currentScale="chromatic",this.currentTimeSignature="",this.patternCache=new Map,this.masterGainNode=null,this._manualStrudelOutputNode=null,this._manualStrudelOutputDisabled=!1,this.masterPanNode=null,this.masterVolume=.7,this.masterPan=0,this.masterMuted=!1,this.masterVolumeBeforeMute=.7,this.visualizerAnalyser=null,this.visualizerAnalyserTapGain=null,this.visualizerAnalyserTapGainConnected=!1,this.debugAudioRouting=!1,this._logRoute=(...e)=>{this.debugAudioRouting&&console.log(...e)},this._routingBypass=!1,this.masterPattern="",this.masterSlot="d0",this.trackedPatterns=new Map,this.masterActive=!1,this.masterPlaybackStartTime=null,this.masterPlaybackSpeed=1,this.masterPlaybackTempo=this.currentTempo,this.masterOnlyPlayback=!0,this.previewElementIds=new Set,this.sampleNameToSpecialtyBank=new Map,this.specialtyManifests=new Map,this._pendingMasterPatternRefreshReason=null,this._masterPatternRefreshTimer=null,this._masterPatternEvalPromise=Promise.resolve(),this._cachedScaleContext=null,this._cachedScaleKey="",this.mediaRecorder=null,this.recordedChunks=[],this.isRecording=!1,this.midiEnabled=!1,this.midiOutputs=new Map,this.selectedMidiOutput=null,this.midiChannel=0}getPatternSlot(e){if(e==="modal-preview"){const i=this.previewSlotName,s=this.patternSlotToElementId.get(i);return s&&s!==e&&(console.log(`⚠️ Preview slot ${i} previously mapped to ${s}, reassigning...`),this.strudelPatternSlots.delete(s),this.patternSlotToElementId.delete(i),this.getPatternSlot(s)),this.strudelPatternSlots.set(e,i),this.patternSlotToElementId.set(i,e),i}if(!this.strudelPatternSlots.has(e)){let i=this.nextPatternSlot,s=`d${i}`;for(;this.reservedSlots.has(s);)i++,i>16&&(i=1),s=`d${i}`;this.strudelPatternSlots.set(e,s),this.patternSlotToElementId.set(s,e),console.log(`🎵 Assigned ${e} to pattern slot ${s}`),i++,i>16&&(i=1),this.nextPatternSlot=i}const t=this.strudelPatternSlots.get(e);return console.log(`🎵 ${e} using slot ${t}`),t}onSoundsReady(e){this.onSoundsReadyCallback=e}onMasterPatternUpdate(e){this.onMasterPatternUpdateCallback=e}onMasterStateChange(e){this.onMasterStateChangeCallback=e}async initializeStrudelAndSounds(){try{if(console.log("📦 Loading Strudel from CDN..."),!window.strudel||!window.strudel.evaluate||typeof globalThis.silence!="object"||typeof globalThis.sound!="function"?(console.log("Loading Strudel (window.strudel exists:",!!window.strudel,", functions exposed:",typeof globalThis.sound=="function",")"),await this.loadStrudelFromCDN()):console.log("Strudel already loaded and functions exposed"),!window.strudel||!window.strudel.evaluate)return console.error("Strudel failed to load properly"),!1;if(typeof globalThis.silence!="object"||typeof globalThis.sound!="function")return console.error("Strudel loaded but functions not exposed to globalThis!"),console.log("  typeof globalThis.silence:",typeof globalThis.silence,"(should be object)"),console.log("  typeof globalThis.sound:",typeof globalThis.sound,"(should be function)"),console.log("  typeof globalThis.note:",typeof globalThis.note,"(should be function)"),!1;if(console.log("✅ Strudel loaded successfully with functions exposed"),console.log("🔇 Ensuring all patterns are silent..."),globalThis.silence&&typeof globalThis.silence=="object")for(let i=1;i<=16;i++)try{window.strudel.evaluate(`d${i} = silence`).catch(()=>{})}catch{}else console.warn("⚠️ silence pattern not available yet - skipping pattern slot initialization");return console.log("📦 Loading sound banks..."),await this.ensureDefaultSoundBanks()?console.log("✅ Default sound banks loaded"):console.warn("⚠️ Default sound banks failed to load"),console.log("📦 Preloading all sounds..."),await this.preloadAllCommonDrumSounds(),console.log("📦 Pre-loading all configured patterns..."),this.preloadAllPatterns().catch(i=>{console.log("⚠️ Pattern pre-loading failed:",i)}),this.soundsPreloaded=!0,console.log("✅✅✅ All sounds ready and preloaded!"),!0}catch(e){return console.error("Error initializing Strudel/sounds:",e),!1}}async initialize(){var e;if(this.initialized&&this.audioContext&&this.audioContext.state==="running")return!0;try{if(this.audioContext&&this.audioContext.state==="closed"&&(this.audioContext=null),!this.audioContext){const t=window.AudioContext||window.webkitAudioContext;window.__OriginalAudioContext||(window.__OriginalAudioContext=t),this.audioContext=new t;const i=this.audioContext,s=function(){return Cn(this,"🎚️ AudioContext constructor hijacked - returning our shared context"),i};if(s.prototype=t.prototype,s.__proto__=t,window.AudioContext=s,window.webkitAudioContext&&(window.webkitAudioContext=s),window.__hijackedAudioContext=i,this.audioContext.__masterPanNode=!0,console.log("✅ AudioContext hijacked - all future AudioContext creations will use our shared context"),this.masterPanNode=this.audioContext.createStereoPanner(),this.masterGainNode=this.audioContext.createGain(),this._realDestination=this.audioContext.destination,this.masterPanNode.connect(this.masterGainNode),this.masterGainNode.connect(this._realDestination),Cn(this,`🎚️ ✅ INITIAL: Connected masterPan -> masterGain -> destination (gain=${this.masterGainNode.gain.value.toFixed(3)})`),this.masterGainNode.gain.value=this.masterVolume,this.masterPanNode.pan.value=this.masterPan,this.gainNode=this.masterGainNode,console.log("💡 Master channel ready - will route Strudel through it during init"),this.strudelLoaded||(Cn(this,"🎚️ Loading Strudel after hijacking AudioContext (master nodes ready for destination)..."),await this.loadStrudelFromCDN()),!AudioNode.prototype.__originalConnect){AudioNode.prototype.__originalConnect=AudioNode.prototype.connect;const r=this.masterPanNode,a=this.masterGainNode,o=this.audioContext,l=this,c=this._realDestination;AudioNode.prototype.connect=function(u,h,d){var Z,q,X,j,H,se,oe,Pe,Me,Be,Ke,Ct,yt,he;if(l&&l._routingBypass===!0)return this.__originalConnect.call(this,u,h,d);const f=this.context,m=u==null?void 0:u.context,g=f&&f===o,y=m&&m===o,b=u===c||u===o.destination;if(!g||!(y||u&&!m&&b))return this.__originalConnect.call(this,u,h,d);if(l&&l.masterActive){const et=this.constructor.name,pe=((Z=u==null?void 0:u.constructor)==null?void 0:Z.name)||"unknown",Et=u===c||u===o.destination||((q=u==null?void 0:u.constructor)==null?void 0:q.name)==="AudioDestinationNode";l._allConnectionsDebugLogged||(l._allConnectionsDebugLogged=new Set);const Ze=`${et}->${pe}`;l._allConnectionsDebugLogged.has(Ze)||(console.log(`🔊 CONNECTION DEBUG: ${et} -> ${pe}, isDestination=${Et}, context=${this.context===o?"OUR":"OTHER"}`),l._allConnectionsDebugLogged.add(Ze))}const M=this.constructor.name==="AnalyserNode",v=u===c||u===o.destination,C=u&&u.constructor&&u.constructor.name==="AudioDestinationNode";if((v||C)&&!M){l._allDestConnectionsLogged||(l._allDestConnectionsLogged=new Set);const et=`${this.constructor.name}->${(X=u==null?void 0:u.constructor)==null?void 0:X.name}`;l._allDestConnectionsLogged.has(et)||(l._logRoute(`🎚️ 🔴 DESTINATION CONNECTION: ${this.constructor.name} -> ${(j=u==null?void 0:u.constructor)==null?void 0:j.name}, masterActive=${l.masterActive}, trackedPatterns=${l.trackedPatterns.size}`),l._allDestConnectionsLogged.add(et))}if(l.masterActive&&!M){l._allConnectionsLogged||(l._allConnectionsLogged=new Set);const et=`${this.constructor.name}->${(H=u==null?void 0:u.constructor)==null?void 0:H.name}`;l._allConnectionsLogged.has(et)||(l._logRoute(`🎚️ Connection attempt: ${this.constructor.name} -> ${(se=u==null?void 0:u.constructor)==null?void 0:se.name}, isMasterDest=${v}, isAnyDest=${C}, masterActive=${l.masterActive}`),l._allConnectionsLogged.add(et))}const E=(v||C)&&!M,A=l.masterActive&&l.trackedPatterns.size>0,B=A;if(E){l._masterDestinationConnectLogged||(l._logRoute(`🎚️ ✅ INTERCEPTING connection to destination: ${this.constructor.name} -> ${(oe=u==null?void 0:u.constructor)==null?void 0:oe.name}, masterActive=${l.masterActive}, trackedPatterns=${l.trackedPatterns.size}`),l._masterDestinationConnectLogged=!0),l._nodeTypeConnectLogged||(l._nodeTypeConnectLogged=new Set);const et=this.constructor.name;if(l._nodeTypeConnectLogged.has(et)||(l._logRoute(`🎚️ Intercepting ${et} connecting to ${(Pe=u==null?void 0:u.constructor)==null?void 0:Pe.name}`),l._nodeTypeConnectLogged.add(et)),A){const ve=r||a;if(ve){if(r&&a)try{r.connect(a)}catch(Je){Je.message.includes("already")||console.warn(`⚠️ Master chain connect error: ${Je.message}`)}if(a&&l._realDestination)try{a.connect(l._realDestination)}catch(Je){Je.message.includes("already")||console.warn(`⚠️ Master destination connect error: ${Je.message}`)}return this.__punchcardMasterRouted=!0,this.__punchcardMasterConnectionNode=ve,this.__originalConnect.call(this,ve,h,d)}}let pe=null;if(!B&&l.masterActive&&l.trackedPatterns.size>0){const ve=Array.from(l.trackedPatterns.keys());if(ve.length===1)pe=ve[0],l._singleElementMasterRoutingLogged||(l._logRoute(`🎚️ Single element master detected, routing through ${pe} (trackedPatterns.size=${l.trackedPatterns.size})`),l._logRoute(`🎚️ currentEvaluatingSlot=${l.currentEvaluatingSlot}, patternSlotToElementId mapping:`,Array.from(l.patternSlotToElementId.entries())),l._singleElementMasterRoutingLogged=!0);else if(l.currentEvaluatingSlot){const Je=l.patternSlotToElementId.get(l.currentEvaluatingSlot);Je&&ve.includes(Je)&&(pe=Je,l._logRoute(`🎚️ Multi-element evaluate: routing via currentEvaluatingSlot ${l.currentEvaluatingSlot} -> ${pe}`))}}if(l.masterActive&&!pe&&l.currentEvaluatingSlot&&(pe=l.patternSlotToElementId.get(l.currentEvaluatingSlot),pe?l._logRoute(`🎚️ Found element from currentEvaluatingSlot: ${pe} (slot: ${l.currentEvaluatingSlot})`):l._logRoute(`🎚️ currentEvaluatingSlot=${l.currentEvaluatingSlot} but no mapping found. Available mappings:`,Array.from(l.patternSlotToElementId.entries()))),!pe)for(const[ve,Je]of l.patternSlotToElementId.entries())try{const Pt=globalThis[ve];if(Pt&&Pt!==globalThis.silence){pe=Je,l._logRoute(`🎚️ Found element from active slot: ${pe} (slot: ${ve})`);break}}catch{}if(pe){const ve=l.getElementAudioNodes(pe);if(ve&&ve.gainNode){const Je=ve.panNode;if(this.__punchcardMasterRouted&&this.__punchcardMasterConnectionNode&&typeof this.disconnect=="function"){try{this.disconnect(this.__punchcardMasterConnectionNode),l._logRoute(`🎚️ Disconnected ${this.constructor.name} from master fallback before routing through element chain`)}catch{}this.__punchcardMasterRouted=!1,this.__punchcardMasterConnectionNode=null}if(Je)if(l.masterPanNode||l.masterGainNode)try{l._panNodeConnectedToMaster||(l._panNodeConnectedToMaster=new Set);const Sn=`${pe}-${l.masterPanNode?"pan":"gain"}`;if(!l._panNodeConnectedToMaster.has(Sn)){let ot=!1;if(l.masterPanNode)try{Je.connect(l.masterPanNode),ot=!0,l._panNodeConnectedToMaster.add(Sn),l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.has(pe)||(l._logRoute(`🎚️ ✅ Connected ${pe} panNode -> masterPanNode`),l._panNodeConnectedLogged.add(pe))}catch(an){if(an.message.includes("already connected")||an.message.includes("already been connected"))l._panNodeConnectedToMaster.add(Sn),ot=!0;else throw an}else if(l.masterGainNode)try{Je.connect(l.masterGainNode),ot=!0,l._panNodeConnectedToMaster.add(Sn),l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.has(pe)||(l._logRoute(`🎚️ ✅ Connected ${pe} panNode -> masterGainNode (fallback)`),l._panNodeConnectedLogged.add(pe))}catch(an){if(an.message.includes("already connected")||an.message.includes("already been connected"))l._panNodeConnectedToMaster.add(Sn),ot=!0;else throw an}ot||console.error(`❌ ${pe} panNode: Master nodes exist but connection failed!`)}}catch(Sn){l._panNodeConnectionErrorLogged||(l._panNodeConnectionErrorLogged=new Set),l._panNodeConnectionErrorLogged.has(pe)||(console.error(`❌ Failed to connect ${pe} panNode to master chain:`,Sn.message),console.error("   panNode:",Je),console.error("   masterPanNode:",l.masterPanNode),console.error("   masterGainNode:",l.masterGainNode),l._panNodeConnectionErrorLogged.add(pe))}else l._panNodeNotConnectedLogged||(l._panNodeNotConnectedLogged=new Set),l._panNodeNotConnectedLogged.has(pe)||(console.warn(`⚠️ ${pe} panNode: Master nodes not available yet (will connect when available)`),l._panNodeNotConnectedLogged.add(pe));let Pt=[];Pt.push(`gainNode: gain=${ve.gainNode.gain.value.toFixed(3)}, inputs=${ve.gainNode.numberOfInputs}, outputs=${ve.gainNode.numberOfOutputs}`),Je?Pt.push(`panNode: pan=${Je.pan.value.toFixed(3)}, inputs=${Je.numberOfInputs}, outputs=${Je.numberOfOutputs}`):Pt.push("panNode: MISSING"),l.masterPanNode?Pt.push(`masterPanNode: inputs=${l.masterPanNode.numberOfInputs}, outputs=${l.masterPanNode.numberOfOutputs}`):Pt.push("masterPanNode: MISSING"),l.masterGainNode?Pt.push(`masterGainNode: gain=${l.masterGainNode.gain.value.toFixed(3)}, inputs=${l.masterGainNode.numberOfInputs}, outputs=${l.masterGainNode.numberOfOutputs}`):Pt.push("masterGainNode: MISSING"),l._chainVerificationLogged||(l._chainVerificationLogged=new Set),l._chainVerificationLogged.has(pe)||(l._logRoute(`🎚️ INTERCEPTED: Routing ${pe} audio through element gain node (${this.constructor.name} -> ${ve.gainNode.constructor.name})`),l._logRoute(`🎚️ Audio chain verification for ${pe}:`,Pt.join(", ")),l._chainVerificationLogged.add(pe));const li=ve.panNode;if(li&&!((Me=l._panNodeConnectedLogged)!=null&&Me.has(pe)))try{if(l.masterPanNode)try{li.connect(l.masterPanNode),l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.add(pe),l._logRoute(`🎚️ ✅ CRITICAL: Connected ${pe} panNode -> masterPanNode`)}catch{l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.add(pe)}else if(l.masterGainNode)try{li.connect(l.masterGainNode),l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.add(pe),l._logRoute(`🎚️ ✅ CRITICAL: Connected ${pe} panNode -> masterGainNode (fallback)`)}catch{l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.add(pe)}}catch(Lt){console.error(`❌ CRITICAL: Failed to connect ${pe} panNode: ${Lt.message}`)}const Bn=this.__originalConnect.call(this,ve.gainNode,h,d);if(l._masterGainDestVerifiedAfterRouting||(l._masterGainDestVerifiedAfterRouting=new Set),!l._masterGainDestVerifiedAfterRouting.has(pe))if(l._masterGainDestVerifiedAfterRouting.add(pe),l._logRoute(`🎚️ 🔍 VERIFYING: masterGainNode=${!!l.masterGainNode}, _realDestination=${!!l._realDestination}, gain=${((Ct=(Ke=(Be=l.masterGainNode)==null?void 0:Be.gain)==null?void 0:Ke.value)==null?void 0:Ct.toFixed(3))||"N/A"}, muted=${l.masterMuted}`),l.masterGainNode&&l._realDestination)try{l.masterGainNode.connect(l._realDestination),l._logRoute(`🎚️ ✅ CRITICAL: Connected masterGainNode -> destination after routing ${pe} (gain=${l.masterGainNode.gain.value.toFixed(3)}, muted=${l.masterMuted})`)}catch(Lt){l._logRoute(`🎚️ ✅ CRITICAL: masterGainNode -> destination already connected for ${pe} (${Lt.message})`)}else console.error(`❌ CRITICAL: Cannot verify masterGainNode -> destination: masterGainNode=${!!l.masterGainNode}, _realDestination=${!!l._realDestination}`);return l._connectionSuccessLogged||(l._connectionSuccessLogged=new Set),l._connectionSuccessLogged.has(pe)||(l._logRoute(`🎚️ Connection result for ${pe}: ${Bn?"SUCCESS":"FAILED"}, source inputs now: ${ve.gainNode.numberOfInputs}`),l._connectionSuccessLogged.add(pe)),this.__punchcardElementRouted!==!0&&(this.__punchcardElementRouted=!0),Bn}else console.error(`❌ CRITICAL: Element ${pe} found but no gain node available - elementNodes=${!!ve}, gainNode=${!!(ve!=null&&ve.gainNode)}`),console.error("❌ This means audio will bypass element controls!"),pe=null}else{if(A){l._stackMasterRoutingLogged||(console.log(`🎚️ Stack() pattern: Routing through master chain (${l.trackedPatterns.size} elements)`),l._stackMasterRoutingLogged=!0);const Je=r||a;if(Je)return this.__originalConnect.call(this,Je,h,d)}l._noElementRoutingLogged||(l._logRoute(`🎚️ No element found for routing - trackedPatterns.size=${l.trackedPatterns.size}, currentEvaluatingSlot=${l.currentEvaluatingSlot}`),l._logRoute("🎚️ Available pattern slot mappings:",Array.from(l.patternSlotToElementId.entries())),l._logRoute("🎚️ Tracked elements:",Array.from(l.trackedPatterns.keys())),l._noElementRoutingLogged=!0)}if(l.masterActive&&l.trackedPatterns.size===1&&!pe){const ve=Array.from(l.trackedPatterns.keys());l._logRoute(`🎚️ 🔍 FALLBACK CHECK: trackedPatterns.size=${l.trackedPatterns.size}, elementId=${pe}, trackedElementIds=${ve.join(", ")}`),ve.length===1?(pe=ve[0],l._logRoute(`🎚️ ⚠️ Fallback: Using tracked element ${pe} for routing (elementId was null)`)):console.warn(`🎚️ ⚠️ Fallback: trackedElementIds.length=${ve.length}, expected 1`)}else l.trackedPatterns.size!==1?console.log(`🎚️ 🔍 FALLBACK SKIP: trackedPatterns.size=${l.trackedPatterns.size}, elementId=${pe} (not single element, skipping fallback)`):pe&&console.log(`🎚️ 🔍 FALLBACK SKIP: trackedPatterns.size=${l.trackedPatterns.size}, elementId=${pe} (elementId already set, skipping fallback)`);if(pe){console.log(`🎚️ 🔍 FALLBACK ROUTING ATTEMPT: elementId=${pe}, attempting to get elementNodes...`);const ve=l.getElementAudioNodes(pe);if(console.log(`🎚️ 🔍 FALLBACK ROUTING: elementNodes=${!!ve}, gainNode=${!!(ve!=null&&ve.gainNode)}, panNode=${!!(ve!=null&&ve.panNode)}`),ve&&ve.gainNode){const Je=ve.panNode;if(Je&&r)try{try{Je.disconnect(r)}catch{}Je.connect(r)}catch{}return console.log(`🎚️ ✅ FALLBACK ROUTING: Routing ${this.constructor.name} through ${pe} element chain (gain=${ve.gainNode.gain.value.toFixed(3)})`),this.__originalConnect.call(this,ve.gainNode,h,d)}else console.error(`❌ CRITICAL FALLBACK: Element ${pe} found but elementNodes or gainNode is missing - elementNodes=${!!ve}, gainNode=${!!(ve!=null&&ve.gainNode)}`),console.error("❌ Audio will route through master chain, bypassing element controls!")}else console.log("🎚️ 🔍 FALLBACK ROUTING SKIP: elementId is null, will route through master chain");const Ze=A||l.trackedPatterns.size===0||!l.masterActive?r||a:null;if(Ze){if(this.__punchcardElementRouted)return console.log(`🎚️ Skipping master fallback for ${this.constructor.name} (already routed through element chain)`),this.__originalConnect.call(this,u,h,d);l._masterRoutingLogged||(l._masterRoutingLogged=new Set);const ve=`master-${Ze.constructor.name}`;if(!l._masterRoutingLogged.has(ve)){if(l._masterRoutingLogged.add(ve),console.log(`🎚️ ⚠️ FALLBACK: Routing ${this.constructor.name} through master chain (${Ze.constructor.name}) - element routing not available`),console.log(`🎚️ ⚠️ FALLBACK: masterGainNode.gain=${((he=(yt=a==null?void 0:a.gain)==null?void 0:yt.value)==null?void 0:he.toFixed(3))||"N/A"}, muted=${l.masterMuted}, connected to destination=${!!l._realDestination}`),r&&a)try{r.connect(a),console.log("🎚️ ✅ FALLBACK: Verified masterPanNode -> masterGainNode connection")}catch(Pt){Pt.message.includes("already connected")||Pt.message.includes("already been connected")?console.log("🎚️ ✅ FALLBACK: masterPanNode -> masterGainNode already connected"):console.warn(`⚠️ FALLBACK: Could not connect masterPanNode -> masterGainNode: ${Pt.message}`)}if(a&&l._realDestination)try{a.connect(l._realDestination),console.log(`🎚️ ✅ FALLBACK: Ensured masterGainNode -> destination connection (gain=${a.gain.value.toFixed(3)})`)}catch(Pt){console.log(`🎚️ ✅ FALLBACK: masterGainNode -> destination already connected (${Pt.message})`)}}const Je=this.__originalConnect.call(this,Ze,h,d);return this.__punchcardMasterRouted=!0,this.__punchcardMasterConnectionNode=Ze,Je}if(!r&&!a&&console.warn("⚠️ No master nodes available, allowing direct connection to destination"),a&&c)try{a.connect(c),l._masterGainDestVerified||(console.log("🎚️ ✅ Ensured masterGainNode -> destination connection (critical for audio output)"),l._masterGainDestVerified=!0)}catch(ve){!l._masterGainDestVerified&&ve.message&&!ve.message.includes("already connected")&&(console.log(`🎚️ masterGainNode -> destination: ${ve.message.includes("already")?"already connected":"connection verified"}`),l._masterGainDestVerified=!0)}}return this.__originalConnect.call(this,u,h,d)},console.log("🎚️ Patched AudioNode.prototype.connect to route through element gain nodes or master channel"),console.log("🎚️ Hijacking verification: AudioNode.prototype.__originalConnect exists:",!!AudioNode.prototype.__originalConnect),console.log("🎚️ Hijacking verification: AudioNode.prototype.connect is patched:",AudioNode.prototype.connect!==AudioNode.prototype.__originalConnect)}this.audioContext.__masterPanNode=this.masterPanNode,console.log("Audio context created with master channel, state:",this.audioContext.state),Cn(this,`🎚️ Master initialized: volume=${(this.masterVolume*100).toFixed(0)}%, pan=${this.masterPan.toFixed(2)}`)}if(this.audioContext.state==="suspended")try{Js(),await this.audioContext.resume(),this.audioContext.state==="running"?console.log("Audio context resumed successfully"):console.log("Audio context state:",this.audioContext.state)}catch(t){return t.message&&t.message.includes("user gesture")||console.error("Cannot resume audio context:",t),!1}return this.audioContext&&this.audioContext.state==="running"?(this.initialized=!0,console.log("Sound Manager initialized successfully"),this.masterGainNode&&(this.masterGainNode.gain.value=this.masterVolume),this.masterPanNode&&(this.masterPanNode.pan.value=this.masterPan),Cn(this,`🎚️ Master values set: volume=${(this.masterVolume*100).toFixed(0)}%, pan=${this.masterPan.toFixed(2)}`),console.log("🎵 Starting Strudel initialization and sound bank loading..."),this.initializeStrudelAndSounds().catch(t=>{console.error("Failed to initialize Strudel/sounds:",t)}),this.preloadAudioFiles().catch(t=>{console.log("Background audio preload failed:",t)}),!0):(console.warn("Audio context not in running state:",(e=this.audioContext)==null?void 0:e.state),!1)}catch(t){return console.error("Failed to initialize audio context:",t),this.initialized=!1,!1}}async preloadAudioFiles(){const e=zt.getAudioElements();for(const t of e)if(t.audioFile)try{(await fetch(t.audioFile,{method:"HEAD"})).ok?await this.loadAudioFile(t.id,t.audioFile):console.log(`Skipping preload for ${t.id} (file not found): ${t.audioFile}`)}catch{}}async loadAudioFile(e,t){try{const i=await fetch(t);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const s=await i.arrayBuffer(),r=await this.audioContext.decodeAudioData(s);return this.audioBuffers.set(e,r),r}catch(i){throw console.error(`Error loading audio file ${t}:`,i),i}}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.gainNode&&(this.gainNode.gain.value=this.volume)}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e)),this.masterGainNode?(this.masterGainNode.gain.value=this.masterVolume,Cn(this,`🎚️ Master volume set to ${(this.masterVolume*100).toFixed(0)}% (gainNode instant via Web Audio API)`)):Cn(this,`🎚️ Master volume stored as ${(this.masterVolume*100).toFixed(0)}% (gainNode not ready yet)`)}setMasterPan(e){this.masterPan=Math.max(-1,Math.min(1,e)),this.masterPanNode?(this.masterPanNode.pan.value=this.masterPan,Cn(this,`🎚️ Master pan set to ${this.masterPan.toFixed(2)} (panNode instant via Web Audio API)`)):Cn(this,`🎚️ Master pan stored as ${this.masterPan.toFixed(2)} (panNode not ready yet)`)}toggleMasterMute(){return this.masterMuted=!this.masterMuted,this.masterMuted?(this.masterVolumeBeforeMute=this.masterVolume,this.masterGainNode&&(this.masterGainNode.gain.value=0),console.log("🔇 Master muted (instant via Web Audio API)")):(this.masterGainNode&&(this.masterGainNode.gain.value=this.masterVolumeBeforeMute),this.masterVolume=this.masterVolumeBeforeMute,console.log(`🔊 Master unmuted (volume: ${(this.masterVolume*100).toFixed(0)}%) (instant via Web Audio API)`)),this.masterMuted}getElementAudioNodes(e){if(!this.audioContext)return null;if(!this.elementGainNodes.has(e)){const t=this.audioContext.createGain(),i=this.audioContext.createStereoPanner(),s=this.elementGainValues.get(e)||.8,r=this.elementPanValues.get(e)||0;this.elementGainNodes.set(e,t),this.elementPanNodes.set(e,i),this.elementGainValues.set(e,s),this.elementPanValues.set(e,r),t.gain.value=s*this.volume,i.pan.value=r,t.connect(i);let a=!1;if(this.masterPanNode)try{i.connect(this.masterPanNode),a=!0,Cn(this,`🎚️ ${e}: Connected panNode to masterPanNode during node creation`)}catch(o){console.warn(`⚠️ ${e}: Failed to connect panNode to masterPanNode:`,o.message)}else if(this.masterGainNode)try{i.connect(this.masterGainNode),a=!0,Cn(this,`🎚️ ${e}: Connected panNode to masterGainNode during node creation`)}catch(o){console.warn(`⚠️ ${e}: Failed to connect panNode to masterGainNode:`,o.message)}else if(this.gainNode)try{i.connect(this.gainNode),a=!0,Cn(this,`🎚️ ${e}: Connected panNode to gainNode during node creation`)}catch(o){console.warn(`⚠️ ${e}: Failed to connect panNode to gainNode:`,o.message)}a||console.warn(`⚠️ ${e}: panNode not connected to master chain (master nodes may not exist yet - will connect on first audio connection)`),Cn(this,`🎚️ Element audio chain for ${e}:`),console.log(`   gainNode (${t.numberOfInputs} inputs, ${t.numberOfOutputs} outputs)`),console.log(`   panNode (${i.numberOfInputs} inputs, ${i.numberOfOutputs} outputs)`),console.log(`   masterPanNode (${this.masterPanNode?this.masterPanNode.numberOfInputs:"N/A"} inputs)`),Cn(this,`🎚️ Created element audio chain for ${e}: gain -> pan -> master`)}return{gainNode:this.elementGainNodes.get(e),panNode:this.elementPanNodes.get(e)}}disposeElementAudioNodes(e){if(!e)return;const t=this.elementGainNodes.get(e),i=this.elementPanNodes.get(e);if(t){try{t.disconnect()}catch{}this.elementGainNodes.delete(e)}if(i){try{i.disconnect()}catch{}this.elementPanNodes.delete(e)}this.elementGainValues.delete(e),this.elementPanValues.delete(e),this._panNodeConnectedToMaster&&(this._panNodeConnectedToMaster.delete(`${e}-pan`),this._panNodeConnectedToMaster.delete(`${e}-gain`))}isNotePattern(e){return!e||typeof e!="string"?!1:/\b(note|n)\s*\(/.test(e)}applyElementGainPanToPattern(e,t,i={}){const{applyGainInPattern:s=!0,applyPanInPattern:r=!0,applyTempoInPattern:a=!0}=i,o=this.elementGainValues.get(t)||.8,l=this.elementPanValues.get(t)||0,c=this.currentTempo||120;let u=e;u=u.replace(/\.postgain\s*\([^)]*\)/g,""),u=u.replace(/\.pan\s*\([^)]*\)/g,""),u=u.replace(/\.\.+/g,".").trim(),u=u.replace(/\.+$/,"").trim(),s&&(/\.postgain\s*\([^)]*\)\s*$/i.test(u)?u=u.replace(/\.postgain\s*\([^)]*\)\s*$/i,`.postgain(${o})`):u=`${u}.postgain(${o})`),r&&l!==0&&(u+=`.pan(${l})`);const h=c/120;return a&&(h>1?u+=`.fast(${h})`:h<1&&(u+=`.slow(${1/h})`)),console.log(`Applied gain=${o.toFixed(2)}, pan=${l.toFixed(2)}, tempo=${c} BPM (speed=${h.toFixed(2)}x) to ${t}`),u}async processPattern(e,t,i={}){const{preserveBanks:s=!1,attemptBankLoad:r=!1}=i||{};if(!e||typeof e!="string"||e.trim()==="")return null;let a=e.replace(/\s+/g," ").trim();if(a=a.replace(/\s+\./g,".").trim(),a=a.replace(/\.\.+/g,".").trim(),a=a.replace(/\.(cpm|fast|slow)\([^)]*\)/g,"").trim(),a=a.replace(/\.\.+/g,".").trim(),a=Pu(a),!a||a==="")return console.warn(`[${t}] Pattern became empty after processing - cannot process`),null;const o=a.match(/\.bank\(["']([^"']+)["']\)/g);if(o){const c=o.map(h=>h.match(/\.bank\(["']([^"']+)["']\)/)[1]);console.log(`[${t}] Pattern uses bank(s):`,c);let u=!1;for(const h of c){const d=h,m=["RolandTR808","RolandTR909","RolandTR707","RhythmAce","AkaiLinn","ViscoSpaceDrum","CasioRZ1"].includes(d);let g=this.loadedBanks.has(d)||m;if(!g&&r&&typeof this.loadBank=="function")try{console.log(`[${t}] Attempting to load bank "${d}" for pattern processing`),await this.loadBank(d)?(this.loadedBanks.add(d),g=!0,console.log(`[${t}] Bank "${d}" loaded successfully for pattern processing`)):console.warn(`[${t}] Bank "${d}" could not be loaded on demand`)}catch(y){console.warn(`[${t}] Error loading bank "${d}":`,y)}!g&&!s?(console.warn(`⚠️ Bank "${d}" not loaded - removing .bank() modifier from pattern`),a=a.replace(new RegExp(`\\.bank(["']${d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}["'])`,"g"),""),u=!0):!g&&s?console.warn(`⚠️ Bank "${d}" is not loaded but preserving .bank() for preview`):m&&(console.log(`[${t}] Bank "${d}" is built-in - keeping .bank() modifier`),this.loadedBanks.add(d))}if(a=a.replace(/\.+$/,"").trim(),u&&!s&&(!a||a.trim()===""))return console.warn("⚠️ Pattern became empty after removing unloaded banks"),null;console.log(`[${t}] Pattern after bank cleanup:`,a.substring(0,100))}const l=i.applyGainInPattern!==void 0?i.applyGainInPattern:this.masterActive;return a=this.applyElementGainPanToPattern(a,t,{applyGainInPattern:l}),!a||a.trim()===""?(console.warn(`[${t}] Pattern became empty after applying gain/pan - cannot process`),null):a}async preEvaluatePattern(e,t){if(!window.strudel||!window.strudel.evaluate)return console.log(`[${e}] Cannot pre-evaluate: Strudel not ready`),!1;if(!t||typeof t!="string"||t.trim()==="")return console.log(`[${e}] No pattern to pre-evaluate`),this.patternCache.set(e,{processedPattern:null,patternSlot:this.getPatternSlot(e),isPreEvaluated:!1,originalPattern:t||""}),!1;const i=await this.processPattern(t,e);if(!i)return console.warn(`[${e}] Pattern processing failed - cannot cache`),this.patternCache.set(e,{processedPattern:null,patternSlot:this.getPatternSlot(e),isPreEvaluated:!1,originalPattern:t}),!1;const s=this.getPatternSlot(e);try{const r=`${s} = silence`;return await window.strudel.evaluate(r),this.patternCache.set(e,{processedPattern:i,patternSlot:s,isPreEvaluated:!0,originalPattern:t}),console.log(`✅ Pre-evaluated and cached pattern for ${e} in ${s} (silent, ready for manual trigger)`),!0}catch(r){return console.warn(`[${e}] Failed to pre-evaluate pattern:`,r),this.patternCache.set(e,{processedPattern:i,patternSlot:s,isPreEvaluated:!1,originalPattern:t}),!1}}invalidatePatternCache(e){this.patternCache.delete(e),console.log(`🗑️ Invalidated pattern cache for ${e}`)}async preloadAllPatterns(){if(!window.strudel||!window.strudel.evaluate){console.log("Cannot preload patterns: Strudel not ready");return}console.log("📦 Pre-loading all configured patterns...");const e=zt.elements||[];let t=0,i=0;for(const s of e){const r=s.id;let a=null;try{const l=localStorage.getItem(`element-config-${r}`);l&&(a=JSON.parse(l))}catch{}const o=(a==null?void 0:a.pattern)||(s==null?void 0:s.pattern)||"";o&&o.trim()!==""&&(await this.preEvaluatePattern(r,o)?t++:i++)}console.log(`✅ Pre-loaded ${t} patterns${i>0?`, ${i} failed`:""}`)}setElementGain(e,t){const i=Math.max(0,Math.min(1,t)),s=this.elementGainValues.get(e);this.elementGainValues.set(e,i),console.log(`[${e}] Gain set to ${i.toFixed(2)}`);const r=this.elementGainNodes.get(e);r&&(r.gain.value=i*this.volume,Cn(this,`🎚️ Updated ${e} gain node to ${(i*this.volume).toFixed(2)}`)),s!==i&&(this.patternCache.get(e)&&(this.patternCache.delete(e),console.log(`🗑️ Invalidated pattern cache for ${e} (gain changed)`)),this.trackedPatterns.has(e)&&this.updateTrackedElementGain(e,i)),this.isPlaying(e)&&!this.masterActive&&s!==i&&this.updatePlayingPattern(e)}setElementPan(e,t){const i=Math.max(-1,Math.min(1,t)),s=this.elementPanValues.get(e);this.elementPanValues.set(e,i),console.log(`[${e}] Pan set to ${i.toFixed(2)}`);const r=this.elementPanNodes.get(e);r&&(r.pan.value=i,Cn(this,`🎚️ Updated ${e} pan node to ${i.toFixed(2)}`)),s!==i&&(this.patternCache.get(e)&&(this.patternCache.delete(e),console.log(`🗑️ Invalidated pattern cache for ${e} (pan changed)`)),this.trackedPatterns.has(e)&&this.updateTrackedElementPan(e,i)),this.isPlaying(e)&&!this.masterActive&&s!==i&&this.updatePlayingPattern(e)}async updatePlayingPattern(e){const t=this.activeSounds.get(e);if(!t||t.type!=="strudel")return;const i=this.elementGainValues.get(e)||.8;if(i<=.001){console.log(`[${e}] Gain is ${i} (effectively muted) - stopping playback`),this.stopSound(e);return}const s=this.strudelPatternSlots.get(e);if(!(!s||!window.strudel||!window.strudel.evaluate))try{const r=zt.getElementConfig(e);if(!r||!r.pattern)return;let a=r.pattern.replace(/\._scope\(\)/g,"");a=this.applyElementGainPanToPattern(a,e,{applyGainInPattern:!1}),await window.strudel.evaluate(`${s} = ${a}`),console.log(`✅ Updated ${s} with new gain/pan`)}catch(r){console.warn(`Could not update pattern for ${e}:`,r)}}async updatePatternInPlace(e,t){if(this.trackedPatterns.has(e)){const r=this.trackedPatterns.get(e),a=t.replace(/[""]/g,'"').replace(/['']/g,"'");r.rawPattern=a,r.pattern=this.convertPatternForScale(a)||a,Cn(this,`🎚️ Updated tracked pattern for ${e} in master: ${t.substring(0,60)}...`),this.updateMasterPattern(this.soloedElements,this.mutedElements)}const i=this.activeSounds.get(e);if(!i||i.type!=="strudel")return;const s=this.strudelPatternSlots.get(e);if(!(!s||!window.strudel||!window.strudel.evaluate))try{let r=t.replace(/\s+/g," ").trim();r=r.replace(/\s+\./g,".").trim(),r=r.replace(/\.\.+/g,".").trim(),r=r.replace(/\.(cpm|fast|slow)\([^)]*\)/g,"").trim(),r=r.replace(/\.\.+/g,".").trim();const a=r.match(/\.bank\(["']([^"']+)["']\)/g);if(a){const o=a.map(l=>l.match(/\.bank\(["']([^"']+)["']\)/)[1]);for(const l of o)this.loadedBanks.has(l)||(r=r.replace(new RegExp(`\\.bank(["']${l}["'])`,"g"),""));r=r.replace(/\.+$/,"").trim()}r=this.applyElementGainPanToPattern(r,e,{applyGainInPattern:this.masterActive}),await window.strudel.evaluate(`${s} = ${r}`),console.log(`✅ Updated ${s} pattern in place: ${r.substring(0,60)}...`)}catch(r){console.warn(`Could not update pattern in place for ${e}:`,r)}}getElementGain(e){return this.elementGainValues.get(e)||.8}getElementPan(e){return this.elementPanValues.get(e)||0}async playSynthesizedSound(e,t){if(!this.initialized||!this.audioContext){console.log("Audio not initialized - waiting for user interaction");return}if(this.audioContext.state==="suspended")try{if(Js(),await this.audioContext.resume(),this.audioContext.state!=="running"){console.log("Audio context not running - user interaction required");return}}catch{console.log("Audio context needs user interaction");return}this.stopSound(e);const i=this.parsePattern(t);if(i.sounds.length===0){console.warn(`No sounds parsed from pattern: ${t}`);return}console.log(`Playing pattern for ${e}:`,t,i);try{const s=this.createOscillatorForPattern(i,e);s&&s.gain?(this.activeSounds.set(e,{type:"synthesized",oscillator:s,gain:s.gain}),console.log(`Sound started for ${e}`)):console.error(`Failed to create oscillator for ${e}`)}catch(s){console.error(`Error playing sound for ${e}:`,s)}}parsePattern(e){let t=e;const i=e.match(/(?:sound|s)\(["']([^"']+)["']\)/);i&&(t=i[1]);const s={bd:{freq:60,duration:.1,type:"sine"},sd:{freq:200,duration:.05,type:"noise"},hh:{freq:800,duration:.02,type:"square"},cp:{freq:400,duration:.08,type:"triangle"},misc:{freq:300,duration:.06,type:"triangle"}},r=[];if(t.split(",").forEach((l,c)=>{let u=l.trim();u=u.replace(/(\w+)\*(\d+)/g,(f,m,g)=>Array(parseInt(g)).fill(m).join(" ")),u=u.replace(/\[([^\]]+)\]/g,(f,m)=>m.trim());const h=u.trim().split(/\s+/);let d=0;for(const f of h){if(f==="~"||f===""){d++;continue}s[f]&&r.push({...s[f],time:d*.25}),d++}}),r.length===0)return console.warn(`No sounds found in pattern: ${e}`),{sounds:[],duration:0};r.sort((l,c)=>l.time-c.time);const o=Math.max(...r.map(l=>l.time+l.duration));return{sounds:r,duration:Math.max(o,.5)}}parseIndexPattern(e){const t=[];let i=e.replace(/<([^>]+)>/g,(r,a)=>a.trim().split(/\s+/)[0]);i=i.replace(/\[([^\]]+)\]/g,(r,a)=>a.trim()),i=i.replace(/(\d+)\*(\d+)/g,(r,a,o)=>Array(parseInt(o)).fill(a).join(" "));const s=i.trim().split(/\s+/);for(const r of s){const a=parseInt(r);isNaN(a)||t.push(a)}return t}createPatternFromIndices(e){const t=["bd","sd","hh","cp","bd","sd","hh","cp"];return`sound("${e.map(s=>t[s%t.length]||"~").join(" ")}")`}createPatternFromSampleName(e){return e.includes("break")||e.includes("165")?'sound("bd ~ sd ~ bd ~ sd hh")':'sound("bd sd hh ~ cp ~ hh ~")'}createOscillatorForPattern(e,t){if(!this.audioContext)return console.error("Audio context not initialized"),{gain:null,stop:()=>{}};const i=this.audioContext.createGain(),s=t?this.getElementAudioNodes(t):null;s?(i.connect(s.gainNode),i.gain.value=1):(i.connect(this.gainNode),i.gain.value=this.volume);const r=this.audioContext.currentTime;e.sounds.forEach((o,l)=>{const c=r+o.time;if(o.type==="noise"){const u=Math.floor(this.audioContext.sampleRate*o.duration),h=this.audioContext.createBuffer(1,u,this.audioContext.sampleRate),d=h.getChannelData(0);for(let g=0;g<u;g++)d[g]=Math.random()*2-1;const f=this.audioContext.createBufferSource();f.buffer=h;const m=this.audioContext.createGain();f.connect(m),m.connect(i),m.gain.setValueAtTime(0,c),m.gain.linearRampToValueAtTime(.3,c+.01),m.gain.exponentialRampToValueAtTime(.01,c+o.duration),f.start(c),f.stop(c+o.duration)}else{const u=this.audioContext.createOscillator();u.type=o.type,u.frequency.value=o.freq;const h=this.audioContext.createGain();u.connect(h),h.connect(i),h.gain.setValueAtTime(0,c),h.gain.linearRampToValueAtTime(.5,c+.01),h.gain.exponentialRampToValueAtTime(.01,c+o.duration),u.start(c),u.stop(c+o.duration)}});const a=r+e.duration;return i.gain.setValueAtTime(this.volume,a),i.gain.exponentialRampToValueAtTime(.01,a+.1),{gain:i,stop:()=>{try{i.gain.cancelScheduledValues(this.audioContext.currentTime),i.gain.setValueAtTime(i.gain.value,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),setTimeout(()=>i.disconnect(),150)}catch(o){console.error("Error stopping sound:",o)}}}}playAudioFile(e,t){if(!this.initialized||!this.audioContext){console.warn("Audio not initialized yet. Please click anywhere first to enable audio.");return}this.audioContext.state==="suspended"&&(Js(),this.audioContext.resume().catch(s=>{console.error("Failed to resume audio context:",s)})),this.stopSound(e);const i=this.audioBuffers.get(e);i?this.playAudioBuffer(e,i):this.loadAudioFile(e,t).then(s=>{this.playAudioBuffer(e,s)}).catch(s=>{console.error(`Failed to play audio for ${e}:`,s)})}playAudioBuffer(e,t){const i=this.audioContext.createBufferSource();i.buffer=t;const s=this.audioContext.createGain();i.connect(s);const r=this.getElementAudioNodes(e);r?(s.connect(r.gainNode),s.gain.value=1):(s.connect(this.gainNode),s.gain.value=this.volume);const a=r?1:this.volume;s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(a,this.audioContext.currentTime+zt.defaults.fadeInTime),i.onended=()=>{this.activeSounds.delete(e)},i.start(0),this.activeSounds.set(e,{type:"audio",source:i,gain:s})}async playStrudelPattern(e,t,i,s=!1){var o;if(!t||typeof t!="string"||t.trim()===""){console.log(`[${e}] No pattern assigned - skipping playback`);return}const r=this.elementGainValues.get(e)||.8;if(r<=.001){console.log(`[${e}] Gain is ${r} (effectively muted) - stopping playback`),this.stopSound(e);return}if(this.masterOnlyPlayback){const l=typeof e=="string"&&e.toLowerCase().includes("preview"),c=l,u=await this.routePatternThroughMaster(e,t,{isPreview:l,autoStart:c});return console.log(`🎚️ Routed ${e} through master-only playback`,u),u}if(!s){const l=document.querySelector(`[data-sound-id="${e}"]`);if(l){const c=l.querySelector(".loop-button");if((c==null?void 0:c.classList.contains("active"))&&this.isPlaying(e)){console.log(`🔄 ${e} has loop active and is playing - skipping sound trigger to prevent layering`);return}}}if(!this.initialized||!this.audioContext){console.log("Audio not initialized - attempting to initialize now...");try{await this.initialize()||console.warn("⚠️ Audio initialization failed - sounds may not play until user clicks")}catch(l){console.warn("⚠️ Error initializing audio:",l)}}if(this.strudelSoundBanksLoaded||console.log(`⏳ Sound banks not fully loaded yet for ${e}, but attempting to play anyway...`),this.audioContext.state==="suspended"){console.log(`🔄 Audio context is suspended for ${e}, attempting to resume...`);try{Js(),await this.audioContext.resume(),await new Promise(l=>setTimeout(l,50)),this.audioContext.state!=="running"?(console.warn(`⚠️ Audio context not running after resume attempt - state: ${this.audioContext.state}`),console.warn("   User interaction (click) may be required to resume audio")):console.log(`✅ Audio context resumed successfully for ${e}`)}catch(l){console.warn("⚠️ Failed to resume audio context:",l),console.warn("   User interaction (click) may be required to resume audio")}}this.stopSound(e),window.strudel&&window.strudel.scheduler&&!window.strudel.scheduler.started&&(console.log(`▶️ Starting scheduler for ${e} playback...`),await window.strudel.scheduler.start()),console.log(`Playing Strudel pattern for ${e}:`,t);try{if(window.strudel||await this.loadStrudelFromCDN(),!window.strudel||!window.strudel.evaluate||typeof window.strudel.evaluate!="function")throw console.error("❌ window.strudel.evaluate is not available"),console.error("window.strudel:",window.strudel),new Error("Strudel REPL evaluate function is not available. Strudel may not have initialized correctly.");if(console.log("Strudel evaluate is available..."),typeof globalThis.note=="function"&&typeof globalThis.sound=="function")console.log("✅ Core functions verified and available");else{const h=new Error("Core functions not available");console.warn("Core functions not available, attempting to load...");try{const{coreModule:d}=await aa();window.__coreModule=d,await window.strudel.evaluate(`
            (function() {
              const core = window.__coreModule || {};
              if (core && typeof core === 'object') {
                Object.assign(globalThis, core);
              }
              globalThis.__core_loaded = true;
            })();
          `);for(let f=0;f<20;f++){try{if(await window.strudel.evaluate("globalThis.__core_loaded === true")&&typeof globalThis.note=="function"){console.log("✅ Core functions loaded into REPL");break}}catch{}await new Promise(m=>setTimeout(m,100))}}catch(d){console.warn("Could not load core functions:",d)}}await this.ensureDefaultSoundBanks()||console.warn("⚠️ Continuing without default sound banks - patterns may fail");try{console.log("Registering sawtooth sound...");try{const{webaudioModule:h}=await aa(),d=`
                (function() {
                  const webaudio = window.__webaudioModule || {};
                  const { registerSound, getAudioContext } = webaudio;
                  
                  registerSound('sawtooth', (time, value, onended) => {
                    let { freq } = value;
                    const ctx = getAudioContext();
                    const o = new OscillatorNode(ctx, { type: 'sawtooth', frequency: Number(freq) || 440 });
                    o.start(time);
                    const g = new GainNode(ctx, { gain: 0.3 });
                    o.connect(g);
                    const stop = (time) => {
                      o.stop(time);
                      o.disconnect();
                      g.disconnect();
                      onended();
                    };
                    o.addEventListener('ended', () => {
                      o.disconnect();
                      g.disconnect();
                      onended();
                    });
                    return { node: g, stop };
                  }, { type: 'synth' });
                  
                  // Make registerSound and getAudioContext available globally for future use
                  globalThis.registerSound = registerSound;
                  globalThis.getAudioContext = getAudioContext;
                })();
              `;window.__webaudioModule=h,await window.strudel.evaluate(d),await new Promise(f=>setTimeout(f,200)),console.log("✅ Sawtooth sound registered (will be verified on first use)")}catch(h){console.warn("Could not use webaudio module:",h);try{const{webaudioModule:d}=await aa();window.__webaudioModule=d,await window.strudel.evaluate(`
                  (function() {
                    const webaudio = window.__webaudioModule || {};
                    const { registerSound, getAudioContext } = webaudio;
                  
                  if (registerSound && getAudioContext) {
                    registerSound('sawtooth', (time, value, onended) => {
                      let { freq } = value;
                      const ctx = getAudioContext();
                      const o = new OscillatorNode(ctx, { type: 'sawtooth', frequency: Number(freq) || 440 });
                      o.start(time);
                      const g = new GainNode(ctx, { gain: 0.3 });
                      o.connect(g);
                      const stop = (time) => {
                        o.stop(time);
                      };
                      o.addEventListener('ended', () => {
                        o.disconnect();
                        g.disconnect();
                        onended();
                      });
                      return { node: g, stop };
                    }, { type: 'synth' });
                  }
                })();
              `),await new Promise(m=>setTimeout(m,200)),console.log("✅ Sawtooth sound registered via REPL")}catch(d){console.warn("Could not register sawtooth via fallback:",d)}}}catch(h){console.warn("Could not register sawtooth sound:",h),console.warn("Pattern may still work if sawtooth is a default sound")}if(i){const h=window.strudel.samples||globalThis.samples;if(h&&typeof h=="function")try{if(typeof i=="string")console.log("Loading custom samples with string:",i),await h(i),console.log("Custom samples loaded successfully");else if(typeof i=="object"&&i!==null){const d=zt.getElementConfig(e),f=(d==null?void 0:d.samplesBaseUrl)||"";console.log("Loading custom samples:",i),console.log("Base URL:",f),await h(i,{baseUrl:f}),console.log("Custom samples loaded successfully")}}catch(d){console.error("Error loading custom samples:",d)}}try{if(typeof globalThis.note=="function"&&typeof globalThis.sound=="function")console.log("✅ Verified core functions are available");else{const y=new Error("Core functions not available");console.warn("Core functions check failed, attempting to load..."),console.warn("⚠️ Core functions not available, attempting to load now...");try{const{coreModule:b}=await aa();window.__coreModule=b,await window.strudel.evaluate(`
              (function() {
                const core = window.__coreModule || {};
                if (core && typeof core === 'object') {
                  Object.assign(globalThis, core);
                }
                globalThis.__core_loaded = true;
              })();
            `);for(let P=0;P<20;P++){try{if(await window.strudel.evaluate("globalThis.__core_loaded === true")&&typeof globalThis.note=="function")break}catch{}await new Promise(M=>setTimeout(M,100))}}catch(b){throw console.error("❌ Failed to load core functions:",b),new Error("Core Strudel functions (note, samples, etc.) are not available in REPL context. Pattern evaluation will fail.")}}if(console.log("Evaluating pattern:",t),window.strudel&&window.strudel.evaluate)try{const y=[];let b=0;for(;;){const P=t.indexOf("samples(",b);if(P===-1)break;let M=0,v=!1,C="",E=P+8;for(;E<t.length&&/\s/.test(t[E]);)E++;if(E<t.length&&t[E]==="{"){const A=E;for(M=1,E++;E<t.length&&M>0;){const B=t[E];v?B===C&&t[E-1]!=="\\"&&(v=!1):B==='"'||B==="'"?(v=!0,C=B):B==="{"?M++:B==="}"&&M--,E++}if(M===0){const B=t.substring(A,E);for(;E<t.length&&(/\s/.test(t[E])||t[E]===",");)E++;let Z=null;if(E<t.length&&(t[E]==='"'||t[E]==="'")){const q=t[E],X=E;for(E++;E<t.length;){if(t[E]==="\\"){E+=2;continue}if(t[E]===q){Z=t.substring(X,E+1),E++;break}E++}}for(;E<t.length&&/\s/.test(t[E]);)E++;if(E<t.length&&t[E]===")"){const q=t.substring(P,E+1);y.push({fullCall:q,samplesObj:B,secondParam:Z}),b=E+1;continue}else if(E<t.length){const q=t.substring(P,E);y.push({fullCall:q,samplesObj:B,secondParam:Z}),b=E;continue}}}b=P+1}for(const P of y){const M=P.fullCall,v=P.samplesObj,C=P.secondParam;y.push({fullCall:M,samplesObj:v,secondParam:C})}for(const P of y)try{console.log("📦 Pre-loading samples() call in REPL:",P.fullCall),await window.strudel.evaluate(P.fullCall),console.log("✅ Samples loaded via REPL evaluation"),await new Promise(M=>setTimeout(M,500))}catch(M){console.warn("Could not evaluate samples() call in REPL:",M);try{const v=((o=window.strudel)==null?void 0:o.samples)||globalThis.samples;if(v&&typeof v=="function"){let C={};try{C=new Function("return "+P.samplesObj)()}catch(E){console.warn("Could not parse samples object:",E);continue}if(Object.keys(C).length>0){if(console.log("📦 Loading samples directly as fallback:",C),P.secondParam){let E=null;try{const A=P.secondParam.trim();A.startsWith("{")?E=new Function("return "+A)():E=A.replace(/^["']|["']$/g,""),await v(C,E)}catch{const B=P.secondParam.trim().replace(/^["']|["']$/g,"");await v(C,B)}}else await v(C);await new Promise(E=>setTimeout(E,500))}}}catch(v){console.warn("Fallback samples loading also failed:",v)}}y.length>0&&console.log(`✅ Pre-loaded ${y.length} samples() call(s) - pattern will be evaluated with samples already loaded`)}catch(y){console.warn("Error pre-loading samples from pattern:",y)}const h=this.getPatternSlot(e);console.log(`Assigning pattern to ${h} for element ${e}`);const d=this.getElementAudioNodes(e);(!d||!d.gainNode)&&console.warn(`⚠️ Could not prepare audio nodes for ${e} (pattern slot ${h})`),this.currentEvaluatingSlot=h;let f=null;const m=this.patternCache.get(e);if(m&&m.originalPattern===t&&m.processedPattern)f=m.processedPattern,console.log(`⚡ Using cached pattern for ${e} (instant trigger)`),f=this.applyElementGainPanToPattern(m.processedPattern.replace(/\.gain\([^)]*\)/g,"").replace(/\.pan\([^)]*\)/g,"").replace(/\.fast\([^)]*\)/g,"").replace(/\.slow\([^)]*\)/g,"").trim(),e,{applyGainInPattern:this.masterActive});else{if(console.log(`📝 Processing pattern for ${e} (not cached)`),f=await this.processPattern(t,e,{applyGainInPattern:this.masterActive}),!f){console.warn(`[${e}] Pattern processing failed - cannot evaluate`);try{const y=typeof globalThis.silence=="object"?`${h} = globalThis.silence`:`${h} = silence`;await window.strudel.evaluate(y);return}catch(y){console.error(`Failed to set ${h} to silence:`,y);return}}this.patternCache.set(e,{processedPattern:f,patternSlot:h,isPreEvaluated:!1,originalPattern:t})}if(!f||f.trim()===""){console.warn(`[${e}] Pattern became empty - cannot evaluate`);return}f.includes("undefined")&&!f.includes("globalThis.undefined")&&(console.warn("⚠️ Pattern contains 'undefined' - might be from removed samples() call"),f=f.replace(/undefined\s*[,\n;]/g,"").trim(),f=f.replace(/,\s*undefined/g,"").trim(),f=f.replace(/undefined\s*\./g,"").trim());const g=`${h} = ${f}`;console.log(`🎼 ${e} → ${h}:`),console.log(`   Full Pattern: ${f.substring(0,200)}${f.length>200?"...":""}`),console.log(`   Assignment: ${g.substring(0,200)}${g.length>200?"...":""}`);try{window.strudel&&window.strudel.scheduler&&!window.strudel.scheduler.started&&(console.log(`▶️ Starting scheduler for ${e} pattern evaluation...`),await window.strudel.scheduler.start());const y=await window.strudel.evaluate(g);this.currentEvaluatingSlot=h;const b=this.soundsPreloaded?500:1e3;if(setTimeout(()=>{this.currentEvaluatingSlot===h&&(this.currentEvaluatingSlot=null)},b),y&&typeof y=="object"&&y.message&&y.message.includes("undefined instead of pattern")){console.warn("⚠️ Pattern returned undefined - setting to silence");try{const P=typeof globalThis.silence=="object"?`${h} = globalThis.silence`:`${h} = silence`;await window.strudel.evaluate(P);return}catch(P){console.error(`Failed to set ${h} to silence:`,P);return}}console.log(`✅ Pattern assignment attempted for ${h}`)}catch(y){if(y.message&&y.message.includes("undefined instead of pattern")){console.error("❌ Pattern evaluation failed: pattern returned undefined"),console.error("   This usually means:"),console.error("   - Bank samples aren't loaded (check .bank() usage)"),console.error("   - Pattern syntax is invalid"),console.error("   - Required samples/sounds aren't available"),console.error(`   Pattern: ${f.substring(0,100)}`);try{const b=typeof globalThis.silence=="object"?`${h} = globalThis.silence`:`${h} = silence`;await window.strudel.evaluate(b),console.log(`✅ Set ${h} to silence due to pattern error`)}catch(b){console.error(`Failed to set ${h} to silence:`,b)}return}if(y.message.includes("not defined")||y.message.includes("ReferenceError")){console.log(`Slot ${h} doesn't exist, creating it...`);try{const b=typeof globalThis.silence=="object"?`${h} = globalThis.silence`:`${h} = silence`;await window.strudel.evaluate(b),await window.strudel.evaluate(g),console.log(`✅ Pattern assigned to ${h} after slot creation`)}catch(b){if(console.error(`❌ Failed to assign pattern to ${h} even after creating slot:`,b),b.message&&b.message.includes("undefined instead of pattern")){console.error("   Pattern still invalid - setting to silence");try{const P=typeof globalThis.silence=="object"?`${h} = globalThis.silence`:`${h} = silence`;await window.strudel.evaluate(P)}catch(P){console.error(`Failed to set ${h} to silence:`,P)}return}throw b}}else{console.error(`❌ Failed to assign pattern to ${h}:`,y);try{const b=typeof globalThis.silence=="object"?`${h} = globalThis.silence`:`${h} = silence`;await window.strudel.evaluate(b),console.log(`✅ Set ${h} to silence as fallback`)}catch(b){console.error(`Failed to set ${h} to silence:`,b)}return}}}catch(h){if(console.error("❌ Error evaluating pattern:",h),console.error("Pattern was:",t),console.error("Error details:",h.message),h.message&&h.message.includes("undefined instead of pattern")||h.isUndefinedPattern===!0){console.warn("⚠️ Pattern evaluation returned undefined"),console.warn("   This usually means:"),console.warn("   - Bank samples aren't loaded (check .bank() usage)"),console.warn("   - Pattern syntax is invalid"),console.warn("   - Required samples/sounds aren't available"),console.warn(`   Pattern: ${t.substring(0,100)}`);const d=this.getPatternSlot(e);try{await window.strudel.evaluate(`${d} = silence`),console.log(`✅ Set ${d} to silence due to pattern error`)}catch(f){console.warn(`⚠️ Failed to set ${d} to silence:`,f.message)}return}throw(h.message.includes("note is not defined")||h.message.includes("s is not defined"))&&(console.error("❌ Core Strudel functions (note, s, etc.) are not available in REPL context"),console.error("This means Strudel REPL was not properly initialized with core functions"),console.error("Pattern cannot be evaluated without core functions - NOT using fallback")),h}console.log(`Strudel pattern started for ${e}`),this.currentEvaluatingSlot=null;const c=this.strudelPatternSlots.get(e);if(typeof e=="string"&&e.toLowerCase().includes("preview"))this.trackedPatterns.has(e)&&(this.trackedPatterns.delete(e),console.log(`🗑️ Removed preview element ${e} from master tracking`),this.updateMasterPattern(this.soloedElements,this.mutedElements));else if(!this.trackedPatterns.has(e)){const h=this.getElementGain(e)||.8,d=this.getElementPan(e)||0,f=t.replace(/[""]/g,'"').replace(/['']/g,"'");this.trackedPatterns.set(e,{pattern:f,gain:h,pan:d,muted:!1,soloed:!1}),console.log(`➕ Auto-added ${e} to master tracked patterns`),this.updateMasterPattern(this.soloedElements,this.mutedElements)}this.activeSounds.set(e,{type:"strudel",patternSlot:c,stop:()=>{window.strudel.evaluate&&c&&(console.log(`🔇 Stopping ${e} (${c}) - setting to silence`),window.strudel.evaluate(`${c} = silence`).then(()=>{console.log(`✅ ${c} silenced`)}).catch(h=>{console.error(`❌ Error stopping pattern in ${c}:`,h)}))}});return}catch(l){console.warn("Failed to load Strudel from local packages:",l)}console.warn("Using simplified pattern parsing as fallback...");const a=t.match(/s\(["']([^"']+)["']\)/);if(a){const l=a[1],c=t.match(/\.slice\((\d+)\s*,\s*"([^"]+)"\)/);if(c){const u=this.parseIndexPattern(c[2]),h=this.createPatternFromIndices(u);await this.playSynthesizedSound(e,h)}else{const u=this.createPatternFromSampleName(l);await this.playSynthesizedSound(e,u)}}else await this.playSynthesizedSound(e,t)}async loadStrudelFromCDN(){var i,s,r;const e=typeof globalThis.silence=="object"&&typeof globalThis.sound=="function"&&typeof globalThis.note=="function";if(this.strudelLoaded&&window.strudel&&window.strudel.evaluate&&e){console.log("Strudel already loaded, initialized, and functions exposed");return}if(e||console.log("Functions not exposed, need to reload/expose:",{silence:typeof globalThis.silence+" (should be object)",sound:typeof globalThis.sound+" (should be function)",note:typeof globalThis.note+" (should be function)"}),this.strudelLoading){for(console.log("Strudel is currently loading, waiting...");this.strudelLoading;)await new Promise(a=>setTimeout(a,100));if(this.strudelLoaded&&window.strudel){console.log("Strudel loading completed by another call");return}}this.strudelLoading=!0,console.log("Loading Strudel...");try{const{webModule:a,coreModule:o,webaudioModule:l,tonalModule:c}=await aa(),u=a;console.log("✅ Loaded Strudel from local packages");let h=null,d=null,f=!1,m=l.webaudioOutput||((i=l.default)==null?void 0:i.webaudioOutput)||(u==null?void 0:u.webaudioOutput);!m&&typeof l=="function"&&(m=l),!m&&typeof l.default=="function"&&(m=l.default);const g=u.repl||a.repl,y=u.initStrudel||a.initStrudel;if(!g&&!y)throw new Error("Strudel REPL not available");if(console.log("Available initialization methods:",{hasRepl:!!g,hasInitStrudel:!!y}),!m||typeof m!="function")throw console.error("webaudioModule structure:",Object.keys(l||{})),console.error("webaudioOutput type:",typeof m),new Error("Strudel webaudioOutput not available or not a function");console.log("✅ Core module loaded, available functions:",Object.keys(o).filter(v=>typeof o[v]=="function").slice(0,15)),console.log("webaudioOutput type:",typeof m),this.strudelOutputFactory=m,console.log("Merging modules..."),console.log("  coreModule keys:",o?Object.keys(o).length:0),console.log("  tonalModule keys:",c?Object.keys(c).length:0),console.log("  webaudioModule keys:",l?Object.keys(l).length:0),console.log("  webModule keys:",a?Object.keys(a).length:0);const b={...o||{},...c||{},...l||{},...a||{}};if(Object.keys(b).forEach(v=>{b[v]===void 0&&delete b[v]}),console.log("After merge - allModules total keys:",Object.keys(b).length),console.log("After merge - function count:",Object.keys(b).filter(v=>typeof b[v]=="function").length),typeof globalThis.silence=="object"&&typeof globalThis.sound=="function"&&typeof globalThis.note=="function"?(console.log("Strudel functions already properly exposed to globalThis, skipping..."),console.log("Verification - typeof globalThis.silence:",typeof globalThis.silence,"(Pattern object)"),console.log("Verification - typeof globalThis.sound:",typeof globalThis.sound,"(function)"),console.log("Verification - typeof globalThis.note:",typeof globalThis.note,"(function)")):(console.log("Exposing all Strudel functions to globalThis..."),console.log("allModules keys:",Object.keys(b).length),console.log("Sample functions:",Object.keys(b).filter(v=>typeof b[v]=="function").slice(0,10)),Object.assign(globalThis,b),globalThis.__strudelModulesExposed=!0,console.log("✅ Exposed",Object.keys(b).filter(v=>typeof b[v]=="function").length,"functions to globalThis"),console.log("Verification - typeof globalThis.silence:",typeof globalThis.silence,"(Pattern object)"),console.log("Verification - typeof globalThis.sound:",typeof globalThis.sound,"(function)"),console.log("Verification - typeof globalThis.note:",typeof globalThis.note,"(function)")),d=a.samples||l.samples||u.samples,d?(globalThis.samples=d,console.log("✅ Samples function exposed to globalThis")):console.warn("⚠️ No samples function found in any module"),(a.getAudioContext||l.getAudioContext)&&console.log("✅ Audio context getter available"),console.log("🎚️ Using element channel routing:",!!(this.masterPanNode&&this.masterGainNode)),!globalThis.__strudelPatternsPreInitialized){console.log("🎰 PRE-REPL: Initializing pattern slots d0-d16 on globalThis...");const v=b.silence||globalThis.silence;if(v&&typeof v=="object"){for(let C=0;C<=16;C++)globalThis[`d${C}`]=v;console.log("✅ PRE-REPL: Pattern slots initialized with silence pattern")}else{console.warn("⚠️ PRE-REPL: silence pattern not available, creating empty pattern objects");const C={_type:"pattern",query:()=>[],firstCycle:()=>[]};for(let E=0;E<=16;E++)globalThis[`d${E}`]=C}globalThis.__strudelPatternsPreInitialized=!0,console.log("✅ PRE-REPL: Pattern slots are now defined on globalThis")}if(y&&typeof y=="function"){console.log("Using initStrudel for proper initialization...");try{const v={audioContext:this.audioContext,getTime:()=>this.audioContext?this.audioContext.currentTime:0,editPattern:()=>{},setUrl:()=>{}};console.log("🎚️ initStrudel options:",Object.keys(v));const C=await y(v);h=C.repl||C,console.log("✅ initStrudel completed, replInstance:",!!h);try{const A=await fetch("/strudel.json");if(A.ok){const B=await A.json();if(B.samples){const Z=((s=window.strudel)==null?void 0:s.samples)||globalThis.samples;Z&&typeof Z=="function"&&(console.log("📦 Loading samples from strudel.json"),await Z(B.samples),console.log("✅ Samples loaded from strudel.json"))}}}catch{console.log("ℹ️ No strudel.json found or error loading it (this is optional)")}try{await this.preloadPresetSamples()}catch(A){console.warn("⚠️ Error pre-loading preset samples:",A)}try{await this.initializeMIDI()}catch(A){console.warn("⚠️ Error initializing MIDI:",A)}console.log("replInstance type:",typeof h),console.log("replInstance.evaluate available:",typeof(h==null?void 0:h.evaluate)),console.log("strudelContext keys:",Object.keys(C)),console.log("🔍 Checking strudelContext for webaudio output...");const E=["strudelContext.webaudio","strudelContext.scheduler.webaudio","replInstance.webaudio","replInstance.scheduler.webaudio","strudelContext.output","replInstance.output"];C.scheduler&&(window.strudel=window.strudel||{},window.strudel.scheduler=C.scheduler,console.log("✅ Stored scheduler from strudelContext to window.strudel.scheduler"),C.scheduler.webaudio&&console.log("✅ Found webaudio in strudelContext.scheduler.webaudio")),C.webaudio&&(console.log("✅ Found webaudio in strudelContext.webaudio"),window.strudel=window.strudel||{},window.strudel.webaudio=C.webaudio),h&&h.scheduler&&(console.log("✅ Found scheduler in replInstance"),h.scheduler.webaudio&&console.log("✅ Found webaudio in replInstance.scheduler.webaudio")),(!h||typeof h.evaluate!="function")&&(console.warn("replInstance.evaluate not available, creating REPL manually..."),h=g({audioContext:this.audioContext,getTime:()=>this.audioContext.currentTime}),console.log("Created manual REPL, evaluate available:",typeof h.evaluate))}catch(v){console.warn("initStrudel failed, falling back to manual REPL:",v),h=g({audioContext:this.audioContext,getTime:()=>this.audioContext.currentTime})}}else console.log("Creating REPL manually (initStrudel not available)..."),h=g({audioContext:this.audioContext,getTime:()=>this.audioContext.currentTime});console.log("🎰 Checking if pattern slots need initialization..."),console.log("   replInstance:",!!h),console.log("   replInstance.evaluate:",typeof(h==null?void 0:h.evaluate)),console.log("   __strudelPatternsInitialized:",!!globalThis.__strudelPatternsInitialized),!globalThis.__strudelPatternsInitialized&&h&&h.evaluate?(console.log("🎰 Initializing pattern slots d0-d16..."),await(async()=>{for(let C=0;C<=16;C++)try{await h.evaluate(`d${C} = silence`),console.log(`  ✓ d${C} initialized with silence`)}catch{try{await h.evaluate(`d${C} = stack()`),console.log(`  ✓ d${C} initialized with stack()`)}catch(A){console.error(`  ✗ Failed to initialize d${C}:`,A.message)}}})(),console.log("✅ Pattern slot initialization complete"),globalThis.__strudelPatternsInitialized=!0,h.scheduler&&(console.log("⏸️ Scheduler NOT auto-started - will start when user presses play/preview"),setTimeout(()=>{const C=h.scheduler;if(C.webaudio||C._webaudio){const E=C.webaudio||C._webaudio;if(E.output||E.outputNode){const A=E.output||E.outputNode;try{A.disconnect(),A.connect(this.masterPanNode),console.log("✅ Connected webaudio output to master")}catch(B){console.warn("⚠️ Could not connect webaudio output:",B)}}}},500))):globalThis.__strudelPatternsInitialized?console.log("✅ Pattern slots already initialized"):console.warn("⚠️ Cannot initialize pattern slots - replInstance not available"),console.log("✅ REPL initialized - functions available via globalThis");try{let v=null;try{v=await rn(()=>import("./strudel-web-D2TLs97f.js").then(E=>E.i),__vite__mapDeps([0,1])),console.log("✅ Draw module imported from local packages")}catch{v=await rn(()=>import("https://unpkg.com/@strudel/draw@1.2.4/dist/index.mjs"),[]),console.log("✅ Draw module imported from CDN")}const C=((r=o==null?void 0:o.Pattern)==null?void 0:r.prototype)||(typeof Pattern<"u"?Pattern.prototype:null)||(globalThis.Pattern?globalThis.Pattern.prototype:null);if(C&&(!C._spectrum&&C.spectrum&&(C._spectrum=C.spectrum),!C._pianoroll&&C.pianoroll&&(C._pianoroll=C.pianoroll)),v&&h&&h.evaluate){const E="https://unpkg.com/@strudel/draw@1.2.4/dist/index.mjs";try{await h.evaluate(`
              (async function() {
                // Import the draw module - this automatically adds methods to Pattern.prototype
                const draw = await import('${E}')
                // Export getDrawContext for use in visualizers
                if (draw.getDrawContext) {
                  globalThis.getDrawContext = draw.getDrawContext
                }
                if (typeof Pattern !== 'undefined') {
                  if (!Pattern.prototype._spectrum && Pattern.prototype.spectrum) {
                    Pattern.prototype._spectrum = Pattern.prototype.spectrum;
                  }
                  if (!Pattern.prototype._pianoroll && Pattern.prototype.pianoroll) {
                    Pattern.prototype._pianoroll = Pattern.prototype.pianoroll;
                  }
                }
              })()
            `),await new Promise(A=>setTimeout(A,300))}catch(A){console.warn("⚠️ Could not load @strudel/draw in REPL context:",A)}}}catch(v){console.warn("⚠️ Could not load @strudel/draw functions:",v)}if(this.strudelRepl=h,this.audioContext&&(a.getAudioContext||l.getAudioContext)&&typeof(a.getAudioContext||l.getAudioContext)=="function")try{a.getAudioContext&&Object.defineProperty(a,"getAudioContext",{value:()=>(console.log("🎚️ Strudel getAudioContext() called - returning our shared context"),this.audioContext),writable:!0,configurable:!0}),l.getAudioContext&&Object.defineProperty(l,"getAudioContext",{value:()=>(console.log("🎚️ Strudel webaudio getAudioContext() called - returning our shared context"),this.audioContext),writable:!0,configurable:!0}),console.log("✅ Patched Strudel getAudioContext() to return our shared context")}catch(C){C.message.includes("Cannot redefine property")||console.warn("⚠️ Could not patch getAudioContext (module may be read-only):",C.message)}if(h&&h.scheduler){const v=h.scheduler;v.audioContext&&v.audioContext!==this.audioContext&&(console.log("🎚️ Replacing scheduler audioContext with our shared context"),v.audioContext=this.audioContext),v.superdough&&v.superdough.audioContext&&v.superdough.audioContext!==this.audioContext&&(console.log("🎚️ Replacing superdough audioContext with our shared context"),v.superdough.audioContext=this.audioContext)}if(this.exposeSampleListHelper(l,a),h&&h.scheduler&&this.masterPanNode&&this.masterGainNode)try{const v=h.scheduler;if(console.log("🔍 Checking for scheduler output..."),console.log("  scheduler.output:",!!v.output),console.log("  scheduler keys:",Object.keys(v).slice(0,15)),v.output){console.log("  scheduler.output type:",v.output.constructor.name);try{v.output.disconnect(),v.output.connect(this.masterPanNode),console.log("✅ Connected scheduler.output to masterPanNode")}catch(C){console.warn("⚠️ Could not connect scheduler.output:",C)}}if(v.superdough||v.output||v.audioOutput){const C=v.superdough||v.audioOutput||v.output;if(console.log("  Found superdough/audioOutput:",C?C.constructor.name:"null"),C&&typeof C.connect=="function")try{C.disconnect(),C.connect(this.masterPanNode),console.log("✅ Connected superdough/audioOutput to masterPanNode")}catch(E){console.warn("⚠️ Could not connect superdough/audioOutput:",E)}}if(v.audioContext){const C=v.audioContext.destination;try{Object.defineProperty(v.audioContext,"destination",{get:()=>this.masterPanNode||C,configurable:!0}),console.log("🎚️ Patched scheduler audioContext.destination")}catch(E){console.warn("⚠️ Could not patch scheduler audioContext:",E)}}}catch(v){console.warn("⚠️ Could not intercept scheduler output:",v)}h&&h.scheduler&&console.log("⏸️ REPL scheduler found (will be started after pattern slots are initialized)...");const M=async v=>{try{const C=await h.evaluate(v);return C===void 0&&v.includes("=")&&!v.trim().startsWith("//")&&(/^d\d+\s*=\s*/.test(v.trim())||/\w+\s*=\s*s\(|sound\(|note\(/.test(v))&&(console.warn(`⚠️ Pattern assignment returned undefined: ${v.substring(0,80)}`),console.warn("   This usually means the pattern is invalid or samples aren't loaded")),(C!==void 0||!v.includes("="))&&console.log(`Eval result for "${v.substring(0,50)}...":`,typeof C,C),C}catch(C){if(C.message&&C.message.includes("undefined instead of pattern")){const E=new Error("Pattern evaluation failed: got undefined instead of pattern");throw E.originalError=C,E.code=v,E.isUndefinedPattern=!0,console.warn("⚠️ Pattern evaluation error: got undefined instead of pattern"),console.warn(`   Code: ${v.substring(0,100)}`),console.warn("   This usually means:"),console.warn("   - Bank samples aren't loaded (check .bank() usage)"),console.warn("   - Pattern syntax is invalid"),console.warn("   - Required samples/sounds aren't available"),E}throw console.error("Evaluation error:",C),C}};d||(d=a.samples||u.samples||h&&h.samples),window.strudel={initialized:!0,evaluate:M,samples:d||(()=>{}),repl:h,scheduler:h==null?void 0:h.scheduler},this.strudelLoaded=!0,this.strudelLoading=!1,console.log("Checking Strudel functions availability..."),console.log("  typeof silence:",typeof globalThis.silence),console.log("  typeof sound:",typeof globalThis.sound),console.log("  typeof note:",typeof globalThis.note),console.log("✅ REPL ready (functions available via globalThis)"),this.currentTempo=120;try{await window.strudel.evaluate("cps = 1"),console.log("✅ Initial tempo set to 120 BPM (base cps=1, using .fast()/.slow() on patterns)")}catch(v){console.warn("⚠️ Could not set initial cps:",v)}return}catch(a){console.error("Failed to load Strudel module:",a),this.strudelLoading=!1}const t=["https://unpkg.com/@strudel/web@1.2.5/dist/index.mjs","https://cdn.jsdelivr.net/npm/@strudel/web@1.2.5/dist/index.mjs","https://esm.sh/@strudel/web@1.2.5"];for(const a of t)try{console.log(`Trying to load Strudel from: ${a}`);const o=await import(a),l=o.repl,c=o.samples;if(!l){console.warn("Strudel module missing repl. Available exports:",Object.keys(o));continue}const u=o.initStrudel;u&&u({audioContext:this.audioContext,output:this.audioContext});let h=null;try{try{h=await rn(()=>import("./strudel-core-DKU3hnf1.js").then(f=>f.b),[]),console.log("✅ Core module imported from local packages")}catch{h=await rn(()=>import("https://unpkg.com/@strudel/core@1.2.5/dist/index.mjs"),[]),console.log("✅ Core module imported from CDN")}console.log("Available exports:",Object.keys(h).slice(0,10))}catch(f){console.warn("Could not import core module:",f)}const d=l({getTime:()=>this.audioContext.currentTime,scope:h?{...h}:void 0});if(h)try{await d.evaluate(`
              (async function() {
                const core = await import('https://unpkg.com/@strudel/core@1.2.5/dist/index.mjs')
                Object.assign(globalThis, core)
              })()
            `),await new Promise(m=>setTimeout(m,300)),console.log("✅ Core functions also loaded via evaluation")}catch(f){console.warn("Could not load core functions via evaluation:",f)}try{let f=null;try{f=await rn(()=>import("./strudel-web-D2TLs97f.js").then(m=>m.i),__vite__mapDeps([0,1])),console.log("✅ Draw module imported from local packages")}catch{f=await rn(()=>import("https://unpkg.com/@strudel/draw@1.2.4/dist/index.mjs"),[]),console.log("✅ Draw module imported from CDN")}if(f){const m="https://unpkg.com/@strudel/draw@1.2.4/dist/index.mjs";await d.evaluate(`
              (async function() {
                // Import the draw module - this automatically adds methods to Pattern.prototype
                await import('${m}')
                // Also export getDrawContext for use in visualizers
                const draw = await import('${m}')
                if (draw.getDrawContext) {
                  const originalGetDrawContext = draw.getDrawContext;
                  // Patch getDrawContext to use our canvas when available
                  globalThis.getDrawContext = function(id, options) {
                    // If no ID or default ID, try to use our canvas context
                    if ((!id || id === 'test-canvas') && window.__strudelVisualizerCtx) {
                      return window.__strudelVisualizerCtx;
                    }
                    // Otherwise use original function
                    return originalGetDrawContext(id, options);
                  };
                }
              })()
            `),await new Promise(g=>setTimeout(g,300))}}catch(f){console.warn("⚠️ Could not load @strudel/draw functions:",f)}window.strudel={initialized:!0,evaluate:d.evaluate,samples:c},this.strudelLoaded=!0,this.strudelLoading=!1,console.log("Strudel loaded from CDN successfully");return}catch(o){console.warn(`Failed to load from ${a}:`,o.message);continue}throw this.strudelLoading=!1,new Error("Failed to load Strudel from all CDN sources")}async triggerSound(e){let t=null;try{const o=localStorage.getItem(`element-config-${e}`);o&&(t=JSON.parse(o))}catch(o){console.error(`Error loading custom config for ${e}:`,o)}const i=zt.getElementConfig(e);if(!i&&!t){console.warn(`No config found for element: ${e}`);return}const s=t&&typeof t.sampleUrl=="string"&&t.sampleUrl.trim()!==""?t.sampleUrl.trim():i&&i.audioFile&&typeof i.audioFile=="string"&&i.audioFile.trim()!==""?i.audioFile.trim():null;if(s){try{await this.initialize()||console.warn("⚠️ Audio engine not fully initialized; attempting custom sample playback anyway.")}catch(o){console.warn("⚠️ Unable to initialize audio engine for custom sample playback:",o)}this.stopSound(e),console.log(`🔊 Playing custom sample for ${e}`),this.playAudioFile(e,s);return}let r=(t==null?void 0:t.pattern)!==void 0?t.pattern:i==null?void 0:i.pattern;const a=(i==null?void 0:i.type)||"strudel";if(!r||typeof r=="string"&&r.trim()===""){console.log(`[${e}] No pattern assigned - skipping sound trigger`);return}if(this.appInstance&&a==="strudel"){const o=this.appInstance.getPatternWithEffects(e,r);o!==r&&(console.log(`   Applying effects to ${e} for individual playback`),r=o)}console.log(`Triggering sound for ${e} (type: ${a})`),t!=null&&t.sampleUrl&&await this.loadCustomSample(e,t.sampleUrl),a==="synthesized"?await this.playSynthesizedSound(e,r):a==="strudel"?await this.playStrudelPattern(e,r,i==null?void 0:i.samples):a==="audio"&&this.playAudioFile(e,(i==null?void 0:i.audioFile)||(t==null?void 0:t.sampleUrl))}async loadCustomSample(e,t){console.log(`Loading custom sample for ${e} from ${t.substring(0,50)}...`)}pauseSound(e){if(this.masterOnlyPlayback){this.removeElementFromMaster(e).success&&this.masterActive&&this.playMasterPattern().catch(s=>console.warn("⚠️ Failed to refresh master after pause:",s)),this.activeSounds.delete(e);return}const t=this.strudelPatternSlots.get(e);if(t&&window.strudel&&window.strudel.evaluate)try{const i=typeof globalThis.silence=="object"?`${t} = globalThis.silence`:`${t} = silence`;window.strudel.evaluate(i),console.log(`⏸️ Paused ${e} (set ${t} to silence)`)}catch(i){console.error(`Error pausing sound for ${e}:`,i)}this.activeSounds.delete(e)}stopSound(e){if(this.masterOnlyPlayback){this.removeElementFromMaster(e).success&&this.masterActive&&this.playMasterPattern().catch(r=>console.warn("⚠️ Failed to refresh master after stop:",r)),this.activeSounds.delete(e);return}const t=this.activeSounds.get(e),i=typeof e=="string"&&e.toLowerCase().includes("preview");if(window.strudel&&window.strudel.evaluate)try{const s=this.getPatternSlot(e),r=typeof globalThis.silence=="object"?`${s} = globalThis.silence`:`${s} = silence`;window.strudel.evaluate(r).catch(a=>{console.log(`Cleared pattern slot ${s} for ${e}`)})}catch{}if(t){if(t.type==="synthesized"&&t.oscillator)t.oscillator.stop&&t.oscillator.stop();else if(t.type==="strudel"&&t.stop)t.stop(),this.activeSounds.delete(e);else if(t.type==="audio"&&t.source){const s=t.gain,r=this.audioContext.currentTime;s.gain.cancelScheduledValues(r),s.gain.setValueAtTime(s.gain.value,r),s.gain.linearRampToValueAtTime(0,r+zt.defaults.fadeOutTime),setTimeout(()=>{t.source.stop(),this.activeSounds.delete(e)},zt.defaults.fadeOutTime*1e3+50);return}else if(t.type==="sustaining"){this.stopSustainingTone(e);return}this.activeSounds.delete(e)}if(i){const s=this.strudelPatternSlots.get(e);s&&(this.patternSlotToElementId.delete(s),this.strudelPatternSlots.delete(e),console.log(`🧹 Cleared preview slot mapping (${s}) for ${e}`)),this.disposeElementAudioNodes(e),console.log(`🧹 Disposed preview audio nodes for ${e}`)}}async stopAllSounds(){var s;if(this._stoppingAllSounds)return;this._stoppingAllSounds=!0,console.log("🛑🛑🛑 EMERGENCY STOP - Killing all audio 🛑🛑🛑");const e=((s=this.audioContext)==null?void 0:s.currentTime)||0;this.masterGainNode?(this.masterGainNode.gain.setValueAtTime(0,e),console.log("✓ Master gain set to 0 (immediate)"),setTimeout(()=>{var r;this.masterGainNode&&!this.masterMuted&&(this.masterGainNode.gain.setValueAtTime(this.masterVolume,((r=this.audioContext)==null?void 0:r.currentTime)||0),console.log(`✓ Master gain restored to ${(this.masterVolume*100).toFixed(0)}%`))},100)):this.gainNode&&(this.gainNode.gain.setValueAtTime(0,e),console.log("✓ Gain set to 0 (immediate)"),setTimeout(()=>{var r;this.gainNode&&(this.gainNode.gain.setValueAtTime(this.volume,((r=this.audioContext)==null?void 0:r.currentTime)||0),console.log(`✓ Gain restored to ${(this.volume*100).toFixed(0)}%`))},100));let t=!1;if(window.strudel&&window.strudel.repl&&window.strudel.repl.scheduler)try{const r=window.strudel.repl.scheduler;typeof r.stop=="function"&&(r.stop(),t=!0,console.log("✓ Stopped REPL scheduler (immediate)"))}catch{}if(window.strudel&&window.strudel.evaluate){console.log("🔇 Silencing all Strudel pattern slots (d1-d16)...");const r=[];for(let a=0;a<=16;a++){const o=`d${a}`;try{r.push(window.strudel.evaluate(`${o} = silence`).catch(()=>{}))}catch{}}try{await Promise.all(r),console.log("✅ All pattern slots silenced")}catch{}}const i=Array.from(this.activeSounds.keys());console.log(`🔇 Stopping ${i.length} tracked sounds`);for(const r of i)try{this.stopSound(r),console.log(`✓ Stopped ${r}`)}catch{console.log(`Could not stop ${r}`)}this.activeSounds.clear(),this.oscillators.forEach((r,a)=>{try{r.stop&&r.stop(),r.disconnect&&r.disconnect(),console.log(`✓ Disconnected oscillator ${a}`)}catch{}}),this.oscillators.clear(),this.masterActive=!1,this.currentEvaluatingSlot=null,this.masterPattern="",this.trackedPatterns&&this.trackedPatterns.clear&&this.trackedPatterns.clear(),console.log("✅✅✅ EMERGENCY STOP COMPLETE ✅✅✅ (audio context left running, master muted)"),this._stoppingAllSounds=!1}async setTempo(e){this.currentTempo=e,this.masterPlaybackTempo=e;const t=Number.isFinite(e)&&e>0?e/120:1;if(this.masterActive&&this.masterPlaybackStartTime!=null){const i=this.audioContext,s=i?i.currentTime:performance.now()/1e3,r=this.masterPlaybackSpeed||1,a=Math.max(0,s-this.masterPlaybackStartTime),o=r>0?a*r%1:0;this.masterPlaybackSpeed=t>0?t:1,this.masterPlaybackStartTime=s-o/this.masterPlaybackSpeed}else this.masterPlaybackSpeed=t>0?t:1;if(!window.strudel||!window.strudel.evaluate){console.warn("⚠️ Strudel not loaded yet - cannot set tempo");return}console.log(`🎚️ Tempo set to ${e} BPM (using .cpm() on patterns)`),await this.updateAllPatternsWithNewTempo(),this.trackedPatterns.size>0&&(console.log("🔄 Updating master with new tempo"),this.updateMasterPattern())}async ensureStrudelWorkletsReady(e,t=!1){try{if(!window.strudel||!window.strudel.repl||!window.strudel.repl.scheduler)return;const s=window.strudel.repl.scheduler.superdough;if(!s||!(t||typeof e=="string"&&/\b(supersaw|pulse)\b/i.test(e))||this._workletsLoaded)return;typeof s.loadWorklets=="function"&&(console.log("⏳ Loading Strudel AudioWorklets..."),await s.loadWorklets(),this._workletsLoaded=!0,console.log("✅ Strudel AudioWorklets loaded"))}catch(i){console.warn("⚠️ Could not load Strudel AudioWorklets:",(i==null?void 0:i.message)||i)}}setKey(e){this.currentKey=e||"",this._cachedScaleContext=null,this._cachedScaleKey="",this.currentKey?console.log(`🎹 Key set to ${e}`):console.log("🎹 Key cleared (no key selected)"),this.updateAllPatternsWithNewScale()}updateAllPatternsWithNewScale(){this.trackedPatterns.size>0&&(console.log("🔄 Updating master with new key/scale"),this.updateMasterPattern());for(const[e,t]of this.trackedPatterns.entries()){if(!t)continue;const i=t.pattern||t.rawPattern;if(!i)continue;const s=this.convertPatternForScale(i);t.pattern=s||i}for(const[e,t]of this.activeSounds.entries()){if(t.type!=="strudel")continue;const i=this.loadElementConfig?this.loadElementConfig(e):null,s=(i==null?void 0:i.pattern)||t.originalPattern||"";if(!s)continue;const a=this.convertPatternForScale(s)||s;this.updatePatternInPlace(e,a).catch(()=>{})}}setScale(e){this.currentScale=(e||"").trim()||"chromatic",this._cachedScaleContext=null,this._cachedScaleKey="",this.currentScale?console.log(`🎼 Scale set to ${this.currentScale}`):console.log("🎼 Scale cleared (no scale selected)"),this.updateAllPatternsWithNewScale()}setTimeSignature(e){this.currentTimeSignature=e,console.log(`🎵 Time signature set to ${e}`);const[t,i]=e.split("/").map(Number);this.currentBeats=t,this.currentNoteValue=i,console.log(`   ${t} beats per measure, ${i} note gets the beat`),this.trackedPatterns.size>0&&(console.log("🔄 Updating master with new time signature"),this.updateMasterPattern())}extractChannelNumber(e,t=0){if(!e||typeof e!="string")return t+1;const i=e.match(/(\d+)$/);if(i&&i[1]){const s=parseInt(i[1],10);if(Number.isFinite(s)&&s>0)return s}return t+1}formatNumberForPattern(e,t=6){return!Number.isFinite(e)||e===0?"0":e.toFixed(t).replace(/(\.\d*?[1-9])0+$/,"$1").replace(/\.0+$/,"").replace(/^-0$/,"0")}getScaleConversionContext(){return null}convertPatternForScale(e){if(!e||typeof e!="string")return e;const t=this.patternHasNoteNames(e),i=this.patternHasNumericNotePattern(e);return t&&!i?(console.log("📝 convertPatternForScale: Pattern uses note names, preserving format"),e):zf(e)}convertNoteNamesToSemitones(e){return!e||typeof e!="string"?e:zf(e)}convertNoteNamesToScaleDegrees(e,t,i){if(!e||typeof e!="string")return e;const s=t&&t.trim()||"C",r=i&&i.trim()||"chromatic",a=this.getScaleSemitoneSteps(s,r);if(!a||!a.length)return e;const l=`${s.replace(/\s+/g,"").toUpperCase()}`.match(/^([A-G])([#B]?)/i);if(!l)return e;const c=`${l[1].toUpperCase()}${l[2]||""}`,u=Vc.get(`${c}4`),h=Number.isFinite(u.midi)?u.midi:60,d=g=>{const y=/(\s+|[,;:<>()[\]{}|\\/]+|\*+)/g,b=[];let P=0,M;for(;(M=y.exec(g))!==null;)M.index>P&&b.push({type:"note",value:g.substring(P,M.index)}),b.push({type:"separator",value:M[0]}),P=M.index+M[0].length;P<g.length&&b.push({type:"note",value:g.substring(P)});let v=!1;for(let C=0;C<b.length;C++){const E=b[C];if(E.type==="separator")continue;const A=E.value.trim();if(!A)continue;const B=A.match(/^([a-gA-G])([#b]?)(-?\d+)?(@[\d.]+)?$/);if(!B)continue;const Z=B[1].toUpperCase(),q=B[2]||"",X=B[3]?parseInt(B[3],10):null,j=B[4]||"",H=[];X!==null&&!Number.isNaN(X)&&H.push(X);const se=u.oct||4;H.push(se,se-1,se+1,3,4,5);let oe=null;for(const yt of H){const he=Vc.get(`${Z}${q}${yt}`);if(he&&Number.isFinite(he.midi)){oe=he.midi;break}}if(oe===null)return null;const Pe=oe-h,Me=(Pe%12+12)%12,Be=a.indexOf(Me);if(Be===-1)return null;const Ct=Math.floor((Pe-a[Be])/12)*a.length+Be;b[C]={type:"note",value:`${Ct}${j}`},v=!0}return v?b.map(C=>C.value).join(""):null},f=/\bnote\s*\(\s*(["'])([\s\S]*?)\1\s*\)/gi;return e.replace(f,(g,y,b)=>{const P=d(b);return P===null?g:`n(${y}${P}${y})`})}getScaleSemitoneSteps(e,t){const i=e&&typeof e=="string"?e.trim():"",s=t&&typeof t=="string"?t.trim():"",r=Au[s]||s||"chromatic";let a="C";if(i){const u=i.match(/^([a-gA-G])([#b]?)/);u?a=`${u[1].toUpperCase()}${u[2]||""}`:a=i}const o=va.get(`${a} ${r}`);if(!o||!Array.isArray(o.intervals)||o.intervals.length===0)return null;const l=o.intervals.map(u=>{const h=mw.semitones(u);return Number.isFinite(h)?h:null}).filter(u=>u!==null);if(!l.length)return null;const c=Array.from(new Set(l)).sort((u,h)=>u-h);return c[0]!==0&&c.unshift(0),c}patternHasNoteNames(e){if(!e||typeof e!="string")return!1;const t=/\b(note|n)\s*\(\s*["']([^"']+)["']/gi;let i;for(;(i=t.exec(e))!==null;){const s=i[2];if(/[a-gA-G][#b]?\d/.test(s)||/[a-gA-G][#b]?\s/.test(s))return!0}return!1}patternHasNumericNotePattern(e){if(!e||typeof e!="string")return!1;const t=/\b(note|n)\s*\(\s*["']([^"']+)["']/gi;let i,s=!1;for(;(i=t.exec(e))!==null;){s=!0;let r=i[2].replace(/[<>\[\]\{\}\|,]/g," ").trim();if(r&&(/[a-gA-G]/.test(r)||!/^[\d\s~\-\/]+$/.test(r)))return!1}return s}_ensureMasterPatternSanitized(){if(!this.masterPattern||typeof this.masterPattern!="string")return"";const e=this._sanitizePatternExpression(this.masterPattern);return e!==this.masterPattern&&(console.log("🧼 Sanitized master pattern before evaluation"),this.masterPattern=e),this.masterPattern}_repairBrokenSampleStrings(e){if(!e||typeof e!="string")return e;const t=/samples\s*\(\s*\{([\s\S]*?)\}\s*,\s*\{([\s\S]*?)\}\s*\)/g;return e.replace(t,(i,s,r)=>{var f,m;const a=/"([^"]+)"\s*:\s*"([\s\S]*?)"/g,o=[];let l;for(;(l=a.exec(s))!==null;){const g=(f=l[1])==null?void 0:f.trim(),y=(m=l[2])==null?void 0:m.replace(/[\r\n]+/g,"").trim();!g||!y||o.push([g,y])}if(!o.length)return i;const c=r.match(/baseUrl\s*:\s*"([\s\S]*?)"/),u=c?c[1].replace(/[\r\n]+/g,"").trim():"./";return`samples({
${o.map(([g,y])=>`  "${g}": "${y}"`).join(`,
`)}
}, { baseUrl: "${u||"./"}" })`})}_findMatchingParenIndex(e,t){let i=0,s=!1,r=!1,a=!1,o=!1,l=!1,c=!1;for(let u=t;u<e.length;u+=1){const h=e[u],d=e[u+1];if(c){c=!1;continue}if(l){h===`
`&&(l=!1);continue}if(o){h==="*"&&d==="/"&&(o=!1,u+=1);continue}if(h==="\\"){c=!0;continue}if(s){h==="'"&&(s=!1);continue}if(r){h==='"'&&(r=!1);continue}if(a){h==="`"&&(a=!1);continue}if(h==="'"&&!r&&!a){s=!0;continue}if(h==='"'&&!s&&!a){r=!0;continue}if(h==="`"&&!s&&!r){a=!0;continue}if(h==="/"&&d==="*"){o=!0,u+=1;continue}if(h==="/"&&d==="/"){l=!0,u+=1;continue}if(h==="("){i+=1;continue}if(h===")"){if(i-=1,i===0)return u;if(i<0)return-1}}return-1}_repairLeadingSampleStatements(e){if(!e||typeof e!="string")return e;const t=e.trimStart();if(t.startsWith("(() =>")||t.startsWith("(()=>"))return e;const i=e.slice(0,e.length-t.length),s=t.match(/^(?:\/\*[\s\S]*?\*\/\s*|\/\/[^\n]*\n\s*)+/),r=s?s[0]:"";let a=t.slice(r.length).trimStart();if(!a.startsWith("samples"))return e;const o=[];let l=0;for(;a.startsWith("samples",l);){const f=l,m=a.indexOf("(",f);if(m===-1)break;const g=this._findMatchingParenIndex(a,m);if(g===-1)break;const y=a.slice(f,g+1).trim();for(o.push(y),l=g+1;l<a.length&&/\s/.test(a[l]);)l+=1}if(!o.length)return e;const c=a.slice(l).trim();if(!c)return e;const u=o.map(f=>`  ${f};`).join(`
`),h=c.split(`
`).map(f=>`    ${f}`).join(`
`),d=`(() => {
${u}
  return (
${h}
  );
})()`;return`${i}${r}${d}`}_repairStringPatternOperators(e){if(!e||typeof e!="string")return e;let t="",i=0;const s=e.length,r=a=>a?/[,\(\{\[=:+\-*\/!&|?;%]/.test(a):!0;for(;i<s;){const a=e[i];if(a==='"'||a==="'"){const o=a;let l=i+1,c=!1;for(;l<s;){const y=e[l];if(!c&&y===o)break;!c&&y==="\\"?c=!0:c=!1,l+=1}if(l>=s){t+=e.slice(i);break}const u=e.slice(i,l+1);let h=i-1;for(;h>=0&&/\s/.test(e[h]);)h-=1;const d=h>=0?e[h]:"";let f=l+1;for(;f<s&&/\s/.test(e[f]);)f+=1;const m=e.startsWith(".div",f),g=r(d);m&&g?t+=`pattern(${u})`:t+=u,i=l+1;continue}t+=a,i+=1}return t}_sanitizePatternExpression(e){if(!e||typeof e!="string")return e;let t=this._repairBrokenSampleStrings(e);return t=this._repairLeadingSampleStatements(t),t=this._repairStringPatternOperators(t),t}applyMasterMixModifiers(e,t={}){if(!e||typeof e!="string"||e.trim()==="")return e;const{wrapStack:i=!1}=t;let s=e;if(i){const M=s.match(/stack\s*\(/);if(M){let v=M.index+M[0].length-1,C=1,E=v+1,A=!1,B=null;for(;E<s.length&&C>0;){const Z=s[E];!A&&(Z==='"'||Z==="'")?(A=!0,B=Z):A&&Z===B&&s[E-1]!=="\\"&&(A=!1,B=null),A||(Z==="("?C++:Z===")"&&C--),C>0&&E++}C===0&&(s=s.substring(0,E+1).trimEnd())}}else s=s.replace(/\.gain\s*\([^)]*\)/g,""),s=s.replace(/\.pan\s*\([^)]*\)/g,""),s=s.replace(/\.cpm\s*\([^)]*\)/g,""),s=s.replace(/\.\.+/g,".").replace(/\.\s*$/,"").trim();s=s.replace(/\.\.+/g,".").replace(/\.\s*$/,"").trim();let r=e;if(i){const M=e.match(/stack\s*\(/);if(M){let v=M.index+M[0].length-1,C=1,E=v+1,A=!1,B=null;for(;E<e.length&&C>0;){const Z=e[E];!A&&(Z==='"'||Z==="'")?(A=!0,B=Z):A&&Z===B&&e[E-1]!=="\\"&&(A=!1,B=null),A||(Z==="("?C++:Z===")"&&C--),C>0&&E++}C===0&&(r=e.substring(E+1))}}const a=[...r.matchAll(/\.gain\s*\(\s*([^)]+)\s*\)/g)];if(a.length>0){const M=a[a.length-1],v=parseFloat(M[1]);Number.isFinite(v)&&(this.masterVolume=v)}const o=[...r.matchAll(/\.pan\s*\(\s*([^)]+)\s*\)/g)];if(o.length>0){const M=o[o.length-1],v=parseFloat(M[1]);Number.isFinite(v)&&(this.masterPan=v)}const l=[];Number.isFinite(this.masterVolume)&&Math.abs(this.masterVolume-1)>1e-6&&l.push(`.gain(${this.formatNumberForPattern(this.masterVolume,4)})`),Number.isFinite(this.masterPan)&&Math.abs(this.masterPan)>1e-6&&l.push(`.pan(${this.formatNumberForPattern(this.masterPan,4)})`);const c=Number.isFinite(this.currentTempo)&&this.currentTempo>0?this.currentTempo:120;if(Math.abs(c-120)>1e-6){const M=c/4;l.push(`.cpm(${this.formatNumberForPattern(M,6)})`)}if(!l.length)return s;e=s;const u=l,h=e.match(/^(\s*\/\/[^\n]*\n)+/);let d="",f=e;h&&(d=h[0],f=e.slice(d.length));const m=f.match(/\s*$/),g=m?m[0]:"",y=f.trim();if(!y)return e;if(i){const M=y.match(/stack\s*\(/);if(M){let C=M.index+M[0].length-1,E=1,A=C+1,B=!1,Z=null;for(;A<y.length&&E>0;){const q=y[A];!B&&(q==='"'||q==="'")?(B=!0,Z=q):B&&q===Z&&y[A-1]!=="\\"&&(B=!1,Z=null),B||(q==="("?E++:q===")"&&E--),E>0&&A++}if(E===0){const q=y.slice(0,A+1);let j=y.slice(A+1).trim(),H=j.length,se=0;for(;se<10&&(j=j.replace(/\.(gain|pan|cpm)\s*\([^)]*\)/g,""),j=j.replace(/\.\s*\(\s*(gain|pan|cpm)\s*\([^)]*\)\s*\)/g,""),j=j.replace(/\s*\(\s*(gain|pan|cpm)\s*\([^)]*\)\s*\)/g,""),j=j.replace(/\s*(gain|pan|cpm)\s*\([^)]*\)/g,""),j=j.replace(/\.\.+/g,".").replace(/\.\s*$/,"").replace(/^\s*\./,"").trim(),j.length!==H);)H=j.length,se++;(j.match(/(gain|pan|cpm)\s*\(/)||j.match(/[().]/))&&(j="");const oe=q+(u.length>0?u.join(""):"");return`${d}${oe}${g}`}}const v=y.lastIndexOf(")");if(v!==-1){const C=y.slice(0,v+1);let A=y.slice(v+1).trim(),B=A.length,Z=0;for(;Z<10&&(A=A.replace(/\.(gain|pan|cpm)\s*\([^)]*\)/g,""),A=A.replace(/\.\s*\(\s*(gain|pan|cpm)\s*\([^)]*\)\s*\)/g,""),A=A.replace(/\s*\(\s*(gain|pan|cpm)\s*\([^)]*\)\s*\)/g,""),A=A.replace(/\s*(gain|pan|cpm)\s*\([^)]*\)/g,""),A=A.replace(/\.\.+/g,".").replace(/\.\s*$/,"").replace(/^\s*\./,"").trim(),A.length!==B);)B=A.length,Z++;(A.match(/(gain|pan|cpm)\s*\(/)||A.match(/[().]/))&&(A="");const q=C+(u.length>0?u.join(""):"");return`${d}${q}${g}`}}const b=y.startsWith("(")&&y.endsWith(")"),P=u.length>0?b?`${y}${u.join("")}`:`(${y})${u.join("")}`:y;return`${d}${P}${g}`}applyGlobalSettingsToPattern(e,t=!1,i=!1,s=null,r=null){if(!e||e==="silence")return e;let a=e,o=t;const l=/\b(note|n)\s*\(/.test(a),c=this.patternHasNoteNames(a),u=/\b(note|n)\s*\(\s*["'][a-g][#b]?[a-z0-9]*\s*[a-z]/.test(a)||/\b(note|n)\s*\(\s*["'][^"']*\b(maj|min|m|dim|aug|sus|add|7|9|11|13)\b/i.test(a),h=/\.\s*chord\s*\(/i.test(a),d=/\b(note|n)\s*\(\s*["'][^"']*[a-g][#b]?\s/.test(a),f=c||u||d||h,m=this.patternHasNumericNotePattern(a),g=l&&!f&&!h&&m,y=s!==null?s:this.currentKey&&this.currentKey.trim()!==""?this.currentKey.trim():"",b=r!==null?r:this.currentScale&&this.currentScale.trim()!==""?this.currentScale.trim():"",P=y&&y.trim()!=="",M=b&&b.trim()!==""?b.trim():"";let v="",C="";if(P){const E=y.toLowerCase();E.includes("m")&&!E.includes("major")?(v=E.replace("m","").trim(),C="minor"):(v=E.replace("major","").trim(),C="major"),v||(v=E.trim())}if(g){let E="";if(P){const B=M||C||"major",Z=Au[B]||B,q=v||y.trim().toLowerCase();E=q?`${q}:${Z}`:Z}else M&&(E=Au[M]||M);const A=/\.\s*scale\s*\(/i.test(a);if(A&&(a=a.replace(/\.\s*scale\s*\((['"])(?:(?=(\\?))\2.)*?\1\)/gi,""),a=a.replace(/\.\s*scale\s*\([^)]*\)/gi,""),a=a.replace(/\.+/g,".").replace(/\.\s*\./g,".").trim(),a=a.replace(/\.+$/,"").trim(),console.log("  🔄 Removed existing scale modifier")),E&&!h){const B=`.scale('${E}')`,Z=a.search(/\.(s|sound)\s*\(/);if(Z!==-1){const q=a.slice(0,Z),X=a.slice(Z);a=`${q}${B}${X}`}else o?a=`${a}${B}`:(a=`(${a})${B}`,o=!0);console.log(`  🎼 Applied scale: ${E}`)}else(P||M)&&console.log(h?"  ⏭️  Skipped scale application (pattern uses .chord() modifier)":A?"  ⏭️  Skipped scale application (pattern already has scale)":"  ⏭️  Skipped scale application (pattern not compatible with key/scale settings)")}else if(f&&(P||M)){let E="note name";h?E="chord modifier (.chord())":u&&(E="chord"),console.log(`  ⏭️  Skipped scale for ${E} pattern (use numeric n() for scale/key changes)`)}else!l&&(P||M)&&console.log(`  ⏭️  Skipped scale for non-note pattern (Key: ${y||"none"}, Scale: ${M||"none"})`);return a}async updateAllPatternsWithNewTempo(){for(const[e,t]of this.activeSounds.entries())if(t.type==="strudel")try{const i=localStorage.getItem(`element-config-${e}`);if(i){const s=JSON.parse(i);s.pattern&&s.pattern.trim()!==""&&await this.updatePatternInPlace(e,s.pattern)}}catch{}}isPlaying(e){return this.activeSounds.has(e)}getAudioContext(){return this.audioContext}isAudioReady(){return this.initialized&&this.audioContext&&(this.audioContext.state==="running"||this.audioContext.state==="suspended")}playSustainingTone(e,t,i,s,r=null){if(!this.initialized||!this.audioContext)return;this.audioContext.state==="suspended"&&(Js(),this.audioContext.resume().catch(d=>{console.error("Failed to resume audio context:",d)}));const a=(t-i)/(s-i),o=160,c=o*Math.pow(1e4/o,a);this.stopSustainingTone(e);const u=this.audioContext.createOscillator(),h=this.audioContext.createGain();if(u.type="sine",u.frequency.value=c,u.connect(h),r){const d=this.getElementAudioNodes(r);d?(h.connect(d.gainNode),h.gain.value=.3):(h.connect(this.gainNode),h.gain.value=this.volume*.3)}else h.connect(this.gainNode),h.gain.value=this.volume*.3;u.start(0),this.activeSounds.set(e,{type:"sustaining",oscillator:u,gain:h,frequency:c})}updateSustainingToneFrequency(e,t,i,s,r=null){if(!this.audioContext)return;this.audioContext.state==="suspended"&&(Js(),this.audioContext.resume().catch(o=>{console.error("Failed to resume audio context:",o)}));const a=this.activeSounds.get(e);if(a&&a.type==="sustaining"&&a.oscillator)try{const o=(t-i)/(s-i),l=160,u=l*Math.pow(1e4/l,o);a.oscillator.frequency.setValueAtTime(u,this.audioContext.currentTime),a.frequency=u}catch(o){console.error("Error updating sustaining tone frequency:",o),this.playSustainingTone(e,t,i,s,r)}else this.playSustainingTone(e,t,i,s,r)}async checkSoundBanksStatus(){if(!window.strudel||!window.strudel.evaluate)return{loaded:!1,error:"Strudel not initialized"};try{return{loaded:(typeof globalThis.s=="function"&&typeof globalThis.sound=="function")===!0}}catch(e){return{loaded:!1,error:e.message}}}async ensureDefaultSoundBanks(){var e;if(!window.strudel||!window.strudel.evaluate){try{this.strudelLoaded||await this.initStrudel()}catch{}if(!window.strudel||!window.strudel.evaluate)return!1}if(this.strudelSoundBanksLoaded)return!0;if(this.strudelSoundBankLoading){for(;this.strudelSoundBankLoading;)await new Promise(t=>setTimeout(t,100));return this.strudelSoundBanksLoaded}this.strudelSoundBankLoading=!0;try{if(console.log("📦 Loading default Strudel sound banks (dirt-samples)..."),typeof document<"u"){const s=document.getElementById("status-text");s&&(s.textContent="📦 Loading default drum samples...")}const t=((e=window.strudel)==null?void 0:e.samples)||globalThis.samples;if(t&&typeof t=="function")try{console.log("📦 Loading default Strudel samples from dough-samples CDN...");const s=Cu,r={tidalDrums:!1,piano:!1,dirt:!1,vcsl:!1,mridangam:!1};if(await Promise.all([t(`${s}/tidal-drum-machines.json`).then(()=>{console.log("  ✅ Tidal drum machines loaded (TR-808, TR-909, TR-707, RhythmAce, AkaiLinn, etc.)"),r.tidalDrums=!0}).catch(a=>{console.warn("  ⚠️ Could not load tidal-drum-machines from CDN:",a.message),console.log("  📁 Will use local TR-808/TR-909 samples as fallback")}),t(`${s}/piano.json`).then(()=>{console.log("  ✅ Piano samples loaded"),r.piano=!0}).catch(a=>console.warn("  ⚠️ Could not load piano:",a.message)),t(`${s}/Dirt-Samples.json`).then(()=>{console.log("  ✅ Dirt-Samples loaded"),r.dirt=!0}).catch(a=>console.warn("  ⚠️ Could not load Dirt-Samples:",a.message)),t(`${s}/vcsl.json`).then(()=>{console.log("  ✅ VCSL (vocal) samples loaded"),r.vcsl=!0}).catch(a=>console.warn("  ⚠️ Could not load VCSL:",a.message)),t(`${s}/mridangam.json`).then(()=>{console.log("  ✅ Mridangam (percussion) samples loaded"),r.mridangam=!0}).catch(a=>console.warn("  ⚠️ Could not load mridangam:",a.message))]),console.log("✅ Default Strudel samples loaded from dough-samples CDN"),r.tidalDrums)console.log("📝 Note: TR-808 and TR-909 loaded from CDN (local samples available as backup)");else{console.log("📁 Loading local TR-808 and TR-909 samples as fallback...");try{await this.loadBank("RolandTR808"),await this.loadBank("RolandTR909"),console.log("✅ Local TR-808 and TR-909 samples loaded successfully")}catch(a){console.warn("⚠️ Could not load local TR-808/TR-909 samples:",a)}}}catch(s){console.warn("⚠️ Error loading samples from dough-samples:",s),console.log("   Attempting to load local TR-808/TR-909 samples...");try{await this.loadBank("RolandTR808"),await this.loadBank("RolandTR909"),console.log("✅ Local TR-808 and TR-909 samples loaded as fallback")}catch(r){console.warn("⚠️ Could not load local samples either:",r)}}this.strudelSoundBanksLoaded=!0,this.strudelSoundBankLoading=!1,console.log("✅ Default sound banks ready"),console.log("📦 Available: Piano, Dirt-Samples, VCSL, Mridangam, Drum Machines (TR-808, TR-909, TR-707, etc.)"),console.log("🧪 Testing pattern evaluation...");let i=!1;if(typeof globalThis.silence=="object"&&typeof globalThis.sound=="function"&&typeof globalThis.note=="function"){console.log("✅ Pattern functions available in globalThis");try{await window.strudel.evaluate("d16 = silence"),console.log("✅ Pattern assignment test passed"),i=!0}catch(s){console.warn("⚠️ Pattern assignment test failed:",s),await new Promise(r=>setTimeout(r,1e3));try{await window.strudel.evaluate("d16 = silence"),console.log("✅ Pattern assignment test passed on retry"),i=!0}catch(r){console.error("❌ Pattern assignment still failing:",r)}}}else console.error("❌ Pattern functions not available in globalThis"),console.log("  silence:",typeof globalThis.silence,"(should be object)"),console.log("  sound:",typeof globalThis.sound,"(should be function)"),console.log("  note:",typeof globalThis.note,"(should be function)");if(i&&this.onSoundsReadyCallback?(console.log("🔔 Notifying app that sounds are ready..."),this.onSoundsReadyCallback()):i||console.warn("⚠️ Sounds loaded but patterns not ready - dots will stay red"),typeof document<"u"){const s=document.getElementById("status-text");s&&(s.textContent="✅ Samples loaded - Ready!",setTimeout(()=>{s.textContent.includes("Samples loaded")&&(s.textContent="Ready - Click elements to start/stop patterns (Press Escape to stop all)")},2e3))}return!0}catch(t){return this.strudelSoundBankLoading=!1,t.message&&t.message.includes("CycleTones")?(console.log("⚠️ CycleTones not available - patterns will use dirt-samples if loaded"),!1):(console.error("❌ Failed to load default sound banks:",t),console.error("Error details:",t.message,t.stack),console.error("Strudel patterns may not work without default sound banks"),!1)}}async preloadAllCommonDrumSounds(){return console.log("📦 Preloading skipped (silent mode) - no audible patterns will be evaluated"),!0}exposeSampleListHelper(e,t){globalThis.getLoadedSamples=()=>{try{let i=null,s="";const r=(e==null?void 0:e.soundMap)||(t==null?void 0:t.soundMap);if(r&&(i=typeof r.get=="function"?r.get():r,i&&typeof i=="object"&&(s="webaudioModule/webModule.soundMap")),(!i||Object.keys(i).length===0)&&this.strudelRepl){const l=this.strudelRepl;if(l.scheduler){const c=l.scheduler;if(c.soundMap&&(i=typeof c.soundMap.get=="function"?c.soundMap.get():c.soundMap,i&&typeof i=="object"&&(s="repl.scheduler.soundMap")),(!i||Object.keys(i).length===0)&&c.context){const u=c.context;u.soundMap&&(i=typeof u.soundMap.get=="function"?u.soundMap.get():u.soundMap,i&&typeof i=="object"&&(s="repl.scheduler.context.soundMap"))}}}if((!i||Object.keys(i).length===0)&&window.strudel&&window.strudel.repl&&window.strudel.repl.scheduler){const l=window.strudel.repl.scheduler;l.soundMap&&(i=typeof l.soundMap.get=="function"?l.soundMap.get():l.soundMap,i&&typeof i=="object"&&(s="window.strudel.repl.scheduler.soundMap"))}if(!i||Object.keys(i).length===0){const l=(e==null?void 0:e.getSound)||(t==null?void 0:t.getSound);if(l&&typeof l=="function"){console.log("🔍 Attempting to detect samples via getSound function...");const c=["bd","sd","hh","cp","oh","cr","rim","tr808_bd","tr909_bd","RolandTR808_bd","RolandTR909_bd"],u=[];c.forEach(h=>{try{const d=l(h);d&&d!=="triangle"&&u.push(h)}catch{}}),u.length>0&&(console.log(`📊 Found ${u.length} samples via getSound:`,u),s="getSound detection")}}if((!i||Object.keys(i).length===0)&&this.strudelRepl){const l=this.strudelRepl;console.log("🔍 Checking REPL properties for sample registry..."),console.log("   REPL keys:",Object.keys(l).slice(0,20)),l.scheduler&&(console.log("   Scheduler keys:",Object.keys(l.scheduler).slice(0,20)),l.scheduler.context&&console.log("   Scheduler.context keys:",Object.keys(l.scheduler.context).slice(0,20))),l.samples&&typeof l.samples=="object"&&(i=l.samples,s="repl.samples",console.log("✅ Found samples in repl.samples"))}if((!i||Object.keys(i).length===0)&&window.strudel&&window.strudel.evaluate){console.log("🔍 Testing pattern evaluation to detect available samples...");const l=['s("bd")','s("bd").bank("tr808")','s("bd").bank("tr909")','sound("bd")'];for(const c of l)try{const u=window.strudel.evaluate(c);console.log(`   Pattern "${c}" evaluated successfully`)}catch(u){u.message&&(u.message.includes("not found")||u.message.includes("not loaded"))?console.log(`   Pattern "${c}" - sample not found (expected)`):console.log(`   Pattern "${c}" - error:`,u.message)}}if(!i||Object.keys(i).length===0){const l=Object.keys(globalThis).filter(c=>c.toLowerCase().includes("sample")||c.toLowerCase().includes("sound")||c.toLowerCase().includes("bank"));l.length>0&&(console.log("🔍 Found potential sample-related globals:",l),l.forEach(c=>{try{const u=globalThis[c];if(typeof u=="object"&&u!==null&&!Array.isArray(u)){const h=Object.keys(u);h.length>0&&(console.log(`   ${c} has ${h.length} keys:`,h.slice(0,10)),(!i||Object.keys(i).length===0)&&(i=u,s=`globalThis.${c}`))}}catch{}}))}if(!i||typeof i!="object"||Object.keys(i).length===0)return console.log("⚠️ soundMap not found or empty"),console.log("   Tried: webaudioModule, webModule, repl.scheduler, window.strudel"),console.log("   This might mean samples are loaded but not yet registered"),console.log("   Try loading a bank first, then check again"),{total:0,keys:[],byBank:{},source:"none",note:"No samples found. Samples may need to be loaded first."};const a=Object.keys(i);console.log(`📊 Total loaded samples: ${a.length} (from ${s})`),console.log("📋 All loaded sample names:",a);const o={};return a.forEach(l=>{const c=l.split("_");if(c.length>1){const u=c[0],h=c.slice(1).join("_");o[u]||(o[u]=[]),o[u].push(h)}else o.default||(o.default=[]),o.default.push(l)}),Object.keys(o).length>0&&(console.log("📦 Samples grouped by bank:"),Object.entries(o).forEach(([l,c])=>{console.log(`  ${l}: ${c.length} sounds`,c.slice(0,20))})),{total:a.length,keys:a,byBank:o,source:s}}catch(i){return console.error("❌ Error getting loaded samples:",i),console.error("   Stack:",i.stack),null}},console.log("✅ Helper function available: getLoadedSamples()"),console.log("   Call getLoadedSamples() in console to see all loaded samples")}async loadBank(e){var u,h,d,f,m;if(!window.strudel||!window.strudel.evaluate)throw console.warn("Cannot load bank: Strudel not initialized"),new Error("Strudel not initialized");if(!e||typeof e!="string")return console.warn("Cannot load bank: invalid name",e),!1;if(e=e.trim(),!e)return console.warn("Cannot load bank: empty name after trimming"),!1;const t=e.toLowerCase();if(new Set(["sine","square","triangle","sawtooth","supersaw","pulse","saw","saw2","saw3","saw4","saw8"]).has(e.toLowerCase()))return console.log(`⏭️ Skipping built-in oscillator synth "${e}" (no loading needed)`),this.loadedBanks.add(e.toLowerCase()),this.loadedBanks.add(e),!0;const s={RolandTR909:{RolandTR909_bd:["assets/sounds/Kicks/ESWTR909 Kick 01.wav","assets/sounds/Kicks/ESWTR909 Kick 02.wav","assets/sounds/Kicks/ESWTR909 Kick 03.wav","assets/sounds/Kicks/ESWTR909 Kick 04.wav","assets/sounds/Kicks/ESWTR909 Kick 05.wav","assets/sounds/Kicks/ESWTR909 Kick 06.wav","assets/sounds/Kicks/ESWTR909 Kick 07.wav","assets/sounds/Kicks/ESWTR909 Kick 08.wav","assets/sounds/Kicks/ESWTR909 Kick 09.wav","assets/sounds/Kicks/ESWTR909 Kick 10.wav"],RolandTR909_sd:["assets/sounds/Snares/ESWTR909 Snare 01.wav","assets/sounds/Snares/ESWTR909 Snare 02.wav","assets/sounds/Snares/ESWTR909 Snare 03.wav","assets/sounds/Snares/ESWTR909 Snare 04.wav","assets/sounds/Snares/ESWTR909 Snare 05.wav","assets/sounds/Snares/ESWTR909 Snare 06.wav","assets/sounds/Snares/ESWTR909 Snare 07.wav","assets/sounds/Snares/ESWTR909 Snare 08.wav","assets/sounds/Snares/ESWTR909 Snare 09.wav","assets/sounds/Snares/ESWTR909 Snare 10.wav","assets/sounds/Snares/ESWTR909 Snare 11.wav","assets/sounds/Snares/ESWTR909 Snare 12.wav"],RolandTR909_hh:["assets/sounds/Hats/ESWTR909 HH Closed 01.wav","assets/sounds/Hats/ESWTR909 HH Closed 02.wav","assets/sounds/Hats/ESWTR909 HH Closed 03.wav","assets/sounds/Hats/ESWTR909 HH Closed 04.wav","assets/sounds/Hats/ESWTR909 HH Closed 05.wav","assets/sounds/Hats/ESWTR909 HH Closed 06.wav","assets/sounds/Hats/ESWTR909 HH Closed 07.wav","assets/sounds/Hats/ESWTR909 HH Closed 08.wav","assets/sounds/Hats/ESWTR909 HH Closed 09.wav","assets/sounds/Hats/ESWTR909 HH Closed 10.wav"],RolandTR909_oh:["assets/sounds/Hats/ESWTR909 HH Open 01.wav","assets/sounds/Hats/ESWTR909 HH Open 02.wav","assets/sounds/Hats/ESWTR909 HH Open 03.wav","assets/sounds/Hats/ESWTR909 HH Open 04.wav","assets/sounds/Hats/ESWTR909 HH Open 05.wav","assets/sounds/Hats/ESWTR909 HH Open 06.wav","assets/sounds/Hats/ESWTR909 HH Open 07.wav","assets/sounds/Hats/ESWTR909 HH Open 08.wav"],RolandTR909_cp:["assets/sounds/Claps/ESWTR909 Clap 01.wav","assets/sounds/Claps/ESWTR909 Clap 02.wav","assets/sounds/Claps/ESWTR909 Clap 03.wav","assets/sounds/Claps/ESWTR909 Clap 04.wav","assets/sounds/Claps/ESWTR909 Clap 05.wav"],RolandTR909_cr:["assets/sounds/Hats/ESWTR909 HH Crash 01.wav","assets/sounds/Hats/ESWTR909 HH Crash 02.wav","assets/sounds/Hats/ESWTR909 HH Crash 03.wav","assets/sounds/Hats/ESWTR909 HH Crash 04.wav","assets/sounds/Hats/ESWTR909 HH Crash 05.wav"],RolandTR909_lt:["assets/sounds/Toms/ESWTR909 Tom 01.wav","assets/sounds/Toms/ESWTR909 Tom 02.wav","assets/sounds/Toms/ESWTR909 Tom 03.wav","assets/sounds/Toms/ESWTR909 Tom 04.wav","assets/sounds/Toms/ESWTR909 Tom 05.wav"],RolandTR909_mt:["assets/sounds/Toms/ESWTR909 Tom 06.wav","assets/sounds/Toms/ESWTR909 Tom 07.wav","assets/sounds/Toms/ESWTR909 Tom 08.wav","assets/sounds/Toms/ESWTR909 Tom 09.wav","assets/sounds/Toms/ESWTR909 Tom 10.wav"],RolandTR909_ht:["assets/sounds/Toms/ESWTR909 Tom 11.wav","assets/sounds/Toms/ESWTR909 Tom 12.wav","assets/sounds/Toms/ESWTR909 Tom 13.wav","assets/sounds/Toms/ESWTR909 Tom 14.wav","assets/sounds/Toms/ESWTR909 Tom 15.wav"]},RolandTR808:{RolandTR808_bd:["assets/sounds/Kicks/ESW909X Kick 01.wav","assets/sounds/Kicks/ESW909X Kick 02.wav","assets/sounds/Kicks/ESW909X Kick 03.wav","assets/sounds/Kicks/ESW909X Kick 04.wav","assets/sounds/Kicks/ESW909X Kick 05.wav"],RolandTR808_sd:["assets/sounds/Snares/ESW909X Snare 01.wav","assets/sounds/Snares/ESW909X Snare 02.wav","assets/sounds/Snares/ESW909X Snare 03.wav","assets/sounds/Snares/ESW909X Snare 04.wav","assets/sounds/Snares/ESW909X Snare 05.wav"],RolandTR808_cp:["assets/sounds/Claps/ESW909X Clap 01.wav","assets/sounds/Claps/ESW909X Clap 02.wav","assets/sounds/Claps/ESW909X Clap 03.wav","assets/sounds/Claps/ESW909X Clap 04.wav","assets/sounds/Claps/ESW909X Clap 05.wav"]}},r=["RolandTR707","RhythmAce","AkaiLinn","ViscoSpaceDrum","CasioRZ1"],a=["piano","superpiano","jazz","supersaw","folkharp","casio","insect","wind","wood","metal","east","crow","space","numbers","sawtooth","sine","square","triangle","saw","saw2","saw3","saw4","saw8","gtr"],o={mridangam:`${Cu}/mridangam.json`,vcsl:`${Cu}/vcsl.json`};if(o[t]){const g=((u=window.strudel)==null?void 0:u.samples)||globalThis.samples;if(!g||typeof g!="function")return console.warn(`⚠️ samples() function not available for specialty bank "${t}"`),!1;try{console.log(`📦 Loading specialty sample bank "${t}" from dough-samples`);let y=this.specialtyManifests.get(t);if(!y){const M=await fetch(o[t]);if(!M.ok)throw new Error(`HTTP ${M.status}`);const v=await M.json();y=_P(v),this.specialtyManifests.set(t,y)}const b={...y},P=Object.keys(y||{});return P.forEach(M=>{const v=`${t}_${M}`;b[v]||(b[v]=y[M])}),await g(b),P.forEach(M=>{const v=M.toLowerCase();this.sampleNameToSpecialtyBank.set(v,t),this.sampleNameToSpecialtyBank.set(`${t}_${v}`,t),this.loadedBanks.add(v),this.loadedBanks.add(M),this.loadedBanks.add(`${t}_${v}`),this.loadedBanks.add(`${t}_${M}`)}),this.loadedBanks.add(t),this.loadedBanks.add(e),console.log(`✅ Specialty bank "${t}" loaded`),!0}catch(y){return console.warn(`⚠️ Failed to load specialty bank "${t}":`,y.message||y),!1}}if(s[e]){console.log(`📦 Loading local custom bank "${e}" from assets folder...`);const g=((h=window.strudel)==null?void 0:h.samples)||globalThis.samples;if(g&&typeof g=="function")try{return await g(s[e]),console.log(`✅ Local custom bank "${e}" loaded successfully from assets`),this.loadedBanks.add(e),!0}catch(y){return console.error(`❌ Failed to load local bank "${e}":`,y),!1}else return console.error("❌ samples() function not available"),!1}if(r.includes(e)){console.log(`📦 Ensuring built-in drum bank "${e}" samples are loaded...`);try{const y=`d15 = s("bd sd hh cp oh cr rd ht mt lt sh cb tb pe").bank("${e}")`;if(await window.strudel.evaluate(y),window.strudel.scheduler&&typeof window.strudel.scheduler.tick=="function")for(let b=0;b<4;b++)window.strudel.scheduler.tick(),await new Promise(P=>setTimeout(P,50));else await new Promise(b=>setTimeout(b,200));return await window.strudel.evaluate("d15 = silence"),this.loadedBanks.add(e),console.log(`✅ Built-in drum bank "${e}" ready`),!0}catch(g){return console.warn(`⚠️ Could not preload built-in bank "${e}":`,g),this.loadedBanks.add(e),!0}}let l=t;if(Sa[t]&&(l=Sa[t],console.log(`🔄 Normalizing bank name "${e}" to "${l}"`)),a.includes(l)){const g=((d=window.strudel)==null?void 0:d.samples)||globalThis.samples;if(g&&typeof g=="function")try{return console.log(`📦 Loading sample bank "${l}" via samples()`),await g(l),this.loadedBanks.add(l),this.loadedBanks.add(t),console.log(`✅ Sample bank "${l}" loaded`),!0}catch(y){return console.warn(`⚠️ Failed to load sample bank "${l}":`,y.message||y),this.loadedBanks.add(l),this.loadedBanks.add(t),!1}else return console.warn(`⚠️ samples() function not available for loading "${l}"`),!1}if(e.startsWith("github:")){const g=((f=window.strudel)==null?void 0:f.samples)||globalThis.samples;if(!g||typeof g!="function")throw console.error("samples function not available!"),new Error("samples function not available");console.log(`📦 Loading bank via samples(): ${e}`);try{const y=await g(e);return console.log("samples() call completed, result:",y),console.log("⏳ Waiting for samples to load..."),await new Promise(b=>setTimeout(b,2e3)),console.log(`✅ Bank loaded: ${e}`),!0}catch(y){throw console.error(`❌ Failed to load bank ${e}:`,y),y}}else{console.log(`📦 Bank "${e}" is a predefined bank name`);const g=((m=window.strudel)==null?void 0:m.samples)||globalThis.samples;if(!g||typeof g!="function")return console.warn(`⚠️ samples function not available for loading bank "${e}"`),console.log(`   Bank "${e}" may need to be loaded manually`),!1;const y=[e];let b=!1;const P=console.error;console.error=(...v)=>{let C="";for(let B=0;B<v.length;B++)typeof v[B]=="string"?C+=" "+v[B]:v[B]&&v[B].toString&&(C+=" "+String(v[B]));const E=String(v[0]||""),A=C.toLowerCase();E.includes("JSON")||E.includes("SyntaxError")||E.includes("not found")||E.includes("RolandTR")||E.includes("404")||E.includes("Failed")||E.includes("<!DOCTYPE")||E.includes("Unexpected token")||E.includes("is not valid JSON")||E.includes("Unexpected non-whitespace")||C.includes("JSON")||C.includes("SyntaxError")||C.includes("not found")||C.includes("RolandTR")||C.includes("404")||C.includes("<!DOCTYPE")||C.includes("Unexpected token")||C.includes("is not valid JSON")||A.includes("json")||A.includes("syntaxerror")||A.includes("rolandtr")||P.apply(console,v)};try{for(const v of y)try{console.log(`   Trying to load from: ${v}`);const C=await g(v);console.log(`   ✅ Successfully called samples() with: ${v}`),b=!0;break}catch{console.log(`   ✗ Path "${v}" not available`);continue}}finally{console.error=P}return b?(console.log("⏳ Waiting for samples to load..."),await new Promise(v=>setTimeout(v,3e3)),console.log(`✅ Bank "${e}" loading initiated`),this.loadedBanks.add(e)):(console.log(`⚠️ Could not load "${e}" from any known path`),console.log(`   Bank "${e}" may be embedded in Strudel or unavailable`),console.log(`   To use this bank in patterns (if available), use: .bank("${e}")`),console.log(`   Example: sound("bd hh").bank("${e}")`)),b}}async initializeMIDI(){try{if(await ye.enable(),this.midiEnabled=!0,console.log("✅ WebMidi enabled"),ye.outputs.forEach(e=>{this.midiOutputs.set(e.name,e),console.log(`🎹 MIDI Output available: ${e.name}`)}),this.midiOutputs.size>0){const e=Array.from(this.midiOutputs.values())[0];this.selectedMidiOutput=e,console.log(`✅ Auto-selected MIDI output: ${e.name}`)}ye.addListener("connected",e=>{e.port.type==="output"&&(this.midiOutputs.set(e.port.name,e.port),console.log(`🎹 MIDI Output connected: ${e.port.name}`),this.selectedMidiOutput||(this.selectedMidiOutput=e.port,console.log(`✅ Auto-selected MIDI output: ${e.port.name}`)))}),ye.addListener("disconnected",e=>{e.port.type==="output"&&(this.midiOutputs.delete(e.port.name),console.log(`🎹 MIDI Output disconnected: ${e.port.name}`),this.selectedMidiOutput===e.port&&(this.selectedMidiOutput=null,this.midiOutputs.size>0&&(this.selectedMidiOutput=Array.from(this.midiOutputs.values())[0],console.log(`✅ Auto-selected new MIDI output: ${this.selectedMidiOutput.name}`))))}),this.setupStrudelMIDIOutput()}catch(e){console.warn("⚠️ WebMidi initialization failed:",e),this.midiEnabled=!1}}setupStrudelMIDIOutput(){if(!(!this.midiEnabled||!window.strudel))try{const e=window.strudel.midiOutput;window.strudel.midiOutput=t=>{this.sendMIDIMessage(t),e&&typeof e=="function"&&e(t)},console.log("✅ Strudel MIDI output handler set up")}catch(e){console.warn("⚠️ Failed to set up Strudel MIDI output:",e)}}sendMIDIMessage(e){if(!(!this.midiEnabled||!this.selectedMidiOutput))try{const t=e.channel!==void 0?e.channel:this.midiChannel;switch(e.type){case"noteon":case"noteOn":this.selectedMidiOutput.playNote(e.note,{channel:t+1,velocity:e.velocity||127});break;case"noteoff":case"noteOff":this.selectedMidiOutput.stopNote(e.note,{channel:t+1});break;case"cc":case"controlchange":this.selectedMidiOutput.sendControlChange(e.controller,e.value,{channel:t+1});break;case"programchange":this.selectedMidiOutput.sendProgramChange(e.program,{channel:t+1});break;case"pitchbend":this.selectedMidiOutput.sendPitchBend(e.value,{channel:t+1});break;default:e.data&&Array.isArray(e.data)&&this.selectedMidiOutput.send(e.data)}}catch(t){console.warn("⚠️ Failed to send MIDI message:",t)}}getMIDIOutputs(){return Array.from(this.midiOutputs.keys())}selectMIDIOutput(e){return this.midiOutputs.has(e)?(this.selectedMidiOutput=this.midiOutputs.get(e),console.log(`✅ Selected MIDI output: ${e}`),!0):(console.warn(`⚠️ MIDI output not found: ${e}`),!1)}setMIDIChannel(e){e>=0&&e<=15&&(this.midiChannel=e,console.log(`✅ MIDI channel set to: ${e+1}`))}async preloadPresetSamples(){var i;const e=((i=window.strudel)==null?void 0:i.samples)||globalThis.samples;if(!e||typeof e!="function"){console.warn("⚠️ samples() function not available for pre-loading preset samples");return}const t=["github:tidalcycles/dirt-samples","github:switchangel/pad","github:yaxu/clean-breaks/main"];console.log("📦 Pre-loading samples from Sampler Effects presets...");for(const s of t)try{console.log(`   Loading: ${s}`),await e(s),console.log(`   ✅ Loaded: ${s}`),await new Promise(r=>setTimeout(r,200))}catch(r){console.warn(`   ⚠️ Failed to load ${s}:`,r.message)}console.log("✅ Finished pre-loading preset samples")}async ensurePatternResourcesLoaded(e){var c;if(!e||typeof e!="string"||typeof this.loadBank!="function")return;const t=this._sanitizePatternExpression(e)||e,i=new Set(["sine","square","triangle","sawtooth","supersaw","pulse","saw","saw2","saw3","saw4","saw8"]),s=new Set,r=/\.bank\(["']([^"']+)["']\)/g;let a;for(;(a=r.exec(t))!==null;)a[1]&&s.add(a[1]);const o=/\.s\(["']([^"']+)["']\)/g;for(;(a=o.exec(t))!==null;){const u=a[1];u&&(/\s|~|\[|\]|,/.test(u)||i.has(u.toLowerCase())||s.add(u))}const l=/\.sound\(["']([^"']+)["']\)/g;for(;(a=l.exec(t))!==null;){const u=a[1];u&&(i.has(u.toLowerCase())||s.add(u))}for(const u of s){if(this.loadedBanks.has(u)||!u)continue;const h=u.toLowerCase();if(i.has(h)){console.log(`⏭️ Skipping built-in oscillator synth "${u}" (no loading needed)`),this.loadedBanks.add(h),this.loadedBanks.add(u);continue}const d=(c=this.sampleNameToSpecialtyBank)==null?void 0:c.get(h);if(d){if(console.log(`⏭️ "${u}" is provided by specialty bank "${d}"`),!this.loadedBanks.has(d))try{await this.loadBank(d)}catch(m){console.warn(`⚠️ Could not ensure specialty bank "${d}" for "${u}":`,m)}this.loadedBanks.add(h),this.loadedBanks.add(u);continue}let f=h;if(Sa[h]&&(f=Sa[h],console.log(`🔄 Normalizing "${u}" to "${f}" for loading`)),this.loadedBanks.has(f)){console.log(`✅ Resource "${u}" already loaded as "${f}"`),this.loadedBanks.add(u);continue}try{console.log(`🎚️ ensurePatternResourcesLoaded: loading "${f}" for playback`),await this.loadBank(f)?(this.loadedBanks.add(f),this.loadedBanks.add(u),console.log(`✅ Resource "${f}" loaded`)):console.warn(`⚠️ Could not load resource "${f}" (continuing anyway)`)}catch(m){console.warn(`⚠️ Error loading resource "${f}" (continuing anyway):`,m.message||m)}}}stopSustainingTone(e){const t=this.activeSounds.get(e);if(t&&t.type==="sustaining"&&t.oscillator)try{const i=t.gain,s=this.audioContext.currentTime;i.gain.cancelScheduledValues(s),i.gain.setValueAtTime(i.gain.value,s),i.gain.linearRampToValueAtTime(0,s+.1),setTimeout(()=>{t.oscillator.stop(),this.activeSounds.delete(e)},100)}catch(i){console.error("Error stopping sustaining tone:",i),this.activeSounds.delete(e)}}saveElementToMaster(e,t,i,s){try{console.log(`💾 Saving ${e} to master: pattern="${t==null?void 0:t.substring(0,50)}...", gain=${i}, pan=${s}`);const r=(t||"").replace(/[""]/g,'"').replace(/['']/g,"'"),a=this._sanitizePatternExpression(r),o=this.patternHasNoteNames(a),l=this.patternHasNumericNotePattern(a);let c=a;if(/\bnote\s*\(/i.test(r)){const h=/\bnote\s*\(\s*(["'])([^"']*)\1/gi;let d=!1;c=c.replace(h,(f,m,g)=>{const y=g.replace(/[<>\[\]\{\}\|,]/g," ").trim();return y&&!/[a-gA-G]/.test(y)&&/^[\d\s~\-\/]+$/.test(y)?(d=!0,`n(${m}${g}${m}`):f}),d&&console.log(`🔄 Converted note() with semitones to n() for ${e}`)}return this.trackedPatterns.set(e,{rawPattern:c,pattern:c,gain:i||.8,pan:s||0,muted:!1,soloed:!1}),this.audioContext&&this.getElementAudioNodes(e)&&console.log(`  🎚️ Created audio nodes for ${e}`),console.log(`✅ Saved ${e} to master. Total tracks: ${this.trackedPatterns.size}`),{success:!0}}catch(r){return console.error(`❌ Error saving ${e} to master:`,r),{success:!1,error:r.message}}}async routePatternThroughMaster(e,t,{isPreview:i=!1,autoStart:s=!1}={}){if(!this.masterOnlyPlayback)return{success:!1,error:"Master-only playback is disabled"};const r=typeof t=="string"?t:"";if(!r.trim())return console.warn(`⚠️ Empty pattern for ${e}, removing from master`),this.removeElementFromMaster(e),this.masterActive&&await this.playMasterPattern(),{success:!1,error:"Pattern empty"};const o=this.getElementGain(e),l=this.getElementPan(e),c=this.saveElementToMaster(e,r,o,l);return c.success?(i?this.previewElementIds.add(e):this.previewElementIds.delete(e),this.updateMasterPattern(this.soloedElements,this.mutedElements),this.masterActive||s?this.playMasterPattern():{success:!0,autoStarted:!1}):c}removeElementFromMaster(e){try{return this.previewElementIds.delete(e),this.trackedPatterns.has(e)&&(this.trackedPatterns.delete(e),console.log(`🗑️ Removed ${e} from master. Remaining tracks: ${this.trackedPatterns.size}`),this.updateMasterPattern(),this.masterOnlyPlayback&&(this.masterPattern&&this.masterPattern.trim()?this.masterActive&&this.playMasterPattern().catch(t=>console.warn("⚠️ Failed to refresh master after removal:",t)):this.masterActive&&this.stopMasterPattern().catch(t=>console.warn("⚠️ Failed to stop master after removal:",t)))),{success:!0}}catch(t){return console.error(`❌ Error removing ${e} from master:`,t),{success:!1,error:t.message}}}updateTrackedElementGain(e,t){if(this.trackedPatterns.has(e)){const i=this.trackedPatterns.get(e);return i.gain=t,console.log(`🎚️ Updated ${e} gain in master: ${t.toFixed(2)}`),this.updateMasterPattern(this.soloedElements,this.mutedElements),this.scheduleMasterPatternRefresh(`gain change: ${e}`),{success:!0}}return{success:!1,reason:"Element not tracked in master"}}updateTrackedElementPan(e,t){if(this.trackedPatterns.has(e)){const i=this.trackedPatterns.get(e);return i.pan=t,console.log(`🎚️ Updated ${e} pan in master: ${t.toFixed(2)}`),this.updateMasterPattern(this.soloedElements,this.mutedElements),this.scheduleMasterPatternRefresh(`pan change: ${e}`),{success:!0}}return{success:!1,reason:"Element not tracked in master"}}scheduleMasterPatternRefresh(e="unspecified"){this._pendingMasterPatternRefreshReason=e,!this._masterPatternRefreshTimer&&(this._masterPatternRefreshTimer=setTimeout(()=>{this._masterPatternRefreshTimer=null,this._performScheduledMasterPatternRefresh()},60))}async _performScheduledMasterPatternRefresh(){if(!this.masterPattern||this.masterPattern.trim()===""){this._pendingMasterPatternRefreshReason=null;return}if(!this.masterActive){console.log(`🔁 Master refresh skipped (not active). Pending reason: ${this._pendingMasterPatternRefreshReason||"unspecified"}`),this._pendingMasterPatternRefreshReason=null;return}const e=this._pendingMasterPatternRefreshReason||"unspecified";this._pendingMasterPatternRefreshReason=null,this._masterPatternEvalPromise=this._masterPatternEvalPromise.catch(()=>{}).then(()=>this._reEvaluateMasterPattern(e));try{await this._masterPatternEvalPromise}catch(t){console.warn(`⚠️ Master pattern refresh failed (${e}):`,t)}}formatMasterPatternWithTempoComment(e){if(!e||typeof e!="string"||e.trim()==="")return e;const t=this.currentTempo||120,i="// Controls Selected Tempo:",r=e.split(`
`).filter(o=>!o.trim().startsWith(i)).join(`
`).trimEnd(),a=this._sanitizePatternExpression(r);return a!==r&&console.log("🧼 Sanitized master pattern when formatting tempo comment"),`${a}

${i} ${t} BPM`}updateMasterPattern(e=new Set,t=new Set){var i,s,r;try{console.log(`🎛️ Updating master pattern. Tracks: ${this.trackedPatterns.size}, Solo: ${e.size}, Muted: ${t.size}`);const a=[],o=[],l=[],c=e.size>0,u=this.getScaleConversionContext();let h=0;for(const[f,m]of this.trackedPatterns.entries()){const g=t.has(f),y=e.has(f),b=this.extractChannelNumber(f,h);if(h+=1,g||c&&!y){console.log(`  ⏭️ Skipping ${f} (muted: ${g}, solo active but not soloed: ${c&&!y})`);continue}if(m.gain<=0){console.log(`  ⏭️ Skipping ${f} (gain is ${m.gain})`);continue}const P=m.pattern||m.rawPattern||"",M=this._sanitizePatternExpression(P);if(M!==P&&(m.pattern=M,m.rawPattern=M),!M||M.trim()===""){console.log(`  ⏭️ Skipping ${f} (empty pattern)`);continue}const v=this.patternHasNoteNames(M),C=this.patternHasNumericNotePattern(M);let E=M;v&&!C?(E=M,console.log(`  📝 Preserving note names format for ${f}: ${M.substring(0,50)}...`)):C&&!v?(E=M,console.log(`  📝 Preserving semitones format for ${f}: ${M.substring(0,50)}...`)):(E=M,console.log(`  📝 Preserving pattern format as-is for ${f}: ${M.substring(0,50)}...`)),m.pattern=E;let A=(E||"").trim();if(A=A.replace(/[""]/g,'"').replace(/['']/g,"'"),(()=>{const oe=/\/\*\s*Channel\s+\d+\s*\*\//i.test(A),Pe=/\bstack\s*\(/i.test(A);return!(oe||Pe)})())for(;A.startsWith("(")&&A.endsWith(")");){let oe=0,Pe=!0;for(let Me=0;Me<A.length;Me++)if(A[Me]==="("?oe++:A[Me]===")"&&oe--,oe===0&&Me<A.length-1){Pe=!1;break}if(Pe&&oe===0)A=A.slice(1,-1).trim();else break}if(A.startsWith("(")){let oe=0,Pe=-1;for(let Me=0;Me<A.length;Me++)if(A[Me]==="("&&oe++,A[Me]===")"&&oe--,oe===0){Pe=Me;break}Pe===-1&&(A=A.substring(1),console.log("  🔧 Stripped unmatched opening paren from pattern"))}A=Pu(A),A=`${A.trim()}.postgain(${m.gain.toFixed(2)})`,m.pan!==0&&(A=`${A}.pan(${m.pan.toFixed(2)})`);const q=((s=(i=this.appInstance)==null?void 0:i.loadElementConfig)==null?void 0:s.call(i,f))||{};let X=q.key||null,j=q.scale||null;if((!X||!j)&&A.includes(".scale(")){const oe=A.match(/\.\s*scale\s*\(\s*['"]([^'"]+)['"]\s*\)/i);if(oe&&oe[1]){const Pe=oe[1];if(Pe.includes(":")){const[Me,Be]=Pe.split(":");X=X||Me.trim(),j=j||Be.trim(),console.log(`  🎼 Extracted scale from pattern: ${X}:${j}`)}else j=j||Pe.trim(),X=X||"C",console.log(`  🎼 Extracted scale from pattern: ${X}:${j}`)}}const H=A.trim(),se=H.startsWith("(")&&H.endsWith(")");if(A=this.applyGlobalSettingsToPattern(A,se,!1,X,j),m.pan===0){let oe=A.trim();(()=>{for(;oe.startsWith("(")&&oe.endsWith(")");){let Me=0,Be=!0;for(let Ke=0;Ke<oe.length;Ke++){const Ct=oe[Ke];if(Ct==="("?Me++:Ct===")"&&Me--,Me===0&&Ke<oe.length-1){Be=!1;break}}if(!Be||Me!==0)break;oe=oe.slice(1,-1).trim()}})(),A=oe}a.push(A),l.push(b),o.push(`Channel ${b}`),console.log(`  ✅ Added ${f}: ${A.substring(0,100)}...`)}if(a.length===0)this.masterPattern="",console.log("🔇 No active patterns - master pattern cleared");else{let m=`stack(
${a.map((C,E)=>`  /* Channel ${l[E]??E+1} */
  ${C}`).join(`,

`)}
)`;m=this.applyMasterMixModifiers(m,{wrapStack:!0}),this.masterPattern=m;let g=0,y=!1,b=null,P=!1;for(let C=0;C<this.masterPattern.length;C++){const E=this.masterPattern[C],A=this.masterPattern[C+1];if(!y&&E==="/"&&A==="/"){P=!0,C++;continue}if(P&&E===`
`){P=!1;continue}if(!P){if(!P&&(E==='"'||E==="'")){y?E===b&&this.masterPattern[C-1]!=="\\"&&(y=!1,b=null):(y=!0,b=E);continue}if(!y&&!P){if(E==="(")g++;else if(E===")"&&(g--,g<0)){console.error(`  ⚠️ UNBALANCED PARENTHESES! Extra closing paren at position ${C}`);break}}}}const M=(this.masterPattern.match(/\(/g)||[]).length,v=(this.masterPattern.match(/\)/g)||[]).length;if(console.log(`🎵 Master pattern (stack): ${this.masterPattern.substring(0,150)}...`),console.log(`  📊 Parentheses: ${M} open, ${v} close, depth=${g}, balanced: ${g===0}`),g!==0)if(console.error(`  ⚠️ UNBALANCED PARENTHESES! Depth=${g}, fixing...`),console.log(`  🧾 Master pattern before fix:
`,this.masterPattern),g>0)this.masterPattern+=")".repeat(g),console.log(`  ✅ Added ${g} closing paren(s)`);else{const C=Math.abs(g);let E=0;for(let A=this.masterPattern.length-1;A>=0&&E<C;A--)this.masterPattern[A]===")"&&(this.masterPattern=this.masterPattern.substring(0,A)+this.masterPattern.substring(A+1),E++);console.log(`  ✅ Removed ${E} extra closing paren(s)`)}}if(this.masterPattern&&((r=window.__patternHistory)!=null&&r.saveMasterVersion))try{window.__patternHistory.saveMasterVersion(this.masterPattern)}catch(f){console.warn("⚠️ Unable to record master history entry:",f)}const d=this.masterPattern;if(d&&d.trim()!==""){let f=this.convertPatternForScale(d)||d;this.masterPattern=this.formatMasterPatternWithTempoComment(f)}return console.log(`🎛️ Applied global settings to master pattern (Key: ${this.currentKey||"none"}, Scale: ${this.currentScale||(this.currentKey?"derived":"none")}, Time Sig: ${this.currentTimeSignature||"none"}, Volume: ${this.formatNumberForPattern(this.masterVolume,4)}, Pan: ${this.formatNumberForPattern(this.masterPan,4)}, Tempo: ${this.currentTempo||120} BPM)`),this.onMasterPatternUpdateCallback&&this.onMasterPatternUpdateCallback(),{success:!0,pattern:this.masterPattern}}catch(a){return console.error("❌ Error updating master pattern:",a),{success:!1,error:a.message}}}setupVisualizerAnalyser(){var i,s;if(!this.audioContext||!window.strudel)return;const e="master-punchcard-canvas",t=((i=window.strudel)==null?void 0:i.getAnalyserById)||globalThis.getAnalyserById;if(!t||typeof t!="function"){console.warn("⚠️ getAnalyserById not available - visualizers may not work");return}try{let r=null;try{r=t(e,2048,.8),r&&r.context!==this.audioContext&&(console.warn("⚠️ Analyser from getAnalyserById is in different audio context, creating new one"),r=null)}catch(a){console.warn("⚠️ Could not get analyser from getAnalyserById:",a.message)}if(!r){r=this.audioContext.createAnalyser(),r.fftSize=2048,r.smoothingTimeConstant=.8;const a=t,o=r;window.strudel&&(window.strudel.analysers&&typeof window.strudel.analysers=="object"&&(window.strudel.analysers[e]=r,console.log(`✅ Stored analyser "${e}" in Strudel's analyser registry`)),window.strudel.getAnalyserById=function(l,c,u){return l===e?o:a(l,c,u)}),globalThis.getAnalyserById&&(globalThis.getAnalyserById=function(l,c,u){return l===e?o:a(l,c,u)}),globalThis.analysers||(globalThis.analysers={}),globalThis.analysers[e]=r,console.log(`✅ Created analyser "${e}" in our audio context and patched getAnalyserById`)}if(this.visualizerAnalyser=r,this.masterGainNode&&r){const a=this._realDestination||((s=this.audioContext)==null?void 0:s.destination);if(!a)console.warn("⚠️ Cannot connect analyser - destination unavailable");else try{if(!this.visualizerAnalyserTapGain&&this.audioContext&&(this.visualizerAnalyserTapGain=this.audioContext.createGain(),this.visualizerAnalyserTapGain.gain.value=0),this.visualizerAnalyserTapGain){try{this.visualizerAnalyserTapGain.disconnect()}catch{}this.visualizerAnalyserTapGain.connect(a)}try{r.disconnect()}catch{}try{this.masterGainNode.disconnect(r)}catch{}this.masterGainNode.connect(r),this.visualizerAnalyserTapGain&&r.connect(this.visualizerAnalyserTapGain),console.log(`✅ Connected visualizer analyser "${e}" with silent tap to destination`),setTimeout(()=>{try{const o=new Uint8Array(r.frequencyBinCount);r.getByteFrequencyData(o);const l=o.some(h=>h>0),c=Math.max(...o);console.log(`🔍 Analyser data check: hasData=${l}, maxValue=${c}, frequencyBinCount=${r.frequencyBinCount}`);const u=document.getElementById(e);u?console.log(`🔍 Canvas check: found canvas with ID "${e}", width=${u.width}, height=${u.height}`):console.warn(`⚠️ Canvas with ID "${e}" not found!`)}catch(o){console.warn("⚠️ Could not check analyser data:",o)}},500)}catch(o){console.warn(`⚠️ Failed to connect analyser "${e}":`,o.message)}}else console.warn(`⚠️ Cannot connect analyser - masterGainNode: ${!!this.masterGainNode}, analyser: ${!!r}`)}catch(r){console.warn("⚠️ Failed to setup visualizer analyser:",r)}}applyVisualizerTargetsToPattern(e){if(!e||typeof e!="string")return e;const i="master-punchcard-canvas",s="window.__strudelVisualizerCtx || (document.getElementById('master-punchcard-canvas') && document.getElementById('master-punchcard-canvas').getContext && document.getElementById('master-punchcard-canvas').getContext('2d'))",r=["spectrum","scope","tscope","fscope","visual","pianoroll","barchart"];let a=e;const o=new RegExp(`\\.\\s*_(${r.join("|")})\\s*\\(`,"gi");a=a.replace(o,(u,h)=>u.replace(`_${h}`,h));const l=["spectrum","scope","tscope","fscope"],c=["visual","barchart","pianoroll"];return l.forEach(u=>{const h=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(`\\.\\s*_?${h}\\s*\\(\\s*\\)`,"gi");a=a.replace(d,m=>m.replace(/\(\s*\)/,`({ id: '${i}' })`));const f=new RegExp(`\\.\\s*_?${h}\\s*\\(\\s*\\{([^}]*)\\}\\s*\\)`,"gi");a=a.replace(f,(m,g)=>{let y=g.trim();return/(^|,)\s*id\s*:/.test(y)||(y=y.length>0?`${y}, id: '${i}'`:`id: '${i}'`),m.replace(g,y)})}),c.forEach(u=>{const h=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(`\\.\\s*_?${h}\\s*\\(\\s*\\)`,"gi");a=a.replace(d,m=>m.replace(/\(\s*\)/,`({ id: '${i}', ctx: ${s} })`));const f=new RegExp(`\\.\\s*_?${h}\\s*\\(\\s*\\{([^}]*)\\}\\s*\\)`,"gi");a=a.replace(f,(m,g)=>{let y=g.trim();const b=/(^|,)\s*id\s*:/.test(y),P=/(^|,)\s*ctx\s*:/.test(y);return b||(y=y.length>0?`${y}, id: '${i}'`:`id: '${i}'`),P||(y=y.length>0?`${y}, ctx: ${s}`:`ctx: ${s}`),m.replace(g,y)})}),a!==e&&(console.log("🎨 Injected canvas ID into visualizer methods"),console.log(`   Before: ${e.substring(0,150)}...`),console.log(`   After: ${a.substring(0,150)}...`)),a}async _reEvaluateMasterPattern(e="manual"){if(!this.masterPattern||this.masterPattern.trim()==="")return console.log("⚠️ No master pattern to re-evaluate"),{success:!1,error:"No pattern to re-evaluate"};if(!window.strudel||typeof window.strudel.evaluate!="function")return{success:!1,error:"Strudel evaluate unavailable"};this._ensureMasterPatternSanitized();const t=this.masterSlot||"d0",i=`${t} = ${this.masterPattern.trim()}`;try{return console.log(`🔄 Re-evaluating master pattern (${e})...`),await window.strudel.evaluate(i),console.log(`✅ Master pattern re-evaluated (${e})`),{success:!0,slot:t}}catch(s){return console.error("❌ Failed to re-evaluate master pattern:",s),{success:!1,error:s.message}}}async _playMasterPatternSimple(){var i,s,r;if(!this.masterPattern||this.masterPattern.trim()==="")return console.log("⚠️ No master pattern to play (master-only mode)"),this.masterActive?await this._stopMasterPatternSimple():this.masterActive=!1,{success:!1,error:"No pattern to play"};if(await this.initialize(),this.strudelLoaded||await this.initStrudel(),this.masterGainNode){const a=((i=this.audioContext)==null?void 0:i.currentTime)||0;this.masterGainNode.gain.setValueAtTime(this.masterVolume,a)}if(this.masterPanNode&&this.masterPanNode.pan.setValueAtTime(this.masterPan,((s=this.audioContext)==null?void 0:s.currentTime)||0),!window.strudel||typeof window.strudel.evaluate!="function")return{success:!1,error:"Strudel evaluate unavailable"};this._ensureMasterPatternSanitized();const e=this.masterSlot||"d0",t=`${e} = ${this.masterPattern.trim()}`;try{return await window.strudel.evaluate(t),window.strudel.scheduler?window.strudel.scheduler.started||await window.strudel.scheduler.start():console.warn("⚠️ Strudel scheduler missing - cannot ensure playback"),this.masterActive=!0,this.masterPlaybackStartTime=((r=this.audioContext)==null?void 0:r.currentTime)||performance.now(),this.onMasterStateChangeCallback&&this.onMasterStateChangeCallback(!0,Array.from(this.trackedPatterns.keys())),{success:!0,slot:e}}catch(a){return console.error("❌ Failed to evaluate master pattern:",a),{success:!1,error:a.message}}}async playMasterPattern(){var e,t,i,s,r,a,o,l,c,u,h,d,f,m,g,y,b,P,M,v,C,E,A,B,Z,q,X,j,H,se,oe,Pe,Me,Be,Ke,Ct,yt,he,et,pe,Et,Ze,ve,Je,Pt,li,Bn,Lt,Sn,ot,an,ti,Vi,ms,zi,xs,ji,Zi,ui,zn;if(this.masterOnlyPlayback)return this._playMasterPatternSimple();try{if(console.log("▶️ Playing master pattern..."),this.masterActive=!0,console.log("🎚️ masterActive set to TRUE before pattern evaluation"),console.log("🔍 PRE-PLAY: Verifying audio routing hijacking is active..."),console.log("   AudioNode.prototype.__originalConnect exists:",!!AudioNode.prototype.__originalConnect),console.log("   AudioNode.prototype.connect is patched:",AudioNode.prototype.connect!==AudioNode.prototype.__originalConnect),console.log("   masterActive:",this.masterActive),console.log("   trackedPatterns.size:",this.trackedPatterns.size),console.log("   masterPanNode exists:",!!this.masterPanNode),console.log("   masterGainNode exists:",!!this.masterGainNode),this.masterGainNode&&this.masterGainNode.gain.setValueAtTime(this.masterVolume,((e=this.audioContext)==null?void 0:e.currentTime)||0),(!this.audioContext||this.audioContext.state==="suspended")&&await this.initialize(),this.strudelLoaded||(console.log("⏳ Waiting for Strudel to initialize..."),await this.initStrudel()),this._ensureMasterPatternSanitized(),this.setupVisualizerAnalyser(),!this.masterPattern||this.masterPattern.trim()==="")return console.log("⚠️ No master pattern to play"),this.masterActive=!1,{success:!1,error:"No pattern to play"};if(this.audioContext&&this.audioContext.state==="suspended"){console.log("🔊 Audio context suspended, resuming...");try{await this.audioContext.resume(),console.log(`✅ Audio context resumed, state: ${this.audioContext.state}`)}catch(Ae){console.warn("⚠️ Could not resume audio context:",Ae)}}if(window.strudel&&window.strudel.evaluate){let Ae=this.masterPattern.trim();if(!Ae||Ae==="")return console.error("❌ Master pattern is empty, cannot evaluate"),{success:!1,error:"Master pattern is empty"};console.log("🎼 Master pattern before processing:",Ae.substring(0,200)),Ae=Pu(Ae),Ae=this.applyVisualizerTargetsToPattern(Ae),console.log("🎼 Master pattern after visualizer injection:",Ae.substring(0,200)),await this.ensureStrudelWorkletsReady(Ae);const Ut=Ae.match(/\.bank\(["']([^"']+)["']\)/g);if(Ut&&typeof this.loadBank=="function"){const K=[...new Set(Ut.map(te=>{const Y=te.match(/\.bank\(["']([^"']+)["']\)/);return Y?Y[1]:null}).filter(Boolean))];for(const te of K)if(!this.loadedBanks.has(te))try{console.log(`🎚️ Master: ensuring bank "${te}" is loaded before playback`),await this.loadBank(te)?(this.loadedBanks.add(te),console.log(`✅ Master: bank "${te}" loaded`)):console.warn(`⚠️ Master: bank "${te}" could not be loaded (continuing anyway)`)}catch(Y){console.warn(`⚠️ Master: error loading bank "${te}":`,Y)}}await this.ensurePatternResourcesLoaded(Ae),Ae=Ae.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\n\s*\n/g,`
`).trim();const Le=Ae;Ae=Ae.replace(/[""]/g,'"').replace(/['']/g,"'"),Le!==Ae&&(console.log("🔧 Normalized quotes in master pattern"),console.log(`  Before: ${Le.substring(0,100)}...`),console.log(`  After:  ${Ae.substring(0,100)}...`)),!Ae.includes(".loop(")&&!Ae.includes(".loop()")&&(Ae=`${Ae}.loop()`,console.log("🔄 Added .loop() to master pattern for continuous playback")),this.masterActive=!0,console.log("🎚️ masterActive set to TRUE before pattern evaluation"),this._masterDestinationConnectLogged=!1,this._singleElementMasterRoutingLogged=!1,this._noElementRoutingLogged=!1,this._nodeTypeConnectLogged=new Set,this._stackMasterRoutingLogged=!1,this._masterRoutingLogged=!1,this._panNodeConnectedToMaster=new Set,this._gainConnectDebugged=!1,this._stackElementRoutingLogged=new Set,this._chainVerificationLogged=new Set,this._connectionSuccessLogged=new Set,this._allConnectionsLogged=new Set,this._allDestConnectionsLogged=new Set,this._panNodeConnectedLogged=new Set,this._panNodeNotConnectedLogged=new Set,this._panNodeConnectionErrorLogged=new Set,this._masterGainDestVerifiedAfterRouting=new Set,this._masterGainDestVerified=!1,this._stackConnectionCount&&this._stackConnectionCount.set("total",0);const bt=this.masterSlot;this.currentEvaluatingSlot=bt,console.log(`🎚️ Master stack evaluation slot: ${bt}`),console.log(`🔧 Ensuring audio nodes exist for ${this.trackedPatterns.size} tracked elements...`);for(const[K]of this.trackedPatterns.entries()){const te=this.getElementAudioNodes(K);if(te){const Y=this.elementGainValues.get(K)||.8;te.gainNode.gain.value=Y*this.volume;let de=[];de.push(`gainNode: gain=${te.gainNode.gain.value.toFixed(3)}`),de.push(`panNode: pan=${te.panNode.pan.value.toFixed(3)}`),console.log(`  ✅ ${K}: ${de.join(", ")}`)}else console.warn(`  ⚠️ ${K}: Failed to create audio nodes`)}if(this.visualizerAnalyser&&this.masterGainNode){try{this.masterGainNode.disconnect(this.visualizerAnalyser)}catch{}try{this.masterGainNode.connect(this.visualizerAnalyser),console.log("✅ Reconnected visualizer analyser to master gain node")}catch(K){console.warn("⚠️ Could not reconnect visualizer analyser:",K)}}if(window.strudel&&window.strudel.scheduler&&!window.strudel.scheduler.started){console.log("▶️ Starting Strudel scheduler BEFORE pattern evaluation..."),await window.strudel.scheduler.start(),console.log("✅ Strudel scheduler started");const K=window.strudel.scheduler;console.log("🔍 POST-START: Checking scheduler for webaudio output..."),console.log(`   scheduler keys: ${Object.keys(K).slice(0,15).join(", ")}`);let te=K.webaudio||K._webaudio;if(!te&&window.strudel.webaudio&&(te=window.strudel.webaudio,console.log("   ✅ Found webaudio in window.strudel.webaudio")),te){console.log(`   ✅ Found webaudio, keys: ${Object.keys(te).slice(0,10).join(", ")}`);const Y=te.output||te.outputNode;if(Y){if(console.log(`   ✅ Found output node: ${Y.constructor.name}`),this.trackedPatterns.size>0){const de=Array.from(this.trackedPatterns.keys())[0],p=this.getElementAudioNodes(de);if(p!=null&&p.gainNode)try{Y.disconnect(),Y.connect(p.gainNode),console.log(`   ✅ Routed webaudio output to ${de} gainNode`)}catch(w){console.log(`   ✅ webaudio output already routed (${w.message})`)}}else if(this.masterPanNode)try{Y.disconnect(),Y.connect(this.masterPanNode),console.log("   ✅ Routed webaudio output to masterPanNode (fallback)")}catch(de){console.log(`   ✅ webaudio output already routed to master (${de.message})`)}}else console.log("   ⚠️ webaudio found but no output node")}else console.log("   ⚠️ No webaudio found in scheduler or window.strudel");if(K.superdough){const Y=K.superdough;console.log(`   ✅ Found superdough, keys: ${Object.keys(Y).slice(0,20).join(", ")}`),Y.audioContext&&(console.log(`   🔍 superdough.audioContext: ${Y.audioContext===this.audioContext?"OUR CONTEXT ✅":"DIFFERENT CONTEXT ⚠️"}`),console.log(`   🔍 superdough.audioContext.state: ${Y.audioContext.state}`));const de=["output","outputNode","_output","destination","_destination","gain","masterGain"];for(const p of de)if(Y[p]&&Y[p]instanceof AudioNode){if(console.log(`   ✅ Found AudioNode at superdough.${p}: ${Y[p].constructor.name}`),this.trackedPatterns.size>0){const w=Array.from(this.trackedPatterns.keys())[0],S=this.getElementAudioNodes(w);if(S!=null&&S.gainNode)try{Y[p].disconnect(),Y[p].connect(S.gainNode),console.log(`   ✅ Routed superdough.${p} to ${w} gainNode`)}catch(x){console.log(`   ✅ superdough.${p} already routed (${x.message})`)}}else if(this.masterPanNode)try{Y[p].disconnect(),Y[p].connect(this.masterPanNode),console.log(`   ✅ Routed superdough.${p} to masterPanNode`)}catch(w){console.log(`   ✅ superdough.${p} already routed to master (${w.message})`)}}}}else if(window.strudel&&window.strudel.scheduler&&window.strudel.scheduler.started){console.log("✅ Strudel scheduler already running");const K=window.strudel.scheduler;console.log("🔍 ALREADY-RUNNING: Checking scheduler for webaudio output..."),console.log(`   scheduler keys: ${Object.keys(K).slice(0,15).join(", ")}`);const te=K.webaudio||K._webaudio;if(te){console.log(`   ✅ Found webaudio, keys: ${Object.keys(te).slice(0,10).join(", ")}`);const Y=te.output||te.outputNode;if(Y){if(console.log(`   ✅ Found output node: ${Y.constructor.name}`),this.trackedPatterns.size>0){const de=Array.from(this.trackedPatterns.keys())[0],p=this.getElementAudioNodes(de);if(p!=null&&p.gainNode)try{Y.disconnect(),Y.connect(p.gainNode),console.log(`   ✅ Routed webaudio output to ${de} gainNode`)}catch(w){console.log(`   ✅ webaudio output already routed (${w.message})`)}}else if(this.masterPanNode)try{Y.disconnect(),Y.connect(this.masterPanNode),console.log("   ✅ Routed webaudio output to masterPanNode (fallback)")}catch(de){console.log(`   ✅ webaudio output already routed to master (${de.message})`)}}else console.log("   ⚠️ webaudio found but no output node")}else console.log("   ⚠️ No webaudio found in scheduler");if(K.superdough){const Y=K.superdough;console.log(`   ✅ Found superdough, keys: ${Object.keys(Y).slice(0,20).join(", ")}`),Y.audioContext&&(console.log(`   🔍 superdough.audioContext: ${Y.audioContext===this.audioContext?"OUR CONTEXT ✅":"DIFFERENT CONTEXT ⚠️"}`),console.log(`   🔍 superdough.audioContext.state: ${Y.audioContext.state}`));const de=["output","outputNode","_output","destination","_destination","gain","masterGain"];for(const p of de)if(Y[p]&&Y[p]instanceof AudioNode){if(console.log(`   ✅ Found AudioNode at superdough.${p}: ${Y[p].constructor.name}`),this.trackedPatterns.size>0){const w=Array.from(this.trackedPatterns.keys())[0],S=this.getElementAudioNodes(w);if(S!=null&&S.gainNode)try{Y[p].disconnect(),Y[p].connect(S.gainNode),console.log(`   ✅ Routed superdough.${p} to ${w} gainNode`)}catch(x){console.log(`   ✅ superdough.${p} already routed (${x.message})`)}}else if(this.masterPanNode)try{Y[p].disconnect(),Y[p].connect(this.masterPanNode),console.log(`   ✅ Routed superdough.${p} to masterPanNode`)}catch(w){console.log(`   ✅ superdough.${p} already routed to master (${w.message})`)}}}else console.log("   ⚠️ No superdough found in scheduler")}const tt=`${bt} = ${Ae}`;console.log("🎼 Evaluating master pattern:"),console.log(`   Full code: ${tt}`),console.log(`   Code length: ${tt.length} characters`),console.log(`   Evaluation slot: ${bt}`);const ni=((t=window.strudel)==null?void 0:t.repl)||window.strudel;if((i=ni==null?void 0:ni.scheduler)!=null&&i.superdough){const K=ni.scheduler.superdough;if(K.audioWorkletsLoaded===!1||K.audioWorkletsLoaded===void 0){console.log("⏳ Waiting for AudioWorklets to load...");let te=0;for(;(K.audioWorkletsLoaded===!1||K.audioWorkletsLoaded===void 0)&&te<50;)await new Promise(Y=>setTimeout(Y,100)),te++;K.audioWorkletsLoaded===!0?console.log(`✅ AudioWorklets loaded after ${te*100}ms`):console.warn(`⚠️ AudioWorklets may not be loaded after ${te*100}ms - proceeding anyway`)}else console.log("✅ AudioWorklets already loaded")}const Es=/\.scope\s*\(/.test(tt),wn=/\.spectrum\s*\(/.test(tt),ci=/\.spiral\s*\(/.test(tt),jn=/\._?pianoroll\s*\(/.test(tt),$t=/\._?barchart\s*\(/.test(tt);if(Es||wn||ci||jn||$t){console.log(`   📊 Visualizer methods detected: scope=${Es}, spectrum=${wn}, spiral=${ci}, pianoroll=${jn}, barchart=${$t}`);const K=/master-punchcard-canvas/.test(tt);console.log(`   🎯 Canvas ID present in pattern: ${K}`);const te=tt.match(/\.scope\([^)]*\)/),Y=tt.match(/\.spectrum\([^)]*\)/),de=tt.match(/\.spiral\([^)]*\)/),p=tt.match(/\._?pianoroll\([^)]*\)/),w=tt.match(/\._?barchart\([^)]*\)/);te&&console.log(`   📊 Scope call: ${te[0]}`),Y&&console.log(`   📊 Spectrum call: ${Y[0]}`),de&&console.log(`   📊 Spiral call: ${de[0]}`),p&&console.log(`   📊 Pianoroll call: ${p[0]}`),w&&console.log(`   📊 Barchart call: ${w[0]}`)}let Gi;try{Gi=await window.strudel.evaluate(tt),console.log(`✅ Master pattern evaluated successfully, result type: ${typeof Gi}`)}catch(K){console.warn("⚠️ Pattern evaluation warning:",K.message),console.warn(`⚠️ Pattern code that failed: ${tt.substring(0,300)}`)}try{const K=(s=window.strudel)==null?void 0:s.scheduler,te=globalThis==null?void 0:globalThis[bt];if(K&&te){console.log("🔍 PRE-PATTERN-SET: Checking scheduler state..."),console.log(`   scheduler.started: ${K.started}`),console.log(`   scheduler.pattern: ${K.pattern?"exists":"null"}`),console.log(`   scheduler keys before: ${Object.keys(K).slice(0,15).join(", ")}`);const Y=["webaudio","_webaudio","superdough","_superdough","output","outputNode","audioContext"];for(const de of Y)K[de]&&(console.log(`   ✅ Found ${de} in scheduler: ${typeof K[de]}`),K[de]instanceof AudioNode&&console.log(`      → AudioNode: ${K[de].constructor.name}`));try{K.pattern=te,console.log(`🎚️ Scheduler pattern set directly to ${bt}`),console.log("🔍 POST-PATTERN-SET: Checking scheduler state after pattern assignment..."),console.log(`   scheduler.pattern: ${K.pattern?"exists":"null"}`),await new Promise(de=>setTimeout(de,100));for(const de of Y)if(K[de]&&!K[`_checked_${de}`]){if(console.log(`   ✅ Found ${de} after pattern set: ${typeof K[de]}`),K[de]instanceof AudioNode&&(console.log(`      → AudioNode: ${K[de].constructor.name}`),this.trackedPatterns.size>0)){const p=Array.from(this.trackedPatterns.keys())[0],w=this.getElementAudioNodes(p);if(w!=null&&w.gainNode)try{K[de].disconnect(),K[de].connect(w.gainNode),console.log(`      ✅ Routed scheduler.${de} to ${p} gainNode`)}catch(S){console.log(`      ✅ scheduler.${de} already routed (${S.message})`)}}K[`_checked_${de}`]=!0}}catch{await window.strudel.evaluate(`pattern = ${bt}`),console.log(`🎚️ Scheduler pattern set via REPL to ${bt}`)}}else console.log("ℹ️ Could not set scheduler pattern directly (scheduler/slot missing)")}catch(K){console.warn(`⚠️ Failed to set scheduler pattern to ${bt}:`,(K==null?void 0:K.message)||K)}console.log(`🔍 POST-EVALUATION: trackedPatterns.size=${this.trackedPatterns.size}`),console.log("🔍 POST-EVALUATION: Searching for audio nodes connected to destination...");try{if(this._realDestination&&this._realDestination._inputs){const K=this._realDestination._inputs;console.log(`   Found ${K.length} input(s) to destination`);for(let te=0;te<K.length;te++){const Y=K[te];if(Y&&Y._node){const de=Y._node;if(console.log(`   Input ${te}: ${de.constructor.name}`),this.trackedPatterns.size>0){const p=Array.from(this.trackedPatterns.keys())[0],w=this.getElementAudioNodes(p);if(w!=null&&w.gainNode)try{de.disconnect(this._realDestination),de.connect(w.gainNode),console.log(`   ✅ Rerouted ${de.constructor.name} through ${p} gainNode`)}catch(S){console.log(`   ⚠️ Could not reroute ${de.constructor.name}: ${S.message}`)}}}}}else console.log("   ⚠️ Cannot access destination inputs (might be browser-specific)")}catch(K){console.log(`   ⚠️ Error checking destination inputs: ${K.message}`)}if(console.log(`🔍 POST-EVALUATION: Audio context state=${((r=this.audioContext)==null?void 0:r.state)||"unknown"}`),console.log(`🔍 POST-EVALUATION: masterGainNode.gain=${((l=(o=(a=this.masterGainNode)==null?void 0:a.gain)==null?void 0:o.value)==null?void 0:l.toFixed(3))||"N/A"}, muted=${this.masterMuted}`),console.log(`🔍 POST-EVALUATION: masterVolume=${this.masterVolume}, volume=${this.volume}`),this.trackedPatterns.size>=1){const K=Array.from(this.trackedPatterns.keys());console.log(`🔍 POST-EVALUATION: elementIds=${K.join(", ")}`);for(const te of K){const Y=this.elementGainValues.get(te)||.8,de=this.getElementAudioNodes(te),p=((u=(c=de==null?void 0:de.gainNode)==null?void 0:c.gain)==null?void 0:u.value)||0;console.log(`🔍 POST-EVALUATION: ${te} - storedGain=${Y.toFixed(3)}, actualGain=${p.toFixed(3)}, volume=${this.volume.toFixed(3)}, totalGain=${(p*((d=(h=this.masterGainNode)==null?void 0:h.gain)==null?void 0:d.value)||0).toFixed(3)}`)}try{const te=((f=window.strudel)==null?void 0:f.repl)||window.strudel;if(te!=null&&te.scheduler){const Y=te.scheduler;console.log("🔍 POST-EVALUATION: Exploring scheduler object..."),console.log(`   scheduler keys: ${Object.keys(Y).slice(0,20).join(", ")}`);let de=Y.webaudio||Y._webaudio,p=null;if(de)p=de.output||de.outputNode,console.log(`🔍 POST-EVALUATION: Found webaudio, outputNode=${p?p.constructor.name:"null"}`);else{console.log("🔍 POST-EVALUATION: webaudio not found, searching scheduler for output node...");for(const w of Object.keys(Y)){const S=Y[w];if(S&&typeof S=="object"){if(S.output&&S.output instanceof AudioNode){console.log(`🔍 POST-EVALUATION: Found output node in scheduler.${w}.output`),p=S.output;break}if(S.outputNode&&S.outputNode instanceof AudioNode){console.log(`🔍 POST-EVALUATION: Found output node in scheduler.${w}.outputNode`),p=S.outputNode;break}}}}console.log(`🎚️ 🔍 POST-EVALUATION: Final outputNode=${p?p.constructor.name:"null"}`);for(const w of K){const S=this.getElementAudioNodes(w);if(console.log(`🎚️ 🔍 POST-EVALUATION: ${w}: elementNodes=${!!S}, gainNode=${!!(S!=null&&S.gainNode)}`),S&&S.gainNode){if(p)try{p.disconnect(),p.connect(S.gainNode),console.log(`🎚️ ✅ POST-EVALUATION: Reconnected Strudel output -> ${w} gainNode`)}catch(N){console.warn(`⚠️ POST-EVALUATION: Could not reconnect Strudel output: ${N.message}`)}else console.warn("⚠️ POST-EVALUATION: Output node not found - audio may not route through element chain");const x=S.panNode;if(x&&this.masterPanNode)try{try{x.disconnect(this.masterPanNode)}catch{}x.connect(this.masterPanNode),console.log(`🎚️ ✅ POST-EVALUATION: Verified ${w} panNode -> masterPanNode`)}catch(N){console.warn(`⚠️ POST-EVALUATION: Could not verify panNode: ${N.message}`)}}}if(this.masterGainNode&&this._realDestination)try{this.masterGainNode.connect(this._realDestination),console.log(`🎚️ ✅ POST-EVALUATION: Verified masterGainNode -> destination (gain=${this.masterGainNode.gain.value.toFixed(3)}, muted=${this.masterMuted})`)}catch(w){w.message.includes("already connected")||w.message.includes("already been connected")?console.log(`🎚️ ✅ POST-EVALUATION: masterGainNode -> destination already connected (gain=${this.masterGainNode.gain.value.toFixed(3)}, muted=${this.masterMuted})`):console.warn(`⚠️ POST-EVALUATION: Could not verify masterGainNode -> destination: ${w.message}`)}}else console.warn("⚠️ POST-EVALUATION: Could not find scheduler")}catch(te){console.warn(`⚠️ POST-EVALUATION: Error reconnecting Strudel output: ${te.message}`)}}if(setTimeout(()=>{this.currentEvaluatingSlot===this.masterSlot&&(this.currentEvaluatingSlot=null)},this.soundsPreloaded?100:500),this.trackedPatterns.size===1){const K=Array.from(this.trackedPatterns.keys())[0],te=this.getElementAudioNodes(K);console.log(`🔍 AUDIO CHAIN VERIFICATION for ${K}:`),console.log("   📊 AUDIO ROUTING CHAIN (simplified, no masterAnalyser):"),console.log(`      1. Strudel output -> elementGainNode (gain=${((y=(g=(m=te==null?void 0:te.gainNode)==null?void 0:m.gain)==null?void 0:g.value)==null?void 0:y.toFixed(3))||"N/A"})`),console.log(`      2. elementGainNode -> elementPanNode (pan=${((M=(P=(b=te==null?void 0:te.panNode)==null?void 0:b.pan)==null?void 0:P.value)==null?void 0:M.toFixed(3))||"N/A"})`),console.log("      3. elementPanNode -> masterPanNode"),console.log(`      4. masterPanNode -> masterGainNode (gain=${((E=(C=(v=this.masterGainNode)==null?void 0:v.gain)==null?void 0:C.value)==null?void 0:E.toFixed(3))||"N/A"}, muted=${this.masterMuted})`),console.log("      5. masterGainNode -> destination (audio output)"),console.log("      6. masterGainNode -> visualizerAnalyser (parallel, for visualization)"),console.log("   ✅ SIMPLIFIED CHAIN: element gain -> element pan -> master pan -> master gain -> destination"),console.log(`   elementGainNode: ${te!=null&&te.gainNode?"EXISTS":"MISSING"} (gain=${((Z=(B=(A=te==null?void 0:te.gainNode)==null?void 0:A.gain)==null?void 0:B.value)==null?void 0:Z.toFixed(3))||"N/A"})`),console.log(`   elementPanNode: ${te!=null&&te.panNode?"EXISTS":"MISSING"} (pan=${((j=(X=(q=te==null?void 0:te.panNode)==null?void 0:q.pan)==null?void 0:X.value)==null?void 0:j.toFixed(3))||"N/A"})`),console.log(`   masterPanNode: ${this.masterPanNode?"EXISTS":"MISSING"}`),console.log(`   masterGainNode: ${this.masterGainNode?"EXISTS":"MISSING"} (gain=${((oe=(se=(H=this.masterGainNode)==null?void 0:H.gain)==null?void 0:se.value)==null?void 0:oe.toFixed(3))||"N/A"}, muted=${this.masterMuted})`),console.log(`   visualizerAnalyser: ${this.visualizerAnalyser?"EXISTS":"MISSING"}`),console.log(`   destination: ${this._realDestination?"EXISTS":"MISSING"}`),console.log(`   TOTAL GAIN: ${((((Me=(Pe=te==null?void 0:te.gainNode)==null?void 0:Pe.gain)==null?void 0:Me.value)||0)*(((Ke=(Be=this.masterGainNode)==null?void 0:Be.gain)==null?void 0:Ke.value)||0)).toFixed(3)} (element=${((he=(yt=(Ct=te==null?void 0:te.gainNode)==null?void 0:Ct.gain)==null?void 0:yt.value)==null?void 0:he.toFixed(3))||"0"} * master=${((Et=(pe=(et=this.masterGainNode)==null?void 0:et.gain)==null?void 0:pe.value)==null?void 0:Et.toFixed(3))||"0"})`);try{const Y=((Ze=window.strudel)==null?void 0:Ze.repl)||window.strudel;if(Y!=null&&Y.scheduler){const de=Y.scheduler,p=de.webaudio||de._webaudio;if(p){const w=p.output||p.outputNode;w?(console.log(`   Strudel outputNode: EXISTS (${w.constructor.name})`),te!=null&&te.gainNode&&console.log("   ✅ Chain should be: Strudel output -> elementGain -> elementPan -> masterPan -> masterGain -> destination")):console.warn("   ⚠️ Strudel outputNode: NOT FOUND")}else console.warn("   ⚠️ Strudel webaudio: NOT FOUND")}}catch(Y){console.warn(`   ⚠️ Could not verify Strudel output: ${Y.message}`)}if(console.log("   🔍 VERIFYING MASTER CHAIN:"),console.log(`      masterPanNode: ${this.masterPanNode?"EXISTS":"MISSING"}`),console.log(`      masterGainNode: ${this.masterGainNode?"EXISTS":"MISSING"} (gain=${((Pt=(Je=(ve=this.masterGainNode)==null?void 0:ve.gain)==null?void 0:Je.value)==null?void 0:Pt.toFixed(3))||"N/A"})`),console.log(`      destination: ${this._realDestination?"EXISTS":"MISSING"}`),this.masterPanNode&&this.masterGainNode)try{this.masterPanNode.connect(this.masterGainNode),console.log("   ✅ VERIFIED: masterPanNode -> masterGainNode")}catch(Y){Y.message.includes("already connected")||Y.message.includes("already been connected")?console.log("   ✅ VERIFIED: masterPanNode -> masterGainNode (already connected)"):console.warn(`   ⚠️ Could not verify masterPanNode -> masterGainNode: ${Y.message}`)}if(this.masterGainNode&&this._realDestination)try{this.masterGainNode.connect(this._realDestination),console.log("   ✅ CONNECTED: masterGainNode -> destination (CRITICAL for audio output)")}catch(Y){if(Y.message&&Y.message.includes("already connected")||Y.message.includes("InvalidStateError"))console.log("   ✅ VERIFIED: masterGainNode -> destination (already connected)");else try{this.masterGainNode.connect(this._realDestination),console.log("   ✅ RECONNECTED: masterGainNode -> destination")}catch(de){de.message.includes("already connected")||de.message.includes("already been connected")?console.log("   ✅ VERIFIED: masterGainNode -> destination (already connected)"):console.error(`   ❌ FAILED: Could not connect masterGainNode -> destination: ${de.message}`)}}else console.warn(`   ⚠️ Cannot verify masterGainNode->destination: masterGainNode=${!!this.masterGainNode}, destination=${!!this._realDestination}`)}if(console.log("🔍 FINAL CHAIN VERIFICATION:"),this.trackedPatterns.size>0){const K=Array.from(this.trackedPatterns.keys());for(const te of K){const Y=this.getElementAudioNodes(te);console.log(`   ${te}:`),console.log(`      elementGain: ${Y!=null&&Y.gainNode?"EXISTS":"MISSING"} (gain=${((Lt=(Bn=(li=Y==null?void 0:Y.gainNode)==null?void 0:li.gain)==null?void 0:Bn.value)==null?void 0:Lt.toFixed(3))||"N/A"})`),console.log(`      elementPan: ${Y!=null&&Y.panNode?"EXISTS":"MISSING"} (pan=${((an=(ot=(Sn=Y==null?void 0:Y.panNode)==null?void 0:Sn.pan)==null?void 0:ot.value)==null?void 0:an.toFixed(3))||"N/A"})`)}}if(console.log(`   masterPanNode: ${this.masterPanNode?"EXISTS":"MISSING"}`),console.log(`   masterGainNode: ${this.masterGainNode?"EXISTS":"MISSING"} (gain=${((ms=(Vi=(ti=this.masterGainNode)==null?void 0:ti.gain)==null?void 0:Vi.value)==null?void 0:ms.toFixed(3))||"N/A"}, muted=${this.masterMuted})`),console.log(`   visualizerAnalyser: ${this.visualizerAnalyser?"EXISTS":"MISSING"}`),console.log(`   destination: ${this._realDestination?"EXISTS":"MISSING"}`),this.masterPanNode&&this.masterGainNode)try{this.masterPanNode.connect(this.masterGainNode),console.log("   ✅ VERIFIED: masterPanNode -> masterGainNode (reconnected)")}catch(K){K.message.includes("already connected")||K.message.includes("already been connected")?console.log("   ✅ VERIFIED: masterPanNode -> masterGainNode (already connected)"):console.warn(`   ⚠️ Could not verify masterPanNode -> masterGainNode: ${K.message}`)}if(this.masterGainNode&&this._realDestination)try{this.masterGainNode.connect(this._realDestination),console.log(`   ✅ VERIFIED: masterGainNode -> destination (reconnected, gain=${this.masterGainNode.gain.value.toFixed(3)})`)}catch(K){K.message.includes("already connected")||K.message.includes("already been connected")?console.log(`   ✅ VERIFIED: masterGainNode -> destination (already connected, gain=${this.masterGainNode.gain.value.toFixed(3)})`):console.warn(`   ⚠️ Could not verify masterGainNode -> destination: ${K.message}`)}console.log("   🔍 FINAL: Searching for Strudel output node...");try{const K=((zi=window.strudel)==null?void 0:zi.repl)||window.strudel;if(console.log(`   🔍 FINAL: replInstance=${!!K}`),K!=null&&K.scheduler){const te=K.scheduler;console.log(`   🔍 FINAL: scheduler=${!!te}, keys=${Object.keys(te).slice(0,10).join(", ")}`);let Y=null,de=null;const p=te.webaudio||te._webaudio;if(p&&(Y=p.output||p.outputNode,Y&&(de="scheduler.webaudio")),!Y&&te.superdough){const w=te.superdough;if(console.log(`   🔍 FINAL: superdough found, keys=${Object.keys(w).slice(0,20).join(", ")}`),Y=w.output||w.outputNode||w._output||w.destination||w._destination,Y&&(de="scheduler.superdough"),!Y&&w.webaudio&&(console.log(`   🔍 FINAL: superdough.webaudio found, keys=${Object.keys(w.webaudio).slice(0,10).join(", ")}`),Y=w.webaudio.output||w.webaudio.outputNode||w.webaudio.destination,Y&&(de="scheduler.superdough.webaudio")),!Y&&w.audioContext&&console.log("   🔍 FINAL: superdough.audioContext found"),!Y)for(const S of Object.keys(w)){const x=w[S];if(x&&typeof x=="object"&&(((xs=x.constructor)==null?void 0:xs.name)==="GainNode"||((ji=x.constructor)==null?void 0:ji.name)==="AudioNode"||x instanceof AudioNode)){console.log(`   🔍 FINAL: Found potential output node at superdough.${S} (${x.constructor.name})`),Y=x,de=`scheduler.superdough.${S}`;break}}}if(!Y&&te._superdough){const w=te._superdough;Y=w.output||w.outputNode||w._output,Y&&(de="scheduler._superdough")}if(console.log(`   🔍 FINAL: outputNode=${Y?Y.constructor.name:"null"}, source=${de||"not found"}`),Y&&this.trackedPatterns.size>0){const w=Array.from(this.trackedPatterns.keys())[0],S=this.getElementAudioNodes(w);if(console.log(`   🔍 FINAL: ${w}, elementNodes=${!!S}, gainNode=${!!(S!=null&&S.gainNode)}`),S!=null&&S.gainNode)try{Y.disconnect(),Y.connect(S.gainNode),console.log(`   ✅ FINAL: Reconnected Strudel output (${de}) -> ${w} gainNode (THIS IS CRITICAL FOR AUDIO)`)}catch(x){console.log(`   ✅ FINAL: Strudel output already routed to ${w} gainNode (${x.message})`)}else console.error("   ❌ FINAL: Cannot reconnect - elementNodes or gainNode missing!")}else if(console.warn(`   ⚠️ FINAL: Cannot reconnect - outputNode=${!!Y}, trackedPatterns.size=${this.trackedPatterns.size}`),!Y&&(console.warn("   ⚠️ FINAL: Strudel output node not found in any expected location."),console.warn("   ⚠️ FINAL: This might mean Strudel creates audio nodes dynamically. Audio routing hijacking should catch connections."),console.warn('   ⚠️ FINAL: If you see "DESTINATION CONNECTION" logs, the hijacking is working. If not, Strudel might be using a different routing mechanism.'),console.log("   🔧 FINAL: Ensuring master chain is connected (fallback for dynamic audio nodes)..."),this.masterPanNode&&this.masterGainNode&&this._realDestination))try{this.masterGainNode.connect(this._realDestination),console.log(`   ✅ FINAL: Master chain verified and connected (gain=${this.masterGainNode.gain.value.toFixed(3)})`)}catch(w){console.log(`   ✅ FINAL: Master chain already connected (${w.message})`)}}else console.warn("   ⚠️ FINAL: scheduler not found in replInstance")}catch(K){console.error(`   ❌ FINAL: Error reconnecting Strudel output: ${K.message}`),console.error(`   ❌ FINAL: Stack: ${K.stack}`)}const ks=this.audioContext?this.audioContext.currentTime:performance.now()/1e3;this.masterPlaybackStartTime=ks,this.masterPlaybackTempo=this.currentTempo||120;const wt=this.masterPlaybackTempo/120;this.masterPlaybackSpeed=Number.isFinite(wt)&&wt>0?wt:1,console.log(`✅ Master pattern playing on ${this.masterSlot} (volume/pan/mute via Web Audio API)`),console.log(`🔊 Audio context state: ${((Zi=this.audioContext)==null?void 0:Zi.state)||"unknown"}`),console.log(`🔊 Master gain value: ${((zn=(ui=this.masterGainNode)==null?void 0:ui.gain)==null?void 0:zn.value)||"unknown"}`),console.log(`🔊 Master muted: ${this.masterMuted||!1}`),console.log("ℹ️ Note: If you see createPeriodicWave errors, they are suppressed but may affect audio playback"),this._audioNodeMonitorInterval&&clearInterval(this._audioNodeMonitorInterval);let dt=0;const Kt=20;return this._audioNodeMonitorInterval=setInterval(()=>{var K;if(dt++,dt>Kt){clearInterval(this._audioNodeMonitorInterval),this._audioNodeMonitorInterval=null,console.log(`🔍 Audio node monitoring stopped after ${Kt} checks`);return}try{const te=(K=window.strudel)==null?void 0:K.scheduler;if(te){const Y=["webaudio","_webaudio","superdough","_superdough","output","outputNode"];for(const de of Y)if(te[de]&&!te[`_monitored_${de}`]){if(console.log(`🔍 MONITOR: Found ${de} in scheduler at check ${dt}: ${typeof te[de]}`),te[de]instanceof AudioNode&&(console.log(`   → AudioNode: ${te[de].constructor.name}`),this.trackedPatterns.size>0)){const p=Array.from(this.trackedPatterns.keys())[0],w=this.getElementAudioNodes(p);if(w!=null&&w.gainNode)try{te[de].disconnect(),te[de].connect(w.gainNode),console.log(`   ✅ MONITOR: Routed scheduler.${de} to ${p} gainNode`)}catch(S){console.log(`   ✅ MONITOR: scheduler.${de} already routed (${S.message})`)}}te[`_monitored_${de}`]=!0}if(te.superdough&&!te._monitored_superdough){const de=te.superdough;console.log(`🔍 MONITOR: Found superdough at check ${dt}, keys: ${Object.keys(de).slice(0,10).join(", ")}`);const p=["output","outputNode","_output","destination","_destination","gain","masterGain"];for(const w of p)if(de[w]&&de[w]instanceof AudioNode&&(console.log(`   → Found AudioNode at superdough.${w}: ${de[w].constructor.name}`),this.trackedPatterns.size>0)){const S=Array.from(this.trackedPatterns.keys())[0],x=this.getElementAudioNodes(S);if(x!=null&&x.gainNode)try{de[w].disconnect(),de[w].connect(x.gainNode),console.log(`   ✅ MONITOR: Routed superdough.${w} to ${S} gainNode`)}catch(N){console.log(`   ✅ MONITOR: superdough.${w} already routed (${N.message})`)}}te._monitored_superdough=!0}}}catch(te){console.warn(`🔍 MONITOR: Error checking scheduler: ${te.message}`)}},100),this.audioContext&&this.audioContext.state==="suspended"&&(console.warn("⚠️ AUDIO CONTEXT SUSPENDED: Audio context is suspended - attempting to resume..."),this.audioContext.resume().then(()=>{console.log("✅ Audio context resumed successfully")}).catch(K=>{console.error(`❌ Failed to resume audio context: ${K.message}`)})),this._audioChainCheckInterval&&clearInterval(this._audioChainCheckInterval),this._zeroGainLogged=!1,this._mutedLogged=!1,this._audioChainCheckInterval=setInterval(()=>{if(this.masterActive&&this.masterGainNode&&this._realDestination){try{this.masterGainNode.connect(this._realDestination)}catch{}this.masterGainNode.gain.value===0&&!this._zeroGainLogged&&(console.warn("⚠️ AUDIO CHAIN CHECK: masterGainNode.gain.value is 0 - no audio will play!"),this._zeroGainLogged=!0),this.masterMuted&&!this._mutedLogged&&(console.warn("⚠️ AUDIO CHAIN CHECK: masterGainNode is muted - no audio will play!"),this._mutedLogged=!0)}else this._audioChainCheckInterval&&(clearInterval(this._audioChainCheckInterval),this._audioChainCheckInterval=null)},1e3),this.onMasterStateChangeCallback&&this.onMasterStateChangeCallback(!0,Array.from(this.trackedPatterns.keys())),{success:!0}}else return console.error("❌ Strudel not properly initialized"),{success:!1,error:"Strudel not initialized"}}catch(Ae){return console.error("❌ Error playing master pattern:",Ae),{success:!1,error:Ae.message}}}async _stopMasterPatternSimple(){var e;try{if(window.strudel&&typeof window.strudel.evaluate=="function"){const t=this.masterSlot||"d0";await window.strudel.evaluate(`${t} = silence`),window.strudel.scheduler&&window.strudel.scheduler.started&&typeof window.strudel.scheduler.stop=="function"&&await window.strudel.scheduler.stop()}return this.masterActive=!1,this.masterPlaybackStartTime=null,this.masterGainNode&&this.masterGainNode.gain.setValueAtTime(0,((e=this.audioContext)==null?void 0:e.currentTime)||0),this.onMasterStateChangeCallback&&this.onMasterStateChangeCallback(!1,[]),{success:!0}}catch(t){return console.error("❌ Error stopping master (simple mode):",t),{success:!1,error:t.message}}}async stopMasterPattern(){var e;if(this.masterOnlyPlayback)return this._stopMasterPatternSimple();try{if(console.log("⏹️ Stopping master pattern..."),window.strudel&&window.strudel.evaluate){window.strudel.repl&&window.strudel.repl.scheduler&&typeof window.strudel.repl.scheduler.stop=="function"&&(window.strudel.repl.scheduler.stop(),console.log("✓ Stopped REPL scheduler"));const t=`${this.masterSlot} = silence`;return await window.strudel.evaluate(t),window.strudel.repl&&window.strudel.repl.scheduler&&typeof window.strudel.repl.scheduler.start=="function"&&(window.strudel.repl.scheduler.start(),console.log("✓ Restarted REPL scheduler")),this.masterPlaybackStartTime=null,this.masterActive=!1,this.masterGainNode&&this.masterGainNode.gain.setValueAtTime(0,((e=this.audioContext)==null?void 0:e.currentTime)||0),this._audioChainCheckInterval&&(clearInterval(this._audioChainCheckInterval),this._audioChainCheckInterval=null),console.log("✅ Master pattern stopped"),this._masterTapLogged=!1,this._masterTapSuccess=new Set,this.onMasterStateChangeCallback&&this.onMasterStateChangeCallback(!1,[]),{success:!0}}else return console.error("❌ Strudel not available"),{success:!1,error:"Strudel not available"}}catch(t){return console.error("❌ Error stopping master pattern:",t),{success:!1,error:t.message}}}getMasterPatternCode(){if(this.masterPattern&&this.masterPattern.trim()!==""){const e="// Controls Selected Tempo:";this.masterPattern.split(`
`).some(i=>i.trim().startsWith(e))||(this.masterPattern=this.formatMasterPatternWithTempoComment(this.masterPattern))}return this._ensureMasterPatternSanitized(),this.masterPattern}isMasterActive(){return!!this.masterActive}getMasterPlaybackInfo(){return{isPlaying:!!this.masterActive,startTime:this.masterPlaybackStartTime,speed:this.masterPlaybackSpeed||1,tempo:this.masterPlaybackTempo||this.currentTempo||120}}async setMasterPatternCode(e){try{if(console.log(`✏️ Setting master pattern code: ${e.substring(0,100)}...`),e&&e.trim()!==""?this.masterPattern=this.formatMasterPatternWithTempoComment(e):this.masterPattern="",this._ensureMasterPatternSanitized(),this.appInstance&&typeof this.appInstance.syncElementsFromMasterPattern=="function")try{this.appInstance.syncElementsFromMasterPattern(this.masterPattern)}catch(t){console.warn("⚠️ Failed to sync elements from master pattern:",t)}if(this.masterActive){console.log("🔄 Master is active - re-evaluating with updated pattern (no stop).");try{await this.playMasterPattern()}catch(t){console.warn("⚠️ Could not re-evaluate master after code update:",t.message)}}return{success:!0}}catch(t){return console.error("❌ Error setting master pattern code:",t),{success:!1,error:t.message}}}async previewPattern(e,t="preview",i=null){var s,r,a;if(this.masterOnlyPlayback)return console.log(`👀 Preview via master stack (${t})`),this.routePatternThroughMaster(t,e,{isPreview:!0,autoStart:!0});try{console.log(`👀 Previewing pattern (received): ${e.substring(0,100)}...`),console.log(`👀 Full pattern to preview: ${e}`);const o="d16";if(this.currentEvaluatingSlot=o,this.patternSlotToElementId.set(o,t),console.log(`🎵 Preview: Mapped slot ${o} to elementId ${t} for audio routing`),window.strudel&&window.strudel.evaluate)try{await window.strudel.evaluate(`${o} = silence`),console.log(`✅ Preview slot ${o} cleared`)}catch(u){console.warn("⚠️ Error clearing preview slot:",u.message)}if((!this.audioContext||this.audioContext.state==="suspended")&&await this.initialize(),this.audioContext&&this.audioContext.state==="suspended"){console.log("🔊 Audio context suspended for preview, resuming...");try{await this.audioContext.resume(),console.log(`✅ Audio context resumed for preview, state: ${this.audioContext.state}`)}catch(u){console.warn("⚠️ Could not resume audio context for preview:",u)}}const l=this.getElementAudioNodes(t);(!l||!l.gainNode)&&console.warn(`⚠️ Could not prepare audio nodes for preview element ${t}`),this.strudelLoaded||(console.log("⏳ Waiting for Strudel to initialize..."),await this.initStrudel()),await this.ensurePatternResourcesLoaded(e),console.log(`🔍 Preview - Original pattern: ${e}`),console.log(`🔍 Preview - Pattern type check: isNotePattern=${this.isNotePattern(e)}, contains s(${e.includes("s(")}, contains sound(${e.includes("sound(")}, contains note(${/\bnote\s*\(/i.test(e)})`);let c=await this.processPattern(e,t,{preserveBanks:!0,attemptBankLoad:!0,applyGainInPattern:!1});if(!c)return console.error("❌ Pattern processing failed for preview"),{success:!1,error:"Pattern processing failed"};if(console.log(`🔍 Preview - After processPattern: ${c}`),console.log(`🔍 Preview - Processed pattern type check: isNotePattern=${this.isNotePattern(c)}, contains s(${c.includes("s(")}, contains sound(${c.includes("sound(")}, contains note(${/\bnote\s*\(/i.test(c)})`),!c.includes(".loop(")&&!c.includes(".loop()")&&(c=`${c}.loop()`,console.log("🔄 Added .loop() to preview pattern for continuous playback")),window.strudel&&window.strudel.evaluate){const u=`${o} = ${c}`;console.log(`🎼 Preview evaluating: ${u.substring(0,300)}...`),console.log(`🔍 Preview - Full pattern code (${u.length} chars): ${u}`);const h=u.match(/\.s\(["']([^"']+)["']\)/),d=u.match(/\.sound\(["']([^"']+)["']\)/),f=d?d[1]:h?h[1]:"unknown";console.log(`🎵 Preview waveform: ${f}`);try{if(await window.strudel.evaluate(u),console.log("✅ Preview pattern evaluated successfully"),window.strudel.scheduler&&(window.strudel.scheduler.started?console.log("🔄 Scheduler already running, ensuring pattern is active..."):(console.log("▶️ Starting Strudel scheduler for preview..."),await window.strudel.scheduler.start())),this.soundsPreloaded)await new Promise(g=>setTimeout(g,50)),setTimeout(()=>{this.currentEvaluatingSlot===o&&(this.currentEvaluatingSlot=null)},500);else{if(window.strudel.scheduler&&window.strudel.scheduler.tick)try{for(let g=0;g<2;g++)window.strudel.scheduler.tick(),await new Promise(y=>setTimeout(y,10))}catch(g){console.warn("⚠️ Could not trigger scheduler tick:",g)}await new Promise(g=>setTimeout(g,200)),setTimeout(()=>{this.currentEvaluatingSlot===o&&(this.currentEvaluatingSlot=null)},1e3)}}catch(g){return console.error("❌ Preview pattern evaluation error:",g.message),console.error(`❌ Failed pattern code: ${u}`),{success:!1,error:g.message}}console.log(`✅ Preview pattern is playing on ${o}`),console.log(`🔊 Audio context state: ${((s=this.audioContext)==null?void 0:s.state)||"unknown"}`),console.log(`🔊 Master gain value: ${((a=(r=this.masterGainNode)==null?void 0:r.gain)==null?void 0:a.value)||"unknown"}`),console.log(`🔊 Master muted: ${this.masterMuted||!1}`);const m=c.includes(".s(")||c.includes(".sound(");return console.log(`🔍 Preview pattern waveform check: ${m?"Has waveform (.s() or .sound())":"No waveform found"}`),{success:!0,previewSlot:o}}else return console.error("❌ Strudel not properly initialized"),{success:!1,error:"Strudel not initialized"}}catch(o){return console.error("❌ Error previewing pattern:",o),{success:!1,error:o.message}}}async stopPreview(){if(this.masterOnlyPlayback){console.log("⏹️ Stopping preview routed through master");for(const e of this.previewElementIds)this.removeElementFromMaster(e);return this.previewElementIds.clear(),this.masterActive&&(!this.masterPattern||!this.masterPattern.trim())?await this.stopMasterPattern():this.masterActive&&await this.playMasterPattern(),{success:!0}}try{return console.log("⏹️ Stopping preview..."),window.strudel&&window.strudel.evaluate?(await window.strudel.evaluate("d16 = silence"),console.log("✅ Preview stopped"),{success:!0}):{success:!1,error:"Strudel not available"}}catch(e){return console.error("❌ Error stopping preview:",e),{success:!1,error:e.message}}}async exportAudioWAV(e=16,t=44100){try{if(console.log(`📦 Exporting master pattern as WAV (${e} seconds)...`),!this.masterPattern||this.masterPattern.trim()==="")return{success:!1,error:"No master pattern to export"};this.strudelLoaded||await this.initStrudel();const s=new OfflineAudioContext(2,t*e,t).destination;return window.strudel&&window.strudel.repl&&window.strudel.repl.audioContext?(console.log("⚠️ Using MediaRecorder fallback for audio export"),await this.exportAudioMediaRecorder(e)):await this.exportAudioMediaRecorder(e)}catch(i){return console.error("❌ Error exporting WAV:",i),{success:!1,error:i.message}}}async exportAudioMediaRecorder(e=16){return new Promise(t=>{try{if(!this.audioContext){t({success:!1,error:"Audio context not initialized"});return}if(!this.masterGainNode||!this.masterPanNode){t({success:!1,error:"Master audio nodes not found"});return}const i=this.audioContext.sampleRate,s=Math.floor(i*e),r=2,a=4096,o=[];let l=!1,c=null;try{c=this.audioContext.createScriptProcessor(a,r,r);let d=0;c.onaudioprocess=f=>{d++;const m=f.inputBuffer,g=f.outputBuffer;for(let M=0;M<r;M++){const v=m.getChannelData(M);g.getChannelData(M).set(v)}const y=Math.max(...Array.from(m.getChannelData(0).map(Math.abs)));if((d<=5||d%50===0)&&console.log(`🔍 ScriptProcessor call #${d}: max amplitude = ${y.toFixed(6)}, isRecording = ${l}`),!l)return;const b=[];for(let M=0;M<r;M++){const v=m.getChannelData(M);b.push(new Float32Array(v))}const P=Math.max(...b[0].map(Math.abs));P>1e-4?(o.length%10===0||o.length<5)&&console.log(`📦 Recording chunk ${o.length}: max amplitude = ${P.toFixed(6)}`):o.length<5&&console.log(`📦 Recording chunk ${o.length}: SILENT (max amplitude = ${P.toFixed(6)})`),o.push(b)},console.log("✅ ScriptProcessorNode created")}catch(d){console.error("❌ Failed to create ScriptProcessorNode:",d),t({success:!1,error:"ScriptProcessorNode not supported: "+d.message});return}const u=this.masterActive;console.log("▶️ Setting up recording..."),console.log("🔍 Pattern code:",this.masterPattern.substring(0,100)),console.log("🔍 Pattern already playing:",u);let h;u?(console.log("▶️ Pattern already playing, ensuring scheduler is running..."),h=Promise.resolve().then(async()=>(window.strudel&&window.strudel.scheduler&&!window.strudel.scheduler.started&&(console.log("▶️ Starting Strudel scheduler..."),await window.strudel.scheduler.start()),{success:!0}))):(console.log("▶️ Pattern not playing, starting it now..."),h=this.playMasterPattern()),h.then(()=>{setTimeout(()=>{console.log("🔧 Setting up recording routing..."),console.log("🔍 Master active:",this.masterActive),console.log("🔍 Audio context state:",this.audioContext.state);try{this.masterGainNode.disconnect(),console.log("✅ Disconnected all connections from masterGainNode")}catch(d){console.warn("⚠️ Could not disconnect all:",d);try{this.masterGainNode.disconnect(this._realDestination),console.log("✅ Disconnected masterGainNode from destination")}catch(f){console.warn("⚠️ Could not disconnect from destination:",f)}}this.masterGainNode.connect(c),c.connect(this._realDestination),console.log("✅ Connected audio routing: masterGainNode -> scriptProcessor -> destination"),console.log("🔍 Verifying connections:"),console.log("  masterGainNode numberOfOutputs:",this.masterGainNode.numberOfOutputs),console.log("  scriptProcessor inputs:",c.numberOfInputs,"outputs:",c.numberOfOutputs),console.log("  Waiting for audio to flow through scriptProcessor..."),setTimeout(()=>{console.log(`🎙️ Recording started for ${e} seconds...`),console.log("🔍 Master active:",this.masterActive),console.log("🔍 Audio context state:",this.audioContext.state),console.log("🔍 ScriptProcessor connected - waiting for audio chunks..."),l=!0,setTimeout(()=>{var A;console.log(`⏹️ Stopping recording after ${e} seconds...`),console.log(`📦 Total chunks captured: ${o.length}`),l=!1;try{try{c.disconnect(this._realDestination)}catch{}try{this.masterGainNode.disconnect(c)}catch{}try{this.masterGainNode.connect(this._realDestination)}catch{try{this.masterGainNode.disconnect(this._realDestination),this.masterGainNode.connect(this._realDestination)}catch(Z){console.warn("Could not restore connection:",Z)}}console.log("✅ Restored original audio routing: masterGainNode -> destination")}catch(B){console.warn("Error restoring audio routing:",B);try{this.masterGainNode.connect(this._realDestination)}catch(Z){console.error("Failed to restore connection:",Z)}}if(u?console.log("✅ Pattern was already playing, leaving it running"):this.stopMasterPattern(),o.length===0){console.error("❌ No audio data recorded"),console.error("🔍 Debug info:"),console.error("  Master active:",this.masterActive),console.error("  Audio context state:",this.audioContext.state),console.error("  Master gain node:",!!this.masterGainNode),console.error("  Master pan node:",!!this.masterPanNode),console.error("  Script processor:",!!c),console.error("  Is recording flag:",l),console.error("  Pattern code length:",((A=this.masterPattern)==null?void 0:A.length)||0),t({success:!1,error:"No audio data was recorded. ScriptProcessorNode may not be receiving audio. Check console for debug info."});return}console.log(`📦 Recorded ${o.length} chunks`);const d=o.reduce((B,Z)=>B+Z[0].length,0);console.log(`📦 Total samples: ${d} (expected: ~${s})`);const f=new Float32Array(d),m=new Float32Array(d);let g=0;for(const B of o){const Z=B[0].length;f.set(B[0],g),B[1]?m.set(B[1],g):m.set(B[0],g),g+=Z}let y=0,b=0;const P=Math.max(1,Math.floor(d/1e3));for(let B=0;B<d;B+=P){const Z=Math.abs(f[B]),q=Math.abs(m[B]),X=Math.max(Z,q);y=Math.max(y,X),X>1e-4&&b++}console.log(`🔍 Audio analysis: max amplitude = ${y.toFixed(6)}, non-zero samples = ${b}`);const M=[],v=[];for(let B=0;B<Math.min(10,d);B++)M.push(Math.abs(f[B]));for(let B=Math.max(0,d-10);B<d;B++)v.push(Math.abs(f[B]));console.log(`🔍 First 10 samples: ${M.map(B=>B.toFixed(4)).join(", ")}`),console.log(`🔍 Last 10 samples: ${v.map(B=>B.toFixed(4)).join(", ")}`),y<1e-4&&(console.warn("⚠️ Audio appears to be silent (all zeros or very quiet)"),console.warn("⚠️ Master volume:",this.masterVolume),console.warn("⚠️ Master muted:",this.masterMuted),console.warn("⚠️ This might indicate that audio is not reaching masterPanNode"));const C=this.audioContext.createBuffer(r,d,i);C.getChannelData(0).set(f),C.getChannelData(1).set(m);const E=this.audioBufferToWAV(C);if(console.log(`✅ WAV blob created: ${E.size} bytes`),E.size===0){t({success:!1,error:"WAV blob is empty"});return}this.downloadBlob(E,"master-pattern.wav","audio/wav"),y<1e-4?t({success:!0,format:"wav",warning:"Audio file created but appears to be silent. Check that the pattern is playing and master volume is not muted."}):t({success:!0,format:"wav"})},e*1e3)},200)},500)}).catch(d=>{console.error("❌ Failed to start pattern for recording:",d);try{this.masterGainNode.disconnect(c),c.disconnect(this._realDestination),this.masterGainNode.connect(this._realDestination)}catch{}t({success:!1,error:"Failed to start pattern: "+d.message})})}catch(i){console.error("❌ Error in audio export:",i),t({success:!1,error:i.message})}})}parsePatternToMIDI(e){const t=[];this.currentTempo;const a=16*480;let o=[e];if(e.includes("stack(")){const c=e.match(/stack\s*\(([^)]+)\)/);if(c){const u=c[1];o=this.splitStackPatterns(u)}}const l={bd:36,kick:36,kickdrum:36,sd:38,snare:38,snaredrum:38,hh:42,hihat:42,closedhihat:42,oh:46,openhihat:46,cr:49,crash:49,rd:51,ride:51,ht:48,hightom:48,mt:47,midtom:47,lt:45,lowtom:45,cp:39,clap:39,rim:37,rimshot:37};return o.forEach((c,u)=>{const h=/note\s*\(["']([^"']+)["']\)/g;let d;const f=[];for(;(d=h.exec(c))!==null;){const g=d[1].split(/\s+/).filter(y=>y.trim());f.push(...g)}if(f.length>0){const m=a/f.length;f.forEach((g,y)=>{const b=this.noteToMIDI(g);if(b!==null){const P=Math.round(y*m),M=Math.round(m*.8);t.push({type:"noteOn",tick:P,channel:u%16,note:b,velocity:100}),t.push({type:"noteOff",tick:P+M,channel:u%16,note:b,velocity:0})}})}else{const m=/(?:sound|s)\s*\(["']([^"']+)["']\)/g;let g;for(;(g=m.exec(c))!==null;){const b=g[1].split(/\s+/).filter(M=>M.trim()),P=a/b.length;b.forEach((M,v)=>{const C=l[M.toLowerCase()]||36,E=Math.round(v*P),A=Math.round(P*.3);t.push({type:"noteOn",tick:E,channel:9,note:C,velocity:100}),t.push({type:"noteOff",tick:E+A,channel:9,note:C,velocity:0})})}}}),t.sort((c,u)=>c.tick-u.tick),t}splitStackPatterns(e){const t=[];let i="",s=0;for(let r=0;r<e.length;r++){const a=e[r];a==="("?(s++,i+=a):a===")"?(s--,i+=a):a===","&&s===0?(t.push(i.trim()),i=""):i+=a}return i.trim()&&t.push(i.trim()),t}noteToMIDI(e){const t=e.match(/^([a-gA-G])([#b]?)(\d+)$/);if(!t)return null;const[,i,s,r]=t,o=["c","d","e","f","g","a","b"].indexOf(i.toLowerCase());if(o===-1)return null;let l=12+parseInt(r)*12+o;return s==="#"?l+=1:s==="b"&&(l-=1),Math.max(0,Math.min(127,l))}createMIDIFile(e){const t=this.currentTempo||120,i=new Uint8Array([77,84,104,100,0,0,0,6,0,1,0,1,1,224]),s=[],r=Math.round(6e7/t);s.push({deltaTime:0,type:255,metaType:81,data:[r>>16&255,r>>8&255,r&255]});let a=0;e.forEach(h=>{const d=h.tick-a;a=h.tick,h.type==="noteOn"?s.push({deltaTime:d,type:144|h.channel,data:[h.note,h.velocity]}):h.type==="noteOff"&&s.push({deltaTime:d,type:128|h.channel,data:[h.note,h.velocity]})}),s.push({deltaTime:0,type:255,metaType:47,data:[]});const o=[];s.forEach(h=>{let d=h.deltaTime;const f=[];do{let m=d&127;d>>=7,f.length>0&&(m|=128),f.push(m)}while(d>0);o.push(...f),o.push(h.type),h.metaType!==void 0&&(o.push(h.metaType),o.push(h.data.length)),o.push(...h.data)});const l=o.length,c=new Uint8Array([77,84,114,107,l>>24&255,l>>16&255,l>>8&255,l&255,...o]),u=new Uint8Array(i.length+c.length);return u.set(i,0),u.set(c,i.length),new Blob([u],{type:"audio/midi"})}downloadBlob(e,t,i){const s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}async blobToAudioBuffer(e){const t=await e.arrayBuffer();return await this.audioContext.decodeAudioData(t)}audioBufferToWAV(e){const t=e.numberOfChannels,i=e.sampleRate,s=1,r=16,a=r/8,o=t*a,l=i*o,c=e.length*o,u=44+c,h=new ArrayBuffer(u),d=new DataView(h),f=(y,b)=>{for(let P=0;P<b.length;P++)d.setUint8(y+P,b.charCodeAt(P))};f(0,"RIFF"),d.setUint32(4,u-8,!0),f(8,"WAVE"),f(12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,s,!0),d.setUint16(22,t,!0),d.setUint32(24,i,!0),d.setUint32(28,l,!0),d.setUint16(32,o,!0),d.setUint16(34,r,!0),f(36,"data"),d.setUint32(40,c,!0);let m=44;const g=[];for(let y=0;y<t;y++)g.push(e.getChannelData(y));for(let y=0;y<e.length;y++)for(let b=0;b<t;b++){const P=Math.max(-1,Math.min(1,g[b][y]));d.setInt16(m,P<0?P*32768:P*32767,!0),m+=2}return new Blob([h],{type:"audio/wav"})}async exportAudioWAVOffline(e=16,t=44100){try{return console.log("📦 Exporting master pattern as WAV using OfflineAudioContext..."),!this.masterPattern||this.masterPattern.trim()===""?{success:!1,error:"No master pattern to export"}:(this.strudelLoaded||await this.initStrudel(),await this.exportAudioMediaRecorder(e))}catch(i){return console.error("❌ Error exporting WAV offline:",i),{success:!1,error:i.message}}}}const V=new NP;typeof window<"u"&&(window.soundManager=V);class BP{constructor(){this.updateCallbacks=new Map,this.soundTrigger=null,this.controlSoundTimers=new Map,this.activeSliders=new Set,this.tempoSliderActivated=!1,this.tapTimes=[],this.tapTimeout=null,this.tapTimeoutDelay=2e3,this.initializeControls()}setSoundTrigger(e){this.soundTrigger=e}triggerControlSound(e){if(!this.soundTrigger)return;const t=this.controlSoundTimers.get(e);t&&clearTimeout(t);const i=setTimeout(()=>{this.controlSoundTimers.delete(e);const s=zt.getControlConfig(e);if(s&&s.type){const r=`control-${e}`;this.soundTrigger(r,s)}},100);this.controlSoundTimers.set(e,i)}initializeControls(){const e=document.getElementById("tempo-slider"),t=document.getElementById("tempo-value");if(e&&t){e.classList.add("inactive"),t.classList.add("inactive");const a=()=>this.markTempoSliderActive(e,t);e.addEventListener&&(e.addEventListener("pointerdown",a,{once:!0}),e.addEventListener("focus",a,{once:!0})),e.addEventListener("input",o=>{a();const l=parseInt(o.target.value);t.textContent=l,this.notify("tempo",l)})}const i=document.getElementById("tap-tempo-btn");i&&i.addEventListener("click",()=>{this.handleTapTempo(e,t,i)});const s=document.getElementById("key-select");s&&s.addEventListener("change",a=>{const o=a.target.value;o!==""&&this.notify("key",o)});const r=document.getElementById("scale-select");r&&r.addEventListener("change",a=>{const o=a.target.value;if(o===""){this.notify("scale","chromatic");return}this.notify("scale",o)})}markTempoSliderActive(e,t){this.tempoSliderActivated||(this.tempoSliderActivated=!0,e&&e.classList.remove("inactive"),t&&t.classList.remove("inactive"))}handleTapTempo(e,t,i){this.markTempoSliderActive(e,t);const s=Date.now();if(this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null),this.tapTimes.push(s),this.tapTimes.length>=3){const r=[];for(let l=1;l<this.tapTimes.length;l++)r.push(this.tapTimes[l]-this.tapTimes[l-1]);const a=r.reduce((l,c)=>l+c,0)/r.length;let o=Math.round(6e4/a);o=Math.max(60,Math.min(240,o)),e&&(e.value=o),t&&(t.textContent=o),this.notify("tempo",o),this.tapTimes.length>4&&(this.tapTimes=this.tapTimes.slice(-4))}else{const r=3-this.tapTimes.length;if(i){const a=i.textContent;i.textContent=`${r} more`,setTimeout(()=>{i.textContent=a},500)}}this.tapTimeout=setTimeout(()=>{this.tapTimes=[],this.tapTimeout=null,i&&(i.textContent="TAP")},this.tapTimeoutDelay)}onUpdate(e,t){this.updateCallbacks.has(e)||this.updateCallbacks.set(e,[]),this.updateCallbacks.get(e).push(t)}notify(e,t){const i=this.updateCallbacks.get(e);i&&i.forEach(s=>s(t))}updateStatus(e){const t=document.getElementById("status-text");t&&(t.textContent=e)}updateActiveElements(e){const t=document.getElementById("active-elements");t&&(e.length===0?t.textContent="None":t.textContent=e.join(", "))}setElementState(e,t){const i=e.querySelector(".element-indicator");i&&(i.className="element-indicator",t==="hover"?i.classList.add("hover"):t==="proximity"&&i.classList.add("proximity")),e.className="sound-element",t==="hover"?e.classList.add("is-hovered"):t==="proximity"&&e.classList.add("is-proximity")}}const tn=new BP;let Xc=[],N0=[];(()=>{let n="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,t=0;e<n.length;e++)(e%2?N0:Xc).push(t=t+n[e])})();function FP(n){if(n<768)return!1;for(let e=0,t=Xc.length;;){let i=e+t>>1;if(n<Xc[i])t=i;else if(n>=N0[i])e=i+1;else return!0;if(e==t)return!1}}function Zf(n){return n>=127462&&n<=127487}const Gf=8205;function RP(n,e,t=!0,i=!0){return(t?B0:IP)(n,e,i)}function B0(n,e,t){if(e==n.length)return e;e&&F0(n.charCodeAt(e))&&R0(n.charCodeAt(e-1))&&e--;let i=ku(n,e);for(e+=Uf(i);e<n.length;){let s=ku(n,e);if(i==Gf||s==Gf||t&&FP(s))e+=Uf(s),i=s;else if(Zf(s)){let r=0,a=e-2;for(;a>=0&&Zf(ku(n,a));)r++,a-=2;if(r%2==0)break;e+=2}else break}return e}function IP(n,e,t){for(;e>0;){let i=B0(n,e-2,t);if(i<e)return i;e--}return 0}function ku(n,e){let t=n.charCodeAt(e);if(!R0(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return F0(i)?(t-55296<<10)+(i-56320)+65536:t}function F0(n){return n>=56320&&n<57344}function R0(n){return n>=55296&&n<56320}function Uf(n){return n<65536?1:2}class gt{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=Vr(this,e,t);let s=[];return this.decompose(0,e,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(t,this.length,s,1),Ji.from(s,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=Vr(this,e,t);let i=[];return this.decompose(e,t,i,0),Ji.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),s=new Ea(this),r=new Ea(e);for(let a=t,o=t;;){if(s.next(a),r.next(a),a=0,s.lineBreak!=r.lineBreak||s.done!=r.done||s.value!=r.value)return!1;if(o+=s.value.length,s.done||o>=i)return!0}}iter(e=1){return new Ea(this,e)}iterRange(e,t=this.length){return new I0(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let s=this.line(e).from;i=this.iterRange(s,Math.max(s,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new L0(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?gt.empty:e.length<=32?new sn(e):Ji.from(sn.split(e,[]))}}class sn extends gt{constructor(e,t=LP(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,s){for(let r=0;;r++){let a=this.text[r],o=s+a.length;if((t?i:o)>=e)return new QP(s,o,i,a);s=o+1,i++}}decompose(e,t,i,s){let r=e<=0&&t>=this.length?this:new sn(qf(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(s&1){let a=i.pop(),o=Go(r.text,a.text.slice(),0,r.length);if(o.length<=32)i.push(new sn(o,a.length+r.length));else{let l=o.length>>1;i.push(new sn(o.slice(0,l)),new sn(o.slice(l)))}}else i.push(r)}replace(e,t,i){if(!(i instanceof sn))return super.replace(e,t,i);[e,t]=Vr(this,e,t);let s=Go(this.text,Go(i.text,qf(this.text,0,e)),t),r=this.length+i.length-(t-e);return s.length<=32?new sn(s,r):Ji.from(sn.split(s,[]),r)}sliceString(e,t=this.length,i=`
`){[e,t]=Vr(this,e,t);let s="";for(let r=0,a=0;r<=t&&a<this.text.length;a++){let o=this.text[a],l=r+o.length;r>e&&a&&(s+=i),e<l&&t>r&&(s+=o.slice(Math.max(0,e-r),t-r)),r=l+1}return s}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],s=-1;for(let r of e)i.push(r),s+=r.length+1,i.length==32&&(t.push(new sn(i,s)),i=[],s=-1);return s>-1&&t.push(new sn(i,s)),t}}class Ji extends gt{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,s){for(let r=0;;r++){let a=this.children[r],o=s+a.length,l=i+a.lines-1;if((t?l:o)>=e)return a.lineInner(e,t,i,s);s=o+1,i=l+1}}decompose(e,t,i,s){for(let r=0,a=0;a<=t&&r<this.children.length;r++){let o=this.children[r],l=a+o.length;if(e<=l&&t>=a){let c=s&((a<=e?1:0)|(l>=t?2:0));a>=e&&l<=t&&!c?i.push(o):o.decompose(e-a,t-a,i,c)}a=l+1}}replace(e,t,i){if([e,t]=Vr(this,e,t),i.lines<this.lines)for(let s=0,r=0;s<this.children.length;s++){let a=this.children[s],o=r+a.length;if(e>=r&&t<=o){let l=a.replace(e-r,t-r,i),c=this.lines-a.lines+l.lines;if(l.lines<c>>4&&l.lines>c>>6){let u=this.children.slice();return u[s]=l,new Ji(u,this.length-(t-e)+i.length)}return super.replace(r,o,l)}r=o+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){[e,t]=Vr(this,e,t);let s="";for(let r=0,a=0;r<this.children.length&&a<=t;r++){let o=this.children[r],l=a+o.length;a>e&&r&&(s+=i),e<l&&t>a&&(s+=o.sliceString(e-a,t-a,i)),a=l+1}return s}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Ji))return 0;let i=0,[s,r,a,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=t,r+=t){if(s==a||r==o)return i;let l=this.children[s],c=e.children[r];if(l!=c)return i+l.scanIdentical(c,t);i+=l.length+1}}static from(e,t=e.reduce((i,s)=>i+s.length+1,-1)){let i=0;for(let f of e)i+=f.lines;if(i<32){let f=[];for(let m of e)m.flatten(f);return new sn(f,t)}let s=Math.max(32,i>>5),r=s<<1,a=s>>1,o=[],l=0,c=-1,u=[];function h(f){let m;if(f.lines>r&&f instanceof Ji)for(let g of f.children)h(g);else f.lines>a&&(l>a||!l)?(d(),o.push(f)):f instanceof sn&&l&&(m=u[u.length-1])instanceof sn&&f.lines+m.lines<=32?(l+=f.lines,c+=f.length+1,u[u.length-1]=new sn(m.text.concat(f.text),m.length+1+f.length)):(l+f.lines>s&&d(),l+=f.lines,c+=f.length+1,u.push(f))}function d(){l!=0&&(o.push(u.length==1?u[0]:Ji.from(u,c)),c=-1,l=u.length=0)}for(let f of e)h(f);return d(),o.length==1?o[0]:new Ji(o,t)}}gt.empty=new sn([""],0);function LP(n){let e=-1;for(let t of n)e+=t.length+1;return e}function Go(n,e,t=0,i=1e9){for(let s=0,r=0,a=!0;r<n.length&&s<=i;r++){let o=n[r],l=s+o.length;l>=t&&(l>i&&(o=o.slice(0,i-s)),s<t&&(o=o.slice(t-s)),a?(e[e.length-1]+=o,a=!1):e.push(o)),s=l+1}return e}function qf(n,e,t){return Go(n,[""],e,t)}class Ea{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof sn?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],r=this.offsets[i],a=r>>1,o=s instanceof sn?s.text.length:s.children.length;if(a==(t>0?o:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(s instanceof sn){let l=s.text[a+(t<0?-1:0)];if(this.offsets[i]+=t,l.length>Math.max(0,e))return this.value=e==0?l:t>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=s.children[a+(t<0?-1:0)];e>l.length?(e-=l.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(l),this.offsets.push(t>0?1:(l instanceof sn?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class I0{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new Ea(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*t,this.value=s.length<=i?s:t<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class L0{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:s}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(gt.prototype[Symbol.iterator]=function(){return this.iter()},Ea.prototype[Symbol.iterator]=I0.prototype[Symbol.iterator]=L0.prototype[Symbol.iterator]=function(){return this});class QP{constructor(e,t,i,s){this.from=e,this.to=t,this.number=i,this.text=s}get length(){return this.to-this.from}}function Vr(n,e,t){return e=Math.max(0,Math.min(n.length,e)),[e,Math.max(e,Math.min(n.length,t))]}function In(n,e,t=!0,i=!0){return RP(n,e,t,i)}function VP(n){return n>=56320&&n<57344}function zP(n){return n>=55296&&n<56320}function vr(n,e){let t=n.charCodeAt(e);if(!zP(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return VP(i)?(t-55296<<10)+(i-56320)+65536:t}function Q0(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function Ya(n){return n<65536?1:2}const Hc=/\r\n?|\n/;var $n=(function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n})($n||($n={}));class as{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,s=0;t<this.sections.length;){let r=this.sections[t++],a=this.sections[t++];a<0?(e(i,s,r),s+=r):s+=a,i+=r}}iterChangedRanges(e,t=!1){Yc(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],s=this.sections[t++];s<0?e.push(i,s):e.push(s,i)}return new as(e)}composeDesc(e){return this.empty?e:e.empty?this:V0(this,e)}mapDesc(e,t=!1){return e.empty?this:Kc(this,e,t)}mapPos(e,t=-1,i=$n.Simple){let s=0,r=0;for(let a=0;a<this.sections.length;){let o=this.sections[a++],l=this.sections[a++],c=s+o;if(l<0){if(c>e)return r+(e-s);r+=o}else{if(i!=$n.Simple&&c>=e&&(i==$n.TrackDel&&s<e&&c>e||i==$n.TrackBefore&&s<e||i==$n.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!o)return e==s||t<0?r:r+l;r+=l}s=c}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return r}touchesRange(e,t=e){for(let i=0,s=0;i<this.sections.length&&s<=t;){let r=this.sections[i++],a=this.sections[i++],o=s+r;if(a>=0&&s<=t&&o>=e)return s<e&&o>t?"cover":!0;s=o}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],s=this.sections[t++];e+=(e?" ":"")+i+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new as(e)}static create(e){return new as(e)}}class pn extends as{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Yc(this,(t,i,s,r,a)=>e=e.replace(s,s+(i-t),a),!1),e}mapDesc(e,t=!1){return Kc(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let s=0,r=0;s<t.length;s+=2){let a=t[s],o=t[s+1];if(o>=0){t[s]=o,t[s+1]=a;let l=s>>1;for(;i.length<l;)i.push(gt.empty);i.push(a?e.slice(r,r+a):gt.empty)}r+=a}return new pn(t,i)}compose(e){return this.empty?e:e.empty?this:V0(this,e,!0)}map(e,t=!1){return e.empty?this:Kc(this,e,t,!0)}iterChanges(e,t=!1){Yc(this,e,t)}get desc(){return as.create(this.sections)}filter(e){let t=[],i=[],s=[],r=new Ra(this);e:for(let a=0,o=0;;){let l=a==e.length?1e9:e[a++];for(;o<l||o==l&&r.len==0;){if(r.done)break e;let u=Math.min(r.len,l-o);Mn(s,u,-1);let h=r.ins==-1?-1:r.off==0?r.ins:0;Mn(t,u,h),h>0&&Fs(i,t,r.text),r.forward(u),o+=u}let c=e[a++];for(;o<c;){if(r.done)break e;let u=Math.min(r.len,c-o);Mn(t,u,-1),Mn(s,u,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(u),o+=u}}return{changes:new pn(t,i),filtered:as.create(s)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],s=this.sections[t+1];s<0?e.push(i):s==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let s=[],r=[],a=0,o=null;function l(u=!1){if(!u&&!s.length)return;a<t&&Mn(s,t-a,-1);let h=new pn(s,r);o=o?o.compose(h.map(o)):h,s=[],r=[],a=0}function c(u){if(Array.isArray(u))for(let h of u)c(h);else if(u instanceof pn){if(u.length!=t)throw new RangeError(`Mismatched change set length (got ${u.length}, expected ${t})`);l(),o=o?o.compose(u.map(o)):u}else{let{from:h,to:d=h,insert:f}=u;if(h>d||h<0||d>t)throw new RangeError(`Invalid change range ${h} to ${d} (in doc of length ${t})`);let m=f?typeof f=="string"?gt.of(f.split(i||Hc)):f:gt.empty,g=m.length;if(h==d&&g==0)return;h<a&&l(),h>a&&Mn(s,h-a,-1),Mn(s,d-h,g),Fs(r,s,m),a=d}}return c(e),l(!o),o}static empty(e){return new pn(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let s=0;s<e.length;s++){let r=e[s];if(typeof r=="number")t.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((a,o)=>o&&typeof a!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)t.push(r[0],0);else{for(;i.length<s;)i.push(gt.empty);i[s]=gt.of(r.slice(1)),t.push(r[0],i[s].length)}}}return new pn(t,i)}static createSet(e,t){return new pn(e,t)}}function Mn(n,e,t,i=!1){if(e==0&&t<=0)return;let s=n.length-2;s>=0&&t<=0&&t==n[s+1]?n[s]+=e:s>=0&&e==0&&n[s]==0?n[s+1]+=t:i?(n[s]+=e,n[s+1]+=t):n.push(e,t)}function Fs(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(gt.empty);n.push(t)}}function Yc(n,e,t){let i=n.inserted;for(let s=0,r=0,a=0;a<n.sections.length;){let o=n.sections[a++],l=n.sections[a++];if(l<0)s+=o,r+=o;else{let c=s,u=r,h=gt.empty;for(;c+=o,u+=l,l&&i&&(h=h.append(i[a-2>>1])),!(t||a==n.sections.length||n.sections[a+1]<0);)o=n.sections[a++],l=n.sections[a++];e(s,c,r,u,h),s=c,r=u}}}function Kc(n,e,t,i=!1){let s=[],r=i?[]:null,a=new Ra(n),o=new Ra(e);for(let l=-1;;){if(a.done&&o.len||o.done&&a.len)throw new Error("Mismatched change set lengths");if(a.ins==-1&&o.ins==-1){let c=Math.min(a.len,o.len);Mn(s,c,-1),a.forward(c),o.forward(c)}else if(o.ins>=0&&(a.ins<0||l==a.i||a.off==0&&(o.len<a.len||o.len==a.len&&!t))){let c=o.len;for(Mn(s,o.ins,-1);c;){let u=Math.min(a.len,c);a.ins>=0&&l<a.i&&a.len<=u&&(Mn(s,0,a.ins),r&&Fs(r,s,a.text),l=a.i),a.forward(u),c-=u}o.next()}else if(a.ins>=0){let c=0,u=a.len;for(;u;)if(o.ins==-1){let h=Math.min(u,o.len);c+=h,u-=h,o.forward(h)}else if(o.ins==0&&o.len<u)u-=o.len,o.next();else break;Mn(s,c,l<a.i?a.ins:0),r&&l<a.i&&Fs(r,s,a.text),l=a.i,a.forward(a.len-u)}else{if(a.done&&o.done)return r?pn.createSet(s,r):as.create(s);throw new Error("Mismatched change set lengths")}}}function V0(n,e,t=!1){let i=[],s=t?[]:null,r=new Ra(n),a=new Ra(e);for(let o=!1;;){if(r.done&&a.done)return s?pn.createSet(i,s):as.create(i);if(r.ins==0)Mn(i,r.len,0,o),r.next();else if(a.len==0&&!a.done)Mn(i,0,a.ins,o),s&&Fs(s,i,a.text),a.next();else{if(r.done||a.done)throw new Error("Mismatched change set lengths");{let l=Math.min(r.len2,a.len),c=i.length;if(r.ins==-1){let u=a.ins==-1?-1:a.off?0:a.ins;Mn(i,l,u,o),s&&u&&Fs(s,i,a.text)}else a.ins==-1?(Mn(i,r.off?0:r.len,l,o),s&&Fs(s,i,r.textBit(l))):(Mn(i,r.off?0:r.len,a.off?0:a.ins,o),s&&!a.off&&Fs(s,i,a.text));o=(r.ins>l||a.ins>=0&&a.len>l)&&(o||i.length>c),r.forward2(l),a.forward(l)}}}}class Ra{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?gt.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?gt.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class sr{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let i,s;return this.empty?i=s=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),s=e.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new sr(i,s,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return ce.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return ce.range(this.anchor,i)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return ce.range(e.anchor,e.head)}static create(e,t,i){return new sr(e,t,i)}}class ce{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:ce.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new ce([this.main],0)}addRange(e,t=!0){return ce.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,ce.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new ce(e.ranges.map(t=>sr.fromJSON(t)),e.main)}static single(e,t=e){return new ce([ce.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<e.length;s++){let r=e[s];if(r.empty?r.from<=i:r.from<i)return ce.normalized(e.slice(),t);i=r.to}return new ce(e,t)}static cursor(e,t=0,i,s){return sr.create(e,e,(t==0?0:t<0?8:16)|(i==null?7:Math.min(6,i))|(s??16777215)<<6)}static range(e,t,i,s){let r=(i??16777215)<<6|(s==null?7:Math.min(6,s));return t<e?sr.create(t,e,48|r):sr.create(e,t,(t>e?8:0)|r)}static normalized(e,t=0){let i=e[t];e.sort((s,r)=>s.from-r.from),t=e.indexOf(i);for(let s=1;s<e.length;s++){let r=e[s],a=e[s-1];if(r.empty?r.from<=a.to:r.from<a.to){let o=a.from,l=Math.max(r.to,a.to);s<=t&&t--,e.splice(--s,2,r.anchor>r.head?ce.range(l,o):ce.range(o,l))}}return new ce(e,t)}}function z0(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let yd=0;class Ie{constructor(e,t,i,s,r){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=s,this.id=yd++,this.default=e([]),this.extensions=typeof r=="function"?r(this):r}get reader(){return this}static define(e={}){return new Ie(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:bd),!!e.static,e.enables)}of(e){return new Uo([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Uo(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Uo(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function bd(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class Uo{constructor(e,t,i,s){this.dependencies=e,this.facet=t,this.type=i,this.value=s,this.id=yd++}dynamicSlot(e){var t;let i=this.value,s=this.facet.compareInput,r=this.id,a=e[r]>>1,o=this.type==2,l=!1,c=!1,u=[];for(let h of this.dependencies)h=="doc"?l=!0:h=="selection"?c=!0:(((t=e[h.id])!==null&&t!==void 0?t:1)&1)==0&&u.push(e[h.id]);return{create(h){return h.values[a]=i(h),1},update(h,d){if(l&&d.docChanged||c&&(d.docChanged||d.selection)||Jc(h,u)){let f=i(h);if(o?!Wf(f,h.values[a],s):!s(f,h.values[a]))return h.values[a]=f,1}return 0},reconfigure:(h,d)=>{let f,m=d.config.address[r];if(m!=null){let g=rl(d,m);if(this.dependencies.every(y=>y instanceof Ie?d.facet(y)===h.facet(y):y instanceof oi?d.field(y,!1)==h.field(y,!1):!0)||(o?Wf(f=i(h),g,s):s(f=i(h),g)))return h.values[a]=g,0}else f=i(h);return h.values[a]=f,1}}}}function Wf(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function Jc(n,e){let t=!1;for(let i of e)ka(n,i)&1&&(t=!0);return t}function jP(n,e,t){let i=t.map(l=>n[l.id]),s=t.map(l=>l.type),r=i.filter(l=>!(l&1)),a=n[e.id]>>1;function o(l){let c=[];for(let u=0;u<i.length;u++){let h=rl(l,i[u]);if(s[u]==2)for(let d of h)c.push(d);else c.push(h)}return e.combine(c)}return{create(l){for(let c of i)ka(l,c);return l.values[a]=o(l),1},update(l,c){if(!Jc(l,r))return 0;let u=o(l);return e.compare(u,l.values[a])?0:(l.values[a]=u,1)},reconfigure(l,c){let u=Jc(l,i),h=c.config.facets[e.id],d=c.facet(e);if(h&&!u&&bd(t,h))return l.values[a]=d,0;let f=o(l);return e.compare(f,d)?(l.values[a]=d,0):(l.values[a]=f,1)}}}const mo=Ie.define({static:!0});class oi{constructor(e,t,i,s,r){this.id=e,this.createF=t,this.updateF=i,this.compareF=s,this.spec=r,this.provides=void 0}static define(e){let t=new oi(yd++,e.create,e.update,e.compare||((i,s)=>i===s),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(mo).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,s)=>{let r=i.values[t],a=this.updateF(r,s);return this.compareF(r,a)?0:(i.values[t]=a,1)},reconfigure:(i,s)=>{let r=i.facet(mo),a=s.facet(mo),o;return(o=r.find(l=>l.field==this))&&o!=a.find(l=>l.field==this)?(i.values[t]=o.create(i),1):s.config.address[this.id]!=null?(i.values[t]=s.field(this),0):(i.values[t]=this.create(i),1)}}}init(e){return[this,mo.of({field:this,create:e})]}get extension(){return this}}const tr={lowest:4,low:3,default:2,high:1,highest:0};function oa(n){return e=>new j0(e,n)}const Ll={highest:oa(tr.highest),high:oa(tr.high),default:oa(tr.default),low:oa(tr.low),lowest:oa(tr.lowest)};class j0{constructor(e,t){this.inner=e,this.prec=t}}class Ql{of(e){return new eh(this,e)}reconfigure(e){return Ql.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class eh{constructor(e,t){this.compartment=e,this.inner=t}}class sl{constructor(e,t,i,s,r,a){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=s,this.staticValues=r,this.facets=a,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let s=[],r=Object.create(null),a=new Map;for(let d of ZP(e,t,a))d instanceof oi?s.push(d):(r[d.facet.id]||(r[d.facet.id]=[])).push(d);let o=Object.create(null),l=[],c=[];for(let d of s)o[d.id]=c.length<<1,c.push(f=>d.slot(f));let u=i==null?void 0:i.config.facets;for(let d in r){let f=r[d],m=f[0].facet,g=u&&u[d]||[];if(f.every(y=>y.type==0))if(o[m.id]=l.length<<1|1,bd(g,f))l.push(i.facet(m));else{let y=m.combine(f.map(b=>b.value));l.push(i&&m.compare(y,i.facet(m))?i.facet(m):y)}else{for(let y of f)y.type==0?(o[y.id]=l.length<<1|1,l.push(y.value)):(o[y.id]=c.length<<1,c.push(b=>y.dynamicSlot(b)));o[m.id]=c.length<<1,c.push(y=>jP(y,m,f))}}let h=c.map(d=>d(o));return new sl(e,a,h,o,l,r)}}function ZP(n,e,t){let i=[[],[],[],[],[]],s=new Map;function r(a,o){let l=s.get(a);if(l!=null){if(l<=o)return;let c=i[l].indexOf(a);c>-1&&i[l].splice(c,1),a instanceof eh&&t.delete(a.compartment)}if(s.set(a,o),Array.isArray(a))for(let c of a)r(c,o);else if(a instanceof eh){if(t.has(a.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(a.compartment)||a.inner;t.set(a.compartment,c),r(c,o)}else if(a instanceof j0)r(a.inner,a.prec);else if(a instanceof oi)i[o].push(a),a.provides&&r(a.provides,o);else if(a instanceof Uo)i[o].push(a),a.facet.extensions&&r(a.facet.extensions,tr.default);else{let c=a.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${a}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(c,o)}}return r(n,tr.default),i.reduce((a,o)=>a.concat(o))}function ka(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let s=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|s}function rl(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const Z0=Ie.define(),th=Ie.define({combine:n=>n.some(e=>e),static:!0}),G0=Ie.define({combine:n=>n.length?n[0]:void 0,static:!0}),U0=Ie.define(),q0=Ie.define(),W0=Ie.define(),X0=Ie.define({combine:n=>n.length?n[0]:!1});class Ps{constructor(e,t){this.type=e,this.value=t}static define(){return new GP}}class GP{of(e){return new Ps(this,e)}}class UP{constructor(e){this.map=e}of(e){return new xt(this,e)}}class xt{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new xt(this.type,t)}is(e){return this.type==e}static define(e={}){return new UP(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let s of e){let r=s.map(t);r&&i.push(r)}return i}}xt.reconfigure=xt.define();xt.appendConfig=xt.define();class ln{constructor(e,t,i,s,r,a){this.startState=e,this.changes=t,this.selection=i,this.effects=s,this.annotations=r,this.scrollIntoView=a,this._doc=null,this._state=null,i&&z0(i,t.newLength),r.some(o=>o.type==ln.time)||(this.annotations=r.concat(ln.time.of(Date.now())))}static create(e,t,i,s,r,a){return new ln(e,t,i,s,r,a)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(ln.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}ln.time=Ps.define();ln.userEvent=Ps.define();ln.addToHistory=Ps.define();ln.remote=Ps.define();function qP(n,e){let t=[];for(let i=0,s=0;;){let r,a;if(i<n.length&&(s==e.length||e[s]>=n[i]))r=n[i++],a=n[i++];else if(s<e.length)r=e[s++],a=e[s++];else return t;!t.length||t[t.length-1]<r?t.push(r,a):t[t.length-1]<a&&(t[t.length-1]=a)}}function H0(n,e,t){var i;let s,r,a;return t?(s=e.changes,r=pn.empty(e.changes.length),a=n.changes.compose(e.changes)):(s=e.changes.map(n.changes),r=n.changes.mapDesc(e.changes,!0),a=n.changes.compose(s)),{changes:a,selection:e.selection?e.selection.map(r):(i=n.selection)===null||i===void 0?void 0:i.map(s),effects:xt.mapEffects(n.effects,s).concat(xt.mapEffects(e.effects,r)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function nh(n,e,t){let i=e.selection,s=Rr(e.annotations);return e.userEvent&&(s=s.concat(ln.userEvent.of(e.userEvent))),{changes:e.changes instanceof pn?e.changes:pn.of(e.changes||[],t,n.facet(G0)),selection:i&&(i instanceof ce?i:ce.single(i.anchor,i.head)),effects:Rr(e.effects),annotations:s,scrollIntoView:!!e.scrollIntoView}}function Y0(n,e,t){let i=nh(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let r=1;r<e.length;r++){e[r].filter===!1&&(t=!1);let a=!!e[r].sequential;i=H0(i,nh(n,e[r],a?i.changes.newLength:n.doc.length),a)}let s=ln.create(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return XP(t?WP(s):s)}function WP(n){let e=n.startState,t=!0;for(let s of e.facet(U0)){let r=s(n);if(r===!1){t=!1;break}Array.isArray(r)&&(t=t===!0?r:qP(t,r))}if(t!==!0){let s,r;if(t===!1)r=n.changes.invertedDesc,s=pn.empty(e.doc.length);else{let a=n.changes.filter(t);s=a.changes,r=a.filtered.mapDesc(a.changes).invertedDesc}n=ln.create(e,s,n.selection&&n.selection.map(r),xt.mapEffects(n.effects,r),n.annotations,n.scrollIntoView)}let i=e.facet(q0);for(let s=i.length-1;s>=0;s--){let r=i[s](n);r instanceof ln?n=r:Array.isArray(r)&&r.length==1&&r[0]instanceof ln?n=r[0]:n=Y0(e,Rr(r),!1)}return n}function XP(n){let e=n.startState,t=e.facet(W0),i=n;for(let s=t.length-1;s>=0;s--){let r=t[s](n);r&&Object.keys(r).length&&(i=H0(i,nh(e,r,n.changes.newLength),!0))}return i==n?n:ln.create(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const HP=[];function Rr(n){return n==null?HP:Array.isArray(n)?n:[n]}var _n=(function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n})(_n||(_n={}));const YP=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let ih;try{ih=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function KP(n){if(ih)return ih.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||YP.test(t)))return!0}return!1}function JP(n){return e=>{if(!/\S/.test(e))return _n.Space;if(KP(e))return _n.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return _n.Word;return _n.Other}}class At{constructor(e,t,i,s,r,a){this.config=e,this.doc=t,this.selection=i,this.values=s,this.status=e.statusTemplate.slice(),this.computeSlot=r,a&&(a._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)ka(this,o<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return ka(this,i),rl(this,i)}update(...e){return Y0(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:s}=t;for(let o of e.effects)o.is(Ql.reconfigure)?(t&&(s=new Map,t.compartments.forEach((l,c)=>s.set(c,l)),t=null),s.set(o.value.compartment,o.value.extension)):o.is(xt.reconfigure)?(t=null,i=o.value):o.is(xt.appendConfig)&&(t=null,i=Rr(i).concat(o.value));let r;t?r=e.startState.values.slice():(t=sl.resolve(i,s,this),r=new At(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,c)=>c.reconfigure(l,this),null).values);let a=e.startState.facet(th)?e.newSelection:e.newSelection.asSingle();new At(t,e.newDoc,a,r,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:ce.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),s=this.changes(i.changes),r=[i.range],a=Rr(i.effects);for(let o=1;o<t.ranges.length;o++){let l=e(t.ranges[o]),c=this.changes(l.changes),u=c.map(s);for(let d=0;d<o;d++)r[d]=r[d].map(u);let h=s.mapDesc(c,!0);r.push(l.range.map(h)),s=s.compose(u),a=xt.mapEffects(a,u).concat(xt.mapEffects(Rr(l.effects),h))}return{changes:s,selection:ce.create(r,t.mainIndex),effects:a}}changes(e=[]){return e instanceof pn?e:pn.of(e,this.doc.length,this.facet(At.lineSeparator))}toText(e){return gt.of(e.split(this.facet(At.lineSeparator)||Hc))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(ka(this,t),rl(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let s=e[i];s instanceof oi&&this.config.address[s.id]!=null&&(t[i]=s.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i){for(let r in i)if(Object.prototype.hasOwnProperty.call(e,r)){let a=i[r],o=e[r];s.push(a.init(l=>a.spec.fromJSON(o,l)))}}return At.create({doc:e.doc,selection:ce.fromJSON(e.selection),extensions:t.extensions?s.concat([t.extensions]):s})}static create(e={}){let t=sl.resolve(e.extensions||[],new Map),i=e.doc instanceof gt?e.doc:gt.of((e.doc||"").split(t.staticFacet(At.lineSeparator)||Hc)),s=e.selection?e.selection instanceof ce?e.selection:ce.single(e.selection.anchor,e.selection.head):ce.single(0);return z0(s,i.length),t.staticFacet(th)||(s=s.asSingle()),new At(t,i,s,t.dynamicSlots.map(()=>null),(r,a)=>a.create(r),null)}get tabSize(){return this.facet(At.tabSize)}get lineBreak(){return this.facet(At.lineSeparator)||`
`}get readOnly(){return this.facet(X0)}phrase(e,...t){for(let i of this.facet(At.phrases))if(Object.prototype.hasOwnProperty.call(i,e)){e=i[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(i,s)=>{if(s=="$")return"$";let r=+(s||1);return!r||r>t.length?i:t[r-1]})),e}languageDataAt(e,t,i=-1){let s=[];for(let r of this.facet(Z0))for(let a of r(this,t,i))Object.prototype.hasOwnProperty.call(a,e)&&s.push(a[e]);return s}charCategorizer(e){return JP(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:s}=this.doc.lineAt(e),r=this.charCategorizer(e),a=e-i,o=e-i;for(;a>0;){let l=In(t,a,!1);if(r(t.slice(l,a))!=_n.Word)break;a=l}for(;o<s;){let l=In(t,o);if(r(t.slice(o,l))!=_n.Word)break;o=l}return a==o?null:ce.range(a+i,o+i)}}At.allowMultipleSelections=th;At.tabSize=Ie.define({combine:n=>n.length?n[0]:4});At.lineSeparator=G0;At.readOnly=X0;At.phrases=Ie.define({compare(n,e){let t=Object.keys(n),i=Object.keys(e);return t.length==i.length&&t.every(s=>n[s]==e[s])}});At.languageData=Z0;At.changeFilter=U0;At.transactionFilter=q0;At.transactionExtender=W0;Ql.reconfigure=xt.define();function Ka(n,e,t={}){let i={};for(let s of n)for(let r of Object.keys(s)){let a=s[r],o=i[r];if(o===void 0)i[r]=a;else if(!(o===a||a===void 0))if(Object.hasOwnProperty.call(t,r))i[r]=t[r](o,a);else throw new Error("Config merge conflict for field "+r)}for(let s in e)i[s]===void 0&&(i[s]=e[s]);return i}class pr{eq(e){return this==e}range(e,t=e){return sh.create(e,t,this)}}pr.prototype.startSide=pr.prototype.endSide=0;pr.prototype.point=!1;pr.prototype.mapMode=$n.TrackDel;let sh=class K0{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new K0(e,t,i)}};function rh(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class vd{constructor(e,t,i,s){this.from=e,this.to=t,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,s=0){let r=i?this.to:this.from;for(let a=s,o=r.length;;){if(a==o)return a;let l=a+o>>1,c=r[l]-e||(i?this.value[l].endSide:this.value[l].startSide)-t;if(l==a)return c>=0?a:o;c>=0?o=l:a=l+1}}between(e,t,i,s){for(let r=this.findIndex(t,-1e9,!0),a=this.findIndex(i,1e9,!1,r);r<a;r++)if(s(this.from[r]+e,this.to[r]+e,this.value[r])===!1)return!1}map(e,t){let i=[],s=[],r=[],a=-1,o=-1;for(let l=0;l<this.value.length;l++){let c=this.value[l],u=this.from[l]+e,h=this.to[l]+e,d,f;if(u==h){let m=t.mapPos(u,c.startSide,c.mapMode);if(m==null||(d=f=m,c.startSide!=c.endSide&&(f=t.mapPos(u,c.endSide),f<d)))continue}else if(d=t.mapPos(u,c.startSide),f=t.mapPos(h,c.endSide),d>f||d==f&&c.startSide>0&&c.endSide<=0)continue;(f-d||c.endSide-c.startSide)<0||(a<0&&(a=d),c.point&&(o=Math.max(o,f-d)),i.push(c),s.push(d-a),r.push(f-a))}return{mapped:i.length?new vd(s,r,i,o):null,pos:a}}}class St{constructor(e,t,i,s){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=s}static create(e,t,i,s){return new St(e,t,i,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:s=0,filterTo:r=this.length}=e,a=e.filter;if(t.length==0&&!a)return this;if(i&&(t=t.slice().sort(rh)),this.isEmpty)return t.length?St.of(t):this;let o=new J0(this,null,-1).goto(0),l=0,c=[],u=new zr;for(;o.value||l<t.length;)if(l<t.length&&(o.from-t[l].from||o.startSide-t[l].value.startSide)>=0){let h=t[l++];u.addInner(h.from,h.to,h.value)||c.push(h)}else o.rangeIndex==1&&o.chunkIndex<this.chunk.length&&(l==t.length||this.chunkEnd(o.chunkIndex)<t[l].from)&&(!a||s>this.chunkEnd(o.chunkIndex)||r<this.chunkPos[o.chunkIndex])&&u.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!a||s>o.to||r<o.from||a(o.from,o.to,o.value))&&(u.addInner(o.from,o.to,o.value)||c.push(sh.create(o.from,o.to,o.value))),o.next());return u.finishInner(this.nextLayer.isEmpty&&!c.length?St.empty:this.nextLayer.update({add:c,filter:a,filterFrom:s,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],s=-1;for(let a=0;a<this.chunk.length;a++){let o=this.chunkPos[a],l=this.chunk[a],c=e.touchesRange(o,o+l.length);if(c===!1)s=Math.max(s,l.maxPoint),t.push(l),i.push(e.mapPos(o));else if(c===!0){let{mapped:u,pos:h}=l.map(o,e);u&&(s=Math.max(s,u.maxPoint),t.push(u),i.push(h))}}let r=this.nextLayer.map(e);return t.length==0?r:new St(i,t,r||St.empty,s)}between(e,t,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],a=this.chunk[s];if(t>=r&&e<=r+a.length&&a.between(r,e-r,t-r,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return Ia.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Ia.from(e).goto(t)}static compare(e,t,i,s,r=-1){let a=e.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=r),o=t.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=r),l=Xf(a,o,i),c=new la(a,l,r),u=new la(o,l,r);i.iterGaps((h,d,f)=>Hf(c,h,u,d,f,s)),i.empty&&i.length==0&&Hf(c,0,u,0,0,s)}static eq(e,t,i=0,s){s==null&&(s=999999999);let r=e.filter(u=>!u.isEmpty&&t.indexOf(u)<0),a=t.filter(u=>!u.isEmpty&&e.indexOf(u)<0);if(r.length!=a.length)return!1;if(!r.length)return!0;let o=Xf(r,a),l=new la(r,o,0).goto(i),c=new la(a,o,0).goto(i);for(;;){if(l.to!=c.to||!ah(l.active,c.active)||l.point&&(!c.point||!l.point.eq(c.point)))return!1;if(l.to>s)return!0;l.next(),c.next()}}static spans(e,t,i,s,r=-1){let a=new la(e,null,r).goto(t),o=t,l=a.openStart;for(;;){let c=Math.min(a.to,i);if(a.point){let u=a.activeForPoint(a.to),h=a.pointFrom<t?u.length+1:a.point.startSide<0?u.length:Math.min(u.length,l);s.point(o,c,a.point,u,h,a.pointRank),l=Math.min(a.openEnd(c),u.length)}else c>o&&(s.span(o,c,a.active,l),l=a.openEnd(c));if(a.to>i)return l+(a.point&&a.to>i?1:0);o=a.to,a.next()}}static of(e,t=!1){let i=new zr;for(let s of e instanceof sh?[e]:t?eA(e):e)i.add(s.from,s.to,s.value);return i.finish()}static join(e){if(!e.length)return St.empty;let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)for(let s=e[i];s!=St.empty;s=s.nextLayer)t=new St(s.chunkPos,s.chunk,t,Math.max(s.maxPoint,t.maxPoint));return t}}St.empty=new St([],[],null,-1);function eA(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let i=n[t];if(rh(e,i)>0)return n.slice().sort(rh);e=i}return n}St.empty.nextLayer=St.empty;class zr{finishChunk(e){this.chunks.push(new vd(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new zr)).add(e,t,i)}addInner(e,t,i){let s=e-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(St.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=St.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Xf(n,e,t){let i=new Map;for(let r of n)for(let a=0;a<r.chunk.length;a++)r.chunk[a].maxPoint<=0&&i.set(r.chunk[a],r.chunkPos[a]);let s=new Set;for(let r of e)for(let a=0;a<r.chunk.length;a++){let o=i.get(r.chunk[a]);o!=null&&(t?t.mapPos(o):o)==r.chunkPos[a]&&!(t!=null&&t.touchesRange(o,o+r.chunk[a].length))&&s.add(r.chunk[a])}return s}class J0{constructor(e,t,i,s=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<e||s.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Ia{constructor(e){this.heap=e}static from(e,t=null,i=-1){let s=[];for(let r=0;r<e.length;r++)for(let a=e[r];!a.isEmpty;a=a.nextLayer)a.maxPoint>=i&&s.push(new J0(a,t,i,r));return s.length==1?s[0]:new Ia(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)Mu(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)Mu(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Mu(this.heap,0)}}}function Mu(n,e){for(let t=n[e];;){let i=(e<<1)+1;if(i>=n.length)break;let s=n[i];if(i+1<n.length&&s.compare(n[i+1])>=0&&(s=n[i+1],i++),t.compare(s)<0)break;n[i]=t,n[e]=s,e=i}}class la{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Ia.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){go(this.active,e),go(this.activeTo,e),go(this.activeRank,e),this.minActive=Yf(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:s,rank:r}=this.cursor;for(;t<this.activeRank.length&&(r-this.activeRank[t]||s-this.activeTo[t])>0;)t++;Oo(this.active,t,i),Oo(this.activeTo,t,s),Oo(this.activeRank,t,r),e&&Oo(e,t,this.cursor.from),this.minActive=Yf(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&go(i,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let r=this.cursor.value;if(!r.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let s=i.length-1;s>=0&&i[s]<e;s--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function Hf(n,e,t,i,s,r){n.goto(e),t.goto(i);let a=i+s,o=i,l=i-e;for(;;){let c=n.to+l-t.to,u=c||n.endSide-t.endSide,h=u<0?n.to+l:t.to,d=Math.min(h,a);if(n.point||t.point?n.point&&t.point&&(n.point==t.point||n.point.eq(t.point))&&ah(n.activeForPoint(n.to),t.activeForPoint(t.to))||r.comparePoint(o,d,n.point,t.point):d>o&&!ah(n.active,t.active)&&r.compareRange(o,d,n.active,t.active),h>a)break;(c||n.openEnd!=t.openEnd)&&r.boundChange&&r.boundChange(h),o=h,u<=0&&n.next(),u>=0&&t.next()}}function ah(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!n[t].eq(e[t]))return!1;return!0}function go(n,e){for(let t=e,i=n.length-1;t<i;t++)n[t]=n[t+1];n.pop()}function Oo(n,e,t){for(let i=n.length-1;i>=e;i--)n[i+1]=n[i];n[e]=t}function Yf(n,e){let t=-1,i=1e9;for(let s=0;s<e.length;s++)(e[s]-i||n[s].endSide-n[t].endSide)<0&&(t=s,i=e[s]);return t}function Vl(n,e,t=n.length){let i=0;for(let s=0;s<t&&s<n.length;)n.charCodeAt(s)==9?(i+=e-i%e,s++):(i++,s=In(n,s));return i}function tA(n,e,t,i){for(let s=0,r=0;;){if(r>=e)return s;if(s==n.length)break;r+=n.charCodeAt(s)==9?t-r%t:1,s=In(n,s)}return n.length}const oh="ͼ",Kf=typeof Symbol>"u"?"__"+oh:Symbol.for(oh),lh=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Jf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Vs{constructor(e,t){this.rules=[];let{finish:i}=t||{};function s(a){return/^@/.test(a)?[a]:a.split(/,\s*/)}function r(a,o,l,c){let u=[],h=/^@(\w+)\b/.exec(a[0]),d=h&&h[1]=="keyframes";if(h&&o==null)return l.push(a[0]+";");for(let f in o){let m=o[f];if(/&/.test(f))r(f.split(/,\s*/).map(g=>a.map(y=>g.replace(/&/,y))).reduce((g,y)=>g.concat(y)),m,l);else if(m&&typeof m=="object"){if(!h)throw new RangeError("The value of a property ("+f+") should be a primitive value.");r(s(f),m,u,d)}else m!=null&&u.push(f.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+m+";")}(u.length||d)&&l.push((i&&!h&&!c?a.map(i):a).join(", ")+" {"+u.join(" ")+"}")}for(let a in e)r(s(a),e[a],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=Jf[Kf]||1;return Jf[Kf]=e+1,oh+e.toString(36)}static mount(e,t,i){let s=e[lh],r=i&&i.nonce;s?r&&s.setNonce(r):s=new nA(e,r),s.mount(Array.isArray(t)?t:[t],e)}}let ep=new Map;class nA{constructor(e,t){let i=e.ownerDocument||e,s=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let r=ep.get(i);if(r)return e[lh]=r;this.sheet=new s.CSSStyleSheet,ep.set(i,this)}else this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[lh]=this}mount(e,t){let i=this.sheet,s=0,r=0;for(let a=0;a<e.length;a++){let o=e[a],l=this.modules.indexOf(o);if(l<r&&l>-1&&(this.modules.splice(l,1),r--,l=-1),l==-1){if(this.modules.splice(r++,0,o),i)for(let c=0;c<o.rules.length;c++)i.insertRule(o.rules[c],s++)}else{for(;r<l;)s+=this.modules[r++].rules.length;s+=o.rules.length,r++}}if(i)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let a="";for(let l=0;l<this.modules.length;l++)a+=this.modules[l].getRules()+`
`;this.styleTag.textContent=a;let o=t.head||t;this.styleTag.parentNode!=o&&o.insertBefore(this.styleTag,o.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var zs={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},La={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},iA=typeof navigator<"u"&&/Mac/.test(navigator.platform),sA=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var xn=0;xn<10;xn++)zs[48+xn]=zs[96+xn]=String(xn);for(var xn=1;xn<=24;xn++)zs[xn+111]="F"+xn;for(var xn=65;xn<=90;xn++)zs[xn]=String.fromCharCode(xn+32),La[xn]=String.fromCharCode(xn);for(var Du in zs)La.hasOwnProperty(Du)||(La[Du]=zs[Du]);function rA(n){var e=iA&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||sA&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?La:zs)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}let Rn=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},uh=typeof document<"u"?document:{documentElement:{style:{}}};const ch=/Edge\/(\d+)/.exec(Rn.userAgent),e1=/MSIE \d/.test(Rn.userAgent),hh=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Rn.userAgent),zl=!!(e1||hh||ch),tp=!zl&&/gecko\/(\d+)/i.test(Rn.userAgent),$u=!zl&&/Chrome\/(\d+)/.exec(Rn.userAgent),aA="webkitFontSmoothing"in uh.documentElement.style,dh=!zl&&/Apple Computer/.test(Rn.vendor),np=dh&&(/Mobile\/\w+/.test(Rn.userAgent)||Rn.maxTouchPoints>2);var ke={mac:np||/Mac/.test(Rn.platform),windows:/Win/.test(Rn.platform),linux:/Linux|X11/.test(Rn.platform),ie:zl,ie_version:e1?uh.documentMode||6:hh?+hh[1]:ch?+ch[1]:0,gecko:tp,gecko_version:tp?+(/Firefox\/(\d+)/.exec(Rn.userAgent)||[0,0])[1]:0,chrome:!!$u,chrome_version:$u?+$u[1]:0,ios:np,android:/Android\b/.test(Rn.userAgent),webkit_version:aA?+(/\bAppleWebKit\/(\d+)/.exec(Rn.userAgent)||[0,0])[1]:0,safari:dh,safari_version:dh?+(/\bVersion\/(\d+(\.\d+)?)/.exec(Rn.userAgent)||[0,0])[1]:0,tabSize:uh.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function Qa(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function fh(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function qo(n,e){if(!e.anchorNode)return!1;try{return fh(n,e.anchorNode)}catch{return!1}}function Va(n){return n.nodeType==3?gr(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function Ma(n,e,t,i){return t?ip(n,e,t,i,-1)||ip(n,e,t,i,1):!1}function mr(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function al(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}function ip(n,e,t,i,s){for(;;){if(n==t&&e==i)return!0;if(e==(s<0?0:cs(n))){if(n.nodeName=="DIV")return!1;let r=n.parentNode;if(!r||r.nodeType!=1)return!1;e=mr(n)+(s<0?0:1),n=r}else if(n.nodeType==1){if(n=n.childNodes[e+(s<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=s<0?cs(n):0}else return!1}}function cs(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function jl(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function oA(n){let e=n.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function t1(n,e){let t=e.width/n.offsetWidth,i=e.height/n.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-n.offsetWidth)<1)&&(t=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(e.height-n.offsetHeight)<1)&&(i=1),{scaleX:t,scaleY:i}}function lA(n,e,t,i,s,r,a,o){let l=n.ownerDocument,c=l.defaultView||window;for(let u=n,h=!1;u&&!h;)if(u.nodeType==1){let d,f=u==l.body,m=1,g=1;if(f)d=oA(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(u).position)&&(h=!0),u.scrollHeight<=u.clientHeight&&u.scrollWidth<=u.clientWidth){u=u.assignedSlot||u.parentNode;continue}let P=u.getBoundingClientRect();({scaleX:m,scaleY:g}=t1(u,P)),d={left:P.left,right:P.left+u.clientWidth*m,top:P.top,bottom:P.top+u.clientHeight*g}}let y=0,b=0;if(s=="nearest")e.top<d.top?(b=e.top-(d.top+a),t>0&&e.bottom>d.bottom+b&&(b=e.bottom-d.bottom+a)):e.bottom>d.bottom&&(b=e.bottom-d.bottom+a,t<0&&e.top-b<d.top&&(b=e.top-(d.top+a)));else{let P=e.bottom-e.top,M=d.bottom-d.top;b=(s=="center"&&P<=M?e.top+P/2-M/2:s=="start"||s=="center"&&t<0?e.top-a:e.bottom-M+a)-d.top}if(i=="nearest"?e.left<d.left?(y=e.left-(d.left+r),t>0&&e.right>d.right+y&&(y=e.right-d.right+r)):e.right>d.right&&(y=e.right-d.right+r,t<0&&e.left<d.left+y&&(y=e.left-(d.left+r))):y=(i=="center"?e.left+(e.right-e.left)/2-(d.right-d.left)/2:i=="start"==o?e.left-r:e.right-(d.right-d.left)+r)-d.left,y||b)if(f)c.scrollBy(y,b);else{let P=0,M=0;if(b){let v=u.scrollTop;u.scrollTop+=b/g,M=(u.scrollTop-v)*g}if(y){let v=u.scrollLeft;u.scrollLeft+=y/m,P=(u.scrollLeft-v)*m}e={left:e.left-P,top:e.top-M,right:e.right-P,bottom:e.bottom-M},P&&Math.abs(P-y)<1&&(i="nearest"),M&&Math.abs(M-b)<1&&(s="nearest")}if(f)break;(e.top<d.top||e.bottom>d.bottom||e.left<d.left||e.right>d.right)&&(e={left:Math.max(e.left,d.left),right:Math.min(e.right,d.right),top:Math.max(e.top,d.top),bottom:Math.min(e.bottom,d.bottom)}),u=u.assignedSlot||u.parentNode}else if(u.nodeType==11)u=u.host;else break}function uA(n){let e=n.ownerDocument,t,i;for(let s=n.parentNode;s&&!(s==e.body||t&&i);)if(s.nodeType==1)!i&&s.scrollHeight>s.clientHeight&&(i=s),!t&&s.scrollWidth>s.clientWidth&&(t=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:t,y:i}}class cA{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?cs(t):0),i,Math.min(e.focusOffset,i?cs(i):0))}set(e,t,i,s){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=s}}let er=null;ke.safari&&ke.safari_version>=26&&(er=!1);function n1(n){if(n.setActive)return n.setActive();if(er)return n.focus(er);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(er==null?{get preventScroll(){return er={preventScroll:!0},!0}}:void 0),!er){er=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],r=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let sp;function gr(n,e,t=e){let i=sp||(sp=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function Ir(n,e,t,i){let s={key:e,code:e,keyCode:t,which:t,cancelable:!0};i&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=i);let r=new KeyboardEvent("keydown",s);r.synthetic=!0,n.dispatchEvent(r);let a=new KeyboardEvent("keyup",s);return a.synthetic=!0,n.dispatchEvent(a),r.defaultPrevented||a.defaultPrevented}function hA(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function i1(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}function dA(n,e){let t=e.focusNode,i=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=i)return!1;for(i=Math.min(i,cs(t));;)if(i){if(t.nodeType!=1)return!1;let s=t.childNodes[i-1];s.contentEditable=="false"?i--:(t=s,i=cs(t))}else{if(t==n)return!0;i=mr(t),t=t.parentNode}}function s1(n){return n.scrollTop>Math.max(1,n.scrollHeight-n.clientHeight-4)}function r1(n,e){for(let t=n,i=e;;){if(t.nodeType==3&&i>0)return{node:t,offset:i};if(t.nodeType==1&&i>0){if(t.contentEditable=="false")return null;t=t.childNodes[i-1],i=cs(t)}else if(t.parentNode&&!al(t))i=mr(t),t=t.parentNode;else return null}}function a1(n,e){for(let t=n,i=e;;){if(t.nodeType==3&&i<t.nodeValue.length)return{node:t,offset:i};if(t.nodeType==1&&i<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[i],i=0}else if(t.parentNode&&!al(t))i=mr(t)+1,t=t.parentNode;else return null}}class Tn{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new Tn(e.parentNode,mr(e),t)}static after(e,t){return new Tn(e.parentNode,mr(e)+1,t)}}const Sd=[];class Dt{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let i=this.dom,s=null,r;for(let a of this.children){if(a.flags&7){if(!a.dom&&(r=s?s.nextSibling:i.firstChild)){let o=Dt.get(r);(!o||!o.parent&&o.canReuseDOM(a))&&a.reuseDOM(r)}a.sync(e,t),a.flags&=-8}if(r=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&r!=a.dom&&(t.written=!0),a.dom.parentNode==i)for(;r&&r!=a.dom;)r=rp(r);else i.insertBefore(a.dom,r);s=a.dom}for(r=s?s.nextSibling:i.firstChild,r&&t&&t.node==i&&(t.written=!0);r;)r=rp(r)}else if(this.flags&1)for(let i of this.children)i.flags&7&&(i.sync(e,t),i.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let s=cs(e)==0?0:t==0?-1:1;for(;;){let r=e.parentNode;if(r==this.dom)break;s==0&&r.firstChild!=r.lastChild&&(e==r.firstChild?s=-1:s=1),e=r}s<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Dt.get(i);)i=i.nextSibling;if(!i)return this.length;for(let s=0,r=0;;s++){let a=this.children[s];if(a.dom==i)return r;r+=a.length+a.breakAfter}}domBoundsAround(e,t,i=0){let s=-1,r=-1,a=-1,o=-1;for(let l=0,c=i,u=i;l<this.children.length;l++){let h=this.children[l],d=c+h.length;if(c<e&&d>t)return h.domBoundsAround(e,t,c);if(d>=e&&s==-1&&(s=l,r=c),c>t&&h.dom.parentNode==this.dom){a=l,o=u;break}u=d,c=d+h.breakAfter}return{from:r,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:a<this.children.length&&a>=0?this.children[a].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=Sd){this.markDirty();for(let s=e;s<t;s++){let r=this.children[s];r.parent==this&&i.indexOf(r)<0&&r.destroy()}i.length<250?this.children.splice(e,t-e,...i):this.children=[].concat(this.children.slice(0,e),i,this.children.slice(t));for(let s=0;s<i.length;s++)i[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new o1(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,s,r,a){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}Dt.prototype.breakAfter=0;function rp(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class o1{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function l1(n,e,t,i,s,r,a,o,l){let{children:c}=n,u=c.length?c[e]:null,h=r.length?r[r.length-1]:null,d=h?h.breakAfter:a;if(!(e==i&&u&&!a&&!d&&r.length<2&&u.merge(t,s,r.length?h:null,t==0,o,l))){if(i<c.length){let f=c[i];f&&(s<f.length||f.breakAfter&&(h!=null&&h.breakAfter))?(e==i&&(f=f.split(s),s=0),!d&&h&&f.merge(0,s,h,!0,0,l)?r[r.length-1]=f:((s||f.children.length&&!f.children[0].length)&&f.merge(0,s,null,!1,0,l),r.push(f))):f!=null&&f.breakAfter&&(h?h.breakAfter=1:a=1),i++}for(u&&(u.breakAfter=a,t>0&&(!a&&r.length&&u.merge(t,u.length,r[0],!1,o,0)?u.breakAfter=r.shift().breakAfter:(t<u.length||u.children.length&&u.children[u.children.length-1].length==0)&&u.merge(t,u.length,null,!1,o,0),e++));e<i&&r.length;)if(c[i-1].become(r[r.length-1]))i--,r.pop(),l=r.length?0:o;else if(c[e].become(r[0]))e++,r.shift(),o=r.length?0:l;else break;!r.length&&e&&i<c.length&&!c[e-1].breakAfter&&c[i].merge(0,0,c[e-1],!1,o,l)&&e--,(e<i||r.length)&&n.replaceChildren(e,i,r)}}function u1(n,e,t,i,s,r){let a=n.childCursor(),{i:o,off:l}=a.findPos(t,1),{i:c,off:u}=a.findPos(e,-1),h=e-t;for(let d of i)h+=d.length;n.length+=h,l1(n,c,u,o,l,i,0,s,r)}const fA=256;class Ri extends Dt{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return this.flags&8||i&&(!(i instanceof Ri)||this.length-(t-e)+i.length>fA||i.flags&8)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new Ri(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new Tn(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return pA(this.dom,e,t)}}class Ss extends Dt{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let s of t)s.setParent(this)}setAttrs(e){if(i1(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,i,s,r,a){return i&&(!(i instanceof Ss&&i.mark.eq(this.mark))||e&&r<=0||t<this.length&&a<=0)?!1:(u1(this,e,t,i?i.children.slice():[],r-1,a-1),this.markDirty(),!0)}split(e){let t=[],i=0,s=-1,r=0;for(let o of this.children){let l=i+o.length;l>e&&t.push(i<e?o.split(e-i):o),s<0&&i>=e&&(s=r),i=l,r++}let a=this.length-e;return this.length=e,s>-1&&(this.children.length=s,this.markDirty()),new Ss(this.mark,t,a)}domAtPos(e){return c1(this,e)}coordsAt(e,t){return d1(this,e,t)}}function pA(n,e,t){let i=n.nodeValue.length;e>i&&(e=i);let s=e,r=e,a=0;e==0&&t<0||e==i&&t>=0?ke.chrome||ke.gecko||(e?(s--,a=1):r<i&&(r++,a=-1)):t<0?s--:r<i&&r++;let o=gr(n,s,r).getClientRects();if(!o.length)return null;let l=o[(a?a<0:t>=0)?0:o.length-1];return ke.safari&&!a&&l.width==0&&(l=Array.prototype.find.call(o,c=>c.width)||l),a?jl(l,a<0):l||null}class rr extends Dt{static create(e,t,i){return new rr(e,t,i)}constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}split(e){let t=rr.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,i,s,r,a){return i&&(!(i instanceof rr)||!this.widget.compare(i.widget)||e>0&&r<=0||t<this.length&&a<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e instanceof rr&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return gt.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):gt.empty}domAtPos(e){return(this.length?e==0:this.side>0)?Tn.before(this.dom):Tn.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let s=this.dom.getClientRects(),r=null;if(!s.length)return null;let a=this.side?this.side<0:e>0;for(let o=a?s.length-1:0;r=s[o],!(e>0?o==0:o==s.length-1||r.top<r.bottom);o+=a?-1:1);return jl(r,!a)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class jr extends Dt{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof jr&&e.side==this.side}split(){return new jr(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?Tn.before(this.dom):Tn.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return gt.empty}get isHidden(){return!0}}Ri.prototype.children=rr.prototype.children=jr.prototype.children=Sd;function c1(n,e){let t=n.dom,{children:i}=n,s=0;for(let r=0;s<i.length;s++){let a=i[s],o=r+a.length;if(!(o==r&&a.getSide()<=0)){if(e>r&&e<o&&a.dom.parentNode==t)return a.domAtPos(e-r);if(e<=r)break;r=o}}for(let r=s;r>0;r--){let a=i[r-1];if(a.dom.parentNode==t)return a.domAtPos(a.length)}for(let r=s;r<i.length;r++){let a=i[r];if(a.dom.parentNode==t)return a.domAtPos(0)}return new Tn(t,0)}function h1(n,e,t){let i,{children:s}=n;t>0&&e instanceof Ss&&s.length&&(i=s[s.length-1])instanceof Ss&&i.mark.eq(e.mark)?h1(i,e.children[0],t-1):(s.push(e),e.setParent(n)),n.length+=e.length}function d1(n,e,t){let i=null,s=-1,r=null,a=-1;function o(c,u){for(let h=0,d=0;h<c.children.length&&d<=u;h++){let f=c.children[h],m=d+f.length;m>=u&&(f.children.length?o(f,u-d):(!r||r.isHidden&&(t>0||gA(r,f)))&&(m>u||d==m&&f.getSide()>0)?(r=f,a=u-d):(d<u||d==m&&f.getSide()<0&&!f.isHidden)&&(i=f,s=u-d)),d=m}}o(n,e);let l=(t<0?i:r)||i||r;return l?l.coordsAt(Math.max(0,l==i?s:a),t):mA(n)}function mA(n){let e=n.dom.lastChild;if(!e)return n.dom.getBoundingClientRect();let t=Va(e);return t[t.length-1]||null}function gA(n,e){let t=n.coordsAt(0,1),i=e.coordsAt(0,1);return t&&i&&i.top<t.bottom}function ph(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}const ap=Object.create(null);function ol(n,e,t){if(n==e)return!0;n||(n=ap),e||(e=ap);let i=Object.keys(n),s=Object.keys(e);if(i.length-(t&&i.indexOf(t)>-1?1:0)!=s.length-(t&&s.indexOf(t)>-1?1:0))return!1;for(let r of i)if(r!=t&&(s.indexOf(r)==-1||n[r]!==e[r]))return!1;return!0}function mh(n,e,t){let i=!1;if(e)for(let s in e)t&&s in t||(i=!0,s=="style"?n.style.cssText="":n.removeAttribute(s));if(t)for(let s in t)e&&e[s]==t[s]||(i=!0,s=="style"?n.style.cssText=t[s]:n.setAttribute(s,t[s]));return i}function OA(n){let e=Object.create(null);for(let t=0;t<n.attributes.length;t++){let i=n.attributes[t];e[i.name]=i.value}return e}class Hr{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var bi=(function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n})(bi||(bi={}));class it extends pr{constructor(e,t,i,s){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(e){return new Ja(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new js(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,s;if(e.isBlockGap)i=-5e8,s=4e8;else{let{start:r,end:a}=f1(e,t);i=(r?t?-3e8:-1:5e8)-1,s=(a?t?2e8:1:-6e8)+1}return new js(e,i,s,t,e.widget||null,!0)}static line(e){return new eo(e)}static set(e,t=!1){return St.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}it.none=St.empty;class Ja extends it{constructor(e){let{start:t,end:i}=f1(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,i;return this==e||e instanceof Ja&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((i=e.attrs)===null||i===void 0?void 0:i.class))&&ol(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Ja.prototype.point=!1;class eo extends it{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof eo&&this.spec.class==e.spec.class&&ol(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}eo.prototype.mapMode=$n.TrackBefore;eo.prototype.point=!0;class js extends it{constructor(e,t,i,s,r,a){super(t,i,r,e),this.block=s,this.isReplace=a,this.mapMode=s?t<=0?$n.TrackBefore:$n.TrackAfter:$n.TrackDel}get type(){return this.startSide!=this.endSide?bi.WidgetRange:this.startSide<=0?bi.WidgetBefore:bi.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof js&&yA(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}js.prototype.point=!0;function f1(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t??e,end:i??e}}function yA(n,e){return n==e||!!(n&&e&&n.compare(e))}function Wo(n,e,t,i=0){let s=t.length-1;s>=0&&t[s]+i>=n?t[s]=Math.max(t[s],e):t.push(n,e)}class on extends Dt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,s,r,a){if(i){if(!(i instanceof on))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),u1(this,e,t,i?i.children.slice():[],r,a),!0}split(e){let t=new on;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:s}=this.childPos(e);s&&(t.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)t.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){ol(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){h1(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=ph(t,this.attrs||{})),i&&(this.attrs=ph({class:i},this.attrs||{}))}domAtPos(e){return c1(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var i;this.dom?this.flags&4&&(i1(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(mh(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let s=this.dom.lastChild;for(;s&&Dt.get(s)instanceof Ss;)s=s.lastChild;if(!s||!this.length||s.nodeName!="BR"&&((i=Dt.get(s))===null||i===void 0?void 0:i.isEditable)==!1&&(!ke.ios||!this.children.some(r=>r instanceof Ri))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let i of this.children){if(!(i instanceof Ri)||/[^ -~]/.test(i.text))return null;let s=Va(i.dom);if(s.length!=1)return null;e+=s[0].width,t=s[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let i=d1(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:s}=this.parent.view.viewState,r=i.bottom-i.top;if(Math.abs(r-s.lineHeight)<2&&s.textHeight<r){let a=(r-s.textHeight)/2;return{top:i.top+a,bottom:i.bottom-a,left:i.left,right:i.left}}}return i}become(e){return e instanceof on&&this.children.length==0&&e.children.length==0&&ol(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let i=0,s=0;i<e.children.length;i++){let r=e.children[i],a=s+r.length;if(a>=t){if(r instanceof on)return r;if(a>t)break}s=a+r.breakAfter}return null}}class vs extends Dt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,s,r,a){return i&&(!(i instanceof vs)||!this.widget.compare(i.widget)||e>0&&r<=0||t<this.length&&a<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?Tn.before(this.dom):Tn.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new vs(this.widget,t,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return Sd}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):gt.empty}domBoundsAround(){return null}become(e){return e instanceof vs&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);return i||(this.widget instanceof gh?null:jl(this.dom.getBoundingClientRect(),this.length?e==0:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:i}=this.deco;return t==i?!1:e<0?t<0:i>0}}class gh extends Hr{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class Da{constructor(e,t,i,s){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof vs&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new on),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(yo(new jr(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof vs)&&this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:a,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=a,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e),r=Math.min(s,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(yo(new Ri(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=s<=r?0:t.length}}span(e,t,i,s){this.buildText(t-e,i,s),this.pos=t,this.openStart<0&&(this.openStart=s)}point(e,t,i,s,r,a){if(this.disallowBlockEffectsFor[a]&&i instanceof js){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(i instanceof js)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new vs(i.widget||Zr.block,o,i));else{let l=rr.create(i.widget||Zr.inline,o,o?0:i.startSide),c=this.atCursorPos&&!l.isEditable&&r<=s.length&&(e<t||i.startSide>0),u=!l.isEditable&&(e<t||r>s.length||i.startSide<=0),h=this.getLine();this.pendingBuffer==2&&!c&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(s),c&&(h.append(yo(new jr(1),s),r),r=s.length+Math.max(0,r-s.length)),h.append(yo(l,s),r),this.atCursorPos=u,this.pendingBuffer=u?e<t||r>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=r)}static build(e,t,i,s,r){let a=new Da(e,t,i,r);return a.openEnd=St.spans(s,t,i,a),a.openStart<0&&(a.openStart=a.openEnd),a.finish(a.openEnd),a}}function yo(n,e){for(let t of e)n=new Ss(t,[n],n.length);return n}class Zr extends Hr{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Zr.inline=new Zr("span");Zr.block=new Zr("div");var gn=(function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n})(gn||(gn={}));const Or=gn.LTR,wd=gn.RTL;function p1(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const bA=p1("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),vA=p1("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Oh=Object.create(null),qi=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);Oh[e]=t,Oh[t]=-e}function m1(n){return n<=247?bA[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?vA[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8204?256:64336<=n&&n<=65023?4:1}const SA=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class Rs{get dir(){return this.level%2?wd:Or}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,s){let r=-1;for(let a=0;a<e.length;a++){let o=e[a];if(o.from<=t&&o.to>=t){if(o.level==i)return a;(r<0||(s!=0?s<0?o.from<t:o.to>t:e[r].level>o.level))&&(r=a)}}if(r<0)throw new RangeError("Index out of range");return r}}function g1(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++){let i=n[t],s=e[t];if(i.from!=s.from||i.to!=s.to||i.direction!=s.direction||!g1(i.inner,s.inner))return!1}return!0}const It=[];function wA(n,e,t,i,s){for(let r=0;r<=i.length;r++){let a=r?i[r-1].to:e,o=r<i.length?i[r].from:t,l=r?256:s;for(let c=a,u=l,h=l;c<o;c++){let d=m1(n.charCodeAt(c));d==512?d=u:d==8&&h==4&&(d=16),It[c]=d==4?2:d,d&7&&(h=d),u=d}for(let c=a,u=l,h=l;c<o;c++){let d=It[c];if(d==128)c<o-1&&u==It[c+1]&&u&24?d=It[c]=u:It[c]=256;else if(d==64){let f=c+1;for(;f<o&&It[f]==64;)f++;let m=c&&u==8||f<t&&It[f]==8?h==1?1:8:256;for(let g=c;g<f;g++)It[g]=m;c=f-1}else d==8&&h==1&&(It[c]=1);u=d,d&7&&(h=d)}}}function CA(n,e,t,i,s){let r=s==1?2:1;for(let a=0,o=0,l=0;a<=i.length;a++){let c=a?i[a-1].to:e,u=a<i.length?i[a].from:t;for(let h=c,d,f,m;h<u;h++)if(f=Oh[d=n.charCodeAt(h)])if(f<0){for(let g=o-3;g>=0;g-=3)if(qi[g+1]==-f){let y=qi[g+2],b=y&2?s:y&4?y&1?r:s:0;b&&(It[h]=It[qi[g]]=b),o=g;break}}else{if(qi.length==189)break;qi[o++]=h,qi[o++]=d,qi[o++]=l}else if((m=It[h])==2||m==1){let g=m==s;l=g?0:1;for(let y=o-3;y>=0;y-=3){let b=qi[y+2];if(b&2)break;if(g)qi[y+2]|=2;else{if(b&4)break;qi[y+2]|=4}}}}}function PA(n,e,t,i){for(let s=0,r=i;s<=t.length;s++){let a=s?t[s-1].to:n,o=s<t.length?t[s].from:e;for(let l=a;l<o;){let c=It[l];if(c==256){let u=l+1;for(;;)if(u==o){if(s==t.length)break;u=t[s++].to,o=s<t.length?t[s].from:e}else if(It[u]==256)u++;else break;let h=r==1,d=(u<e?It[u]:i)==1,f=h==d?h?1:2:i;for(let m=u,g=s,y=g?t[g-1].to:n;m>l;)m==y&&(m=t[--g].from,y=g?t[g-1].to:n),It[--m]=f;l=u}else r=c,l++}}}function yh(n,e,t,i,s,r,a){let o=i%2?2:1;if(i%2==s%2)for(let l=e,c=0;l<t;){let u=!0,h=!1;if(c==r.length||l<r[c].from){let g=It[l];g!=o&&(u=!1,h=g==16)}let d=!u&&o==1?[]:null,f=u?i:i+1,m=l;e:for(;;)if(c<r.length&&m==r[c].from){if(h)break e;let g=r[c];if(!u)for(let y=g.to,b=c+1;;){if(y==t)break e;if(b<r.length&&r[b].from==y)y=r[b++].to;else{if(It[y]==o)break e;break}}if(c++,d)d.push(g);else{g.from>l&&a.push(new Rs(l,g.from,f));let y=g.direction==Or!=!(f%2);bh(n,y?i+1:i,s,g.inner,g.from,g.to,a),l=g.to}m=g.to}else{if(m==t||(u?It[m]!=o:It[m]==o))break;m++}d?yh(n,l,m,i+1,s,d,a):l<m&&a.push(new Rs(l,m,f)),l=m}else for(let l=t,c=r.length;l>e;){let u=!0,h=!1;if(!c||l>r[c-1].to){let g=It[l-1];g!=o&&(u=!1,h=g==16)}let d=!u&&o==1?[]:null,f=u?i:i+1,m=l;e:for(;;)if(c&&m==r[c-1].to){if(h)break e;let g=r[--c];if(!u)for(let y=g.from,b=c;;){if(y==e)break e;if(b&&r[b-1].to==y)y=r[--b].from;else{if(It[y-1]==o)break e;break}}if(d)d.push(g);else{g.to<l&&a.push(new Rs(g.to,l,f));let y=g.direction==Or!=!(f%2);bh(n,y?i+1:i,s,g.inner,g.from,g.to,a),l=g.from}m=g.from}else{if(m==e||(u?It[m-1]!=o:It[m-1]==o))break;m--}d?yh(n,m,l,i+1,s,d,a):m<l&&a.push(new Rs(m,l,f)),l=m}}function bh(n,e,t,i,s,r,a){let o=e%2?2:1;wA(n,s,r,i,o),CA(n,s,r,i,o),PA(s,r,i,o),yh(n,s,r,e,t,i,a)}function AA(n,e,t){if(!n)return[new Rs(0,0,e==wd?1:0)];if(e==Or&&!t.length&&!SA.test(n))return O1(n.length);if(t.length)for(;n.length>It.length;)It[It.length]=256;let i=[],s=e==Or?0:1;return bh(n,s,s,t,0,n.length,i),i}function O1(n){return[new Rs(0,n,0)]}let y1="";function xA(n,e,t,i,s){var r;let a=i.head-n.from,o=Rs.find(e,a,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc),l=e[o],c=l.side(s,t);if(a==c){let d=o+=s?1:-1;if(d<0||d>=e.length)return null;l=e[o=d],a=l.side(!s,t),c=l.side(s,t)}let u=In(n.text,a,l.forward(s,t));(u<l.from||u>l.to)&&(u=c),y1=n.text.slice(Math.min(a,u),Math.max(a,u));let h=o==(s?e.length-1:0)?null:e[o+(s?1:-1)];return h&&u==c&&h.level+(s?0:1)<l.level?ce.cursor(h.side(!s,t)+n.from,h.forward(s,t)?1:-1,h.level):ce.cursor(u+n.from,l.forward(s,t)?-1:1,l.level)}function EA(n,e,t){for(let i=e;i<t;i++){let s=m1(n.charCodeAt(i));if(s==1)return Or;if(s==2||s==4)return wd}return Or}const b1=Ie.define(),v1=Ie.define(),S1=Ie.define(),w1=Ie.define(),vh=Ie.define(),C1=Ie.define(),P1=Ie.define(),Cd=Ie.define(),Pd=Ie.define(),A1=Ie.define({combine:n=>n.some(e=>e)}),kA=Ie.define({combine:n=>n.some(e=>e)}),x1=Ie.define();class Lr{constructor(e,t="nearest",i="nearest",s=5,r=5,a=!1){this.range=e,this.y=t,this.x=i,this.yMargin=s,this.xMargin=r,this.isSnapshot=a}map(e){return e.empty?this:new Lr(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new Lr(ce.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const bo=xt.define({map:(n,e)=>n.map(e)}),E1=xt.define();function ts(n,e,t){let i=n.facet(w1);i.length?i[0](e):window.onerror&&window.onerror(String(e),t,void 0,void 0,e)||(t?console.error(t+":",e):console.error(e))}const ys=Ie.define({combine:n=>n.length?n[0]:!0});let MA=0;const Nr=Ie.define({combine(n){return n.filter((e,t)=>{for(let i=0;i<t;i++)if(n[i].plugin==e.plugin)return!1;return!0})}});class hs{constructor(e,t,i,s,r){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=s,this.baseExtensions=r(this),this.extension=this.baseExtensions.concat(Nr.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(Nr.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:i,eventObservers:s,provide:r,decorations:a}=t||{};return new hs(MA++,e,i,s,o=>{let l=[];return a&&l.push(za.of(c=>{let u=c.plugin(o);return u?a(u):it.none})),r&&l.push(r(o)),l})}static fromClass(e,t){return hs.define((i,s)=>new e(i,s),t)}}class Tu{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(ts(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){ts(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){ts(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const k1=Ie.define(),Ad=Ie.define(),za=Ie.define(),M1=Ie.define(),to=Ie.define(),D1=Ie.define();function op(n,e){let t=n.state.facet(D1);if(!t.length)return t;let i=t.map(r=>r instanceof Function?r(n):r),s=[];return St.spans(i,e.from,e.to,{point(){},span(r,a,o,l){let c=r-e.from,u=a-e.from,h=s;for(let d=o.length-1;d>=0;d--,l--){let f=o[d].spec.bidiIsolate,m;if(f==null&&(f=EA(e.text,c,u)),l>0&&h.length&&(m=h[h.length-1]).to==c&&m.direction==f)m.to=u,h=m.inner;else{let g={from:c,to:u,direction:f,inner:[]};h.push(g),h=g.inner}}}}),s}const $1=Ie.define();function T1(n){let e=0,t=0,i=0,s=0;for(let r of n.state.facet($1)){let a=r(n);a&&(a.left!=null&&(e=Math.max(e,a.left)),a.right!=null&&(t=Math.max(t,a.right)),a.top!=null&&(i=Math.max(i,a.top)),a.bottom!=null&&(s=Math.max(s,a.bottom)))}return{left:e,right:t,top:i,bottom:s}}const wa=Ie.define();class vi{constructor(e,t,i,s){this.fromA=e,this.toA=t,this.fromB=i,this.toB=s}join(e){return new vi(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let s=e[t-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let s=0,r=0,a=0,o=0;;s++){let l=s==e.length?null:e[s],c=a-o,u=l?l.fromB:1e9;for(;r<t.length&&t[r]<u;){let h=t[r],d=t[r+1],f=Math.max(o,h),m=Math.min(u,d);if(f<=m&&new vi(f+c,m+c,f,m).addToSet(i),d>u)break;r+=2}if(!l)return i;new vi(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),a=l.toA,o=l.toB}}}class ll{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=pn.empty(this.startState.doc.length);for(let r of i)this.changes=this.changes.compose(r.changes);let s=[];this.changes.iterChangedRanges((r,a,o,l)=>s.push(new vi(r,a,o,l))),this.changedRanges=s}static create(e,t,i){return new ll(e,t,i)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class lp extends Dt{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=it.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new on],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new vi(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:c,toA:u})=>u<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?s=this.domChanged.newSel.head:!FA(e.changes,this.hasComposition)&&!e.selectionSet&&(s=e.state.selection.main.head));let r=s>-1?$A(this.view,e.changes,s):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:c,to:u}=this.hasComposition;i=new vi(c,u,e.changes.mapPos(c,-1),e.changes.mapPos(u,1)).addToSet(i.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(ke.ie||ke.chrome)&&!r&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let a=this.decorations,o=this.updateDeco(),l=NA(a,o,e.changes);return i=vi.extendWithRanges(i,l),!(this.flags&7)&&i.length==0?!1:(this.updateInner(i,e.startState.doc.length,r),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,i);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let a=ke.chrome||ke.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,a),this.flags&=-8,a&&(a.written||s.selectionRange.focusNode!=a.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(a=>a.flags&=-9);let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let a of this.children)a instanceof vs&&a.widget instanceof gh&&r.push(a.dom);s.updateGaps(r)}updateChildren(e,t,i){let s=i?i.range.addToSet(e.slice()):e,r=this.childCursor(t);for(let a=s.length-1;;a--){let o=a>=0?s[a]:null;if(!o)break;let{fromA:l,toA:c,fromB:u,toB:h}=o,d,f,m,g;if(i&&i.range.fromB<h&&i.range.toB>u){let v=Da.build(this.view.state.doc,u,i.range.fromB,this.decorations,this.dynamicDecorationMap),C=Da.build(this.view.state.doc,i.range.toB,h,this.decorations,this.dynamicDecorationMap);f=v.breakAtStart,m=v.openStart,g=C.openEnd;let E=this.compositionView(i);C.breakAtStart?E.breakAfter=1:C.content.length&&E.merge(E.length,E.length,C.content[0],!1,C.openStart,0)&&(E.breakAfter=C.content[0].breakAfter,C.content.shift()),v.content.length&&E.merge(0,0,v.content[v.content.length-1],!0,0,v.openEnd)&&v.content.pop(),d=v.content.concat(E).concat(C.content)}else({content:d,breakAtStart:f,openStart:m,openEnd:g}=Da.build(this.view.state.doc,u,h,this.decorations,this.dynamicDecorationMap));let{i:y,off:b}=r.findPos(c,1),{i:P,off:M}=r.findPos(l,-1);l1(this,P,M,y,b,d,f,m,g)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let i of t.effects)i.is(E1)&&(this.editContextFormatting=i.value)}compositionView(e){let t=new Ri(e.text.nodeValue);t.flags|=8;for(let{deco:s}of e.marks)t=new Ss(s,[t],t.length);let i=new on;return i.append(t,0),i}fixCompositionDOM(e){let t=(r,a)=>{a.flags|=8|(a.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(a);let o=Dt.get(r);o&&o!=a&&(o.dom=null),a.setDOM(r)},i=this.childPos(e.range.fromB,1),s=this.children[i.i];t(e.line,s);for(let r=e.marks.length-1;r>=-1;r--)i=s.childPos(i.off,1),s=s.children[i.i],t(r>=0?e.marks[r].node:e.text,s)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let i=this.view.root.activeElement,s=i==this.dom,r=!s&&!(this.view.state.facet(ys)||this.dom.tabIndex>-1)&&qo(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(s||t||r))return;let a=this.forceSelection;this.forceSelection=!1;let o=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(o.anchor)),c=o.empty?l:this.moveToLine(this.domAtPos(o.head));if(ke.gecko&&o.empty&&!this.hasComposition&&DA(l)){let h=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(h,l.node.childNodes[l.offset]||null)),l=c=new Tn(h,0),a=!0}let u=this.view.observer.selectionRange;(a||!u.focusNode||(!Ma(l.node,l.offset,u.anchorNode,u.anchorOffset)||!Ma(c.node,c.offset,u.focusNode,u.focusOffset))&&!this.suppressWidgetCursorChange(u,o))&&(this.view.observer.ignore(()=>{ke.android&&ke.chrome&&this.dom.contains(u.focusNode)&&BA(u.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=Qa(this.view.root);if(h)if(o.empty){if(ke.gecko){let d=TA(l.node,l.offset);if(d&&d!=3){let f=(d==1?r1:a1)(l.node,l.offset);f&&(l=new Tn(f.node,f.offset))}}h.collapse(l.node,l.offset),o.bidiLevel!=null&&h.caretBidiLevel!==void 0&&(h.caretBidiLevel=o.bidiLevel)}else if(h.extend){h.collapse(l.node,l.offset);try{h.extend(c.node,c.offset)}catch{}}else{let d=document.createRange();o.anchor>o.head&&([l,c]=[c,l]),d.setEnd(c.node,c.offset),d.setStart(l.node,l.offset),h.removeAllRanges(),h.addRange(d)}r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(l,c)),this.impreciseAnchor=l.precise?null:new Tn(u.anchorNode,u.anchorOffset),this.impreciseHead=c.precise?null:new Tn(u.focusNode,u.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&Ma(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=Qa(e.root),{anchorNode:s,anchorOffset:r}=e.observer.selectionRange;if(!i||!t.empty||!t.assoc||!i.modify)return;let a=on.find(this,t.head);if(!a)return;let o=a.posAtStart;if(t.head==o||t.head==o+a.length)return;let l=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!l||!c||l.bottom>c.top)return;let u=this.domAtPos(t.head+t.assoc);i.collapse(u.node,u.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=t.from&&i.collapse(s,r)}moveToLine(e){let t=this.dom,i;if(e.node!=t)return e;for(let s=e.offset;!i&&s<t.childNodes.length;s++){let r=Dt.get(t.childNodes[s]);r instanceof on&&(i=r.domAtPos(0))}for(let s=e.offset-1;!i&&s>=0;s--){let r=Dt.get(t.childNodes[s]);r instanceof on&&(i=r.domAtPos(r.length))}return i?new Tn(i.node,i.offset,!0):e}nearest(e){for(let t=e;t;){let i=Dt.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let s=this.children[t];if(i<s.length||s instanceof on)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){let i=null,s=0;for(let r=this.length,a=this.children.length-1;a>=0;a--){let o=this.children[a],l=r-o.breakAfter,c=l-o.length;if(l<e)break;if(c<=e&&(c<e||o.covers(-1))&&(l>e||o.covers(1))&&(!i||o instanceof on&&!(i instanceof on&&t>=0)))i=o,s=c;else if(i&&c==e&&l==e&&o instanceof vs&&Math.abs(t)<2){if(o.deco.startSide<0)break;a&&(i=null)}r=c}return i?i.coordsAt(e-s,t):null}coordsForChar(e){let{i:t,off:i}=this.childPos(e,1),s=this.children[t];if(!(s instanceof on))return null;for(;s.children.length;){let{i:o,off:l}=s.childPos(i,1);for(;;o++){if(o==s.children.length)return null;if((s=s.children[o]).length)break}i=l}if(!(s instanceof Ri))return null;let r=In(s.text,i);if(r==i)return null;let a=gr(s.dom,i,r).getClientRects();for(let o=0;o<a.length;o++){let l=a[o];if(o==a.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(e){let t=[],{from:i,to:s}=e,r=this.view.contentDOM.clientWidth,a=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,l=this.view.textDirection==gn.LTR;for(let c=0,u=0;u<this.children.length;u++){let h=this.children[u],d=c+h.length;if(d>s)break;if(c>=i){let f=h.dom.getBoundingClientRect();if(t.push(f.height),a){let m=h.dom.lastChild,g=m?Va(m):[];if(g.length){let y=g[g.length-1],b=l?y.right-f.left:f.right-y.left;b>o&&(o=b,this.minWidth=r,this.minWidthFrom=c,this.minWidthTo=d)}}}c=d+h.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?gn.RTL:gn.LTR}measureTextSize(){for(let r of this.children)if(r instanceof on){let a=r.measureTextSize();if(a)return a}let e=document.createElement("div"),t,i,s;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=Va(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,s=r?r.height:t,e.remove()}),{lineHeight:t,charWidth:i,textHeight:s}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new o1(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,s=0;;s++){let r=s==t.viewports.length?null:t.viewports[s],a=r?r.from-1:this.length;if(a>i){let o=(t.lineBlockAt(a).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(it.replace({widget:new gh(o),block:!0,inclusive:!0,isBlockGap:!0}).range(i,a))}if(!r)break;i=r.to+1}return it.set(e)}updateDeco(){let e=1,t=this.view.state.facet(za).map(r=>(this.dynamicDecorationMap[e++]=typeof r=="function")?r(this.view):r),i=!1,s=this.view.state.facet(M1).map((r,a)=>{let o=typeof r=="function";return o&&(i=!0),o?r(this.view):r});for(s.length&&(this.dynamicDecorationMap[e++]=i,t.push(St.join(s))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(x1))try{if(c(this.view,e.range,e))return!0}catch(u){ts(this.view.state,u,"scroll handler")}let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),s;if(!i)return;!t.empty&&(s=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,s.left),top:Math.min(i.top,s.top),right:Math.max(i.right,s.right),bottom:Math.max(i.bottom,s.bottom)});let r=T1(this.view),a={left:i.left-r.left,top:i.top-r.top,right:i.right+r.right,bottom:i.bottom+r.bottom},{offsetWidth:o,offsetHeight:l}=this.view.scrollDOM;lA(this.view.scrollDOM,a,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,l),-l),this.view.textDirection==gn.LTR)}}function DA(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}function _1(n,e){let t=n.observer.selectionRange;if(!t.focusNode)return null;let i=r1(t.focusNode,t.focusOffset),s=a1(t.focusNode,t.focusOffset),r=i||s;if(s&&i&&s.node!=i.node){let o=Dt.get(s.node);if(!o||o instanceof Ri&&o.text!=s.node.nodeValue)r=s;else if(n.docView.lastCompositionAfterCursor){let l=Dt.get(i.node);!l||l instanceof Ri&&l.text!=i.node.nodeValue||(r=s)}}if(n.docView.lastCompositionAfterCursor=r!=i,!r)return null;let a=e-r.offset;return{from:a,to:a+r.node.nodeValue.length,node:r.node}}function $A(n,e,t){let i=_1(n,t);if(!i)return null;let{node:s,from:r,to:a}=i,o=s.nodeValue;if(/[\n\r]/.test(o)||n.state.doc.sliceString(i.from,i.to)!=o)return null;let l=e.invertedDesc,c=new vi(l.mapPos(r),l.mapPos(a),r,a),u=[];for(let h=s.parentNode;;h=h.parentNode){let d=Dt.get(h);if(d instanceof Ss)u.push({node:h,deco:d.mark});else{if(d instanceof on||h.nodeName=="DIV"&&h.parentNode==n.contentDOM)return{range:c,text:s,marks:u,line:h};if(h!=n.contentDOM)u.push({node:h,deco:new Ja({inclusive:!0,attributes:OA(h),tagName:h.tagName.toLowerCase()})});else return null}}}function TA(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}let _A=class{constructor(){this.changes=[]}compareRange(e,t){Wo(e,t,this.changes)}comparePoint(e,t){Wo(e,t,this.changes)}boundChange(e){Wo(e,e,this.changes)}};function NA(n,e,t){let i=new _A;return St.compare(n,e,t,i),i.changes}function BA(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function FA(n,e){let t=!1;return e&&n.iterChangedRanges((i,s)=>{i<e.to&&s>e.from&&(t=!0)}),t}function RA(n,e,t=1){let i=n.charCategorizer(e),s=n.doc.lineAt(e),r=e-s.from;if(s.length==0)return ce.cursor(e);r==0?t=1:r==s.length&&(t=-1);let a=r,o=r;t<0?a=In(s.text,r,!1):o=In(s.text,r);let l=i(s.text.slice(a,o));for(;a>0;){let c=In(s.text,a,!1);if(i(s.text.slice(c,a))!=l)break;a=c}for(;o<s.length;){let c=In(s.text,o);if(i(s.text.slice(o,c))!=l)break;o=c}return ce.range(a+s.from,o+s.from)}function IA(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function LA(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function _u(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function up(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function cp(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function Sh(n,e,t){let i,s,r,a,o=!1,l,c,u,h;for(let m=n.firstChild;m;m=m.nextSibling){let g=Va(m);for(let y=0;y<g.length;y++){let b=g[y];s&&_u(s,b)&&(b=up(cp(b,s.bottom),s.top));let P=IA(e,b),M=LA(t,b);if(P==0&&M==0)return m.nodeType==3?hp(m,e,t):Sh(m,e,t);(!i||a>M||a==M&&r>P)&&(i=m,s=b,r=P,a=M,o=P?e<b.left?y>0:y<g.length-1:!0),P==0?t>b.bottom&&(!u||u.bottom<b.bottom)?(l=m,u=b):t<b.top&&(!h||h.top>b.top)&&(c=m,h=b):u&&_u(u,b)?u=cp(u,b.bottom):h&&_u(h,b)&&(h=up(h,b.top))}}if(u&&u.bottom>=t?(i=l,s=u):h&&h.top<=t&&(i=c,s=h),!i)return{node:n,offset:0};let d=Math.max(s.left,Math.min(s.right,e));if(i.nodeType==3)return hp(i,d,t);if(o&&i.contentEditable!="false")return Sh(i,d,t);let f=Array.prototype.indexOf.call(n.childNodes,i)+(e>=(s.left+s.right)/2?1:0);return{node:n,offset:f}}function hp(n,e,t){let i=n.nodeValue.length,s=-1,r=1e9,a=0;for(let o=0;o<i;o++){let l=gr(n,o,o+1).getClientRects();for(let c=0;c<l.length;c++){let u=l[c];if(u.top==u.bottom)continue;a||(a=e-u.left);let h=(u.top>t?u.top-t:t-u.bottom)-1;if(u.left-1<=e&&u.right+1>=e&&h<r){let d=e>=(u.left+u.right)/2,f=d;if((ke.chrome||ke.gecko)&&gr(n,o).getBoundingClientRect().left==u.right&&(f=!d),h<=0)return{node:n,offset:o+(f?1:0)};s=o+(f?1:0),r=h}}}return{node:n,offset:s>-1?s:a>0?n.nodeValue.length:0}}function N1(n,e,t,i=-1){var s,r;let a=n.contentDOM.getBoundingClientRect(),o=a.top+n.viewState.paddingTop,l,{docHeight:c}=n.viewState,{x:u,y:h}=e,d=h-o;if(d<0)return 0;if(d>c)return n.state.doc.length;for(let v=n.viewState.heightOracle.textHeight/2,C=!1;l=n.elementAtHeight(d),l.type!=bi.Text;)for(;d=i>0?l.bottom+v:l.top-v,!(d>=0&&d<=c);){if(C)return t?null:0;C=!0,i=-i}h=o+d;let f=l.from;if(f<n.viewport.from)return n.viewport.from==0?0:t?null:dp(n,a,l,u,h);if(f>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:t?null:dp(n,a,l,u,h);let m=n.dom.ownerDocument,g=n.root.elementFromPoint?n.root:m,y=g.elementFromPoint(u,h);y&&!n.contentDOM.contains(y)&&(y=null),y||(u=Math.max(a.left+1,Math.min(a.right-1,u)),y=g.elementFromPoint(u,h),y&&!n.contentDOM.contains(y)&&(y=null));let b,P=-1;if(y&&((s=n.docView.nearest(y))===null||s===void 0?void 0:s.isEditable)!=!1){if(m.caretPositionFromPoint){let v=m.caretPositionFromPoint(u,h);v&&({offsetNode:b,offset:P}=v)}else if(m.caretRangeFromPoint){let v=m.caretRangeFromPoint(u,h);v&&({startContainer:b,startOffset:P}=v)}b&&(!n.contentDOM.contains(b)||ke.safari&&QA(b,P,u)||ke.chrome&&VA(b,P,u))&&(b=void 0),b&&(P=Math.min(cs(b),P))}if(!b||!n.docView.dom.contains(b)){let v=on.find(n.docView,f);if(!v)return d>l.top+l.height/2?l.to:l.from;({node:b,offset:P}=Sh(v.dom,u,h))}let M=n.docView.nearest(b);if(!M)return null;if(M.isWidget&&((r=M.dom)===null||r===void 0?void 0:r.nodeType)==1){let v=M.dom.getBoundingClientRect();return e.y<v.top||e.y<=v.bottom&&e.x<=(v.left+v.right)/2?M.posAtStart:M.posAtEnd}else return M.localPosFromDOM(b,P)+M.posAtStart}function dp(n,e,t,i,s){let r=Math.round((i-e.left)*n.defaultCharacterWidth);if(n.lineWrapping&&t.height>n.defaultLineHeight*1.5){let o=n.viewState.heightOracle.textHeight,l=Math.floor((s-t.top-(n.defaultLineHeight-o)*.5)/o);r+=l*n.viewState.heightOracle.lineLength}let a=n.state.sliceDoc(t.from,t.to);return t.from+tA(a,r,n.state.tabSize)}function B1(n,e,t){let i,s=n;if(n.nodeType!=3||e!=(i=n.nodeValue.length))return!1;for(;;){let r=s.nextSibling;if(r){if(r.nodeName=="BR")break;return!1}else{let a=s.parentNode;if(!a||a.nodeName=="DIV")break;s=a}}return gr(n,i-1,i).getBoundingClientRect().right>t}function QA(n,e,t){return B1(n,e,t)}function VA(n,e,t){if(e!=0)return B1(n,e,t);for(let s=n;;){let r=s.parentNode;if(!r||r.nodeType!=1||r.firstChild!=s)return!1;if(r.classList.contains("cm-line"))break;s=r}let i=n.nodeType==1?n.getBoundingClientRect():gr(n,0,Math.max(n.nodeValue.length,1)).getBoundingClientRect();return t-i.left>5}function zA(n,e,t){let i=n.lineBlockAt(e);if(Array.isArray(i.type)){let s;for(let r of i.type){if(r.from>e)break;if(!(r.to<e)){if(r.from<e&&r.to>e)return r;(!s||r.type==bi.Text&&(s.type!=r.type||(t<0?r.from<e:r.to>e)))&&(s=r)}}return s||i}return i}function jA(n,e,t,i){let s=zA(n,e.head,e.assoc||-1),r=!i||s.type!=bi.Text||!(n.lineWrapping||s.widgetLineBreaks)?null:n.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head);if(r){let a=n.dom.getBoundingClientRect(),o=n.textDirectionAt(s.from),l=n.posAtCoords({x:t==(o==gn.LTR)?a.right-1:a.left+1,y:(r.top+r.bottom)/2});if(l!=null)return ce.cursor(l,t?-1:1)}return ce.cursor(t?s.to:s.from,t?-1:1)}function fp(n,e,t,i){let s=n.state.doc.lineAt(e.head),r=n.bidiSpans(s),a=n.textDirectionAt(s.from);for(let o=e,l=null;;){let c=xA(s,r,a,o,t),u=y1;if(!c){if(s.number==(t?n.state.doc.lines:1))return o;u=`
`,s=n.state.doc.line(s.number+(t?1:-1)),r=n.bidiSpans(s),c=n.visualLineSide(s,!t)}if(l){if(!l(u))return o}else{if(!i)return c;l=i(u)}o=c}}function ZA(n,e,t){let i=n.state.charCategorizer(e),s=i(t);return r=>{let a=i(r);return s==_n.Space&&(s=a),s==a}}function GA(n,e,t,i){let s=e.head,r=t?1:-1;if(s==(t?n.state.doc.length:0))return ce.cursor(s,e.assoc);let a=e.goalColumn,o,l=n.contentDOM.getBoundingClientRect(),c=n.coordsAtPos(s,e.assoc||-1),u=n.documentTop;if(c)a==null&&(a=c.left-l.left),o=r<0?c.top:c.bottom;else{let f=n.viewState.lineBlockAt(s);a==null&&(a=Math.min(l.right-l.left,n.defaultCharacterWidth*(s-f.from))),o=(r<0?f.top:f.bottom)+u}let h=l.left+a,d=i??n.viewState.heightOracle.textHeight>>1;for(let f=0;;f+=10){let m=o+(d+f)*r,g=N1(n,{x:h,y:m},!1,r);if(m<l.top||m>l.bottom||(r<0?g<s:g>s)){let y=n.docView.coordsForChar(g),b=!y||m<y.top?-1:1;return ce.cursor(g,b,void 0,a)}}}function $a(n,e,t){for(;;){let i=0;for(let s of n)s.between(e-1,e+1,(r,a,o)=>{if(e>r&&e<a){let l=i||t||(e-r<a-e?-1:1);e=l<0?r:a,i=l}});if(!i)return e}}function F1(n,e){let t=null;for(let i=0;i<e.ranges.length;i++){let s=e.ranges[i],r=null;if(s.empty){let a=$a(n,s.from,0);a!=s.from&&(r=ce.cursor(a,-1))}else{let a=$a(n,s.from,-1),o=$a(n,s.to,1);(a!=s.from||o!=s.to)&&(r=ce.range(s.from==s.anchor?a:o,s.from==s.head?a:o))}r&&(t||(t=e.ranges.slice()),t[i]=r)}return t?ce.create(t,e.mainIndex):e}function Nu(n,e,t){let i=$a(n.state.facet(to).map(s=>s(n)),t.from,e.head>t.from?-1:1);return i==t.from?t:ce.cursor(i,i<t.from?1:-1)}const Ca="￿";class UA{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(At.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Ca}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let s=e;;){this.findPointBefore(i,s);let r=this.text.length;this.readNode(s);let a=s.nextSibling;if(a==t)break;let o=Dt.get(s),l=Dt.get(a);(o&&l?o.breakAfter:(o?o.breakAfter:al(s))||al(a)&&(s.nodeName!="BR"||s.cmIgnore)&&this.text.length>r)&&!WA(a,t)&&this.lineBreak(),s=a}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,a=1,o;if(this.lineSeparator?(r=t.indexOf(this.lineSeparator,i),a=this.lineSeparator.length):(o=s.exec(t))&&(r=o.index,a=o[0].length),this.append(t.slice(i,r<0?t.length:r)),r<0)break;if(this.lineBreak(),a>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=a-1);i=r+a}}readNode(e){if(e.cmIgnore)return;let t=Dt.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let s=i.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(qA(e,i.node,i.offset)?t:0))}}function qA(n,e,t){for(;;){if(!e||t<cs(e))return!1;if(e==n)return!0;t=mr(e)+1,e=e.parentNode}}function WA(n,e){let t;for(;!(n==e||!n);n=n.nextSibling){let i=Dt.get(n);if(!(i!=null&&i.isWidget||n.cmIgnore))return!1;i&&(t||(t=[])).push(i)}if(t)for(let i of t){let s=i.overrideDOMText;if(s!=null&&s.length)return!1}return!0}class pp{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class XA{constructor(e,t,i,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:r,impreciseAnchor:a}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let o=r||a?[]:YA(e),l=new UA(o,e.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=KA(o,this.bounds.from)}else{let o=e.observer.selectionRange,l=r&&r.node==o.focusNode&&r.offset==o.focusOffset||!fh(e.contentDOM,o.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(o.focusNode,o.focusOffset),c=a&&a.node==o.anchorNode&&a.offset==o.anchorOffset||!fh(e.contentDOM,o.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(o.anchorNode,o.anchorOffset),u=e.viewport;if((ke.ios||ke.chrome)&&e.state.selection.main.empty&&l!=c&&(u.from>0||u.to<e.state.doc.length)){let h=Math.min(l,c),d=Math.max(l,c),f=u.from-h,m=u.to-d;(f==0||f==1||h==0)&&(m==0||m==-1||d==e.state.doc.length)&&(l=0,c=e.state.doc.length)}this.newSel=ce.single(c,l)}}}function R1(n,e){let t,{newSel:i}=e,s=n.state.selection.main,r=n.inputState.lastKeyTime>Date.now()-100?n.inputState.lastKeyCode:-1;if(e.bounds){let{from:a,to:o}=e.bounds,l=s.from,c=null;(r===8||ke.android&&e.text.length<o-a)&&(l=s.to,c="end");let u=I1(n.state.doc.sliceString(a,o,Ca),e.text,l-a,c);u&&(ke.chrome&&r==13&&u.toB==u.from+2&&e.text.slice(u.from,u.toB)==Ca+Ca&&u.toB--,t={from:a+u.from,to:a+u.toA,insert:gt.of(e.text.slice(u.from,u.toB).split(Ca))})}else i&&(!n.hasFocus&&n.state.facet(ys)||i.main.eq(s))&&(i=null);if(!t&&!i)return!1;if(!t&&e.typeOver&&!s.empty&&i&&i.main.empty?t={from:s.from,to:s.to,insert:n.state.doc.slice(s.from,s.to)}:(ke.mac||ke.android)&&t&&t.from==t.to&&t.from==s.head-1&&/^\. ?$/.test(t.insert.toString())&&n.contentDOM.getAttribute("autocorrect")=="off"?(i&&t.insert.length==2&&(i=ce.single(i.main.anchor-1,i.main.head-1)),t={from:t.from,to:t.to,insert:gt.of([t.insert.toString().replace("."," ")])}):t&&t.from>=s.from&&t.to<=s.to&&(t.from!=s.from||t.to!=s.to)&&s.to-s.from-(t.to-t.from)<=4?t={from:s.from,to:s.to,insert:n.state.doc.slice(s.from,t.from).append(t.insert).append(n.state.doc.slice(t.to,s.to))}:ke.chrome&&t&&t.from==t.to&&t.from==s.head&&t.insert.toString()==`
 `&&n.lineWrapping&&(i&&(i=ce.single(i.main.anchor-1,i.main.head-1)),t={from:s.from,to:s.to,insert:gt.of([" "])}),t)return xd(n,t,i,r);if(i&&!i.main.eq(s)){let a=!1,o="select";return n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(a=!0),o=n.inputState.lastSelectionOrigin,o=="select.pointer"&&(i=F1(n.state.facet(to).map(l=>l(n)),i))),n.dispatch({selection:i,scrollIntoView:a,userEvent:o}),!0}else return!1}function xd(n,e,t,i=-1){if(ke.ios&&n.inputState.flushIOSKey(e))return!0;let s=n.state.selection.main;if(ke.android&&(e.to==s.to&&(e.from==s.from||e.from==s.from-1&&n.state.sliceDoc(e.from,s.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&Ir(n.contentDOM,"Enter",13)||(e.from==s.from-1&&e.to==s.to&&e.insert.length==0||i==8&&e.insert.length<e.to-e.from&&e.to>s.head)&&Ir(n.contentDOM,"Backspace",8)||e.from==s.from&&e.to==s.to+1&&e.insert.length==0&&Ir(n.contentDOM,"Delete",46)))return!0;let r=e.insert.toString();n.inputState.composing>=0&&n.inputState.composing++;let a,o=()=>a||(a=HA(n,e,t));return n.state.facet(C1).some(l=>l(n,e.from,e.to,r,o))||n.dispatch(o()),!0}function HA(n,e,t){let i,s=n.state,r=s.selection.main,a=-1;if(e.from==e.to&&e.from<r.from||e.from>r.to){let l=e.from<r.from?-1:1,c=l<0?r.from:r.to,u=$a(s.facet(to).map(h=>h(n)),c,l);e.from==u&&(a=u)}if(a>-1)i={changes:e,selection:ce.cursor(e.from+e.insert.length,-1)};else if(e.from>=r.from&&e.to<=r.to&&e.to-e.from>=(r.to-r.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&n.inputState.composing<0){let l=r.from<e.from?s.sliceDoc(r.from,e.from):"",c=r.to>e.to?s.sliceDoc(e.to,r.to):"";i=s.replaceSelection(n.state.toText(l+e.insert.sliceString(0,void 0,n.state.lineBreak)+c))}else{let l=s.changes(e),c=t&&t.main.to<=l.newLength?t.main:void 0;if(s.selection.ranges.length>1&&n.inputState.composing>=0&&e.to<=r.to&&e.to>=r.to-10){let u=n.state.sliceDoc(e.from,e.to),h,d=t&&_1(n,t.main.head);if(d){let g=e.insert.length-(e.to-e.from);h={from:d.from,to:d.to-g}}else h=n.state.doc.lineAt(r.head);let f=r.to-e.to,m=r.to-r.from;i=s.changeByRange(g=>{if(g.from==r.from&&g.to==r.to)return{changes:l,range:c||g.map(l)};let y=g.to-f,b=y-u.length;if(g.to-g.from!=m||n.state.sliceDoc(b,y)!=u||g.to>=h.from&&g.from<=h.to)return{range:g};let P=s.changes({from:b,to:y,insert:e.insert}),M=g.to-r.to;return{changes:P,range:c?ce.range(Math.max(0,c.anchor+M),Math.max(0,c.head+M)):g.map(P)}})}else i={changes:l,selection:c&&s.selection.replaceRange(c)}}let o="input.type";return(n.composing||n.inputState.compositionPendingChange&&n.inputState.compositionEndedAt>Date.now()-50)&&(n.inputState.compositionPendingChange=!1,o+=".compose",n.inputState.compositionFirstChange&&(o+=".start",n.inputState.compositionFirstChange=!1)),s.update(i,{userEvent:o,scrollIntoView:!0})}function I1(n,e,t,i){let s=Math.min(n.length,e.length),r=0;for(;r<s&&n.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&n.length==e.length)return null;let a=n.length,o=e.length;for(;a>0&&o>0&&n.charCodeAt(a-1)==e.charCodeAt(o-1);)a--,o--;if(i=="end"){let l=Math.max(0,r-Math.min(a,o));t-=a+l-r}if(a<r&&n.length<e.length){let l=t<=r&&t>=a?r-t:0;r-=l,o=r+(o-a),a=r}else if(o<r){let l=t<=r&&t>=o?r-t:0;r-=l,a=r+(a-o),o=r}return{from:r,toA:a,toB:o}}function YA(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:s,focusOffset:r}=n.observer.selectionRange;return t&&(e.push(new pp(t,i)),(s!=t||r!=i)&&e.push(new pp(s,r))),e}function KA(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?ce.single(t+e,i+e):null}class JA{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,ke.safari&&e.contentDOM.addEventListener("input",()=>null),ke.gecko&&mx(e.contentDOM.ownerDocument)}handleEvent(e){!ox(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,t){let i=this.handlers[e];if(i){for(let s of i.observers)s(this.view,t);for(let s of i.handlers){if(t.defaultPrevented)break;if(s(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=ex(e),i=this.handlers,s=this.view.contentDOM;for(let r in t)if(r!="scroll"){let a=!t[r].handlers.length,o=i[r];o&&a!=!o.handlers.length&&(s.removeEventListener(r,this.handleEvent),o=null),o||s.addEventListener(r,this.handleEvent,{passive:a})}for(let r in i)r!="scroll"&&!t[r]&&s.removeEventListener(r,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&Q1.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),ke.android&&ke.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return ke.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=L1.find(i=>i.keyCode==e.keyCode))&&!e.ctrlKey||tx.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,Ir(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:ke.safari&&!ke.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function mp(n,e){return(t,i)=>{try{return e.call(n,i,t)}catch(s){ts(t.state,s)}}}function ex(n){let e=Object.create(null);function t(i){return e[i]||(e[i]={observers:[],handlers:[]})}for(let i of n){let s=i.spec,r=s&&s.plugin.domEventHandlers,a=s&&s.plugin.domEventObservers;if(r)for(let o in r){let l=r[o];l&&t(o).handlers.push(mp(i.value,l))}if(a)for(let o in a){let l=a[o];l&&t(o).observers.push(mp(i.value,l))}}for(let i in Ii)t(i).handlers.push(Ii[i]);for(let i in Si)t(i).observers.push(Si[i]);return e}const L1=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],tx="dthko",Q1=[16,17,18,20,91,92,224,225],vo=6;function So(n){return Math.max(0,n)*.7+8}function nx(n,e){return Math.max(Math.abs(n.clientX-e.clientX),Math.abs(n.clientY-e.clientY))}class ix{constructor(e,t,i,s){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=uA(e.contentDOM),this.atoms=e.state.facet(to).map(a=>a(e));let r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(At.allowMultipleSelections)&&sx(e,t),this.dragging=ax(e,t)&&j1(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&nx(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,i=0,s=0,r=0,a=this.view.win.innerWidth,o=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:a}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:r,bottom:o}=this.scrollParents.y.getBoundingClientRect());let l=T1(this.view);e.clientX-l.left<=s+vo?t=-So(s-e.clientX):e.clientX+l.right>=a-vo&&(t=So(e.clientX-a)),e.clientY-l.top<=r+vo?i=-So(r-e.clientY):e.clientY+l.bottom>=o-vo&&(i=So(e.clientY-o)),this.setScrollSpeed(t,i)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:t}=this,i=F1(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!i.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function sx(n,e){let t=n.state.facet(b1);return t.length?t[0](e):ke.mac?e.metaKey:e.ctrlKey}function rx(n,e){let t=n.state.facet(v1);return t.length?t[0](e):ke.mac?!e.altKey:!e.ctrlKey}function ax(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=Qa(n.root);if(!i||i.rangeCount==0)return!0;let s=i.getRangeAt(0).getClientRects();for(let r=0;r<s.length;r++){let a=s[r];if(a.left<=e.clientX&&a.right>=e.clientX&&a.top<=e.clientY&&a.bottom>=e.clientY)return!0}return!1}function ox(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=Dt.get(t))&&i.ignoreEvent(e))return!1;return!0}const Ii=Object.create(null),Si=Object.create(null),V1=ke.ie&&ke.ie_version<15||ke.ios&&ke.webkit_version<604;function lx(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),z1(n,t.value)},50)}function Zl(n,e,t){for(let i of n.facet(e))t=i(t,n);return t}function z1(n,e){e=Zl(n.state,Cd,e);let{state:t}=n,i,s=1,r=t.toText(e),a=r.lines==t.selection.ranges.length;if(wh!=null&&t.selection.ranges.every(l=>l.empty)&&wh==r.toString()){let l=-1;i=t.changeByRange(c=>{let u=t.doc.lineAt(c.from);if(u.from==l)return{range:c};l=u.from;let h=t.toText((a?r.line(s++).text:e)+t.lineBreak);return{changes:{from:u.from,insert:h},range:ce.cursor(c.from+h.length)}})}else a?i=t.changeByRange(l=>{let c=r.line(s++);return{changes:{from:l.from,to:l.to,insert:c.text},range:ce.cursor(l.from+c.length)}}):i=t.replaceSelection(r);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Si.scroll=n=>{n.inputState.lastScrollTop=n.scrollDOM.scrollTop,n.inputState.lastScrollLeft=n.scrollDOM.scrollLeft};Ii.keydown=(n,e)=>(n.inputState.setSelectionOrigin("select"),e.keyCode==27&&n.inputState.tabFocusMode!=0&&(n.inputState.tabFocusMode=Date.now()+2e3),!1);Si.touchstart=(n,e)=>{n.inputState.lastTouchTime=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};Si.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};Ii.mousedown=(n,e)=>{if(n.observer.flush(),n.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let i of n.state.facet(S1))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=hx(n,e)),t){let i=!n.hasFocus;n.inputState.startMouseSelection(new ix(n,e,t,i)),i&&n.observer.ignore(()=>{n1(n.contentDOM);let r=n.root.activeElement;r&&!r.contains(n.contentDOM)&&r.blur()});let s=n.inputState.mouseSelection;if(s)return s.start(e),s.dragging===!1}else n.inputState.setSelectionOrigin("select.pointer");return!1};function gp(n,e,t,i){if(i==1)return ce.cursor(e,t);if(i==2)return RA(n.state,e,t);{let s=on.find(n.docView,e),r=n.state.doc.lineAt(s?s.posAtEnd:e),a=s?s.posAtStart:r.from,o=s?s.posAtEnd:r.to;return o<n.state.doc.length&&o==r.to&&o++,ce.range(a,o)}}let Op=(n,e,t)=>e>=t.top&&e<=t.bottom&&n>=t.left&&n<=t.right;function ux(n,e,t,i){let s=on.find(n.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(r==0)return 1;if(r==s.length)return-1;let a=s.coordsAt(r,-1);if(a&&Op(t,i,a))return-1;let o=s.coordsAt(r,1);return o&&Op(t,i,o)?1:a&&a.bottom>=i?-1:1}function yp(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:ux(n,t,e.clientX,e.clientY)}}const cx=ke.ie&&ke.ie_version<=11;let bp=null,vp=0,Sp=0;function j1(n){if(!cx)return n.detail;let e=bp,t=Sp;return bp=n,Sp=Date.now(),vp=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(vp+1)%3:1}function hx(n,e){let t=yp(n,e),i=j1(e),s=n.state.selection;return{update(r){r.docChanged&&(t.pos=r.changes.mapPos(t.pos),s=s.map(r.changes))},get(r,a,o){let l=yp(n,r),c,u=gp(n,l.pos,l.bias,i);if(t.pos!=l.pos&&!a){let h=gp(n,t.pos,t.bias,i),d=Math.min(h.from,u.from),f=Math.max(h.to,u.to);u=d<u.from?ce.range(d,f):ce.range(f,d)}return a?s.replaceRange(s.main.extend(u.from,u.to)):o&&i==1&&s.ranges.length>1&&(c=dx(s,l.pos))?c:o?s.addRange(u):ce.create([u])}}}function dx(n,e){for(let t=0;t<n.ranges.length;t++){let{from:i,to:s}=n.ranges[t];if(i<=e&&s>=e)return ce.create(n.ranges.slice(0,t).concat(n.ranges.slice(t+1)),n.mainIndex==t?0:n.mainIndex-(n.mainIndex>t?1:0))}return null}Ii.dragstart=(n,e)=>{let{selection:{main:t}}=n.state;if(e.target.draggable){let s=n.docView.nearest(e.target);if(s&&s.isWidget){let r=s.posAtStart,a=r+s.length;(r>=t.to||a<=t.from)&&(t=ce.range(r,a))}}let{inputState:i}=n;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",Zl(n.state,Pd,n.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Ii.dragend=n=>(n.inputState.draggedContent=null,!1);function wp(n,e,t,i){if(t=Zl(n.state,Cd,t),!t)return;let s=n.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:r}=n.inputState,a=i&&r&&rx(n,e)?{from:r.from,to:r.to}:null,o={from:s,insert:t},l=n.state.changes(a?[a,o]:o);n.focus(),n.dispatch({changes:l,selection:{anchor:l.mapPos(s,-1),head:l.mapPos(s,1)},userEvent:a?"move.drop":"input.drop"}),n.inputState.draggedContent=null}Ii.drop=(n,e)=>{if(!e.dataTransfer)return!1;if(n.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let i=Array(t.length),s=0,r=()=>{++s==t.length&&wp(n,e,i.filter(a=>a!=null).join(n.state.lineBreak),!1)};for(let a=0;a<t.length;a++){let o=new FileReader;o.onerror=r,o.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(o.result)||(i[a]=o.result),r()},o.readAsText(t[a])}return!0}else{let i=e.dataTransfer.getData("Text");if(i)return wp(n,e,i,!0),!0}return!1};Ii.paste=(n,e)=>{if(n.state.readOnly)return!0;n.observer.flush();let t=V1?null:e.clipboardData;return t?(z1(n,t.getData("text/plain")||t.getData("text/uri-list")),!0):(lx(n),!1)};function fx(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function px(n){let e=[],t=[],i=!1;for(let s of n.selection.ranges)s.empty||(e.push(n.sliceDoc(s.from,s.to)),t.push(s));if(!e.length){let s=-1;for(let{from:r}of n.selection.ranges){let a=n.doc.lineAt(r);a.number>s&&(e.push(a.text),t.push({from:a.from,to:Math.min(n.doc.length,a.to+1)})),s=a.number}i=!0}return{text:Zl(n,Pd,e.join(n.lineBreak)),ranges:t,linewise:i}}let wh=null;Ii.copy=Ii.cut=(n,e)=>{let{text:t,ranges:i,linewise:s}=px(n.state);if(!t&&!s)return!1;wh=s?t:null,e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let r=V1?null:e.clipboardData;return r?(r.clearData(),r.setData("text/plain",t),!0):(fx(n,t),!1)};const Z1=Ps.define();function G1(n,e){let t=[];for(let i of n.facet(P1)){let s=i(n,e);s&&t.push(s)}return t.length?n.update({effects:t,annotations:Z1.of(!0)}):null}function U1(n){setTimeout(()=>{let e=n.hasFocus;if(e!=n.inputState.notifiedFocused){let t=G1(n.state,e);t?n.dispatch(t):n.update([])}},10)}Si.focus=n=>{n.inputState.lastFocusTime=Date.now(),!n.scrollDOM.scrollTop&&(n.inputState.lastScrollTop||n.inputState.lastScrollLeft)&&(n.scrollDOM.scrollTop=n.inputState.lastScrollTop,n.scrollDOM.scrollLeft=n.inputState.lastScrollLeft),U1(n)};Si.blur=n=>{n.observer.clearSelectionRange(),U1(n)};Si.compositionstart=Si.compositionupdate=n=>{n.observer.editContext||(n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0))};Si.compositionend=n=>{n.observer.editContext||(n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionPendingKey=!0,n.inputState.compositionPendingChange=n.observer.pendingRecords().length>0,n.inputState.compositionFirstChange=null,ke.chrome&&ke.android?n.observer.flushSoon():n.inputState.compositionPendingChange?Promise.resolve().then(()=>n.observer.flush()):setTimeout(()=>{n.inputState.composing<0&&n.docView.hasComposition&&n.update([])},50))};Si.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};Ii.beforeinput=(n,e)=>{var t,i;if(e.inputType=="insertReplacementText"&&n.observer.editContext){let r=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),a=e.getTargetRanges();if(r&&a.length){let o=a[0],l=n.posAtDOM(o.startContainer,o.startOffset),c=n.posAtDOM(o.endContainer,o.endOffset);return xd(n,{from:l,to:c,insert:n.state.toText(r)},null),!0}}let s;if(ke.chrome&&ke.android&&(s=L1.find(r=>r.inputType==e.inputType))&&(n.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let r=((i=window.visualViewport)===null||i===void 0?void 0:i.height)||0;setTimeout(()=>{var a;(((a=window.visualViewport)===null||a===void 0?void 0:a.height)||0)>r+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}return ke.ios&&e.inputType=="deleteContentForward"&&n.observer.flushSoon(),ke.safari&&e.inputType=="insertText"&&n.inputState.composing>=0&&setTimeout(()=>Si.compositionend(n,e),20),!1};const Cp=new Set;function mx(n){Cp.has(n)||(Cp.add(n),n.addEventListener("copy",()=>{}),n.addEventListener("cut",()=>{}))}const Pp=["pre-wrap","normal","pre-line","break-spaces"];let Gr=!1;function Ap(){Gr=!1}class gx{constructor(e){this.lineWrapping=e,this.doc=gt.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return Pp.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let s=e[i];s<0?i++:this.heightSamples[Math.floor(s*10)]||(t=!0,this.heightSamples[Math.floor(s*10)]=!0)}return t}refresh(e,t,i,s,r,a){let o=Pp.indexOf(e)>-1,l=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=i,this.textHeight=s,this.lineLength=r,l){this.heightSamples={};for(let c=0;c<a.length;c++){let u=a[c];u<0?c++:this.heightSamples[Math.floor(u*10)]=!0}}return l}}class Ox{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class es{constructor(e,t,i,s,r){this.from=e,this.length=t,this.top=i,this.height=s,this._content=r}get type(){return typeof this._content=="number"?bi.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof js?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new es(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var jt=(function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n})(jt||(jt={}));const Xo=.001;class Ln{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>Xo&&(Gr=!0),this.height=e)}replace(e,t,i){return Ln.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,s){let r=this,a=i.doc;for(let o=s.length-1;o>=0;o--){let{fromA:l,toA:c,fromB:u,toB:h}=s[o],d=r.lineAt(l,jt.ByPosNoHeight,i.setDoc(t),0,0),f=d.to>=c?d:r.lineAt(c,jt.ByPosNoHeight,i,0,0);for(h+=f.to-c,c=f.to;o>0&&d.from<=s[o-1].toA;)l=s[o-1].fromA,u=s[o-1].fromB,o--,l<d.from&&(d=r.lineAt(l,jt.ByPosNoHeight,i,0,0));u+=d.from-l,l=d.from;let m=Ed.build(i.setDoc(a),e,u,h);r=ul(r,r.replace(l,c,m))}return r.updateHeight(i,0)}static empty(){return new si(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,s=0,r=0;for(;;)if(t==i)if(s>r*2){let o=e[t-1];o.break?e.splice(--t,1,o.left,null,o.right):e.splice(--t,1,o.left,o.right),i+=1+o.break,s-=o.size}else if(r>s*2){let o=e[i];o.break?e.splice(i,1,o.left,null,o.right):e.splice(i,1,o.left,o.right),i+=2+o.break,r-=o.size}else break;else if(s<r){let o=e[t++];o&&(s+=o.size)}else{let o=e[--i];o&&(r+=o.size)}let a=0;return e[t-1]==null?(a=1,t--):e[t]==null&&(a=1,i++),new yx(Ln.of(e.slice(0,t)),a,Ln.of(e.slice(i)))}}function ul(n,e){return n==e?n:(n.constructor!=e.constructor&&(Gr=!0),e)}Ln.prototype.size=1;class q1 extends Ln{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,s){return new es(s,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,s,r){return this.blockAt(0,i,s,r)}forEachLine(e,t,i,s,r,a){e<=r+this.length&&t>=r&&a(this.blockAt(0,i,s,r))}updateHeight(e,t=0,i=!1,s){return s&&s.from<=t&&s.more&&this.setHeight(s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class si extends q1{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,s){return new es(s,this.length,i,this.height,this.breaks)}replace(e,t,i){let s=i[0];return i.length==1&&(s instanceof si||s instanceof An&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof An?s=new si(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Ln.of(i)}updateHeight(e,t=0,i=!1,s){return s&&s.from<=t&&s.more?this.setHeight(s.heights[s.index++]):(i||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class An extends Ln{constructor(e){super(e,0)}heightMetrics(e,t){let i=e.doc.lineAt(t).number,s=e.doc.lineAt(t+this.length).number,r=s-i+1,a,o=0;if(e.lineWrapping){let l=Math.min(this.height,e.lineHeight*r);a=l/r,this.length>r+1&&(o=(this.height-l)/(this.length-r-1))}else a=this.height/r;return{firstLine:i,lastLine:s,perLine:a,perChar:o}}blockAt(e,t,i,s){let{firstLine:r,lastLine:a,perLine:o,perChar:l}=this.heightMetrics(t,s);if(t.lineWrapping){let c=s+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length)),u=t.doc.lineAt(c),h=o+u.length*l,d=Math.max(i,e-h/2);return new es(u.from,u.length,d,h,0)}else{let c=Math.max(0,Math.min(a-r,Math.floor((e-i)/o))),{from:u,length:h}=t.doc.line(r+c);return new es(u,h,i+o*c,o,0)}}lineAt(e,t,i,s,r){if(t==jt.ByHeight)return this.blockAt(e,i,s,r);if(t==jt.ByPosNoHeight){let{from:f,to:m}=i.doc.lineAt(e);return new es(f,m-f,0,0,0)}let{firstLine:a,perLine:o,perChar:l}=this.heightMetrics(i,r),c=i.doc.lineAt(e),u=o+c.length*l,h=c.number-a,d=s+o*h+l*(c.from-r-h);return new es(c.from,c.length,Math.max(s,Math.min(d,s+this.height-u)),u,0)}forEachLine(e,t,i,s,r,a){e=Math.max(e,r),t=Math.min(t,r+this.length);let{firstLine:o,perLine:l,perChar:c}=this.heightMetrics(i,r);for(let u=e,h=s;u<=t;){let d=i.doc.lineAt(u);if(u==e){let m=d.number-o;h+=l*m+c*(e-r-m)}let f=l+c*d.length;a(new es(d.from,d.length,h,f,0)),h+=f,u=d.to+1}}replace(e,t,i){let s=this.length-t;if(s>0){let r=i[i.length-1];r instanceof An?i[i.length-1]=new An(r.length+s):i.push(null,new An(s-1))}if(e>0){let r=i[0];r instanceof An?i[0]=new An(e+r.length):i.unshift(new An(e-1),null)}return Ln.of(i)}decomposeLeft(e,t){t.push(new An(e-1),null)}decomposeRight(e,t){t.push(null,new An(this.length-e-1))}updateHeight(e,t=0,i=!1,s){let r=t+this.length;if(s&&s.from<=t+this.length&&s.more){let a=[],o=Math.max(t,s.from),l=-1;for(s.from>t&&a.push(new An(s.from-t-1).updateHeight(e,t));o<=r&&s.more;){let u=e.doc.lineAt(o).length;a.length&&a.push(null);let h=s.heights[s.index++];l==-1?l=h:Math.abs(h-l)>=Xo&&(l=-2);let d=new si(u,h);d.outdated=!1,a.push(d),o+=u+1}o<=r&&a.push(null,new An(r-o).updateHeight(e,o));let c=Ln.of(a);return(l<0||Math.abs(c.height-this.height)>=Xo||Math.abs(l-this.heightMetrics(e,t).perLine)>=Xo)&&(Gr=!0),ul(this,c)}else(i||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class yx extends Ln{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,s){let r=i+this.left.height;return e<r?this.left.blockAt(e,t,i,s):this.right.blockAt(e,t,r,s+this.left.length+this.break)}lineAt(e,t,i,s,r){let a=s+this.left.height,o=r+this.left.length+this.break,l=t==jt.ByHeight?e<a:e<o,c=l?this.left.lineAt(e,t,i,s,r):this.right.lineAt(e,t,i,a,o);if(this.break||(l?c.to<o:c.from>o))return c;let u=t==jt.ByPosNoHeight?jt.ByPosNoHeight:jt.ByPos;return l?c.join(this.right.lineAt(o,u,i,a,o)):this.left.lineAt(o,u,i,s,r).join(c)}forEachLine(e,t,i,s,r,a){let o=s+this.left.height,l=r+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,t,i,s,r,a),t>=l&&this.right.forEachLine(e,t,i,o,l,a);else{let c=this.lineAt(l,jt.ByPos,i,s,r);e<c.from&&this.left.forEachLine(e,c.from-1,i,s,r,a),c.to>=e&&c.from<=t&&a(c),t>c.to&&this.right.forEachLine(c.to+1,t,i,o,l,a)}}replace(e,t,i){let s=this.left.length+this.break;if(t<s)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,t-s,i));let r=[];e>0&&this.decomposeLeft(e,r);let a=r.length;for(let o of i)r.push(o);if(e>0&&xp(r,a-1),t<this.length){let o=r.length;this.decomposeRight(t,r),xp(r,o)}return Ln.of(r)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,s=i+this.break;if(e>=s)return this.right.decomposeRight(e-s,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<s&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Ln.of(this.break?[e,null,t]:[e,t]):(this.left=ul(this.left,e),this.right=ul(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,s){let{left:r,right:a}=this,o=t+r.length+this.break,l=null;return s&&s.from<=t+r.length&&s.more?l=r=r.updateHeight(e,t,i,s):r.updateHeight(e,t,i),s&&s.from<=o+a.length&&s.more?l=a=a.updateHeight(e,o,i,s):a.updateHeight(e,o,i),l?this.balanced(r,a):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function xp(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof An&&(i=n[e+1])instanceof An&&n.splice(e-1,3,new An(t.length+1+i.length))}const bx=5;class Ed{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof si?s.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new si(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0,r=i.widget?i.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let a=t-e;i.block?this.addBlock(new q1(a,s,i)):(a||r||s>=bx)&&this.addLineDeco(s,r,a)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new si(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new An(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof si)return e;let t=new si(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let s=this.ensureLine();s.length+=i,s.collapsed+=i,s.widgetHeight=Math.max(s.widgetHeight,e),s.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof si)&&!this.isCovered?this.nodes.push(new si(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let s of this.nodes)s instanceof si&&s.updateHeight(this.oracle,i),i+=s?s.length:1;return this.nodes}static build(e,t,i,s){let r=new Ed(i,e);return St.spans(t,i,s,r,0),r.finish(i)}}function vx(n,e,t){let i=new Sx;return St.compare(n,e,t,i,0),i.changes}class Sx{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,s){(e<t||i&&i.heightRelevant||s&&s.heightRelevant)&&Wo(e,t,this.changes,5)}}function wx(n,e){let t=n.getBoundingClientRect(),i=n.ownerDocument,s=i.defaultView||window,r=Math.max(0,t.left),a=Math.min(s.innerWidth,t.right),o=Math.max(0,t.top),l=Math.min(s.innerHeight,t.bottom);for(let c=n.parentNode;c&&c!=i.body;)if(c.nodeType==1){let u=c,h=window.getComputedStyle(u);if((u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth)&&h.overflow!="visible"){let d=u.getBoundingClientRect();r=Math.max(r,d.left),a=Math.min(a,d.right),o=Math.max(o,d.top),l=Math.min(c==n.parentNode?s.innerHeight:l,d.bottom)}c=h.position=="absolute"||h.position=="fixed"?u.offsetParent:u.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:r-t.left,right:Math.max(r,a)-t.left,top:o-(t.top+e),bottom:Math.max(o,l)-(t.top+e)}}function Cx(n){let e=n.getBoundingClientRect(),t=n.ownerDocument.defaultView||window;return e.left<t.innerWidth&&e.right>0&&e.top<t.innerHeight&&e.bottom>0}function Px(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class Bu{constructor(e,t,i,s){this.from=e,this.to=t,this.size=i,this.displaySize=s}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let s=e[i],r=t[i];if(s.from!=r.from||s.to!=r.to||s.size!=r.size)return!1}return!0}draw(e,t){return it.replace({widget:new Ax(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class Ax extends Hr{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class Ep{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=kp,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=gn.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Ad).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new gx(t),this.stateDeco=e.facet(za).filter(i=>typeof i!="function"),this.heightMap=Ln.empty().applyChanges(this.stateDeco,gt.empty,this.heightOracle.setDoc(e.doc),[new vi(0,0,0,e.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=it.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let s=i?t.head:t.anchor;if(!e.some(({from:r,to:a})=>s>=r&&s<=a)){let{from:r,to:a}=this.lineBlockAt(s);e.push(new wo(r,a))}}return this.viewports=e.sort((i,s)=>i.from-s.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?kp:new kd(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(Pa(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(za).filter(u=>typeof u!="function");let s=e.changedRanges,r=vi.extendWithRanges(s,vx(i,this.stateDeco,e?e.changes:pn.empty(this.state.doc.length))),a=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);Ap(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),r),(this.heightMap.height!=a||Gr)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=a);let l=r.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<l.from||t.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,t));let c=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(kA)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),s=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?gn.RTL:gn.LTR;let a=this.heightOracle.mustRefreshForWrapping(r),o=t.getBoundingClientRect(),l=a||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let c=0,u=0;if(o.width&&o.height){let{scaleX:v,scaleY:C}=t1(t,o);(v>.005&&Math.abs(this.scaleX-v)>.005||C>.005&&Math.abs(this.scaleY-C)>.005)&&(this.scaleX=v,this.scaleY=C,c|=16,a=l=!0)}let h=(parseInt(i.paddingTop)||0)*this.scaleY,d=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=h||this.paddingBottom!=d)&&(this.paddingTop=h,this.paddingBottom=d,c|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=16);let f=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=f&&(this.scrollAnchorHeight=-1,this.scrollTop=f),this.scrolledToBottom=s1(e.scrollDOM);let m=(this.printing?Px:wx)(t,this.paddingTop),g=m.top-this.pixelViewport.top,y=m.bottom-this.pixelViewport.bottom;this.pixelViewport=m;let b=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(b!=this.inView&&(this.inView=b,b&&(l=!0)),!this.inView&&!this.scrollTarget&&!Cx(e.dom))return 0;let P=o.width;if((this.contentDOMWidth!=P||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,c|=16),l){let v=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(v)&&(a=!0),a||s.lineWrapping&&Math.abs(P-this.contentDOMWidth)>s.charWidth){let{lineHeight:C,charWidth:E,textHeight:A}=e.docView.measureTextSize();a=C>0&&s.refresh(r,C,E,A,Math.max(5,P/E),v),a&&(e.docView.minWidth=0,c|=16)}g>0&&y>0?u=Math.max(g,y):g<0&&y<0&&(u=Math.min(g,y)),Ap();for(let C of this.viewports){let E=C.from==this.viewport.from?v:e.docView.measureVisibleLineHeights(C);this.heightMap=(a?Ln.empty().applyChanges(this.stateDeco,gt.empty,this.heightOracle,[new vi(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,a,new Ox(C.from,E))}Gr&&(c|=2)}let M=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return M&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(u,this.scrollTarget),c|=this.updateForViewport()),(c&2||M)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(a?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,r=this.heightOracle,{visibleTop:a,visibleBottom:o}=this,l=new wo(s.lineAt(a-i*1e3,jt.ByHeight,r,0,0).from,s.lineAt(o+(1-i)*1e3,jt.ByHeight,r,0,0).to);if(t){let{head:c}=t.range;if(c<l.from||c>l.to){let u=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),h=s.lineAt(c,jt.ByPos,r,0,0),d;t.y=="center"?d=(h.top+h.bottom)/2-u/2:t.y=="start"||t.y=="nearest"&&c<l.from?d=h.top:d=h.bottom-u,l=new wo(s.lineAt(d-1e3/2,jt.ByHeight,r,0,0).from,s.lineAt(d+u+1e3/2,jt.ByHeight,r,0,0).to)}}return l}mapViewport(e,t){let i=t.mapPos(e.from,-1),s=t.mapPos(e.to,1);return new wo(this.heightMap.lineAt(i,jt.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,jt.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,jt.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(t,jt.ByPos,this.heightOracle,0,0),{visibleTop:a,visibleBottom:o}=this;return(e==0||s<=a-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||r>=o+Math.max(10,Math.min(i,250)))&&s>a-2*1e3&&r<o+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let s of e)t.touchesRange(s.from,s.to)||i.push(new Bu(t.mapPos(s.from),t.mapPos(s.to),s.size,s.displaySize));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,s=i?1e4:2e3,r=s>>1,a=s<<1;if(this.defaultTextDirection!=gn.LTR&&!i)return[];let o=[],l=(u,h,d,f)=>{if(h-u<r)return;let m=this.state.selection.main,g=[m.from];m.empty||g.push(m.to);for(let b of g)if(b>u&&b<h){l(u,b-10,d,f),l(b+10,h,d,f);return}let y=Ex(e,b=>b.from>=d.from&&b.to<=d.to&&Math.abs(b.from-u)<r&&Math.abs(b.to-h)<r&&!g.some(P=>b.from<P&&b.to>P));if(!y){if(h<d.to&&t&&i&&t.visibleRanges.some(M=>M.from<=h&&M.to>=h)){let M=t.moveToLineBoundary(ce.cursor(h),!1,!0).head;M>u&&(h=M)}let b=this.gapSize(d,u,h,f),P=i||b<2e6?b:2e6;y=new Bu(u,h,b,P)}o.push(y)},c=u=>{if(u.length<a||u.type!=bi.Text)return;let h=xx(u.from,u.to,this.stateDeco);if(h.total<a)return;let d=this.scrollTarget?this.scrollTarget.range.head:null,f,m;if(i){let g=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,y,b;if(d!=null){let P=Po(h,d),M=((this.visibleBottom-this.visibleTop)/2+g)/u.height;y=P-M,b=P+M}else y=(this.visibleTop-u.top-g)/u.height,b=(this.visibleBottom-u.top+g)/u.height;f=Co(h,y),m=Co(h,b)}else{let g=h.total*this.heightOracle.charWidth,y=s*this.heightOracle.charWidth,b=0;if(g>2e6)for(let E of e)E.from>=u.from&&E.from<u.to&&E.size!=E.displaySize&&E.from*this.heightOracle.charWidth+b<this.pixelViewport.left&&(b=E.size-E.displaySize);let P=this.pixelViewport.left+b,M=this.pixelViewport.right+b,v,C;if(d!=null){let E=Po(h,d),A=((M-P)/2+y)/g;v=E-A,C=E+A}else v=(P-y)/g,C=(M+y)/g;f=Co(h,v),m=Co(h,C)}f>u.from&&l(u.from,f,u,h),m<u.to&&l(m,u.to,u,h)};for(let u of this.viewportLines)Array.isArray(u.type)?u.type.forEach(c):c(u);return o}gapSize(e,t,i,s){let r=Po(s,i)-Po(s,t);return this.heightOracle.lineWrapping?e.height*r:s.total*this.heightOracle.charWidth*r}updateLineGaps(e){Bu.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=it.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let i=[];St.spans(t,this.viewport.from,this.viewport.to,{span(r,a){i.push({from:r,to:a})},point(){}},20);let s=0;if(i.length!=this.visibleRanges.length)s=12;else for(let r=0;r<i.length&&!(s&8);r++){let a=this.visibleRanges[r],o=i[r];(a.from!=o.from||a.to!=o.to)&&(s|=4,e&&e.mapPos(a.from,-1)==o.from&&e.mapPos(a.to,1)==o.to||(s|=8))}return this.visibleRanges=i,s}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Pa(this.heightMap.lineAt(e,jt.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||Pa(this.heightMap.lineAt(this.scaler.fromDOM(e),jt.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Pa(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class wo{constructor(e,t){this.from=e,this.to=t}}function xx(n,e,t){let i=[],s=n,r=0;return St.spans(t,n,e,{span(){},point(a,o){a>s&&(i.push({from:s,to:a}),r+=a-s),s=o}},20),s<e&&(i.push({from:s,to:e}),r+=e-s),{total:r,ranges:i}}function Co({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let s=0;;s++){let{from:r,to:a}=e[s],o=a-r;if(i<=o)return r+i;i-=o}}function Po(n,e){let t=0;for(let{from:i,to:s}of n.ranges){if(e<=s){t+=e-i;break}t+=s-i}return t/n.total}function Ex(n,e){for(let t of n)if(e(t))return t}const kp={toDOM(n){return n},fromDOM(n){return n},scale:1,eq(n){return n==this}};class kd{constructor(e,t,i){let s=0,r=0,a=0;this.viewports=i.map(({from:o,to:l})=>{let c=t.lineAt(o,jt.ByPos,e,0,0).top,u=t.lineAt(l,jt.ByPos,e,0,0).bottom;return s+=u-c,{from:o,to:l,top:c,bottom:u,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(t.height-s);for(let o of this.viewports)o.domTop=a+(o.top-r)*this.scale,a=o.domBottom=o.domTop+(o.bottom-o.top),r=o.bottom}toDOM(e){for(let t=0,i=0,s=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.top)return s+(e-i)*this.scale;if(e<=r.bottom)return r.domTop+(e-r.top);i=r.bottom,s=r.domBottom}}fromDOM(e){for(let t=0,i=0,s=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.domTop)return i+(e-s)/this.scale;if(e<=r.domBottom)return r.top+(e-r.domTop);i=r.bottom,s=r.domBottom}}eq(e){return e instanceof kd?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,i)=>t.from==e.viewports[i].from&&t.to==e.viewports[i].to):!1}}function Pa(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new es(n.from,n.length,t,i-t,Array.isArray(n._content)?n._content.map(s=>Pa(s,e)):n._content)}const Ao=Ie.define({combine:n=>n.join(" ")}),Ch=Ie.define({combine:n=>n.indexOf(!0)>-1}),Ph=Vs.newName(),W1=Vs.newName(),X1=Vs.newName(),H1={"&light":"."+W1,"&dark":"."+X1};function Ah(n,e,t){return new Vs(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,s=>{if(s=="&")return n;if(!t||!t[s])throw new RangeError(`Unsupported selector: ${s}`);return t[s]}):n+" "+i}})}const kx=Ah("."+Ph,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},H1),Mx={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Fu=ke.ie&&ke.ie_version<=11;class Dx{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new cA,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let i of t)this.queue.push(i);(ke.ie&&ke.ie_version<=11||ke.ios&&e.composing)&&t.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&ke.android&&e.constructor.EDIT_CONTEXT!==!1&&!(ke.chrome&&ke.chrome_version<126)&&(this.editContext=new Tx(e),e.state.facet(ys)&&(e.contentDOM.editContext=this.editContext.editContext)),Fu&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,s=this.selectionRange;if(i.state.facet(ys)?i.root.activeElement!=this.dom:!qo(this.dom,s))return;let r=s.anchorNode&&i.docView.nearest(s.anchorNode);if(r&&r.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(ke.ie&&ke.ie_version<=11||ke.android&&ke.chrome)&&!i.state.selection.main.empty&&s.focusNode&&Ma(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=Qa(e.root);if(!t)return!1;let i=ke.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&$x(this.view,t)||t;if(!i||this.selectionRange.eq(i))return!1;let s=qo(this.dom,i);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&dA(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Mx),Fu&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Fu&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let s=()=>{let r=this.delayedAndroidKey;r&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=r.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&r.force&&Ir(this.dom,r.key,r.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,s=!1;for(let r of e){let a=this.readMutation(r);a&&(a.typeOver&&(s=!0),t==-1?{from:t,to:i}=a:(t=Math.min(a.from,t),i=Math.max(a.to,i)))}return{from:t,to:i,typeOver:s}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),s=this.selectionChanged&&qo(this.dom,this.selectionRange);if(e<0&&!s)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new XA(this.view,e,t,i);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,s=R1(this.view,t);return this.view.state==i&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),s}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let i=Mp(t,e.previousSibling||e.target.previousSibling,-1),s=Mp(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:s?t.posBefore(s):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(ys)!=e.state.facet(ys)&&(e.view.contentDOM.editContext=e.state.facet(ys)?this.editContext.editContext:null))}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Mp(n,e,t){for(;e;){let i=Dt.get(e);if(i&&i.parent==n)return i;let s=e.parentNode;e=s!=n.dom?s:t>0?e.nextSibling:e.previousSibling}return null}function Dp(n,e){let t=e.startContainer,i=e.startOffset,s=e.endContainer,r=e.endOffset,a=n.docView.domAtPos(n.state.selection.main.anchor);return Ma(a.node,a.offset,s,r)&&([t,i,s,r]=[s,r,t,i]),{anchorNode:t,anchorOffset:i,focusNode:s,focusOffset:r}}function $x(n,e){if(e.getComposedRanges){let s=e.getComposedRanges(n.root)[0];if(s)return Dp(n,s)}let t=null;function i(s){s.preventDefault(),s.stopImmediatePropagation(),t=s.getTargetRanges()[0]}return n.contentDOM.addEventListener("beforeinput",i,!0),n.dom.ownerDocument.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",i,!0),t?Dp(n,t):null}class Tx{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=i=>{let s=e.state.selection.main,{anchor:r,head:a}=s,o=this.toEditorPos(i.updateRangeStart),l=this.toEditorPos(i.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:i.updateRangeStart,editorBase:o,drifted:!1});let c=l-o>i.text.length;o==this.from&&r<this.from?o=r:l==this.to&&r>this.to&&(l=r);let u=I1(e.state.sliceDoc(o,l),i.text,(c?s.from:s.to)-o,c?"end":null);if(!u){let d=ce.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd));d.main.eq(s)||e.dispatch({selection:d,userEvent:"select"});return}let h={from:u.from+o,to:u.toA+o,insert:gt.of(i.text.slice(u.from,u.toB).split(`
`))};if((ke.mac||ke.android)&&h.from==a-1&&/^\. ?$/.test(i.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(h={from:o,to:l,insert:gt.of([i.text.replace("."," ")])}),this.pendingContextChange=h,!e.state.readOnly){let d=this.to-this.from+(h.to-h.from+h.insert.length);xd(e,h,ce.single(this.toEditorPos(i.selectionStart,d),this.toEditorPos(i.selectionEnd,d)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),h.from<h.to&&!h.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(t.text.slice(Math.max(0,i.updateRangeStart-1),Math.min(t.text.length,i.updateRangeStart+1)))&&this.handlers.compositionend(i)},this.handlers.characterboundsupdate=i=>{let s=[],r=null;for(let a=this.toEditorPos(i.rangeStart),o=this.toEditorPos(i.rangeEnd);a<o;a++){let l=e.coordsForChar(a);r=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||r||new DOMRect,s.push(r)}t.updateCharacterBounds(i.rangeStart,s)},this.handlers.textformatupdate=i=>{let s=[];for(let r of i.getTextFormats()){let a=r.underlineStyle,o=r.underlineThickness;if(!/none/i.test(a)&&!/none/i.test(o)){let l=this.toEditorPos(r.rangeStart),c=this.toEditorPos(r.rangeEnd);if(l<c){let u=`text-decoration: underline ${/^[a-z]/.test(a)?a+" ":a=="Dashed"?"dashed ":a=="Squiggle"?"wavy ":""}${/thin/i.test(o)?1:2}px`;s.push(it.mark({attributes:{style:u}}).range(l,c))}}}e.dispatch({effects:E1.of(it.set(s))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:i}=this.composing;this.composing=null,i&&this.reset(e.state)}};for(let i in this.handlers)t.addEventListener(i,this.handlers[i]);this.measureReq={read:i=>{this.editContext.updateControlBounds(i.contentDOM.getBoundingClientRect());let s=Qa(i.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,i=!1,s=this.pendingContextChange;return e.changes.iterChanges((r,a,o,l,c)=>{if(i)return;let u=c.length-(a-r);if(s&&a>=s.to)if(s.from==r&&s.to==a&&s.insert.eq(c)){s=this.pendingContextChange=null,t+=u,this.to+=u;return}else s=null,this.revertPending(e.state);if(r+=t,a+=t,a<=this.from)this.from+=u,this.to+=u;else if(r<this.to){if(r<this.from||a>this.to||this.to-this.from+c.length>3e4){i=!0;return}this.editContext.updateText(this.toContextPos(r),this.toContextPos(a),c.toString()),this.to+=u}t+=u}),s&&!i&&this.revertPending(e.state),!i}update(e){let t=this.pendingContextChange,i=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(i.from,i.to)&&e.transactions.some(s=>!s.isUserEvent("input.type")&&s.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),s=this.toContextPos(t.head);(this.editContext.selectionStart!=i||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(i,s)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let i=this.composing;return i&&i.drifted?i.editorBase+(e-i.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class Re{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:i}=e;this.dispatchTransactions=e.dispatchTransactions||i&&(s=>s.forEach(r=>i(r,this)))||(s=>this.update(s)),this.dispatch=this.dispatch.bind(this),this._root=e.root||hA(e.parent)||document,this.viewState=new Ep(e.state||At.create(e)),e.scrollTo&&e.scrollTo.is(bo)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(Nr).map(s=>new Tu(s));for(let s of this.plugins)s.update(this);this.observer=new Dx(this),this.inputState=new JA(this),this.inputState.ensureHandlers(this.plugins),this.docView=new lp(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=e.length==1&&e[0]instanceof ln?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i=!1,s,r=this.state;for(let d of e){if(d.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=d.state}if(this.destroyed){this.viewState.state=r;return}let a=this.hasFocus,o=0,l=null;e.some(d=>d.annotation(Z1))?(this.inputState.notifiedFocused=a,o=1):a!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=a,l=G1(r,a),l||(o=1));let c=this.observer.delayedAndroidKey,u=null;if(c?(this.observer.clearDelayedAndroidKey(),u=this.observer.readChange(),(u&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(u=null)):this.observer.clear(),r.facet(At.phrases)!=this.state.facet(At.phrases))return this.setState(r);s=ll.create(this,r,e),s.flags|=o;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let d of e){if(h&&(h=h.map(d.changes)),d.scrollIntoView){let{main:f}=d.state.selection;h=new Lr(f.empty?f:ce.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of d.effects)f.is(bo)&&(h=f.value.clip(this.state))}this.viewState.update(s,h),this.bidiCache=cl.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),t=this.docView.update(s),this.state.facet(wa)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(d=>d.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(Ao)!=s.state.facet(Ao)&&(this.viewState.mustMeasureContent=!0),(t||i||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!s.empty)for(let d of this.state.facet(vh))try{d(s)}catch(f){ts(this.state,f,"update listener")}(l||u)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),u&&!R1(this,u)&&c.force&&Ir(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new Ep(e),this.plugins=e.facet(Nr).map(i=>new Tu(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new lp(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Nr),i=e.state.facet(Nr);if(t!=i){let s=[];for(let r of i){let a=t.indexOf(r);if(a<0)s.push(new Tu(r));else{let o=this.plugins[a];o.mustUpdate=e,s.push(o)}}for(let r of this.plugins)r.mustUpdate!=e&&r.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(i){ts(this.state,i,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,s=i.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:a}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(a=-1),this.viewState.scrollAnchorHeight=-1;try{for(let o=0;;o++){if(a<0)if(s1(i))r=-1,a=this.viewState.heightMap.height;else{let f=this.viewState.scrollAnchorAt(s);r=f.from,a=f.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(o>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];l&4||([this.measureRequests,c]=[c,this.measureRequests]);let u=c.map(f=>{try{return f.read(this)}catch(m){return ts(this.state,m),$p}}),h=ll.create(this,this.state,[]),d=!1;h.flags|=l,t?t.flags|=l:t=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),d=this.docView.update(h),d&&this.docViewUpdate());for(let f=0;f<c.length;f++)if(u[f]!=$p)try{let m=c[f];m.write&&m.write(u[f],this)}catch(m){ts(this.state,m)}if(d&&this.docView.updateSelection(!0),!h.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,a=-1;continue}else{let m=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-a;if(m>1||m<-1){s=s+m,i.scrollTop=s/this.scaleY,a=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let o of this.state.facet(vh))o(t)}get themeClasses(){return Ph+" "+(this.state.facet(Ch)?X1:W1)+" "+this.state.facet(Ao)}updateAttrs(){let e=Tp(this,k1,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(ys)?"true":"false",class:"cm-content",style:`${ke.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),Tp(this,Ad,t);let i=this.observer.ignore(()=>{let s=mh(this.contentDOM,this.contentAttrs,t),r=mh(this.dom,this.editorAttrs,e);return s||r});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let s of i.effects)if(s.is(Re.announce)){t&&(this.announceDOM.textContent=""),t=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(wa);let e=this.state.facet(Re.cspNonce);Vs.mount(this.root,this.styleModules.concat(kx).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return Nu(this,e,fp(this,e,t,i))}moveByGroup(e,t){return Nu(this,e,fp(this,e,t,i=>ZA(this,e.head,i)))}visualLineSide(e,t){let i=this.bidiSpans(e),s=this.textDirectionAt(e.from),r=i[t?i.length-1:0];return ce.cursor(r.side(t,s)+e.from,r.forward(!t,s)?1:-1)}moveToLineBoundary(e,t,i=!0){return jA(this,e,t,i)}moveVertically(e,t,i){return Nu(this,e,GA(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),N1(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(e),r=this.bidiSpans(s),a=r[Rs.find(r,e-s.from,-1,t)];return jl(i,a.dir==gn.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(A1)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>_x)return O1(e.length);let t=this.textDirectionAt(e.from),i;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t&&(r.fresh||g1(r.isolates,i=op(this,e))))return r.order;i||(i=op(this,e));let s=AA(e.text,t,i);return this.bidiCache.push(new cl(e.from,e.to,t,i,!0,s)),s}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||ke.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{n1(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return bo.of(new Lr(typeof e=="number"?ce.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return bo.of(new Lr(ce.cursor(i.from),"start","start",i.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return hs.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return hs.define(()=>({}),{eventObservers:e})}static theme(e,t){let i=Vs.newName(),s=[Ao.of(i),wa.of(Ah(`.${i}`,e))];return t&&t.dark&&s.push(Ch.of(!0)),s}static baseTheme(e){return Ll.lowest(wa.of(Ah("."+Ph,e,H1)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),s=i&&Dt.get(i)||Dt.get(e);return((t=s==null?void 0:s.rootView)===null||t===void 0?void 0:t.view)||null}}Re.styleModule=wa;Re.inputHandler=C1;Re.clipboardInputFilter=Cd;Re.clipboardOutputFilter=Pd;Re.scrollHandler=x1;Re.focusChangeEffect=P1;Re.perLineTextDirection=A1;Re.exceptionSink=w1;Re.updateListener=vh;Re.editable=ys;Re.mouseSelectionStyle=S1;Re.dragMovesSelection=v1;Re.clickAddsSelectionRange=b1;Re.decorations=za;Re.outerDecorations=M1;Re.atomicRanges=to;Re.bidiIsolatedRanges=D1;Re.scrollMargins=$1;Re.darkTheme=Ch;Re.cspNonce=Ie.define({combine:n=>n.length?n[0]:""});Re.contentAttributes=Ad;Re.editorAttributes=k1;Re.lineWrapping=Re.contentAttributes.of({class:"cm-lineWrapping"});Re.announce=xt.define();const _x=4096,$p={};class cl{constructor(e,t,i,s,r,a){this.from=e,this.to=t,this.dir=i,this.isolates=s,this.fresh=r,this.order=a}static update(e,t){if(t.empty&&!e.some(r=>r.fresh))return e;let i=[],s=e.length?e[e.length-1].dir:gn.LTR;for(let r=Math.max(0,e.length-10);r<e.length;r++){let a=e[r];a.dir==s&&!t.touchesRange(a.from,a.to)&&i.push(new cl(t.mapPos(a.from,1),t.mapPos(a.to,-1),a.dir,a.isolates,!1,a.order))}return i}}function Tp(n,e,t){for(let i=n.state.facet(e),s=i.length-1;s>=0;s--){let r=i[s],a=typeof r=="function"?r(n):r;a&&ph(a,t)}return t}const Nx=ke.mac?"mac":ke.windows?"win":ke.linux?"linux":"key";function Bx(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let s,r,a,o;for(let l=0;l<t.length-1;++l){const c=t[l];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))s=!0;else if(/^(c|ctrl|control)$/i.test(c))r=!0;else if(/^s(hift)?$/i.test(c))a=!0;else if(/^mod$/i.test(c))e=="mac"?o=!0:r=!0;else throw new Error("Unrecognized modifier name: "+c)}return s&&(i="Alt-"+i),r&&(i="Ctrl-"+i),o&&(i="Meta-"+i),a&&(i="Shift-"+i),i}function xo(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const Fx=Ll.default(Re.domEventHandlers({keydown(n,e){return Qx(Rx(e.state),n,e,"editor")}})),Md=Ie.define({enables:Fx}),_p=new WeakMap;function Rx(n){let e=n.facet(Md),t=_p.get(e);return t||_p.set(e,t=Lx(e.reduce((i,s)=>i.concat(s),[]))),t}let Bs=null;const Ix=4e3;function Lx(n,e=Nx){let t=Object.create(null),i=Object.create(null),s=(a,o)=>{let l=i[a];if(l==null)i[a]=o;else if(l!=o)throw new Error("Key binding "+a+" is used both as a regular binding and as a multi-stroke prefix")},r=(a,o,l,c,u)=>{var h,d;let f=t[a]||(t[a]=Object.create(null)),m=o.split(/ (?!$)/).map(b=>Bx(b,e));for(let b=1;b<m.length;b++){let P=m.slice(0,b).join(" ");s(P,!0),f[P]||(f[P]={preventDefault:!0,stopPropagation:!1,run:[M=>{let v=Bs={view:M,prefix:P,scope:a};return setTimeout(()=>{Bs==v&&(Bs=null)},Ix),!0}]})}let g=m.join(" ");s(g,!1);let y=f[g]||(f[g]={preventDefault:!1,stopPropagation:!1,run:((d=(h=f._any)===null||h===void 0?void 0:h.run)===null||d===void 0?void 0:d.slice())||[]});l&&y.run.push(l),c&&(y.preventDefault=!0),u&&(y.stopPropagation=!0)};for(let a of n){let o=a.scope?a.scope.split(" "):["editor"];if(a.any)for(let c of o){let u=t[c]||(t[c]=Object.create(null));u._any||(u._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:h}=a;for(let d in u)u[d].run.push(f=>h(f,xh))}let l=a[e]||a.key;if(l)for(let c of o)r(c,l,a.run,a.preventDefault,a.stopPropagation),a.shift&&r(c,"Shift-"+l,a.shift,a.preventDefault,a.stopPropagation)}return t}let xh=null;function Qx(n,e,t,i){xh=e;let s=rA(e),r=vr(s,0),a=Ya(r)==s.length&&s!=" ",o="",l=!1,c=!1,u=!1;Bs&&Bs.view==t&&Bs.scope==i&&(o=Bs.prefix+" ",Q1.indexOf(e.keyCode)<0&&(c=!0,Bs=null));let h=new Set,d=y=>{if(y){for(let b of y.run)if(!h.has(b)&&(h.add(b),b(t)))return y.stopPropagation&&(u=!0),!0;y.preventDefault&&(y.stopPropagation&&(u=!0),c=!0)}return!1},f=n[i],m,g;return f&&(d(f[o+xo(s,e,!a)])?l=!0:a&&(e.altKey||e.metaKey||e.ctrlKey)&&!(ke.windows&&e.ctrlKey&&e.altKey)&&!(ke.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(m=zs[e.keyCode])&&m!=s?(d(f[o+xo(m,e,!0)])||e.shiftKey&&(g=La[e.keyCode])!=s&&g!=m&&d(f[o+xo(g,e,!1)]))&&(l=!0):a&&e.shiftKey&&d(f[o+xo(s,e,!0)])&&(l=!0),!l&&d(f._any)&&(l=!0)),c&&(l=!0),l&&u&&e.stopPropagation(),xh=null,l}class Zs extends pr{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Zs.prototype.elementClass="";Zs.prototype.toDOM=void 0;Zs.prototype.mapMode=$n.TrackBefore;Zs.prototype.startSide=Zs.prototype.endSide=-1;Zs.prototype.point=!0;const Ru=Ie.define(),Vx=Ie.define(),zx={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>St.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},Ta=Ie.define();function jx(n){return[Y1(),Ta.of({...zx,...n})]}const Np=Ie.define({combine:n=>n.some(e=>e)});function Y1(n){return[Zx]}const Zx=hs.fromClass(class{constructor(n){this.view=n,this.domAfter=null,this.prevViewport=n.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=n.state.facet(Ta).map(e=>new Fp(n,e)),this.fixed=!n.state.facet(Np);for(let e of this.gutters)e.config.side=="after"?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),n.scrollDOM.insertBefore(this.dom,n.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(n){if(this.updateGutters(n)){let e=this.prevViewport,t=n.view.viewport,i=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(i<(t.to-t.from)*.8)}if(n.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(Np)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=n.view.viewport}syncGutters(n){let e=this.dom.nextSibling;n&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let t=St.iter(this.view.state.facet(Ru),this.view.viewport.from),i=[],s=this.gutters.map(r=>new Gx(r,this.view.viewport,-this.view.documentPadding.top));for(let r of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(r.type)){let a=!0;for(let o of r.type)if(o.type==bi.Text&&a){Eh(t,i,o.from);for(let l of s)l.line(this.view,o,i);a=!1}else if(o.widget)for(let l of s)l.widget(this.view,o)}else if(r.type==bi.Text){Eh(t,i,r.from);for(let a of s)a.line(this.view,r,i)}else if(r.widget)for(let a of s)a.widget(this.view,r);for(let r of s)r.finish();n&&(this.view.scrollDOM.insertBefore(this.dom,e),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(n){let e=n.startState.facet(Ta),t=n.state.facet(Ta),i=n.docChanged||n.heightChanged||n.viewportChanged||!St.eq(n.startState.facet(Ru),n.state.facet(Ru),n.view.viewport.from,n.view.viewport.to);if(e==t)for(let s of this.gutters)s.update(n)&&(i=!0);else{i=!0;let s=[];for(let r of t){let a=e.indexOf(r);a<0?s.push(new Fp(this.view,r)):(this.gutters[a].update(n),s.push(this.gutters[a]))}for(let r of this.gutters)r.dom.remove(),s.indexOf(r)<0&&r.destroy();for(let r of s)r.config.side=="after"?this.getDOMAfter().appendChild(r.dom):this.dom.appendChild(r.dom);this.gutters=s}return i}destroy(){for(let n of this.gutters)n.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:n=>Re.scrollMargins.of(e=>{let t=e.plugin(n);if(!t||t.gutters.length==0||!t.fixed)return null;let i=t.dom.offsetWidth*e.scaleX,s=t.domAfter?t.domAfter.offsetWidth*e.scaleX:0;return e.textDirection==gn.LTR?{left:i,right:s}:{right:i,left:s}})});function Bp(n){return Array.isArray(n)?n:[n]}function Eh(n,e,t){for(;n.value&&n.from<=t;)n.from==t&&e.push(n.value),n.next()}class Gx{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=St.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:s}=this,r=(t.top-this.height)/e.scaleY,a=t.height/e.scaleY;if(this.i==s.elements.length){let o=new K1(e,a,r,i);s.elements.push(o),s.dom.appendChild(o.dom)}else s.elements[this.i].update(e,a,r,i);this.height=t.bottom,this.i++}line(e,t,i){let s=[];Eh(this.cursor,s,t.from),i.length&&(s=s.concat(i));let r=this.gutter.config.lineMarker(e,t,s);r&&s.unshift(r);let a=this.gutter;s.length==0&&!a.config.renderEmptyElements||this.addElement(e,t,s)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t),s=i?[i]:null;for(let r of e.state.facet(Vx)){let a=r(e,t.widget,t);a&&(s||(s=[])).push(a)}s&&this.addElement(e,t,s)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Fp{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,s=>{let r=s.target,a;if(r!=this.dom&&this.dom.contains(r)){for(;r.parentNode!=this.dom;)r=r.parentNode;let l=r.getBoundingClientRect();a=(l.top+l.bottom)/2}else a=s.clientY;let o=e.lineBlockAtHeight(a-e.documentTop);t.domEventHandlers[i](e,o,s)&&s.preventDefault()});this.markers=Bp(t.markers(e)),t.initialSpacer&&(this.spacer=new K1(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=Bp(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],e);s!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[s])}let i=e.view.viewport;return!St.eq(this.markers,t,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class K1{constructor(e,t,i,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,s)}update(e,t,i,s){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),Ux(this.markers,s)||this.setMarkers(e,s)}setMarkers(e,t){let i="cm-gutterElement",s=this.dom.firstChild;for(let r=0,a=0;;){let o=a,l=r<t.length?t[r++]:null,c=!1;if(l){let u=l.elementClass;u&&(i+=" "+u);for(let h=a;h<this.markers.length;h++)if(this.markers[h].compare(l)){o=h,c=!0;break}}else o=this.markers.length;for(;a<o;){let u=this.markers[a++];if(u.toDOM){u.destroy(s);let h=s.nextSibling;s.remove(),s=h}}if(!l)break;l.toDOM&&(c?s=s.nextSibling:this.dom.insertBefore(l.toDOM(e),s)),c&&a++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}function Ux(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].compare(e[t]))return!1;return!0}const qx=Ie.define(),Wx=Ie.define(),Br=Ie.define({combine(n){return Ka(n,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let s in t){let r=i[s],a=t[s];i[s]=r?(o,l,c)=>r(o,l,c)||a(o,l,c):a}return i}})}});class Iu extends Zs{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function Lu(n,e){return n.state.facet(Br).formatNumber(e,n.state)}const Xx=Ta.compute([Br],n=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(qx)},lineMarker(e,t,i){return i.some(s=>s.toDOM)?null:new Iu(Lu(e,e.state.doc.lineAt(t.from).number))},widgetMarker:(e,t,i)=>{for(let s of e.state.facet(Wx)){let r=s(e,t,i);if(r)return r}return null},lineMarkerChange:e=>e.startState.facet(Br)!=e.state.facet(Br),initialSpacer(e){return new Iu(Lu(e,Ip(e.state.doc.lines)))},updateSpacer(e,t){let i=Lu(t.view,Ip(t.view.state.doc.lines));return i==e.number?e:new Iu(i)},domEventHandlers:n.facet(Br).domEventHandlers,side:"before"}));function Rp(n={}){return[Br.of(n),Y1(),Xx]}function Ip(n){let e=9;for(;e<n;)e=e*10+9;return e}const J1=1024;let Hx=0;class Qu{constructor(e,t){this.from=e,this.to=t}}class at{constructor(e={}){this.id=Hx++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Jn.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}at.closedBy=new at({deserialize:n=>n.split(" ")});at.openedBy=new at({deserialize:n=>n.split(" ")});at.group=new at({deserialize:n=>n.split(" ")});at.isolate=new at({deserialize:n=>{if(n&&n!="rtl"&&n!="ltr"&&n!="auto")throw new RangeError("Invalid value for isolate: "+n);return n||"auto"}});at.contextHash=new at({perNode:!0});at.lookAhead=new at({perNode:!0});at.mounted=new at({perNode:!0});class hl{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[at.mounted.id]}}const Yx=Object.create(null);class Jn{constructor(e,t,i,s=0){this.name=e,this.props=t,this.id=i,this.flags=s}static define(e){let t=e.props&&e.props.length?Object.create(null):Yx,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),s=new Jn(e.name||"",t,e.id,i);if(e.props){for(let r of e.props)if(Array.isArray(r)||(r=r(s)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}}return s}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(at.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let s of i.split(" "))t[s]=e[i];return i=>{for(let s=i.prop(at.group),r=-1;r<(s?s.length:0);r++){let a=t[r<0?i.name:s[r]];if(a)return a}}}}Jn.none=new Jn("",Object.create(null),0,8);class Dd{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let s=null;for(let r of e){let a=r(i);if(a){s||(s=Object.assign({},i.props));let o=a[1],l=a[0];l.combine&&l.id in s&&(o=l.combine(s[l.id],o)),s[l.id]=o}}t.push(s?new Jn(i.name,s,i.id,i.flags):i)}return new Dd(t)}}const Eo=new WeakMap,Lp=new WeakMap;var mn;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays"})(mn||(mn={}));class un{constructor(e,t,i,s,r){if(this.type=e,this.children=t,this.positions=i,this.length=s,this.props=null,r&&r.length){this.props=Object.create(null);for(let[a,o]of r)this.props[typeof a=="number"?a:a.id]=o}}toString(){let e=hl.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let s=i.toString();s&&(t&&(t+=","),t+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Mh(this.topNode,e)}cursorAt(e,t=0,i=0){let s=Eo.get(this)||this.topNode,r=new Mh(s);return r.moveTo(e,t),Eo.set(this,r._tree),r}get topNode(){return new Kn(this,0,0,null)}resolve(e,t=0){let i=ja(Eo.get(this)||this.topNode,e,t,!1);return Eo.set(this,i),i}resolveInner(e,t=0){let i=ja(Lp.get(this)||this.topNode,e,t,!0);return Lp.set(this,i),i}resolveStack(e,t=0){return eE(this,e,t)}iterate(e){let{enter:t,leave:i,from:s=0,to:r=this.length}=e,a=e.mode||0,o=(a&mn.IncludeAnonymous)>0;for(let l=this.cursor(a|mn.IncludeAnonymous);;){let c=!1;if(l.from<=r&&l.to>=s&&(!o&&l.type.isAnonymous||t(l)!==!1)){if(l.firstChild())continue;c=!0}for(;c&&i&&(o||!l.type.isAnonymous)&&i(l),!l.nextSibling();){if(!l.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:_d(Jn.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,s)=>new un(this.type,t,i,s,this.propValues),e.makeTree||((t,i,s)=>new un(Jn.none,t,i,s)))}static build(e){return tE(e)}}un.empty=new un(Jn.none,[],[],0);class $d{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new $d(this.buffer,this.index)}}class Gs{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return Jn.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],s=this.set.types[t],r=s.name;if(/\W/.test(r)&&!s.isError&&(r=JSON.stringify(r)),e+=4,i==e)return r;let a=[];for(;e<i;)a.push(this.childString(e)),e=this.buffer[e+3];return r+"("+a.join(",")+")"}findChild(e,t,i,s,r){let{buffer:a}=this,o=-1;for(let l=e;l!=t&&!(eO(r,s,a[l+1],a[l+2])&&(o=l,i>0));l=a[l+3]);return o}slice(e,t,i){let s=this.buffer,r=new Uint16Array(t-e),a=0;for(let o=e,l=0;o<t;){r[l++]=s[o++],r[l++]=s[o++]-i;let c=r[l++]=s[o++]-i;r[l++]=s[o++]-e,a=Math.max(a,c)}return new Gs(r,a,this.set)}}function eO(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function ja(n,e,t,i){for(var s;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let a=!i&&n instanceof Kn&&n.index<0?null:n.parent;if(!a)return n;n=a}let r=i?0:mn.IgnoreOverlays;if(i)for(let a=n,o=a.parent;o;a=o,o=a.parent)a instanceof Kn&&a.index<0&&((s=o.enter(e,t,r))===null||s===void 0?void 0:s.from)!=a.from&&(n=o);for(;;){let a=n.enter(e,t,r);if(!a)return n;n=a}}class tO{cursor(e=0){return new Mh(this,e)}getChild(e,t=null,i=null){let s=Qp(this,e,t,i);return s.length?s[0]:null}getChildren(e,t=null,i=null){return Qp(this,e,t,i)}resolve(e,t=0){return ja(this,e,t,!1)}resolveInner(e,t=0){return ja(this,e,t,!0)}matchContext(e){return kh(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let s=t.lastChild;if(!s||s.to!=t.to)break;s.type.isError&&s.from==s.to?(i=t,t=s.prevSibling):t=s}return i}get node(){return this}get next(){return this.parent}}class Kn extends tO{constructor(e,t,i,s){super(),this._tree=e,this.from=t,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,s,r=0){for(let a=this;;){for(let{children:o,positions:l}=a._tree,c=t>0?o.length:-1;e!=c;e+=t){let u=o[e],h=l[e]+a.from;if(eO(s,i,h,h+u.length)){if(u instanceof Gs){if(r&mn.ExcludeBuffers)continue;let d=u.findChild(0,u.buffer.length,t,i-h,s);if(d>-1)return new ns(new Kx(a,u,e,h),null,d)}else if(r&mn.IncludeAnonymous||!u.type.isAnonymous||Td(u)){let d;if(!(r&mn.IgnoreMounts)&&(d=hl.get(u))&&!d.overlay)return new Kn(d.tree,h,e,a);let f=new Kn(u,h,e,a);return r&mn.IncludeAnonymous||!f.type.isAnonymous?f:f.nextChild(t<0?u.children.length-1:0,t,i,s)}}}if(r&mn.IncludeAnonymous||!a.type.isAnonymous||(a.index>=0?e=a.index+t:e=t<0?-1:a._parent._tree.children.length,a=a._parent,!a))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let s;if(!(i&mn.IgnoreOverlays)&&(s=hl.get(this._tree))&&s.overlay){let r=e-this.from;for(let{from:a,to:o}of s.overlay)if((t>0?a<=r:a<r)&&(t<0?o>=r:o>r))return new Kn(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Qp(n,e,t,i){let s=n.cursor(),r=[];if(!s.firstChild())return r;if(t!=null){for(let a=!1;!a;)if(a=s.type.is(t),!s.nextSibling())return r}for(;;){if(i!=null&&s.type.is(i))return r;if(s.type.is(e)&&r.push(s.node),!s.nextSibling())return i==null?r:[]}}function kh(n,e,t=e.length-1){for(let i=n;t>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(e[t]&&e[t]!=i.name)return!1;t--}}return!0}class Kx{constructor(e,t,i,s){this.parent=e,this.buffer=t,this.index=i,this.start=s}}class ns extends tO{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:s}=this.context,r=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.context.start,i);return r<0?null:new ns(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&mn.ExcludeBuffers)return null;let{buffer:s}=this.context,r=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new ns(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new ns(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new ns(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,s=this.index+4,r=i.buffer[this.index+3];if(r>s){let a=i.buffer[this.index+1];e.push(i.slice(s,r,a)),t.push(0)}return new un(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function nO(n){if(!n.length)return null;let e=0,t=n[0];for(let r=1;r<n.length;r++){let a=n[r];(a.from>t.from||a.to<t.to)&&(t=a,e=r)}let i=t instanceof Kn&&t.index<0?null:t.parent,s=n.slice();return i?s[e]=i:s.splice(e,1),new Jx(s,t)}class Jx{constructor(e,t){this.heads=e,this.node=t}get next(){return nO(this.heads)}}function eE(n,e,t){let i=n.resolveInner(e,t),s=null;for(let r=i instanceof Kn?i:i.context.parent;r;r=r.parent)if(r.index<0){let a=r.parent;(s||(s=[i])).push(a.resolve(e,t)),r=a}else{let a=hl.get(r.tree);if(a&&a.overlay&&a.overlay[0].from<=e&&a.overlay[a.overlay.length-1].to>=e){let o=new Kn(a.tree,a.overlay[0].from+r.from,-1,r);(s||(s=[i])).push(ja(o,e,t,!1))}}return s?nO(s):i}class Mh{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Kn)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:s}=this.buffer;return this.type=t||s.set.types[s.buffer[e]],this.from=i+s.buffer[e+1],this.to=i+s.buffer[e+2],!0}yield(e){return e?e instanceof Kn?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:s}=this.buffer,r=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.buffer.start,i);return r<0?!1:(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?i&mn.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&mn.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&mn.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let s=i<0?0:this.stack[i]+4;if(this.index!=s)return this.yieldBuf(t.findChild(s,this.index,-1,0,4))}else{let s=t.buffer[this.index+3];if(s<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(s)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let r=0;r<this.index;r++)if(s.buffer.buffer[r+3]<this.index)return!1;({index:t,parent:i}=s)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let r=t+e,a=e<0?-1:i._tree.children.length;r!=a;r+=e){let o=i._tree.children[r];if(this.mode&mn.IncludeAnonymous||o instanceof Gs||!o.type.isAnonymous||Td(o))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let s=this.index,r=this.stack.length;r>=0;){for(let a=e;a;a=a._parent)if(a.index==s){if(s==this.index)return a;t=a,i=r+1;break e}s=this.stack[--r]}for(let s=i;s<this.stack.length;s++)t=new ns(this.buffer,t,this.stack[s]);return this.bufferNode=new ns(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let s=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;;){if(s&&t&&t(this),s=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,s=!0}}}matchContext(e){if(!this.buffer)return kh(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let s=e.length-1,r=this.stack.length-1;s>=0;r--){if(r<0)return kh(this._tree,e,s);let a=i[t.buffer[this.stack[r]]];if(!a.isAnonymous){if(e[s]&&e[s]!=a.name)return!1;s--}}return!0}}function Td(n){return n.children.some(e=>e instanceof Gs||!e.type.isAnonymous||Td(e))}function tE(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:s=J1,reused:r=[],minRepeatType:a=i.types.length}=n,o=Array.isArray(t)?new $d(t,t.length):t,l=i.types,c=0,u=0;function h(C,E,A,B,Z,q){let{id:X,start:j,end:H,size:se}=o,oe=u,Pe=c;if(se<0)if(o.next(),se==-1){let yt=r[X];A.push(yt),B.push(j-C);return}else if(se==-3){c=X;return}else if(se==-4){u=X;return}else throw new RangeError(`Unrecognized record size: ${se}`);let Me=l[X],Be,Ke,Ct=j-C;if(H-j<=s&&(Ke=y(o.pos-E,Z))){let yt=new Uint16Array(Ke.size-Ke.skip),he=o.pos-Ke.size,et=yt.length;for(;o.pos>he;)et=b(Ke.start,yt,et);Be=new Gs(yt,H-Ke.start,i),Ct=Ke.start-C}else{let yt=o.pos-se;o.next();let he=[],et=[],pe=X>=a?X:-1,Et=0,Ze=H;for(;o.pos>yt;)pe>=0&&o.id==pe&&o.size>=0?(o.end<=Ze-s&&(m(he,et,j,Et,o.end,Ze,pe,oe,Pe),Et=he.length,Ze=o.end),o.next()):q>2500?d(j,yt,he,et):h(j,yt,he,et,pe,q+1);if(pe>=0&&Et>0&&Et<he.length&&m(he,et,j,Et,j,Ze,pe,oe,Pe),he.reverse(),et.reverse(),pe>-1&&Et>0){let ve=f(Me,Pe);Be=_d(Me,he,et,0,he.length,0,H-j,ve,ve)}else Be=g(Me,he,et,H-j,oe-H,Pe)}A.push(Be),B.push(Ct)}function d(C,E,A,B){let Z=[],q=0,X=-1;for(;o.pos>E;){let{id:j,start:H,end:se,size:oe}=o;if(oe>4)o.next();else{if(X>-1&&H<X)break;X<0&&(X=se-s),Z.push(j,H,se),q++,o.next()}}if(q){let j=new Uint16Array(q*4),H=Z[Z.length-2];for(let se=Z.length-3,oe=0;se>=0;se-=3)j[oe++]=Z[se],j[oe++]=Z[se+1]-H,j[oe++]=Z[se+2]-H,j[oe++]=oe;A.push(new Gs(j,Z[2]-H,i)),B.push(H-C)}}function f(C,E){return(A,B,Z)=>{let q=0,X=A.length-1,j,H;if(X>=0&&(j=A[X])instanceof un){if(!X&&j.type==C&&j.length==Z)return j;(H=j.prop(at.lookAhead))&&(q=B[X]+j.length+H)}return g(C,A,B,Z,q,E)}}function m(C,E,A,B,Z,q,X,j,H){let se=[],oe=[];for(;C.length>B;)se.push(C.pop()),oe.push(E.pop()+A-Z);C.push(g(i.types[X],se,oe,q-Z,j-q,H)),E.push(Z-A)}function g(C,E,A,B,Z,q,X){if(q){let j=[at.contextHash,q];X=X?[j].concat(X):[j]}if(Z>25){let j=[at.lookAhead,Z];X=X?[j].concat(X):[j]}return new un(C,E,A,B,X)}function y(C,E){let A=o.fork(),B=0,Z=0,q=0,X=A.end-s,j={size:0,start:0,skip:0};e:for(let H=A.pos-C;A.pos>H;){let se=A.size;if(A.id==E&&se>=0){j.size=B,j.start=Z,j.skip=q,q+=4,B+=4,A.next();continue}let oe=A.pos-se;if(se<0||oe<H||A.start<X)break;let Pe=A.id>=a?4:0,Me=A.start;for(A.next();A.pos>oe;){if(A.size<0)if(A.size==-3)Pe+=4;else break e;else A.id>=a&&(Pe+=4);A.next()}Z=Me,B+=se,q+=Pe}return(E<0||B==C)&&(j.size=B,j.start=Z,j.skip=q),j.size>4?j:void 0}function b(C,E,A){let{id:B,start:Z,end:q,size:X}=o;if(o.next(),X>=0&&B<a){let j=A;if(X>4){let H=o.pos-(X-4);for(;o.pos>H;)A=b(C,E,A)}E[--A]=j,E[--A]=q-C,E[--A]=Z-C,E[--A]=B}else X==-3?c=B:X==-4&&(u=B);return A}let P=[],M=[];for(;o.pos>0;)h(n.start||0,n.bufferStart||0,P,M,-1,0);let v=(e=n.length)!==null&&e!==void 0?e:P.length?M[0]+P[0].length:0;return new un(l[n.topID],P.reverse(),M.reverse(),v)}const Vp=new WeakMap;function Ho(n,e){if(!n.isAnonymous||e instanceof Gs||e.type!=n)return 1;let t=Vp.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof un)){t=1;break}t+=Ho(n,i)}Vp.set(e,t)}return t}function _d(n,e,t,i,s,r,a,o,l){let c=0;for(let m=i;m<s;m++)c+=Ho(n,e[m]);let u=Math.ceil(c*1.5/8),h=[],d=[];function f(m,g,y,b,P){for(let M=y;M<b;){let v=M,C=g[M],E=Ho(n,m[M]);for(M++;M<b;M++){let A=Ho(n,m[M]);if(E+A>=u)break;E+=A}if(M==v+1){if(E>u){let A=m[v];f(A.children,A.positions,0,A.children.length,g[v]+P);continue}h.push(m[v])}else{let A=g[M-1]+m[M-1].length-C;h.push(_d(n,m,g,v,M,C,A,null,l))}d.push(C+P-r)}}return f(e,t,i,s,0),(o||l)(h,d,a)}class nE{constructor(){this.map=new WeakMap}setBuffer(e,t,i){let s=this.map.get(e);s||this.map.set(e,s=new Map),s.set(t,i)}getBuffer(e,t){let i=this.map.get(e);return i&&i.get(t)}set(e,t){e instanceof ns?this.setBuffer(e.context.buffer,e.index,t):e instanceof Kn&&this.map.set(e.tree,t)}get(e){return e instanceof ns?this.getBuffer(e.context.buffer,e.index):e instanceof Kn?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class cr{constructor(e,t,i,s,r=!1,a=!1){this.from=e,this.to=t,this.tree=i,this.offset=s,this.open=(r?1:0)|(a?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let s=[new cr(0,e.length,e,0,!1,i)];for(let r of t)r.to>e.length&&s.push(r);return s}static applyChanges(e,t,i=128){if(!t.length)return e;let s=[],r=1,a=e.length?e[0]:null;for(let o=0,l=0,c=0;;o++){let u=o<t.length?t[o]:null,h=u?u.fromA:1e9;if(h-l>=i)for(;a&&a.from<h;){let d=a;if(l>=d.from||h<=d.to||c){let f=Math.max(d.from,l)-c,m=Math.min(d.to,h)-c;d=f>=m?null:new cr(f,m,d.tree,d.offset+c,o>0,!!u)}if(d&&s.push(d),a.to>h)break;a=r<e.length?e[r++]:null}if(!u)break;l=u.toA,c=u.toA-u.toB}return s}}let iO=class{startParse(e,t,i){return typeof e=="string"&&(e=new iE(e)),i=i?i.length?i.map(s=>new Qu(s.from,s.to)):[new Qu(0,0)]:[new Qu(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let s=this.startParse(e,t,i);for(;;){let r=s.advance();if(r)return r}}};class iE{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new at({perNode:!0});var zp={};class dl{constructor(e,t,i,s,r,a,o,l,c,u=0,h){this.p=e,this.stack=t,this.state=i,this.reducePos=s,this.pos=r,this.score=a,this.buffer=o,this.bufferBase=l,this.curContext=c,this.lookAhead=u,this.parent=h}toString(){return`[${this.stack.filter((e,t)=>t%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,i=0){let s=e.parser.context;return new dl(e,[],t,i,i,0,[],0,s?new jp(s,s.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let i=e>>19,s=e&65535,{parser:r}=this.p,a=this.reducePos<this.pos-25;a&&this.setLookAhead(this.pos);let o=r.dynamicPrecedence(s);if(o&&(this.score+=o),i==0){this.pushState(r.getGoto(this.state,s,!0),this.reducePos),s<r.minRepeatTerm&&this.storeNode(s,this.reducePos,this.reducePos,a?8:4,!0),this.reduceContext(s,this.reducePos);return}let l=this.stack.length-(i-1)*3-(e&262144?6:0),c=l?this.stack[l-2]:this.p.ranges[0].from,u=this.reducePos-c;u>=2e3&&!(!((t=this.p.parser.nodeSet.types[s])===null||t===void 0)&&t.isAnonymous)&&(c==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=u):this.p.lastBigReductionSize<u&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=c,this.p.lastBigReductionSize=u));let h=l?this.stack[l-1]:0,d=this.bufferBase+this.buffer.length-h;if(s<r.minRepeatTerm||e&131072){let f=r.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(s,c,f,d+4,!0)}if(e&262144)this.state=this.stack[l];else{let f=this.stack[l-3];this.state=r.getGoto(f,s,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(s,c)}storeNode(e,t,i,s=4,r=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let a=this,o=this.buffer.length;if(o==0&&a.parent&&(o=a.bufferBase-a.parent.bufferBase,a=a.parent),o>0&&a.buffer[o-4]==0&&a.buffer[o-1]>-1){if(t==i)return;if(a.buffer[o-2]>=t){a.buffer[o-2]=i;return}}}if(!r||this.pos==i)this.buffer.push(e,t,i,s);else{let a=this.buffer.length;if(a>0&&(this.buffer[a-4]!=0||this.buffer[a-1]<0)){let o=!1;for(let l=a;l>0&&this.buffer[l-2]>i;l-=4)if(this.buffer[l-1]>=0){o=!0;break}if(o)for(;a>0&&this.buffer[a-2]>i;)this.buffer[a]=this.buffer[a-4],this.buffer[a+1]=this.buffer[a-3],this.buffer[a+2]=this.buffer[a-2],this.buffer[a+3]=this.buffer[a-1],a-=4,s>4&&(s-=4)}this.buffer[a]=e,this.buffer[a+1]=t,this.buffer[a+2]=i,this.buffer[a+3]=s}}shift(e,t,i,s){if(e&131072)this.pushState(e&65535,this.pos);else if((e&262144)==0){let r=e,{parser:a}=this.p;(s>this.pos||t<=a.maxNode)&&(this.pos=s,a.stateFlag(r,1)||(this.reducePos=s)),this.pushState(r,i),this.shiftContext(t,i),t<=a.maxNode&&this.buffer.push(t,i,s,4)}else this.pos=s,this.shiftContext(t,i),t<=this.p.parser.maxNode&&this.buffer.push(t,i,s,4)}apply(e,t,i,s){e&65536?this.reduce(e):this.shift(e,t,i,s)}useNode(e,t){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=e)&&(this.p.reused.push(e),i++);let s=this.pos;this.reducePos=this.pos=s+e.length,this.pushState(t,s),this.buffer.push(i,s,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let i=e.buffer.slice(t),s=e.bufferBase+t;for(;e&&s==e.bufferBase;)e=e.parent;return new dl(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,s,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let i=e<=this.p.parser.maxNode;i&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,i?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new sE(this);;){let i=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(i==0)return!1;if((i&65536)==0)return!0;t.reduce(i)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let s=[];for(let r=0,a;r<t.length;r+=2)(a=t[r+1])!=this.state&&this.p.parser.hasAction(a,e)&&s.push(t[r],a);if(this.stack.length<120)for(let r=0;s.length<8&&r<t.length;r+=2){let a=t[r+1];s.some((o,l)=>l&1&&o==a)||s.push(t[r],a)}t=s}let i=[];for(let s=0;s<t.length&&i.length<4;s+=2){let r=t[s+1];if(r==this.state)continue;let a=this.split();a.pushState(r,this.pos),a.storeNode(0,a.pos,a.pos,4,!0),a.shiftContext(t[s],this.pos),a.reducePos=this.pos,a.score-=200,i.push(a)}return i}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if((t&65536)==0)return!1;if(!e.validAction(this.state,t)){let i=t>>19,s=t&65535,r=this.stack.length-i*3;if(r<0||e.getGoto(this.stack[r],s,!1)<0){let a=this.findForcedReduction();if(a==null)return!1;t=a}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],i=(s,r)=>{if(!t.includes(s))return t.push(s),e.allActions(s,a=>{if(!(a&393216))if(a&65536){let o=(a>>19)-r;if(o>1){let l=a&65535,c=this.stack.length-o*3;if(c>=0&&e.getGoto(this.stack[c],l,!1)>=0)return o<<19|65536|l}}else{let o=i(a,r+1);if(o!=null)return o}})};return i(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new jp(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class jp{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class sE{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=e&65535,i=e>>19;i==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(i-1)*3;let s=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=s}}class fl{constructor(e,t,i){this.stack=e,this.pos=t,this.index=i,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new fl(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new fl(this.stack,this.pos,this.index)}}function Aa(n,e=Uint16Array){if(typeof n!="string")return n;let t=null;for(let i=0,s=0;i<n.length;){let r=0;for(;;){let a=n.charCodeAt(i++),o=!1;if(a==126){r=65535;break}a>=92&&a--,a>=34&&a--;let l=a-32;if(l>=46&&(l-=46,o=!0),r+=l,o)break;r*=46}t?t[s++]=r:t=new e(r)}return t}class Yo{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const Zp=new Yo;class rE{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=Zp,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let i=this.range,s=this.rangeIndex,r=this.pos+e;for(;r<i.from;){if(!s)return null;let a=this.ranges[--s];r-=i.from-a.to,i=a}for(;t<0?r>i.to:r>=i.to;){if(s==this.ranges.length-1)return null;let a=this.ranges[++s];r+=a.from-i.to,i=a}return r}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t=this.chunkOff+e,i,s;if(t>=0&&t<this.chunk.length)i=this.pos+e,s=this.chunk.charCodeAt(t);else{let r=this.resolveOffset(e,1);if(r==null)return-1;if(i=r,i>=this.chunk2Pos&&i<this.chunk2Pos+this.chunk2.length)s=this.chunk2.charCodeAt(i-this.chunk2Pos);else{let a=this.rangeIndex,o=this.range;for(;o.to<=i;)o=this.ranges[++a];this.chunk2=this.input.chunk(this.chunk2Pos=i),i+this.chunk2.length>o.to&&(this.chunk2=this.chunk2.slice(0,o.to-i)),s=this.chunk2.charCodeAt(0)}}return i>=this.token.lookAhead&&(this.token.lookAhead=i+1),s}acceptToken(e,t=0){let i=t?this.resolveOffset(t,-1):this.pos;if(i==null||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=i}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=Zp,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let i="";for(let s of this.ranges){if(s.from>=t)break;s.to>e&&(i+=this.input.read(Math.max(s.from,e),Math.min(s.to,t)))}return i}}class Qr{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:i}=t.p;sO(this.data,e,t,this.id,i.data,i.tokenPrecTable)}}Qr.prototype.contextual=Qr.prototype.fallback=Qr.prototype.extend=!1;class Dh{constructor(e,t,i){this.precTable=t,this.elseToken=i,this.data=typeof e=="string"?Aa(e):e}token(e,t){let i=e.pos,s=0;for(;;){let r=e.next<0,a=e.resolveOffset(1,1);if(sO(this.data,e,t,0,this.data,this.precTable),e.token.value>-1)break;if(this.elseToken==null)return;if(r||s++,a==null)break;e.reset(a,e.token)}s&&(e.reset(i,e.token),e.acceptToken(this.elseToken,s))}}Dh.prototype.contextual=Qr.prototype.fallback=Qr.prototype.extend=!1;class no{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function sO(n,e,t,i,s,r){let a=0,o=1<<i,{dialect:l}=t.p.parser;e:for(;(o&n[a])!=0;){let c=n[a+1];for(let f=a+3;f<c;f+=2)if((n[f+1]&o)>0){let m=n[f];if(l.allows(m)&&(e.token.value==-1||e.token.value==m||aE(m,e.token.value,s,r))){e.acceptToken(m);break}}let u=e.next,h=0,d=n[a+2];if(e.next<0&&d>h&&n[c+d*3-3]==65535){a=n[c+d*3-1];continue e}for(;h<d;){let f=h+d>>1,m=c+f+(f<<1),g=n[m],y=n[m+1]||65536;if(u<g)d=f;else if(u>=y)h=f+1;else{a=n[m+2],e.advance();continue e}}break}}function Gp(n,e,t){for(let i=e,s;(s=n[i])!=65535;i++)if(s==t)return i-e;return-1}function aE(n,e,t,i){let s=Gp(t,i,e);return s<0||Gp(t,i,n)<s}const ii=typeof process<"u"&&zp&&/\bparse\b/.test(zp.LOG);let Vu=null;function Up(n,e,t){let i=n.cursor(mn.IncludeAnonymous);for(i.moveTo(e);;)if(!(t<0?i.childBefore(e):i.childAfter(e)))for(;;){if((t<0?i.to<e:i.from>e)&&!i.type.isError)return t<0?Math.max(0,Math.min(i.to-1,e-25)):Math.min(n.length,Math.max(i.from+1,e+25));if(t<0?i.prevSibling():i.nextSibling())break;if(!i.parent())return t<0?0:n.length}}class oE{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?Up(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?Up(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let i=this.trees[t],s=this.index[t];if(s==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let r=i.children[s],a=this.start[t]+i.positions[s];if(a>e)return this.nextStart=a,null;if(r instanceof un){if(a==e){if(a<this.safeFrom)return null;let o=a+r.length;if(o<=this.safeTo){let l=r.prop(at.lookAhead);if(!l||o+l<this.fragment.to)return r}}this.index[t]++,a+r.length>=Math.max(this.safeFrom,e)&&(this.trees.push(r),this.start.push(a),this.index.push(0))}else this.index[t]++,this.nextStart=a+r.length}}}class lE{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(i=>new Yo)}getActions(e){let t=0,i=null,{parser:s}=e.p,{tokenizers:r}=s,a=s.stateSlot(e.state,3),o=e.curContext?e.curContext.hash:0,l=0;for(let c=0;c<r.length;c++){if((1<<c&a)==0)continue;let u=r[c],h=this.tokens[c];if(!(i&&!u.fallback)&&((u.contextual||h.start!=e.pos||h.mask!=a||h.context!=o)&&(this.updateCachedToken(h,u,e),h.mask=a,h.context=o),h.lookAhead>h.end+25&&(l=Math.max(h.lookAhead,l)),h.value!=0)){let d=t;if(h.extended>-1&&(t=this.addActions(e,h.extended,h.end,t)),t=this.addActions(e,h.value,h.end,t),!u.extend&&(i=h,t>d))break}}for(;this.actions.length>t;)this.actions.pop();return l&&e.setLookAhead(l),!i&&e.pos==this.stream.end&&(i=new Yo,i.value=e.p.parser.eofTerm,i.start=i.end=e.pos,t=this.addActions(e,i.value,i.end,t)),this.mainToken=i,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new Yo,{pos:i,p:s}=e;return t.start=i,t.end=Math.min(i+1,s.stream.end),t.value=i==s.stream.end?s.parser.eofTerm:0,t}updateCachedToken(e,t,i){let s=this.stream.clipPos(i.pos);if(t.token(this.stream.reset(s,e),i),e.value>-1){let{parser:r}=i.p;for(let a=0;a<r.specialized.length;a++)if(r.specialized[a]==e.value){let o=r.specializers[a](this.stream.read(e.start,e.end),i);if(o>=0&&i.p.parser.dialect.allows(o>>1)){(o&1)==0?e.value=o>>1:e.extended=o>>1;break}}}else e.value=0,e.end=this.stream.clipPos(s+1)}putAction(e,t,i,s){for(let r=0;r<s;r+=3)if(this.actions[r]==e)return s;return this.actions[s++]=e,this.actions[s++]=t,this.actions[s++]=i,s}addActions(e,t,i,s){let{state:r}=e,{parser:a}=e.p,{data:o}=a;for(let l=0;l<2;l++)for(let c=a.stateSlot(r,l?2:1);;c+=3){if(o[c]==65535)if(o[c+1]==1)c=Os(o,c+2);else{s==0&&o[c+1]==2&&(s=this.putAction(Os(o,c+2),t,i,s));break}o[c]==t&&(s=this.putAction(Os(o,c+1),t,i,s))}return s}}class uE{constructor(e,t,i,s){this.parser=e,this.input=t,this.ranges=s,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new rE(t,s),this.tokens=new lE(e,this.stream),this.topTerm=e.top[1];let{from:r}=s[0];this.stacks=[dl.start(this,e.top[0],r)],this.fragments=i.length&&this.stream.end-r>e.bufferLength*4?new oE(i,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,t=this.minStackPos,i=this.stacks=[],s,r;if(this.bigReductionCount>300&&e.length==1){let[a]=e;for(;a.forceReduce()&&a.stack.length&&a.stack[a.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let a=0;a<e.length;a++){let o=e[a];for(;;){if(this.tokens.mainToken=null,o.pos>t)i.push(o);else{if(this.advanceStack(o,i,e))continue;{s||(s=[],r=[]),s.push(o);let l=this.tokens.getMainToken(o);r.push(l.value,l.end)}}break}}if(!i.length){let a=s&&dE(s);if(a)return ii&&console.log("Finish with "+this.stackID(a)),this.stackToTree(a);if(this.parser.strict)throw ii&&s&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+t);this.recovering||(this.recovering=5)}if(this.recovering&&s){let a=this.stoppedAt!=null&&s[0].pos>this.stoppedAt?s[0]:this.runRecovery(s,r,i);if(a)return ii&&console.log("Force-finish "+this.stackID(a)),this.stackToTree(a.forceAll())}if(this.recovering){let a=this.recovering==1?1:this.recovering*3;if(i.length>a)for(i.sort((o,l)=>l.score-o.score);i.length>a;)i.pop();i.some(o=>o.reducePos>t)&&this.recovering--}else if(i.length>1){e:for(let a=0;a<i.length-1;a++){let o=i[a];for(let l=a+1;l<i.length;l++){let c=i[l];if(o.sameState(c)||o.buffer.length>500&&c.buffer.length>500)if((o.score-c.score||o.buffer.length-c.buffer.length)>0)i.splice(l--,1);else{i.splice(a--,1);continue e}}}i.length>12&&i.splice(12,i.length-12)}this.minStackPos=i[0].pos;for(let a=1;a<i.length;a++)i[a].pos<this.minStackPos&&(this.minStackPos=i[a].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,i){let s=e.pos,{parser:r}=this,a=ii?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&s>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let c=e.curContext&&e.curContext.tracker.strict,u=c?e.curContext.hash:0;for(let h=this.fragments.nodeAt(s);h;){let d=this.parser.nodeSet.types[h.type.id]==h.type?r.getGoto(e.state,h.type.id):-1;if(d>-1&&h.length&&(!c||(h.prop(at.contextHash)||0)==u))return e.useNode(h,d),ii&&console.log(a+this.stackID(e)+` (via reuse of ${r.getName(h.type.id)})`),!0;if(!(h instanceof un)||h.children.length==0||h.positions[0]>0)break;let f=h.children[0];if(f instanceof un&&h.positions[0]==0)h=f;else break}}let o=r.stateSlot(e.state,4);if(o>0)return e.reduce(o),ii&&console.log(a+this.stackID(e)+` (via always-reduce ${r.getName(o&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let l=this.tokens.getActions(e);for(let c=0;c<l.length;){let u=l[c++],h=l[c++],d=l[c++],f=c==l.length||!i,m=f?e:e.split(),g=this.tokens.mainToken;if(m.apply(u,h,g?g.start:m.pos,d),ii&&console.log(a+this.stackID(m)+` (via ${(u&65536)==0?"shift":`reduce of ${r.getName(u&65535)}`} for ${r.getName(h)} @ ${s}${m==e?"":", split"})`),f)return!0;m.pos>s?t.push(m):i.push(m)}return!1}advanceFully(e,t){let i=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>i)return qp(e,t),!0}}runRecovery(e,t,i){let s=null,r=!1;for(let a=0;a<e.length;a++){let o=e[a],l=t[a<<1],c=t[(a<<1)+1],u=ii?this.stackID(o)+" -> ":"";if(o.deadEnd&&(r||(r=!0,o.restart(),ii&&console.log(u+this.stackID(o)+" (restarted)"),this.advanceFully(o,i))))continue;let h=o.split(),d=u;for(let f=0;f<10&&h.forceReduce()&&(ii&&console.log(d+this.stackID(h)+" (via force-reduce)"),!this.advanceFully(h,i));f++)ii&&(d=this.stackID(h)+" -> ");for(let f of o.recoverByInsert(l))ii&&console.log(u+this.stackID(f)+" (via recover-insert)"),this.advanceFully(f,i);this.stream.end>o.pos?(c==o.pos&&(c++,l=0),o.recoverByDelete(l,c),ii&&console.log(u+this.stackID(o)+` (via recover-delete ${this.parser.getName(l)})`),qp(o,i)):(!s||s.score<o.score)&&(s=o)}return s}stackToTree(e){return e.close(),un.build({buffer:fl.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(Vu||(Vu=new WeakMap)).get(e);return t||Vu.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function qp(n,e){for(let t=0;t<e.length;t++){let i=e[t];if(i.pos==n.pos&&i.sameState(n)){e[t].score<n.score&&(e[t]=n);return}}e.push(n)}class cE{constructor(e,t,i){this.source=e,this.flags=t,this.disabled=i}allows(e){return!this.disabled||this.disabled[e]==0}}const zu=n=>n;class hE{constructor(e){this.start=e.start,this.shift=e.shift||zu,this.reduce=e.reduce||zu,this.reuse=e.reuse||zu,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}}class pl extends iO{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let o=0;o<e.repeatNodeCount;o++)t.push("");let i=Object.keys(e.topRules).map(o=>e.topRules[o][1]),s=[];for(let o=0;o<t.length;o++)s.push([]);function r(o,l,c){s[o].push([l,l.deserialize(String(c))])}if(e.nodeProps)for(let o of e.nodeProps){let l=o[0];typeof l=="string"&&(l=at[l]);for(let c=1;c<o.length;){let u=o[c++];if(u>=0)r(u,l,o[c++]);else{let h=o[c+-u];for(let d=-u;d>0;d--)r(o[c++],l,h);c++}}}this.nodeSet=new Dd(t.map((o,l)=>Jn.define({name:l>=this.minRepeatTerm?void 0:o,id:l,props:s[l],top:i.indexOf(l)>-1,error:l==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(l)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=J1;let a=Aa(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let o=0;o<this.specializerSpecs.length;o++)this.specialized[o]=this.specializerSpecs[o].term;this.specializers=this.specializerSpecs.map(Wp),this.states=Aa(e.states,Uint32Array),this.data=Aa(e.stateData),this.goto=Aa(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(o=>typeof o=="number"?new Qr(a,o):o),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,i){let s=new uE(this,e,t,i);for(let r of this.wrappers)s=r(s,e,t,i);return s}getGoto(e,t,i=!1){let s=this.goto;if(t>=s[0])return-1;for(let r=s[t+1];;){let a=s[r++],o=a&1,l=s[r++];if(o&&i)return l;for(let c=r+(a>>1);r<c;r++)if(s[r]==e)return l;if(o)return-1}}hasAction(e,t){let i=this.data;for(let s=0;s<2;s++)for(let r=this.stateSlot(e,s?2:1),a;;r+=3){if((a=i[r])==65535)if(i[r+1]==1)a=i[r=Os(i,r+2)];else{if(i[r+1]==2)return Os(i,r+2);break}if(a==t||a==0)return Os(i,r+1)}return 0}stateSlot(e,t){return this.states[e*6+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,i=>i==t?!0:null)}allActions(e,t){let i=this.stateSlot(e,4),s=i?t(i):void 0;for(let r=this.stateSlot(e,1);s==null;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=Os(this.data,r+2);else break;s=t(Os(this.data,r+1))}return s}nextStates(e){let t=[];for(let i=this.stateSlot(e,1);;i+=3){if(this.data[i]==65535)if(this.data[i+1]==1)i=Os(this.data,i+2);else break;if((this.data[i+2]&1)==0){let s=this.data[i+1];t.some((r,a)=>a&1&&r==s)||t.push(this.data[i],s)}}return t}configure(e){let t=Object.assign(Object.create(pl.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let i=this.topRules[e.top];if(!i)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=i}return e.tokenizers&&(t.tokenizers=this.tokenizers.map(i=>{let s=e.tokenizers.find(r=>r.from==i);return s?s.to:i})),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map((i,s)=>{let r=e.specializers.find(o=>o.from==i.external);if(!r)return i;let a=Object.assign(Object.assign({},i),{external:r.to});return t.specializers[s]=Wp(a),a})),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),e.bufferLength!=null&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return t==null?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),i=t.map(()=>!1);if(e)for(let r of e.split(" ")){let a=t.indexOf(r);a>=0&&(i[a]=!0)}let s=null;for(let r=0;r<t.length;r++)if(!i[r])for(let a=this.dialects[t[r]],o;(o=this.data[a++])!=65535;)(s||(s=new Uint8Array(this.maxTerm+1)))[o]=1;return new cE(e,i,s)}static deserialize(e){return new pl(e)}}function Os(n,e){return n[e]|n[e+1]<<16}function dE(n){let e=null;for(let t of n){let i=t.p.stoppedAt;(t.pos==t.p.stream.end||i!=null&&t.pos>i)&&t.p.parser.stateFlag(t.state,2)&&(!e||e.score<t.score)&&(e=t)}return e}function Wp(n){if(n.external){let e=n.extend?1:0;return(t,i)=>n.external(t,i)<<1|e}return n.get}let fE=0;class gi{constructor(e,t,i,s){this.name=e,this.set=t,this.base=i,this.modified=s,this.id=fE++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i=typeof e=="string"?e:"?";if(e instanceof gi&&(t=e),t!=null&&t.base)throw new Error("Can not derive from a modified tag");let s=new gi(i,[],null,[]);if(s.set.push(s),t)for(let r of t.set)s.set.push(r);return s}static defineModifier(e){let t=new ml(e);return i=>i.modified.indexOf(t)>-1?i:ml.get(i.base||i,i.modified.concat(t).sort((s,r)=>s.id-r.id))}}let pE=0;class ml{constructor(e){this.name=e,this.instances=[],this.id=pE++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(o=>o.base==e&&mE(t,o.modified));if(i)return i;let s=[],r=new gi(e.name,s,e,t);for(let o of t)o.instances.push(r);let a=gE(t);for(let o of e.set)if(!o.modified.length)for(let l of a)s.push(ml.get(o,l));return r}}function mE(n,e){return n.length==e.length&&n.every((t,i)=>t==e[i])}function gE(n){let e=[[]];for(let t=0;t<n.length;t++)for(let i=0,s=e.length;i<s;i++)e.push(e[i].concat(n[t]));return e.sort((t,i)=>i.length-t.length)}function rO(n){let e=Object.create(null);for(let t in n){let i=n[t];Array.isArray(i)||(i=[i]);for(let s of t.split(" "))if(s){let r=[],a=2,o=s;for(let h=0;;){if(o=="..."&&h>0&&h+3==s.length){a=1;break}let d=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!d)throw new RangeError("Invalid path: "+s);if(r.push(d[0]=="*"?"":d[0][0]=='"'?JSON.parse(d[0]):d[0]),h+=d[0].length,h==s.length)break;let f=s[h++];if(h==s.length&&f=="!"){a=0;break}if(f!="/")throw new RangeError("Invalid path: "+s);o=s.slice(h)}let l=r.length-1,c=r[l];if(!c)throw new RangeError("Invalid path: "+s);let u=new Za(i,a,l>0?r.slice(0,l):null);e[c]=u.sort(e[c])}}return aO.add(e)}const aO=new at({combine(n,e){let t,i,s;for(;n||e;){if(!n||e&&n.depth>=e.depth?(s=e,e=e.next):(s=n,n=n.next),t&&t.mode==s.mode&&!s.context&&!t.context)continue;let r=new Za(s.tags,s.mode,s.context);t?t.next=r:i=r,t=r}return i}});class Za{constructor(e,t,i,s){this.tags=e,this.mode=t,this.context=i,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Za.empty=new Za([],2,null);function oO(n,e){let t=Object.create(null);for(let r of n)if(!Array.isArray(r.tag))t[r.tag.id]=r.class;else for(let a of r.tag)t[a.id]=r.class;let{scope:i,all:s=null}=e||{};return{style:r=>{let a=s;for(let o of r)for(let l of o.set){let c=t[l.id];if(c){a=a?a+" "+c:c;break}}return a},scope:i}}function OE(n,e){let t=null;for(let i of n){let s=i.style(e);s&&(t=t?t+" "+s:s)}return t}function yE(n,e,t,i=0,s=n.length){let r=new bE(i,Array.isArray(e)?e:[e],t);r.highlightRange(n.cursor(),i,s,"",r.highlighters),r.flush(s)}class bE{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,s,r){let{type:a,from:o,to:l}=e;if(o>=i||l<=t)return;a.isTop&&(r=this.highlighters.filter(f=>!f.scope||f.scope(a)));let c=s,u=vE(e)||Za.empty,h=OE(r,u.tags);if(h&&(c&&(c+=" "),c+=h,u.mode==1&&(s+=(s?" ":"")+h)),this.startSpan(Math.max(t,o),c),u.opaque)return;let d=e.tree&&e.tree.prop(at.mounted);if(d&&d.overlay){let f=e.node.enter(d.overlay[0].from+o,1),m=this.highlighters.filter(y=>!y.scope||y.scope(d.tree.type)),g=e.firstChild();for(let y=0,b=o;;y++){let P=y<d.overlay.length?d.overlay[y]:null,M=P?P.from+o:l,v=Math.max(t,b),C=Math.min(i,M);if(v<C&&g)for(;e.from<C&&(this.highlightRange(e,v,C,s,r),this.startSpan(Math.min(C,e.to),c),!(e.to>=M||!e.nextSibling())););if(!P||M>i)break;b=P.to+o,b>t&&(this.highlightRange(f.cursor(),Math.max(t,P.from+o),Math.min(i,b),"",m),this.startSpan(Math.min(i,b),c))}g&&e.parent()}else if(e.firstChild()){d&&(s="");do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,s,r),this.startSpan(Math.min(i,e.to),c)}while(e.nextSibling());e.parent()}}}function vE(n){let e=n.type.prop(aO);for(;e&&e.context&&!n.matchContext(e.context);)e=e.next;return e||null}const Se=gi.define,ko=Se(),_s=Se(),Xp=Se(_s),Hp=Se(_s),Ns=Se(),Mo=Se(Ns),ju=Se(Ns),Hi=Se(),Ks=Se(Hi),Wi=Se(),Xi=Se(),$h=Se(),ua=Se($h),Do=Se(),U={comment:ko,lineComment:Se(ko),blockComment:Se(ko),docComment:Se(ko),name:_s,variableName:Se(_s),typeName:Xp,tagName:Se(Xp),propertyName:Hp,attributeName:Se(Hp),className:Se(_s),labelName:Se(_s),namespace:Se(_s),macroName:Se(_s),literal:Ns,string:Mo,docString:Se(Mo),character:Se(Mo),attributeValue:Se(Mo),number:ju,integer:Se(ju),float:Se(ju),bool:Se(Ns),regexp:Se(Ns),escape:Se(Ns),color:Se(Ns),url:Se(Ns),keyword:Wi,self:Se(Wi),null:Se(Wi),atom:Se(Wi),unit:Se(Wi),modifier:Se(Wi),operatorKeyword:Se(Wi),controlKeyword:Se(Wi),definitionKeyword:Se(Wi),moduleKeyword:Se(Wi),operator:Xi,derefOperator:Se(Xi),arithmeticOperator:Se(Xi),logicOperator:Se(Xi),bitwiseOperator:Se(Xi),compareOperator:Se(Xi),updateOperator:Se(Xi),definitionOperator:Se(Xi),typeOperator:Se(Xi),controlOperator:Se(Xi),punctuation:$h,separator:Se($h),bracket:ua,angleBracket:Se(ua),squareBracket:Se(ua),paren:Se(ua),brace:Se(ua),content:Hi,heading:Ks,heading1:Se(Ks),heading2:Se(Ks),heading3:Se(Ks),heading4:Se(Ks),heading5:Se(Ks),heading6:Se(Ks),contentSeparator:Se(Hi),list:Se(Hi),quote:Se(Hi),emphasis:Se(Hi),strong:Se(Hi),link:Se(Hi),monospace:Se(Hi),strikethrough:Se(Hi),inserted:Se(),deleted:Se(),changed:Se(),invalid:Se(),meta:Do,documentMeta:Se(Do),annotation:Se(Do),processingInstruction:Se(Do),definition:gi.defineModifier("definition"),constant:gi.defineModifier("constant"),function:gi.defineModifier("function"),standard:gi.defineModifier("standard"),local:gi.defineModifier("local"),special:gi.defineModifier("special")};for(let n in U){let e=U[n];e instanceof gi&&(e.name=n)}oO([{tag:U.link,class:"tok-link"},{tag:U.heading,class:"tok-heading"},{tag:U.emphasis,class:"tok-emphasis"},{tag:U.strong,class:"tok-strong"},{tag:U.keyword,class:"tok-keyword"},{tag:U.atom,class:"tok-atom"},{tag:U.bool,class:"tok-bool"},{tag:U.url,class:"tok-url"},{tag:U.labelName,class:"tok-labelName"},{tag:U.inserted,class:"tok-inserted"},{tag:U.deleted,class:"tok-deleted"},{tag:U.literal,class:"tok-literal"},{tag:U.string,class:"tok-string"},{tag:U.number,class:"tok-number"},{tag:[U.regexp,U.escape,U.special(U.string)],class:"tok-string2"},{tag:U.variableName,class:"tok-variableName"},{tag:U.local(U.variableName),class:"tok-variableName tok-local"},{tag:U.definition(U.variableName),class:"tok-variableName tok-definition"},{tag:U.special(U.variableName),class:"tok-variableName2"},{tag:U.definition(U.propertyName),class:"tok-propertyName tok-definition"},{tag:U.typeName,class:"tok-typeName"},{tag:U.namespace,class:"tok-namespace"},{tag:U.className,class:"tok-className"},{tag:U.macroName,class:"tok-macroName"},{tag:U.propertyName,class:"tok-propertyName"},{tag:U.operator,class:"tok-operator"},{tag:U.comment,class:"tok-comment"},{tag:U.meta,class:"tok-meta"},{tag:U.invalid,class:"tok-invalid"},{tag:U.punctuation,class:"tok-punctuation"}]);const SE=316,wE=317,Yp=1,CE=2,PE=3,AE=4,xE=318,EE=320,kE=321,ME=5,DE=6,$E=0,Th=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],lO=125,TE=59,_h=47,_E=42,NE=43,BE=45,FE=60,RE=44,IE=63,LE=46,QE=91,VE=new hE({start:!1,shift(n,e){return e==ME||e==DE||e==EE?n:e==kE},strict:!1}),zE=new no((n,e)=>{let{next:t}=n;(t==lO||t==-1||e.context)&&n.acceptToken(xE)},{contextual:!0,fallback:!0}),jE=new no((n,e)=>{let{next:t}=n,i;Th.indexOf(t)>-1||t==_h&&((i=n.peek(1))==_h||i==_E)||t!=lO&&t!=TE&&t!=-1&&!e.context&&n.acceptToken(SE)},{contextual:!0}),ZE=new no((n,e)=>{n.next==QE&&!e.context&&n.acceptToken(wE)},{contextual:!0}),GE=new no((n,e)=>{let{next:t}=n;if(t==NE||t==BE){if(n.advance(),t==n.next){n.advance();let i=!e.context&&e.canShift(Yp);n.acceptToken(i?Yp:CE)}}else t==IE&&n.peek(1)==LE&&(n.advance(),n.advance(),(n.next<48||n.next>57)&&n.acceptToken(PE))},{contextual:!0});function Zu(n,e){return n>=65&&n<=90||n>=97&&n<=122||n==95||n>=192||!e&&n>=48&&n<=57}const UE=new no((n,e)=>{if(n.next!=FE||!e.dialectEnabled($E)||(n.advance(),n.next==_h))return;let t=0;for(;Th.indexOf(n.next)>-1;)n.advance(),t++;if(Zu(n.next,!0)){for(n.advance(),t++;Zu(n.next,!1);)n.advance(),t++;for(;Th.indexOf(n.next)>-1;)n.advance(),t++;if(n.next==RE)return;for(let i=0;;i++){if(i==7){if(!Zu(n.next,!0))return;break}if(n.next!="extends".charCodeAt(i))break;n.advance(),t++}}n.acceptToken(AE,-t)}),qE=rO({"get set async static":U.modifier,"for while do if else switch try catch finally return throw break continue default case defer":U.controlKeyword,"in of await yield void typeof delete instanceof as satisfies":U.operatorKeyword,"let var const using function class extends":U.definitionKeyword,"import export from":U.moduleKeyword,"with debugger new":U.keyword,TemplateString:U.special(U.string),super:U.atom,BooleanLiteral:U.bool,this:U.self,null:U.null,Star:U.modifier,VariableName:U.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":U.function(U.variableName),VariableDefinition:U.definition(U.variableName),Label:U.labelName,PropertyName:U.propertyName,PrivatePropertyName:U.special(U.propertyName),"CallExpression/MemberExpression/PropertyName":U.function(U.propertyName),"FunctionDeclaration/VariableDefinition":U.function(U.definition(U.variableName)),"ClassDeclaration/VariableDefinition":U.definition(U.className),"NewExpression/VariableName":U.className,PropertyDefinition:U.definition(U.propertyName),PrivatePropertyDefinition:U.definition(U.special(U.propertyName)),UpdateOp:U.updateOperator,"LineComment Hashbang":U.lineComment,BlockComment:U.blockComment,Number:U.number,String:U.string,Escape:U.escape,ArithOp:U.arithmeticOperator,LogicOp:U.logicOperator,BitOp:U.bitwiseOperator,CompareOp:U.compareOperator,RegExp:U.regexp,Equals:U.definitionOperator,Arrow:U.function(U.punctuation),": Spread":U.punctuation,"( )":U.paren,"[ ]":U.squareBracket,"{ }":U.brace,"InterpolationStart InterpolationEnd":U.special(U.brace),".":U.derefOperator,", ;":U.separator,"@":U.meta,TypeName:U.typeName,TypeDefinition:U.definition(U.typeName),"type enum interface implements namespace module declare":U.definitionKeyword,"abstract global Privacy readonly override":U.modifier,"is keyof unique infer asserts":U.operatorKeyword,JSXAttributeValue:U.attributeValue,JSXText:U.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":U.angleBracket,"JSXIdentifier JSXNameSpacedName":U.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":U.attributeName,"JSXBuiltin/JSXIdentifier":U.standard(U.tagName)}),WE={__proto__:null,export:20,as:25,from:33,default:36,async:41,function:42,in:52,out:55,const:56,extends:60,this:64,true:72,false:72,null:84,void:88,typeof:92,super:108,new:142,delete:154,yield:163,await:167,class:172,public:235,private:235,protected:235,readonly:237,instanceof:256,satisfies:259,import:292,keyof:349,unique:353,infer:359,asserts:395,is:397,abstract:417,implements:419,type:421,let:424,var:426,using:429,interface:435,enum:439,namespace:445,module:447,declare:451,global:455,defer:471,for:476,of:485,while:488,with:492,do:496,if:500,else:502,switch:506,case:512,try:518,catch:522,finally:526,return:530,throw:534,break:538,continue:542,debugger:546},XE={__proto__:null,async:129,get:131,set:133,declare:195,public:197,private:197,protected:197,static:199,abstract:201,override:203,readonly:209,accessor:211,new:401},HE={__proto__:null,"<":193},YE=pl.deserialize({version:14,states:"$F|Q%TQlOOO%[QlOOO'_QpOOP(lO`OOO*zQ!0MxO'#CiO+RO#tO'#CjO+aO&jO'#CjO+oO#@ItO'#DaO.QQlO'#DgO.bQlO'#DrO%[QlO'#DzO0fQlO'#ESOOQ!0Lf'#E['#E[O1PQ`O'#EXOOQO'#Ep'#EpOOQO'#Il'#IlO1XQ`O'#GsO1dQ`O'#EoO1iQ`O'#EoO3hQ!0MxO'#JrO6[Q!0MxO'#JsO6uQ`O'#F]O6zQ,UO'#FtOOQ!0Lf'#Ff'#FfO7VO7dO'#FfO9XQMhO'#F|O9`Q`O'#F{OOQ!0Lf'#Js'#JsOOQ!0Lb'#Jr'#JrO9eQ`O'#GwOOQ['#K_'#K_O9pQ`O'#IYO9uQ!0LrO'#IZOOQ['#J`'#J`OOQ['#I_'#I_Q`QlOOQ`QlOOO9}Q!L^O'#DvO:UQlO'#EOO:]QlO'#EQO9kQ`O'#GsO:dQMhO'#CoO:rQ`O'#EnO:}Q`O'#EyO;hQMhO'#FeO;xQ`O'#GsOOQO'#K`'#K`O;}Q`O'#K`O<]Q`O'#G{O<]Q`O'#G|O<]Q`O'#HOO9kQ`O'#HRO=SQ`O'#HUO>kQ`O'#CeO>{Q`O'#HcO?TQ`O'#HiO?TQ`O'#HkO`QlO'#HmO?TQ`O'#HoO?TQ`O'#HrO?YQ`O'#HxO?_Q!0LsO'#IOO%[QlO'#IQO?jQ!0LsO'#ISO?uQ!0LsO'#IUO9uQ!0LrO'#IWO@QQ!0MxO'#CiOASQpO'#DlQOQ`OOO%[QlO'#EQOAjQ`O'#ETO:dQMhO'#EnOAuQ`O'#EnOBQQ!bO'#FeOOQ['#Cg'#CgOOQ!0Lb'#Dq'#DqOOQ!0Lb'#Jv'#JvO%[QlO'#JvOOQO'#Jy'#JyOOQO'#Ih'#IhOCQQpO'#EgOOQ!0Lb'#Ef'#EfOOQ!0Lb'#J}'#J}OC|Q!0MSO'#EgODWQpO'#EWOOQO'#Jx'#JxODlQpO'#JyOEyQpO'#EWODWQpO'#EgPFWO&2DjO'#CbPOOO)CD})CD}OOOO'#I`'#I`OFcO#tO,59UOOQ!0Lh,59U,59UOOOO'#Ia'#IaOFqO&jO,59UOGPQ!L^O'#DcOOOO'#Ic'#IcOGWO#@ItO,59{OOQ!0Lf,59{,59{OGfQlO'#IdOGyQ`O'#JtOIxQ!fO'#JtO+}QlO'#JtOJPQ`O,5:ROJgQ`O'#EpOJtQ`O'#KTOKPQ`O'#KSOKPQ`O'#KSOKXQ`O,5;^OK^Q`O'#KROOQ!0Ln,5:^,5:^OKeQlO,5:^OMcQ!0MxO,5:fONSQ`O,5:nONmQ!0LrO'#KQONtQ`O'#KPO9eQ`O'#KPO! YQ`O'#KPO! bQ`O,5;]O! gQ`O'#KPO!#lQ!fO'#JsOOQ!0Lh'#Ci'#CiO%[QlO'#ESO!$[Q!fO,5:sOOQS'#Jz'#JzOOQO-E<j-E<jO9kQ`O,5=_O!$rQ`O,5=_O!$wQlO,5;ZO!&zQMhO'#EkO!(eQ`O,5;ZO!(jQlO'#DyO!(tQpO,5;dO!(|QpO,5;dO%[QlO,5;dOOQ['#FT'#FTOOQ['#FV'#FVO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eOOQ['#FZ'#FZO!)[QlO,5;tOOQ!0Lf,5;y,5;yOOQ!0Lf,5;z,5;zOOQ!0Lf,5;|,5;|O%[QlO'#IpO!+_Q!0LrO,5<iO%[QlO,5;eO!&zQMhO,5;eO!+|QMhO,5;eO!-nQMhO'#E^O%[QlO,5;wOOQ!0Lf,5;{,5;{O!-uQ,UO'#FjO!.rQ,UO'#KXO!.^Q,UO'#KXO!.yQ,UO'#KXOOQO'#KX'#KXO!/_Q,UO,5<SOOOW,5<`,5<`O!/pQlO'#FvOOOW'#Io'#IoO7VO7dO,5<QO!/wQ,UO'#FxOOQ!0Lf,5<Q,5<QO!0hQ$IUO'#CyOOQ!0Lh'#C}'#C}O!0{O#@ItO'#DRO!1iQMjO,5<eO!1pQ`O,5<hO!3YQ(CWO'#GXO!3jQ`O'#GYO!3oQ`O'#GYO!5_Q(CWO'#G^O!6dQpO'#GbOOQO'#Gn'#GnO!,TQMhO'#GmOOQO'#Gp'#GpO!,TQMhO'#GoO!7VQ$IUO'#JlOOQ!0Lh'#Jl'#JlO!7aQ`O'#JkO!7oQ`O'#JjO!7wQ`O'#CuOOQ!0Lh'#C{'#C{O!8YQ`O'#C}OOQ!0Lh'#DV'#DVOOQ!0Lh'#DX'#DXO!8_Q`O,5<eO1SQ`O'#DZO!,TQMhO'#GPO!,TQMhO'#GRO!8gQ`O'#GTO!8lQ`O'#GUO!3oQ`O'#G[O!,TQMhO'#GaO<]Q`O'#JkO!8qQ`O'#EqO!9`Q`O,5<gOOQ!0Lb'#Cr'#CrO!9hQ`O'#ErO!:bQpO'#EsOOQ!0Lb'#KR'#KRO!:iQ!0LrO'#KaO9uQ!0LrO,5=cO`QlO,5>tOOQ['#Jh'#JhOOQ[,5>u,5>uOOQ[-E<]-E<]O!<hQ!0MxO,5:bO!:]QpO,5:`O!?RQ!0MxO,5:jO%[QlO,5:jO!AiQ!0MxO,5:lOOQO,5@z,5@zO!BYQMhO,5=_O!BhQ!0LrO'#JiO9`Q`O'#JiO!ByQ!0LrO,59ZO!CUQpO,59ZO!C^QMhO,59ZO:dQMhO,59ZO!CiQ`O,5;ZO!CqQ`O'#HbO!DVQ`O'#KdO%[QlO,5;}O!:]QpO,5<PO!D_Q`O,5=zO!DdQ`O,5=zO!DiQ`O,5=zO!DwQ`O,5=zO9uQ!0LrO,5=zO<]Q`O,5=jOOQO'#Cy'#CyO!EOQpO,5=gO!EWQMhO,5=hO!EcQ`O,5=jO!EhQ!bO,5=mO!EpQ`O'#K`O?YQ`O'#HWO9kQ`O'#HYO!EuQ`O'#HYO:dQMhO'#H[O!EzQ`O'#H[OOQ[,5=p,5=pO!FPQ`O'#H]O!FbQ`O'#CoO!FgQ`O,59PO!FqQ`O,59PO!HvQlO,59POOQ[,59P,59PO!IWQ!0LrO,59PO%[QlO,59PO!KcQlO'#HeOOQ['#Hf'#HfOOQ['#Hg'#HgO`QlO,5=}O!KyQ`O,5=}O`QlO,5>TO`QlO,5>VO!LOQ`O,5>XO`QlO,5>ZO!LTQ`O,5>^O!LYQlO,5>dOOQ[,5>j,5>jO%[QlO,5>jO9uQ!0LrO,5>lOOQ[,5>n,5>nO#!dQ`O,5>nOOQ[,5>p,5>pO#!dQ`O,5>pOOQ[,5>r,5>rO##QQpO'#D_O%[QlO'#JvO##sQpO'#JvO##}QpO'#DmO#$`QpO'#DmO#&qQlO'#DmO#&xQ`O'#JuO#'QQ`O,5:WO#'VQ`O'#EtO#'eQ`O'#KUO#'mQ`O,5;_O#'rQpO'#DmO#(PQpO'#EVOOQ!0Lf,5:o,5:oO%[QlO,5:oO#(WQ`O,5:oO?YQ`O,5;YO!CUQpO,5;YO!C^QMhO,5;YO:dQMhO,5;YO#(`Q`O,5@bO#(eQ07dO,5:sOOQO-E<f-E<fO#)kQ!0MSO,5;RODWQpO,5:rO#)uQpO,5:rODWQpO,5;RO!ByQ!0LrO,5:rOOQ!0Lb'#Ej'#EjOOQO,5;R,5;RO%[QlO,5;RO#*SQ!0LrO,5;RO#*_Q!0LrO,5;RO!CUQpO,5:rOOQO,5;X,5;XO#*mQ!0LrO,5;RPOOO'#I^'#I^P#+RO&2DjO,58|POOO,58|,58|OOOO-E<^-E<^OOQ!0Lh1G.p1G.pOOOO-E<_-E<_OOOO,59},59}O#+^Q!bO,59}OOOO-E<a-E<aOOQ!0Lf1G/g1G/gO#+cQ!fO,5?OO+}QlO,5?OOOQO,5?U,5?UO#+mQlO'#IdOOQO-E<b-E<bO#+zQ`O,5@`O#,SQ!fO,5@`O#,ZQ`O,5@nOOQ!0Lf1G/m1G/mO%[QlO,5@oO#,cQ`O'#IjOOQO-E<h-E<hO#,ZQ`O,5@nOOQ!0Lb1G0x1G0xOOQ!0Ln1G/x1G/xOOQ!0Ln1G0Y1G0YO%[QlO,5@lO#,wQ!0LrO,5@lO#-YQ!0LrO,5@lO#-aQ`O,5@kO9eQ`O,5@kO#-iQ`O,5@kO#-wQ`O'#ImO#-aQ`O,5@kOOQ!0Lb1G0w1G0wO!(tQpO,5:uO!)PQpO,5:uOOQS,5:w,5:wO#.iQdO,5:wO#.qQMhO1G2yO9kQ`O1G2yOOQ!0Lf1G0u1G0uO#/PQ!0MxO1G0uO#0UQ!0MvO,5;VOOQ!0Lh'#GW'#GWO#0rQ!0MzO'#JlO!$wQlO1G0uO#2}Q!fO'#JwO%[QlO'#JwO#3XQ`O,5:eOOQ!0Lh'#D_'#D_OOQ!0Lf1G1O1G1OO%[QlO1G1OOOQ!0Lf1G1f1G1fO#3^Q`O1G1OO#5rQ!0MxO1G1PO#5yQ!0MxO1G1PO#8aQ!0MxO1G1PO#8hQ!0MxO1G1PO#;OQ!0MxO1G1PO#=fQ!0MxO1G1PO#=mQ!0MxO1G1PO#=tQ!0MxO1G1PO#@[Q!0MxO1G1PO#@cQ!0MxO1G1PO#BpQ?MtO'#CiO#DkQ?MtO1G1`O#DrQ?MtO'#JsO#EVQ!0MxO,5?[OOQ!0Lb-E<n-E<nO#GdQ!0MxO1G1PO#HaQ!0MzO1G1POOQ!0Lf1G1P1G1PO#IdQMjO'#J|O#InQ`O,5:xO#IsQ!0MxO1G1cO#JgQ,UO,5<WO#JoQ,UO,5<XO#JwQ,UO'#FoO#K`Q`O'#FnOOQO'#KY'#KYOOQO'#In'#InO#KeQ,UO1G1nOOQ!0Lf1G1n1G1nOOOW1G1y1G1yO#KvQ?MtO'#JrO#LQQ`O,5<bO!)[QlO,5<bOOOW-E<m-E<mOOQ!0Lf1G1l1G1lO#LVQpO'#KXOOQ!0Lf,5<d,5<dO#L_QpO,5<dO#LdQMhO'#DTOOOO'#Ib'#IbO#LkO#@ItO,59mOOQ!0Lh,59m,59mO%[QlO1G2PO!8lQ`O'#IrO#LvQ`O,5<zOOQ!0Lh,5<w,5<wO!,TQMhO'#IuO#MdQMjO,5=XO!,TQMhO'#IwO#NVQMjO,5=ZO!&zQMhO,5=]OOQO1G2S1G2SO#NaQ!dO'#CrO#NtQ(CWO'#ErO$ |QpO'#GbO$!dQ!dO,5<sO$!kQ`O'#K[O9eQ`O'#K[O$!yQ`O,5<uO$#aQ!dO'#C{O!,TQMhO,5<tO$#kQ`O'#GZO$$PQ`O,5<tO$$UQ!dO'#GWO$$cQ!dO'#K]O$$mQ`O'#K]O!&zQMhO'#K]O$$rQ`O,5<xO$$wQlO'#JvO$%RQpO'#GcO#$`QpO'#GcO$%dQ`O'#GgO!3oQ`O'#GkO$%iQ!0LrO'#ItO$%tQpO,5<|OOQ!0Lp,5<|,5<|O$%{QpO'#GcO$&YQpO'#GdO$&kQpO'#GdO$&pQMjO,5=XO$'QQMjO,5=ZOOQ!0Lh,5=^,5=^O!,TQMhO,5@VO!,TQMhO,5@VO$'bQ`O'#IyO$'vQ`O,5@UO$(OQ`O,59aOOQ!0Lh,59i,59iO$(TQ`O,5@VO$)TQ$IYO,59uOOQ!0Lh'#Jp'#JpO$)vQMjO,5<kO$*iQMjO,5<mO@zQ`O,5<oOOQ!0Lh,5<p,5<pO$*sQ`O,5<vO$*xQMjO,5<{O$+YQ`O'#KPO!$wQlO1G2RO$+_Q`O1G2RO9eQ`O'#KSO9eQ`O'#EtO%[QlO'#EtO9eQ`O'#I{O$+dQ!0LrO,5@{OOQ[1G2}1G2}OOQ[1G4`1G4`OOQ!0Lf1G/|1G/|OOQ!0Lf1G/z1G/zO$-fQ!0MxO1G0UOOQ[1G2y1G2yO!&zQMhO1G2yO%[QlO1G2yO#.tQ`O1G2yO$/jQMhO'#EkOOQ!0Lb,5@T,5@TO$/wQ!0LrO,5@TOOQ[1G.u1G.uO!ByQ!0LrO1G.uO!CUQpO1G.uO!C^QMhO1G.uO$0YQ`O1G0uO$0_Q`O'#CiO$0jQ`O'#KeO$0rQ`O,5=|O$0wQ`O'#KeO$0|Q`O'#KeO$1[Q`O'#JRO$1jQ`O,5AOO$1rQ!fO1G1iOOQ!0Lf1G1k1G1kO9kQ`O1G3fO@zQ`O1G3fO$1yQ`O1G3fO$2OQ`O1G3fO!DiQ`O1G3fO9uQ!0LrO1G3fOOQ[1G3f1G3fO!EcQ`O1G3UO!&zQMhO1G3RO$2TQ`O1G3ROOQ[1G3S1G3SO!&zQMhO1G3SO$2YQ`O1G3SO$2bQpO'#HQOOQ[1G3U1G3UO!6_QpO'#I}O!EhQ!bO1G3XOOQ[1G3X1G3XOOQ[,5=r,5=rO$2jQMhO,5=tO9kQ`O,5=tO$%dQ`O,5=vO9`Q`O,5=vO!CUQpO,5=vO!C^QMhO,5=vO:dQMhO,5=vO$2xQ`O'#KcO$3TQ`O,5=wOOQ[1G.k1G.kO$3YQ!0LrO1G.kO@zQ`O1G.kO$3eQ`O1G.kO9uQ!0LrO1G.kO$5mQ!fO,5AQO$5zQ`O,5AQO9eQ`O,5AQO$6VQlO,5>PO$6^Q`O,5>POOQ[1G3i1G3iO`QlO1G3iOOQ[1G3o1G3oOOQ[1G3q1G3qO?TQ`O1G3sO$6cQlO1G3uO$:gQlO'#HtOOQ[1G3x1G3xO$:tQ`O'#HzO?YQ`O'#H|OOQ[1G4O1G4OO$:|QlO1G4OO9uQ!0LrO1G4UOOQ[1G4W1G4WOOQ!0Lb'#G_'#G_O9uQ!0LrO1G4YO9uQ!0LrO1G4[O$?TQ`O,5@bO!)[QlO,5;`O9eQ`O,5;`O?YQ`O,5:XO!)[QlO,5:XO!CUQpO,5:XO$?YQ?MtO,5:XOOQO,5;`,5;`O$?dQpO'#IeO$?zQ`O,5@aOOQ!0Lf1G/r1G/rO$@SQpO'#IkO$@^Q`O,5@pOOQ!0Lb1G0y1G0yO#$`QpO,5:XOOQO'#Ig'#IgO$@fQpO,5:qOOQ!0Ln,5:q,5:qO#(ZQ`O1G0ZOOQ!0Lf1G0Z1G0ZO%[QlO1G0ZOOQ!0Lf1G0t1G0tO?YQ`O1G0tO!CUQpO1G0tO!C^QMhO1G0tOOQ!0Lb1G5|1G5|O!ByQ!0LrO1G0^OOQO1G0m1G0mO%[QlO1G0mO$@mQ!0LrO1G0mO$@xQ!0LrO1G0mO!CUQpO1G0^ODWQpO1G0^O$AWQ!0LrO1G0mOOQO1G0^1G0^O$AlQ!0MxO1G0mPOOO-E<[-E<[POOO1G.h1G.hOOOO1G/i1G/iO$AvQ!bO,5<iO$BOQ!fO1G4jOOQO1G4p1G4pO%[QlO,5?OO$BYQ`O1G5zO$BbQ`O1G6YO$BjQ!fO1G6ZO9eQ`O,5?UO$BtQ!0MxO1G6WO%[QlO1G6WO$CUQ!0LrO1G6WO$CgQ`O1G6VO$CgQ`O1G6VO9eQ`O1G6VO$CoQ`O,5?XO9eQ`O,5?XOOQO,5?X,5?XO$DTQ`O,5?XO$+YQ`O,5?XOOQO-E<k-E<kOOQS1G0a1G0aOOQS1G0c1G0cO#.lQ`O1G0cOOQ[7+(e7+(eO!&zQMhO7+(eO%[QlO7+(eO$DcQ`O7+(eO$DnQMhO7+(eO$D|Q!0MzO,5=XO$GXQ!0MzO,5=ZO$IdQ!0MzO,5=XO$KuQ!0MzO,5=ZO$NWQ!0MzO,59uO%!]Q!0MzO,5<kO%$hQ!0MzO,5<mO%&sQ!0MzO,5<{OOQ!0Lf7+&a7+&aO%)UQ!0MxO7+&aO%)xQlO'#IfO%*VQ`O,5@cO%*_Q!fO,5@cOOQ!0Lf1G0P1G0PO%*iQ`O7+&jOOQ!0Lf7+&j7+&jO%*nQ?MtO,5:fO%[QlO7+&zO%*xQ?MtO,5:bO%+VQ?MtO,5:jO%+aQ?MtO,5:lO%+kQMhO'#IiO%+uQ`O,5@hOOQ!0Lh1G0d1G0dOOQO1G1r1G1rOOQO1G1s1G1sO%+}Q!jO,5<ZO!)[QlO,5<YOOQO-E<l-E<lOOQ!0Lf7+'Y7+'YOOOW7+'e7+'eOOOW1G1|1G1|O%,YQ`O1G1|OOQ!0Lf1G2O1G2OOOOO,59o,59oO%,_Q!dO,59oOOOO-E<`-E<`OOQ!0Lh1G/X1G/XO%,fQ!0MxO7+'kOOQ!0Lh,5?^,5?^O%-YQMhO1G2fP%-aQ`O'#IrPOQ!0Lh-E<p-E<pO%-}QMjO,5?aOOQ!0Lh-E<s-E<sO%.pQMjO,5?cOOQ!0Lh-E<u-E<uO%.zQ!dO1G2wO%/RQ!dO'#CrO%/iQMhO'#KSO$$wQlO'#JvOOQ!0Lh1G2_1G2_O%/sQ`O'#IqO%0[Q`O,5@vO%0[Q`O,5@vO%0dQ`O,5@vO%0oQ`O,5@vOOQO1G2a1G2aO%0}QMjO1G2`O$+YQ`O'#K[O!,TQMhO1G2`O%1_Q(CWO'#IsO%1lQ`O,5@wO!&zQMhO,5@wO%1tQ!dO,5@wOOQ!0Lh1G2d1G2dO%4UQ!fO'#CiO%4`Q`O,5=POOQ!0Lb,5<},5<}O%4hQpO,5<}OOQ!0Lb,5=O,5=OOCwQ`O,5<}O%4sQpO,5<}OOQ!0Lb,5=R,5=RO$+YQ`O,5=VOOQO,5?`,5?`OOQO-E<r-E<rOOQ!0Lp1G2h1G2hO#$`QpO,5<}O$$wQlO,5=PO%5RQ`O,5=OO%5^QpO,5=OO!,TQMhO'#IuO%6WQMjO1G2sO!,TQMhO'#IwO%6yQMjO1G2uO%7TQMjO1G5qO%7_QMjO1G5qOOQO,5?e,5?eOOQO-E<w-E<wOOQO1G.{1G.{O!,TQMhO1G5qO!,TQMhO1G5qO!:]QpO,59wO%[QlO,59wOOQ!0Lh,5<j,5<jO%7lQ`O1G2ZO!,TQMhO1G2bO%7qQ!0MxO7+'mOOQ!0Lf7+'m7+'mO!$wQlO7+'mO%8eQ`O,5;`OOQ!0Lb,5?g,5?gOOQ!0Lb-E<y-E<yO%8jQ!dO'#K^O#(ZQ`O7+(eO4UQ!fO7+(eO$DfQ`O7+(eO%8tQ!0MvO'#CiO%9XQ!0MvO,5=SO%9lQ`O,5=SO%9tQ`O,5=SOOQ!0Lb1G5o1G5oOOQ[7+$a7+$aO!ByQ!0LrO7+$aO!CUQpO7+$aO!$wQlO7+&aO%9yQ`O'#JQO%:bQ`O,5APOOQO1G3h1G3hO9kQ`O,5APO%:bQ`O,5APO%:jQ`O,5APOOQO,5?m,5?mOOQO-E=P-E=POOQ!0Lf7+'T7+'TO%:oQ`O7+)QO9uQ!0LrO7+)QO9kQ`O7+)QO@zQ`O7+)QO%:tQ`O7+)QOOQ[7+)Q7+)QOOQ[7+(p7+(pO%:yQ!0MvO7+(mO!&zQMhO7+(mO!E^Q`O7+(nOOQ[7+(n7+(nO!&zQMhO7+(nO%;TQ`O'#KbO%;`Q`O,5=lOOQO,5?i,5?iOOQO-E<{-E<{OOQ[7+(s7+(sO%<rQpO'#HZOOQ[1G3`1G3`O!&zQMhO1G3`O%[QlO1G3`O%<yQ`O1G3`O%=UQMhO1G3`O9uQ!0LrO1G3bO$%dQ`O1G3bO9`Q`O1G3bO!CUQpO1G3bO!C^QMhO1G3bO%=dQ`O'#JPO%=xQ`O,5@}O%>QQpO,5@}OOQ!0Lb1G3c1G3cOOQ[7+$V7+$VO@zQ`O7+$VO9uQ!0LrO7+$VO%>]Q`O7+$VO%[QlO1G6lO%[QlO1G6mO%>bQ!0LrO1G6lO%>lQlO1G3kO%>sQ`O1G3kO%>xQlO1G3kOOQ[7+)T7+)TO9uQ!0LrO7+)_O`QlO7+)aOOQ['#Kh'#KhOOQ['#JS'#JSO%?PQlO,5>`OOQ[,5>`,5>`O%[QlO'#HuO%?^Q`O'#HwOOQ[,5>f,5>fO9eQ`O,5>fOOQ[,5>h,5>hOOQ[7+)j7+)jOOQ[7+)p7+)pOOQ[7+)t7+)tOOQ[7+)v7+)vO%?cQpO1G5|O%?}Q?MtO1G0zO%@XQ`O1G0zOOQO1G/s1G/sO%@dQ?MtO1G/sO?YQ`O1G/sO!)[QlO'#DmOOQO,5?P,5?POOQO-E<c-E<cOOQO,5?V,5?VOOQO-E<i-E<iO!CUQpO1G/sOOQO-E<e-E<eOOQ!0Ln1G0]1G0]OOQ!0Lf7+%u7+%uO#(ZQ`O7+%uOOQ!0Lf7+&`7+&`O?YQ`O7+&`O!CUQpO7+&`OOQO7+%x7+%xO$AlQ!0MxO7+&XOOQO7+&X7+&XO%[QlO7+&XO%@nQ!0LrO7+&XO!ByQ!0LrO7+%xO!CUQpO7+%xO%@yQ!0LrO7+&XO%AXQ!0MxO7++rO%[QlO7++rO%AiQ`O7++qO%AiQ`O7++qOOQO1G4s1G4sO9eQ`O1G4sO%AqQ`O1G4sOOQS7+%}7+%}O#(ZQ`O<<LPO4UQ!fO<<LPO%BPQ`O<<LPOOQ[<<LP<<LPO!&zQMhO<<LPO%[QlO<<LPO%BXQ`O<<LPO%BdQ!0MzO,5?aO%DoQ!0MzO,5?cO%FzQ!0MzO1G2`O%I]Q!0MzO1G2sO%KhQ!0MzO1G2uO%MsQ!fO,5?QO%[QlO,5?QOOQO-E<d-E<dO%M}Q`O1G5}OOQ!0Lf<<JU<<JUO%NVQ?MtO1G0uO&!^Q?MtO1G1PO&!eQ?MtO1G1PO&$fQ?MtO1G1PO&$mQ?MtO1G1PO&&nQ?MtO1G1PO&(oQ?MtO1G1PO&(vQ?MtO1G1PO&(}Q?MtO1G1PO&+OQ?MtO1G1PO&+VQ?MtO1G1PO&+^Q!0MxO<<JfO&-UQ?MtO1G1PO&.RQ?MvO1G1PO&/UQ?MvO'#JlO&1[Q?MtO1G1cO&1iQ?MtO1G0UO&1sQMjO,5?TOOQO-E<g-E<gO!)[QlO'#FqOOQO'#KZ'#KZOOQO1G1u1G1uO&1}Q`O1G1tO&2SQ?MtO,5?[OOOW7+'h7+'hOOOO1G/Z1G/ZO&2^Q!dO1G4xOOQ!0Lh7+(Q7+(QP!&zQMhO,5?^O!,TQMhO7+(cO&2eQ`O,5?]O9eQ`O,5?]O$+YQ`O,5?]OOQO-E<o-E<oO&2sQ`O1G6bO&2sQ`O1G6bO&2{Q`O1G6bO&3WQMjO7+'zO&3hQ!dO,5?_O&3rQ`O,5?_O!&zQMhO,5?_OOQO-E<q-E<qO&3wQ!dO1G6cO&4RQ`O1G6cO&4ZQ`O1G2kO!&zQMhO1G2kOOQ!0Lb1G2i1G2iOOQ!0Lb1G2j1G2jO%4hQpO1G2iO!CUQpO1G2iOCwQ`O1G2iOOQ!0Lb1G2q1G2qO&4`QpO1G2iO&4nQ`O1G2kO$+YQ`O1G2jOCwQ`O1G2jO$$wQlO1G2kO&4vQ`O1G2jO&5jQMjO,5?aOOQ!0Lh-E<t-E<tO&6]QMjO,5?cOOQ!0Lh-E<v-E<vO!,TQMhO7++]O&6gQMjO7++]O&6qQMjO7++]OOQ!0Lh1G/c1G/cO&7OQ`O1G/cOOQ!0Lh7+'u7+'uO&7TQMjO7+'|O&7eQ!0MxO<<KXOOQ!0Lf<<KX<<KXO&8XQ`O1G0zO!&zQMhO'#IzO&8^Q`O,5@xO&:`Q!fO<<LPO!&zQMhO1G2nO&:gQ!0LrO1G2nOOQ[<<G{<<G{O!ByQ!0LrO<<G{O&:xQ!0MxO<<I{OOQ!0Lf<<I{<<I{OOQO,5?l,5?lO&;lQ`O,5?lO&;qQ`O,5?lOOQO-E=O-E=OO&<PQ`O1G6kO&<PQ`O1G6kO9kQ`O1G6kO@zQ`O<<LlOOQ[<<Ll<<LlO&<XQ`O<<LlO9uQ!0LrO<<LlO9kQ`O<<LlOOQ[<<LX<<LXO%:yQ!0MvO<<LXOOQ[<<LY<<LYO!E^Q`O<<LYO&<^QpO'#I|O&<iQ`O,5@|O!)[QlO,5@|OOQ[1G3W1G3WOOQO'#JO'#JOO9uQ!0LrO'#JOO&<qQpO,5=uOOQ[,5=u,5=uO&<xQpO'#EgO&=PQpO'#GeO&=UQ`O7+(zO&=ZQ`O7+(zOOQ[7+(z7+(zO!&zQMhO7+(zO%[QlO7+(zO&=cQ`O7+(zOOQ[7+(|7+(|O9uQ!0LrO7+(|O$%dQ`O7+(|O9`Q`O7+(|O!CUQpO7+(|O&=nQ`O,5?kOOQO-E<}-E<}OOQO'#H^'#H^O&=yQ`O1G6iO9uQ!0LrO<<GqOOQ[<<Gq<<GqO@zQ`O<<GqO&>RQ`O7+,WO&>WQ`O7+,XO%[QlO7+,WO%[QlO7+,XOOQ[7+)V7+)VO&>]Q`O7+)VO&>bQlO7+)VO&>iQ`O7+)VOOQ[<<Ly<<LyOOQ[<<L{<<L{OOQ[-E=Q-E=QOOQ[1G3z1G3zO&>nQ`O,5>aOOQ[,5>c,5>cO&>sQ`O1G4QO9eQ`O7+&fO!)[QlO7+&fOOQO7+%_7+%_O&>xQ?MtO1G6ZO?YQ`O7+%_OOQ!0Lf<<Ia<<IaOOQ!0Lf<<Iz<<IzO?YQ`O<<IzOOQO<<Is<<IsO$AlQ!0MxO<<IsO%[QlO<<IsOOQO<<Id<<IdO!ByQ!0LrO<<IdO&?SQ!0LrO<<IsO&?_Q!0MxO<= ^O&?oQ`O<= ]OOQO7+*_7+*_O9eQ`O7+*_OOQ[ANAkANAkO&?wQ!fOANAkO!&zQMhOANAkO#(ZQ`OANAkO4UQ!fOANAkO&@OQ`OANAkO%[QlOANAkO&@WQ!0MzO7+'zO&BiQ!0MzO,5?aO&DtQ!0MzO,5?cO&GPQ!0MzO7+'|O&IbQ!fO1G4lO&IlQ?MtO7+&aO&KpQ?MvO,5=XO&MwQ?MvO,5=ZO&NXQ?MvO,5=XO&NiQ?MvO,5=ZO&NyQ?MvO,59uO'#PQ?MvO,5<kO'%SQ?MvO,5<mO''hQ?MvO,5<{O')^Q?MtO7+'kO')kQ?MtO7+'mO')xQ`O,5<]OOQO7+'`7+'`OOQ!0Lh7+*d7+*dO')}QMjO<<K}OOQO1G4w1G4wO'*UQ`O1G4wO'*aQ`O1G4wO'*oQ`O7++|O'*oQ`O7++|O!&zQMhO1G4yO'*wQ!dO1G4yO'+RQ`O7++}O'+ZQ`O7+(VO'+fQ!dO7+(VOOQ!0Lb7+(T7+(TOOQ!0Lb7+(U7+(UO!CUQpO7+(TOCwQ`O7+(TO'+pQ`O7+(VO!&zQMhO7+(VO$+YQ`O7+(UO'+uQ`O7+(VOCwQ`O7+(UO'+}QMjO<<NwO!,TQMhO<<NwOOQ!0Lh7+$}7+$}O',XQ!dO,5?fOOQO-E<x-E<xO',cQ!0MvO7+(YO!&zQMhO7+(YOOQ[AN=gAN=gO9kQ`O1G5WOOQO1G5W1G5WO',sQ`O1G5WO',xQ`O7+,VO',xQ`O7+,VO9uQ!0LrOANBWO@zQ`OANBWOOQ[ANBWANBWO'-QQ`OANBWOOQ[ANAsANAsOOQ[ANAtANAtO'-VQ`O,5?hOOQO-E<z-E<zO'-bQ?MtO1G6hOOQO,5?j,5?jOOQO-E<|-E<|OOQ[1G3a1G3aO'-lQ`O,5=POOQ[<<Lf<<LfO!&zQMhO<<LfO&=UQ`O<<LfO'-qQ`O<<LfO%[QlO<<LfOOQ[<<Lh<<LhO9uQ!0LrO<<LhO$%dQ`O<<LhO9`Q`O<<LhO'-yQpO1G5VO'.UQ`O7+,TOOQ[AN=]AN=]O9uQ!0LrOAN=]OOQ[<= r<= rOOQ[<= s<= sO'.^Q`O<= rO'.cQ`O<= sOOQ[<<Lq<<LqO'.hQ`O<<LqO'.mQlO<<LqOOQ[1G3{1G3{O?YQ`O7+)lO'.tQ`O<<JQO'/PQ?MtO<<JQOOQO<<Hy<<HyOOQ!0LfAN?fAN?fOOQOAN?_AN?_O$AlQ!0MxOAN?_OOQOAN?OAN?OO%[QlOAN?_OOQO<<My<<MyOOQ[G27VG27VO!&zQMhOG27VO#(ZQ`OG27VO'/ZQ!fOG27VO4UQ!fOG27VO'/bQ`OG27VO'/jQ?MtO<<JfO'/wQ?MvO1G2`O'1mQ?MvO,5?aO'3pQ?MvO,5?cO'5sQ?MvO1G2sO'7vQ?MvO1G2uO'9yQ?MtO<<KXO':WQ?MtO<<I{OOQO1G1w1G1wO!,TQMhOANAiOOQO7+*c7+*cO':eQ`O7+*cO':pQ`O<= hO':xQ!dO7+*eOOQ!0Lb<<Kq<<KqO$+YQ`O<<KqOCwQ`O<<KqO';SQ`O<<KqO!&zQMhO<<KqOOQ!0Lb<<Ko<<KoO!CUQpO<<KoO';_Q!dO<<KqOOQ!0Lb<<Kp<<KpO';iQ`O<<KqO!&zQMhO<<KqO$+YQ`O<<KpO';nQMjOANDcO';xQ!0MvO<<KtOOQO7+*r7+*rO9kQ`O7+*rO'<YQ`O<= qOOQ[G27rG27rO9uQ!0LrOG27rO@zQ`OG27rO!)[QlO1G5SO'<bQ`O7+,SO'<jQ`O1G2kO&=UQ`OANBQOOQ[ANBQANBQO!&zQMhOANBQO'<oQ`OANBQOOQ[ANBSANBSO9uQ!0LrOANBSO$%dQ`OANBSOOQO'#H_'#H_OOQO7+*q7+*qOOQ[G22wG22wOOQ[ANE^ANE^OOQ[ANE_ANE_OOQ[ANB]ANB]O'<wQ`OANB]OOQ[<<MW<<MWO!)[QlOAN?lOOQOG24yG24yO$AlQ!0MxOG24yO#(ZQ`OLD,qOOQ[LD,qLD,qO!&zQMhOLD,qO'<|Q!fOLD,qO'=TQ?MvO7+'zO'>yQ?MvO,5?aO'@|Q?MvO,5?cO'CPQ?MvO7+'|O'DuQMjOG27TOOQO<<M}<<M}OOQ!0LbANA]ANA]O$+YQ`OANA]OCwQ`OANA]O'EVQ!dOANA]OOQ!0LbANAZANAZO'E^Q`OANA]O!&zQMhOANA]O'EiQ!dOANA]OOQ!0LbANA[ANA[OOQO<<N^<<N^OOQ[LD-^LD-^O9uQ!0LrOLD-^O'EsQ?MtO7+*nOOQO'#Gf'#GfOOQ[G27lG27lO&=UQ`OG27lO!&zQMhOG27lOOQ[G27nG27nO9uQ!0LrOG27nOOQ[G27wG27wO'E}Q?MtOG25WOOQOLD*eLD*eOOQ[!$(!]!$(!]O#(ZQ`O!$(!]O!&zQMhO!$(!]O'FXQ!0MzOG27TOOQ!0LbG26wG26wO$+YQ`OG26wO'HjQ`OG26wOCwQ`OG26wO'HuQ!dOG26wO!&zQMhOG26wOOQ[!$(!x!$(!xOOQ[LD-WLD-WO&=UQ`OLD-WOOQ[LD-YLD-YOOQ[!)9Ew!)9EwO#(ZQ`O!)9EwOOQ!0LbLD,cLD,cO$+YQ`OLD,cOCwQ`OLD,cO'H|Q`OLD,cO'IXQ!dOLD,cOOQ[!$(!r!$(!rOOQ[!.K;c!.K;cO'I`Q?MvOG27TOOQ!0Lb!$( }!$( }O$+YQ`O!$( }OCwQ`O!$( }O'KUQ`O!$( }OOQ!0Lb!)9Ei!)9EiO$+YQ`O!)9EiOCwQ`O!)9EiOOQ!0Lb!.K;T!.K;TO$+YQ`O!.K;TOOQ!0Lb!4/0o!4/0oO!)[QlO'#DzO1PQ`O'#EXO'KaQ!fO'#JrO'KhQ!L^O'#DvO'KoQlO'#EOO'KvQ!fO'#CiO'N^Q!fO'#CiO!)[QlO'#EQO'NnQlO,5;ZO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO'#IpO(!qQ`O,5<iO!)[QlO,5;eO(!yQMhO,5;eO($dQMhO,5;eO!)[QlO,5;wO!&zQMhO'#GmO(!yQMhO'#GmO!&zQMhO'#GoO(!yQMhO'#GoO1SQ`O'#DZO1SQ`O'#DZO!&zQMhO'#GPO(!yQMhO'#GPO!&zQMhO'#GRO(!yQMhO'#GRO!&zQMhO'#GaO(!yQMhO'#GaO!)[QlO,5:jO($kQpO'#D_O($uQpO'#JvO!)[QlO,5@oO'NnQlO1G0uO(%PQ?MtO'#CiO!)[QlO1G2PO!&zQMhO'#IuO(!yQMhO'#IuO!&zQMhO'#IwO(!yQMhO'#IwO(%ZQ!dO'#CrO!&zQMhO,5<tO(!yQMhO,5<tO'NnQlO1G2RO!)[QlO7+&zO!&zQMhO1G2`O(!yQMhO1G2`O!&zQMhO'#IuO(!yQMhO'#IuO!&zQMhO'#IwO(!yQMhO'#IwO!&zQMhO1G2bO(!yQMhO1G2bO'NnQlO7+'mO'NnQlO7+&aO!&zQMhOANAiO(!yQMhOANAiO(%nQ`O'#EoO(%sQ`O'#EoO(%{Q`O'#F]O(&QQ`O'#EyO(&VQ`O'#KTO(&bQ`O'#KRO(&mQ`O,5;ZO(&rQMjO,5<eO(&yQ`O'#GYO('OQ`O'#GYO('TQ`O,5<eO(']Q`O,5<gO('eQ`O,5;ZO('mQ?MtO1G1`O('tQ`O,5<tO('yQ`O,5<tO((OQ`O,5<vO((TQ`O,5<vO((YQ`O1G2RO((_Q`O1G0uO((dQMjO<<K}O((kQMjO<<K}O((rQMhO'#F|O9`Q`O'#F{OAuQ`O'#EnO!)[QlO,5;tO!3oQ`O'#GYO!3oQ`O'#GYO!3oQ`O'#G[O!3oQ`O'#G[O!,TQMhO7+(cO!,TQMhO7+(cO%.zQ!dO1G2wO%.zQ!dO1G2wO!&zQMhO,5=]O!&zQMhO,5=]",stateData:"()x~O'|OS'}OSTOS(ORQ~OPYOQYOSfOY!VOaqOdzOeyOl!POpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_XO!iuO!lZO!oYO!pYO!qYO!svO!uwO!xxO!|]O$W|O$niO%h}O%j!QO%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO%y!UO&W!WO&^!XO&`!YO&b!ZO&d![O&g!]O&m!^O&s!_O&u!`O&w!aO&y!bO&{!cO(TSO(VTO(YUO(aVO(o[O~OWtO~P`OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oa!wOs!nO!S!oO!b!yO!c!vO!d!vO!|<VO#T!pO#U!pO#V!xO#W!pO#X!pO#[!zO#]!zO(U!lO(VTO(YUO(e!mO(o!sO~O(O!{O~OP]XR]X[]Xa]Xj]Xr]X!Q]X!S]X!]]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X'z]X(a]X(r]X(y]X(z]X~O!g%RX~P(qO_!}O(V#PO(W!}O(X#PO~O_#QO(X#PO(Y#PO(Z#QO~Ox#SO!U#TO(b#TO(c#VO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T<ZO(VTO(YUO(aVO(o[O~O![#ZO!]#WO!Y(hP!Y(vP~P+}O!^#cO~P`OPYOQYOSfOd!jOe!iOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(VTO(YUO(aVO(o[O~Op#mO![#iO!|]O#i#lO#j#iO(T<[O!k(sP~P.iO!l#oO(T#nO~O!x#sO!|]O%h#tO~O#k#uO~O!g#vO#k#uO~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!]$_O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~Oa(fX'z(fX'w(fX!k(fX!Y(fX!_(fX%i(fX!g(fX~P1qO#S$dO#`$eO$Q$eOP(gXR(gX[(gXj(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX!_(gX%i(gX~Oa(gX'z(gX'w(gX!Y(gX!k(gXv(gX!g(gX~P4UO#`$eO~O$]$hO$_$gO$f$mO~OSfO!_$nO$i$oO$k$qO~Oh%VOj%dOk%dOp%WOr%XOs$tOt$tOz%YO|%ZO!O%]O!S${O!_$|O!i%bO!l$xO#j%cO$W%`O$t%^O$v%_O$y%aO(T$sO(VTO(YUO(a$uO(y$}O(z%POg(^P~Ol%[O~P7eO!l%eO~O!S%hO!_%iO(T%gO~O!g%mO~Oa%nO'z%nO~O!Q%rO~P%[O(U!lO~P%[O%n%vO~P%[Oh%VO!l%eO(T%gO(U!lO~Oe%}O!l%eO(T%gO~Oj$RO~O!_&PO(T%gO(U!lO(VTO(YUO`)WP~O!Q&SO!l&RO%j&VO&T&WO~P;SO!x#sO~O%s&YO!S)SX!_)SX(T)SX~O(T&ZO~Ol!PO!u&`O%j!QO%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO~Od&eOe&dO!x&bO%h&cO%{&aO~P<bOd&hOeyOl!PO!_&gO!u&`O!xxO!|]O%h}O%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO%y!UO~Ob&kO#`&nO%j&iO(U!lO~P=gO!l&oO!u&sO~O!l#oO~O!_XO~Oa%nO'x&{O'z%nO~Oa%nO'x'OO'z%nO~Oa%nO'x'QO'z%nO~O'w]X!Y]Xv]X!k]X&[]X!_]X%i]X!g]X~P(qO!b'_O!c'WO!d'WO(U!lO(VTO(YUO~Os'UO!S'TO!['XO(e'SO!^(iP!^(xP~P@nOn'bO!_'`O(T%gO~Oe'gO!l%eO(T%gO~O!Q&SO!l&RO~Os!nO!S!oO!|<VO#T!pO#U!pO#W!pO#X!pO(U!lO(VTO(YUO(e!mO(o!sO~O!b'mO!c'lO!d'lO#V!pO#['nO#]'nO~PBYOa%nOh%VO!g#vO!l%eO'z%nO(r'pO~O!p'tO#`'rO~PChOs!nO!S!oO(VTO(YUO(e!mO(o!sO~O!_XOs(mX!S(mX!b(mX!c(mX!d(mX!|(mX#T(mX#U(mX#V(mX#W(mX#X(mX#[(mX#](mX(U(mX(V(mX(Y(mX(e(mX(o(mX~O!c'lO!d'lO(U!lO~PDWO(P'xO(Q'xO(R'zO~O_!}O(V'|O(W!}O(X'|O~O_#QO(X'|O(Y'|O(Z#QO~Ov(OO~P%[Ox#SO!U#TO(b#TO(c(RO~O![(TO!Y'WX!Y'^X!]'WX!]'^X~P+}O!](VO!Y(hX~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!](VO!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~O!Y(hX~PHRO!Y([O~O!Y(uX!](uX!g(uX!k(uX(r(uX~O#`(uX#k#dX!^(uX~PJUO#`(]O!Y(wX!](wX~O!](^O!Y(vX~O!Y(aO~O#`$eO~PJUO!^(bO~P`OR#zO!Q#yO!S#{O!l#xO(aVOP!na[!naj!nar!na!]!na!p!na#R!na#n!na#o!na#p!na#q!na#r!na#s!na#t!na#u!na#v!na#x!na#z!na#{!na(r!na(y!na(z!na~Oa!na'z!na'w!na!Y!na!k!nav!na!_!na%i!na!g!na~PKlO!k(cO~O!g#vO#`(dO(r'pO!](tXa(tX'z(tX~O!k(tX~PNXO!S%hO!_%iO!|]O#i(iO#j(hO(T%gO~O!](jO!k(sX~O!k(lO~O!S%hO!_%iO#j(hO(T%gO~OP(gXR(gX[(gXj(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX~O!g#vO!k(gX~P! uOR(nO!Q(mO!l#xO#S$dO!|!{a!S!{a~O!x!{a%h!{a!_!{a#i!{a#j!{a(T!{a~P!#vO!x(rO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_XO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~O#k(xO~O![(zO!k(kP~P%[O(e(|O(o[O~O!S)OO!l#xO(e(|O(o[O~OP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_!eO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(T)]O(VTO(YUO(aVO(o[O~O!]$_Oa$qa'z$qa'w$qa!k$qa!Y$qa!_$qa%i$qa!g$qa~Ol)dO~P!&zOh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O%]O!S${O!_$|O!i%bO!l$xO#j%cO$W%`O$t%^O$v%_O$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~Og(pP~P!,TO!Q)iO!g)hO!_$^X$Z$^X$]$^X$_$^X$f$^X~O!g)hO!_({X$Z({X$]({X$_({X$f({X~O!Q)iO~P!.^O!Q)iO!_({X$Z({X$]({X$_({X$f({X~O!_)kO$Z)oO$])jO$_)jO$f)pO~O![)sO~P!)[O$]$hO$_$gO$f)wO~On$zX!Q$zX#S$zX'y$zX(y$zX(z$zX~OgmXg$zXnmX!]mX#`mX~P!0SOx)yO(b)zO(c)|O~On*VO!Q*OO'y*PO(y$}O(z%PO~Og)}O~P!1WOg*WO~Oh%VOr%XOs$tOt$tOz%YO|%ZO!O<sO!S*YO!_*ZO!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(VTO(YUO(a$uO(y$}O(z%PO~Op*`O![*^O(T*XO!k)OP~P!1uO#k*aO~O!l*bO~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(T*dO(VTO(YUO(a$uO(y$}O(z%PO~O![*gO!Y)PP~P!3tOr*sOs!nO!S*iO!b*qO!c*kO!d*kO!l*bO#[*rO%`*mO(U!lO(VTO(YUO(e!mO~O!^*pO~P!5iO#S$dOn(`X!Q(`X'y(`X(y(`X(z(`X!](`X#`(`X~Og(`X$O(`X~P!6kOn*xO#`*wOg(_X!](_X~O!]*yOg(^X~Oj%dOk%dOl%dO(T&ZOg(^P~Os*|O~Og)}O(T&ZO~O!l+SO~O(T(vO~Op+WO!S%hO![#iO!_%iO!|]O#i#lO#j#iO(T%gO!k(sP~O!g#vO#k+XO~O!S%hO![+ZO!](^O!_%iO(T%gO!Y(vP~Os'[O!S+]O![+[O(VTO(YUO(e(|O~O!^(xP~P!9|O!]+^Oa)TX'z)TX~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~Oa!ja!]!ja'z!ja'w!ja!Y!ja!k!jav!ja!_!ja%i!ja!g!ja~P!:tOR#zO!Q#yO!S#{O!l#xO(aVOP!ra[!raj!rar!ra!]!ra!p!ra#R!ra#n!ra#o!ra#p!ra#q!ra#r!ra#s!ra#t!ra#u!ra#v!ra#x!ra#z!ra#{!ra(r!ra(y!ra(z!ra~Oa!ra'z!ra'w!ra!Y!ra!k!rav!ra!_!ra%i!ra!g!ra~P!=[OR#zO!Q#yO!S#{O!l#xO(aVOP!ta[!taj!tar!ta!]!ta!p!ta#R!ta#n!ta#o!ta#p!ta#q!ta#r!ta#s!ta#t!ta#u!ta#v!ta#x!ta#z!ta#{!ta(r!ta(y!ta(z!ta~Oa!ta'z!ta'w!ta!Y!ta!k!tav!ta!_!ta%i!ta!g!ta~P!?rOh%VOn+gO!_'`O%i+fO~O!g+iOa(]X!_(]X'z(]X!](]X~Oa%nO!_XO'z%nO~Oh%VO!l%eO~Oh%VO!l%eO(T%gO~O!g#vO#k(xO~Ob+tO%j+uO(T+qO(VTO(YUO!^)XP~O!]+vO`)WX~O[+zO~O`+{O~O!_&PO(T%gO(U!lO`)WP~O%j,OO~P;SOh%VO#`,SO~Oh%VOn,VO!_$|O~O!_,XO~O!Q,ZO!_XO~O%n%vO~O!x,`O~Oe,eO~Ob,fO(T#nO(VTO(YUO!^)VP~Oe%}O~O%j!QO(T&ZO~P=gO[,kO`,jO~OPYOQYOSfOdzOeyOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!iuO!lZO!oYO!pYO!qYO!svO!xxO!|]O$niO%h}O(VTO(YUO(aVO(o[O~O!_!eO!u!gO$W!kO(T!dO~P!FyO`,jOa%nO'z%nO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oa,pOl!OO!uwO%l!OO%m!OO%n!OO~P!IcO!l&oO~O&^,vO~O!_,xO~O&o,zO&q,{OP&laQ&laS&laY&laa&lad&lae&lal&lap&lar&las&lat&laz&la|&la!O&la!S&la!W&la!X&la!_&la!i&la!l&la!o&la!p&la!q&la!s&la!u&la!x&la!|&la$W&la$n&la%h&la%j&la%l&la%m&la%n&la%q&la%s&la%v&la%w&la%y&la&W&la&^&la&`&la&b&la&d&la&g&la&m&la&s&la&u&la&w&la&y&la&{&la'w&la(T&la(V&la(Y&la(a&la(o&la!^&la&e&lab&la&j&la~O(T-QO~Oh!eX!]!RX!^!RX!g!RX!g!eX!l!eX#`!RX~O!]!eX!^!eX~P#!iO!g-VO#`-UOh(jX!]#hX!^#hX!g(jX!l(jX~O!](jX!^(jX~P##[Oh%VO!g-XO!l%eO!]!aX!^!aX~Os!nO!S!oO(VTO(YUO(e!mO~OP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_!eO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(VTO(YUO(aVO(o[O~O(T=QO~P#$qO!]-]O!^(iX~O!^-_O~O!g-VO#`-UO!]#hX!^#hX~O!]-`O!^(xX~O!^-bO~O!c-cO!d-cO(U!lO~P#$`O!^-fO~P'_On-iO!_'`O~O!Y-nO~Os!{a!b!{a!c!{a!d!{a#T!{a#U!{a#V!{a#W!{a#X!{a#[!{a#]!{a(U!{a(V!{a(Y!{a(e!{a(o!{a~P!#vO!p-sO#`-qO~PChO!c-uO!d-uO(U!lO~PDWOa%nO#`-qO'z%nO~Oa%nO!g#vO#`-qO'z%nO~Oa%nO!g#vO!p-sO#`-qO'z%nO(r'pO~O(P'xO(Q'xO(R-zO~Ov-{O~O!Y'Wa!]'Wa~P!:tO![.PO!Y'WX!]'WX~P%[O!](VO!Y(ha~O!Y(ha~PHRO!](^O!Y(va~O!S%hO![.TO!_%iO(T%gO!Y'^X!]'^X~O#`.VO!](ta!k(taa(ta'z(ta~O!g#vO~P#,wO!](jO!k(sa~O!S%hO!_%iO#j.ZO(T%gO~Op.`O!S%hO![.]O!_%iO!|]O#i._O#j.]O(T%gO!]'aX!k'aX~OR.dO!l#xO~Oh%VOn.gO!_'`O%i.fO~Oa#ci!]#ci'z#ci'w#ci!Y#ci!k#civ#ci!_#ci%i#ci!g#ci~P!:tOn>]O!Q*OO'y*PO(y$}O(z%PO~O#k#_aa#_a#`#_a'z#_a!]#_a!k#_a!_#_a!Y#_a~P#/sO#k(`XP(`XR(`X[(`Xa(`Xj(`Xr(`X!S(`X!l(`X!p(`X#R(`X#n(`X#o(`X#p(`X#q(`X#r(`X#s(`X#t(`X#u(`X#v(`X#x(`X#z(`X#{(`X'z(`X(a(`X(r(`X!k(`X!Y(`X'w(`Xv(`X!_(`X%i(`X!g(`X~P!6kO!].tO!k(kX~P!:tO!k.wO~O!Y.yO~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O(aVO[#mia#mij#mir#mi!]#mi#R#mi#o#mi#p#mi#q#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#n#mi~P#3cO#n$OO~P#3cOP$[OR#zOr$aO!Q#yO!S#{O!l#xO!p$[O#n$OO#o$PO#p$PO#q$PO(aVO[#mia#mij#mi!]#mi#R#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#r#mi~P#6QO#r$QO~P#6QOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO(aVOa#mi!]#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#v#mi~P#8oOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO(aVO(z#}Oa#mi!]#mi#z#mi#{#mi'z#mi(r#mi(y#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#x$UO~P#;VO#x#mi~P#;VO#v$SO~P#8oOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO(aVO(y#|O(z#}Oa#mi!]#mi#{#mi'z#mi(r#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#z#mi~P#={O#z$WO~P#={OP]XR]X[]Xj]Xr]X!Q]X!S]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X!]]X!^]X~O$O]X~P#@jOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO#x<eO#z<gO#{<hO(aVO(r$YO(y#|O(z#}O~O$O.{O~P#BwO#S$dO#`<nO$Q<nO$O(gX!^(gX~P! uOa'da!]'da'z'da'w'da!k'da!Y'dav'da!_'da%i'da!g'da~P!:tO[#mia#mij#mir#mi!]#mi#R#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O#n$OO#o$PO#p$PO#q$PO(aVO(y#mi(z#mi~P#EyOn>]O!Q*OO'y*PO(y$}O(z%POP#miR#mi!S#mi!l#mi!p#mi#n#mi#o#mi#p#mi#q#mi(a#mi~P#EyO!]/POg(pX~P!1WOg/RO~Oa$Pi!]$Pi'z$Pi'w$Pi!Y$Pi!k$Piv$Pi!_$Pi%i$Pi!g$Pi~P!:tO$]/SO$_/SO~O$]/TO$_/TO~O!g)hO#`/UO!_$cX$Z$cX$]$cX$_$cX$f$cX~O![/VO~O!_)kO$Z/XO$])jO$_)jO$f/YO~O!]<iO!^(fX~P#BwO!^/ZO~O!g)hO$f({X~O$f/]O~Ov/^O~P!&zOx)yO(b)zO(c/aO~O!S/dO~O(y$}On%aa!Q%aa'y%aa(z%aa!]%aa#`%aa~Og%aa$O%aa~P#L{O(z%POn%ca!Q%ca'y%ca(y%ca!]%ca#`%ca~Og%ca$O%ca~P#MnO!]fX!gfX!kfX!k$zX(rfX~P!0SOp%WO![/mO!](^O(T/lO!Y(vP!Y)PP~P!1uOr*sO!b*qO!c*kO!d*kO!l*bO#[*rO%`*mO(U!lO(VTO(YUO~Os<}O!S/nO![+[O!^*pO(e<|O!^(xP~P$ [O!k/oO~P#/sO!]/pO!g#vO(r'pO!k)OX~O!k/uO~OnoX!QoX'yoX(yoX(zoX~O!g#vO!koX~P$#OOp/wO!S%hO![*^O!_%iO(T%gO!k)OP~O#k/xO~O!Y$zX!]$zX!g%RX~P!0SO!]/yO!Y)PX~P#/sO!g/{O~O!Y/}O~OpkO(T0OO~P.iOh%VOr0TO!g#vO!l%eO(r'pO~O!g+iO~Oa%nO!]0XO'z%nO~O!^0ZO~P!5iO!c0[O!d0[O(U!lO~P#$`Os!nO!S0]O(VTO(YUO(e!mO~O#[0_O~Og%aa!]%aa#`%aa$O%aa~P!1WOg%ca!]%ca#`%ca$O%ca~P!1WOj%dOk%dOl%dO(T&ZOg'mX!]'mX~O!]*yOg(^a~Og0hO~On0jO#`0iOg(_a!](_a~OR0kO!Q0kO!S0lO#S$dOn}a'y}a(y}a(z}a!]}a#`}a~Og}a$O}a~P$(cO!Q*OO'y*POn$sa(y$sa(z$sa!]$sa#`$sa~Og$sa$O$sa~P$)_O!Q*OO'y*POn$ua(y$ua(z$ua!]$ua#`$ua~Og$ua$O$ua~P$*QO#k0oO~Og%Ta!]%Ta#`%Ta$O%Ta~P!1WO!g#vO~O#k0rO~O!]+^Oa)Ta'z)Ta~OR#zO!Q#yO!S#{O!l#xO(aVOP!ri[!rij!rir!ri!]!ri!p!ri#R!ri#n!ri#o!ri#p!ri#q!ri#r!ri#s!ri#t!ri#u!ri#v!ri#x!ri#z!ri#{!ri(r!ri(y!ri(z!ri~Oa!ri'z!ri'w!ri!Y!ri!k!riv!ri!_!ri%i!ri!g!ri~P$+oOh%VOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(VTO(YUO(a$uO(y$}O(z%PO~Op0{O%]0|O(T0zO~P$.VO!g+iOa(]a!_(]a'z(]a!](]a~O#k1SO~O[]X!]fX!^fX~O!]1TO!^)XX~O!^1VO~O[1WO~Ob1YO(T+qO(VTO(YUO~O!_&PO(T%gO`'uX!]'uX~O!]+vO`)Wa~O!k1]O~P!:tO[1`O~O`1aO~O#`1fO~On1iO!_$|O~O(e(|O!^)UP~Oh%VOn1rO!_1oO%i1qO~O[1|O!]1zO!^)VX~O!^1}O~O`2POa%nO'z%nO~O(T#nO(VTO(YUO~O#S$dO#`$eO$Q$eOP(gXR(gX[(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX~Oj2SO&[2TOa(gX~P$3pOj2SO#`$eO&[2TO~Oa2VO~P%[Oa2XO~O&e2[OP&ciQ&ciS&ciY&cia&cid&cie&cil&cip&cir&cis&cit&ciz&ci|&ci!O&ci!S&ci!W&ci!X&ci!_&ci!i&ci!l&ci!o&ci!p&ci!q&ci!s&ci!u&ci!x&ci!|&ci$W&ci$n&ci%h&ci%j&ci%l&ci%m&ci%n&ci%q&ci%s&ci%v&ci%w&ci%y&ci&W&ci&^&ci&`&ci&b&ci&d&ci&g&ci&m&ci&s&ci&u&ci&w&ci&y&ci&{&ci'w&ci(T&ci(V&ci(Y&ci(a&ci(o&ci!^&cib&ci&j&ci~Ob2bO!^2`O&j2aO~P`O!_XO!l2dO~O&q,{OP&liQ&liS&liY&lia&lid&lie&lil&lip&lir&lis&lit&liz&li|&li!O&li!S&li!W&li!X&li!_&li!i&li!l&li!o&li!p&li!q&li!s&li!u&li!x&li!|&li$W&li$n&li%h&li%j&li%l&li%m&li%n&li%q&li%s&li%v&li%w&li%y&li&W&li&^&li&`&li&b&li&d&li&g&li&m&li&s&li&u&li&w&li&y&li&{&li'w&li(T&li(V&li(Y&li(a&li(o&li!^&li&e&lib&li&j&li~O!Y2jO~O!]!aa!^!aa~P#BwOs!nO!S!oO![2pO(e!mO!]'XX!^'XX~P@nO!]-]O!^(ia~O!]'_X!^'_X~P!9|O!]-`O!^(xa~O!^2wO~P'_Oa%nO#`3QO'z%nO~Oa%nO!g#vO#`3QO'z%nO~Oa%nO!g#vO!p3UO#`3QO'z%nO(r'pO~Oa%nO'z%nO~P!:tO!]$_Ov$qa~O!Y'Wi!]'Wi~P!:tO!](VO!Y(hi~O!](^O!Y(vi~O!Y(wi!](wi~P!:tO!](ti!k(tia(ti'z(ti~P!:tO#`3WO!](ti!k(tia(ti'z(ti~O!](jO!k(si~O!S%hO!_%iO!|]O#i3]O#j3[O(T%gO~O!S%hO!_%iO#j3[O(T%gO~On3dO!_'`O%i3cO~Oh%VOn3dO!_'`O%i3cO~O#k%aaP%aaR%aa[%aaa%aaj%aar%aa!S%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa'z%aa(a%aa(r%aa!k%aa!Y%aa'w%aav%aa!_%aa%i%aa!g%aa~P#L{O#k%caP%caR%ca[%caa%caj%car%ca!S%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca'z%ca(a%ca(r%ca!k%ca!Y%ca'w%cav%ca!_%ca%i%ca!g%ca~P#MnO#k%aaP%aaR%aa[%aaa%aaj%aar%aa!S%aa!]%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa'z%aa(a%aa(r%aa!k%aa!Y%aa'w%aa#`%aav%aa!_%aa%i%aa!g%aa~P#/sO#k%caP%caR%ca[%caa%caj%car%ca!S%ca!]%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca'z%ca(a%ca(r%ca!k%ca!Y%ca'w%ca#`%cav%ca!_%ca%i%ca!g%ca~P#/sO#k}aP}a[}aa}aj}ar}a!l}a!p}a#R}a#n}a#o}a#p}a#q}a#r}a#s}a#t}a#u}a#v}a#x}a#z}a#{}a'z}a(a}a(r}a!k}a!Y}a'w}av}a!_}a%i}a!g}a~P$(cO#k$saP$saR$sa[$saa$saj$sar$sa!S$sa!l$sa!p$sa#R$sa#n$sa#o$sa#p$sa#q$sa#r$sa#s$sa#t$sa#u$sa#v$sa#x$sa#z$sa#{$sa'z$sa(a$sa(r$sa!k$sa!Y$sa'w$sav$sa!_$sa%i$sa!g$sa~P$)_O#k$uaP$uaR$ua[$uaa$uaj$uar$ua!S$ua!l$ua!p$ua#R$ua#n$ua#o$ua#p$ua#q$ua#r$ua#s$ua#t$ua#u$ua#v$ua#x$ua#z$ua#{$ua'z$ua(a$ua(r$ua!k$ua!Y$ua'w$uav$ua!_$ua%i$ua!g$ua~P$*QO#k%TaP%TaR%Ta[%Taa%Taj%Tar%Ta!S%Ta!]%Ta!l%Ta!p%Ta#R%Ta#n%Ta#o%Ta#p%Ta#q%Ta#r%Ta#s%Ta#t%Ta#u%Ta#v%Ta#x%Ta#z%Ta#{%Ta'z%Ta(a%Ta(r%Ta!k%Ta!Y%Ta'w%Ta#`%Tav%Ta!_%Ta%i%Ta!g%Ta~P#/sOa#cq!]#cq'z#cq'w#cq!Y#cq!k#cqv#cq!_#cq%i#cq!g#cq~P!:tO![3lO!]'YX!k'YX~P%[O!].tO!k(ka~O!].tO!k(ka~P!:tO!Y3oO~O$O!na!^!na~PKlO$O!ja!]!ja!^!ja~P#BwO$O!ra!^!ra~P!=[O$O!ta!^!ta~P!?rOg']X!]']X~P!,TO!]/POg(pa~OSfO!_4TO$d4UO~O!^4YO~Ov4ZO~P#/sOa$mq!]$mq'z$mq'w$mq!Y$mq!k$mqv$mq!_$mq%i$mq!g$mq~P!:tO!Y4]O~P!&zO!S4^O~O!Q*OO'y*PO(z%POn'ia(y'ia!]'ia#`'ia~Og'ia$O'ia~P%-fO!Q*OO'y*POn'ka(y'ka(z'ka!]'ka#`'ka~Og'ka$O'ka~P%.XO(r$YO~P#/sO!YfX!Y$zX!]fX!]$zX!g%RX#`fX~P!0SOp%WO(T=WO~P!1uOp4bO!S%hO![4aO!_%iO(T%gO!]'eX!k'eX~O!]/pO!k)Oa~O!]/pO!g#vO!k)Oa~O!]/pO!g#vO(r'pO!k)Oa~Og$|i!]$|i#`$|i$O$|i~P!1WO![4jO!Y'gX!]'gX~P!3tO!]/yO!Y)Pa~O!]/yO!Y)Pa~P#/sOP]XR]X[]Xj]Xr]X!Q]X!S]X!Y]X!]]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X~Oj%YX!g%YX~P%2OOj4oO!g#vO~Oh%VO!g#vO!l%eO~Oh%VOr4tO!l%eO(r'pO~Or4yO!g#vO(r'pO~Os!nO!S4zO(VTO(YUO(e!mO~O(y$}On%ai!Q%ai'y%ai(z%ai!]%ai#`%ai~Og%ai$O%ai~P%5oO(z%POn%ci!Q%ci'y%ci(y%ci!]%ci#`%ci~Og%ci$O%ci~P%6bOg(_i!](_i~P!1WO#`5QOg(_i!](_i~P!1WO!k5VO~Oa$oq!]$oq'z$oq'w$oq!Y$oq!k$oqv$oq!_$oq%i$oq!g$oq~P!:tO!Y5ZO~O!]5[O!_)QX~P#/sOa$zX!_$zX%^]X'z$zX!]$zX~P!0SO%^5_OaoX!_oX'zoX!]oX~P$#OOp5`O(T#nO~O%^5_O~Ob5fO%j5gO(T+qO(VTO(YUO!]'tX!^'tX~O!]1TO!^)Xa~O[5kO~O`5lO~O[5pO~Oa%nO'z%nO~P#/sO!]5uO#`5wO!^)UX~O!^5xO~Or6OOs!nO!S*iO!b!yO!c!vO!d!vO!|<VO#T!pO#U!pO#V!pO#W!pO#X!pO#[5}O#]!zO(U!lO(VTO(YUO(e!mO(o!sO~O!^5|O~P%;eOn6TO!_1oO%i6SO~Oh%VOn6TO!_1oO%i6SO~Ob6[O(T#nO(VTO(YUO!]'sX!^'sX~O!]1zO!^)Va~O(VTO(YUO(e6^O~O`6bO~Oj6eO&[6fO~PNXO!k6gO~P%[Oa6iO~Oa6iO~P%[Ob2bO!^6nO&j2aO~P`O!g6pO~O!g6rOh(ji!](ji!^(ji!g(ji!l(jir(ji(r(ji~O!]#hi!^#hi~P#BwO#`6sO!]#hi!^#hi~O!]!ai!^!ai~P#BwOa%nO#`6|O'z%nO~Oa%nO!g#vO#`6|O'z%nO~O!](tq!k(tqa(tq'z(tq~P!:tO!](jO!k(sq~O!S%hO!_%iO#j7TO(T%gO~O!_'`O%i7WO~On7[O!_'`O%i7WO~O#k'iaP'iaR'ia['iaa'iaj'iar'ia!S'ia!l'ia!p'ia#R'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#v'ia#x'ia#z'ia#{'ia'z'ia(a'ia(r'ia!k'ia!Y'ia'w'iav'ia!_'ia%i'ia!g'ia~P%-fO#k'kaP'kaR'ka['kaa'kaj'kar'ka!S'ka!l'ka!p'ka#R'ka#n'ka#o'ka#p'ka#q'ka#r'ka#s'ka#t'ka#u'ka#v'ka#x'ka#z'ka#{'ka'z'ka(a'ka(r'ka!k'ka!Y'ka'w'kav'ka!_'ka%i'ka!g'ka~P%.XO#k$|iP$|iR$|i[$|ia$|ij$|ir$|i!S$|i!]$|i!l$|i!p$|i#R$|i#n$|i#o$|i#p$|i#q$|i#r$|i#s$|i#t$|i#u$|i#v$|i#x$|i#z$|i#{$|i'z$|i(a$|i(r$|i!k$|i!Y$|i'w$|i#`$|iv$|i!_$|i%i$|i!g$|i~P#/sO#k%aiP%aiR%ai[%aia%aij%air%ai!S%ai!l%ai!p%ai#R%ai#n%ai#o%ai#p%ai#q%ai#r%ai#s%ai#t%ai#u%ai#v%ai#x%ai#z%ai#{%ai'z%ai(a%ai(r%ai!k%ai!Y%ai'w%aiv%ai!_%ai%i%ai!g%ai~P%5oO#k%ciP%ciR%ci[%cia%cij%cir%ci!S%ci!l%ci!p%ci#R%ci#n%ci#o%ci#p%ci#q%ci#r%ci#s%ci#t%ci#u%ci#v%ci#x%ci#z%ci#{%ci'z%ci(a%ci(r%ci!k%ci!Y%ci'w%civ%ci!_%ci%i%ci!g%ci~P%6bO!]'Ya!k'Ya~P!:tO!].tO!k(ki~O$O#ci!]#ci!^#ci~P#BwOP$[OR#zO!Q#yO!S#{O!l#xO!p$[O(aVO[#mij#mir#mi#R#mi#o#mi#p#mi#q#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#n#mi~P%NdO#n<_O~P%NdOP$[OR#zOr<kO!Q#yO!S#{O!l#xO!p$[O#n<_O#o<`O#p<`O#q<`O(aVO[#mij#mi#R#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#r#mi~P&!lO#r<aO~P&!lOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO(aVO#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#v#mi~P&$tOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO(aVO(z#}O#z#mi#{#mi$O#mi(r#mi(y#mi!]#mi!^#mi~O#x<eO~P&&uO#x#mi~P&&uO#v<cO~P&$tOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO#x<eO(aVO(y#|O(z#}O#{#mi$O#mi(r#mi!]#mi!^#mi~O#z#mi~P&)UO#z<gO~P&)UOa#|y!]#|y'z#|y'w#|y!Y#|y!k#|yv#|y!_#|y%i#|y!g#|y~P!:tO[#mij#mir#mi#R#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi!]#mi!^#mi~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O#n<_O#o<`O#p<`O#q<`O(aVO(y#mi(z#mi~P&,QOn>^O!Q*OO'y*PO(y$}O(z%POP#miR#mi!S#mi!l#mi!p#mi#n#mi#o#mi#p#mi#q#mi(a#mi~P&,QO#S$dOP(`XR(`X[(`Xj(`Xn(`Xr(`X!Q(`X!S(`X!l(`X!p(`X#R(`X#n(`X#o(`X#p(`X#q(`X#r(`X#s(`X#t(`X#u(`X#v(`X#x(`X#z(`X#{(`X$O(`X'y(`X(a(`X(r(`X(y(`X(z(`X!](`X!^(`X~O$O$Pi!]$Pi!^$Pi~P#BwO$O!ri!^!ri~P$+oOg']a!]']a~P!1WO!^7nO~O!]'da!^'da~P#BwO!Y7oO~P#/sO!g#vO(r'pO!]'ea!k'ea~O!]/pO!k)Oi~O!]/pO!g#vO!k)Oi~Og$|q!]$|q#`$|q$O$|q~P!1WO!Y'ga!]'ga~P#/sO!g7vO~O!]/yO!Y)Pi~P#/sO!]/yO!Y)Pi~O!Y7yO~Oh%VOr8OO!l%eO(r'pO~Oj8QO!g#vO~Or8TO!g#vO(r'pO~O!Q*OO'y*PO(z%POn'ja(y'ja!]'ja#`'ja~Og'ja$O'ja~P&5RO!Q*OO'y*POn'la(y'la(z'la!]'la#`'la~Og'la$O'la~P&5tOg(_q!](_q~P!1WO#`8VOg(_q!](_q~P!1WO!Y8WO~Og%Oq!]%Oq#`%Oq$O%Oq~P!1WOa$oy!]$oy'z$oy'w$oy!Y$oy!k$oyv$oy!_$oy%i$oy!g$oy~P!:tO!g6rO~O!]5[O!_)Qa~O!_'`OP$TaR$Ta[$Taj$Tar$Ta!Q$Ta!S$Ta!]$Ta!l$Ta!p$Ta#R$Ta#n$Ta#o$Ta#p$Ta#q$Ta#r$Ta#s$Ta#t$Ta#u$Ta#v$Ta#x$Ta#z$Ta#{$Ta(a$Ta(r$Ta(y$Ta(z$Ta~O%i7WO~P&8fO%^8[Oa%[i!_%[i'z%[i!]%[i~Oa#cy!]#cy'z#cy'w#cy!Y#cy!k#cyv#cy!_#cy%i#cy!g#cy~P!:tO[8^O~Ob8`O(T+qO(VTO(YUO~O!]1TO!^)Xi~O`8dO~O(e(|O!]'pX!^'pX~O!]5uO!^)Ua~O!^8nO~P%;eO(o!sO~P$&YO#[8oO~O!_1oO~O!_1oO%i8qO~On8tO!_1oO%i8qO~O[8yO!]'sa!^'sa~O!]1zO!^)Vi~O!k8}O~O!k9OO~O!k9RO~O!k9RO~P%[Oa9TO~O!g9UO~O!k9VO~O!](wi!^(wi~P#BwOa%nO#`9_O'z%nO~O!](ty!k(tya(ty'z(ty~P!:tO!](jO!k(sy~O%i9bO~P&8fO!_'`O%i9bO~O#k$|qP$|qR$|q[$|qa$|qj$|qr$|q!S$|q!]$|q!l$|q!p$|q#R$|q#n$|q#o$|q#p$|q#q$|q#r$|q#s$|q#t$|q#u$|q#v$|q#x$|q#z$|q#{$|q'z$|q(a$|q(r$|q!k$|q!Y$|q'w$|q#`$|qv$|q!_$|q%i$|q!g$|q~P#/sO#k'jaP'jaR'ja['jaa'jaj'jar'ja!S'ja!l'ja!p'ja#R'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#v'ja#x'ja#z'ja#{'ja'z'ja(a'ja(r'ja!k'ja!Y'ja'w'jav'ja!_'ja%i'ja!g'ja~P&5RO#k'laP'laR'la['laa'laj'lar'la!S'la!l'la!p'la#R'la#n'la#o'la#p'la#q'la#r'la#s'la#t'la#u'la#v'la#x'la#z'la#{'la'z'la(a'la(r'la!k'la!Y'la'w'lav'la!_'la%i'la!g'la~P&5tO#k%OqP%OqR%Oq[%Oqa%Oqj%Oqr%Oq!S%Oq!]%Oq!l%Oq!p%Oq#R%Oq#n%Oq#o%Oq#p%Oq#q%Oq#r%Oq#s%Oq#t%Oq#u%Oq#v%Oq#x%Oq#z%Oq#{%Oq'z%Oq(a%Oq(r%Oq!k%Oq!Y%Oq'w%Oq#`%Oqv%Oq!_%Oq%i%Oq!g%Oq~P#/sO!]'Yi!k'Yi~P!:tO$O#cq!]#cq!^#cq~P#BwO(y$}OP%aaR%aa[%aaj%aar%aa!S%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa$O%aa(a%aa(r%aa!]%aa!^%aa~On%aa!Q%aa'y%aa(z%aa~P&IyO(z%POP%caR%ca[%caj%car%ca!S%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca$O%ca(a%ca(r%ca!]%ca!^%ca~On%ca!Q%ca'y%ca(y%ca~P&LQOn>^O!Q*OO'y*PO(z%PO~P&IyOn>^O!Q*OO'y*PO(y$}O~P&LQOR0kO!Q0kO!S0lO#S$dOP}a[}aj}an}ar}a!l}a!p}a#R}a#n}a#o}a#p}a#q}a#r}a#s}a#t}a#u}a#v}a#x}a#z}a#{}a$O}a'y}a(a}a(r}a(y}a(z}a!]}a!^}a~O!Q*OO'y*POP$saR$sa[$saj$san$sar$sa!S$sa!l$sa!p$sa#R$sa#n$sa#o$sa#p$sa#q$sa#r$sa#s$sa#t$sa#u$sa#v$sa#x$sa#z$sa#{$sa$O$sa(a$sa(r$sa(y$sa(z$sa!]$sa!^$sa~O!Q*OO'y*POP$uaR$ua[$uaj$uan$uar$ua!S$ua!l$ua!p$ua#R$ua#n$ua#o$ua#p$ua#q$ua#r$ua#s$ua#t$ua#u$ua#v$ua#x$ua#z$ua#{$ua$O$ua(a$ua(r$ua(y$ua(z$ua!]$ua!^$ua~On>^O!Q*OO'y*PO(y$}O(z%PO~OP%TaR%Ta[%Taj%Tar%Ta!S%Ta!l%Ta!p%Ta#R%Ta#n%Ta#o%Ta#p%Ta#q%Ta#r%Ta#s%Ta#t%Ta#u%Ta#v%Ta#x%Ta#z%Ta#{%Ta$O%Ta(a%Ta(r%Ta!]%Ta!^%Ta~P''VO$O$mq!]$mq!^$mq~P#BwO$O$oq!]$oq!^$oq~P#BwO!^9oO~O$O9pO~P!1WO!g#vO!]'ei!k'ei~O!g#vO(r'pO!]'ei!k'ei~O!]/pO!k)Oq~O!Y'gi!]'gi~P#/sO!]/yO!Y)Pq~Or9wO!g#vO(r'pO~O[9yO!Y9xO~P#/sO!Y9xO~Oj:PO!g#vO~Og(_y!](_y~P!1WO!]'na!_'na~P#/sOa%[q!_%[q'z%[q!]%[q~P#/sO[:UO~O!]1TO!^)Xq~O`:YO~O#`:ZO!]'pa!^'pa~O!]5uO!^)Ui~P#BwO!S:]O~O!_1oO%i:`O~O(VTO(YUO(e:eO~O!]1zO!^)Vq~O!k:hO~O!k:iO~O!k:jO~O!k:jO~P%[O#`:mO!]#hy!^#hy~O!]#hy!^#hy~P#BwO%i:rO~P&8fO!_'`O%i:rO~O$O#|y!]#|y!^#|y~P#BwOP$|iR$|i[$|ij$|ir$|i!S$|i!l$|i!p$|i#R$|i#n$|i#o$|i#p$|i#q$|i#r$|i#s$|i#t$|i#u$|i#v$|i#x$|i#z$|i#{$|i$O$|i(a$|i(r$|i!]$|i!^$|i~P''VO!Q*OO'y*PO(z%POP'iaR'ia['iaj'ian'iar'ia!S'ia!l'ia!p'ia#R'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#v'ia#x'ia#z'ia#{'ia$O'ia(a'ia(r'ia(y'ia!]'ia!^'ia~O!Q*OO'y*POP'kaR'ka['kaj'kan'kar'ka!S'ka!l'ka!p'ka#R'ka#n'ka#o'ka#p'ka#q'ka#r'ka#s'ka#t'ka#u'ka#v'ka#x'ka#z'ka#{'ka$O'ka(a'ka(r'ka(y'ka(z'ka!]'ka!^'ka~O(y$}OP%aiR%ai[%aij%ain%air%ai!Q%ai!S%ai!l%ai!p%ai#R%ai#n%ai#o%ai#p%ai#q%ai#r%ai#s%ai#t%ai#u%ai#v%ai#x%ai#z%ai#{%ai$O%ai'y%ai(a%ai(r%ai(z%ai!]%ai!^%ai~O(z%POP%ciR%ci[%cij%cin%cir%ci!Q%ci!S%ci!l%ci!p%ci#R%ci#n%ci#o%ci#p%ci#q%ci#r%ci#s%ci#t%ci#u%ci#v%ci#x%ci#z%ci#{%ci$O%ci'y%ci(a%ci(r%ci(y%ci!]%ci!^%ci~O$O$oy!]$oy!^$oy~P#BwO$O#cy!]#cy!^#cy~P#BwO!g#vO!]'eq!k'eq~O!]/pO!k)Oy~O!Y'gq!]'gq~P#/sOr:|O!g#vO(r'pO~O[;QO!Y;PO~P#/sO!Y;PO~Og(_!R!](_!R~P!1WOa%[y!_%[y'z%[y!]%[y~P#/sO!]1TO!^)Xy~O!]5uO!^)Uq~O(T;XO~O!_1oO%i;[O~O!k;_O~O%i;dO~P&8fOP$|qR$|q[$|qj$|qr$|q!S$|q!l$|q!p$|q#R$|q#n$|q#o$|q#p$|q#q$|q#r$|q#s$|q#t$|q#u$|q#v$|q#x$|q#z$|q#{$|q$O$|q(a$|q(r$|q!]$|q!^$|q~P''VO!Q*OO'y*PO(z%POP'jaR'ja['jaj'jan'jar'ja!S'ja!l'ja!p'ja#R'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#v'ja#x'ja#z'ja#{'ja$O'ja(a'ja(r'ja(y'ja!]'ja!^'ja~O!Q*OO'y*POP'laR'la['laj'lan'lar'la!S'la!l'la!p'la#R'la#n'la#o'la#p'la#q'la#r'la#s'la#t'la#u'la#v'la#x'la#z'la#{'la$O'la(a'la(r'la(y'la(z'la!]'la!^'la~OP%OqR%Oq[%Oqj%Oqr%Oq!S%Oq!l%Oq!p%Oq#R%Oq#n%Oq#o%Oq#p%Oq#q%Oq#r%Oq#s%Oq#t%Oq#u%Oq#v%Oq#x%Oq#z%Oq#{%Oq$O%Oq(a%Oq(r%Oq!]%Oq!^%Oq~P''VOg%e!Z!]%e!Z#`%e!Z$O%e!Z~P!1WO!Y;hO~P#/sOr;iO!g#vO(r'pO~O[;kO!Y;hO~P#/sO!]'pq!^'pq~P#BwO!]#h!Z!^#h!Z~P#BwO#k%e!ZP%e!ZR%e!Z[%e!Za%e!Zj%e!Zr%e!Z!S%e!Z!]%e!Z!l%e!Z!p%e!Z#R%e!Z#n%e!Z#o%e!Z#p%e!Z#q%e!Z#r%e!Z#s%e!Z#t%e!Z#u%e!Z#v%e!Z#x%e!Z#z%e!Z#{%e!Z'z%e!Z(a%e!Z(r%e!Z!k%e!Z!Y%e!Z'w%e!Z#`%e!Zv%e!Z!_%e!Z%i%e!Z!g%e!Z~P#/sOr;tO!g#vO(r'pO~O!Y;uO~P#/sOr;|O!g#vO(r'pO~O!Y;}O~P#/sOP%e!ZR%e!Z[%e!Zj%e!Zr%e!Z!S%e!Z!l%e!Z!p%e!Z#R%e!Z#n%e!Z#o%e!Z#p%e!Z#q%e!Z#r%e!Z#s%e!Z#t%e!Z#u%e!Z#v%e!Z#x%e!Z#z%e!Z#{%e!Z$O%e!Z(a%e!Z(r%e!Z!]%e!Z!^%e!Z~P''VOr<QO!g#vO(r'pO~Ov(fX~P1qO!Q%rO~P!)[O(U!lO~P!)[O!YfX!]fX#`fX~P%2OOP]XR]X[]Xj]Xr]X!Q]X!S]X!]]X!]fX!l]X!p]X#R]X#S]X#`]X#`fX#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X~O!gfX!k]X!kfX(rfX~P'LTOP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_XO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(T)]O(VTO(YUO(aVO(o[O~O!]<iO!^$qa~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<tO!S${O!_$|O!i>WO!l$xO#j<zO$W%`O$t<vO$v<xO$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~Ol)dO~P(!yOr!eX(r!eX~P#!iOr(jX(r(jX~P##[O!^]X!^fX~P'LTO!YfX!Y$zX!]fX!]$zX#`fX~P!0SO#k<^O~O!g#vO#k<^O~O#`<nO~Oj<bO~O#`=OO!](wX!^(wX~O#`<nO!](uX!^(uX~O#k=PO~Og=RO~P!1WO#k=XO~O#k=YO~Og=RO(T&ZO~O!g#vO#k=ZO~O!g#vO#k=PO~O$O=[O~P#BwO#k=]O~O#k=^O~O#k=cO~O#k=dO~O#k=eO~O#k=fO~O$O=gO~P!1WO$O=hO~P!1WOl=sO~P7eOk#S#T#U#W#X#[#i#j#u$n$t$v$y%]%^%h%i%j%q%s%v%w%y%{~(OT#o!X'|(U#ps#n#qr!Q'}$]'}(T$_(e~",goto:"$9Y)]PPPPPP)^PP)aP)rP+W/]PPPP6mPP7TPP=QPPP@tPA^PA^PPPA^PCfPA^PA^PA^PCjPCoPD^PIWPPPI[PPPPI[L_PPPLeMVPI[PI[PP! eI[PPPI[PI[P!#lI[P!'S!(X!(bP!)U!)Y!)U!,gPPPPPPP!-W!(XPP!-h!/YP!2iI[I[!2n!5z!:h!:h!>gPPP!>oI[PPPPPPPPP!BOP!C]PPI[!DnPI[PI[I[I[I[I[PI[!FQP!I[P!LbP!Lf!Lp!Lt!LtP!IXP!Lx!LxP#!OP#!SI[PI[#!Y#%_CjA^PA^PA^A^P#&lA^A^#)OA^#+vA^#.SA^A^#.r#1W#1W#1]#1f#1W#1qPP#1WPA^#2ZA^#6YA^A^6mPPP#:_PPP#:x#:xP#:xP#;`#:xPP#;fP#;]P#;]#;y#;]#<e#<k#<n)aP#<q)aP#<z#<z#<zP)aP)aP)aP)aPP)aP#=Q#=TP#=T)aP#=XP#=[P)aP)aP)aP)aP)aP)a)aPP#=b#=h#=s#=y#>P#>V#>]#>k#>q#>{#?R#?]#?c#?s#?y#@k#@}#AT#AZ#Ai#BO#Cs#DR#DY#Et#FS#Gt#HS#HY#H`#Hf#Hp#Hv#H|#IW#Ij#IpPPPPPPPPPPP#IvPPPPPPP#Jk#Mx$ b$ i$ qPPP$']P$'f$*_$0x$0{$1O$1}$2Q$2X$2aP$2g$2jP$3W$3[$4S$5b$5g$5}PP$6S$6Y$6^$6a$6e$6i$7e$7|$8e$8i$8l$8o$8y$8|$9Q$9UR!|RoqOXst!Z#d%m&r&t&u&w,s,x2[2_Y!vQ'`-e1o5{Q%tvQ%|yQ&T|Q&j!VS'W!e-]Q'f!iS'l!r!yU*k$|*Z*oQ+o%}S+|&V&WQ,d&dQ-c'_Q-m'gQ-u'mQ0[*qQ1b,OQ1y,eR<{<Y%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+],p,s,x-i-q.P.V.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3l4z6T6e6f6i6|8t9T9_S#q]<V!r)_$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SU+P%]<s<tQ+t&PQ,f&gQ,m&oQ0x+gQ0}+iQ1Y+uQ2R,kQ3`.gQ5`0|Q5f1TQ6[1zQ7Y3dQ8`5gR9e7['QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S!S!nQ!r!v!y!z$|'W'_'`'l'm'n*k*o*q*r-]-c-e-u0[0_1o5{5}%[$ti#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^Q&X|Q'U!eS'[%i-`Q+t&PQ,P&WQ,f&gQ0n+SQ1Y+uQ1_+{Q2Q,jQ2R,kQ5f1TQ5o1aQ6[1zQ6_1|Q6`2PQ8`5gQ8c5lQ8|6bQ:X8dQ:f8yQ;V:YR<}*ZrnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_R,h&k&z^OPXYstuvwz!Z!`!g!j!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'b'r(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>R>S[#]WZ#W#Z'X(T!b%jm#h#i#l$x%e%h(^(h(i(j*Y*^*b+Z+[+^,o-V.T.Z.[.]._/m/p2d3[3]4a6r7TQ%wxQ%{yW&Q|&V&W,OQ&_!TQ'c!hQ'e!iQ(q#sS+n%|%}Q+r&PQ,_&bQ,c&dS-l'f'gQ.i(rQ1R+oQ1X+uQ1Z+vQ1^+zQ1t,`S1x,d,eQ2|-mQ5e1TQ5i1WQ5n1`Q6Z1yQ8_5gQ8b5kQ8f5pQ:T8^R;T:U!U$zi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y!^%yy!i!u%{%|%}'V'e'f'g'k'u*j+n+o-Y-l-m-t0R0U1R2u2|3T4r4s4v7}9{Q+h%wQ,T&[Q,W&]Q,b&dQ.h(qQ1s,_U1w,c,d,eQ3e.iQ6U1tS6Y1x1yQ8x6Z#f>T#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^o>U<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hW%Ti%V*y>PS&[!Q&iQ&]!RQ&^!SU*}%[%d=sR,R&Y%]%Si#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^T)z$u){V+P%]<s<tW'[!e%i*Z-`S(}#y#zQ+c%rQ+y&SS.b(m(nQ1j,XQ5T0kR8i5u'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S$i$^c#Y#e%q%s%u(S(Y(t(y)R)S)T)U)V)W)X)Y)Z)[)^)`)b)g)q+d+x-Z-x-}.S.U.s.v.z.|.}/O/b0p2k2n3O3V3k3p3q3r3s3t3u3v3w3x3y3z3{3|4P4Q4X5X5c6u6{7Q7a7b7k7l8k9X9]9g9m9n:o;W;`<W=vT#TV#U'RkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ'Y!eR2q-]!W!nQ!e!r!v!y!z$|'W'_'`'l'm'n*Z*k*o*q*r-]-c-e-u0[0_1o5{5}R1l,ZnqOXst!Z#d%m&r&t&u&w,s,x2[2_Q&y!^Q'v!xS(s#u<^Q+l%zQ,]&_Q,^&aQ-j'dQ-w'oS.r(x=PS0q+X=ZQ1P+mQ1n,[Q2c,zQ2e,{Q2m-WQ2z-kQ2}-oS5Y0r=eQ5a1QS5d1S=fQ6t2oQ6x2{Q6}3SQ8]5bQ9Y6vQ9Z6yQ9^7OR:l9V$d$]c#Y#e%s%u(S(Y(t(y)R)S)T)U)V)W)X)Y)Z)[)^)`)b)g)q+d+x-Z-x-}.S.U.s.v.z.}/O/b0p2k2n3O3V3k3p3q3r3s3t3u3v3w3x3y3z3{3|4P4Q4X5X5c6u6{7Q7a7b7k7l8k9X9]9g9m9n:o;W;`<W=vS(o#p'iQ)P#zS+b%q.|S.c(n(pR3^.d'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SS#q]<VQ&t!XQ&u!YQ&w![Q&x!]R2Z,vQ'a!hQ+e%wQ-h'cS.e(q+hQ2x-gW3b.h.i0w0yQ6w2yW7U3_3a3e5^U9a7V7X7ZU:q9c9d9fS;b:p:sQ;p;cR;x;qU!wQ'`-eT5y1o5{!Q_OXZ`st!V!Z#d#h%e%m&i&k&r&t&u&w(j,s,x.[2[2_]!pQ!r'`-e1o5{T#q]<V%^{OPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_S(}#y#zS.b(m(n!s=l$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SU$fd)_,mS(p#p'iU*v%R(w4OU0m+O.n7gQ5^0xQ7V3`Q9d7YR:s9em!tQ!r!v!y!z'`'l'm'n-e-u1o5{5}Q't!uS(f#g2US-s'k'wQ/s*]Q0R*jQ3U-vQ4f/tQ4r0TQ4s0UQ4x0^Q7r4`S7}4t4vS8R4y4{Q9r7sQ9v7yQ9{8OQ:Q8TS:{9w9xS;g:|;PS;s;h;iS;{;t;uS<P;|;}R<S<QQ#wbQ's!uS(e#g2US(g#m+WQ+Y%fQ+j%xQ+p&OU-r'k't'wQ.W(fU/r*]*`/wQ0S*jQ0V*lQ1O+kQ1u,aS3R-s-vQ3Z.`S4e/s/tQ4n0PS4q0R0^Q4u0WQ6W1vQ7P3US7q4`4bQ7u4fU7|4r4x4{Q8P4wQ8v6XS9q7r7sQ9u7yQ9}8RQ:O8SQ:c8wQ:y9rS:z9v9xQ;S:QQ;^:dS;f:{;PS;r;g;hS;z;s;uS<O;{;}Q<R<PQ<T<SQ=o=jQ={=tR=|=uV!wQ'`-e%^aOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_S#wz!j!r=i$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SR=o>R%^bOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_Q%fj!^%xy!i!u%{%|%}'V'e'f'g'k'u*j+n+o-Y-l-m-t0R0U1R2u2|3T4r4s4v7}9{S&Oz!jQ+k%yQ,a&dW1v,b,c,d,eU6X1w1x1yS8w6Y6ZQ:d8x!r=j$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ=t>QR=u>R%QeOPXYstuvw!Z!`!g!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_Y#bWZ#W#Z(T!b%jm#h#i#l$x%e%h(^(h(i(j*Y*^*b+Z+[+^,o-V.T.Z.[.]._/m/p2d3[3]4a6r7TQ,n&o!p=k$Z$n)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SR=n'XU']!e%i*ZR2s-`%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+],p,s,x-i-q.P.V.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3l4z6T6e6f6i6|8t9T9_!r)_$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ,m&oQ0x+gQ3`.gQ7Y3dR9e7[!b$Tc#Y%q(S(Y(t(y)Z)[)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<W!P<d)^)q-Z.|2k2n3p3y3z4P4X6u7b7k7l8k9X9g9m9n;W;`=v!f$Vc#Y%q(S(Y(t(y)W)X)Z)[)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<W!T<f)^)q-Z.|2k2n3p3v3w3y3z4P4X6u7b7k7l8k9X9g9m9n;W;`=v!^$Zc#Y%q(S(Y(t(y)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<WQ4_/kz>S)^)q-Z.|2k2n3p4P4X6u7b7k7l8k9X9g9m9n;W;`=vQ>X>ZR>Y>['QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SS$oh$pR4U/U'XgOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/U/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>ST$kf$qQ$ifS)j$l)nR)v$qT$jf$qT)l$l)n'XhOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/U/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>ST$oh$pQ$rhR)u$p%^jOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_!s>Q$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S#glOPXZst!Z!`!o#S#d#o#{$n%m&k&n&o&r&t&u&w&{'T'b)O)s*i+]+g,p,s,x-i.g/V/n0]0l1r2S2T2V2X2[2_2a3d4T4z6T6e6f6i7[8t9T!U%Ri$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y#f(w#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^Q+T%aQ/c*Oo4O<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!U$yi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>YQ*c$zU*l$|*Z*oQ+U%bQ0W*m#f=q#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n=r<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hQ=w>TQ=x>UQ=y>VR=z>W!U%Ri$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y#f(w#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^o4O<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hnoOXst!Z#d%m&r&t&u&w,s,x2[2_S*f${*YQ-R'OQ-S'QR4i/y%[%Si#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^Q,U&]Q1h,WQ5s1gR8h5tV*n$|*Z*oU*n$|*Z*oT5z1o5{S0P*i/nQ4w0]T8S4z:]Q+j%xQ0V*lQ1O+kQ1u,aQ6W1vQ8v6XQ:c8wR;^:d!U%Oi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Yx*R$v)e*S*u+V/v0d0e4R4g5R5S5W7p8U:R:x=p=}>OS0`*t0a#f<o#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n<p<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!d=S(u)c*[*e.j.m.q/_/k/|0v1e3h4[4h4l5r7]7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[`=T3}7c7f7j9h:t:w;yS=_.l3iT=`7e9k!U%Qi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y|*T$v)e*U*t+V/g/v0d0e4R4g4|5R5S5W7p8U:R:x=p=}>OS0b*u0c#f<q#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n<r<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!h=U(u)c*[*e.k.l.q/_/k/|0v1e3f3h4[4h4l5r7]7^7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[d=V3}7d7e7j9h9i:t:u:w;yS=a.m3jT=b7f9lrnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_Q&f!UR,p&ornOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_R&f!UQ,Y&^R1d,RsnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_Q1p,_S6R1s1tU8p6P6Q6US:_8r8sS;Y:^:aQ;m;ZR;w;nQ&m!VR,i&iR6_1|R:f8yW&Q|&V&W,OR1Z+vQ&r!WR,s&sR,y&xT2],x2_R,}&yQ,|&yR2f,}Q'y!{R-y'ySsOtQ#dXT%ps#dQ#OTR'{#OQ#RUR'}#RQ){$uR/`){Q#UVR(Q#UQ#XWU(W#X(X.QQ(X#YR.Q(YQ-^'YR2r-^Q.u(yS3m.u3nR3n.vQ-e'`R2v-eY!rQ'`-e1o5{R'j!rQ/Q)eR4S/QU#_W%h*YU(_#_(`.RQ(`#`R.R(ZQ-a']R2t-at`OXst!V!Z#d%m&i&k&r&t&u&w,s,x2[2_S#hZ%eU#r`#h.[R.[(jQ(k#jQ.X(gW.a(k.X3X7RQ3X.YR7R3YQ)n$lR/W)nQ$phR)t$pQ$`cU)a$`-|<jQ-|<WR<j)qQ/q*]W4c/q4d7t9sU4d/r/s/tS7t4e4fR9s7u$e*Q$v(u)c)e*[*e*t*u+Q+R+V.l.m.o.p.q/_/g/i/k/v/|0d0e0v1e3f3g3h3}4R4[4g4h4l4|5O5R5S5W5r7]7^7_7`7e7f7h7i7j7p7w7z8U8X8Z9h9i9j9t9|:R:S:t:u:v:w:x:};R;e;j;v;y=p=}>O>Z>[Q/z*eU4k/z4m7xQ4m/|R7x4lS*o$|*ZR0Y*ox*S$v)e*t*u+V/v0d0e4R4g5R5S5W7p8U:R:x=p=}>O!d.j(u)c*[*e.l.m.q/_/k/|0v1e3h4[4h4l5r7]7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[U/h*S.j7ca7c3}7e7f7j9h:t:w;yQ0a*tQ3i.lU4}0a3i9kR9k7e|*U$v)e*t*u+V/g/v0d0e4R4g4|5R5S5W7p8U:R:x=p=}>O!h.k(u)c*[*e.l.m.q/_/k/|0v1e3f3h4[4h4l5r7]7^7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[U/j*U.k7de7d3}7e7f7j9h9i:t:u:w;yQ0c*uQ3j.mU5P0c3j9lR9l7fQ*z%UR0g*zQ5]0vR8Y5]Q+_%kR0u+_Q5v1jS8j5v:[R:[8kQ,[&_R1m,[Q5{1oR8m5{Q1{,fS6]1{8zR8z6_Q1U+rW5h1U5j8a:VQ5j1XQ8a5iR:V8bQ+w&QR1[+wQ2_,xR6m2_YrOXst#dQ&v!ZQ+a%mQ,r&rQ,t&tQ,u&uQ,w&wQ2Y,sS2],x2_R6l2[Q%opQ&z!_Q&}!aQ'P!bQ'R!cQ'q!uQ+`%lQ+l%zQ,Q&XQ,h&mQ-P&|W-p'k's't'wQ-w'oQ0X*nQ1P+mQ1c,PS2O,i,lQ2g-OQ2h-RQ2i-SQ2}-oW3P-r-s-v-xQ5a1QQ5m1_Q5q1eQ6V1uQ6a2QQ6k2ZU6z3O3R3UQ6}3SQ8]5bQ8e5oQ8g5rQ8l5zQ8u6WQ8{6`S9[6{7PQ9^7OQ:W8cQ:b8vQ:g8|Q:n9]Q;U:XQ;]:cQ;a:oQ;l;VR;o;^Q%zyQ'd!iQ'o!uU+m%{%|%}Q-W'VU-k'e'f'gS-o'k'uQ0Q*jS1Q+n+oQ2o-YS2{-l-mQ3S-tS4p0R0UQ5b1RQ6v2uQ6y2|Q7O3TU7{4r4s4vQ9z7}R;O9{S$wi>PR*{%VU%Ui%V>PR0f*yQ$viS(u#v+iS)c$b$cQ)e$dQ*[$xS*e${*YQ*t%OQ*u%QQ+Q%^Q+R%_Q+V%cQ.l<oQ.m<qQ.o<uQ.p<wQ.q<yQ/_)yQ/g*RQ/i*TQ/k*VQ/v*aS/|*g/mQ0d*wQ0e*xl0v+f,V.f1i1q3c6S7W8q9b:`:r;[;dQ1e,SQ3f=SQ3g=UQ3h=XS3}<l<mQ4R/PS4[/d4^Q4g/xQ4h/yQ4l/{Q4|0`Q5O0bQ5R0iQ5S0jQ5W0oQ5r1fQ7]=]Q7^=_Q7_=aQ7`=cQ7e<pQ7f<rQ7h<vQ7i<xQ7j<zQ7p4_Q7w4jQ7z4oQ8U5QQ8X5[Q8Z5_Q9h=YQ9i=TQ9j=VQ9t7vQ9|8QQ:R8VQ:S8[Q:t=^Q:u=`Q:v=bQ:w=dQ:x9pQ:}9yQ;R:PQ;e=gQ;j;QQ;v;kQ;y=hQ=p>PQ=}>XQ>O>YQ>Z>]R>[>^Q+O%]Q.n<sR7g<tnpOXst!Z#d%m&r&t&u&w,s,x2[2_Q!fPS#fZ#oQ&|!`W'h!o*i0]4zQ(P#SQ)Q#{Q)r$nS,l&k&nQ,q&oQ-O&{S-T'T/nQ-g'bQ.x)OQ/[)sQ0s+]Q0y+gQ2W,pQ2y-iQ3a.gQ4W/VQ5U0lQ6Q1rQ6c2SQ6d2TQ6h2VQ6j2XQ6o2aQ7Z3dQ7m4TQ8s6TQ9P6eQ9Q6fQ9S6iQ9f7[Q:a8tR:k9T#[cOPXZst!Z!`!o#d#o#{%m&k&n&o&r&t&u&w&{'T'b)O*i+]+g,p,s,x-i.g/n0]0l1r2S2T2V2X2[2_2a3d4z6T6e6f6i7[8t9TQ#YWQ#eYQ%quQ%svS%uw!gS(S#W(VQ(Y#ZQ(t#uQ(y#xQ)R$OQ)S$PQ)T$QQ)U$RQ)V$SQ)W$TQ)X$UQ)Y$VQ)Z$WQ)[$XQ)^$ZQ)`$_Q)b$aQ)g$eW)q$n)s/V4TQ+d%tQ+x&RS-Z'X2pQ-x'rS-}(T.PQ.S(]Q.U(dQ.s(xQ.v(zQ.z<UQ.|<XQ.}<YQ/O<]Q/b)}Q0p+XQ2k-UQ2n-XQ3O-qQ3V.VQ3k.tQ3p<^Q3q<_Q3r<`Q3s<aQ3t<bQ3u<cQ3v<dQ3w<eQ3x<fQ3y<gQ3z<hQ3{.{Q3|<kQ4P<nQ4Q<{Q4X<iQ5X0rQ5c1SQ6u=OQ6{3QQ7Q3WQ7a3lQ7b=PQ7k=RQ7l=ZQ8k5wQ9X6sQ9]6|Q9g=[Q9m=eQ9n=fQ:o9_Q;W:ZQ;`:mQ<W#SR=v>SR#[WR'Z!el!tQ!r!v!y!z'`'l'm'n-e-u1o5{5}S'V!e-]U*j$|*Z*oS-Y'W'_S0U*k*qQ0^*rQ2u-cQ4v0[R4{0_R({#xQ!fQT-d'`-e]!qQ!r'`-e1o5{Q#p]R'i<VR)f$dY!uQ'`-e1o5{Q'k!rS'u!v!yS'w!z5}S-t'l'mQ-v'nR3T-uT#kZ%eS#jZ%eS%km,oU(g#h#i#lS.Y(h(iQ.^(jQ0t+^Q3Y.ZU3Z.[.]._S7S3[3]R9`7Td#^W#W#Z%h(T(^*Y+Z.T/mr#gZm#h#i#l%e(h(i(j+^.Z.[.]._3[3]7TS*]$x*bQ/t*^Q2U,oQ2l-VQ4`/pQ6q2dQ7s4aQ9W6rT=m'X+[V#aW%h*YU#`W%h*YS(U#W(^U(Z#Z+Z/mS-['X+[T.O(T.TV'^!e%i*ZQ$lfR)x$qT)m$l)nR4V/UT*_$x*bT*h${*YQ0w+fQ1g,VQ3_.fQ5t1iQ6P1qQ7X3cQ8r6SQ9c7WQ:^8qQ:p9bQ;Z:`Q;c:rQ;n;[R;q;dnqOXst!Z#d%m&r&t&u&w,s,x2[2_Q&l!VR,h&itmOXst!U!V!Z#d%m&i&r&t&u&w,s,x2[2_R,o&oT%lm,oR1k,XR,g&gQ&U|S+}&V&WR1^,OR+s&PT&p!W&sT&q!W&sT2^,x2_",nodeNames:"⚠ ArithOp ArithOp ?. JSXStartTag LineComment BlockComment Script Hashbang ExportDeclaration export Star as VariableName String Escape from ; default FunctionDeclaration async function VariableDefinition > < TypeParamList in out const TypeDefinition extends ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation InterpolationStart NullType null VoidType void TypeofType typeof MemberExpression . PropertyName [ TemplateString Escape Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewTarget new NewExpression ) ( ArgList UnaryExpression delete LogicOp BitOp YieldExpression yield AwaitExpression await ParenthesizedExpression ClassExpression class ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression TypeArgList CompareOp < declare Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression InstantiationExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast < ArrowFunction TypeParamList SequenceExpression InstantiationExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate asserts is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var using TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration defer ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression SingleClassItem",maxTerm:380,context:VE,nodeProps:[["isolate",-8,5,6,14,37,39,51,53,55,""],["group",-26,9,17,19,68,207,211,215,216,218,221,224,234,237,243,245,247,249,252,258,264,266,268,270,272,274,275,"Statement",-34,13,14,32,35,36,42,51,54,55,57,62,70,72,76,80,82,84,85,110,111,120,121,136,139,141,142,143,144,145,147,148,167,169,171,"Expression",-23,31,33,37,41,43,45,173,175,177,178,180,181,182,184,185,186,188,189,190,201,203,205,206,"Type",-3,88,103,109,"ClassItem"],["openedBy",23,"<",38,"InterpolationStart",56,"[",60,"{",73,"(",160,"JSXStartCloseTag"],["closedBy",-2,24,168,">",40,"InterpolationEnd",50,"]",61,"}",74,")",165,"JSXEndTag"]],propSources:[qE],skippedNodes:[0,5,6,278],repeatNodeCount:37,tokenData:"$Fq07[R!bOX%ZXY+gYZ-yZ[+g[]%Z]^.c^p%Zpq+gqr/mrs3cst:_tuEruvJSvwLkwx! Yxy!'iyz!(sz{!)}{|!,q|}!.O}!O!,q!O!P!/Y!P!Q!9j!Q!R#:O!R![#<_![!]#I_!]!^#Jk!^!_#Ku!_!`$![!`!a$$v!a!b$*T!b!c$,r!c!}Er!}#O$-|#O#P$/W#P#Q$4o#Q#R$5y#R#SEr#S#T$7W#T#o$8b#o#p$<r#p#q$=h#q#r$>x#r#s$@U#s$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$I|Er$I|$I}$Dk$I}$JO$Dk$JO$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr(n%d_$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&j&hT$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c&j&zP;=`<%l&c'|'U]$i&j(Z!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!b(SU(Z!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!b(iP;=`<%l'}'|(oP;=`<%l&}'[(y]$i&j(WpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rp)wU(WpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)rp*^P;=`<%l)r'[*dP;=`<%l(r#S*nX(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g#S+^P;=`<%l*g(n+dP;=`<%l%Z07[+rq$i&j(Wp(Z!b'|0/lOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p$f%Z$f$g+g$g#BY%Z#BY#BZ+g#BZ$IS%Z$IS$I_+g$I_$JT%Z$JT$JU+g$JU$KV%Z$KV$KW+g$KW&FU%Z&FU&FV+g&FV;'S%Z;'S;=`+a<%l?HT%Z?HT?HU+g?HUO%Z07[.ST(X#S$i&j'}0/lO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c07[.n_$i&j(Wp(Z!b'}0/lOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)3p/x`$i&j!p),Q(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW1V`#v(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`2X!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW2d_#v(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At3l_(V':f$i&j(Z!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k(^4r_$i&j(Z!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k&z5vX$i&jOr5qrs6cs!^5q!^!_6y!_#o5q#o#p6y#p;'S5q;'S;=`7h<%lO5q&z6jT$d`$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c`6|TOr6yrs7]s;'S6y;'S;=`7b<%lO6y`7bO$d``7eP;=`<%l6y&z7kP;=`<%l5q(^7w]$d`$i&j(Z!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!r8uZ(Z!bOY8pYZ6yZr8prs9hsw8pwx6yx#O8p#O#P6y#P;'S8p;'S;=`:R<%lO8p!r9oU$d`(Z!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!r:UP;=`<%l8p(^:[P;=`<%l4k%9[:hh$i&j(Wp(Z!bOY%ZYZ&cZq%Zqr<Srs&}st%ZtuCruw%Zwx(rx!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr(r<__WS$i&j(Wp(Z!bOY<SYZ&cZr<Srs=^sw<Swx@nx!^<S!^!_Bm!_#O<S#O#P>`#P#o<S#o#pBm#p;'S<S;'S;=`Cl<%lO<S(Q=g]WS$i&j(Z!bOY=^YZ&cZw=^wx>`x!^=^!^!_?q!_#O=^#O#P>`#P#o=^#o#p?q#p;'S=^;'S;=`@h<%lO=^&n>gXWS$i&jOY>`YZ&cZ!^>`!^!_?S!_#o>`#o#p?S#p;'S>`;'S;=`?k<%lO>`S?XSWSOY?SZ;'S?S;'S;=`?e<%lO?SS?hP;=`<%l?S&n?nP;=`<%l>`!f?xWWS(Z!bOY?qZw?qwx?Sx#O?q#O#P?S#P;'S?q;'S;=`@b<%lO?q!f@eP;=`<%l?q(Q@kP;=`<%l=^'`@w]WS$i&j(WpOY@nYZ&cZr@nrs>`s!^@n!^!_Ap!_#O@n#O#P>`#P#o@n#o#pAp#p;'S@n;'S;=`Bg<%lO@ntAwWWS(WpOYApZrAprs?Ss#OAp#O#P?S#P;'SAp;'S;=`Ba<%lOAptBdP;=`<%lAp'`BjP;=`<%l@n#WBvYWS(Wp(Z!bOYBmZrBmrs?qswBmwxApx#OBm#O#P?S#P;'SBm;'S;=`Cf<%lOBm#WCiP;=`<%lBm(rCoP;=`<%l<S%9[C}i$i&j(o%1l(Wp(Z!bOY%ZYZ&cZr%Zrs&}st%ZtuCruw%Zwx(rx!Q%Z!Q![Cr![!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr%9[EoP;=`<%lCr07[FRk$i&j(Wp(Z!b$]#t(T,2j(e$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr+dHRk$i&j(Wp(Z!b$]#tOY%ZYZ&cZr%Zrs&}st%ZtuGvuw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Gv![!^%Z!^!_*g!_!c%Z!c!}Gv!}#O%Z#O#P&c#P#R%Z#R#SGv#S#T%Z#T#oGv#o#p*g#p$g%Z$g;'SGv;'S;=`Iv<%lOGv+dIyP;=`<%lGv07[JPP;=`<%lEr(KWJ_`$i&j(Wp(Z!b#p(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWKl_$i&j$Q(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,#xLva(z+JY$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sv%ZvwM{wx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWNW`$i&j#z(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At! c_(Y';W$i&j(WpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b'l!!i_$i&j(WpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b&z!#mX$i&jOw!#hwx6cx!^!#h!^!_!$Y!_#o!#h#o#p!$Y#p;'S!#h;'S;=`!$r<%lO!#h`!$]TOw!$Ywx7]x;'S!$Y;'S;=`!$l<%lO!$Y`!$oP;=`<%l!$Y&z!$uP;=`<%l!#h'l!%R]$d`$i&j(WpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r!Q!&PZ(WpOY!%zYZ!$YZr!%zrs!$Ysw!%zwx!&rx#O!%z#O#P!$Y#P;'S!%z;'S;=`!']<%lO!%z!Q!&yU$d`(WpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)r!Q!'`P;=`<%l!%z'l!'fP;=`<%l!!b/5|!'t_!l/.^$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#&U!)O_!k!Lf$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z-!n!*[b$i&j(Wp(Z!b(U%&f#q(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rxz%Zz{!+d{!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW!+o`$i&j(Wp(Z!b#n(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;x!,|`$i&j(Wp(Z!br+4YOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,$U!.Z_!]+Jf$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!/ec$i&j(Wp(Z!b!Q.2^OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!0p!P!Q%Z!Q![!3Y![!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!0ya$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!2O!P!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!2Z_![!L^$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!3eg$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!3Y![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S!3Y#S#X%Z#X#Y!4|#Y#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!5Vg$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx{%Z{|!6n|}%Z}!O!6n!O!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!6wc$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!8_c$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!9uf$i&j(Wp(Z!b#o(ChOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcxz!;Zz{#-}{!P!;Z!P!Q#/d!Q!^!;Z!^!_#(i!_!`#7S!`!a#8i!a!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z?O!;fb$i&j(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z>^!<w`$i&j(Z!b!X7`OY!<nYZ&cZw!<nwx!=yx!P!<n!P!Q!Eq!Q!^!<n!^!_!Gr!_!}!<n!}#O!KS#O#P!Dy#P#o!<n#o#p!Gr#p;'S!<n;'S;=`!L]<%lO!<n<z!>Q^$i&j!X7`OY!=yYZ&cZ!P!=y!P!Q!>|!Q!^!=y!^!_!@c!_!}!=y!}#O!CW#O#P!Dy#P#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!?Td$i&j!X7`O!^&c!_#W&c#W#X!>|#X#Z&c#Z#[!>|#[#]&c#]#^!>|#^#a&c#a#b!>|#b#g&c#g#h!>|#h#i&c#i#j!>|#j#k!>|#k#m&c#m#n!>|#n#o&c#p;'S&c;'S;=`&w<%lO&c7`!@hX!X7`OY!@cZ!P!@c!P!Q!AT!Q!}!@c!}#O!Ar#O#P!Bq#P;'S!@c;'S;=`!CQ<%lO!@c7`!AYW!X7`#W#X!AT#Z#[!AT#]#^!AT#a#b!AT#g#h!AT#i#j!AT#j#k!AT#m#n!AT7`!AuVOY!ArZ#O!Ar#O#P!B[#P#Q!@c#Q;'S!Ar;'S;=`!Bk<%lO!Ar7`!B_SOY!ArZ;'S!Ar;'S;=`!Bk<%lO!Ar7`!BnP;=`<%l!Ar7`!BtSOY!@cZ;'S!@c;'S;=`!CQ<%lO!@c7`!CTP;=`<%l!@c<z!C][$i&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#O!CW#O#P!DR#P#Q!=y#Q#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DWX$i&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DvP;=`<%l!CW<z!EOX$i&jOY!=yYZ&cZ!^!=y!^!_!@c!_#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!EnP;=`<%l!=y>^!Ezl$i&j(Z!b!X7`OY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#W&}#W#X!Eq#X#Z&}#Z#[!Eq#[#]&}#]#^!Eq#^#a&}#a#b!Eq#b#g&}#g#h!Eq#h#i&}#i#j!Eq#j#k!Eq#k#m&}#m#n!Eq#n#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}8r!GyZ(Z!b!X7`OY!GrZw!Grwx!@cx!P!Gr!P!Q!Hl!Q!}!Gr!}#O!JU#O#P!Bq#P;'S!Gr;'S;=`!J|<%lO!Gr8r!Hse(Z!b!X7`OY'}Zw'}x#O'}#P#W'}#W#X!Hl#X#Z'}#Z#[!Hl#[#]'}#]#^!Hl#^#a'}#a#b!Hl#b#g'}#g#h!Hl#h#i'}#i#j!Hl#j#k!Hl#k#m'}#m#n!Hl#n;'S'};'S;=`(f<%lO'}8r!JZX(Z!bOY!JUZw!JUwx!Arx#O!JU#O#P!B[#P#Q!Gr#Q;'S!JU;'S;=`!Jv<%lO!JU8r!JyP;=`<%l!JU8r!KPP;=`<%l!Gr>^!KZ^$i&j(Z!bOY!KSYZ&cZw!KSwx!CWx!^!KS!^!_!JU!_#O!KS#O#P!DR#P#Q!<n#Q#o!KS#o#p!JU#p;'S!KS;'S;=`!LV<%lO!KS>^!LYP;=`<%l!KS>^!L`P;=`<%l!<n=l!Ll`$i&j(Wp!X7`OY!LcYZ&cZr!Lcrs!=ys!P!Lc!P!Q!Mn!Q!^!Lc!^!_# o!_!}!Lc!}#O#%P#O#P!Dy#P#o!Lc#o#p# o#p;'S!Lc;'S;=`#&Y<%lO!Lc=l!Mwl$i&j(Wp!X7`OY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#W(r#W#X!Mn#X#Z(r#Z#[!Mn#[#](r#]#^!Mn#^#a(r#a#b!Mn#b#g(r#g#h!Mn#h#i(r#i#j!Mn#j#k!Mn#k#m(r#m#n!Mn#n#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r8Q# vZ(Wp!X7`OY# oZr# ors!@cs!P# o!P!Q#!i!Q!}# o!}#O#$R#O#P!Bq#P;'S# o;'S;=`#$y<%lO# o8Q#!pe(Wp!X7`OY)rZr)rs#O)r#P#W)r#W#X#!i#X#Z)r#Z#[#!i#[#])r#]#^#!i#^#a)r#a#b#!i#b#g)r#g#h#!i#h#i)r#i#j#!i#j#k#!i#k#m)r#m#n#!i#n;'S)r;'S;=`*Z<%lO)r8Q#$WX(WpOY#$RZr#$Rrs!Ars#O#$R#O#P!B[#P#Q# o#Q;'S#$R;'S;=`#$s<%lO#$R8Q#$vP;=`<%l#$R8Q#$|P;=`<%l# o=l#%W^$i&j(WpOY#%PYZ&cZr#%Prs!CWs!^#%P!^!_#$R!_#O#%P#O#P!DR#P#Q!Lc#Q#o#%P#o#p#$R#p;'S#%P;'S;=`#&S<%lO#%P=l#&VP;=`<%l#%P=l#&]P;=`<%l!Lc?O#&kn$i&j(Wp(Z!b!X7`OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#W%Z#W#X#&`#X#Z%Z#Z#[#&`#[#]%Z#]#^#&`#^#a%Z#a#b#&`#b#g%Z#g#h#&`#h#i%Z#i#j#&`#j#k#&`#k#m%Z#m#n#&`#n#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z9d#(r](Wp(Z!b!X7`OY#(iZr#(irs!Grsw#(iwx# ox!P#(i!P!Q#)k!Q!}#(i!}#O#+`#O#P!Bq#P;'S#(i;'S;=`#,`<%lO#(i9d#)th(Wp(Z!b!X7`OY*gZr*grs'}sw*gwx)rx#O*g#P#W*g#W#X#)k#X#Z*g#Z#[#)k#[#]*g#]#^#)k#^#a*g#a#b#)k#b#g*g#g#h#)k#h#i*g#i#j#)k#j#k#)k#k#m*g#m#n#)k#n;'S*g;'S;=`+Z<%lO*g9d#+gZ(Wp(Z!bOY#+`Zr#+`rs!JUsw#+`wx#$Rx#O#+`#O#P!B[#P#Q#(i#Q;'S#+`;'S;=`#,Y<%lO#+`9d#,]P;=`<%l#+`9d#,cP;=`<%l#(i?O#,o`$i&j(Wp(Z!bOY#,fYZ&cZr#,frs!KSsw#,fwx#%Px!^#,f!^!_#+`!_#O#,f#O#P!DR#P#Q!;Z#Q#o#,f#o#p#+`#p;'S#,f;'S;=`#-q<%lO#,f?O#-tP;=`<%l#,f?O#-zP;=`<%l!;Z07[#.[b$i&j(Wp(Z!b(O0/l!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z07[#/o_$i&j(Wp(Z!bT0/lOY#/dYZ&cZr#/drs#0nsw#/dwx#4Ox!^#/d!^!_#5}!_#O#/d#O#P#1p#P#o#/d#o#p#5}#p;'S#/d;'S;=`#6|<%lO#/d06j#0w]$i&j(Z!bT0/lOY#0nYZ&cZw#0nwx#1px!^#0n!^!_#3R!_#O#0n#O#P#1p#P#o#0n#o#p#3R#p;'S#0n;'S;=`#3x<%lO#0n05W#1wX$i&jT0/lOY#1pYZ&cZ!^#1p!^!_#2d!_#o#1p#o#p#2d#p;'S#1p;'S;=`#2{<%lO#1p0/l#2iST0/lOY#2dZ;'S#2d;'S;=`#2u<%lO#2d0/l#2xP;=`<%l#2d05W#3OP;=`<%l#1p01O#3YW(Z!bT0/lOY#3RZw#3Rwx#2dx#O#3R#O#P#2d#P;'S#3R;'S;=`#3r<%lO#3R01O#3uP;=`<%l#3R06j#3{P;=`<%l#0n05x#4X]$i&j(WpT0/lOY#4OYZ&cZr#4Ors#1ps!^#4O!^!_#5Q!_#O#4O#O#P#1p#P#o#4O#o#p#5Q#p;'S#4O;'S;=`#5w<%lO#4O00^#5XW(WpT0/lOY#5QZr#5Qrs#2ds#O#5Q#O#P#2d#P;'S#5Q;'S;=`#5q<%lO#5Q00^#5tP;=`<%l#5Q05x#5zP;=`<%l#4O01p#6WY(Wp(Z!bT0/lOY#5}Zr#5}rs#3Rsw#5}wx#5Qx#O#5}#O#P#2d#P;'S#5};'S;=`#6v<%lO#5}01p#6yP;=`<%l#5}07[#7PP;=`<%l#/d)3h#7ab$i&j$Q(Ch(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;ZAt#8vb$Z#t$i&j(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z'Ad#:Zp$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#U%Z#U#V#?i#V#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#d#Bq#d#l%Z#l#m#Es#m#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#<jk$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#>j_$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#?rd$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#A]f$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Bzc$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Dbe$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#E|g$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Gpi$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x#Il_!g$b$i&j$O)Lv(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)[#Jv_al$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f#LS^h#)`#R-<U(Wp(Z!b$n7`OY*gZr*grs'}sw*gwx)rx!P*g!P!Q#MO!Q!^*g!^!_#Mt!_!`$ f!`#O*g#P;'S*g;'S;=`+Z<%lO*g(n#MXX$k&j(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El#M}Z#r(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx!_*g!_!`#Np!`#O*g#P;'S*g;'S;=`+Z<%lO*g(El#NyX$Q(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El$ oX#s(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g*)x$!ga#`*!Y$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`!a$#l!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(K[$#w_#k(Cl$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x$%Vag!*r#s(Ch$f#|$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`$&[!`!a$'f!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$&g_#s(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$'qa#r(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`!a$(v!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$)R`#r(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(Kd$*`a(r(Ct$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!a%Z!a!b$+e!b#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$+p`$i&j#{(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#`$,}_!|$Ip$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f$.X_!S0,v$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(n$/]Z$i&jO!^$0O!^!_$0f!_#i$0O#i#j$0k#j#l$0O#l#m$2^#m#o$0O#o#p$0f#p;'S$0O;'S;=`$4i<%lO$0O(n$0VT_#S$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c#S$0kO_#S(n$0p[$i&jO!Q&c!Q![$1f![!^&c!_!c&c!c!i$1f!i#T&c#T#Z$1f#Z#o&c#o#p$3|#p;'S&c;'S;=`&w<%lO&c(n$1kZ$i&jO!Q&c!Q![$2^![!^&c!_!c&c!c!i$2^!i#T&c#T#Z$2^#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$2cZ$i&jO!Q&c!Q![$3U![!^&c!_!c&c!c!i$3U!i#T&c#T#Z$3U#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$3ZZ$i&jO!Q&c!Q![$0O![!^&c!_!c&c!c!i$0O!i#T&c#T#Z$0O#Z#o&c#p;'S&c;'S;=`&w<%lO&c#S$4PR!Q![$4Y!c!i$4Y#T#Z$4Y#S$4]S!Q![$4Y!c!i$4Y#T#Z$4Y#q#r$0f(n$4lP;=`<%l$0O#1[$4z_!Y#)l$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$6U`#x(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;p$7c_$i&j(Wp(Z!b(a+4QOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$8qk$i&j(Wp(Z!b(T,2j$_#t(e$I[OY%ZYZ&cZr%Zrs&}st%Ztu$8buw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$8b![!^%Z!^!_*g!_!c%Z!c!}$8b!}#O%Z#O#P&c#P#R%Z#R#S$8b#S#T%Z#T#o$8b#o#p*g#p$g%Z$g;'S$8b;'S;=`$<l<%lO$8b+d$:qk$i&j(Wp(Z!b$_#tOY%ZYZ&cZr%Zrs&}st%Ztu$:fuw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$:f![!^%Z!^!_*g!_!c%Z!c!}$:f!}#O%Z#O#P&c#P#R%Z#R#S$:f#S#T%Z#T#o$:f#o#p*g#p$g%Z$g;'S$:f;'S;=`$<f<%lO$:f+d$<iP;=`<%l$:f07[$<oP;=`<%l$8b#Jf$<{X!_#Hb(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g,#x$=sa(y+JY$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p#q$+e#q;'S%Z;'S;=`+a<%lO%Z)>v$?V_!^(CdvBr$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z?O$@a_!q7`$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$Aq|$i&j(Wp(Z!b'|0/l$]#t(T,2j(e$I[OX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr07[$D|k$i&j(Wp(Z!b'}0/l$]#t(T,2j(e$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr",tokenizers:[jE,ZE,GE,UE,2,3,4,5,6,7,8,9,10,11,12,13,14,zE,new Dh("$S~RRtu[#O#Pg#S#T#|~_P#o#pb~gOx~~jVO#i!P#i#j!U#j#l!P#l#m!q#m;'S!P;'S;=`#v<%lO!P~!UO!U~~!XS!Q![!e!c!i!e#T#Z!e#o#p#Z~!hR!Q![!q!c!i!q#T#Z!q~!tR!Q![!}!c!i!}#T#Z!}~#QR!Q![!P!c!i!P#T#Z!P~#^R!Q![#g!c!i#g#T#Z#g~#jS!Q![#g!c!i#g#T#Z#g#q#r!P~#yP;=`<%l!P~$RO(c~~",141,340),new Dh("j~RQYZXz{^~^O(Q~~aP!P!Qd~iO(R~~",25,323)],topRules:{Script:[0,7],SingleExpression:[1,276],SingleClassItem:[2,277]},dialects:{jsx:0,ts:15175},dynamicPrecedences:{80:1,82:1,94:1,169:1,199:1},specialized:[{term:327,get:n=>WE[n]||-1},{term:343,get:n=>XE[n]||-1},{term:95,get:n=>HE[n]||-1}],tokenPrec:15201});var Gu;const Fr=new at;function uO(n){return Ie.define({combine:n?e=>e.concat(n):void 0})}const Nd=new at;class Ni{constructor(e,t,i=[],s=""){this.data=e,this.name=s,At.prototype.hasOwnProperty("tree")||Object.defineProperty(At.prototype,"tree",{get(){return vn(this)}}),this.parser=t,this.extension=[Us.of(this),At.languageData.of((r,a,o)=>{let l=Kp(r,a,o),c=l.type.prop(Fr);if(!c)return[];let u=r.facet(c),h=l.type.prop(Nd);if(h){let d=l.resolve(a-l.from,o);for(let f of h)if(f.test(d,r)){let m=r.facet(f.facet);return f.type=="replace"?m:m.concat(u)}}return u})].concat(i)}isActiveAt(e,t,i=-1){return Kp(e,t,i).type.prop(Fr)==this.data}findRegions(e){let t=e.facet(Us);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],s=(r,a)=>{if(r.prop(Fr)==this.data){i.push({from:a,to:a+r.length});return}let o=r.prop(at.mounted);if(o){if(o.tree.prop(Fr)==this.data){if(o.overlay)for(let l of o.overlay)i.push({from:l.from+a,to:l.to+a});else i.push({from:a,to:a+r.length});return}else if(o.overlay){let l=i.length;if(s(o.tree,o.overlay[0].from+a),i.length>l)return}}for(let l=0;l<r.children.length;l++){let c=r.children[l];c instanceof un&&s(c,r.positions[l]+a)}};return s(vn(e),0),i}get allowsNesting(){return!0}}Ni.setState=xt.define();function Kp(n,e,t){let i=n.facet(Us),s=vn(n).topNode;if(!i||i.allowsNesting)for(let r=s;r;r=r.enter(e,t,mn.ExcludeBuffers))r.type.isTop&&(s=r);return s}class gl extends Ni{constructor(e,t,i){super(e,t,[],i),this.parser=t}static define(e){let t=uO(e.languageData);return new gl(t,e.parser.configure({props:[Fr.add(i=>i.isTop?t:void 0)]}),e.name)}configure(e,t){return new gl(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function vn(n){let e=n.field(Ni.state,!1);return e?e.tree:un.empty}class KE{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let ca=null;class Ol{constructor(e,t,i=[],s,r,a,o,l){this.parser=e,this.state=t,this.fragments=i,this.tree=s,this.treeLen=r,this.viewport=a,this.skipped=o,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new Ol(e,t,[],un.empty,0,i,[],null)}startParse(){return this.parser.startParse(new KE(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=un.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let s=Date.now()+e;e=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(cr.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(cr.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=ca;ca=this;try{return e()}finally{ca=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Jp(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:s,treeLen:r,viewport:a,skipped:o}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((c,u,h,d)=>l.push({fromA:c,toA:u,fromB:h,toB:d})),i=cr.applyChanges(i,l),s=un.empty,r=0,a={from:e.mapPos(a.from,-1),to:e.mapPos(a.to,1)},this.skipped.length){o=[];for(let c of this.skipped){let u=e.mapPos(c.from,1),h=e.mapPos(c.to,-1);u<h&&o.push({from:u,to:h})}}}return new Ol(this.parser,t,i,s,r,a,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:s,to:r}=this.skipped[i];s<e.to&&r>e.from&&(this.fragments=Jp(this.fragments,s,r),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends iO{createParse(t,i,s){let r=s[0].from,a=s[s.length-1].to;return{parsedPos:r,advance(){let l=ca;if(l){for(let c of s)l.tempSkipped.push(c);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=a,new un(Jn.none,[],[],a-r)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return ca}}function Jp(n,e,t){return cr.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Ur{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Ur(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=Ol.create(e.facet(Us).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new Ur(i)}}Ni.state=oi.define({create:Ur.init,update(n,e){for(let t of e.effects)if(t.is(Ni.setState))return t.value;return e.startState.facet(Us)!=e.state.facet(Us)?Ur.init(e.state):n.apply(e)}});let cO=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(cO=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Uu=typeof navigator<"u"&&(!((Gu=navigator.scheduling)===null||Gu===void 0)&&Gu.isInputPending)?()=>navigator.scheduling.isInputPending():null,JE=hs.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Ni.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Ni.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=cO(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,r=i.field(Ni.state);if(r.tree==r.context.tree&&r.context.isDone(s+1e5))return;let a=Date.now()+Math.min(this.chunkBudget,100,e&&!Uu?Math.max(25,e.timeRemaining()-5):1e9),o=r.context.treeLen<s&&i.doc.length>s+1e3,l=r.context.work(()=>Uu&&Uu()||Date.now()>a,s+(o?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:Ni.setState.of(new Ur(r.context))})),this.chunkBudget>0&&!(l&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>ts(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Us=Ie.define({combine(n){return n.length?n[0]:null},enables:n=>[Ni.state,JE,Re.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]});class e2{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const t2=Ie.define(),Gl=Ie.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function yl(n){let e=n.facet(Gl);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function bl(n,e){let t="",i=n.tabSize,s=n.facet(Gl)[0];if(s=="	"){for(;e>=i;)t+="	",e-=i;s=" "}for(let r=0;r<e;r++)t+=s;return t}function hO(n,e){n instanceof At&&(n=new Ul(n));for(let i of n.state.facet(t2)){let s=i(n,e);if(s!==void 0)return s}let t=vn(n.state);return t.length>=e?n2(n,t,e):null}class Ul{constructor(e,t={}){this.state=e,this.options=t,this.unit=yl(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:s,simulateDoubleBreak:r}=this.options;return s!=null&&s>=i.from&&s<=i.to?r&&s==e?{text:"",from:e}:(t<0?s<e:s<=e)?{text:i.text.slice(s-i.from),from:s}:{text:i.text.slice(0,s-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:s}=this.lineAt(e,t);return i.slice(e-s,Math.min(i.length,e+100-s))}column(e,t=1){let{text:i,from:s}=this.lineAt(e,t),r=this.countColumn(i,e-s),a=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return a>-1&&(r+=a-this.countColumn(i,i.search(/\S|$/))),r}countColumn(e,t=e.length){return Vl(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:s}=this.lineAt(e,t),r=this.options.overrideIndentation;if(r){let a=r(s);if(a>-1)return a}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const dO=new at;function n2(n,e,t){let i=e.resolveStack(t),s=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(s!=i.node){let r=[];for(let a=s;a&&!(a.from<i.node.from||a.to>i.node.to||a.from==i.node.from&&a.type==i.node.type);a=a.parent)r.push(a);for(let a=r.length-1;a>=0;a--)i={node:r[a],next:i}}return fO(i,n,t)}function fO(n,e,t){for(let i=n;i;i=i.next){let s=s2(i.node);if(s)return s(Bd.create(e,t,i))}return 0}function i2(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function s2(n){let e=n.type.prop(dO);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(at.closedBy))){let s=n.lastChild,r=s&&i.indexOf(s.name)>-1;return a=>pO(a,!0,1,void 0,r&&!i2(a)?s.from:void 0)}return n.parent==null?r2:null}function r2(){return 0}class Bd extends Ul{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.context=i}get node(){return this.context.node}static create(e,t,i){return new Bd(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(a2(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){return fO(this.context.next,this.base,this.pos)}}function a2(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function o2(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let s=n.options.simulateBreak,r=n.state.doc.lineAt(t.from),a=s==null||s<=r.from?r.to:Math.min(r.to,s);for(let o=t.to;;){let l=e.childAfter(o);if(!l||l==i)return null;if(!l.type.isSkipped){if(l.from>=a)return null;let c=/^ */.exec(r.text.slice(t.to-r.from))[0].length;return{from:t.from,to:t.to+c}}o=l.to}}function l2({closing:n,align:e=!0,units:t=1}){return i=>pO(i,e,t,n)}function pO(n,e,t,i,s){let r=n.textAfter,a=r.match(/^\s*/)[0].length,o=i&&r.slice(a,a+i.length)==i||s==n.pos+a,l=e?o2(n):null;return l?o?n.column(l.from):n.column(l.to):n.baseIndent+(o?0:n.unit*t)}const u2=n=>n.baseIndent;function qu({except:n,units:e=1}={}){return t=>{let i=n&&n.test(t.textAfter);return t.baseIndent+(i?0:e*t.unit)}}const c2=Ie.define(),mO=new at;function h2(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function d2(n,e,t){let i=vn(n);if(i.length<t)return null;let s=i.resolveStack(t,1),r=null;for(let a=s;a;a=a.next){let o=a.node;if(o.to<=t||o.from>t)continue;if(r&&o.from<e)break;let l=o.type.prop(mO);if(l&&(o.to<i.length-50||i.length==n.doc.length||!f2(o))){let c=l(o,n);c&&c.from<=t&&c.from>=e&&c.to>t&&(r=c)}}return r}function f2(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function vl(n,e,t){for(let i of n.facet(c2)){let s=i(n,e,t);if(s)return s}return d2(n,e,t)}function gO(n,e){let t=e.mapPos(n.from,1),i=e.mapPos(n.to,-1);return t>=i?void 0:{from:t,to:i}}const ql=xt.define({map:gO}),io=xt.define({map:gO});function OO(n){let e=[];for(let{head:t}of n.state.selection.ranges)e.some(i=>i.from<=t&&i.to>=t)||e.push(n.lineBlockAt(t));return e}const yr=oi.define({create(){return it.none},update(n,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((t,i)=>n=em(n,t,i)),n=n.map(e.changes);for(let t of e.effects)if(t.is(ql)&&!p2(n,t.value.from,t.value.to)){let{preparePlaceholder:i}=e.state.facet(vO),s=i?it.replace({widget:new S2(i(e.state,t.value))}):tm;n=n.update({add:[s.range(t.value.from,t.value.to)]})}else t.is(io)&&(n=n.update({filter:(i,s)=>t.value.from!=i||t.value.to!=s,filterFrom:t.value.from,filterTo:t.value.to}));return e.selection&&(n=em(n,e.selection.main.head)),n},provide:n=>Re.decorations.from(n),toJSON(n,e){let t=[];return n.between(0,e.doc.length,(i,s)=>{t.push(i,s)}),t},fromJSON(n){if(!Array.isArray(n)||n.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<n.length;){let i=n[t++],s=n[t++];if(typeof i!="number"||typeof s!="number")throw new RangeError("Invalid JSON for fold state");e.push(tm.range(i,s))}return it.set(e,!0)}});function em(n,e,t=e){let i=!1;return n.between(e,t,(s,r)=>{s<t&&r>e&&(i=!0)}),i?n.update({filterFrom:e,filterTo:t,filter:(s,r)=>s>=t||r<=e}):n}function Sl(n,e,t){var i;let s=null;return(i=n.field(yr,!1))===null||i===void 0||i.between(e,t,(r,a)=>{(!s||s.from>r)&&(s={from:r,to:a})}),s}function p2(n,e,t){let i=!1;return n.between(e,e,(s,r)=>{s==e&&r==t&&(i=!0)}),i}function yO(n,e){return n.field(yr,!1)?e:e.concat(xt.appendConfig.of(SO()))}const m2=n=>{for(let e of OO(n)){let t=vl(n.state,e.from,e.to);if(t)return n.dispatch({effects:yO(n.state,[ql.of(t),bO(n,t)])}),!0}return!1},g2=n=>{if(!n.state.field(yr,!1))return!1;let e=[];for(let t of OO(n)){let i=Sl(n.state,t.from,t.to);i&&e.push(io.of(i),bO(n,i,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function bO(n,e,t=!0){let i=n.state.doc.lineAt(e.from).number,s=n.state.doc.lineAt(e.to).number;return Re.announce.of(`${n.state.phrase(t?"Folded lines":"Unfolded lines")} ${i} ${n.state.phrase("to")} ${s}.`)}const O2=n=>{let{state:e}=n,t=[];for(let i=0;i<e.doc.length;){let s=n.lineBlockAt(i),r=vl(e,s.from,s.to);r&&t.push(ql.of(r)),i=(r?n.lineBlockAt(r.to):s).to+1}return t.length&&n.dispatch({effects:yO(n.state,t)}),!!t.length},y2=n=>{let e=n.state.field(yr,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,n.state.doc.length,(i,s)=>{t.push(io.of({from:i,to:s}))}),n.dispatch({effects:t}),!0},b2=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:m2},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:g2},{key:"Ctrl-Alt-[",run:O2},{key:"Ctrl-Alt-]",run:y2}],v2={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},vO=Ie.define({combine(n){return Ka(n,v2)}});function SO(n){return[yr,P2]}function wO(n,e){let{state:t}=n,i=t.facet(vO),s=a=>{let o=n.lineBlockAt(n.posAtDOM(a.target)),l=Sl(n.state,o.from,o.to);l&&n.dispatch({effects:io.of(l)}),a.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(n,s,e);let r=document.createElement("span");return r.textContent=i.placeholderText,r.setAttribute("aria-label",t.phrase("folded code")),r.title=t.phrase("unfold"),r.className="cm-foldPlaceholder",r.onclick=s,r}const tm=it.replace({widget:new class extends Hr{toDOM(n){return wO(n,null)}}});class S2 extends Hr{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return wO(e,this.value)}}const w2={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class Wu extends Zs{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function C2(n={}){let e={...w2,...n},t=new Wu(e,!0),i=new Wu(e,!1),s=hs.fromClass(class{constructor(a){this.from=a.viewport.from,this.markers=this.buildMarkers(a)}update(a){(a.docChanged||a.viewportChanged||a.startState.facet(Us)!=a.state.facet(Us)||a.startState.field(yr,!1)!=a.state.field(yr,!1)||vn(a.startState)!=vn(a.state)||e.foldingChanged(a))&&(this.markers=this.buildMarkers(a.view))}buildMarkers(a){let o=new zr;for(let l of a.viewportLineBlocks){let c=Sl(a.state,l.from,l.to)?i:vl(a.state,l.from,l.to)?t:null;c&&o.add(l.from,l.from,c)}return o.finish()}}),{domEventHandlers:r}=e;return[s,jx({class:"cm-foldGutter",markers(a){var o;return((o=a.plugin(s))===null||o===void 0?void 0:o.markers)||St.empty},initialSpacer(){return new Wu(e,!1)},domEventHandlers:{...r,click:(a,o,l)=>{if(r.click&&r.click(a,o,l))return!0;let c=Sl(a.state,o.from,o.to);if(c)return a.dispatch({effects:io.of(c)}),!0;let u=vl(a.state,o.from,o.to);return u?(a.dispatch({effects:ql.of(u)}),!0):!1}}}),SO()]}const P2=Re.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Wl{constructor(e,t){this.specs=e;let i;function s(o){let l=Vs.newName();return(i||(i=Object.create(null)))["."+l]=o,l}const r=typeof t.all=="string"?t.all:t.all?s(t.all):void 0,a=t.scope;this.scope=a instanceof Ni?o=>o.prop(Fr)==a.data:a?o=>o==a:void 0,this.style=oO(e.map(o=>({tag:o.tag,class:o.class||s(Object.assign({},o,{tag:null}))})),{all:r}).style,this.module=i?new Vs(i):null,this.themeType=t.themeType}static define(e,t){return new Wl(e,t||{})}}const Nh=Ie.define(),A2=Ie.define({combine(n){return n.length?[n[0]]:null}});function Xu(n){let e=n.facet(Nh);return e.length?e:n.facet(A2)}function x2(n,e){let t=[k2],i;return n instanceof Wl&&(n.module&&t.push(Re.styleModule.of(n.module)),i=n.themeType),i?t.push(Nh.computeN([Re.darkTheme],s=>s.facet(Re.darkTheme)==(i=="dark")?[n]:[])):t.push(Nh.of(n)),t}class E2{constructor(e){this.markCache=Object.create(null),this.tree=vn(e.state),this.decorations=this.buildDeco(e,Xu(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=vn(e.state),i=Xu(e.state),s=i!=Xu(e.startState),{viewport:r}=e.view,a=e.changes.mapPos(this.decoratedTo,1);t.length<r.to&&!s&&t.type==this.tree.type&&a>=r.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=a):(t!=this.tree||e.viewportChanged||s)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=r.to)}buildDeco(e,t){if(!t||!this.tree.length)return it.none;let i=new zr;for(let{from:s,to:r}of e.visibleRanges)yE(this.tree,t,(a,o,l)=>{i.add(a,o,this.markCache[l]||(this.markCache[l]=it.mark({class:l})))},s,r);return i.finish()}}const k2=Ll.high(hs.fromClass(E2,{decorations:n=>n.decorations})),M2=Re.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),CO=1e4,PO="()[]{}",AO=Ie.define({combine(n){return Ka(n,{afterCursor:!0,brackets:PO,maxScanDistance:CO,renderMatch:T2})}}),D2=it.mark({class:"cm-matchingBracket"}),$2=it.mark({class:"cm-nonmatchingBracket"});function T2(n){let e=[],t=n.matched?D2:$2;return e.push(t.range(n.start.from,n.start.to)),n.end&&e.push(t.range(n.end.from,n.end.to)),e}const _2=oi.define({create(){return it.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],i=e.state.facet(AO);for(let s of e.state.selection.ranges){if(!s.empty)continue;let r=is(e.state,s.head,-1,i)||s.head>0&&is(e.state,s.head-1,1,i)||i.afterCursor&&(is(e.state,s.head,1,i)||s.head<e.state.doc.length&&is(e.state,s.head+1,-1,i));r&&(t=t.concat(i.renderMatch(r,e.state)))}return it.set(t,!0)},provide:n=>Re.decorations.from(n)}),N2=[_2,M2];function B2(n={}){return[AO.of(n),N2]}const F2=new at;function Bh(n,e,t){let i=n.prop(e<0?at.openedBy:at.closedBy);if(i)return i;if(n.name.length==1){let s=t.indexOf(n.name);if(s>-1&&s%2==(e<0?1:0))return[t[s+e]]}return null}function Fh(n){let e=n.type.prop(F2);return e?e(n.node):n}function is(n,e,t,i={}){let s=i.maxScanDistance||CO,r=i.brackets||PO,a=vn(n),o=a.resolveInner(e,t);for(let l=o;l;l=l.parent){let c=Bh(l.type,t,r);if(c&&l.from<l.to){let u=Fh(l);if(u&&(t>0?e>=u.from&&e<u.to:e>u.from&&e<=u.to))return R2(n,e,t,l,u,c,r)}}return I2(n,e,t,a,o.type,s,r)}function R2(n,e,t,i,s,r,a){let o=i.parent,l={from:s.from,to:s.to},c=0,u=o==null?void 0:o.cursor();if(u&&(t<0?u.childBefore(i.from):u.childAfter(i.to)))do if(t<0?u.to<=i.from:u.from>=i.to){if(c==0&&r.indexOf(u.type.name)>-1&&u.from<u.to){let h=Fh(u);return{start:l,end:h?{from:h.from,to:h.to}:void 0,matched:!0}}else if(Bh(u.type,t,a))c++;else if(Bh(u.type,-t,a)){if(c==0){let h=Fh(u);return{start:l,end:h&&h.from<h.to?{from:h.from,to:h.to}:void 0,matched:!1}}c--}}while(t<0?u.prevSibling():u.nextSibling());return{start:l,matched:!1}}function I2(n,e,t,i,s,r,a){let o=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),l=a.indexOf(o);if(l<0||l%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},u=n.doc.iterRange(e,t>0?n.doc.length:0),h=0;for(let d=0;!u.next().done&&d<=r;){let f=u.value;t<0&&(d+=f.length);let m=e+d*t;for(let g=t>0?0:f.length-1,y=t>0?f.length:-1;g!=y;g+=t){let b=a.indexOf(f[g]);if(!(b<0||i.resolveInner(m+g,1).type!=s))if(b%2==0==t>0)h++;else{if(h==1)return{start:c,end:{from:m+g,to:m+g+1},matched:b>>1==l>>1};h--}}t>0&&(d+=f.length)}return u.done?{start:c,matched:!1}:null}const L2=Object.create(null),nm=[Jn.none],im=[],sm=Object.create(null),Q2=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Q2[n]=V2(L2,e);function Hu(n,e){im.indexOf(n)>-1||(im.push(n),console.warn(e))}function V2(n,e){let t=[];for(let o of e.split(" ")){let l=[];for(let c of o.split(".")){let u=n[c]||U[c];u?typeof u=="function"?l.length?l=l.map(u):Hu(c,`Modifier ${c} used at start of tag`):l.length?Hu(c,`Tag ${c} used as modifier`):l=Array.isArray(u)?u:[u]:Hu(c,`Unknown highlighting tag ${c}`)}for(let c of l)t.push(c)}if(!t.length)return 0;let i=e.replace(/ /g,"_"),s=i+" "+t.map(o=>o.id),r=sm[s];if(r)return r.id;let a=sm[s]=Jn.define({id:nm.length,name:i,props:[rO({[i]:t})]});return nm.push(a),a.id}gn.RTL,gn.LTR;function rm(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function z2(n){let e=Object.create(null),t=Object.create(null);for(let{label:s}of n){e[s[0]]=!0;for(let r=1;r<s.length;r++)t[s[r]]=!0}let i=rm(e)+rm(t)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function j2(n){let e=n.map(s=>typeof s=="string"?{label:s}:s),[t,i]=e.every(s=>/^\w+$/.test(s.label))?[/\w*$/,/\w+$/]:z2(e);return s=>{let r=s.matchBefore(i);return r||s.explicit?{from:r?r.from:s.pos,options:e,validFor:t}:null}}function Z2(n,e){return t=>{for(let i=vn(t.state).resolveInner(t.pos,-1);i;i=i.parent){if(n.indexOf(i.name)>-1)return null;if(i.type.isTop)break}return e(t)}}const G2=Ps.define(),U2=Re.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class q2{constructor(e,t,i,s){this.field=e,this.line=t,this.from=i,this.to=s}}class Fd{constructor(e,t,i){this.field=e,this.from=t,this.to=i}map(e){let t=e.mapPos(this.from,-1,$n.TrackDel),i=e.mapPos(this.to,1,$n.TrackDel);return t==null||i==null?null:new Fd(this.field,t,i)}}class Rd{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let i=[],s=[t],r=e.doc.lineAt(t),a=/^\s*/.exec(r.text)[0];for(let l of this.lines){if(i.length){let c=a,u=/^\t*/.exec(l)[0].length;for(let h=0;h<u;h++)c+=e.facet(Gl);s.push(t+c.length-u),l=c+l.slice(u)}i.push(l),t+=l.length+1}let o=this.fieldPositions.map(l=>new Fd(l.field,s[l.line]+l.from,s[l.line]+l.to));return{text:i,ranges:o}}static parse(e){let t=[],i=[],s=[],r;for(let a of e.split(/\r\n?|\n/)){for(;r=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(a);){let o=r[1]?+r[1]:null,l=r[2]||r[3]||"",c=-1,u=l.replace(/\\[{}]/g,h=>h[1]);for(let h=0;h<t.length;h++)(o!=null?t[h].seq==o:u&&t[h].name==u)&&(c=h);if(c<0){let h=0;for(;h<t.length&&(o==null||t[h].seq!=null&&t[h].seq<o);)h++;t.splice(h,0,{seq:o,name:u}),c=h;for(let d of s)d.field>=c&&d.field++}for(let h of s)if(h.line==i.length&&h.from>r.index){let d=r[2]?3+(r[1]||"").length:2;h.from-=d,h.to-=d}s.push(new q2(c,i.length,r.index,r.index+u.length)),a=a.slice(0,r.index)+l+a.slice(r.index+r[0].length)}a=a.replace(/\\([{}])/g,(o,l,c)=>{for(let u of s)u.line==i.length&&u.from>c&&(u.from--,u.to--);return l}),i.push(a)}return new Rd(i,s)}}let W2=it.widget({widget:new class extends Hr{toDOM(){let n=document.createElement("span");return n.className="cm-snippetFieldPosition",n}ignoreEvent(){return!1}}}),X2=it.mark({class:"cm-snippetField"});class Yr{constructor(e,t){this.ranges=e,this.active=t,this.deco=it.set(e.map(i=>(i.from==i.to?W2:X2).range(i.from,i.to)),!0)}map(e){let t=[];for(let i of this.ranges){let s=i.map(e);if(!s)return null;t.push(s)}return new Yr(t,this.active)}selectionInsideField(e){return e.ranges.every(t=>this.ranges.some(i=>i.field==this.active&&i.from<=t.from&&i.to>=t.to))}}const so=xt.define({map(n,e){return n&&n.map(e)}}),H2=xt.define(),Ga=oi.define({create(){return null},update(n,e){for(let t of e.effects){if(t.is(so))return t.value;if(t.is(H2)&&n)return new Yr(n.ranges,t.value)}return n&&e.docChanged&&(n=n.map(e.changes)),n&&e.selection&&!n.selectionInsideField(e.selection)&&(n=null),n},provide:n=>Re.decorations.from(n,e=>e?e.deco:it.none)});function Id(n,e){return ce.create(n.filter(t=>t.field==e).map(t=>ce.range(t.from,t.to)))}function Y2(n){let e=Rd.parse(n);return(t,i,s,r)=>{let{text:a,ranges:o}=e.instantiate(t.state,s),{main:l}=t.state.selection,c={changes:{from:s,to:r==l.from?l.to:r,insert:gt.of(a)},scrollIntoView:!0,annotations:i?[G2.of(i),ln.userEvent.of("input.complete")]:void 0};if(o.length&&(c.selection=Id(o,0)),o.some(u=>u.field>0)){let u=new Yr(o,0),h=c.effects=[so.of(u)];t.state.field(Ga,!1)===void 0&&h.push(xt.appendConfig.of([Ga,nk,ik,U2]))}t.dispatch(t.state.update(c))}}function xO(n){return({state:e,dispatch:t})=>{let i=e.field(Ga,!1);if(!i||n<0&&i.active==0)return!1;let s=i.active+n,r=n>0&&!i.ranges.some(a=>a.field==s+n);return t(e.update({selection:Id(i.ranges,s),effects:so.of(r?null:new Yr(i.ranges,s)),scrollIntoView:!0})),!0}}const K2=({state:n,dispatch:e})=>n.field(Ga,!1)?(e(n.update({effects:so.of(null)})),!0):!1,J2=xO(1),ek=xO(-1),tk=[{key:"Tab",run:J2,shift:ek},{key:"Escape",run:K2}],am=Ie.define({combine(n){return n.length?n[0]:tk}}),nk=Ll.highest(Md.compute([am],n=>n.facet(am)));function qn(n,e){return{...e,apply:Y2(n)}}const ik=Re.domEventHandlers({mousedown(n,e){let t=e.state.field(Ga,!1),i;if(!t||(i=e.posAtCoords({x:n.clientX,y:n.clientY}))==null)return!1;let s=t.ranges.find(r=>r.from<=i&&r.to>=i);return!s||s.field==t.active?!1:(e.dispatch({selection:Id(t.ranges,s.field),effects:so.of(t.ranges.some(r=>r.field>s.field)?new Yr(t.ranges,s.field):null),scrollIntoView:!0}),!0)}}),Ua={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},ar=xt.define({map(n,e){let t=e.mapPos(n,-1,$n.TrackAfter);return t??void 0}}),Ld=new class extends pr{};Ld.startSide=1;Ld.endSide=-1;const EO=oi.define({create(){return St.empty},update(n,e){if(n=n.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);n=n.update({filter:i=>i>=t.from&&i<=t.to})}for(let t of e.effects)t.is(ar)&&(n=n.update({add:[Ld.range(t.value,t.value+1)]}));return n}});function sk(){return[ak,EO]}const Yu="()[]{}<>«»»«［］｛｝";function kO(n){for(let e=0;e<Yu.length;e+=2)if(Yu.charCodeAt(e)==n)return Yu.charAt(e+1);return Q0(n<128?n:n+1)}function MO(n,e){return n.languageDataAt("closeBrackets",e)[0]||Ua}const rk=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),ak=Re.inputHandler.of((n,e,t,i)=>{if((rk?n.composing:n.compositionStarted)||n.state.readOnly)return!1;let s=n.state.selection.main;if(i.length>2||i.length==2&&Ya(vr(i,0))==1||e!=s.from||t!=s.to)return!1;let r=uk(n.state,i);return r?(n.dispatch(r),!0):!1}),ok=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let i=MO(n,n.selection.main.head).brackets||Ua.brackets,s=null,r=n.changeByRange(a=>{if(a.empty){let o=ck(n.doc,a.head);for(let l of i)if(l==o&&Xl(n.doc,a.head)==kO(vr(l,0)))return{changes:{from:a.head-l.length,to:a.head+l.length},range:ce.cursor(a.head-l.length)}}return{range:s=a}});return s||e(n.update(r,{scrollIntoView:!0,userEvent:"delete.backward"})),!s},lk=[{key:"Backspace",run:ok}];function uk(n,e){let t=MO(n,n.selection.main.head),i=t.brackets||Ua.brackets;for(let s of i){let r=kO(vr(s,0));if(e==s)return r==s?fk(n,s,i.indexOf(s+s+s)>-1,t):hk(n,s,r,t.before||Ua.before);if(e==r&&DO(n,n.selection.main.from))return dk(n,s,r)}return null}function DO(n,e){let t=!1;return n.field(EO).between(0,n.doc.length,i=>{i==e&&(t=!0)}),t}function Xl(n,e){let t=n.sliceString(e,e+2);return t.slice(0,Ya(vr(t,0)))}function ck(n,e){let t=n.sliceString(e-2,e);return Ya(vr(t,0))==t.length?t:t.slice(1)}function hk(n,e,t,i){let s=null,r=n.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:t,from:a.to}],effects:ar.of(a.to+e.length),range:ce.range(a.anchor+e.length,a.head+e.length)};let o=Xl(n.doc,a.head);return!o||/\s/.test(o)||i.indexOf(o)>-1?{changes:{insert:e+t,from:a.head},effects:ar.of(a.head+e.length),range:ce.cursor(a.head+e.length)}:{range:s=a}});return s?null:n.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function dk(n,e,t){let i=null,s=n.changeByRange(r=>r.empty&&Xl(n.doc,r.head)==t?{changes:{from:r.head,to:r.head+t.length,insert:t},range:ce.cursor(r.head+t.length)}:i={range:r});return i?null:n.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function fk(n,e,t,i){let s=i.stringPrefixes||Ua.stringPrefixes,r=null,a=n.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:e,from:o.to}],effects:ar.of(o.to+e.length),range:ce.range(o.anchor+e.length,o.head+e.length)};let l=o.head,c=Xl(n.doc,l),u;if(c==e){if(om(n,l))return{changes:{insert:e+e,from:l},effects:ar.of(l+e.length),range:ce.cursor(l+e.length)};if(DO(n,l)){let d=t&&n.sliceDoc(l,l+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:l,to:l+d.length,insert:d},range:ce.cursor(l+d.length)}}}else{if(t&&n.sliceDoc(l-2*e.length,l)==e+e&&(u=lm(n,l-2*e.length,s))>-1&&om(n,u))return{changes:{insert:e+e+e+e,from:l},effects:ar.of(l+e.length),range:ce.cursor(l+e.length)};if(n.charCategorizer(l)(c)!=_n.Word&&lm(n,l,s)>-1&&!pk(n,l,e,s))return{changes:{insert:e+e,from:l},effects:ar.of(l+e.length),range:ce.cursor(l+e.length)}}return{range:r=o}});return r?null:n.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function om(n,e){let t=vn(n).resolveInner(e+1);return t.parent&&t.from==e}function pk(n,e,t,i){let s=vn(n).resolveInner(e,-1),r=i.reduce((a,o)=>Math.max(a,o.length),0);for(let a=0;a<5;a++){let o=n.sliceDoc(s.from,Math.min(s.to,s.from+t.length+r)),l=o.indexOf(t);if(!l||l>-1&&i.indexOf(o.slice(0,l))>-1){let u=s.firstChild;for(;u&&u.from==s.from&&u.to-u.from>t.length+l;){if(n.sliceDoc(u.to-t.length,u.to)==t)return!1;u=u.firstChild}return!0}let c=s.to==e&&s.parent;if(!c)break;s=c}return!1}function lm(n,e,t){let i=n.charCategorizer(e);if(i(n.sliceDoc(e-1,e))!=_n.Word)return e;for(let s of t){let r=e-s.length;if(n.sliceDoc(r,e)==s&&i(n.sliceDoc(r-1,r))!=_n.Word)return r}return-1}const $O=[qn("function ${name}(${params}) {\n	${}\n}",{label:"function",detail:"definition",type:"keyword"}),qn("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n	${}\n}",{label:"for",detail:"loop",type:"keyword"}),qn("for (let ${name} of ${collection}) {\n	${}\n}",{label:"for",detail:"of loop",type:"keyword"}),qn("do {\n	${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),qn("while (${}) {\n	${}\n}",{label:"while",detail:"loop",type:"keyword"}),qn(`try {
	\${}
} catch (\${error}) {
	\${}
}`,{label:"try",detail:"/ catch block",type:"keyword"}),qn("if (${}) {\n	${}\n}",{label:"if",detail:"block",type:"keyword"}),qn(`if (\${}) {
	\${}
} else {
	\${}
}`,{label:"if",detail:"/ else block",type:"keyword"}),qn(`class \${name} {
	constructor(\${params}) {
		\${}
	}
}`,{label:"class",detail:"definition",type:"keyword"}),qn('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),qn('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],mk=$O.concat([qn("interface ${name} {\n	${}\n}",{label:"interface",detail:"definition",type:"keyword"}),qn("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),qn("enum ${name} {\n	${}\n}",{label:"enum",detail:"definition",type:"keyword"})]),um=new nE,TO=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function ha(n){return(e,t)=>{let i=e.node.getChild("VariableDefinition");return i&&t(i,n),!0}}const gk=["FunctionDeclaration"],Ok={FunctionDeclaration:ha("function"),ClassDeclaration:ha("class"),ClassExpression:()=>!0,EnumDeclaration:ha("constant"),TypeAliasDeclaration:ha("type"),NamespaceDeclaration:ha("namespace"),VariableDefinition(n,e){n.matchContext(gk)||e(n,"variable")},TypeDefinition(n,e){e(n,"type")},__proto__:null};function _O(n,e){let t=um.get(e);if(t)return t;let i=[],s=!0;function r(a,o){let l=n.sliceString(a.from,a.to);i.push({label:l,type:o})}return e.cursor(mn.IncludeAnonymous).iterate(a=>{if(s)s=!1;else if(a.name){let o=Ok[a.name];if(o&&o(a,r)||TO.has(a.name))return!1}else if(a.to-a.from>8192){for(let o of _O(n,a.node))i.push(o);return!1}}),um.set(e,i),i}const cm=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/,NO=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName","JSXText","JSXAttributeValue","JSXOpenTag","JSXCloseTag","JSXSelfClosingTag",".","?."];function yk(n){let e=vn(n.state).resolveInner(n.pos,-1);if(NO.indexOf(e.name)>-1)return null;let t=e.name=="VariableName"||e.to-e.from<20&&cm.test(n.state.sliceDoc(e.from,e.to));if(!t&&!n.explicit)return null;let i=[];for(let s=e;s;s=s.parent)TO.has(s.name)&&(i=i.concat(_O(n.state.doc,s)));return{options:i,from:t?e.from:n.pos,validFor:cm}}const hr=gl.define({name:"javascript",parser:YE.configure({props:[dO.add({IfStatement:qu({except:/^\s*({|else\b)/}),TryStatement:qu({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:u2,SwitchBody:n=>{let e=n.textAfter,t=/^\s*\}/.test(e),i=/^\s*(case|default)\b/.test(e);return n.baseIndent+(t?0:i?1:2)*n.unit},Block:l2({closing:"}"}),ArrowFunction:n=>n.baseIndent+n.unit,"TemplateString BlockComment":()=>null,"Statement Property":qu({except:/^\s*{/}),JSXElement(n){let e=/^\s*<\//.test(n.textAfter);return n.lineIndent(n.node.from)+(e?0:n.unit)},JSXEscape(n){let e=/\s*\}/.test(n.textAfter);return n.lineIndent(n.node.from)+(e?0:n.unit)},"JSXOpenTag JSXSelfClosingTag"(n){return n.column(n.node.from)+n.unit}}),mO.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":h2,BlockComment(n){return{from:n.from+2,to:n.to-2}}})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),BO={test:n=>/^JSX/.test(n.name),facet:uO({commentTokens:{block:{open:"{/*",close:"*/}"}}})},bk=hr.configure({dialect:"ts"},"typescript"),vk=hr.configure({dialect:"jsx",props:[Nd.add(n=>n.isTop?[BO]:void 0)]}),Sk=hr.configure({dialect:"jsx ts",props:[Nd.add(n=>n.isTop?[BO]:void 0)]},"typescript");let FO=n=>({label:n,type:"keyword"});const RO="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(FO),wk=RO.concat(["declare","implements","private","protected","public"].map(FO));function Ck(n={}){let e=n.jsx?n.typescript?Sk:vk:n.typescript?bk:hr,t=n.typescript?mk.concat(wk):$O.concat(RO);return new e2(e,[hr.data.of({autocomplete:Z2(NO,j2(t))}),hr.data.of({autocomplete:yk}),n.jsx?xk:[]])}function Pk(n){for(;;){if(n.name=="JSXOpenTag"||n.name=="JSXSelfClosingTag"||n.name=="JSXFragmentTag")return n;if(n.name=="JSXEscape"||!n.parent)return null;n=n.parent}}function hm(n,e,t=n.length){for(let i=e==null?void 0:e.firstChild;i;i=i.nextSibling)if(i.name=="JSXIdentifier"||i.name=="JSXBuiltin"||i.name=="JSXNamespacedName"||i.name=="JSXMemberExpression")return n.sliceString(i.from,Math.min(i.to,t));return""}const Ak=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),xk=Re.inputHandler.of((n,e,t,i,s)=>{if((Ak?n.composing:n.compositionStarted)||n.state.readOnly||e!=t||i!=">"&&i!="/"||!hr.isActiveAt(n.state,e,-1))return!1;let r=s(),{state:a}=r,o=a.changeByRange(l=>{var c;let{head:u}=l,h=vn(a).resolveInner(u-1,-1),d;if(h.name=="JSXStartTag"&&(h=h.parent),!(a.doc.sliceString(u-1,u)!=i||h.name=="JSXAttributeValue"&&h.to>u)){if(i==">"&&h.name=="JSXFragmentTag")return{range:l,changes:{from:u,insert:"</>"}};if(i=="/"&&h.name=="JSXStartCloseTag"){let f=h.parent,m=f.parent;if(m&&f.from==u-2&&((d=hm(a.doc,m.firstChild,u))||((c=m.firstChild)===null||c===void 0?void 0:c.name)=="JSXFragmentTag")){let g=`${d}>`;return{range:ce.cursor(u+g.length,-1),changes:{from:u,insert:g}}}}else if(i==">"){let f=Pk(h);if(f&&f.name=="JSXOpenTag"&&!/^\/?>|^<\//.test(a.doc.sliceString(u,u+2))&&(d=hm(a.doc,f,u)))return{range:l,changes:{from:u,insert:`</${d}>`}}}}return{range:l}});return o.changes.empty?!1:(n.dispatch([r,a.update(o,{userEvent:"input.complete",scrollIntoView:!0})]),!0)}),Ek="#e5c07b",dm="#e06c75",kk="#56b6c2",Mk="#ffffff",Ko="#abb2bf",Rh="#7d8799",Dk="#61afef",$k="#98c379",fm="#d19a66",Tk="#c678dd",_k="#21252b",pm="#2c313a",mm="#282c34",Ku="#353a42",Nk="#3E4451",gm="#528bff",Bk=Re.theme({"&":{color:Ko,backgroundColor:mm},".cm-content":{caretColor:gm},".cm-cursor, .cm-dropCursor":{borderLeftColor:gm},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Nk},".cm-panels":{backgroundColor:_k,color:Ko},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:mm,color:Rh,border:"none"},".cm-activeLineGutter":{backgroundColor:pm},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:Ku},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Ku,borderBottomColor:Ku},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:pm,color:Ko}}},{dark:!0}),Fk=Wl.define([{tag:U.keyword,color:Tk},{tag:[U.name,U.deleted,U.character,U.propertyName,U.macroName],color:dm},{tag:[U.function(U.variableName),U.labelName],color:Dk},{tag:[U.color,U.constant(U.name),U.standard(U.name)],color:fm},{tag:[U.definition(U.name),U.separator],color:Ko},{tag:[U.typeName,U.className,U.number,U.changed,U.annotation,U.modifier,U.self,U.namespace],color:Ek},{tag:[U.operator,U.operatorKeyword,U.url,U.escape,U.regexp,U.link,U.special(U.string)],color:kk},{tag:[U.meta,U.comment],color:Rh},{tag:U.strong,fontWeight:"bold"},{tag:U.emphasis,fontStyle:"italic"},{tag:U.strikethrough,textDecoration:"line-through"},{tag:U.link,color:Rh,textDecoration:"underline"},{tag:U.heading,fontWeight:"bold",color:dm},{tag:[U.atom,U.bool,U.special(U.variableName)],color:fm},{tag:[U.processingInstruction,U.string,U.inserted],color:$k},{tag:U.invalid,color:Mk}]),Rk=[Bk,x2(Fk)],Ik=n=>{let{state:e}=n,t=e.doc.lineAt(e.selection.main.from),i=Vd(n.state,t.from);return i.line?Lk(n):i.block?Vk(n):!1};function Qd(n,e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let s=n(e,t);return s?(i(t.update(s)),!0):!1}}const Lk=Qd(Zk,0),Qk=Qd(IO,0),Vk=Qd((n,e)=>IO(n,e,jk(e)),0);function Vd(n,e){let t=n.languageDataAt("commentTokens",e,1);return t.length?t[0]:{}}const da=50;function zk(n,{open:e,close:t},i,s){let r=n.sliceDoc(i-da,i),a=n.sliceDoc(s,s+da),o=/\s*$/.exec(r)[0].length,l=/^\s*/.exec(a)[0].length,c=r.length-o;if(r.slice(c-e.length,c)==e&&a.slice(l,l+t.length)==t)return{open:{pos:i-o,margin:o&&1},close:{pos:s+l,margin:l&&1}};let u,h;s-i<=2*da?u=h=n.sliceDoc(i,s):(u=n.sliceDoc(i,i+da),h=n.sliceDoc(s-da,s));let d=/^\s*/.exec(u)[0].length,f=/\s*$/.exec(h)[0].length,m=h.length-f-t.length;return u.slice(d,d+e.length)==e&&h.slice(m,m+t.length)==t?{open:{pos:i+d+e.length,margin:/\s/.test(u.charAt(d+e.length))?1:0},close:{pos:s-f-t.length,margin:/\s/.test(h.charAt(m-1))?1:0}}:null}function jk(n){let e=[];for(let t of n.selection.ranges){let i=n.doc.lineAt(t.from),s=t.to<=i.to?i:n.doc.lineAt(t.to);s.from>i.from&&s.from==t.to&&(s=t.to==i.to+1?i:n.doc.lineAt(t.to-1));let r=e.length-1;r>=0&&e[r].to>i.from?e[r].to=s.to:e.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:s.to})}return e}function IO(n,e,t=e.selection.ranges){let i=t.map(r=>Vd(e,r.from).block);if(!i.every(r=>r))return null;let s=t.map((r,a)=>zk(e,i[a],r.from,r.to));if(n!=2&&!s.every(r=>r))return{changes:e.changes(t.map((r,a)=>s[a]?[]:[{from:r.from,insert:i[a].open+" "},{from:r.to,insert:" "+i[a].close}]))};if(n!=1&&s.some(r=>r)){let r=[];for(let a=0,o;a<s.length;a++)if(o=s[a]){let l=i[a],{open:c,close:u}=o;r.push({from:c.pos-l.open.length,to:c.pos+c.margin},{from:u.pos-u.margin,to:u.pos+l.close.length})}return{changes:r}}return null}function Zk(n,e,t=e.selection.ranges){let i=[],s=-1;for(let{from:r,to:a}of t){let o=i.length,l=1e9,c=Vd(e,r).line;if(c){for(let u=r;u<=a;){let h=e.doc.lineAt(u);if(h.from>s&&(r==a||a>h.from)){s=h.from;let d=/^\s*/.exec(h.text)[0].length,f=d==h.length,m=h.text.slice(d,d+c.length)==c?d:-1;d<h.text.length&&d<l&&(l=d),i.push({line:h,comment:m,token:c,indent:d,empty:f,single:!1})}u=h.to+1}if(l<1e9)for(let u=o;u<i.length;u++)i[u].indent<i[u].line.text.length&&(i[u].indent=l);i.length==o+1&&(i[o].single=!0)}}if(n!=2&&i.some(r=>r.comment<0&&(!r.empty||r.single))){let r=[];for(let{line:o,token:l,indent:c,empty:u,single:h}of i)(h||!u)&&r.push({from:o.from+c,insert:l+" "});let a=e.changes(r);return{changes:a,selection:e.selection.map(a,1)}}else if(n!=1&&i.some(r=>r.comment>=0)){let r=[];for(let{line:a,comment:o,token:l}of i)if(o>=0){let c=a.from+o,u=c+l.length;a.text[u-a.from]==" "&&u++,r.push({from:c,to:u})}return{changes:r}}return null}const Ih=Ps.define(),Gk=Ps.define(),Uk=Ie.define(),LO=Ie.define({combine(n){return Ka(n,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,s)=>e(i,s)||t(i,s)})}}),QO=oi.define({create(){return ss.empty},update(n,e){let t=e.state.facet(LO),i=e.annotation(Ih);if(i){let l=Yn.fromTransaction(e,i.selection),c=i.side,u=c==0?n.undone:n.done;return l?u=wl(u,u.length,t.minDepth,l):u=jO(u,e.startState.selection),new ss(c==0?i.rest:u,c==0?u:i.rest)}let s=e.annotation(Gk);if((s=="full"||s=="before")&&(n=n.isolate()),e.annotation(ln.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let r=Yn.fromTransaction(e),a=e.annotation(ln.time),o=e.annotation(ln.userEvent);return r?n=n.addChanges(r,a,o,t,e):e.selection&&(n=n.addSelection(e.startState.selection,a,o,t.newGroupDelay)),(s=="full"||s=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new ss(n.done.map(Yn.fromJSON),n.undone.map(Yn.fromJSON))}});function qk(n={}){return[QO,LO.of(n),Re.domEventHandlers({beforeinput(e,t){let i=e.inputType=="historyUndo"?VO:e.inputType=="historyRedo"?Lh:null;return i?(e.preventDefault(),i(t)):!1}})]}function Hl(n,e){return function({state:t,dispatch:i}){if(!e&&t.readOnly)return!1;let s=t.field(QO,!1);if(!s)return!1;let r=s.pop(n,t,e);return r?(i(r),!0):!1}}const VO=Hl(0,!1),Lh=Hl(1,!1),Wk=Hl(0,!0),Xk=Hl(1,!0);class Yn{constructor(e,t,i,s,r){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=s,this.selectionsAfter=r}setSelAfter(e){return new Yn(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(s=>s.toJSON())}}static fromJSON(e){return new Yn(e.changes&&pn.fromJSON(e.changes),[],e.mapped&&as.fromJSON(e.mapped),e.startSelection&&ce.fromJSON(e.startSelection),e.selectionsAfter.map(ce.fromJSON))}static fromTransaction(e,t){let i=yi;for(let s of e.startState.facet(Uk)){let r=s(e);r.length&&(i=i.concat(r))}return!i.length&&e.changes.empty?null:new Yn(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,yi)}static selection(e){return new Yn(void 0,yi,void 0,void 0,e)}}function wl(n,e,t,i){let s=e+1>t+20?e-t-1:0,r=n.slice(s,e);return r.push(i),r}function Hk(n,e){let t=[],i=!1;return n.iterChangedRanges((s,r)=>t.push(s,r)),e.iterChangedRanges((s,r,a,o)=>{for(let l=0;l<t.length;){let c=t[l++],u=t[l++];o>=c&&a<=u&&(i=!0)}}),i}function Yk(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((t,i)=>t.empty!=e.ranges[i].empty).length===0}function zO(n,e){return n.length?e.length?n.concat(e):n:e}const yi=[],Kk=200;function jO(n,e){if(n.length){let t=n[n.length-1],i=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-Kk));return i.length&&i[i.length-1].eq(e)?n:(i.push(e),wl(n,n.length-1,1e9,t.setSelAfter(i)))}else return[Yn.selection([e])]}function Jk(n){let e=n[n.length-1],t=n.slice();return t[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Ju(n,e){if(!n.length)return n;let t=n.length,i=yi;for(;t;){let s=eM(n[t-1],e,i);if(s.changes&&!s.changes.empty||s.effects.length){let r=n.slice(0,t);return r[t-1]=s,r}else e=s.mapped,t--,i=s.selectionsAfter}return i.length?[Yn.selection(i)]:yi}function eM(n,e,t){let i=zO(n.selectionsAfter.length?n.selectionsAfter.map(o=>o.map(e)):yi,t);if(!n.changes)return Yn.selection(i);let s=n.changes.map(e),r=e.mapDesc(n.changes,!0),a=n.mapped?n.mapped.composeDesc(r):r;return new Yn(s,xt.mapEffects(n.effects,e),a,n.startSelection.map(r),i)}const tM=/^(input\.type|delete)($|\.)/;class ss{constructor(e,t,i=0,s=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=s}isolate(){return this.prevTime?new ss(this.done,this.undone):this}addChanges(e,t,i,s,r){let a=this.done,o=a[a.length-1];return o&&o.changes&&!o.changes.empty&&e.changes&&(!i||tM.test(i))&&(!o.selectionsAfter.length&&t-this.prevTime<s.newGroupDelay&&s.joinToEvent(r,Hk(o.changes,e.changes))||i=="input.type.compose")?a=wl(a,a.length-1,s.minDepth,new Yn(e.changes.compose(o.changes),zO(xt.mapEffects(e.effects,o.changes),o.effects),o.mapped,o.startSelection,yi)):a=wl(a,a.length,s.minDepth,e),new ss(a,yi,t,i)}addSelection(e,t,i,s){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:yi;return r.length>0&&t-this.prevTime<s&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&Yk(r[r.length-1],e)?this:new ss(jO(this.done,e),this.undone,t,i)}addMapping(e){return new ss(Ju(this.done,e),Ju(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let s=e==0?this.done:this.undone;if(s.length==0)return null;let r=s[s.length-1],a=r.selectionsAfter[0]||t.selection;if(i&&r.selectionsAfter.length)return t.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:Ih.of({side:e,rest:Jk(s),selection:a}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let o=s.length==1?yi:s.slice(0,s.length-1);return r.mapped&&(o=Ju(o,r.mapped)),t.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:Ih.of({side:e,rest:o,selection:a}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}ss.empty=new ss(yi,yi);const nM=[{key:"Mod-z",run:VO,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Lh,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Lh,preventDefault:!0},{key:"Mod-u",run:Wk,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:Xk,preventDefault:!0}];function Kr(n,e){return ce.create(n.ranges.map(e),n.mainIndex)}function Li(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Qi({state:n,dispatch:e},t){let i=Kr(n.selection,t);return i.eq(n.selection,!0)?!1:(e(Li(n,i)),!0)}function Yl(n,e){return ce.cursor(e?n.to:n.from)}function ZO(n,e){return Qi(n,t=>t.empty?n.moveByChar(t,e):Yl(t,e))}function Nn(n){return n.textDirectionAt(n.state.selection.main.head)==gn.LTR}const GO=n=>ZO(n,!Nn(n)),UO=n=>ZO(n,Nn(n));function qO(n,e){return Qi(n,t=>t.empty?n.moveByGroup(t,e):Yl(t,e))}const iM=n=>qO(n,!Nn(n)),sM=n=>qO(n,Nn(n));function rM(n,e,t){if(e.type.prop(t))return!0;let i=e.to-e.from;return i&&(i>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function Kl(n,e,t){let i=vn(n).resolveInner(e.head),s=t?at.closedBy:at.openedBy;for(let l=e.head;;){let c=t?i.childAfter(l):i.childBefore(l);if(!c)break;rM(n,c,s)?i=c:l=t?c.to:c.from}let r=i.type.prop(s),a,o;return r&&(a=t?is(n,i.from,1):is(n,i.to,-1))&&a.matched?o=t?a.end.to:a.end.from:o=t?i.to:i.from,ce.cursor(o,t?-1:1)}const aM=n=>Qi(n,e=>Kl(n.state,e,!Nn(n))),oM=n=>Qi(n,e=>Kl(n.state,e,Nn(n)));function WO(n,e){return Qi(n,t=>{if(!t.empty)return Yl(t,e);let i=n.moveVertically(t,e);return i.head!=t.head?i:n.moveToLineBoundary(t,e)})}const XO=n=>WO(n,!1),HO=n=>WO(n,!0);function YO(n){let e=n.scrollDOM.clientHeight<n.scrollDOM.scrollHeight-2,t=0,i=0,s;if(e){for(let r of n.state.facet(Re.scrollMargins)){let a=r(n);a!=null&&a.top&&(t=Math.max(a==null?void 0:a.top,t)),a!=null&&a.bottom&&(i=Math.max(a==null?void 0:a.bottom,i))}s=n.scrollDOM.clientHeight-t-i}else s=(n.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:i,selfScroll:e,height:Math.max(n.defaultLineHeight,s-5)}}function KO(n,e){let t=YO(n),{state:i}=n,s=Kr(i.selection,a=>a.empty?n.moveVertically(a,e,t.height):Yl(a,e));if(s.eq(i.selection))return!1;let r;if(t.selfScroll){let a=n.coordsAtPos(i.selection.main.head),o=n.scrollDOM.getBoundingClientRect(),l=o.top+t.marginTop,c=o.bottom-t.marginBottom;a&&a.top>l&&a.bottom<c&&(r=Re.scrollIntoView(s.main.head,{y:"start",yMargin:a.top-l}))}return n.dispatch(Li(i,s),{effects:r}),!0}const Om=n=>KO(n,!1),Qh=n=>KO(n,!0);function Ws(n,e,t){let i=n.lineBlockAt(e.head),s=n.moveToLineBoundary(e,t);if(s.head==e.head&&s.head!=(t?i.to:i.from)&&(s=n.moveToLineBoundary(e,t,!1)),!t&&s.head==i.from&&i.length){let r=/^\s*/.exec(n.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;r&&e.head!=i.from+r&&(s=ce.cursor(i.from+r))}return s}const lM=n=>Qi(n,e=>Ws(n,e,!0)),uM=n=>Qi(n,e=>Ws(n,e,!1)),cM=n=>Qi(n,e=>Ws(n,e,!Nn(n))),hM=n=>Qi(n,e=>Ws(n,e,Nn(n))),dM=n=>Qi(n,e=>ce.cursor(n.lineBlockAt(e.head).from,1)),fM=n=>Qi(n,e=>ce.cursor(n.lineBlockAt(e.head).to,-1));function pM(n,e,t){let i=!1,s=Kr(n.selection,r=>{let a=is(n,r.head,-1)||is(n,r.head,1)||r.head>0&&is(n,r.head-1,1)||r.head<n.doc.length&&is(n,r.head+1,-1);if(!a||!a.end)return r;i=!0;let o=a.start.from==r.head?a.end.to:a.end.from;return ce.cursor(o)});return i?(e(Li(n,s)),!0):!1}const mM=({state:n,dispatch:e})=>pM(n,e);function wi(n,e){let t=Kr(n.state.selection,i=>{let s=e(i);return ce.range(i.anchor,s.head,s.goalColumn,s.bidiLevel||void 0)});return t.eq(n.state.selection)?!1:(n.dispatch(Li(n.state,t)),!0)}function JO(n,e){return wi(n,t=>n.moveByChar(t,e))}const ey=n=>JO(n,!Nn(n)),ty=n=>JO(n,Nn(n));function ny(n,e){return wi(n,t=>n.moveByGroup(t,e))}const gM=n=>ny(n,!Nn(n)),OM=n=>ny(n,Nn(n)),yM=n=>wi(n,e=>Kl(n.state,e,!Nn(n))),bM=n=>wi(n,e=>Kl(n.state,e,Nn(n)));function iy(n,e){return wi(n,t=>n.moveVertically(t,e))}const sy=n=>iy(n,!1),ry=n=>iy(n,!0);function ay(n,e){return wi(n,t=>n.moveVertically(t,e,YO(n).height))}const ym=n=>ay(n,!1),bm=n=>ay(n,!0),vM=n=>wi(n,e=>Ws(n,e,!0)),SM=n=>wi(n,e=>Ws(n,e,!1)),wM=n=>wi(n,e=>Ws(n,e,!Nn(n))),CM=n=>wi(n,e=>Ws(n,e,Nn(n))),PM=n=>wi(n,e=>ce.cursor(n.lineBlockAt(e.head).from)),AM=n=>wi(n,e=>ce.cursor(n.lineBlockAt(e.head).to)),vm=({state:n,dispatch:e})=>(e(Li(n,{anchor:0})),!0),Sm=({state:n,dispatch:e})=>(e(Li(n,{anchor:n.doc.length})),!0),wm=({state:n,dispatch:e})=>(e(Li(n,{anchor:n.selection.main.anchor,head:0})),!0),Cm=({state:n,dispatch:e})=>(e(Li(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),xM=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),EM=({state:n,dispatch:e})=>{let t=Jl(n).map(({from:i,to:s})=>ce.range(i,Math.min(s+1,n.doc.length)));return e(n.update({selection:ce.create(t),userEvent:"select"})),!0},kM=({state:n,dispatch:e})=>{let t=Kr(n.selection,i=>{let s=vn(n),r=s.resolveStack(i.from,1);if(i.empty){let a=s.resolveStack(i.from,-1);a.node.from>=r.node.from&&a.node.to<=r.node.to&&(r=a)}for(let a=r;a;a=a.next){let{node:o}=a;if((o.from<i.from&&o.to>=i.to||o.to>i.to&&o.from<=i.from)&&a.next)return ce.range(o.to,o.from)}return i});return t.eq(n.selection)?!1:(e(Li(n,t)),!0)};function oy(n,e){let{state:t}=n,i=t.selection,s=t.selection.ranges.slice();for(let r of t.selection.ranges){let a=t.doc.lineAt(r.head);if(e?a.to<n.state.doc.length:a.from>0)for(let o=r;;){let l=n.moveVertically(o,e);if(l.head<a.from||l.head>a.to){s.some(c=>c.head==l.head)||s.push(l);break}else{if(l.head==o.head)break;o=l}}}return s.length==i.ranges.length?!1:(n.dispatch(Li(t,ce.create(s,s.length-1))),!0)}const MM=n=>oy(n,!1),DM=n=>oy(n,!0),$M=({state:n,dispatch:e})=>{let t=n.selection,i=null;return t.ranges.length>1?i=ce.create([t.main]):t.main.empty||(i=ce.create([ce.cursor(t.main.head)])),i?(e(Li(n,i)),!0):!1};function ro(n,e){if(n.state.readOnly)return!1;let t="delete.selection",{state:i}=n,s=i.changeByRange(r=>{let{from:a,to:o}=r;if(a==o){let l=e(r);l<a?(t="delete.backward",l=$o(n,l,!1)):l>a&&(t="delete.forward",l=$o(n,l,!0)),a=Math.min(a,l),o=Math.max(o,l)}else a=$o(n,a,!1),o=$o(n,o,!0);return a==o?{range:r}:{changes:{from:a,to:o},range:ce.cursor(a,a<r.head?-1:1)}});return s.changes.empty?!1:(n.dispatch(i.update(s,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?Re.announce.of(i.phrase("Selection deleted")):void 0})),!0)}function $o(n,e,t){if(n instanceof Re)for(let i of n.state.facet(Re.atomicRanges).map(s=>s(n)))i.between(e,e,(s,r)=>{s<e&&r>e&&(e=t?r:s)});return e}const ly=(n,e,t)=>ro(n,i=>{let s=i.from,{state:r}=n,a=r.doc.lineAt(s),o,l;if(t&&!e&&s>a.from&&s<a.from+200&&!/[^ \t]/.test(o=a.text.slice(0,s-a.from))){if(o[o.length-1]=="	")return s-1;let c=Vl(o,r.tabSize),u=c%yl(r)||yl(r);for(let h=0;h<u&&o[o.length-1-h]==" ";h++)s--;l=s}else l=In(a.text,s-a.from,e,e)+a.from,l==s&&a.number!=(e?r.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(a.text.slice(l-a.from,s-a.from))&&(l=In(a.text,l-a.from,!1,!1)+a.from);return l}),Vh=n=>ly(n,!1,!0),uy=n=>ly(n,!0,!1),cy=(n,e)=>ro(n,t=>{let i=t.head,{state:s}=n,r=s.doc.lineAt(i),a=s.charCategorizer(i);for(let o=null;;){if(i==(e?r.to:r.from)){i==t.head&&r.number!=(e?s.doc.lines:1)&&(i+=e?1:-1);break}let l=In(r.text,i-r.from,e)+r.from,c=r.text.slice(Math.min(i,l)-r.from,Math.max(i,l)-r.from),u=a(c);if(o!=null&&u!=o)break;(c!=" "||i!=t.head)&&(o=u),i=l}return i}),hy=n=>cy(n,!1),TM=n=>cy(n,!0),_M=n=>ro(n,e=>{let t=n.lineBlockAt(e.head).to;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),NM=n=>ro(n,e=>{let t=n.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),BM=n=>ro(n,e=>{let t=n.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),FM=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:gt.of(["",""])},range:ce.cursor(i.from)}));return e(n.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},RM=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>{if(!i.empty||i.from==0||i.from==n.doc.length)return{range:i};let s=i.from,r=n.doc.lineAt(s),a=s==r.from?s-1:In(r.text,s-r.from,!1)+r.from,o=s==r.to?s+1:In(r.text,s-r.from,!0)+r.from;return{changes:{from:a,to:o,insert:n.doc.slice(s,o).append(n.doc.slice(a,s))},range:ce.cursor(o)}});return t.changes.empty?!1:(e(n.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Jl(n){let e=[],t=-1;for(let i of n.selection.ranges){let s=n.doc.lineAt(i.from),r=n.doc.lineAt(i.to);if(!i.empty&&i.to==r.from&&(r=n.doc.lineAt(i.to-1)),t>=s.number){let a=e[e.length-1];a.to=r.to,a.ranges.push(i)}else e.push({from:s.from,to:r.to,ranges:[i]});t=r.number+1}return e}function dy(n,e,t){if(n.readOnly)return!1;let i=[],s=[];for(let r of Jl(n)){if(t?r.to==n.doc.length:r.from==0)continue;let a=n.doc.lineAt(t?r.to+1:r.from-1),o=a.length+1;if(t){i.push({from:r.to,to:a.to},{from:r.from,insert:a.text+n.lineBreak});for(let l of r.ranges)s.push(ce.range(Math.min(n.doc.length,l.anchor+o),Math.min(n.doc.length,l.head+o)))}else{i.push({from:a.from,to:r.from},{from:r.to,insert:n.lineBreak+a.text});for(let l of r.ranges)s.push(ce.range(l.anchor-o,l.head-o))}}return i.length?(e(n.update({changes:i,scrollIntoView:!0,selection:ce.create(s,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const IM=({state:n,dispatch:e})=>dy(n,e,!1),LM=({state:n,dispatch:e})=>dy(n,e,!0);function fy(n,e,t){if(n.readOnly)return!1;let i=[];for(let s of Jl(n))t?i.push({from:s.from,insert:n.doc.slice(s.from,s.to)+n.lineBreak}):i.push({from:s.to,insert:n.lineBreak+n.doc.slice(s.from,s.to)});return e(n.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const QM=({state:n,dispatch:e})=>fy(n,e,!1),VM=({state:n,dispatch:e})=>fy(n,e,!0),zM=n=>{if(n.state.readOnly)return!1;let{state:e}=n,t=e.changes(Jl(e).map(({from:s,to:r})=>(s>0?s--:r<e.doc.length&&r++,{from:s,to:r}))),i=Kr(e.selection,s=>{let r;if(n.lineWrapping){let a=n.lineBlockAt(s.head),o=n.coordsAtPos(s.head,s.assoc||1);o&&(r=a.bottom+n.documentTop-o.bottom+n.defaultLineHeight/2)}return n.moveVertically(s,!0,r)}).map(t);return n.dispatch({changes:t,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function jM(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=vn(n).resolveInner(e),i=t.childBefore(e),s=t.childAfter(e),r;return i&&s&&i.to<=e&&s.from>=e&&(r=i.type.prop(at.closedBy))&&r.indexOf(s.name)>-1&&n.doc.lineAt(i.to).from==n.doc.lineAt(s.from).from&&!/\S/.test(n.sliceDoc(i.to,s.from))?{from:i.to,to:s.from}:null}const Pm=py(!1),ZM=py(!0);function py(n){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(s=>{let{from:r,to:a}=s,o=e.doc.lineAt(r),l=!n&&r==a&&jM(e,r);n&&(r=a=(a<=o.to?o:e.doc.lineAt(a)).to);let c=new Ul(e,{simulateBreak:r,simulateDoubleBreak:!!l}),u=hO(c,r);for(u==null&&(u=Vl(/^\s*/.exec(e.doc.lineAt(r).text)[0],e.tabSize));a<o.to&&/\s/.test(o.text[a-o.from]);)a++;l?{from:r,to:a}=l:r>o.from&&r<o.from+100&&!/\S/.test(o.text.slice(0,r))&&(r=o.from);let h=["",bl(e,u)];return l&&h.push(bl(e,c.lineIndent(o.from,-1))),{changes:{from:r,to:a,insert:gt.of(h)},range:ce.cursor(r+1+h[1].length)}});return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function zd(n,e){let t=-1;return n.changeByRange(i=>{let s=[];for(let a=i.from;a<=i.to;){let o=n.doc.lineAt(a);o.number>t&&(i.empty||i.to>o.from)&&(e(o,s,i),t=o.number),a=o.to+1}let r=n.changes(s);return{changes:s,range:ce.range(r.mapPos(i.anchor,1),r.mapPos(i.head,1))}})}const GM=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=Object.create(null),i=new Ul(n,{overrideIndentation:r=>{let a=t[r];return a??-1}}),s=zd(n,(r,a,o)=>{let l=hO(i,r.from);if(l==null)return;/\S/.test(r.text)||(l=0);let c=/^\s*/.exec(r.text)[0],u=bl(n,l);(c!=u||o.from<r.from+c.length)&&(t[r.from]=l,a.push({from:r.from,to:r.from+c.length,insert:u}))});return s.changes.empty||e(n.update(s,{userEvent:"indent"})),!0},UM=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(zd(n,(t,i)=>{i.push({from:t.from,insert:n.facet(Gl)})}),{userEvent:"input.indent"})),!0),qM=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(zd(n,(t,i)=>{let s=/^\s*/.exec(t.text)[0];if(!s)return;let r=Vl(s,n.tabSize),a=0,o=bl(n,Math.max(0,r-yl(n)));for(;a<s.length&&a<o.length&&s.charCodeAt(a)==o.charCodeAt(a);)a++;i.push({from:t.from+a,to:t.from+s.length,insert:o.slice(a)})}),{userEvent:"delete.dedent"})),!0),WM=n=>(n.setTabFocusMode(),!0),XM=[{key:"Ctrl-b",run:GO,shift:ey,preventDefault:!0},{key:"Ctrl-f",run:UO,shift:ty},{key:"Ctrl-p",run:XO,shift:sy},{key:"Ctrl-n",run:HO,shift:ry},{key:"Ctrl-a",run:dM,shift:PM},{key:"Ctrl-e",run:fM,shift:AM},{key:"Ctrl-d",run:uy},{key:"Ctrl-h",run:Vh},{key:"Ctrl-k",run:_M},{key:"Ctrl-Alt-h",run:hy},{key:"Ctrl-o",run:FM},{key:"Ctrl-t",run:RM},{key:"Ctrl-v",run:Qh}],HM=[{key:"ArrowLeft",run:GO,shift:ey,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:iM,shift:gM,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:cM,shift:wM,preventDefault:!0},{key:"ArrowRight",run:UO,shift:ty,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:sM,shift:OM,preventDefault:!0},{mac:"Cmd-ArrowRight",run:hM,shift:CM,preventDefault:!0},{key:"ArrowUp",run:XO,shift:sy,preventDefault:!0},{mac:"Cmd-ArrowUp",run:vm,shift:wm},{mac:"Ctrl-ArrowUp",run:Om,shift:ym},{key:"ArrowDown",run:HO,shift:ry,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Sm,shift:Cm},{mac:"Ctrl-ArrowDown",run:Qh,shift:bm},{key:"PageUp",run:Om,shift:ym},{key:"PageDown",run:Qh,shift:bm},{key:"Home",run:uM,shift:SM,preventDefault:!0},{key:"Mod-Home",run:vm,shift:wm},{key:"End",run:lM,shift:vM,preventDefault:!0},{key:"Mod-End",run:Sm,shift:Cm},{key:"Enter",run:Pm,shift:Pm},{key:"Mod-a",run:xM},{key:"Backspace",run:Vh,shift:Vh,preventDefault:!0},{key:"Delete",run:uy,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:hy,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:TM,preventDefault:!0},{mac:"Mod-Backspace",run:NM,preventDefault:!0},{mac:"Mod-Delete",run:BM,preventDefault:!0}].concat(XM.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),YM=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:aM,shift:yM},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:oM,shift:bM},{key:"Alt-ArrowUp",run:IM},{key:"Shift-Alt-ArrowUp",run:QM},{key:"Alt-ArrowDown",run:LM},{key:"Shift-Alt-ArrowDown",run:VM},{key:"Mod-Alt-ArrowUp",run:MM},{key:"Mod-Alt-ArrowDown",run:DM},{key:"Escape",run:$M},{key:"Mod-Enter",run:ZM},{key:"Alt-l",mac:"Ctrl-l",run:EM},{key:"Mod-i",run:kM,preventDefault:!0},{key:"Mod-[",run:qM},{key:"Mod-]",run:UM},{key:"Mod-Alt-\\",run:GM},{key:"Shift-Mod-k",run:zM},{key:"Shift-Mod-\\",run:mM},{key:"Mod-/",run:Ik},{key:"Alt-A",run:Qk},{key:"Ctrl-m",mac:"Shift-Alt-m",run:WM}].concat(HM),Am=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class my{constructor(e,t,i=0,s=e.length,r,a){this.test=a,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,s),this.bufferStart=i,this.normalize=r?o=>r(Am(o)):Am,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return vr(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Q0(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=Ya(e);let s=this.normalize(t);if(s.length)for(let r=0,a=i;;r++){let o=s.charCodeAt(r),l=this.match(o,a,this.bufferPos+this.bufferStart);if(r==s.length-1){if(l)return this.value=l,this;break}a==i&&r<t.length&&t.charCodeAt(r)==o&&a++}}}match(e,t,i){let s=null;for(let r=0;r<this.matches.length;r+=2){let a=this.matches[r],o=!1;this.query.charCodeAt(a)==e&&(a==this.query.length-1?s={from:this.matches[r+1],to:i}:(this.matches[r]++,o=!0)),o||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?s={from:t,to:i}:this.matches.push(1,t)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferStart)&&(s=null),s}}typeof Symbol<"u"&&(my.prototype[Symbol.iterator]=function(){return this});const KM={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},JM=Ie.define({combine(n){return Ka(n,KM,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function eD(n){return[rD,sD]}const tD=it.mark({class:"cm-selectionMatch"}),nD=it.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function xm(n,e,t,i){return(t==0||n(e.sliceDoc(t-1,t))!=_n.Word)&&(i==e.doc.length||n(e.sliceDoc(i,i+1))!=_n.Word)}function iD(n,e,t,i){return n(e.sliceDoc(t,t+1))==_n.Word&&n(e.sliceDoc(i-1,i))==_n.Word}const sD=hs.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.selectionSet||n.docChanged||n.viewportChanged)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=n.state.facet(JM),{state:t}=n,i=t.selection;if(i.ranges.length>1)return it.none;let s=i.main,r,a=null;if(s.empty){if(!e.highlightWordAroundCursor)return it.none;let l=t.wordAt(s.head);if(!l)return it.none;a=t.charCategorizer(s.head),r=t.sliceDoc(l.from,l.to)}else{let l=s.to-s.from;if(l<e.minSelectionLength||l>200)return it.none;if(e.wholeWords){if(r=t.sliceDoc(s.from,s.to),a=t.charCategorizer(s.head),!(xm(a,t,s.from,s.to)&&iD(a,t,s.from,s.to)))return it.none}else if(r=t.sliceDoc(s.from,s.to),!r)return it.none}let o=[];for(let l of n.visibleRanges){let c=new my(t.doc,r,l.from,l.to);for(;!c.next().done;){let{from:u,to:h}=c.value;if((!a||xm(a,t,u,h))&&(s.empty&&u<=s.from&&h>=s.to?o.push(nD.range(u,h)):(u>=s.to||h<=s.from)&&o.push(tD.range(u,h)),o.length>e.maxMatches))return it.none}}return it.set(o)}},{decorations:n=>n.decorations}),rD=Re.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),aD=new Map,oD=xt.define(),lD=oi.define({create(){return it.none},update(n,e){e.docChanged&&(n=n.map(e.changes));for(const t of e.effects)if(t.is(oD))return t.value;return n},provide:n=>Re.decorations.from(n)});it.mark({class:"cm-master-highlight"});function uD(n,e={}){const{theme:t="light",placeholder:i="",lineNumbers:s=!0,autofocus:r=!1,onUpdate:a=null}=e,o=n.value||"",l=[s?Rp():[],qk(),C2(),B2(),sk(),eD(),Md.of([...lk,...YM,...nM,...b2]),Ck(),Re.lineWrapping,Re.updateListener.of(u=>{if(u.docChanged&&a){const h=u.state.doc.toString();a(h)}if(u.docChanged){const h=u.state.doc.toString();n.value=h;const d=new Event("input",{bubbles:!0});n.dispatchEvent(d)}}),Re.contentAttributes.of({"data-placeholder":i}),Re.baseTheme({"&.cm-editor":{outline:"none",position:"relative",boxSizing:"border-box"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:"1.4",height:"100%",overflowX:"auto",position:"relative",zIndex:"0"},".cm-content":{margin:"0",flexGrow:"2",flexShrink:"0",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none",minHeight:"120px"},".cm-lineWrapping":{whiteSpace:"pre-wrap",overflowWrap:"anywhere"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-gutters":{flexShrink:"0",display:"flex",height:"100%",boxSizing:"border-box",left:"0",zIndex:"200"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:"0",boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",color:"#999",whiteSpace:"nowrap"}}),Re.theme({"&.cm-editor":{fontSize:"14px",fontFamily:"'Courier New', Courier, monospace",border:"1px solid rgba(102, 126, 234, 0.25)",borderRadius:"12px",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"inset 0 0 0 1px rgba(255, 255, 255, 0.5)",overflow:"hidden"},".cm-content":{minHeight:"120px",padding:"8px",caretColor:"#000"},".cm-focused":{outline:"none"},".cm-editor.cm-focused":{borderColor:"#667eea",backgroundColor:"#fff",boxShadow:"inset 0 0 0 1px rgba(255, 255, 255, 0.5), 0 0 0 2px rgba(102, 126, 234, 0.2)"},".cm-placeholder":{color:"#999",fontStyle:"italic"},".cm-gutters":{backgroundColor:"rgba(245, 245, 245, 0.5)",color:"#999",border:"none",borderRight:"1px solid rgba(102, 126, 234, 0.15)"}})];l.push(lD),t==="dark"&&l.push(Rk),Rp||l.push(Re.lineWrapping);let c;try{c=new Re({doc:o,extensions:l}),n.style.display="none",n.parentNode.insertBefore(c.dom,n),console.log(`   Editor DOM created and inserted for ${n.id||"textarea"}`)}catch(u){return console.error("❌ Error creating Strudel REPL editor:",u),console.error("   Error details:",u.message,u.stack),null}return c&&(c.getTextarea=()=>n,c.getValue=()=>c.state.doc.toString(),c.setValue=u=>{if(c.state.doc.toString()!==u){c.dispatch({changes:{from:0,to:c.state.doc.length,insert:u||""}}),n.value=u||"";const d=new Event("input",{bubbles:!0});n.dispatchEvent(d)}}),r&&c.focus(),c}function cD(){try{console.log("🎨 Initializing Strudel REPL editors...");const n=document.querySelectorAll("textarea[data-strudel-repl], #modal-pattern, #master-pattern");console.log(`   Found ${n.length} textareas to initialize:`,Array.from(n).map(e=>e.id||"unnamed")),n.forEach(e=>{if(e.tagName==="TEXTAREA"&&!e.dataset.strudelReplInitialized){const t=e.id==="modal-pattern",i=e.id==="master-pattern";console.log(`   Initializing editor for: ${e.id||"unnamed textarea"}`);const s=e.placeholder||"";try{const r=uD(e,{theme:"light",placeholder:s,lineNumbers:!0,autofocus:!1,onUpdate:a=>{e.value=a}});r?(e.dataset.strudelReplInitialized="true",e._strudelEditor=r,aD.set(e.id,r),console.log(`   ✅ Successfully created editor for ${e.id||"textarea"}`)):console.warn(`   ⚠️ Editor creation returned null for ${e.id||"textarea"}`)}catch(r){console.error(`   ❌ Error creating editor for ${e.id||"textarea"}:`,r)}}else e.dataset.strudelReplInitialized&&console.log(`   ⏭️ Skipping ${e.id||"unnamed"} - already initialized`)}),console.log("✅ Strudel REPL editors initialization complete")}catch(n){console.error("❌ Error initializing Strudel REPL editors:",n)}}function eu(n){const e=typeof n=="string"?document.getElementById(n):n;return e&&e._strudelEditor||null}function ft(n){const e=eu(n);if(e&&e.getValue)return e.getValue();const t=typeof n=="string"?document.getElementById(n):n;return t?t.value:""}function Mt(n,e){const t=eu(n);if(t&&t.setValue){t.setValue(e);return}const i=typeof n=="string"?document.getElementById(n):n;if(i){i.value=e;const s=new Event("input",{bubbles:!0});i.dispatchEvent(s)}}function hD(n,e){const t=eu(n),i=document.getElementById(n);t&&t.contentDOM&&(t.contentDOM.setAttribute("contenteditable",e?"true":"false"),t.dom.classList.toggle("cm-readonly",!e)),i&&(i.readOnly=!e,i.classList.toggle("pattern-editor-readonly",!e))}function Em(n,e,t={}){if(!e||typeof e!="string")return;const i=typeof t.cursorOffset=="number"?t.cursorOffset:null,s=eu(n);if(s){const f=s,{state:m}=f,g=m.selection.main,y=g.from,b=g.to,P=km(e,()=>{let v=y;for(;v>0;){const C=m.doc.sliceString(v-1,v);if(v-=1,!/\s/.test(C))return C}return""}),M=i!==null?i:P.endsWith("()")||P.endsWith("{}")?1:0;f.dispatch({changes:{from:y,to:b,insert:P},selection:ce.cursor(Math.max(y+P.length-M,0)),scrollIntoView:!0}),f.focus();return}const r=document.getElementById(n);if(!r)return;const a=typeof r.selectionStart=="number"?r.selectionStart:r.value.length,o=typeof r.selectionEnd=="number"?r.selectionEnd:r.value.length,l=r.value.slice(0,a),c=r.value.slice(o),u=km(e,()=>{let f=a;for(;f>0;){const m=r.value.charAt(f-1);if(f-=1,!/\s/.test(m))return m}return""});r.value=`${l}${u}${c}`;const h=i!==null?i:u.endsWith("()")||u.endsWith("{}")?1:0,d=Math.max(a+u.length-h,0);typeof r.setSelectionRange=="function"&&r.setSelectionRange(d,d),r.dispatchEvent(new Event("input",{bubbles:!0})),r.focus()}function km(n,e){if(!n||n.trimStart().startsWith(".")||/^\s/.test(n))return n;const i=typeof e=="function"?e():"";return!i||i==="."||/\s/.test(i)||/[\(\[\{,]/.test(i)?n:`.${n}`}function dD(n,e){function t(){this.constructor=n}t.prototype=e.prototype,n.prototype=new t}function qr(n,e,t,i){var s=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(s,qr.prototype),s.expected=e,s.found=t,s.location=i,s.name="SyntaxError",s}dD(qr,Error);function ec(n,e,t){return t=t||" ",n.length>e?n:(e-=n.length,t+=t.repeat(e),n+t.slice(0,e))}qr.prototype.format=function(n){var e="Error: "+this.message;if(this.location){var t=null,i;for(i=0;i<n.length;i++)if(n[i].source===this.location.source){t=n[i].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,r=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,a=this.location.source+":"+r.line+":"+r.column;if(t){var o=this.location.end,l=ec("",r.line.toString().length," "),c=t[s.line-1],u=s.line===o.line?o.column:c.length+1,h=u-s.column||1;e+=`
 --> `+a+`
`+l+` |
`+r.line+" | "+c+`
`+l+" | "+ec("",s.column-1," ")+ec("",h,"^")}else e+=`
 at `+a}return e};qr.buildMessage=function(n,e){var t={literal:function(c){return'"'+s(c.text)+'"'},class:function(c){var u=c.parts.map(function(h){return Array.isArray(h)?r(h[0])+"-"+r(h[1]):r(h)});return"["+(c.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function i(c){return c.charCodeAt(0).toString(16).toUpperCase()}function s(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function r(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function a(c){return t[c.type](c)}function o(c){var u=c.map(a),h,d;if(u.sort(),u.length>0){for(h=1,d=1;h<u.length;h++)u[h-1]!==u[h]&&(u[d]=u[h],d++);u.length=d}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}function l(c){return c?'"'+s(c)+'"':"end of input"}return"Expected "+o(n)+" but "+l(e)+" found."};function fD(n,e){e=e!==void 0?e:{};var t={},i=e.grammarSource,s={start:vt},r=vt,a=".",o="-",l="0",c=",",u="|",h="[",d="]",f="{",m="}",g="%",y="<",b=">",P="!",M="(",v=")",C="/",E="*",A="?",B=":",Z="..",q="^",X="struct",j="target",H="euclid",se="slow",oe="rotL",Pe="rotR",Me="fast",Be="scale",Ke="//",Ct="cat",yt="$",he="setcps",et="setbpm",pe="hush",Et=/^[1-9]/,Ze=/^[eE]/,ve=/^[+\-]/,Je=/^[0-9]/,Pt=/^[ \n\r\t\xA0]/,li=/^["']/,Bn=/^[#\--.0-9A-Z\^-_a-z~\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u09FC\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7B9\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD-\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,Lt=/^[@_]/,Sn=/^[^\n]/,ot=hn("number"),an=Ee(".",!1),ti=Vt([["1","9"]],!1,!1),Vi=Vt(["e","E"],!1,!1),ms=Vt(["+","-"],!1,!1),zi=Ee("-",!1),xs=Ee("0",!1),ji=Vt([["0","9"]],!1,!1),Zi=hn("whitespace"),ui=Vt([" ",`
`,"\r","	"," "],!1,!1),zn=Ee(",",!1),Ae=Ee("|",!1),Ut=Vt(['"',"'"],!1,!1),Le=hn('a letter, a number, "-", "#", ".", "^", "_"'),bt=Vt(["#",["-","."],["0","9"],["A","Z"],["^","_"],["a","z"],"~","ª","µ","º",["À","Ö"],["Ø","ö"],["ø","ˁ"],["ˆ","ˑ"],["ˠ","ˤ"],"ˬ","ˮ",["Ͱ","ʹ"],["Ͷ","ͷ"],["ͺ","ͽ"],"Ϳ","Ά",["Έ","Ί"],"Ό",["Ύ","Ρ"],["Σ","ϵ"],["Ϸ","ҁ"],["Ҋ","ԯ"],["Ա","Ֆ"],"ՙ",["ՠ","ֈ"],["א","ת"],["ׯ","ײ"],["ؠ","ي"],["ٮ","ٯ"],["ٱ","ۓ"],"ە",["ۥ","ۦ"],["ۮ","ۯ"],["ۺ","ۼ"],"ۿ","ܐ",["ܒ","ܯ"],["ݍ","ޥ"],"ޱ",["ߊ","ߪ"],["ߴ","ߵ"],"ߺ",["ࠀ","ࠕ"],"ࠚ","ࠤ","ࠨ",["ࡀ","ࡘ"],["ࡠ","ࡪ"],["ࢠ","ࢴ"],["ࢶ","ࢽ"],["ऄ","ह"],"ऽ","ॐ",["क़","ॡ"],["ॱ","ঀ"],["অ","ঌ"],["এ","ঐ"],["ও","ন"],["প","র"],"ল",["শ","হ"],"ঽ","ৎ",["ড়","ঢ়"],["য়","ৡ"],["ৰ","ৱ"],"ৼ",["ਅ","ਊ"],["ਏ","ਐ"],["ਓ","ਨ"],["ਪ","ਰ"],["ਲ","ਲ਼"],["ਵ","ਸ਼"],["ਸ","ਹ"],["ਖ਼","ੜ"],"ਫ਼",["ੲ","ੴ"],["અ","ઍ"],["એ","ઑ"],["ઓ","ન"],["પ","ર"],["લ","ળ"],["વ","હ"],"ઽ","ૐ",["ૠ","ૡ"],"ૹ",["ଅ","ଌ"],["ଏ","ଐ"],["ଓ","ନ"],["ପ","ର"],["ଲ","ଳ"],["ଵ","ହ"],"ଽ",["ଡ଼","ଢ଼"],["ୟ","ୡ"],"ୱ","ஃ",["அ","ஊ"],["எ","ஐ"],["ஒ","க"],["ங","ச"],"ஜ",["ஞ","ட"],["ண","த"],["ந","ப"],["ம","ஹ"],"ௐ",["అ","ఌ"],["ఎ","ఐ"],["ఒ","న"],["ప","హ"],"ఽ",["ౘ","ౚ"],["ౠ","ౡ"],"ಀ",["ಅ","ಌ"],["ಎ","ಐ"],["ಒ","ನ"],["ಪ","ಳ"],["ವ","ಹ"],"ಽ","ೞ",["ೠ","ೡ"],["ೱ","ೲ"],["അ","ഌ"],["എ","ഐ"],["ഒ","ഺ"],"ഽ","ൎ",["ൔ","ൖ"],["ൟ","ൡ"],["ൺ","ൿ"],["අ","ඖ"],["ක","න"],["ඳ","ර"],"ල",["ව","ෆ"],["ก","ะ"],["า","ำ"],["เ","ๆ"],["ກ","ຂ"],"ຄ",["ງ","ຈ"],"ຊ","ຍ",["ດ","ທ"],["ນ","ຟ"],["ມ","ຣ"],"ລ","ວ",["ສ","ຫ"],["ອ","ະ"],["າ","ຳ"],"ຽ",["ເ","ໄ"],"ໆ",["ໜ","ໟ"],"ༀ",["ཀ","ཇ"],["ཉ","ཬ"],["ྈ","ྌ"],["က","ဪ"],"ဿ",["ၐ","ၕ"],["ၚ","ၝ"],"ၡ",["ၥ","ၦ"],["ၮ","ၰ"],["ၵ","ႁ"],"ႎ",["Ⴀ","Ⴥ"],"Ⴧ","Ⴭ",["ა","ჺ"],["ჼ","ቈ"],["ቊ","ቍ"],["ቐ","ቖ"],"ቘ",["ቚ","ቝ"],["በ","ኈ"],["ኊ","ኍ"],["ነ","ኰ"],["ኲ","ኵ"],["ኸ","ኾ"],"ዀ",["ዂ","ዅ"],["ወ","ዖ"],["ዘ","ጐ"],["ጒ","ጕ"],["ጘ","ፚ"],["ᎀ","ᎏ"],["Ꭰ","Ᏽ"],["ᏸ","ᏽ"],["ᐁ","ᙬ"],["ᙯ","ᙿ"],["ᚁ","ᚚ"],["ᚠ","ᛪ"],["ᛮ","ᛸ"],["ᜀ","ᜌ"],["ᜎ","ᜑ"],["ᜠ","ᜱ"],["ᝀ","ᝑ"],["ᝠ","ᝬ"],["ᝮ","ᝰ"],["ក","ឳ"],"ៗ","ៜ",["ᠠ","ᡸ"],["ᢀ","ᢄ"],["ᢇ","ᢨ"],"ᢪ",["ᢰ","ᣵ"],["ᤀ","ᤞ"],["ᥐ","ᥭ"],["ᥰ","ᥴ"],["ᦀ","ᦫ"],["ᦰ","ᧉ"],["ᨀ","ᨖ"],["ᨠ","ᩔ"],"ᪧ",["ᬅ","ᬳ"],["ᭅ","ᭋ"],["ᮃ","ᮠ"],["ᮮ","ᮯ"],["ᮺ","ᯥ"],["ᰀ","ᰣ"],["ᱍ","ᱏ"],["ᱚ","ᱽ"],["ᲀ","ᲈ"],["Ა","Ჺ"],["Ჽ","Ჿ"],["ᳩ","ᳬ"],["ᳮ","ᳱ"],["ᳵ","ᳶ"],["ᴀ","ᶿ"],["Ḁ","ἕ"],["Ἐ","Ἕ"],["ἠ","ὅ"],["Ὀ","Ὅ"],["ὐ","ὗ"],"Ὑ","Ὓ","Ὕ",["Ὗ","ώ"],["ᾀ","ᾴ"],["ᾶ","ᾼ"],"ι",["ῂ","ῄ"],["ῆ","ῌ"],["ῐ","ΐ"],["ῖ","Ί"],["ῠ","Ῥ"],["ῲ","ῴ"],["ῶ","ῼ"],"ⁱ","ⁿ",["ₐ","ₜ"],"ℂ","ℇ",["ℊ","ℓ"],"ℕ",["ℙ","ℝ"],"ℤ","Ω","ℨ",["K","ℭ"],["ℯ","ℹ"],["ℼ","ℿ"],["ⅅ","ⅉ"],"ⅎ",["Ⅰ","ↈ"],["Ⰰ","Ⱞ"],["ⰰ","ⱞ"],["Ⱡ","ⳤ"],["Ⳬ","ⳮ"],["Ⳳ","ⳳ"],["ⴀ","ⴥ"],"ⴧ","ⴭ",["ⴰ","ⵧ"],"ⵯ",["ⶀ","ⶖ"],["ⶠ","ⶦ"],["ⶨ","ⶮ"],["ⶰ","ⶶ"],["ⶸ","ⶾ"],["ⷀ","ⷆ"],["ⷈ","ⷎ"],["ⷐ","ⷖ"],["ⷘ","ⷞ"],"ⸯ",["々","〇"],["〡","〩"],["〱","〵"],["〸","〼"],["ぁ","ゖ"],["ゝ","ゟ"],["ァ","ヺ"],["ー","ヿ"],["ㄅ","ㄯ"],["ㄱ","ㆎ"],["ㆠ","ㆺ"],["ㇰ","ㇿ"],["㐀","䶵"],["一","鿯"],["ꀀ","ꒌ"],["ꓐ","ꓽ"],["ꔀ","ꘌ"],["ꘐ","ꘟ"],["ꘪ","ꘫ"],["Ꙁ","ꙮ"],["ꙿ","ꚝ"],["ꚠ","ꛯ"],["ꜗ","ꜟ"],["Ꜣ","ꞈ"],["Ꞌ","ꞹ"],["ꟷ","ꠁ"],["ꠃ","ꠅ"],["ꠇ","ꠊ"],["ꠌ","ꠢ"],["ꡀ","ꡳ"],["ꢂ","ꢳ"],["ꣲ","ꣷ"],"ꣻ",["ꣽ","ꣾ"],["ꤊ","ꤥ"],["ꤰ","ꥆ"],["ꥠ","ꥼ"],["ꦄ","ꦲ"],"ꧏ",["ꧠ","ꧤ"],["ꧦ","ꧯ"],["ꧺ","ꧾ"],["ꨀ","ꨨ"],["ꩀ","ꩂ"],["ꩄ","ꩋ"],["ꩠ","ꩶ"],"ꩺ",["ꩾ","ꪯ"],"ꪱ",["ꪵ","ꪶ"],["ꪹ","ꪽ"],"ꫀ","ꫂ",["ꫛ","ꫝ"],["ꫠ","ꫪ"],["ꫲ","ꫴ"],["ꬁ","ꬆ"],["ꬉ","ꬎ"],["ꬑ","ꬖ"],["ꬠ","ꬦ"],["ꬨ","ꬮ"],["ꬰ","ꭚ"],["ꭜ","ꭥ"],["ꭰ","ꯢ"],["가","힣"],["ힰ","ퟆ"],["ퟋ","ퟻ"],["豈","舘"],["並","龎"],["ﬀ","ﬆ"],["ﬓ","ﬗ"],"יִ",["ײַ","ﬨ"],["שׁ","זּ"],["טּ","לּ"],"מּ",["נּ","סּ"],["ףּ","פּ"],["צּ","ﮱ"],["ﯓ","ﴽ"],["ﵐ","ﶏ"],["ﶒ","ﷇ"],["ﷰ","ﷻ"],["ﹰ","ﹴ"],["ﹶ","ﻼ"],["Ａ","Ｚ"],["ａ","ｚ"],["ｦ","ﾾ"],["ￂ","ￇ"],["ￊ","ￏ"],["ￒ","ￗ"],["ￚ","ￜ"]],!1,!1),tt=Ee("[",!1),ni=Ee("]",!1),Es=Ee("{",!1),wn=Ee("}",!1),ci=Ee("%",!1),jn=Ee("<",!1),$t=Ee(">",!1),Gi=Vt(["@","_"],!1,!1),ks=Ee("!",!1),wt=Ee("(",!1),dt=Ee(")",!1),Kt=Ee("/",!1),K=Ee("*",!1),te=Ee("?",!1),Y=Ee(":",!1),de=Ee("..",!1),p=Ee("^",!1),w=Ee("struct",!1),S=Ee("target",!1),x=Ee("euclid",!1),N=Ee("slow",!1),W=Ee("rotL",!1),J=Ee("rotR",!1),le=Ee("fast",!1),Ce=Ee("scale",!1),Ye=Ee("//",!1),lt=Vt([`
`],!0,!1),En=Ee("cat",!1),Zn=Ee("$",!1),Pi=Ee("setcps",!1),Ai=Ee("setbpm",!1),cn=Ee("hush",!1),lu=function(){return parseFloat(je())},Ui=function(O){const $=O.join("");return $==="."||$==="_"},wr=function(O){return new Zb(O.join(""))},ia=function(O){return O},uu=function(O,$){return O.arguments_.stepsPerCycle=$,O},Hs=function(O){return O},Cr=function(O){return O.arguments_.alignment="polymeter_slowcat",O},cu=function(O){return $=>$.options_.weight=($.options_.weight??1)+(O??2)-1},hu=function(O){return $=>{const I=($.options_.reps??1)+(O??2)-1;$.options_.reps=I,$.options_.ops=$.options_.ops.filter(ee=>ee.type_!=="replicate"),$.options_.ops.push({type_:"replicate",arguments_:{amount:I}}),$.options_.weight=I}},uo=function(O,$,I){return ee=>ee.options_.ops.push({type_:"bjorklund",arguments_:{pulse:O,step:$,rotation:I}})},co=function(O){return $=>$.options_.ops.push({type_:"stretch",arguments_:{amount:O,type:"slow"}})},D=function(O){return $=>$.options_.ops.push({type_:"stretch",arguments_:{amount:O,type:"fast"}})},T=function(O){return $=>$.options_.ops.push({type_:"degradeBy",arguments_:{amount:O,seed:pu++}})},_=function(O){return $=>$.options_.ops.push({type_:"tail",arguments_:{element:O}})},F=function(O){return $=>$.options_.ops.push({type_:"range",arguments_:{element:O}})},L=function(O,$){const I=new Ub(O,{ops:[],weight:1,reps:1});for(const ee of $)ee(I);return I},z=function(O,$){return new fo($,"fastcat",void 0,!!O)},Q=function(O){return{alignment:"stack",list:O}},G=function(O){return{alignment:"rand",list:O,seed:pu++}},re=function(O){return{alignment:"feet",list:O,seed:pu++}},Oe=function(O,$){return $&&$.list.length>0?new fo([O,...$.list],$.alignment,$.seed):O},ae=function(O,$){return new fo($?[O,...$.list]:[O],"polymeter")},fe=function(O){return O},Xe=function(O){return{name:"struct",args:{mini:O}}},qe=function(O){return{name:"target",args:{name:O}}},We=function(O,$,I){return{name:"bjorklund",args:{pulse:O,step:parseInt($)}}},$e=function(O){return{name:"stretch",args:{amount:O}}},me=function(O){return{name:"shift",args:{amount:"-"+O}}},ue=function(O){return{name:"shift",args:{amount:O}}},ze=function(O){return{name:"stretch",args:{amount:"1/"+O}}},Ue=function(O){return{name:"scale",args:{scale:O.join("")}}},mt=function(O,$){return $},rt=function(O,$){return $.unshift(O),new fo($,"slowcat")},st=function(O){return O},Tt=function(O,$){return new Gb(O.name,O.args,$)},Fe=function(O){return O},Qt=function(O){return O},_t=function(O){return new fu("setcps",{value:O})},xe=function(O){return new fu("setcps",{value:O/120/2})},Nt=function(){return new fu("hush")},R=e.peg$currPos|0,Te=R,Jt=[{line:1,column:1}],kt=R,ut=e.peg$maxFailExpected||[],ie=e.peg$silentFails|0,Bt;if(e.startRule){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');r=s[e.startRule]}function je(){return n.substring(Te,R)}function ct(){return Ge(Te,R)}function Ee(O,$){return{type:"literal",text:O,ignoreCase:$}}function Vt(O,$,I){return{type:"class",parts:O,inverted:$,ignoreCase:I}}function Ft(){return{type:"end"}}function hn(O){return{type:"other",description:O}}function qt(O){var $=Jt[O],I;if($)return $;if(O>=Jt.length)I=Jt.length-1;else for(I=O;!Jt[--I];);for($=Jt[I],$={line:$.line,column:$.column};I<O;)n.charCodeAt(I)===10?($.line++,$.column=1):$.column++,I++;return Jt[O]=$,$}function Ge(O,$,I){var ee=qt(O),Qe=qt($),Xt={source:i,start:{offset:O,line:ee.line,column:ee.column},end:{offset:$,line:Qe.line,column:Qe.column}};return Xt}function ge(O){R<kt||(R>kt&&(kt=R,ut=[]),ut.push(O))}function hi(O,$,I){return new qr(qr.buildMessage(O,$),O,$,I)}function vt(){var O;return O=jb(),O}function Rt(){var O,$;return ie++,O=R,fn(),$=dn(),$!==t?(xi(),Ys(),Te=O,O=lu()):(R=O,O=t),ie--,O===t&&ie===0&&ge(ot),O}function Ms(){var O;return n.charCodeAt(R)===46?(O=a,R++):(O=t,ie===0&&ge(an)),O}function Pr(){var O;return O=n.charAt(R),Et.test(O)?R++:(O=t,ie===0&&ge(ti)),O}function en(){var O;return O=n.charAt(R),Ze.test(O)?R++:(O=t,ie===0&&ge(Vi)),O}function Ys(){var O,$,I,ee,Qe;if(O=R,$=en(),$!==t){if(I=n.charAt(R),ve.test(I)?R++:(I=t,ie===0&&ge(ms)),I===t&&(I=null),ee=[],Qe=nn(),Qe!==t)for(;Qe!==t;)ee.push(Qe),Qe=nn();else ee=t;ee!==t?($=[$,I,ee],O=$):(R=O,O=t)}else R=O,O=t;return O}function xi(){var O,$,I,ee;if(O=R,$=Ms(),$!==t){if(I=[],ee=nn(),ee!==t)for(;ee!==t;)I.push(ee),ee=nn();else I=t;I!==t?($=[$,I],O=$):(R=O,O=t)}else R=O,O=t;return O}function dn(){var O,$,I,ee;if(O=di(),O===t)if(O=R,$=Pr(),$!==t){for(I=[],ee=nn();ee!==t;)I.push(ee),ee=nn();$=[$,I],O=$}else R=O,O=t;return O}function fn(){var O;return n.charCodeAt(R)===45?(O=o,R++):(O=t,ie===0&&ge(zi)),O}function di(){var O;return n.charCodeAt(R)===48?(O=l,R++):(O=t,ie===0&&ge(xs)),O}function nn(){var O;return O=n.charAt(R),Je.test(O)?R++:(O=t,ie===0&&ge(ji)),O}function De(){var O,$;for(ie++,O=[],$=n.charAt(R),Pt.test($)?R++:($=t,ie===0&&ge(ui));$!==t;)O.push($),$=n.charAt(R),Pt.test($)?R++:($=t,ie===0&&ge(ui));return ie--,$=t,ie===0&&ge(Zi),O}function Wt(){var O,$,I,ee;return O=R,$=De(),n.charCodeAt(R)===44?(I=c,R++):(I=t,ie===0&&ge(zn)),I!==t?(ee=De(),$=[$,I,ee],O=$):(R=O,O=t),O}function Fn(){var O,$,I,ee;return O=R,$=De(),n.charCodeAt(R)===124?(I=u,R++):(I=t,ie===0&&ge(Ae)),I!==t?(ee=De(),$=[$,I,ee],O=$):(R=O,O=t),O}function Ds(){var O,$,I,ee;return O=R,$=De(),n.charCodeAt(R)===46?(I=a,R++):(I=t,ie===0&&ge(an)),I!==t?(ee=De(),$=[$,I,ee],O=$):(R=O,O=t),O}function Ar(){var O;return O=n.charAt(R),li.test(O)?R++:(O=t,ie===0&&ge(Ut)),O}function ho(){var O;return ie++,O=n.charAt(R),Bn.test(O)?R++:(O=t,ie===0&&ge(bt)),ie--,O===t&&ie===0&&ge(Le),O}function Jd(){var O,$,I,ee;if(O=R,De(),$=[],I=ho(),I!==t)for(;I!==t;)$.push(I),I=ho();else $=t;return $!==t?(I=De(),Te=R,ee=Ui($),ee?ee=t:ee=void 0,ee!==t?(Te=O,O=wr($)):(R=O,O=t)):(R=O,O=t),O}function hb(){var O,$,I,ee;return O=R,De(),n.charCodeAt(R)===91?($=h,R++):($=t,ie===0&&ge(tt)),$!==t?(De(),I=nf(),I!==t?(De(),n.charCodeAt(R)===93?(ee=d,R++):(ee=t,ie===0&&ge(ni)),ee!==t?(De(),Te=O,O=ia(I)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t),O}function db(){var O,$,I,ee,Qe;return O=R,De(),n.charCodeAt(R)===123?($=f,R++):($=t,ie===0&&ge(Es)),$!==t?(De(),I=sf(),I!==t?(De(),n.charCodeAt(R)===125?(ee=m,R++):(ee=t,ie===0&&ge(wn)),ee!==t?(Qe=fb(),Qe===t&&(Qe=null),De(),Te=O,O=uu(I,Qe)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t),O}function fb(){var O,$,I;return O=R,n.charCodeAt(R)===37?($=g,R++):($=t,ie===0&&ge(ci)),$!==t?(I=xr(),I!==t?(Te=O,O=Hs(I)):(R=O,O=t)):(R=O,O=t),O}function pb(){var O,$,I,ee;return O=R,De(),n.charCodeAt(R)===60?($=y,R++):($=t,ie===0&&ge(jn)),$!==t?(De(),I=sf(),I!==t?(De(),n.charCodeAt(R)===62?(ee=b,R++):(ee=t,ie===0&&ge($t)),ee!==t?(De(),Te=O,O=Cr(I)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t),O}function xr(){var O;return O=Jd(),O===t&&(O=hb(),O===t&&(O=db(),O===t&&(O=pb()))),O}function ef(){var O;return O=mb(),O===t&&(O=Ob(),O===t&&(O=yb(),O===t&&(O=bb(),O===t&&(O=gb(),O===t&&(O=vb(),O===t&&(O=Sb(),O===t&&(O=wb()))))))),O}function mb(){var O,$,I;return O=R,De(),$=n.charAt(R),Lt.test($)?R++:($=t,ie===0&&ge(Gi)),$!==t?(I=Rt(),I===t&&(I=null),Te=O,O=cu(I)):(R=O,O=t),O}function gb(){var O,$,I;return O=R,De(),n.charCodeAt(R)===33?($=P,R++):($=t,ie===0&&ge(ks)),$!==t?(I=Rt(),I===t&&(I=null),Te=O,O=hu(I)):(R=O,O=t),O}function Ob(){var O,$,I,ee,Qe,Xt,Ei;return O=R,n.charCodeAt(R)===40?($=M,R++):($=t,ie===0&&ge(wt)),$!==t?(De(),I=sa(),I!==t?(De(),ee=Wt(),ee!==t?(De(),Qe=sa(),Qe!==t?(De(),Wt(),De(),Xt=sa(),Xt===t&&(Xt=null),De(),n.charCodeAt(R)===41?(Ei=v,R++):(Ei=t,ie===0&&ge(dt)),Ei!==t?(Te=O,O=uo(I,Qe,Xt)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t),O}function yb(){var O,$,I;return O=R,n.charCodeAt(R)===47?($=C,R++):($=t,ie===0&&ge(Kt)),$!==t?(I=xr(),I!==t?(Te=O,O=co(I)):(R=O,O=t)):(R=O,O=t),O}function bb(){var O,$,I;return O=R,n.charCodeAt(R)===42?($=E,R++):($=t,ie===0&&ge(K)),$!==t?(I=xr(),I!==t?(Te=O,O=D(I)):(R=O,O=t)):(R=O,O=t),O}function vb(){var O,$,I;return O=R,n.charCodeAt(R)===63?($=A,R++):($=t,ie===0&&ge(te)),$!==t?(I=Rt(),I===t&&(I=null),Te=O,O=T(I)):(R=O,O=t),O}function Sb(){var O,$,I;return O=R,n.charCodeAt(R)===58?($=B,R++):($=t,ie===0&&ge(Y)),$!==t?(I=xr(),I!==t?(Te=O,O=_(I)):(R=O,O=t)):(R=O,O=t),O}function wb(){var O,$,I;return O=R,n.substr(R,2)===Z?($=Z,R+=2):($=t,ie===0&&ge(de)),$!==t?(I=xr(),I!==t?(Te=O,O=F(I)):(R=O,O=t)):(R=O,O=t),O}function sa(){var O,$,I,ee;if(O=R,$=xr(),$!==t){for(I=[],ee=ef();ee!==t;)I.push(ee),ee=ef();Te=O,O=L($,I)}else R=O,O=t;return O}function $s(){var O,$,I,ee;if(O=R,n.charCodeAt(R)===94?($=q,R++):($=t,ie===0&&ge(p)),$===t&&($=null),I=[],ee=sa(),ee!==t)for(;ee!==t;)I.push(ee),ee=sa();else I=t;return I!==t?(Te=O,O=z($,I)):(R=O,O=t),O}function tf(){var O,$,I,ee,Qe;if(O=R,$=[],I=R,ee=Wt(),ee!==t?(Qe=$s(),Qe!==t?I=Qe:(R=I,I=t)):(R=I,I=t),I!==t)for(;I!==t;)$.push(I),I=R,ee=Wt(),ee!==t?(Qe=$s(),Qe!==t?I=Qe:(R=I,I=t)):(R=I,I=t);else $=t;return $!==t&&(Te=O,$=Q($)),O=$,O}function Cb(){var O,$,I,ee,Qe;if(O=R,$=[],I=R,ee=Fn(),ee!==t?(Qe=$s(),Qe!==t?I=Qe:(R=I,I=t)):(R=I,I=t),I!==t)for(;I!==t;)$.push(I),I=R,ee=Fn(),ee!==t?(Qe=$s(),Qe!==t?I=Qe:(R=I,I=t)):(R=I,I=t);else $=t;return $!==t&&(Te=O,$=G($)),O=$,O}function Pb(){var O,$,I,ee,Qe;if(O=R,$=[],I=R,ee=Ds(),ee!==t?(Qe=$s(),Qe!==t?I=Qe:(R=I,I=t)):(R=I,I=t),I!==t)for(;I!==t;)$.push(I),I=R,ee=Ds(),ee!==t?(Qe=$s(),Qe!==t?I=Qe:(R=I,I=t)):(R=I,I=t);else $=t;return $!==t&&(Te=O,$=re($)),O=$,O}function nf(){var O,$,I;return O=R,$=$s(),$!==t?(I=tf(),I===t&&(I=Cb(),I===t&&(I=Pb())),I===t&&(I=null),Te=O,O=Oe($,I)):(R=O,O=t),O}function sf(){var O,$,I;return O=R,$=$s(),$!==t?(I=tf(),I===t&&(I=null),Te=O,O=ae($,I)):(R=O,O=t),O}function Ab(){var O,$,I,ee;return O=R,De(),$=Ar(),$!==t?(De(),I=nf(),I!==t?(De(),ee=Ar(),ee!==t?(Te=O,O=fe(I)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t),O}function xb(){var O;return O=Nb(),O===t&&(O=Db(),O===t&&(O=_b(),O===t&&(O=kb(),O===t&&(O=Mb(),O===t&&(O=Eb(),O===t&&(O=Tb(),O===t&&(O=$b()))))))),O}function Eb(){var O,$,I;return O=R,n.substr(R,6)===X?($=X,R+=6):($=t,ie===0&&ge(w)),$!==t?(De(),I=Er(),I!==t?(Te=O,O=Xe(I)):(R=O,O=t)):(R=O,O=t),O}function kb(){var O,$,I,ee,Qe;return O=R,n.substr(R,6)===j?($=j,R+=6):($=t,ie===0&&ge(S)),$!==t?(De(),I=Ar(),I!==t?(ee=Jd(),ee!==t?(Qe=Ar(),Qe!==t?(Te=O,O=qe(ee)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t),O}function Mb(){var O,$,I,ee;return O=R,n.substr(R,6)===H?($=H,R+=6):($=t,ie===0&&ge(x)),$!==t?(De(),I=dn(),I!==t?(De(),ee=dn(),ee!==t?(De(),dn(),Te=O,O=We(I,ee)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t),O}function Db(){var O,$,I;return O=R,n.substr(R,4)===se?($=se,R+=4):($=t,ie===0&&ge(N)),$!==t?(De(),I=Rt(),I!==t?(Te=O,O=$e(I)):(R=O,O=t)):(R=O,O=t),O}function $b(){var O,$,I;return O=R,n.substr(R,4)===oe?($=oe,R+=4):($=t,ie===0&&ge(W)),$!==t?(De(),I=Rt(),I!==t?(Te=O,O=me(I)):(R=O,O=t)):(R=O,O=t),O}function Tb(){var O,$,I;return O=R,n.substr(R,4)===Pe?($=Pe,R+=4):($=t,ie===0&&ge(J)),$!==t?(De(),I=Rt(),I!==t?(Te=O,O=ue(I)):(R=O,O=t)):(R=O,O=t),O}function _b(){var O,$,I;return O=R,n.substr(R,4)===Me?($=Me,R+=4):($=t,ie===0&&ge(le)),$!==t?(De(),I=Rt(),I!==t?(Te=O,O=ze(I)):(R=O,O=t)):(R=O,O=t),O}function Nb(){var O,$,I,ee,Qe;if(O=R,n.substr(R,5)===Be?($=Be,R+=5):($=t,ie===0&&ge(Ce)),$!==t)if(De(),I=Ar(),I!==t){if(ee=[],Qe=ho(),Qe!==t)for(;Qe!==t;)ee.push(Qe),Qe=ho();else ee=t;ee!==t?(Qe=Ar(),Qe!==t?(Te=O,O=Ue(ee)):(R=O,O=t)):(R=O,O=t)}else R=O,O=t;else R=O,O=t;return O}function du(){var O,$,I,ee;if(O=R,n.substr(R,2)===Ke?($=Ke,R+=2):($=t,ie===0&&ge(Ye)),$!==t){for(I=[],ee=n.charAt(R),Sn.test(ee)?R++:(ee=t,ie===0&&ge(lt));ee!==t;)I.push(ee),ee=n.charAt(R),Sn.test(ee)?R++:(ee=t,ie===0&&ge(lt));$=[$,I],O=$}else R=O,O=t;return O}function Bb(){var O,$,I,ee,Qe,Xt,Ei,kr;if(O=R,n.substr(R,3)===Ct?($=Ct,R+=3):($=t,ie===0&&ge(En)),$!==t)if(De(),n.charCodeAt(R)===91?(I=h,R++):(I=t,ie===0&&ge(tt)),I!==t)if(De(),ee=Er(),ee!==t){for(Qe=[],Xt=R,Ei=Wt(),Ei!==t?(kr=Er(),kr!==t?(Te=Xt,Xt=mt(ee,kr)):(R=Xt,Xt=t)):(R=Xt,Xt=t);Xt!==t;)Qe.push(Xt),Xt=R,Ei=Wt(),Ei!==t?(kr=Er(),kr!==t?(Te=Xt,Xt=mt(ee,kr)):(R=Xt,Xt=t)):(R=Xt,Xt=t);Xt=De(),n.charCodeAt(R)===93?(Ei=d,R++):(Ei=t,ie===0&&ge(ni)),Ei!==t?(Te=O,O=rt(ee,Qe)):(R=O,O=t)}else R=O,O=t;else R=O,O=t;else R=O,O=t;return O}function Fb(){var O;return O=Bb(),O===t&&(O=Ab()),O}function Er(){var O,$,I,ee,Qe;if(O=R,$=Fb(),$!==t){for(De(),I=[],ee=du();ee!==t;)I.push(ee),ee=du();Te=O,O=st($)}else R=O,O=t;return O===t&&(O=R,$=xb(),$!==t?(De(),n.charCodeAt(R)===36?(I=yt,R++):(I=t,ie===0&&ge(Zn)),I!==t?(ee=De(),Qe=Er(),Qe!==t?(Te=O,O=Tt($,Qe)):(R=O,O=t)):(R=O,O=t)):(R=O,O=t)),O}function Rb(){var O,$;return O=R,$=Er(),$!==t&&(Te=O,$=Fe($)),O=$,O===t&&(O=du()),O}function Ib(){var O;return O=Rb(),O}function Lb(){var O,$;return O=R,De(),$=Qb(),$===t&&($=Vb(),$===t&&($=zb())),$!==t?(De(),Te=O,O=Qt($)):(R=O,O=t),O}function Qb(){var O,$,I;return O=R,n.substr(R,6)===he?($=he,R+=6):($=t,ie===0&&ge(Pi)),$!==t?(De(),I=Rt(),I!==t?(Te=O,O=_t(I)):(R=O,O=t)):(R=O,O=t),O}function Vb(){var O,$,I;return O=R,n.substr(R,6)===et?($=et,R+=6):($=t,ie===0&&ge(Ai)),$!==t?(De(),I=Rt(),I!==t?(Te=O,O=xe(I)):(R=O,O=t)):(R=O,O=t),O}function zb(){var O,$;return O=R,n.substr(R,4)===pe?($=pe,R+=4):($=t,ie===0&&ge(cn)),$!==t&&(Te=O,$=Nt()),O=$,O}function jb(){var O;return O=Ib(),O===t&&(O=Lb()),O}var Zb=function(O){this.type_="atom",this.source_=O,this.location_=ct()},fo=function(O,$,I,ee){this.type_="pattern",this.arguments_={alignment:$,_steps:ee},I!==void 0&&(this.arguments_.seed=I),this.source_=O},Gb=function(O,$,I){this.type_=O,this.arguments_=$,this.source_=I},Ub=function(O,$){this.type_="element",this.source_=O,this.options_=$,this.location_=ct()},fu=function(O,$){this.type_="command",this.name_=O,this.options_=$},pu=0;if(Bt=r(),e.peg$library)return{peg$result:Bt,peg$currPos:R,peg$FAILED:t,peg$maxFailExpected:ut,peg$maxFailPos:kt};if(Bt!==t&&R===n.length)return Bt;throw Bt!==t&&R<n.length&&ge(Ft()),hi(ut,kt<n.length?n.charAt(kt):null,kt<n.length?Ge(kt,kt+1):Ge(kt,kt))}typeof BigInt>"u"&&(BigInt=function(n){if(isNaN(n))throw new Error("");return n});const Ve=BigInt(0),nt=BigInt(1),qa=BigInt(2),zh=BigInt(5),Hn=BigInt(10),pD=2e3,we={s:nt,n:Ve,d:nt};function gs(n,e){try{n=BigInt(n)}catch{throw Ts()}return n*e}function ki(n){return typeof n=="bigint"?n:Math.floor(n)}function Ht(n,e){if(e===Ve)throw jd();const t=Object.create(Gt.prototype);t.s=n<Ve?-nt:nt,n=n<Ve?-n:n;const i=nr(n,e);return t.n=n/i,t.d=e/i,t}function Mr(n){const e={};let t=n,i=qa,s=zh-nt;for(;s<=t;){for(;t%i===Ve;)t/=i,e[i]=(e[i]||Ve)+nt;s+=nt+qa*i++}return t!==n?t>1&&(e[t]=(e[t]||Ve)+nt):e[n]=(e[n]||Ve)+nt,e}const bn=function(n,e){let t=Ve,i=nt,s=nt;if(n!=null)if(e!==void 0){if(typeof n=="bigint")t=n;else{if(isNaN(n))throw Ts();if(n%1!==0)throw Mm();t=BigInt(n)}if(typeof e=="bigint")i=e;else{if(isNaN(e))throw Ts();if(e%1!==0)throw Mm();i=BigInt(e)}s=t*i}else if(typeof n=="object"){if("d"in n&&"n"in n)t=BigInt(n.n),i=BigInt(n.d),"s"in n&&(t*=BigInt(n.s));else if(0 in n)t=BigInt(n[0]),1 in n&&(i=BigInt(n[1]));else if(typeof n=="bigint")t=n;else throw Ts();s=t*i}else if(typeof n=="number"){if(isNaN(n))throw Ts();if(n<0&&(s=-nt,n=-n),n%1===0)t=BigInt(n);else if(n>0){let r=1,a=0,o=1,l=1,c=1,u=1e7;for(n>=1&&(r=10**Math.floor(1+Math.log10(n)),n/=r);o<=u&&c<=u;){let h=(a+l)/(o+c);if(n===h){o+c<=u?(t=a+l,i=o+c):c>o?(t=l,i=c):(t=a,i=o);break}else n>h?(a+=l,o+=c):(l+=a,c+=o),o>u?(t=l,i=c):(t=a,i=o)}t=BigInt(t)*BigInt(r),i=BigInt(i)}}else if(typeof n=="string"){let r=0,a=Ve,o=Ve,l=Ve,c=nt,u=nt,h=n.replace(/_/g,"").match(/\d+|./g);if(h===null)throw Ts();if(h[r]==="-"?(s=-nt,r++):h[r]==="+"&&r++,h.length===r+1?o=gs(h[r++],s):h[r+1]==="."||h[r]==="."?(h[r]!=="."&&(a=gs(h[r++],s)),r++,(r+1===h.length||h[r+1]==="("&&h[r+3]===")"||h[r+1]==="'"&&h[r+3]==="'")&&(o=gs(h[r],s),c=Hn**BigInt(h[r].length),r++),(h[r]==="("&&h[r+2]===")"||h[r]==="'"&&h[r+2]==="'")&&(l=gs(h[r+1],s),u=Hn**BigInt(h[r+1].length)-nt,r+=3)):h[r+1]==="/"||h[r+1]===":"?(o=gs(h[r],s),c=gs(h[r+2],nt),r+=3):h[r+3]==="/"&&h[r+1]===" "&&(a=gs(h[r],s),o=gs(h[r+2],s),c=gs(h[r+4],nt),r+=5),h.length<=r)i=c*u,s=t=l+i*a+u*o;else throw Ts()}else if(typeof n=="bigint")t=n,s=n,i=nt;else throw Ts();if(i===Ve)throw jd();we.s=s<Ve?-nt:nt,we.n=t<Ve?-t:t,we.d=i<Ve?-i:i};function mD(n,e,t){let i=nt;for(;e>Ve;n=n*n%t,e>>=nt)e&nt&&(i=i*n%t);return i}function gD(n,e){for(;e%qa===Ve;e/=qa);for(;e%zh===Ve;e/=zh);if(e===nt)return Ve;let t=Hn%e,i=1;for(;t!==nt;i++)if(t=t*Hn%e,i>pD)return Ve;return BigInt(i)}function OD(n,e,t){let i=nt,s=mD(Hn,t,e);for(let r=0;r<300;r++){if(i===s)return BigInt(r);i=i*Hn%e,s=s*Hn%e}return 0}function nr(n,e){if(!n)return e;if(!e)return n;for(;;){if(n%=e,!n)return e;if(e%=n,!e)return n}}function Gt(n,e){if(bn(n,e),this instanceof Gt)n=nr(we.d,we.n),this.s=we.s,this.n=we.n/n,this.d=we.d/n;else return Ht(we.s*we.n,we.d)}var jd=function(){return new Error("Division by Zero")},Ts=function(){return new Error("Invalid argument")},Mm=function(){return new Error("Parameters must be integer")};Gt.prototype={s:nt,n:Ve,d:nt,abs:function(){return Ht(this.n,this.d)},neg:function(){return Ht(-this.s*this.n,this.d)},add:function(n,e){return bn(n,e),Ht(this.s*this.n*we.d+we.s*this.d*we.n,this.d*we.d)},sub:function(n,e){return bn(n,e),Ht(this.s*this.n*we.d-we.s*this.d*we.n,this.d*we.d)},mul:function(n,e){return bn(n,e),Ht(this.s*we.s*this.n*we.n,this.d*we.d)},div:function(n,e){return bn(n,e),Ht(this.s*we.s*this.n*we.d,this.d*we.n)},clone:function(){return Ht(this.s*this.n,this.d)},mod:function(n,e){if(n===void 0)return Ht(this.s*this.n%this.d,nt);if(bn(n,e),Ve===we.n*this.d)throw jd();return Ht(this.s*(we.d*this.n)%(we.n*this.d),we.d*this.d)},gcd:function(n,e){return bn(n,e),Ht(nr(we.n,this.n)*nr(we.d,this.d),we.d*this.d)},lcm:function(n,e){return bn(n,e),we.n===Ve&&this.n===Ve?Ht(Ve,nt):Ht(we.n*this.n,nr(we.n,this.n)*nr(we.d,this.d))},inverse:function(){return Ht(this.s*this.d,this.n)},pow:function(n,e){if(bn(n,e),we.d===nt)return we.s<Ve?Ht((this.s*this.d)**we.n,this.n**we.n):Ht((this.s*this.n)**we.n,this.d**we.n);if(this.s<Ve)return null;let t=Mr(this.n),i=Mr(this.d),s=nt,r=nt;for(let a in t)if(a!=="1"){if(a==="0"){s=Ve;break}if(t[a]*=we.n,t[a]%we.d===Ve)t[a]/=we.d;else return null;s*=BigInt(a)**t[a]}for(let a in i)if(a!=="1"){if(i[a]*=we.n,i[a]%we.d===Ve)i[a]/=we.d;else return null;r*=BigInt(a)**i[a]}return we.s<Ve?Ht(r,s):Ht(s,r)},log:function(n,e){if(bn(n,e),this.s<=Ve||we.s<=Ve)return null;const t={},i=Mr(we.n),s=Mr(we.d),r=Mr(this.n),a=Mr(this.d);for(const c in s)i[c]=(i[c]||Ve)-s[c];for(const c in a)r[c]=(r[c]||Ve)-a[c];for(const c in i)c!=="1"&&(t[c]=!0);for(const c in r)c!=="1"&&(t[c]=!0);let o=null,l=null;for(const c in t){const u=i[c]||Ve,h=r[c]||Ve;if(u===Ve){if(h!==Ve)return null;continue}let d=h,f=u;const m=nr(d,f);if(d/=m,f/=m,o===null&&l===null)o=d,l=f;else if(d*l!==o*f)return null}return o!==null&&l!==null?Ht(o,l):null},equals:function(n,e){return bn(n,e),this.s*this.n*we.d===we.s*we.n*this.d},lt:function(n,e){return bn(n,e),this.s*this.n*we.d<we.s*we.n*this.d},lte:function(n,e){return bn(n,e),this.s*this.n*we.d<=we.s*we.n*this.d},gt:function(n,e){return bn(n,e),this.s*this.n*we.d>we.s*we.n*this.d},gte:function(n,e){return bn(n,e),this.s*this.n*we.d>=we.s*we.n*this.d},compare:function(n,e){bn(n,e);let t=this.s*this.n*we.d-we.s*we.n*this.d;return(Ve<t)-(t<Ve)},ceil:function(n){return n=Hn**BigInt(n||0),Ht(ki(this.s*n*this.n/this.d)+(n*this.n%this.d>Ve&&this.s>=Ve?nt:Ve),n)},floor:function(n){return n=Hn**BigInt(n||0),Ht(ki(this.s*n*this.n/this.d)-(n*this.n%this.d>Ve&&this.s<Ve?nt:Ve),n)},round:function(n){return n=Hn**BigInt(n||0),Ht(ki(this.s*n*this.n/this.d)+this.s*((this.s>=Ve?nt:Ve)+qa*(n*this.n%this.d)>this.d?nt:Ve),n)},roundTo:function(n,e){bn(n,e);const t=this.n*we.d,i=this.d*we.n,s=t%i;let r=ki(t/i);return s+s>=i&&r++,Ht(this.s*r*we.n,we.d)},divisible:function(n,e){return bn(n,e),!(!(we.n*this.d)||this.n*we.d%(we.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(n){let e=this.n,t=this.d;n=n||15;let i=gD(e,t),s=OD(e,t,i),r=this.s<Ve?"-":"";if(r+=ki(e/t),e%=t,e*=Hn,e&&(r+="."),i){for(let a=s;a--;)r+=ki(e/t),e%=t,e*=Hn;r+="(";for(let a=i;a--;)r+=ki(e/t),e%=t,e*=Hn;r+=")"}else for(let a=n;e&&a--;)r+=ki(e/t),e%=t,e*=Hn;return r},toFraction:function(n){let e=this.n,t=this.d,i=this.s<Ve?"-":"";if(t===nt)i+=e;else{let s=ki(e/t);n&&s>Ve&&(i+=s,i+=" ",e%=t),i+=e,i+="/",i+=t}return i},toLatex:function(n){let e=this.n,t=this.d,i=this.s<Ve?"-":"";if(t===nt)i+=e;else{let s=ki(e/t);n&&s>Ve&&(i+=s,e%=t),i+="\\frac{",i+=e,i+="}{",i+=t,i+="}"}return i},toContinued:function(){let n=this.n,e=this.d,t=[];do{t.push(ki(n/e));let i=n%e;n=e,e=i}while(n!==nt);return t},simplify:function(n){const e=BigInt(1/(n||.001)|0),t=this.abs(),i=t.toContinued();for(let s=1;s<i.length;s++){let r=Ht(i[s-1],nt);for(let o=s-2;o>=0;o--)r=r.inverse().add(i[o]);let a=r.sub(t);if(a.n*e<a.d)return r.mul(this.s)}return this}};class Ki{constructor(e,t){this.begin=Is(e),this.end=Is(t)}get spanCycles(){const e=[];var t=this.begin;const i=this.end,s=i.sam();if(t.equals(i))return[new Ki(t,i)];for(;i.gt(t);){if(t.sam().equals(s)){e.push(new Ki(t,this.end));break}const r=t.nextSam();e.push(new Ki(t,r)),t=r}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),t=e.add(this.duration);return new Ki(e,t)}withTime(e){return new Ki(e(this.begin),e(this.end))}withEnd(e){return new Ki(this.begin,e(this.end))}withCycle(e){const t=this.begin.sam(),i=t.add(e(this.begin.sub(t))),s=t.add(e(this.end.sub(t)));return new Ki(i,s)}intersection(e){const t=this.begin.max(e.begin),i=this.end.min(e.end);if(!t.gt(i)&&!(t.equals(i)&&(t.equals(this.end)&&this.begin.lt(this.end)||t.equals(e.end)&&e.begin.lt(e.end))))return new Ki(t,i)}intersection_e(e){const t=this.intersection(e);if(t==null)throw"TimeSpans do not intersect";return t}midpoint(){return this.begin.add(this.duration.div(Is(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+" → "+this.end.show()}}const yD=n=>n.filter(e=>e!=null);Gt.prototype.sam=function(){return this.floor()};Gt.prototype.nextSam=function(){return this.sam().add(1)};Gt.prototype.wholeCycle=function(){return new Ki(this.sam(),this.nextSam())};Gt.prototype.cyclePos=function(){return this.sub(this.sam())};Gt.prototype.lt=function(n){return this.compare(n)<0};Gt.prototype.gt=function(n){return this.compare(n)>0};Gt.prototype.lte=function(n){return this.compare(n)<=0};Gt.prototype.gte=function(n){return this.compare(n)>=0};Gt.prototype.eq=function(n){return this.compare(n)==0};Gt.prototype.ne=function(n){return this.compare(n)!=0};Gt.prototype.max=function(n){return this.gt(n)?this:n};Gt.prototype.maximum=function(...n){return n=n.map(e=>new Gt(e)),n.reduce((e,t)=>t.max(e),this)};Gt.prototype.min=function(n){return this.lt(n)?this:n};Gt.prototype.mulmaybe=function(n){return n!==void 0?this.mul(n):void 0};Gt.prototype.divmaybe=function(n){return n!==void 0?this.div(n):void 0};Gt.prototype.addmaybe=function(n){return n!==void 0?this.add(n):void 0};Gt.prototype.submaybe=function(n){return n!==void 0?this.sub(n):void 0};Gt.prototype.show=function(){return this.s*this.n+"/"+this.d};Gt.prototype.or=function(n){return this.eq(0)?n:this};const Is=n=>Gt(n),To=(...n)=>{if(n=yD(n),n.length===0)return;const e=n.pop();return n.reduce((t,i)=>t===void 0||i===void 0?void 0:t.lcm(i),e)};Is._original=Gt;const gy=3e-4,bD=(n,e)=>(t,i)=>{var a;const s=(a=n.source_[i].options_)==null?void 0:a.ops,r=t.__steps_source;if(s)for(const o of s)switch(o.type_){case"stretch":{const l=["fast","slow"],{type:c,amount:u}=o.arguments_;if(!l.includes(c))throw new Error(`mini: stretch: type must be one of ${l.join("|")} but got ${c}`);t=po(t)[c](e(u));break}case"replicate":{const{amount:l}=o.arguments_;t=po(t),t=t._repeatCycles(l)._fast(l);break}case"bjorklund":{o.arguments_.rotation?t=t.euclidRot(e(o.arguments_.pulse),e(o.arguments_.step),e(o.arguments_.rotation)):t=t.euclid(e(o.arguments_.pulse),e(o.arguments_.step));break}case"degradeBy":{t=po(t)._degradeByWith(Sg.early(gy*o.arguments_.seed),o.arguments_.amount??.5);break}case"tail":{const l=e(o.arguments_.element);t=t.fmap(c=>u=>Array.isArray(c)?[...c,u]:[c,u]).appLeft(l);break}case"range":{const l=e(o.arguments_.element);t=po(t);const c=(u,h,d=1)=>Array.from({length:Math.abs(h-u)/d+1},(f,m)=>u<h?u+m*d:u-m*d);t=((u,h)=>u.squeezeBind(d=>h.bind(f=>vg(...c(d,f)))))(t,l);break}default:console.warn(`operator "${o.type_}" not implemented`)}return t.__steps_source=t.__steps_source||r,t};function Oy(n,e,t,i=0){t==null||t(n);const s=r=>Oy(r,e,t,i);switch(n.type_){case"pattern":{const r=n.source_.map(c=>s(c)).map(bD(n,s)),a=n.arguments_.alignment,o=r.filter(c=>c.__steps_source);let l;switch(a){case"stack":{l=Ou(...r),o.length&&(l._steps=To(...o.map(c=>Is(c._steps))));break}case"polymeter_slowcat":{l=Ou(...r.map(c=>c._slow(c.__weight))),o.length&&(l._steps=To(...o.map(c=>Is(c._steps))));break}case"polymeter":{const c=n.arguments_.stepsPerCycle?s(n.arguments_.stepsPerCycle).fmap(h=>ra(h)):gu(ra(r.length>0?r[0].__weight:1)),u=r.map(h=>h.fast(c.fmap(d=>d.div(h.__weight))));l=Ou(...u);break}case"rand":{l=Xb(Sg.early(gy*n.arguments_.seed).segment(1),r),o.length&&(l._steps=To(...o.map(c=>Is(c._steps))));break}case"feet":{l=vg(...r);break}default:{if(n.source_.some(c=>{var u;return!!((u=c.options_)!=null&&u.weight)})){const c=n.source_.reduce((u,h)=>{var d;return u.add(((d=h.options_)==null?void 0:d.weight)||ra(1))},ra(0));l=qb(...n.source_.map((u,h)=>{var d;return[((d=u.options_)==null?void 0:d.weight)||ra(1),r[h]]})),l.__weight=c,l._steps=c,o.length&&(l._steps=l._steps.mul(To(...o.map(u=>Is(u._steps)))))}else l=Wb(...r),l._steps=r.length;n.arguments_._steps&&(l.__steps_source=!0)}}return o.length&&(l.__steps_source=!0),l}case"element":return s(n.source_);case"atom":{if(n.source_==="~"||n.source_==="-")return rf;if(!n.location_)return console.warn("no location for",n),n.source_;const r=isNaN(Number(n.source_))?n.source_:Number(n.source_);if(i===-1)return gu(r);const[a,o]=yy(e,n,i);return gu(r).withLoc(a,o)}case"stretch":return s(n.source_).slow(s(n.arguments_.amount));default:return console.warn(`node type "${n.type_}" not implemented -> returning silence`),rf}}const yy=(n,e,t=0)=>{const{start:i,end:s}=e.location_,r=n==null?void 0:n.split("").slice(i.offset,s.offset).join(""),[a=0,o=0]=r?r.split(e.source_).map(l=>l.split("").filter(c=>c===" ").length):[];return[i.offset+a+t,s.offset-o+t]},vD=(n,e=0,t=n)=>{try{return fD(n)}catch(i){const s=[i.location.start.offset+e,i.location.end.offset+e],r=t.slice(0,s[0]).split(`
`).length;throw new Error(`[mini] parse error at line ${r}: ${i.message}`)}},SD=(n,e,t)=>{const i=vD(n,e,t);let s=[];return Oy(i,n,r=>{r.type_==="atom"&&s.push(r)},-1),s},by=(n,e=0,t)=>SD(n,e,t).map(i=>yy(n,i,e));var wD=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],vy=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],CD="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࢗ-࢟࣊-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄ఼ా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ೳഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-໎໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜕ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠏-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿ-ᫎᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷿‌‍‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯・꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿･",Sy="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࡰ-ࢇࢉ-ࢎࢠ-ࣉऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౝౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೝೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜑᜟ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭌᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲊᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꟍꟐꟑꟓꟕ-Ƛꟲ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",tc={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},nc="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",PD={5:nc,"5module":nc+" export import",6:nc+" const class extends export import super"},AD=/^in(stanceof)?$/,xD=new RegExp("["+Sy+"]"),ED=new RegExp("["+Sy+CD+"]");function jh(n,e){for(var t=65536,i=0;i<e.length;i+=2){if(t+=e[i],t>n)return!1;if(t+=e[i+1],t>=n)return!0}return!1}function ds(n,e){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&xD.test(String.fromCharCode(n)):e===!1?!1:jh(n,vy)}function qs(n,e){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&ED.test(String.fromCharCode(n)):e===!1?!1:jh(n,vy)||jh(n,wD)}var Ot=function(e,t){t===void 0&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function fi(n,e){return new Ot(n,{beforeExpr:!0,binop:e})}var pi={beforeExpr:!0},Gn={startsExpr:!0},Zd={};function pt(n,e){return e===void 0&&(e={}),e.keyword=n,Zd[n]=new Ot(n,e)}var k={num:new Ot("num",Gn),regexp:new Ot("regexp",Gn),string:new Ot("string",Gn),name:new Ot("name",Gn),privateId:new Ot("privateId",Gn),eof:new Ot("eof"),bracketL:new Ot("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ot("]"),braceL:new Ot("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ot("}"),parenL:new Ot("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ot(")"),comma:new Ot(",",pi),semi:new Ot(";",pi),colon:new Ot(":",pi),dot:new Ot("."),question:new Ot("?",pi),questionDot:new Ot("?."),arrow:new Ot("=>",pi),template:new Ot("template"),invalidTemplate:new Ot("invalidTemplate"),ellipsis:new Ot("...",pi),backQuote:new Ot("`",Gn),dollarBraceL:new Ot("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ot("=",{beforeExpr:!0,isAssign:!0}),assign:new Ot("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ot("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ot("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:fi("||",1),logicalAND:fi("&&",2),bitwiseOR:fi("|",3),bitwiseXOR:fi("^",4),bitwiseAND:fi("&",5),equality:fi("==/!=/===/!==",6),relational:fi("</>/<=/>=",7),bitShift:fi("<</>>/>>>",8),plusMin:new Ot("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:fi("%",10),star:fi("*",10),slash:fi("/",10),starstar:new Ot("**",{beforeExpr:!0}),coalesce:fi("??",1),_break:pt("break"),_case:pt("case",pi),_catch:pt("catch"),_continue:pt("continue"),_debugger:pt("debugger"),_default:pt("default",pi),_do:pt("do",{isLoop:!0,beforeExpr:!0}),_else:pt("else",pi),_finally:pt("finally"),_for:pt("for",{isLoop:!0}),_function:pt("function",Gn),_if:pt("if"),_return:pt("return",pi),_switch:pt("switch"),_throw:pt("throw",pi),_try:pt("try"),_var:pt("var"),_const:pt("const"),_while:pt("while",{isLoop:!0}),_with:pt("with"),_new:pt("new",{beforeExpr:!0,startsExpr:!0}),_this:pt("this",Gn),_super:pt("super",Gn),_class:pt("class",Gn),_extends:pt("extends",pi),_export:pt("export"),_import:pt("import",Gn),_null:pt("null",Gn),_true:pt("true",Gn),_false:pt("false",Gn),_in:pt("in",{beforeExpr:!0,binop:7}),_instanceof:pt("instanceof",{beforeExpr:!0,binop:7}),_typeof:pt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:pt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:pt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},ei=/\r\n?|\n|\u2028|\u2029/,kD=new RegExp(ei.source,"g");function Jr(n){return n===10||n===13||n===8232||n===8233}function wy(n,e,t){t===void 0&&(t=n.length);for(var i=e;i<t;i++){var s=n.charCodeAt(i);if(Jr(s))return i<t-1&&s===13&&n.charCodeAt(i+1)===10?i+2:i+1}return-1}var Cy=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Dn=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Py=Object.prototype,MD=Py.hasOwnProperty,DD=Py.toString,ea=Object.hasOwn||(function(n,e){return MD.call(n,e)}),Dm=Array.isArray||(function(n){return DD.call(n)==="[object Array]"}),$m=Object.create(null);function Ls(n){return $m[n]||($m[n]=new RegExp("^(?:"+n.replace(/ /g,"|")+")$"))}function ws(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}var $D=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,Wa=function(e,t){this.line=e,this.column=t};Wa.prototype.offset=function(e){return new Wa(this.line,this.column+e)};var tu=function(e,t,i){this.start=t,this.end=i,e.sourceFile!==null&&(this.source=e.sourceFile)};function Ay(n,e){for(var t=1,i=0;;){var s=wy(n,i,e);if(s<0)return new Wa(t,e-i);++t,i=s}}var Zh={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},Tm=!1;function TD(n){var e={};for(var t in Zh)e[t]=n&&ea(n,t)?n[t]:Zh[t];if(e.ecmaVersion==="latest"?e.ecmaVersion=1e8:e.ecmaVersion==null?(!Tm&&typeof console=="object"&&console.warn&&(Tm=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),e.ecmaVersion=11):e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),e.allowReserved==null&&(e.allowReserved=e.ecmaVersion<5),(!n||n.allowHashBang==null)&&(e.allowHashBang=e.ecmaVersion>=14),Dm(e.onToken)){var i=e.onToken;e.onToken=function(s){return i.push(s)}}return Dm(e.onComment)&&(e.onComment=_D(e,e.onComment)),e}function _D(n,e){return function(t,i,s,r,a,o){var l={type:t?"Block":"Line",value:i,start:s,end:r};n.locations&&(l.loc=new tu(this,a,o)),n.ranges&&(l.range=[s,r]),e.push(l)}}var Xa=1,ta=2,Gd=4,xy=8,Ud=16,Ey=32,nu=64,ky=128,Sr=256,ao=512,iu=Xa|ta|Sr;function qd(n,e){return ta|(n?Gd:0)|(e?xy:0)}var Cl=0,Wd=1,As=2,My=3,Dy=4,$y=5,yn=function(e,t,i){this.options=e=TD(e),this.sourceFile=e.sourceFile,this.keywords=Ls(PD[e.ecmaVersion>=6?6:e.sourceType==="module"?"5module":5]);var s="";e.allowReserved!==!0&&(s=tc[e.ecmaVersion>=6?6:e.ecmaVersion===5?5:3],e.sourceType==="module"&&(s+=" await")),this.reservedWords=Ls(s);var r=(s?s+" ":"")+tc.strict;this.reservedWordsStrict=Ls(r),this.reservedWordsStrictBind=Ls(r+" "+tc.strictBind),this.input=String(t),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf(`
`,i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(ei).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=k.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=e.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&e.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Xa),this.regexpState=null,this.privateNameStack=[]},fs={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};yn.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};fs.inFunction.get=function(){return(this.currentVarScope().flags&ta)>0};fs.inGenerator.get=function(){return(this.currentVarScope().flags&xy)>0};fs.inAsync.get=function(){return(this.currentVarScope().flags&Gd)>0};fs.canAwait.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var e=this.scopeStack[n],t=e.flags;if(t&(Sr|ao))return!1;if(t&ta)return(t&Gd)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};fs.allowSuper.get=function(){var n=this.currentThisScope(),e=n.flags;return(e&nu)>0||this.options.allowSuperOutsideMethod};fs.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ky)>0};fs.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};fs.allowNewDotTarget.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var e=this.scopeStack[n],t=e.flags;if(t&(Sr|ao)||t&ta&&!(t&Ud))return!0}return!1};fs.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&Sr)>0};yn.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var i=this,s=0;s<e.length;s++)i=e[s](i);return i};yn.parse=function(e,t){return new this(t,e).parse()};yn.parseExpressionAt=function(e,t,i){var s=new this(i,e,t);return s.nextToken(),s.parseExpression()};yn.tokenizer=function(e,t){return new this(t,e)};Object.defineProperties(yn.prototype,fs);var Vn=yn.prototype,ND=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;Vn.strictDirective=function(n){if(this.options.ecmaVersion<5)return!1;for(;;){Dn.lastIndex=n,n+=Dn.exec(this.input)[0].length;var e=ND.exec(this.input.slice(n));if(!e)return!1;if((e[1]||e[2])==="use strict"){Dn.lastIndex=n+e[0].length;var t=Dn.exec(this.input),i=t.index+t[0].length,s=this.input.charAt(i);return s===";"||s==="}"||ei.test(t[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(s)||s==="!"&&this.input.charAt(i+1)==="=")}n+=e[0].length,Dn.lastIndex=n,n+=Dn.exec(this.input)[0].length,this.input[n]===";"&&n++}};Vn.eat=function(n){return this.type===n?(this.next(),!0):!1};Vn.isContextual=function(n){return this.type===k.name&&this.value===n&&!this.containsEsc};Vn.eatContextual=function(n){return this.isContextual(n)?(this.next(),!0):!1};Vn.expectContextual=function(n){this.eatContextual(n)||this.unexpected()};Vn.canInsertSemicolon=function(){return this.type===k.eof||this.type===k.braceR||ei.test(this.input.slice(this.lastTokEnd,this.start))};Vn.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};Vn.semicolon=function(){!this.eat(k.semi)&&!this.insertSemicolon()&&this.unexpected()};Vn.afterTrailingComma=function(n,e){if(this.type===n)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0};Vn.expect=function(n){this.eat(n)||this.unexpected()};Vn.unexpected=function(n){this.raise(n??this.start,"Unexpected token")};var su=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};Vn.checkPatternErrors=function(n,e){if(n){n.trailingComma>-1&&this.raiseRecoverable(n.trailingComma,"Comma is not permitted after the rest element");var t=e?n.parenthesizedAssign:n.parenthesizedBind;t>-1&&this.raiseRecoverable(t,e?"Assigning to rvalue":"Parenthesized pattern")}};Vn.checkExpressionErrors=function(n,e){if(!n)return!1;var t=n.shorthandAssign,i=n.doubleProto;if(!e)return t>=0||i>=0;t>=0&&this.raise(t,"Shorthand property assignments are valid only in destructuring patterns"),i>=0&&this.raiseRecoverable(i,"Redefinition of __proto__ property")};Vn.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};Vn.isSimpleAssignTarget=function(n){return n.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(n.expression):n.type==="Identifier"||n.type==="MemberExpression"};var Ne=yn.prototype;Ne.parseTopLevel=function(n){var e=Object.create(null);for(n.body||(n.body=[]);this.type!==k.eof;){var t=this.parseStatement(null,!0,e);n.body.push(t)}if(this.inModule)for(var i=0,s=Object.keys(this.undefinedExports);i<s.length;i+=1){var r=s[i];this.raiseRecoverable(this.undefinedExports[r].start,"Export '"+r+"' is not defined")}return this.adaptDirectivePrologue(n.body),this.next(),n.sourceType=this.options.sourceType,this.finishNode(n,"Program")};var Xd={kind:"loop"},BD={kind:"switch"};Ne.isLet=function(n){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Dn.lastIndex=this.pos;var e=Dn.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(i===91||i===92)return!0;if(n)return!1;if(i===123||i>55295&&i<56320)return!0;if(ds(i,!0)){for(var s=t+1;qs(i=this.input.charCodeAt(s),!0);)++s;if(i===92||i>55295&&i<56320)return!0;var r=this.input.slice(t,s);if(!AD.test(r))return!0}return!1};Ne.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Dn.lastIndex=this.pos;var n=Dn.exec(this.input),e=this.pos+n[0].length,t;return!ei.test(this.input.slice(this.pos,e))&&this.input.slice(e,e+8)==="function"&&(e+8===this.input.length||!(qs(t=this.input.charCodeAt(e+8))||t>55295&&t<56320))};Ne.isUsingKeyword=function(n,e){if(this.options.ecmaVersion<17||!this.isContextual(n?"await":"using"))return!1;Dn.lastIndex=this.pos;var t=Dn.exec(this.input),i=this.pos+t[0].length;if(ei.test(this.input.slice(this.pos,i)))return!1;if(n){var s=i+5,r;if(this.input.slice(i,s)!=="using"||s===this.input.length||qs(r=this.input.charCodeAt(s))||r>55295&&r<56320)return!1;Dn.lastIndex=s;var a=Dn.exec(this.input);if(a&&ei.test(this.input.slice(s,s+a[0].length)))return!1}if(e){var o=i+2,l;if(this.input.slice(i,o)==="of"&&(o===this.input.length||!qs(l=this.input.charCodeAt(o))&&!(l>55295&&l<56320)))return!1}var c=this.input.charCodeAt(i);return ds(c,!0)||c===92};Ne.isAwaitUsing=function(n){return this.isUsingKeyword(!0,n)};Ne.isUsing=function(n){return this.isUsingKeyword(!1,n)};Ne.parseStatement=function(n,e,t){var i=this.type,s=this.startNode(),r;switch(this.isLet(n)&&(i=k._var,r="let"),i){case k._break:case k._continue:return this.parseBreakContinueStatement(s,i.keyword);case k._debugger:return this.parseDebuggerStatement(s);case k._do:return this.parseDoStatement(s);case k._for:return this.parseForStatement(s);case k._function:return n&&(this.strict||n!=="if"&&n!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1,!n);case k._class:return n&&this.unexpected(),this.parseClass(s,!0);case k._if:return this.parseIfStatement(s);case k._return:return this.parseReturnStatement(s);case k._switch:return this.parseSwitchStatement(s);case k._throw:return this.parseThrowStatement(s);case k._try:return this.parseTryStatement(s);case k._const:case k._var:return r=r||this.value,n&&r!=="var"&&this.unexpected(),this.parseVarStatement(s,r);case k._while:return this.parseWhileStatement(s);case k._with:return this.parseWithStatement(s);case k.braceL:return this.parseBlock(!0,s);case k.semi:return this.parseEmptyStatement(s);case k._export:case k._import:if(this.options.ecmaVersion>10&&i===k._import){Dn.lastIndex=this.pos;var a=Dn.exec(this.input),o=this.pos+a[0].length,l=this.input.charCodeAt(o);if(l===40||l===46)return this.parseExpressionStatement(s,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===k._import?this.parseImport(s):this.parseExport(s,t);default:if(this.isAsyncFunction())return n&&this.unexpected(),this.next(),this.parseFunctionStatement(s,!0,!n);var c=this.isAwaitUsing(!1)?"await using":this.isUsing(!1)?"using":null;if(c)return e&&this.options.sourceType==="script"&&this.raise(this.start,"Using declaration cannot appear in the top level when source type is `script`"),c==="await using"&&(this.canAwait||this.raise(this.start,"Await using cannot appear outside of async function"),this.next()),this.next(),this.parseVar(s,!1,c),this.semicolon(),this.finishNode(s,"VariableDeclaration");var u=this.value,h=this.parseExpression();return i===k.name&&h.type==="Identifier"&&this.eat(k.colon)?this.parseLabeledStatement(s,u,h,n):this.parseExpressionStatement(s,h)}};Ne.parseBreakContinueStatement=function(n,e){var t=e==="break";this.next(),this.eat(k.semi)||this.insertSemicolon()?n.label=null:this.type!==k.name?this.unexpected():(n.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var s=this.labels[i];if((n.label==null||s.name===n.label.name)&&(s.kind!=null&&(t||s.kind==="loop")||n.label&&t))break}return i===this.labels.length&&this.raise(n.start,"Unsyntactic "+e),this.finishNode(n,t?"BreakStatement":"ContinueStatement")};Ne.parseDebuggerStatement=function(n){return this.next(),this.semicolon(),this.finishNode(n,"DebuggerStatement")};Ne.parseDoStatement=function(n){return this.next(),this.labels.push(Xd),n.body=this.parseStatement("do"),this.labels.pop(),this.expect(k._while),n.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(k.semi):this.semicolon(),this.finishNode(n,"DoWhileStatement")};Ne.parseForStatement=function(n){this.next();var e=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Xd),this.enterScope(0),this.expect(k.parenL),this.type===k.semi)return e>-1&&this.unexpected(e),this.parseFor(n,null);var t=this.isLet();if(this.type===k._var||this.type===k._const||t){var i=this.startNode(),s=t?"let":this.value;return this.next(),this.parseVar(i,!0,s),this.finishNode(i,"VariableDeclaration"),this.parseForAfterInit(n,i,e)}var r=this.isContextual("let"),a=!1,o=this.isUsing(!0)?"using":this.isAwaitUsing(!0)?"await using":null;if(o){var l=this.startNode();return this.next(),o==="await using"&&this.next(),this.parseVar(l,!0,o),this.finishNode(l,"VariableDeclaration"),this.parseForAfterInit(n,l,e)}var c=this.containsEsc,u=new su,h=this.start,d=e>-1?this.parseExprSubscripts(u,"await"):this.parseExpression(!0,u);return this.type===k._in||(a=this.options.ecmaVersion>=6&&this.isContextual("of"))?(e>-1?(this.type===k._in&&this.unexpected(e),n.await=!0):a&&this.options.ecmaVersion>=8&&(d.start===h&&!c&&d.type==="Identifier"&&d.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(n.await=!1)),r&&a&&this.raise(d.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(d,!1,u),this.checkLValPattern(d),this.parseForIn(n,d)):(this.checkExpressionErrors(u,!0),e>-1&&this.unexpected(e),this.parseFor(n,d))};Ne.parseForAfterInit=function(n,e,t){return(this.type===k._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&e.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===k._in?t>-1&&this.unexpected(t):n.await=t>-1),this.parseForIn(n,e)):(t>-1&&this.unexpected(t),this.parseFor(n,e))};Ne.parseFunctionStatement=function(n,e,t){return this.next(),this.parseFunction(n,_a|(t?0:Gh),!1,e)};Ne.parseIfStatement=function(n){return this.next(),n.test=this.parseParenExpression(),n.consequent=this.parseStatement("if"),n.alternate=this.eat(k._else)?this.parseStatement("if"):null,this.finishNode(n,"IfStatement")};Ne.parseReturnStatement=function(n){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(k.semi)||this.insertSemicolon()?n.argument=null:(n.argument=this.parseExpression(),this.semicolon()),this.finishNode(n,"ReturnStatement")};Ne.parseSwitchStatement=function(n){this.next(),n.discriminant=this.parseParenExpression(),n.cases=[],this.expect(k.braceL),this.labels.push(BD),this.enterScope(0);for(var e,t=!1;this.type!==k.braceR;)if(this.type===k._case||this.type===k._default){var i=this.type===k._case;e&&this.finishNode(e,"SwitchCase"),n.cases.push(e=this.startNode()),e.consequent=[],this.next(),i?e.test=this.parseExpression():(t&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),t=!0,e.test=null),this.expect(k.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(n,"SwitchStatement")};Ne.parseThrowStatement=function(n){return this.next(),ei.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),n.argument=this.parseExpression(),this.semicolon(),this.finishNode(n,"ThrowStatement")};var FD=[];Ne.parseCatchClauseParam=function(){var n=this.parseBindingAtom(),e=n.type==="Identifier";return this.enterScope(e?Ey:0),this.checkLValPattern(n,e?Dy:As),this.expect(k.parenR),n};Ne.parseTryStatement=function(n){if(this.next(),n.block=this.parseBlock(),n.handler=null,this.type===k._catch){var e=this.startNode();this.next(),this.eat(k.parenL)?e.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0)),e.body=this.parseBlock(!1),this.exitScope(),n.handler=this.finishNode(e,"CatchClause")}return n.finalizer=this.eat(k._finally)?this.parseBlock():null,!n.handler&&!n.finalizer&&this.raise(n.start,"Missing catch or finally clause"),this.finishNode(n,"TryStatement")};Ne.parseVarStatement=function(n,e,t){return this.next(),this.parseVar(n,!1,e,t),this.semicolon(),this.finishNode(n,"VariableDeclaration")};Ne.parseWhileStatement=function(n){return this.next(),n.test=this.parseParenExpression(),this.labels.push(Xd),n.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(n,"WhileStatement")};Ne.parseWithStatement=function(n){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),n.object=this.parseParenExpression(),n.body=this.parseStatement("with"),this.finishNode(n,"WithStatement")};Ne.parseEmptyStatement=function(n){return this.next(),this.finishNode(n,"EmptyStatement")};Ne.parseLabeledStatement=function(n,e,t,i){for(var s=0,r=this.labels;s<r.length;s+=1){var a=r[s];a.name===e&&this.raise(t.start,"Label '"+e+"' is already declared")}for(var o=this.type.isLoop?"loop":this.type===k._switch?"switch":null,l=this.labels.length-1;l>=0;l--){var c=this.labels[l];if(c.statementStart===n.start)c.statementStart=this.start,c.kind=o;else break}return this.labels.push({name:e,kind:o,statementStart:this.start}),n.body=this.parseStatement(i?i.indexOf("label")===-1?i+"label":i:"label"),this.labels.pop(),n.label=t,this.finishNode(n,"LabeledStatement")};Ne.parseExpressionStatement=function(n,e){return n.expression=e,this.semicolon(),this.finishNode(n,"ExpressionStatement")};Ne.parseBlock=function(n,e,t){for(n===void 0&&(n=!0),e===void 0&&(e=this.startNode()),e.body=[],this.expect(k.braceL),n&&this.enterScope(0);this.type!==k.braceR;){var i=this.parseStatement(null);e.body.push(i)}return t&&(this.strict=!1),this.next(),n&&this.exitScope(),this.finishNode(e,"BlockStatement")};Ne.parseFor=function(n,e){return n.init=e,this.expect(k.semi),n.test=this.type===k.semi?null:this.parseExpression(),this.expect(k.semi),n.update=this.type===k.parenR?null:this.parseExpression(),this.expect(k.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,"ForStatement")};Ne.parseForIn=function(n,e){var t=this.type===k._in;return this.next(),e.type==="VariableDeclaration"&&e.declarations[0].init!=null&&(!t||this.options.ecmaVersion<8||this.strict||e.kind!=="var"||e.declarations[0].id.type!=="Identifier")&&this.raise(e.start,(t?"for-in":"for-of")+" loop variable declaration may not have an initializer"),n.left=e,n.right=t?this.parseExpression():this.parseMaybeAssign(),this.expect(k.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,t?"ForInStatement":"ForOfStatement")};Ne.parseVar=function(n,e,t,i){for(n.declarations=[],n.kind=t;;){var s=this.startNode();if(this.parseVarId(s,t),this.eat(k.eq)?s.init=this.parseMaybeAssign(e):!i&&t==="const"&&!(this.type===k._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!i&&(t==="using"||t==="await using")&&this.options.ecmaVersion>=17&&this.type!==k._in&&!this.isContextual("of")?this.raise(this.lastTokEnd,"Missing initializer in "+t+" declaration"):!i&&s.id.type!=="Identifier"&&!(e&&(this.type===k._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):s.init=null,n.declarations.push(this.finishNode(s,"VariableDeclarator")),!this.eat(k.comma))break}return n};Ne.parseVarId=function(n,e){n.id=e==="using"||e==="await using"?this.parseIdent():this.parseBindingAtom(),this.checkLValPattern(n.id,e==="var"?Wd:As,!1)};var _a=1,Gh=2,Ty=4;Ne.parseFunction=function(n,e,t,i,s){this.initFunction(n),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(this.type===k.star&&e&Gh&&this.unexpected(),n.generator=this.eat(k.star)),this.options.ecmaVersion>=8&&(n.async=!!i),e&_a&&(n.id=e&Ty&&this.type!==k.name?null:this.parseIdent(),n.id&&!(e&Gh)&&this.checkLValSimple(n.id,this.strict||n.generator||n.async?this.treatFunctionsAsVar?Wd:As:My));var r=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(qd(n.async,n.generator)),e&_a||(n.id=this.type===k.name?this.parseIdent():null),this.parseFunctionParams(n),this.parseFunctionBody(n,t,!1,s),this.yieldPos=r,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(n,e&_a?"FunctionDeclaration":"FunctionExpression")};Ne.parseFunctionParams=function(n){this.expect(k.parenL),n.params=this.parseBindingList(k.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};Ne.parseClass=function(n,e){this.next();var t=this.strict;this.strict=!0,this.parseClassId(n,e),this.parseClassSuper(n);var i=this.enterClassBody(),s=this.startNode(),r=!1;for(s.body=[],this.expect(k.braceL);this.type!==k.braceR;){var a=this.parseClassElement(n.superClass!==null);a&&(s.body.push(a),a.type==="MethodDefinition"&&a.kind==="constructor"?(r&&this.raiseRecoverable(a.start,"Duplicate constructor in the same class"),r=!0):a.key&&a.key.type==="PrivateIdentifier"&&RD(i,a)&&this.raiseRecoverable(a.key.start,"Identifier '#"+a.key.name+"' has already been declared"))}return this.strict=t,this.next(),n.body=this.finishNode(s,"ClassBody"),this.exitClassBody(),this.finishNode(n,e?"ClassDeclaration":"ClassExpression")};Ne.parseClassElement=function(n){if(this.eat(k.semi))return null;var e=this.options.ecmaVersion,t=this.startNode(),i="",s=!1,r=!1,a="method",o=!1;if(this.eatContextual("static")){if(e>=13&&this.eat(k.braceL))return this.parseClassStaticBlock(t),t;this.isClassElementNameStart()||this.type===k.star?o=!0:i="static"}if(t.static=o,!i&&e>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===k.star)&&!this.canInsertSemicolon()?r=!0:i="async"),!i&&(e>=9||!r)&&this.eat(k.star)&&(s=!0),!i&&!r&&!s){var l=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?a=l:i=l)}if(i?(t.computed=!1,t.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),t.key.name=i,this.finishNode(t.key,"Identifier")):this.parseClassElementName(t),e<13||this.type===k.parenL||a!=="method"||s||r){var c=!t.static&&Pl(t,"constructor"),u=c&&n;c&&a!=="method"&&this.raise(t.key.start,"Constructor can't have get/set modifier"),t.kind=c?"constructor":a,this.parseClassMethod(t,s,r,u)}else this.parseClassField(t);return t};Ne.isClassElementNameStart=function(){return this.type===k.name||this.type===k.privateId||this.type===k.num||this.type===k.string||this.type===k.bracketL||this.type.keyword};Ne.parseClassElementName=function(n){this.type===k.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),n.computed=!1,n.key=this.parsePrivateIdent()):this.parsePropertyName(n)};Ne.parseClassMethod=function(n,e,t,i){var s=n.key;n.kind==="constructor"?(e&&this.raise(s.start,"Constructor can't be a generator"),t&&this.raise(s.start,"Constructor can't be an async method")):n.static&&Pl(n,"prototype")&&this.raise(s.start,"Classes may not have a static property named prototype");var r=n.value=this.parseMethod(e,t,i);return n.kind==="get"&&r.params.length!==0&&this.raiseRecoverable(r.start,"getter should have no params"),n.kind==="set"&&r.params.length!==1&&this.raiseRecoverable(r.start,"setter should have exactly one param"),n.kind==="set"&&r.params[0].type==="RestElement"&&this.raiseRecoverable(r.params[0].start,"Setter cannot use rest params"),this.finishNode(n,"MethodDefinition")};Ne.parseClassField=function(n){return Pl(n,"constructor")?this.raise(n.key.start,"Classes can't have a field named 'constructor'"):n.static&&Pl(n,"prototype")&&this.raise(n.key.start,"Classes can't have a static field named 'prototype'"),this.eat(k.eq)?(this.enterScope(ao|nu),n.value=this.parseMaybeAssign(),this.exitScope()):n.value=null,this.semicolon(),this.finishNode(n,"PropertyDefinition")};Ne.parseClassStaticBlock=function(n){n.body=[];var e=this.labels;for(this.labels=[],this.enterScope(Sr|nu);this.type!==k.braceR;){var t=this.parseStatement(null);n.body.push(t)}return this.next(),this.exitScope(),this.labels=e,this.finishNode(n,"StaticBlock")};Ne.parseClassId=function(n,e){this.type===k.name?(n.id=this.parseIdent(),e&&this.checkLValSimple(n.id,As,!1)):(e===!0&&this.unexpected(),n.id=null)};Ne.parseClassSuper=function(n){n.superClass=this.eat(k._extends)?this.parseExprSubscripts(null,!1):null};Ne.enterClassBody=function(){var n={declared:Object.create(null),used:[]};return this.privateNameStack.push(n),n.declared};Ne.exitClassBody=function(){var n=this.privateNameStack.pop(),e=n.declared,t=n.used;if(this.options.checkPrivateFields)for(var i=this.privateNameStack.length,s=i===0?null:this.privateNameStack[i-1],r=0;r<t.length;++r){var a=t[r];ea(e,a.name)||(s?s.used.push(a):this.raiseRecoverable(a.start,"Private field '#"+a.name+"' must be declared in an enclosing class"))}};function RD(n,e){var t=e.key.name,i=n[t],s="true";return e.type==="MethodDefinition"&&(e.kind==="get"||e.kind==="set")&&(s=(e.static?"s":"i")+e.kind),i==="iget"&&s==="iset"||i==="iset"&&s==="iget"||i==="sget"&&s==="sset"||i==="sset"&&s==="sget"?(n[t]="true",!1):i?!0:(n[t]=s,!1)}function Pl(n,e){var t=n.computed,i=n.key;return!t&&(i.type==="Identifier"&&i.name===e||i.type==="Literal"&&i.value===e)}Ne.parseExportAllDeclaration=function(n,e){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(n.exported=this.parseModuleExportName(),this.checkExport(e,n.exported,this.lastTokStart)):n.exported=null),this.expectContextual("from"),this.type!==k.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ExportAllDeclaration")};Ne.parseExport=function(n,e){if(this.next(),this.eat(k.star))return this.parseExportAllDeclaration(n,e);if(this.eat(k._default))return this.checkExport(e,"default",this.lastTokStart),n.declaration=this.parseExportDefaultDeclaration(),this.finishNode(n,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())n.declaration=this.parseExportDeclaration(n),n.declaration.type==="VariableDeclaration"?this.checkVariableExport(e,n.declaration.declarations):this.checkExport(e,n.declaration.id,n.declaration.id.start),n.specifiers=[],n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[]);else{if(n.declaration=null,n.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==k.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause());else{for(var t=0,i=n.specifiers;t<i.length;t+=1){var s=i[t];this.checkUnreserved(s.local),this.checkLocalExport(s.local),s.local.type==="Literal"&&this.raise(s.local.start,"A string literal cannot be used as an exported binding without `from`.")}n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[])}this.semicolon()}return this.finishNode(n,"ExportNamedDeclaration")};Ne.parseExportDeclaration=function(n){return this.parseStatement(null)};Ne.parseExportDefaultDeclaration=function(){var n;if(this.type===k._function||(n=this.isAsyncFunction())){var e=this.startNode();return this.next(),n&&this.next(),this.parseFunction(e,_a|Ty,!1,n)}else if(this.type===k._class){var t=this.startNode();return this.parseClass(t,"nullableID")}else{var i=this.parseMaybeAssign();return this.semicolon(),i}};Ne.checkExport=function(n,e,t){n&&(typeof e!="string"&&(e=e.type==="Identifier"?e.name:e.value),ea(n,e)&&this.raiseRecoverable(t,"Duplicate export '"+e+"'"),n[e]=!0)};Ne.checkPatternExport=function(n,e){var t=e.type;if(t==="Identifier")this.checkExport(n,e,e.start);else if(t==="ObjectPattern")for(var i=0,s=e.properties;i<s.length;i+=1){var r=s[i];this.checkPatternExport(n,r)}else if(t==="ArrayPattern")for(var a=0,o=e.elements;a<o.length;a+=1){var l=o[a];l&&this.checkPatternExport(n,l)}else t==="Property"?this.checkPatternExport(n,e.value):t==="AssignmentPattern"?this.checkPatternExport(n,e.left):t==="RestElement"&&this.checkPatternExport(n,e.argument)};Ne.checkVariableExport=function(n,e){if(n)for(var t=0,i=e;t<i.length;t+=1){var s=i[t];this.checkPatternExport(n,s.id)}};Ne.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};Ne.parseExportSpecifier=function(n){var e=this.startNode();return e.local=this.parseModuleExportName(),e.exported=this.eatContextual("as")?this.parseModuleExportName():e.local,this.checkExport(n,e.exported,e.exported.start),this.finishNode(e,"ExportSpecifier")};Ne.parseExportSpecifiers=function(n){var e=[],t=!0;for(this.expect(k.braceL);!this.eat(k.braceR);){if(t)t=!1;else if(this.expect(k.comma),this.afterTrailingComma(k.braceR))break;e.push(this.parseExportSpecifier(n))}return e};Ne.parseImport=function(n){return this.next(),this.type===k.string?(n.specifiers=FD,n.source=this.parseExprAtom()):(n.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),n.source=this.type===k.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ImportDeclaration")};Ne.parseImportSpecifier=function(){var n=this.startNode();return n.imported=this.parseModuleExportName(),this.eatContextual("as")?n.local=this.parseIdent():(this.checkUnreserved(n.imported),n.local=n.imported),this.checkLValSimple(n.local,As),this.finishNode(n,"ImportSpecifier")};Ne.parseImportDefaultSpecifier=function(){var n=this.startNode();return n.local=this.parseIdent(),this.checkLValSimple(n.local,As),this.finishNode(n,"ImportDefaultSpecifier")};Ne.parseImportNamespaceSpecifier=function(){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLValSimple(n.local,As),this.finishNode(n,"ImportNamespaceSpecifier")};Ne.parseImportSpecifiers=function(){var n=[],e=!0;if(this.type===k.name&&(n.push(this.parseImportDefaultSpecifier()),!this.eat(k.comma)))return n;if(this.type===k.star)return n.push(this.parseImportNamespaceSpecifier()),n;for(this.expect(k.braceL);!this.eat(k.braceR);){if(e)e=!1;else if(this.expect(k.comma),this.afterTrailingComma(k.braceR))break;n.push(this.parseImportSpecifier())}return n};Ne.parseWithClause=function(){var n=[];if(!this.eat(k._with))return n;this.expect(k.braceL);for(var e={},t=!0;!this.eat(k.braceR);){if(t)t=!1;else if(this.expect(k.comma),this.afterTrailingComma(k.braceR))break;var i=this.parseImportAttribute(),s=i.key.type==="Identifier"?i.key.name:i.key.value;ea(e,s)&&this.raiseRecoverable(i.key.start,"Duplicate attribute key '"+s+"'"),e[s]=!0,n.push(i)}return n};Ne.parseImportAttribute=function(){var n=this.startNode();return n.key=this.type===k.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(k.colon),this.type!==k.string&&this.unexpected(),n.value=this.parseExprAtom(),this.finishNode(n,"ImportAttribute")};Ne.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===k.string){var n=this.parseLiteral(this.value);return $D.test(n.value)&&this.raise(n.start,"An export name cannot include a lone surrogate."),n}return this.parseIdent(!0)};Ne.adaptDirectivePrologue=function(n){for(var e=0;e<n.length&&this.isDirectiveCandidate(n[e]);++e)n[e].directive=n[e].expression.raw.slice(1,-1)};Ne.isDirectiveCandidate=function(n){return this.options.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&typeof n.expression.value=="string"&&(this.input[n.start]==='"'||this.input[n.start]==="'")};var Ci=yn.prototype;Ci.toAssignable=function(n,e,t){if(this.options.ecmaVersion>=6&&n)switch(n.type){case"Identifier":this.inAsync&&n.name==="await"&&this.raise(n.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":n.type="ObjectPattern",t&&this.checkPatternErrors(t,!0);for(var i=0,s=n.properties;i<s.length;i+=1){var r=s[i];this.toAssignable(r,e),r.type==="RestElement"&&(r.argument.type==="ArrayPattern"||r.argument.type==="ObjectPattern")&&this.raise(r.argument.start,"Unexpected token")}break;case"Property":n.kind!=="init"&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,e);break;case"ArrayExpression":n.type="ArrayPattern",t&&this.checkPatternErrors(t,!0),this.toAssignableList(n.elements,e);break;case"SpreadElement":n.type="RestElement",this.toAssignable(n.argument,e),n.argument.type==="AssignmentPattern"&&this.raise(n.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":n.operator!=="="&&this.raise(n.left.end,"Only '=' operator can be used for specifying default value."),n.type="AssignmentPattern",delete n.operator,this.toAssignable(n.left,e);break;case"ParenthesizedExpression":this.toAssignable(n.expression,e,t);break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(n.start,"Assigning to rvalue")}else t&&this.checkPatternErrors(t,!0);return n};Ci.toAssignableList=function(n,e){for(var t=n.length,i=0;i<t;i++){var s=n[i];s&&this.toAssignable(s,e)}if(t){var r=n[t-1];this.options.ecmaVersion===6&&e&&r&&r.type==="RestElement"&&r.argument.type!=="Identifier"&&this.unexpected(r.argument.start)}return n};Ci.parseSpread=function(n){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,n),this.finishNode(e,"SpreadElement")};Ci.parseRestBinding=function(){var n=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==k.name&&this.unexpected(),n.argument=this.parseBindingAtom(),this.finishNode(n,"RestElement")};Ci.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case k.bracketL:var n=this.startNode();return this.next(),n.elements=this.parseBindingList(k.bracketR,!0,!0),this.finishNode(n,"ArrayPattern");case k.braceL:return this.parseObj(!0)}return this.parseIdent()};Ci.parseBindingList=function(n,e,t,i){for(var s=[],r=!0;!this.eat(n);)if(r?r=!1:this.expect(k.comma),e&&this.type===k.comma)s.push(null);else{if(t&&this.afterTrailingComma(n))break;if(this.type===k.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),s.push(a),this.type===k.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(n);break}else s.push(this.parseAssignableListItem(i))}return s};Ci.parseAssignableListItem=function(n){var e=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(e),e};Ci.parseBindingListItem=function(n){return n};Ci.parseMaybeDefault=function(n,e,t){if(t=t||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(k.eq))return t;var i=this.startNodeAt(n,e);return i.left=t,i.right=this.parseMaybeAssign(),this.finishNode(i,"AssignmentPattern")};Ci.checkLValSimple=function(n,e,t){e===void 0&&(e=Cl);var i=e!==Cl;switch(n.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(n.name)&&this.raiseRecoverable(n.start,(i?"Binding ":"Assigning to ")+n.name+" in strict mode"),i&&(e===As&&n.name==="let"&&this.raiseRecoverable(n.start,"let is disallowed as a lexically bound name"),t&&(ea(t,n.name)&&this.raiseRecoverable(n.start,"Argument name clash"),t[n.name]=!0),e!==$y&&this.declareName(n.name,e,n.start));break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":i&&this.raiseRecoverable(n.start,"Binding member expression");break;case"ParenthesizedExpression":return i&&this.raiseRecoverable(n.start,"Binding parenthesized expression"),this.checkLValSimple(n.expression,e,t);default:this.raise(n.start,(i?"Binding":"Assigning to")+" rvalue")}};Ci.checkLValPattern=function(n,e,t){switch(e===void 0&&(e=Cl),n.type){case"ObjectPattern":for(var i=0,s=n.properties;i<s.length;i+=1){var r=s[i];this.checkLValInnerPattern(r,e,t)}break;case"ArrayPattern":for(var a=0,o=n.elements;a<o.length;a+=1){var l=o[a];l&&this.checkLValInnerPattern(l,e,t)}break;default:this.checkLValSimple(n,e,t)}};Ci.checkLValInnerPattern=function(n,e,t){switch(e===void 0&&(e=Cl),n.type){case"Property":this.checkLValInnerPattern(n.value,e,t);break;case"AssignmentPattern":this.checkLValPattern(n.left,e,t);break;case"RestElement":this.checkLValPattern(n.argument,e,t);break;default:this.checkLValPattern(n,e,t)}};var $i=function(e,t,i,s,r){this.token=e,this.isExpr=!!t,this.preserveSpace=!!i,this.override=s,this.generator=!!r},Yt={b_stat:new $i("{",!1),b_expr:new $i("{",!0),b_tmpl:new $i("${",!1),p_stat:new $i("(",!1),p_expr:new $i("(",!0),q_tmpl:new $i("`",!0,!0,function(n){return n.tryReadTemplateToken()}),f_stat:new $i("function",!1),f_expr:new $i("function",!0),f_expr_gen:new $i("function",!0,!1,null,!0),f_gen:new $i("function",!1,!1,null,!0)},na=yn.prototype;na.initialContext=function(){return[Yt.b_stat]};na.curContext=function(){return this.context[this.context.length-1]};na.braceIsBlock=function(n){var e=this.curContext();return e===Yt.f_expr||e===Yt.f_stat?!0:n===k.colon&&(e===Yt.b_stat||e===Yt.b_expr)?!e.isExpr:n===k._return||n===k.name&&this.exprAllowed?ei.test(this.input.slice(this.lastTokEnd,this.start)):n===k._else||n===k.semi||n===k.eof||n===k.parenR||n===k.arrow?!0:n===k.braceL?e===Yt.b_stat:n===k._var||n===k._const||n===k.name?!1:!this.exprAllowed};na.inGeneratorContext=function(){for(var n=this.context.length-1;n>=1;n--){var e=this.context[n];if(e.token==="function")return e.generator}return!1};na.updateContext=function(n){var e,t=this.type;t.keyword&&n===k.dot?this.exprAllowed=!1:(e=t.updateContext)?e.call(this,n):this.exprAllowed=t.beforeExpr};na.overrideContext=function(n){this.curContext()!==n&&(this.context[this.context.length-1]=n)};k.parenR.updateContext=k.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var n=this.context.pop();n===Yt.b_stat&&this.curContext().token==="function"&&(n=this.context.pop()),this.exprAllowed=!n.isExpr};k.braceL.updateContext=function(n){this.context.push(this.braceIsBlock(n)?Yt.b_stat:Yt.b_expr),this.exprAllowed=!0};k.dollarBraceL.updateContext=function(){this.context.push(Yt.b_tmpl),this.exprAllowed=!0};k.parenL.updateContext=function(n){var e=n===k._if||n===k._for||n===k._with||n===k._while;this.context.push(e?Yt.p_stat:Yt.p_expr),this.exprAllowed=!0};k.incDec.updateContext=function(){};k._function.updateContext=k._class.updateContext=function(n){n.beforeExpr&&n!==k._else&&!(n===k.semi&&this.curContext()!==Yt.p_stat)&&!(n===k._return&&ei.test(this.input.slice(this.lastTokEnd,this.start)))&&!((n===k.colon||n===k.braceL)&&this.curContext()===Yt.b_stat)?this.context.push(Yt.f_expr):this.context.push(Yt.f_stat),this.exprAllowed=!1};k.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0};k.backQuote.updateContext=function(){this.curContext()===Yt.q_tmpl?this.context.pop():this.context.push(Yt.q_tmpl),this.exprAllowed=!1};k.star.updateContext=function(n){if(n===k._function){var e=this.context.length-1;this.context[e]===Yt.f_expr?this.context[e]=Yt.f_expr_gen:this.context[e]=Yt.f_gen}this.exprAllowed=!0};k.name.updateContext=function(n){var e=!1;this.options.ecmaVersion>=6&&n!==k.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var He=yn.prototype;He.checkPropClash=function(n,e,t){if(!(this.options.ecmaVersion>=9&&n.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(n.computed||n.method||n.shorthand))){var i=n.key,s;switch(i.type){case"Identifier":s=i.name;break;case"Literal":s=String(i.value);break;default:return}var r=n.kind;if(this.options.ecmaVersion>=6){s==="__proto__"&&r==="init"&&(e.proto&&(t?t.doubleProto<0&&(t.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);return}s="$"+s;var a=e[s];if(a){var o;r==="init"?o=this.strict&&a.init||a.get||a.set:o=a.init||a[r],o&&this.raiseRecoverable(i.start,"Redefinition of property")}else a=e[s]={init:!1,get:!1,set:!1};a[r]=!0}};He.parseExpression=function(n,e){var t=this.start,i=this.startLoc,s=this.parseMaybeAssign(n,e);if(this.type===k.comma){var r=this.startNodeAt(t,i);for(r.expressions=[s];this.eat(k.comma);)r.expressions.push(this.parseMaybeAssign(n,e));return this.finishNode(r,"SequenceExpression")}return s};He.parseMaybeAssign=function(n,e,t){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(n);this.exprAllowed=!1}var i=!1,s=-1,r=-1,a=-1;e?(s=e.parenthesizedAssign,r=e.trailingComma,a=e.doubleProto,e.parenthesizedAssign=e.trailingComma=-1):(e=new su,i=!0);var o=this.start,l=this.startLoc;(this.type===k.parenL||this.type===k.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=n==="await");var c=this.parseMaybeConditional(n,e);if(t&&(c=t.call(this,c,o,l)),this.type.isAssign){var u=this.startNodeAt(o,l);return u.operator=this.value,this.type===k.eq&&(c=this.toAssignable(c,!1,e)),i||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=c.start&&(e.shorthandAssign=-1),this.type===k.eq?this.checkLValPattern(c):this.checkLValSimple(c),u.left=c,this.next(),u.right=this.parseMaybeAssign(n),a>-1&&(e.doubleProto=a),this.finishNode(u,"AssignmentExpression")}else i&&this.checkExpressionErrors(e,!0);return s>-1&&(e.parenthesizedAssign=s),r>-1&&(e.trailingComma=r),c};He.parseMaybeConditional=function(n,e){var t=this.start,i=this.startLoc,s=this.parseExprOps(n,e);if(this.checkExpressionErrors(e))return s;if(this.eat(k.question)){var r=this.startNodeAt(t,i);return r.test=s,r.consequent=this.parseMaybeAssign(),this.expect(k.colon),r.alternate=this.parseMaybeAssign(n),this.finishNode(r,"ConditionalExpression")}return s};He.parseExprOps=function(n,e){var t=this.start,i=this.startLoc,s=this.parseMaybeUnary(e,!1,!1,n);return this.checkExpressionErrors(e)||s.start===t&&s.type==="ArrowFunctionExpression"?s:this.parseExprOp(s,t,i,-1,n)};He.parseExprOp=function(n,e,t,i,s){var r=this.type.binop;if(r!=null&&(!s||this.type!==k._in)&&r>i){var a=this.type===k.logicalOR||this.type===k.logicalAND,o=this.type===k.coalesce;o&&(r=k.logicalAND.binop);var l=this.value;this.next();var c=this.start,u=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,s),c,u,r,s),d=this.buildBinary(e,t,n,h,l,a||o);return(a&&this.type===k.coalesce||o&&(this.type===k.logicalOR||this.type===k.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(d,e,t,i,s)}return n};He.buildBinary=function(n,e,t,i,s,r){i.type==="PrivateIdentifier"&&this.raise(i.start,"Private identifier can only be left side of binary expression");var a=this.startNodeAt(n,e);return a.left=t,a.operator=s,a.right=i,this.finishNode(a,r?"LogicalExpression":"BinaryExpression")};He.parseMaybeUnary=function(n,e,t,i){var s=this.start,r=this.startLoc,a;if(this.isContextual("await")&&this.canAwait)a=this.parseAwait(i),e=!0;else if(this.type.prefix){var o=this.startNode(),l=this.type===k.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0,l,i),this.checkExpressionErrors(n,!0),l?this.checkLValSimple(o.argument):this.strict&&o.operator==="delete"&&_y(o.argument)?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):o.operator==="delete"&&Uh(o.argument)?this.raiseRecoverable(o.start,"Private fields can not be deleted"):e=!0,a=this.finishNode(o,l?"UpdateExpression":"UnaryExpression")}else if(!e&&this.type===k.privateId)(i||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),a=this.parsePrivateIdent(),this.type!==k._in&&this.unexpected();else{if(a=this.parseExprSubscripts(n,i),this.checkExpressionErrors(n))return a;for(;this.type.postfix&&!this.canInsertSemicolon();){var c=this.startNodeAt(s,r);c.operator=this.value,c.prefix=!1,c.argument=a,this.checkLValSimple(a),this.next(),a=this.finishNode(c,"UpdateExpression")}}if(!t&&this.eat(k.starstar))if(e)this.unexpected(this.lastTokStart);else return this.buildBinary(s,r,a,this.parseMaybeUnary(null,!1,!1,i),"**",!1);else return a};function _y(n){return n.type==="Identifier"||n.type==="ParenthesizedExpression"&&_y(n.expression)}function Uh(n){return n.type==="MemberExpression"&&n.property.type==="PrivateIdentifier"||n.type==="ChainExpression"&&Uh(n.expression)||n.type==="ParenthesizedExpression"&&Uh(n.expression)}He.parseExprSubscripts=function(n,e){var t=this.start,i=this.startLoc,s=this.parseExprAtom(n,e);if(s.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return s;var r=this.parseSubscripts(s,t,i,!1,e);return n&&r.type==="MemberExpression"&&(n.parenthesizedAssign>=r.start&&(n.parenthesizedAssign=-1),n.parenthesizedBind>=r.start&&(n.parenthesizedBind=-1),n.trailingComma>=r.start&&(n.trailingComma=-1)),r};He.parseSubscripts=function(n,e,t,i,s){for(var r=this.options.ecmaVersion>=8&&n.type==="Identifier"&&n.name==="async"&&this.lastTokEnd===n.end&&!this.canInsertSemicolon()&&n.end-n.start===5&&this.potentialArrowAt===n.start,a=!1;;){var o=this.parseSubscript(n,e,t,i,r,a,s);if(o.optional&&(a=!0),o===n||o.type==="ArrowFunctionExpression"){if(a){var l=this.startNodeAt(e,t);l.expression=o,o=this.finishNode(l,"ChainExpression")}return o}n=o}};He.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(k.arrow)};He.parseSubscriptAsyncArrow=function(n,e,t,i){return this.parseArrowExpression(this.startNodeAt(n,e),t,!0,i)};He.parseSubscript=function(n,e,t,i,s,r,a){var o=this.options.ecmaVersion>=11,l=o&&this.eat(k.questionDot);i&&l&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var c=this.eat(k.bracketL);if(c||l&&this.type!==k.parenL&&this.type!==k.backQuote||this.eat(k.dot)){var u=this.startNodeAt(e,t);u.object=n,c?(u.property=this.parseExpression(),this.expect(k.bracketR)):this.type===k.privateId&&n.type!=="Super"?u.property=this.parsePrivateIdent():u.property=this.parseIdent(this.options.allowReserved!=="never"),u.computed=!!c,o&&(u.optional=l),n=this.finishNode(u,"MemberExpression")}else if(!i&&this.eat(k.parenL)){var h=new su,d=this.yieldPos,f=this.awaitPos,m=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var g=this.parseExprList(k.parenR,this.options.ecmaVersion>=8,!1,h);if(s&&!l&&this.shouldParseAsyncArrow())return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=d,this.awaitPos=f,this.awaitIdentPos=m,this.parseSubscriptAsyncArrow(e,t,g,a);this.checkExpressionErrors(h,!0),this.yieldPos=d||this.yieldPos,this.awaitPos=f||this.awaitPos,this.awaitIdentPos=m||this.awaitIdentPos;var y=this.startNodeAt(e,t);y.callee=n,y.arguments=g,o&&(y.optional=l),n=this.finishNode(y,"CallExpression")}else if(this.type===k.backQuote){(l||r)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var b=this.startNodeAt(e,t);b.tag=n,b.quasi=this.parseTemplate({isTagged:!0}),n=this.finishNode(b,"TaggedTemplateExpression")}return n};He.parseExprAtom=function(n,e,t){this.type===k.slash&&this.readRegexp();var i,s=this.potentialArrowAt===this.start;switch(this.type){case k._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),i=this.startNode(),this.next(),this.type===k.parenL&&!this.allowDirectSuper&&this.raise(i.start,"super() call outside constructor of a subclass"),this.type!==k.dot&&this.type!==k.bracketL&&this.type!==k.parenL&&this.unexpected(),this.finishNode(i,"Super");case k._this:return i=this.startNode(),this.next(),this.finishNode(i,"ThisExpression");case k.name:var r=this.start,a=this.startLoc,o=this.containsEsc,l=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&l.name==="async"&&!this.canInsertSemicolon()&&this.eat(k._function))return this.overrideContext(Yt.f_expr),this.parseFunction(this.startNodeAt(r,a),0,!1,!0,e);if(s&&!this.canInsertSemicolon()){if(this.eat(k.arrow))return this.parseArrowExpression(this.startNodeAt(r,a),[l],!1,e);if(this.options.ecmaVersion>=8&&l.name==="async"&&this.type===k.name&&!o&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return l=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(k.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,a),[l],!0,e)}return l;case k.regexp:var c=this.value;return i=this.parseLiteral(c.value),i.regex={pattern:c.pattern,flags:c.flags},i;case k.num:case k.string:return this.parseLiteral(this.value);case k._null:case k._true:case k._false:return i=this.startNode(),i.value=this.type===k._null?null:this.type===k._true,i.raw=this.type.keyword,this.next(),this.finishNode(i,"Literal");case k.parenL:var u=this.start,h=this.parseParenAndDistinguishExpression(s,e);return n&&(n.parenthesizedAssign<0&&!this.isSimpleAssignTarget(h)&&(n.parenthesizedAssign=u),n.parenthesizedBind<0&&(n.parenthesizedBind=u)),h;case k.bracketL:return i=this.startNode(),this.next(),i.elements=this.parseExprList(k.bracketR,!0,!0,n),this.finishNode(i,"ArrayExpression");case k.braceL:return this.overrideContext(Yt.b_expr),this.parseObj(!1,n);case k._function:return i=this.startNode(),this.next(),this.parseFunction(i,0);case k._class:return this.parseClass(this.startNode(),!1);case k._new:return this.parseNew();case k.backQuote:return this.parseTemplate();case k._import:return this.options.ecmaVersion>=11?this.parseExprImport(t):this.unexpected();default:return this.parseExprAtomDefault()}};He.parseExprAtomDefault=function(){this.unexpected()};He.parseExprImport=function(n){var e=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===k.parenL&&!n)return this.parseDynamicImport(e);if(this.type===k.dot){var t=this.startNodeAt(e.start,e.loc&&e.loc.start);return t.name="import",e.meta=this.finishNode(t,"Identifier"),this.parseImportMeta(e)}else this.unexpected()};He.parseDynamicImport=function(n){if(this.next(),n.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(k.parenR)?n.options=null:(this.expect(k.comma),this.afterTrailingComma(k.parenR)?n.options=null:(n.options=this.parseMaybeAssign(),this.eat(k.parenR)||(this.expect(k.comma),this.afterTrailingComma(k.parenR)||this.unexpected())));else if(!this.eat(k.parenR)){var e=this.start;this.eat(k.comma)&&this.eat(k.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(n,"ImportExpression")};He.parseImportMeta=function(n){this.next();var e=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="meta"&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(n.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(n.start,"Cannot use 'import.meta' outside a module"),this.finishNode(n,"MetaProperty")};He.parseLiteral=function(n){var e=this.startNode();return e.value=n,e.raw=this.input.slice(this.start,this.end),e.raw.charCodeAt(e.raw.length-1)===110&&(e.bigint=e.value!=null?e.value.toString():e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")};He.parseParenExpression=function(){this.expect(k.parenL);var n=this.parseExpression();return this.expect(k.parenR),n};He.shouldParseArrow=function(n){return!this.canInsertSemicolon()};He.parseParenAndDistinguishExpression=function(n,e){var t=this.start,i=this.startLoc,s,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a=this.start,o=this.startLoc,l=[],c=!0,u=!1,h=new su,d=this.yieldPos,f=this.awaitPos,m;for(this.yieldPos=0,this.awaitPos=0;this.type!==k.parenR;)if(c?c=!1:this.expect(k.comma),r&&this.afterTrailingComma(k.parenR,!0)){u=!0;break}else if(this.type===k.ellipsis){m=this.start,l.push(this.parseParenItem(this.parseRestBinding())),this.type===k.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else l.push(this.parseMaybeAssign(!1,h,this.parseParenItem));var g=this.lastTokEnd,y=this.lastTokEndLoc;if(this.expect(k.parenR),n&&this.shouldParseArrow(l)&&this.eat(k.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=d,this.awaitPos=f,this.parseParenArrowList(t,i,l,e);(!l.length||u)&&this.unexpected(this.lastTokStart),m&&this.unexpected(m),this.checkExpressionErrors(h,!0),this.yieldPos=d||this.yieldPos,this.awaitPos=f||this.awaitPos,l.length>1?(s=this.startNodeAt(a,o),s.expressions=l,this.finishNodeAt(s,"SequenceExpression",g,y)):s=l[0]}else s=this.parseParenExpression();if(this.options.preserveParens){var b=this.startNodeAt(t,i);return b.expression=s,this.finishNode(b,"ParenthesizedExpression")}else return s};He.parseParenItem=function(n){return n};He.parseParenArrowList=function(n,e,t,i){return this.parseArrowExpression(this.startNodeAt(n,e),t,!1,i)};var ID=[];He.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var n=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===k.dot){var e=this.startNodeAt(n.start,n.loc&&n.loc.start);e.name="new",n.meta=this.finishNode(e,"Identifier"),this.next();var t=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="target"&&this.raiseRecoverable(n.property.start,"The only valid meta property for new is 'new.target'"),t&&this.raiseRecoverable(n.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(n.start,"'new.target' can only be used in functions and class static block"),this.finishNode(n,"MetaProperty")}var i=this.start,s=this.startLoc;return n.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),i,s,!0,!1),this.eat(k.parenL)?n.arguments=this.parseExprList(k.parenR,this.options.ecmaVersion>=8,!1):n.arguments=ID,this.finishNode(n,"NewExpression")};He.parseTemplateElement=function(n){var e=n.isTagged,t=this.startNode();return this.type===k.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),t.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):t.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),t.tail=this.type===k.backQuote,this.finishNode(t,"TemplateElement")};He.parseTemplate=function(n){n===void 0&&(n={});var e=n.isTagged;e===void 0&&(e=!1);var t=this.startNode();this.next(),t.expressions=[];var i=this.parseTemplateElement({isTagged:e});for(t.quasis=[i];!i.tail;)this.type===k.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(k.dollarBraceL),t.expressions.push(this.parseExpression()),this.expect(k.braceR),t.quasis.push(i=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(t,"TemplateLiteral")};He.isAsyncProp=function(n){return!n.computed&&n.key.type==="Identifier"&&n.key.name==="async"&&(this.type===k.name||this.type===k.num||this.type===k.string||this.type===k.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===k.star)&&!ei.test(this.input.slice(this.lastTokEnd,this.start))};He.parseObj=function(n,e){var t=this.startNode(),i=!0,s={};for(t.properties=[],this.next();!this.eat(k.braceR);){if(i)i=!1;else if(this.expect(k.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(k.braceR))break;var r=this.parseProperty(n,e);n||this.checkPropClash(r,s,e),t.properties.push(r)}return this.finishNode(t,n?"ObjectPattern":"ObjectExpression")};He.parseProperty=function(n,e){var t=this.startNode(),i,s,r,a;if(this.options.ecmaVersion>=9&&this.eat(k.ellipsis))return n?(t.argument=this.parseIdent(!1),this.type===k.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(t,"RestElement")):(t.argument=this.parseMaybeAssign(!1,e),this.type===k.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(t,"SpreadElement"));this.options.ecmaVersion>=6&&(t.method=!1,t.shorthand=!1,(n||e)&&(r=this.start,a=this.startLoc),n||(i=this.eat(k.star)));var o=this.containsEsc;return this.parsePropertyName(t),!n&&!o&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(t)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(k.star),this.parsePropertyName(t)):s=!1,this.parsePropertyValue(t,n,i,s,r,a,e,o),this.finishNode(t,"Property")};He.parseGetterSetter=function(n){var e=n.key.name;this.parsePropertyName(n),n.value=this.parseMethod(!1),n.kind=e;var t=n.kind==="get"?0:1;if(n.value.params.length!==t){var i=n.value.start;n.kind==="get"?this.raiseRecoverable(i,"getter should have no params"):this.raiseRecoverable(i,"setter should have exactly one param")}else n.kind==="set"&&n.value.params[0].type==="RestElement"&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params")};He.parsePropertyValue=function(n,e,t,i,s,r,a,o){(t||i)&&this.type===k.colon&&this.unexpected(),this.eat(k.colon)?(n.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),n.kind="init"):this.options.ecmaVersion>=6&&this.type===k.parenL?(e&&this.unexpected(),n.method=!0,n.value=this.parseMethod(t,i),n.kind="init"):!e&&!o&&this.options.ecmaVersion>=5&&!n.computed&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")&&this.type!==k.comma&&this.type!==k.braceR&&this.type!==k.eq?((t||i)&&this.unexpected(),this.parseGetterSetter(n)):this.options.ecmaVersion>=6&&!n.computed&&n.key.type==="Identifier"?((t||i)&&this.unexpected(),this.checkUnreserved(n.key),n.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=s),e?n.value=this.parseMaybeDefault(s,r,this.copyNode(n.key)):this.type===k.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),n.value=this.parseMaybeDefault(s,r,this.copyNode(n.key))):n.value=this.copyNode(n.key),n.kind="init",n.shorthand=!0):this.unexpected()};He.parsePropertyName=function(n){if(this.options.ecmaVersion>=6){if(this.eat(k.bracketL))return n.computed=!0,n.key=this.parseMaybeAssign(),this.expect(k.bracketR),n.key;n.computed=!1}return n.key=this.type===k.num||this.type===k.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};He.initFunction=function(n){n.id=null,this.options.ecmaVersion>=6&&(n.generator=n.expression=!1),this.options.ecmaVersion>=8&&(n.async=!1)};He.parseMethod=function(n,e,t){var i=this.startNode(),s=this.yieldPos,r=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=n),this.options.ecmaVersion>=8&&(i.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(qd(e,i.generator)|nu|(t?ky:0)),this.expect(k.parenL),i.params=this.parseBindingList(k.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1,!0,!1),this.yieldPos=s,this.awaitPos=r,this.awaitIdentPos=a,this.finishNode(i,"FunctionExpression")};He.parseArrowExpression=function(n,e,t,i){var s=this.yieldPos,r=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(qd(t,!1)|Ud),this.initFunction(n),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,n.params=this.toAssignableList(e,!0),this.parseFunctionBody(n,!0,!1,i),this.yieldPos=s,this.awaitPos=r,this.awaitIdentPos=a,this.finishNode(n,"ArrowFunctionExpression")};He.parseFunctionBody=function(n,e,t,i){var s=e&&this.type!==k.braceL,r=this.strict,a=!1;if(s)n.body=this.parseMaybeAssign(i),n.expression=!0,this.checkParams(n,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(n.params);(!r||o)&&(a=this.strictDirective(this.end),a&&o&&this.raiseRecoverable(n.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var l=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(n,!r&&!a&&!e&&!t&&this.isSimpleParamList(n.params)),this.strict&&n.id&&this.checkLValSimple(n.id,$y),n.body=this.parseBlock(!1,void 0,a&&!r),n.expression=!1,this.adaptDirectivePrologue(n.body.body),this.labels=l}this.exitScope()};He.isSimpleParamList=function(n){for(var e=0,t=n;e<t.length;e+=1){var i=t[e];if(i.type!=="Identifier")return!1}return!0};He.checkParams=function(n,e){for(var t=Object.create(null),i=0,s=n.params;i<s.length;i+=1){var r=s[i];this.checkLValInnerPattern(r,Wd,e?null:t)}};He.parseExprList=function(n,e,t,i){for(var s=[],r=!0;!this.eat(n);){if(r)r=!1;else if(this.expect(k.comma),e&&this.afterTrailingComma(n))break;var a=void 0;t&&this.type===k.comma?a=null:this.type===k.ellipsis?(a=this.parseSpread(i),i&&this.type===k.comma&&i.trailingComma<0&&(i.trailingComma=this.start)):a=this.parseMaybeAssign(!1,i),s.push(a)}return s};He.checkUnreserved=function(n){var e=n.start,t=n.end,i=n.name;if(this.inGenerator&&i==="yield"&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&iu)&&i==="arguments"&&this.raiseRecoverable(e,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(i==="arguments"||i==="await")&&this.raise(e,"Cannot use "+i+" in class static initialization block"),this.keywords.test(i)&&this.raise(e,"Unexpected keyword '"+i+"'"),!(this.options.ecmaVersion<6&&this.input.slice(e,t).indexOf("\\")!==-1)){var s=this.strict?this.reservedWordsStrict:this.reservedWords;s.test(i)&&(!this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+i+"' is reserved"))}};He.parseIdent=function(n){var e=this.parseIdentNode();return this.next(!!n),this.finishNode(e,"Identifier"),n||(this.checkUnreserved(e),e.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=e.start)),e};He.parseIdentNode=function(){var n=this.startNode();return this.type===k.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,(n.name==="class"||n.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=k.name):this.unexpected(),n};He.parsePrivateIdent=function(){var n=this.startNode();return this.type===k.privateId?n.name=this.value:this.unexpected(),this.next(),this.finishNode(n,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(n.start,"Private field '#"+n.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(n)),n};He.parseYield=function(n){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===k.semi||this.canInsertSemicolon()||this.type!==k.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(k.star),e.argument=this.parseMaybeAssign(n)),this.finishNode(e,"YieldExpression")};He.parseAwait=function(n){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0,!1,n),this.finishNode(e,"AwaitExpression")};var Al=yn.prototype;Al.raise=function(n,e){var t=Ay(this.input,n);e+=" ("+t.line+":"+t.column+")",this.sourceFile&&(e+=" in "+this.sourceFile);var i=new SyntaxError(e);throw i.pos=n,i.loc=t,i.raisedAt=this.pos,i};Al.raiseRecoverable=Al.raise;Al.curPosition=function(){if(this.options.locations)return new Wa(this.curLine,this.pos-this.lineStart)};var Xs=yn.prototype,LD=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};Xs.enterScope=function(n){this.scopeStack.push(new LD(n))};Xs.exitScope=function(){this.scopeStack.pop()};Xs.treatFunctionsAsVarInScope=function(n){return n.flags&ta||!this.inModule&&n.flags&Xa};Xs.declareName=function(n,e,t){var i=!1;if(e===As){var s=this.currentScope();i=s.lexical.indexOf(n)>-1||s.functions.indexOf(n)>-1||s.var.indexOf(n)>-1,s.lexical.push(n),this.inModule&&s.flags&Xa&&delete this.undefinedExports[n]}else if(e===Dy){var r=this.currentScope();r.lexical.push(n)}else if(e===My){var a=this.currentScope();this.treatFunctionsAsVar?i=a.lexical.indexOf(n)>-1:i=a.lexical.indexOf(n)>-1||a.var.indexOf(n)>-1,a.functions.push(n)}else for(var o=this.scopeStack.length-1;o>=0;--o){var l=this.scopeStack[o];if(l.lexical.indexOf(n)>-1&&!(l.flags&Ey&&l.lexical[0]===n)||!this.treatFunctionsAsVarInScope(l)&&l.functions.indexOf(n)>-1){i=!0;break}if(l.var.push(n),this.inModule&&l.flags&Xa&&delete this.undefinedExports[n],l.flags&iu)break}i&&this.raiseRecoverable(t,"Identifier '"+n+"' has already been declared")};Xs.checkLocalExport=function(n){this.scopeStack[0].lexical.indexOf(n.name)===-1&&this.scopeStack[0].var.indexOf(n.name)===-1&&(this.undefinedExports[n.name]=n)};Xs.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};Xs.currentVarScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&(iu|ao|Sr))return e}};Xs.currentThisScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&(iu|ao|Sr)&&!(e.flags&Ud))return e}};var ru=function(e,t,i){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new tu(e,i)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},oo=yn.prototype;oo.startNode=function(){return new ru(this,this.start,this.startLoc)};oo.startNodeAt=function(n,e){return new ru(this,n,e)};function Ny(n,e,t,i){return n.type=e,n.end=t,this.options.locations&&(n.loc.end=i),this.options.ranges&&(n.range[1]=t),n}oo.finishNode=function(n,e){return Ny.call(this,n,e,this.lastTokEnd,this.lastTokEndLoc)};oo.finishNodeAt=function(n,e,t,i){return Ny.call(this,n,e,t,i)};oo.copyNode=function(n){var e=new ru(this,n.start,this.startLoc);for(var t in n)e[t]=n[t];return e};var QD="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",By="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Fy=By+" Extended_Pictographic",Ry=Fy,Iy=Ry+" EBase EComp EMod EPres ExtPict",Ly=Iy,VD=Ly,zD={9:By,10:Fy,11:Ry,12:Iy,13:Ly,14:VD},jD="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",ZD={9:"",10:"",11:"",12:"",13:"",14:jD},_m="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Qy="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Vy=Qy+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",zy=Vy+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",jy=zy+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",Zy=jy+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",GD=Zy+" "+QD,UD={9:Qy,10:Vy,11:zy,12:jy,13:Zy,14:GD},Gy={};function qD(n){var e=Gy[n]={binary:Ls(zD[n]+" "+_m),binaryOfStrings:Ls(ZD[n]),nonBinary:{General_Category:Ls(_m),Script:Ls(UD[n])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}for(var ic=0,Nm=[9,10,11,12,13,14];ic<Nm.length;ic+=1){var WD=Nm[ic];qD(WD)}var _e=yn.prototype,xl=function(e,t){this.parent=e,this.base=t||this};xl.prototype.separatedFrom=function(e){for(var t=this;t;t=t.parent)for(var i=e;i;i=i.parent)if(t.base===i.base&&t!==i)return!0;return!1};xl.prototype.sibling=function(){return new xl(this.parent,this.base)};var ps=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":"")+(e.options.ecmaVersion>=13?"d":"")+(e.options.ecmaVersion>=15?"v":""),this.unicodeProperties=Gy[e.options.ecmaVersion>=14?14:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};ps.prototype.reset=function(e,t,i){var s=i.indexOf("v")!==-1,r=i.indexOf("u")!==-1;this.start=e|0,this.source=t+"",this.flags=i,s&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=r&&this.parser.options.ecmaVersion>=9)};ps.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)};ps.prototype.at=function(e,t){t===void 0&&(t=!1);var i=this.source,s=i.length;if(e>=s)return-1;var r=i.charCodeAt(e);if(!(t||this.switchU)||r<=55295||r>=57344||e+1>=s)return r;var a=i.charCodeAt(e+1);return a>=56320&&a<=57343?(r<<10)+a-56613888:r};ps.prototype.nextIndex=function(e,t){t===void 0&&(t=!1);var i=this.source,s=i.length;if(e>=s)return s;var r=i.charCodeAt(e),a;return!(t||this.switchU)||r<=55295||r>=57344||e+1>=s||(a=i.charCodeAt(e+1))<56320||a>57343?e+1:e+2};ps.prototype.current=function(e){return e===void 0&&(e=!1),this.at(this.pos,e)};ps.prototype.lookahead=function(e){return e===void 0&&(e=!1),this.at(this.nextIndex(this.pos,e),e)};ps.prototype.advance=function(e){e===void 0&&(e=!1),this.pos=this.nextIndex(this.pos,e)};ps.prototype.eat=function(e,t){return t===void 0&&(t=!1),this.current(t)===e?(this.advance(t),!0):!1};ps.prototype.eatChars=function(e,t){t===void 0&&(t=!1);for(var i=this.pos,s=0,r=e;s<r.length;s+=1){var a=r[s],o=this.at(i,t);if(o===-1||o!==a)return!1;i=this.nextIndex(i,t)}return this.pos=i,!0};_e.validateRegExpFlags=function(n){for(var e=n.validFlags,t=n.flags,i=!1,s=!1,r=0;r<t.length;r++){var a=t.charAt(r);e.indexOf(a)===-1&&this.raise(n.start,"Invalid regular expression flag"),t.indexOf(a,r+1)>-1&&this.raise(n.start,"Duplicate regular expression flag"),a==="u"&&(i=!0),a==="v"&&(s=!0)}this.options.ecmaVersion>=15&&i&&s&&this.raise(n.start,"Invalid regular expression flag")};function XD(n){for(var e in n)return!0;return!1}_e.validateRegExpPattern=function(n){this.regexp_pattern(n),!n.switchN&&this.options.ecmaVersion>=9&&XD(n.groupNames)&&(n.switchN=!0,this.regexp_pattern(n))};_e.regexp_pattern=function(n){n.pos=0,n.lastIntValue=0,n.lastStringValue="",n.lastAssertionIsQuantifiable=!1,n.numCapturingParens=0,n.maxBackReference=0,n.groupNames=Object.create(null),n.backReferenceNames.length=0,n.branchID=null,this.regexp_disjunction(n),n.pos!==n.source.length&&(n.eat(41)&&n.raise("Unmatched ')'"),(n.eat(93)||n.eat(125))&&n.raise("Lone quantifier brackets")),n.maxBackReference>n.numCapturingParens&&n.raise("Invalid escape");for(var e=0,t=n.backReferenceNames;e<t.length;e+=1){var i=t[e];n.groupNames[i]||n.raise("Invalid named capture referenced")}};_e.regexp_disjunction=function(n){var e=this.options.ecmaVersion>=16;for(e&&(n.branchID=new xl(n.branchID,null)),this.regexp_alternative(n);n.eat(124);)e&&(n.branchID=n.branchID.sibling()),this.regexp_alternative(n);e&&(n.branchID=n.branchID.parent),this.regexp_eatQuantifier(n,!0)&&n.raise("Nothing to repeat"),n.eat(123)&&n.raise("Lone quantifier brackets")};_e.regexp_alternative=function(n){for(;n.pos<n.source.length&&this.regexp_eatTerm(n););};_e.regexp_eatTerm=function(n){return this.regexp_eatAssertion(n)?(n.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(n)&&n.switchU&&n.raise("Invalid quantifier"),!0):(n.switchU?this.regexp_eatAtom(n):this.regexp_eatExtendedAtom(n))?(this.regexp_eatQuantifier(n),!0):!1};_e.regexp_eatAssertion=function(n){var e=n.pos;if(n.lastAssertionIsQuantifiable=!1,n.eat(94)||n.eat(36))return!0;if(n.eat(92)){if(n.eat(66)||n.eat(98))return!0;n.pos=e}if(n.eat(40)&&n.eat(63)){var t=!1;if(this.options.ecmaVersion>=9&&(t=n.eat(60)),n.eat(61)||n.eat(33))return this.regexp_disjunction(n),n.eat(41)||n.raise("Unterminated group"),n.lastAssertionIsQuantifiable=!t,!0}return n.pos=e,!1};_e.regexp_eatQuantifier=function(n,e){return e===void 0&&(e=!1),this.regexp_eatQuantifierPrefix(n,e)?(n.eat(63),!0):!1};_e.regexp_eatQuantifierPrefix=function(n,e){return n.eat(42)||n.eat(43)||n.eat(63)||this.regexp_eatBracedQuantifier(n,e)};_e.regexp_eatBracedQuantifier=function(n,e){var t=n.pos;if(n.eat(123)){var i=0,s=-1;if(this.regexp_eatDecimalDigits(n)&&(i=n.lastIntValue,n.eat(44)&&this.regexp_eatDecimalDigits(n)&&(s=n.lastIntValue),n.eat(125)))return s!==-1&&s<i&&!e&&n.raise("numbers out of order in {} quantifier"),!0;n.switchU&&!e&&n.raise("Incomplete quantifier"),n.pos=t}return!1};_e.regexp_eatAtom=function(n){return this.regexp_eatPatternCharacters(n)||n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)};_e.regexp_eatReverseSolidusAtomEscape=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatAtomEscape(n))return!0;n.pos=e}return!1};_e.regexp_eatUncapturingGroup=function(n){var e=n.pos;if(n.eat(40)){if(n.eat(63)){if(this.options.ecmaVersion>=16){var t=this.regexp_eatModifiers(n),i=n.eat(45);if(t||i){for(var s=0;s<t.length;s++){var r=t.charAt(s);t.indexOf(r,s+1)>-1&&n.raise("Duplicate regular expression modifiers")}if(i){var a=this.regexp_eatModifiers(n);!t&&!a&&n.current()===58&&n.raise("Invalid regular expression modifiers");for(var o=0;o<a.length;o++){var l=a.charAt(o);(a.indexOf(l,o+1)>-1||t.indexOf(l)>-1)&&n.raise("Duplicate regular expression modifiers")}}}}if(n.eat(58)){if(this.regexp_disjunction(n),n.eat(41))return!0;n.raise("Unterminated group")}}n.pos=e}return!1};_e.regexp_eatCapturingGroup=function(n){if(n.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(n):n.current()===63&&n.raise("Invalid group"),this.regexp_disjunction(n),n.eat(41))return n.numCapturingParens+=1,!0;n.raise("Unterminated group")}return!1};_e.regexp_eatModifiers=function(n){for(var e="",t=0;(t=n.current())!==-1&&HD(t);)e+=ws(t),n.advance();return e};function HD(n){return n===105||n===109||n===115}_e.regexp_eatExtendedAtom=function(n){return n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)||this.regexp_eatInvalidBracedQuantifier(n)||this.regexp_eatExtendedPatternCharacter(n)};_e.regexp_eatInvalidBracedQuantifier=function(n){return this.regexp_eatBracedQuantifier(n,!0)&&n.raise("Nothing to repeat"),!1};_e.regexp_eatSyntaxCharacter=function(n){var e=n.current();return Uy(e)?(n.lastIntValue=e,n.advance(),!0):!1};function Uy(n){return n===36||n>=40&&n<=43||n===46||n===63||n>=91&&n<=94||n>=123&&n<=125}_e.regexp_eatPatternCharacters=function(n){for(var e=n.pos,t=0;(t=n.current())!==-1&&!Uy(t);)n.advance();return n.pos!==e};_e.regexp_eatExtendedPatternCharacter=function(n){var e=n.current();return e!==-1&&e!==36&&!(e>=40&&e<=43)&&e!==46&&e!==63&&e!==91&&e!==94&&e!==124?(n.advance(),!0):!1};_e.regexp_groupSpecifier=function(n){if(n.eat(63)){this.regexp_eatGroupName(n)||n.raise("Invalid group");var e=this.options.ecmaVersion>=16,t=n.groupNames[n.lastStringValue];if(t)if(e)for(var i=0,s=t;i<s.length;i+=1){var r=s[i];r.separatedFrom(n.branchID)||n.raise("Duplicate capture group name")}else n.raise("Duplicate capture group name");e?(t||(n.groupNames[n.lastStringValue]=[])).push(n.branchID):n.groupNames[n.lastStringValue]=!0}};_e.regexp_eatGroupName=function(n){if(n.lastStringValue="",n.eat(60)){if(this.regexp_eatRegExpIdentifierName(n)&&n.eat(62))return!0;n.raise("Invalid capture group name")}return!1};_e.regexp_eatRegExpIdentifierName=function(n){if(n.lastStringValue="",this.regexp_eatRegExpIdentifierStart(n)){for(n.lastStringValue+=ws(n.lastIntValue);this.regexp_eatRegExpIdentifierPart(n);)n.lastStringValue+=ws(n.lastIntValue);return!0}return!1};_e.regexp_eatRegExpIdentifierStart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),YD(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function YD(n){return ds(n,!0)||n===36||n===95}_e.regexp_eatRegExpIdentifierPart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),KD(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function KD(n){return qs(n,!0)||n===36||n===95||n===8204||n===8205}_e.regexp_eatAtomEscape=function(n){return this.regexp_eatBackReference(n)||this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)||n.switchN&&this.regexp_eatKGroupName(n)?!0:(n.switchU&&(n.current()===99&&n.raise("Invalid unicode escape"),n.raise("Invalid escape")),!1)};_e.regexp_eatBackReference=function(n){var e=n.pos;if(this.regexp_eatDecimalEscape(n)){var t=n.lastIntValue;if(n.switchU)return t>n.maxBackReference&&(n.maxBackReference=t),!0;if(t<=n.numCapturingParens)return!0;n.pos=e}return!1};_e.regexp_eatKGroupName=function(n){if(n.eat(107)){if(this.regexp_eatGroupName(n))return n.backReferenceNames.push(n.lastStringValue),!0;n.raise("Invalid named reference")}return!1};_e.regexp_eatCharacterEscape=function(n){return this.regexp_eatControlEscape(n)||this.regexp_eatCControlLetter(n)||this.regexp_eatZero(n)||this.regexp_eatHexEscapeSequence(n)||this.regexp_eatRegExpUnicodeEscapeSequence(n,!1)||!n.switchU&&this.regexp_eatLegacyOctalEscapeSequence(n)||this.regexp_eatIdentityEscape(n)};_e.regexp_eatCControlLetter=function(n){var e=n.pos;if(n.eat(99)){if(this.regexp_eatControlLetter(n))return!0;n.pos=e}return!1};_e.regexp_eatZero=function(n){return n.current()===48&&!au(n.lookahead())?(n.lastIntValue=0,n.advance(),!0):!1};_e.regexp_eatControlEscape=function(n){var e=n.current();return e===116?(n.lastIntValue=9,n.advance(),!0):e===110?(n.lastIntValue=10,n.advance(),!0):e===118?(n.lastIntValue=11,n.advance(),!0):e===102?(n.lastIntValue=12,n.advance(),!0):e===114?(n.lastIntValue=13,n.advance(),!0):!1};_e.regexp_eatControlLetter=function(n){var e=n.current();return qy(e)?(n.lastIntValue=e%32,n.advance(),!0):!1};function qy(n){return n>=65&&n<=90||n>=97&&n<=122}_e.regexp_eatRegExpUnicodeEscapeSequence=function(n,e){e===void 0&&(e=!1);var t=n.pos,i=e||n.switchU;if(n.eat(117)){if(this.regexp_eatFixedHexDigits(n,4)){var s=n.lastIntValue;if(i&&s>=55296&&s<=56319){var r=n.pos;if(n.eat(92)&&n.eat(117)&&this.regexp_eatFixedHexDigits(n,4)){var a=n.lastIntValue;if(a>=56320&&a<=57343)return n.lastIntValue=(s-55296)*1024+(a-56320)+65536,!0}n.pos=r,n.lastIntValue=s}return!0}if(i&&n.eat(123)&&this.regexp_eatHexDigits(n)&&n.eat(125)&&JD(n.lastIntValue))return!0;i&&n.raise("Invalid unicode escape"),n.pos=t}return!1};function JD(n){return n>=0&&n<=1114111}_e.regexp_eatIdentityEscape=function(n){if(n.switchU)return this.regexp_eatSyntaxCharacter(n)?!0:n.eat(47)?(n.lastIntValue=47,!0):!1;var e=n.current();return e!==99&&(!n.switchN||e!==107)?(n.lastIntValue=e,n.advance(),!0):!1};_e.regexp_eatDecimalEscape=function(n){n.lastIntValue=0;var e=n.current();if(e>=49&&e<=57){do n.lastIntValue=10*n.lastIntValue+(e-48),n.advance();while((e=n.current())>=48&&e<=57);return!0}return!1};var Wy=0,Cs=1,Oi=2;_e.regexp_eatCharacterClassEscape=function(n){var e=n.current();if(e$(e))return n.lastIntValue=-1,n.advance(),Cs;var t=!1;if(n.switchU&&this.options.ecmaVersion>=9&&((t=e===80)||e===112)){n.lastIntValue=-1,n.advance();var i;if(n.eat(123)&&(i=this.regexp_eatUnicodePropertyValueExpression(n))&&n.eat(125))return t&&i===Oi&&n.raise("Invalid property name"),i;n.raise("Invalid property name")}return Wy};function e$(n){return n===100||n===68||n===115||n===83||n===119||n===87}_e.regexp_eatUnicodePropertyValueExpression=function(n){var e=n.pos;if(this.regexp_eatUnicodePropertyName(n)&&n.eat(61)){var t=n.lastStringValue;if(this.regexp_eatUnicodePropertyValue(n)){var i=n.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(n,t,i),Cs}}if(n.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(n)){var s=n.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(n,s)}return Wy};_e.regexp_validateUnicodePropertyNameAndValue=function(n,e,t){ea(n.unicodeProperties.nonBinary,e)||n.raise("Invalid property name"),n.unicodeProperties.nonBinary[e].test(t)||n.raise("Invalid property value")};_e.regexp_validateUnicodePropertyNameOrValue=function(n,e){if(n.unicodeProperties.binary.test(e))return Cs;if(n.switchV&&n.unicodeProperties.binaryOfStrings.test(e))return Oi;n.raise("Invalid property name")};_e.regexp_eatUnicodePropertyName=function(n){var e=0;for(n.lastStringValue="";Xy(e=n.current());)n.lastStringValue+=ws(e),n.advance();return n.lastStringValue!==""};function Xy(n){return qy(n)||n===95}_e.regexp_eatUnicodePropertyValue=function(n){var e=0;for(n.lastStringValue="";t$(e=n.current());)n.lastStringValue+=ws(e),n.advance();return n.lastStringValue!==""};function t$(n){return Xy(n)||au(n)}_e.regexp_eatLoneUnicodePropertyNameOrValue=function(n){return this.regexp_eatUnicodePropertyValue(n)};_e.regexp_eatCharacterClass=function(n){if(n.eat(91)){var e=n.eat(94),t=this.regexp_classContents(n);return n.eat(93)||n.raise("Unterminated character class"),e&&t===Oi&&n.raise("Negated character class may contain strings"),!0}return!1};_e.regexp_classContents=function(n){return n.current()===93?Cs:n.switchV?this.regexp_classSetExpression(n):(this.regexp_nonEmptyClassRanges(n),Cs)};_e.regexp_nonEmptyClassRanges=function(n){for(;this.regexp_eatClassAtom(n);){var e=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassAtom(n)){var t=n.lastIntValue;n.switchU&&(e===-1||t===-1)&&n.raise("Invalid character class"),e!==-1&&t!==-1&&e>t&&n.raise("Range out of order in character class")}}};_e.regexp_eatClassAtom=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatClassEscape(n))return!0;if(n.switchU){var t=n.current();(t===99||Ky(t))&&n.raise("Invalid class escape"),n.raise("Invalid escape")}n.pos=e}var i=n.current();return i!==93?(n.lastIntValue=i,n.advance(),!0):!1};_e.regexp_eatClassEscape=function(n){var e=n.pos;if(n.eat(98))return n.lastIntValue=8,!0;if(n.switchU&&n.eat(45))return n.lastIntValue=45,!0;if(!n.switchU&&n.eat(99)){if(this.regexp_eatClassControlLetter(n))return!0;n.pos=e}return this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)};_e.regexp_classSetExpression=function(n){var e=Cs,t;if(!this.regexp_eatClassSetRange(n))if(t=this.regexp_eatClassSetOperand(n)){t===Oi&&(e=Oi);for(var i=n.pos;n.eatChars([38,38]);){if(n.current()!==38&&(t=this.regexp_eatClassSetOperand(n))){t!==Oi&&(e=Cs);continue}n.raise("Invalid character in character class")}if(i!==n.pos)return e;for(;n.eatChars([45,45]);)this.regexp_eatClassSetOperand(n)||n.raise("Invalid character in character class");if(i!==n.pos)return e}else n.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(n)){if(t=this.regexp_eatClassSetOperand(n),!t)return e;t===Oi&&(e=Oi)}};_e.regexp_eatClassSetRange=function(n){var e=n.pos;if(this.regexp_eatClassSetCharacter(n)){var t=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassSetCharacter(n)){var i=n.lastIntValue;return t!==-1&&i!==-1&&t>i&&n.raise("Range out of order in character class"),!0}n.pos=e}return!1};_e.regexp_eatClassSetOperand=function(n){return this.regexp_eatClassSetCharacter(n)?Cs:this.regexp_eatClassStringDisjunction(n)||this.regexp_eatNestedClass(n)};_e.regexp_eatNestedClass=function(n){var e=n.pos;if(n.eat(91)){var t=n.eat(94),i=this.regexp_classContents(n);if(n.eat(93))return t&&i===Oi&&n.raise("Negated character class may contain strings"),i;n.pos=e}if(n.eat(92)){var s=this.regexp_eatCharacterClassEscape(n);if(s)return s;n.pos=e}return null};_e.regexp_eatClassStringDisjunction=function(n){var e=n.pos;if(n.eatChars([92,113])){if(n.eat(123)){var t=this.regexp_classStringDisjunctionContents(n);if(n.eat(125))return t}else n.raise("Invalid escape");n.pos=e}return null};_e.regexp_classStringDisjunctionContents=function(n){for(var e=this.regexp_classString(n);n.eat(124);)this.regexp_classString(n)===Oi&&(e=Oi);return e};_e.regexp_classString=function(n){for(var e=0;this.regexp_eatClassSetCharacter(n);)e++;return e===1?Cs:Oi};_e.regexp_eatClassSetCharacter=function(n){var e=n.pos;if(n.eat(92))return this.regexp_eatCharacterEscape(n)||this.regexp_eatClassSetReservedPunctuator(n)?!0:n.eat(98)?(n.lastIntValue=8,!0):(n.pos=e,!1);var t=n.current();return t<0||t===n.lookahead()&&n$(t)||i$(t)?!1:(n.advance(),n.lastIntValue=t,!0)};function n$(n){return n===33||n>=35&&n<=38||n>=42&&n<=44||n===46||n>=58&&n<=64||n===94||n===96||n===126}function i$(n){return n===40||n===41||n===45||n===47||n>=91&&n<=93||n>=123&&n<=125}_e.regexp_eatClassSetReservedPunctuator=function(n){var e=n.current();return s$(e)?(n.lastIntValue=e,n.advance(),!0):!1};function s$(n){return n===33||n===35||n===37||n===38||n===44||n===45||n>=58&&n<=62||n===64||n===96||n===126}_e.regexp_eatClassControlLetter=function(n){var e=n.current();return au(e)||e===95?(n.lastIntValue=e%32,n.advance(),!0):!1};_e.regexp_eatHexEscapeSequence=function(n){var e=n.pos;if(n.eat(120)){if(this.regexp_eatFixedHexDigits(n,2))return!0;n.switchU&&n.raise("Invalid escape"),n.pos=e}return!1};_e.regexp_eatDecimalDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;au(t=n.current());)n.lastIntValue=10*n.lastIntValue+(t-48),n.advance();return n.pos!==e};function au(n){return n>=48&&n<=57}_e.regexp_eatHexDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;Hy(t=n.current());)n.lastIntValue=16*n.lastIntValue+Yy(t),n.advance();return n.pos!==e};function Hy(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}function Yy(n){return n>=65&&n<=70?10+(n-65):n>=97&&n<=102?10+(n-97):n-48}_e.regexp_eatLegacyOctalEscapeSequence=function(n){if(this.regexp_eatOctalDigit(n)){var e=n.lastIntValue;if(this.regexp_eatOctalDigit(n)){var t=n.lastIntValue;e<=3&&this.regexp_eatOctalDigit(n)?n.lastIntValue=e*64+t*8+n.lastIntValue:n.lastIntValue=e*8+t}else n.lastIntValue=e;return!0}return!1};_e.regexp_eatOctalDigit=function(n){var e=n.current();return Ky(e)?(n.lastIntValue=e-48,n.advance(),!0):(n.lastIntValue=0,!1)};function Ky(n){return n>=48&&n<=55}_e.regexp_eatFixedHexDigits=function(n,e){var t=n.pos;n.lastIntValue=0;for(var i=0;i<e;++i){var s=n.current();if(!Hy(s))return n.pos=t,!1;n.lastIntValue=16*n.lastIntValue+Yy(s),n.advance()}return!0};var Hd=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new tu(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},ht=yn.prototype;ht.next=function(n){!n&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Hd(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};ht.getToken=function(){return this.next(),new Hd(this)};typeof Symbol<"u"&&(ht[Symbol.iterator]=function(){var n=this;return{next:function(){var e=n.getToken();return{done:e.type===k.eof,value:e}}}});ht.nextToken=function(){var n=this.curContext();if((!n||!n.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(k.eof);if(n.override)return n.override(this);this.readToken(this.fullCharCodeAtPos())};ht.readToken=function(n){return ds(n,this.options.ecmaVersion>=6)||n===92?this.readWord():this.getTokenFromCode(n)};ht.fullCharCodeAtPos=function(){var n=this.input.charCodeAt(this.pos);if(n<=55295||n>=56320)return n;var e=this.input.charCodeAt(this.pos+1);return e<=56319||e>=57344?n:(n<<10)+e-56613888};ht.skipBlockComment=function(){var n=this.options.onComment&&this.curPosition(),e=this.pos,t=this.input.indexOf("*/",this.pos+=2);if(t===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=t+2,this.options.locations)for(var i=void 0,s=e;(i=wy(this.input,s,this.pos))>-1;)++this.curLine,s=this.lineStart=i;this.options.onComment&&this.options.onComment(!0,this.input.slice(e+2,t),e,this.pos,n,this.curPosition())};ht.skipLineComment=function(n){for(var e=this.pos,t=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=n);this.pos<this.input.length&&!Jr(i);)i=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+n,this.pos),e,this.pos,t,this.curPosition())};ht.skipSpace=function(){e:for(;this.pos<this.input.length;){var n=this.input.charCodeAt(this.pos);switch(n){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(n>8&&n<14||n>=5760&&Cy.test(String.fromCharCode(n)))++this.pos;else break e}}};ht.finishToken=function(n,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var t=this.type;this.type=n,this.value=e,this.updateContext(t)};ht.readToken_dot=function(){var n=this.input.charCodeAt(this.pos+1);if(n>=48&&n<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&n===46&&e===46?(this.pos+=3,this.finishToken(k.ellipsis)):(++this.pos,this.finishToken(k.dot))};ht.readToken_slash=function(){var n=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):n===61?this.finishOp(k.assign,2):this.finishOp(k.slash,1)};ht.readToken_mult_modulo_exp=function(n){var e=this.input.charCodeAt(this.pos+1),t=1,i=n===42?k.star:k.modulo;return this.options.ecmaVersion>=7&&n===42&&e===42&&(++t,i=k.starstar,e=this.input.charCodeAt(this.pos+2)),e===61?this.finishOp(k.assign,t+1):this.finishOp(i,t)};ht.readToken_pipe_amp=function(n){var e=this.input.charCodeAt(this.pos+1);if(e===n){if(this.options.ecmaVersion>=12){var t=this.input.charCodeAt(this.pos+2);if(t===61)return this.finishOp(k.assign,3)}return this.finishOp(n===124?k.logicalOR:k.logicalAND,2)}return e===61?this.finishOp(k.assign,2):this.finishOp(n===124?k.bitwiseOR:k.bitwiseAND,1)};ht.readToken_caret=function(){var n=this.input.charCodeAt(this.pos+1);return n===61?this.finishOp(k.assign,2):this.finishOp(k.bitwiseXOR,1)};ht.readToken_plus_min=function(n){var e=this.input.charCodeAt(this.pos+1);return e===n?e===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||ei.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(k.incDec,2):e===61?this.finishOp(k.assign,2):this.finishOp(k.plusMin,1)};ht.readToken_lt_gt=function(n){var e=this.input.charCodeAt(this.pos+1),t=1;return e===n?(t=n===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+t)===61?this.finishOp(k.assign,t+1):this.finishOp(k.bitShift,t)):e===33&&n===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(e===61&&(t=2),this.finishOp(k.relational,t))};ht.readToken_eq_excl=function(n){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(k.equality,this.input.charCodeAt(this.pos+2)===61?3:2):n===61&&e===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(k.arrow)):this.finishOp(n===61?k.eq:k.prefix,1)};ht.readToken_question=function(){var n=this.options.ecmaVersion;if(n>=11){var e=this.input.charCodeAt(this.pos+1);if(e===46){var t=this.input.charCodeAt(this.pos+2);if(t<48||t>57)return this.finishOp(k.questionDot,2)}if(e===63){if(n>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(k.assign,3)}return this.finishOp(k.coalesce,2)}}return this.finishOp(k.question,1)};ht.readToken_numberSign=function(){var n=this.options.ecmaVersion,e=35;if(n>=13&&(++this.pos,e=this.fullCharCodeAtPos(),ds(e,!0)||e===92))return this.finishToken(k.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+ws(e)+"'")};ht.getTokenFromCode=function(n){switch(n){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(k.parenL);case 41:return++this.pos,this.finishToken(k.parenR);case 59:return++this.pos,this.finishToken(k.semi);case 44:return++this.pos,this.finishToken(k.comma);case 91:return++this.pos,this.finishToken(k.bracketL);case 93:return++this.pos,this.finishToken(k.bracketR);case 123:return++this.pos,this.finishToken(k.braceL);case 125:return++this.pos,this.finishToken(k.braceR);case 58:return++this.pos,this.finishToken(k.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(k.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(e===120||e===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(e===111||e===79)return this.readRadixNumber(8);if(e===98||e===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(n);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(n);case 124:case 38:return this.readToken_pipe_amp(n);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(n);case 60:case 62:return this.readToken_lt_gt(n);case 61:case 33:return this.readToken_eq_excl(n);case 63:return this.readToken_question();case 126:return this.finishOp(k.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+ws(n)+"'")};ht.finishOp=function(n,e){var t=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(n,t)};ht.readRegexp=function(){for(var n,e,t=this.pos;;){this.pos>=this.input.length&&this.raise(t,"Unterminated regular expression");var i=this.input.charAt(this.pos);if(ei.test(i)&&this.raise(t,"Unterminated regular expression"),n)n=!1;else{if(i==="[")e=!0;else if(i==="]"&&e)e=!1;else if(i==="/"&&!e)break;n=i==="\\"}++this.pos}var s=this.input.slice(t,this.pos);++this.pos;var r=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(r);var o=this.regexpState||(this.regexpState=new ps(this));o.reset(t,s,a),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var l=null;try{l=new RegExp(s,a)}catch{}return this.finishToken(k.regexp,{pattern:s,flags:a,value:l})};ht.readInt=function(n,e,t){for(var i=this.options.ecmaVersion>=12&&e===void 0,s=t&&this.input.charCodeAt(this.pos)===48,r=this.pos,a=0,o=0,l=0,c=e??1/0;l<c;++l,++this.pos){var u=this.input.charCodeAt(this.pos),h=void 0;if(i&&u===95){s&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),o===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),l===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),o=u;continue}if(u>=97?h=u-97+10:u>=65?h=u-65+10:u>=48&&u<=57?h=u-48:h=1/0,h>=n)break;o=u,a=a*n+h}return i&&o===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===r||e!=null&&this.pos-r!==e?null:a};function r$(n,e){return e?parseInt(n,8):parseFloat(n.replace(/_/g,""))}function Jy(n){return typeof BigInt!="function"?null:BigInt(n.replace(/_/g,""))}ht.readRadixNumber=function(n){var e=this.pos;this.pos+=2;var t=this.readInt(n);return t==null&&this.raise(this.start+2,"Expected number in radix "+n),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(t=Jy(this.input.slice(e,this.pos)),++this.pos):ds(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(k.num,t)};ht.readNumber=function(n){var e=this.pos;!n&&this.readInt(10,void 0,!0)===null&&this.raise(e,"Invalid number");var t=this.pos-e>=2&&this.input.charCodeAt(e)===48;t&&this.strict&&this.raise(e,"Invalid number");var i=this.input.charCodeAt(this.pos);if(!t&&!n&&this.options.ecmaVersion>=11&&i===110){var s=Jy(this.input.slice(e,this.pos));return++this.pos,ds(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(k.num,s)}t&&/[89]/.test(this.input.slice(e,this.pos))&&(t=!1),i===46&&!t&&(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),(i===69||i===101)&&!t&&(i=this.input.charCodeAt(++this.pos),(i===43||i===45)&&++this.pos,this.readInt(10)===null&&this.raise(e,"Invalid number")),ds(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=r$(this.input.slice(e,this.pos),t);return this.finishToken(k.num,r)};ht.readCodePoint=function(){var n=this.input.charCodeAt(this.pos),e;if(n===123){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e};ht.readString=function(n){for(var e="",t=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var i=this.input.charCodeAt(this.pos);if(i===n)break;i===92?(e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!1),t=this.pos):i===8232||i===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(Jr(i)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(t,this.pos++),this.finishToken(k.string,e)};var eb={};ht.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n===eb)this.readInvalidTemplateToken();else throw n}this.inTemplateElement=!1};ht.invalidStringToken=function(n,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw eb;this.raise(n,e)};ht.readTmplToken=function(){for(var n="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var t=this.input.charCodeAt(this.pos);if(t===96||t===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===k.template||this.type===k.invalidTemplate)?t===36?(this.pos+=2,this.finishToken(k.dollarBraceL)):(++this.pos,this.finishToken(k.backQuote)):(n+=this.input.slice(e,this.pos),this.finishToken(k.template,n));if(t===92)n+=this.input.slice(e,this.pos),n+=this.readEscapedChar(!0),e=this.pos;else if(Jr(t)){switch(n+=this.input.slice(e,this.pos),++this.pos,t){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:n+=`
`;break;default:n+=String.fromCharCode(t);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}};ht.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(k.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")};ht.readEscapedChar=function(n){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ws(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),n){var t=this.pos-1;this.invalidStringToken(t,"Invalid escape sequence in template string")}default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],s=parseInt(i,8);return s>255&&(i=i.slice(0,-1),s=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),(i!=="0"||e===56||e===57)&&(this.strict||n)&&this.invalidStringToken(this.pos-1-i.length,n?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(s)}return Jr(e)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(e)}};ht.readHexChar=function(n){var e=this.pos,t=this.readInt(16,n);return t===null&&this.invalidStringToken(e,"Bad character escape sequence"),t};ht.readWord1=function(){this.containsEsc=!1;for(var n="",e=!0,t=this.pos,i=this.options.ecmaVersion>=6;this.pos<this.input.length;){var s=this.fullCharCodeAtPos();if(qs(s,i))this.pos+=s<=65535?1:2;else if(s===92){this.containsEsc=!0,n+=this.input.slice(t,this.pos);var r=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?ds:qs)(a,i)||this.invalidStringToken(r,"Invalid Unicode escape"),n+=ws(a),t=this.pos}else break;e=!1}return n+this.input.slice(t,this.pos)};ht.readWord=function(){var n=this.readWord1(),e=k.name;return this.keywords.test(n)&&(e=Zd[n]),this.finishToken(e,n)};var a$="8.15.0";yn.acorn={Parser:yn,version:a$,defaultOptions:Zh,Position:Wa,SourceLocation:tu,getLineInfo:Ay,Node:ru,TokenType:Ot,tokTypes:k,keywordTypes:Zd,TokContext:$i,tokContexts:Yt,isIdentifierChar:qs,isIdentifierStart:ds,Token:Hd,isNewLine:Jr,lineBreak:ei,lineBreakG:kD,nonASCIIwhitespace:Cy};function o$(n,e){return yn.parse(n,e)}var l$=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function L5(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}),t}var sc={},rc={},Bm;function u$(){return Bm||(Bm=1,(function(n){(function e(t){var i,s,r,a,o,l;function c(C){var E={},A,B;for(A in C)C.hasOwnProperty(A)&&(B=C[A],typeof B=="object"&&B!==null?E[A]=c(B):E[A]=B);return E}function u(C,E){var A,B,Z,q;for(B=C.length,Z=0;B;)A=B>>>1,q=Z+A,E(C[q])?B=A:(Z=q+1,B-=A+1);return Z}i={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ChainExpression:"ChainExpression",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportExpression:"ImportExpression",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",PrivateIdentifier:"PrivateIdentifier",Program:"Program",Property:"Property",PropertyDefinition:"PropertyDefinition",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},r={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ChainExpression:["expression"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportExpression:["source"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],PrivateIdentifier:[],Program:["body"],Property:["key","value"],PropertyDefinition:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},a={},o={},l={},s={Break:a,Skip:o,Remove:l};function h(C,E){this.parent=C,this.key=E}h.prototype.replace=function(E){this.parent[this.key]=E},h.prototype.remove=function(){return Array.isArray(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)};function d(C,E,A,B){this.node=C,this.path=E,this.wrap=A,this.ref=B}function f(){}f.prototype.path=function(){var E,A,B,Z,q,X;function j(H,se){if(Array.isArray(se))for(B=0,Z=se.length;B<Z;++B)H.push(se[B]);else H.push(se)}if(!this.__current.path)return null;for(q=[],E=2,A=this.__leavelist.length;E<A;++E)X=this.__leavelist[E],j(q,X.path);return j(q,this.__current.path),q},f.prototype.type=function(){var C=this.current();return C.type||this.__current.wrap},f.prototype.parents=function(){var E,A,B;for(B=[],E=1,A=this.__leavelist.length;E<A;++E)B.push(this.__leavelist[E].node);return B},f.prototype.current=function(){return this.__current.node},f.prototype.__execute=function(E,A){var B,Z;return Z=void 0,B=this.__current,this.__current=A,this.__state=null,E&&(Z=E.call(this,A.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=B,Z},f.prototype.notify=function(E){this.__state=E},f.prototype.skip=function(){this.notify(o)},f.prototype.break=function(){this.notify(a)},f.prototype.remove=function(){this.notify(l)},f.prototype.__initialize=function(C,E){this.visitor=E,this.root=C,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback=null,E.fallback==="iteration"?this.__fallback=Object.keys:typeof E.fallback=="function"&&(this.__fallback=E.fallback),this.__keys=r,E.keys&&(this.__keys=Object.assign(Object.create(this.__keys),E.keys))};function m(C){return C==null?!1:typeof C=="object"&&typeof C.type=="string"}function g(C,E){return(C===i.ObjectExpression||C===i.ObjectPattern)&&E==="properties"}function y(C,E){for(var A=C.length-1;A>=0;--A)if(C[A].node===E)return!0;return!1}f.prototype.traverse=function(E,A){var B,Z,q,X,j,H,se,oe,Pe,Me,Be,Ke;for(this.__initialize(E,A),Ke={},B=this.__worklist,Z=this.__leavelist,B.push(new d(E,null,null,null)),Z.push(new d(null,null,null,null));B.length;){if(q=B.pop(),q===Ke){if(q=Z.pop(),H=this.__execute(A.leave,q),this.__state===a||H===a)return;continue}if(q.node){if(H=this.__execute(A.enter,q),this.__state===a||H===a)return;if(B.push(Ke),Z.push(q),this.__state===o||H===o)continue;if(X=q.node,j=X.type||q.wrap,Me=this.__keys[j],!Me)if(this.__fallback)Me=this.__fallback(X);else throw new Error("Unknown node type "+j+".");for(oe=Me.length;(oe-=1)>=0;)if(se=Me[oe],Be=X[se],!!Be){if(Array.isArray(Be)){for(Pe=Be.length;(Pe-=1)>=0;)if(Be[Pe]&&!y(Z,Be[Pe])){if(g(j,Me[oe]))q=new d(Be[Pe],[se,Pe],"Property",null);else if(m(Be[Pe]))q=new d(Be[Pe],[se,Pe],null,null);else continue;B.push(q)}}else if(m(Be)){if(y(Z,Be))continue;B.push(new d(Be,se,null,null))}}}}},f.prototype.replace=function(E,A){var B,Z,q,X,j,H,se,oe,Pe,Me,Be,Ke,Ct;function yt(he){var et,pe,Et,Ze;if(he.ref.remove()){for(pe=he.ref.key,Ze=he.ref.parent,et=B.length;et--;)if(Et=B[et],Et.ref&&Et.ref.parent===Ze){if(Et.ref.key<pe)break;--Et.ref.key}}}for(this.__initialize(E,A),Be={},B=this.__worklist,Z=this.__leavelist,Ke={root:E},H=new d(E,null,null,new h(Ke,"root")),B.push(H),Z.push(H);B.length;){if(H=B.pop(),H===Be){if(H=Z.pop(),j=this.__execute(A.leave,H),j!==void 0&&j!==a&&j!==o&&j!==l&&H.ref.replace(j),(this.__state===l||j===l)&&yt(H),this.__state===a||j===a)return Ke.root;continue}if(j=this.__execute(A.enter,H),j!==void 0&&j!==a&&j!==o&&j!==l&&(H.ref.replace(j),H.node=j),(this.__state===l||j===l)&&(yt(H),H.node=null),this.__state===a||j===a)return Ke.root;if(q=H.node,!!q&&(B.push(Be),Z.push(H),!(this.__state===o||j===o))){if(X=q.type||H.wrap,Pe=this.__keys[X],!Pe)if(this.__fallback)Pe=this.__fallback(q);else throw new Error("Unknown node type "+X+".");for(se=Pe.length;(se-=1)>=0;)if(Ct=Pe[se],Me=q[Ct],!!Me)if(Array.isArray(Me)){for(oe=Me.length;(oe-=1)>=0;)if(Me[oe]){if(g(X,Pe[se]))H=new d(Me[oe],[Ct,oe],"Property",new h(Me,oe));else if(m(Me[oe]))H=new d(Me[oe],[Ct,oe],null,new h(Me,oe));else continue;B.push(H)}}else m(Me)&&B.push(new d(Me,Ct,null,new h(q,Ct)))}}return Ke.root};function b(C,E){var A=new f;return A.traverse(C,E)}function P(C,E){var A=new f;return A.replace(C,E)}function M(C,E){var A;return A=u(E,function(Z){return Z.range[0]>C.range[0]}),C.extendedRange=[C.range[0],C.range[1]],A!==E.length&&(C.extendedRange[1]=E[A].range[0]),A-=1,A>=0&&(C.extendedRange[0]=E[A].range[1]),C}function v(C,E,A){var B=[],Z,q,X,j;if(!C.range)throw new Error("attachComments needs range information");if(!A.length){if(E.length){for(X=0,q=E.length;X<q;X+=1)Z=c(E[X]),Z.extendedRange=[0,C.range[0]],B.push(Z);C.leadingComments=B}return C}for(X=0,q=E.length;X<q;X+=1)B.push(M(c(E[X]),A));return j=0,b(C,{enter:function(H){for(var se;j<B.length&&(se=B[j],!(se.extendedRange[1]>H.range[0]));)se.extendedRange[1]===H.range[0]?(H.leadingComments||(H.leadingComments=[]),H.leadingComments.push(se),B.splice(j,1)):j+=1;if(j===B.length)return s.Break;if(B[j].extendedRange[0]>H.range[1])return s.Skip}}),j=0,b(C,{leave:function(H){for(var se;j<B.length&&(se=B[j],!(H.range[1]<se.extendedRange[0]));)H.range[1]===se.extendedRange[0]?(H.trailingComments||(H.trailingComments=[]),H.trailingComments.push(se),B.splice(j,1)):j+=1;if(j===B.length)return s.Break;if(B[j].extendedRange[0]>H.range[1])return s.Skip}}),C}return t.Syntax=i,t.traverse=b,t.replace=P,t.attachComments=v,t.VisitorKeys=r,t.VisitorOption=s,t.Controller=f,t.cloneEnvironment=function(){return e({})},t})(n)})(rc)),rc}var fa={},ac={exports:{}},Fm;function c$(){return Fm||(Fm=1,(function(){function n(a){if(a==null)return!1;switch(a.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1}function e(a){if(a==null)return!1;switch(a.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1}function t(a){if(a==null)return!1;switch(a.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function i(a){return t(a)||a!=null&&a.type==="FunctionDeclaration"}function s(a){switch(a.type){case"IfStatement":return a.alternate!=null?a.alternate:a.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return a.body}return null}function r(a){var o;if(a.type!=="IfStatement"||a.alternate==null)return!1;o=a.consequent;do{if(o.type==="IfStatement"&&o.alternate==null)return!0;o=s(o)}while(o);return!1}ac.exports={isExpression:n,isStatement:t,isIterationStatement:e,isSourceElement:i,isProblematicIfStatement:r,trailingStatement:s}})()),ac.exports}var oc={exports:{}},Rm;function tb(){return Rm||(Rm=1,(function(){var n,e,t,i,s,r;e={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};function a(y){return 48<=y&&y<=57}function o(y){return 48<=y&&y<=57||97<=y&&y<=102||65<=y&&y<=70}function l(y){return y>=48&&y<=55}t=[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function c(y){return y===32||y===9||y===11||y===12||y===160||y>=5760&&t.indexOf(y)>=0}function u(y){return y===10||y===13||y===8232||y===8233}function h(y){if(y<=65535)return String.fromCharCode(y);var b=String.fromCharCode(Math.floor((y-65536)/1024)+55296),P=String.fromCharCode((y-65536)%1024+56320);return b+P}for(i=new Array(128),r=0;r<128;++r)i[r]=r>=97&&r<=122||r>=65&&r<=90||r===36||r===95;for(s=new Array(128),r=0;r<128;++r)s[r]=r>=97&&r<=122||r>=65&&r<=90||r>=48&&r<=57||r===36||r===95;function d(y){return y<128?i[y]:e.NonAsciiIdentifierStart.test(h(y))}function f(y){return y<128?s[y]:e.NonAsciiIdentifierPart.test(h(y))}function m(y){return y<128?i[y]:n.NonAsciiIdentifierStart.test(h(y))}function g(y){return y<128?s[y]:n.NonAsciiIdentifierPart.test(h(y))}oc.exports={isDecimalDigit:a,isHexDigit:o,isOctalDigit:l,isWhiteSpace:c,isLineTerminator:u,isIdentifierStartES5:d,isIdentifierPartES5:f,isIdentifierStartES6:m,isIdentifierPartES6:g}})()),oc.exports}var lc={exports:{}},Im;function h$(){return Im||(Im=1,(function(){var n=tb();function e(d){switch(d){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}function t(d,f){return!f&&d==="yield"?!1:i(d,f)}function i(d,f){if(f&&e(d))return!0;switch(d.length){case 2:return d==="if"||d==="in"||d==="do";case 3:return d==="var"||d==="for"||d==="new"||d==="try";case 4:return d==="this"||d==="else"||d==="case"||d==="void"||d==="with"||d==="enum";case 5:return d==="while"||d==="break"||d==="catch"||d==="throw"||d==="const"||d==="yield"||d==="class"||d==="super";case 6:return d==="return"||d==="typeof"||d==="delete"||d==="switch"||d==="export"||d==="import";case 7:return d==="default"||d==="finally"||d==="extends";case 8:return d==="function"||d==="continue"||d==="debugger";case 10:return d==="instanceof";default:return!1}}function s(d,f){return d==="null"||d==="true"||d==="false"||t(d,f)}function r(d,f){return d==="null"||d==="true"||d==="false"||i(d,f)}function a(d){return d==="eval"||d==="arguments"}function o(d){var f,m,g;if(d.length===0||(g=d.charCodeAt(0),!n.isIdentifierStartES5(g)))return!1;for(f=1,m=d.length;f<m;++f)if(g=d.charCodeAt(f),!n.isIdentifierPartES5(g))return!1;return!0}function l(d,f){return(d-55296)*1024+(f-56320)+65536}function c(d){var f,m,g,y,b;if(d.length===0)return!1;for(b=n.isIdentifierStartES6,f=0,m=d.length;f<m;++f){if(g=d.charCodeAt(f),55296<=g&&g<=56319){if(++f,f>=m||(y=d.charCodeAt(f),!(56320<=y&&y<=57343)))return!1;g=l(g,y)}if(!b(g))return!1;b=n.isIdentifierPartES6}return!0}function u(d,f){return o(d)&&!s(d,f)}function h(d,f){return c(d)&&!r(d,f)}lc.exports={isKeywordES5:t,isKeywordES6:i,isReservedWordES5:s,isReservedWordES6:r,isRestrictedWord:a,isIdentifierNameES5:o,isIdentifierNameES6:c,isIdentifierES5:u,isIdentifierES6:h}})()),lc.exports}var Lm;function d$(){return Lm||(Lm=1,(function(){fa.ast=c$(),fa.code=tb(),fa.keyword=h$()})()),fa}var pa={},uc={},_o={},No={},Qm;function f$(){if(Qm)return No;Qm=1;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return No.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},No.decode=function(e){var t=65,i=90,s=97,r=122,a=48,o=57,l=43,c=47,u=26,h=52;return t<=e&&e<=i?e-t:s<=e&&e<=r?e-s+u:a<=e&&e<=o?e-a+h:e==l?62:e==c?63:-1},No}var Vm;function nb(){if(Vm)return _o;Vm=1;var n=f$(),e=5,t=1<<e,i=t-1,s=t;function r(o){return o<0?(-o<<1)+1:(o<<1)+0}function a(o){var l=(o&1)===1,c=o>>1;return l?-c:c}return _o.encode=function(l){var c="",u,h=r(l);do u=h&i,h>>>=e,h>0&&(u|=s),c+=n.encode(u);while(h>0);return c},_o.decode=function(l,c,u){var h=l.length,d=0,f=0,m,g;do{if(c>=h)throw new Error("Expected more digits in base 64 VLQ value.");if(g=n.decode(l.charCodeAt(c++)),g===-1)throw new Error("Invalid base64 digit: "+l.charAt(c-1));m=!!(g&s),g&=i,d=d+(g<<f),f+=e}while(m);u.value=a(d),u.rest=c},_o}var cc={},zm;function lo(){return zm||(zm=1,(function(n){function e(v,C,E){if(C in v)return v[C];if(arguments.length===3)return E;throw new Error('"'+C+'" is a required argument.')}n.getArg=e;var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,i=/^data:.+\,.+$/;function s(v){var C=v.match(t);return C?{scheme:C[1],auth:C[2],host:C[3],port:C[4],path:C[5]}:null}n.urlParse=s;function r(v){var C="";return v.scheme&&(C+=v.scheme+":"),C+="//",v.auth&&(C+=v.auth+"@"),v.host&&(C+=v.host),v.port&&(C+=":"+v.port),v.path&&(C+=v.path),C}n.urlGenerate=r;function a(v){var C=v,E=s(v);if(E){if(!E.path)return v;C=E.path}for(var A=n.isAbsolute(C),B=C.split(/\/+/),Z,q=0,X=B.length-1;X>=0;X--)Z=B[X],Z==="."?B.splice(X,1):Z===".."?q++:q>0&&(Z===""?(B.splice(X+1,q),q=0):(B.splice(X,2),q--));return C=B.join("/"),C===""&&(C=A?"/":"."),E?(E.path=C,r(E)):C}n.normalize=a;function o(v,C){v===""&&(v="."),C===""&&(C=".");var E=s(C),A=s(v);if(A&&(v=A.path||"/"),E&&!E.scheme)return A&&(E.scheme=A.scheme),r(E);if(E||C.match(i))return C;if(A&&!A.host&&!A.path)return A.host=C,r(A);var B=C.charAt(0)==="/"?C:a(v.replace(/\/+$/,"")+"/"+C);return A?(A.path=B,r(A)):B}n.join=o,n.isAbsolute=function(v){return v.charAt(0)==="/"||t.test(v)};function l(v,C){v===""&&(v="."),v=v.replace(/\/$/,"");for(var E=0;C.indexOf(v+"/")!==0;){var A=v.lastIndexOf("/");if(A<0||(v=v.slice(0,A),v.match(/^([^\/]+:\/)?\/*$/)))return C;++E}return Array(E+1).join("../")+C.substr(v.length+1)}n.relative=l;var c=(function(){var v=Object.create(null);return!("__proto__"in v)})();function u(v){return v}function h(v){return f(v)?"$"+v:v}n.toSetString=c?u:h;function d(v){return f(v)?v.slice(1):v}n.fromSetString=c?u:d;function f(v){if(!v)return!1;var C=v.length;if(C<9||v.charCodeAt(C-1)!==95||v.charCodeAt(C-2)!==95||v.charCodeAt(C-3)!==111||v.charCodeAt(C-4)!==116||v.charCodeAt(C-5)!==111||v.charCodeAt(C-6)!==114||v.charCodeAt(C-7)!==112||v.charCodeAt(C-8)!==95||v.charCodeAt(C-9)!==95)return!1;for(var E=C-10;E>=0;E--)if(v.charCodeAt(E)!==36)return!1;return!0}function m(v,C,E){var A=y(v.source,C.source);return A!==0||(A=v.originalLine-C.originalLine,A!==0)||(A=v.originalColumn-C.originalColumn,A!==0||E)||(A=v.generatedColumn-C.generatedColumn,A!==0)||(A=v.generatedLine-C.generatedLine,A!==0)?A:y(v.name,C.name)}n.compareByOriginalPositions=m;function g(v,C,E){var A=v.generatedLine-C.generatedLine;return A!==0||(A=v.generatedColumn-C.generatedColumn,A!==0||E)||(A=y(v.source,C.source),A!==0)||(A=v.originalLine-C.originalLine,A!==0)||(A=v.originalColumn-C.originalColumn,A!==0)?A:y(v.name,C.name)}n.compareByGeneratedPositionsDeflated=g;function y(v,C){return v===C?0:v===null?1:C===null?-1:v>C?1:-1}function b(v,C){var E=v.generatedLine-C.generatedLine;return E!==0||(E=v.generatedColumn-C.generatedColumn,E!==0)||(E=y(v.source,C.source),E!==0)||(E=v.originalLine-C.originalLine,E!==0)||(E=v.originalColumn-C.originalColumn,E!==0)?E:y(v.name,C.name)}n.compareByGeneratedPositionsInflated=b;function P(v){return JSON.parse(v.replace(/^\)]}'[^\n]*\n/,""))}n.parseSourceMapInput=P;function M(v,C,E){if(C=C||"",v&&(v[v.length-1]!=="/"&&C[0]!=="/"&&(v+="/"),C=v+C),E){var A=s(E);if(!A)throw new Error("sourceMapURL could not be parsed");if(A.path){var B=A.path.lastIndexOf("/");B>=0&&(A.path=A.path.substring(0,B+1))}C=o(r(A),C)}return a(C)}n.computeSourceURL=M})(cc)),cc}var hc={},jm;function ib(){if(jm)return hc;jm=1;var n=lo(),e=Object.prototype.hasOwnProperty,t=typeof Map<"u";function i(){this._array=[],this._set=t?new Map:Object.create(null)}return i.fromArray=function(r,a){for(var o=new i,l=0,c=r.length;l<c;l++)o.add(r[l],a);return o},i.prototype.size=function(){return t?this._set.size:Object.getOwnPropertyNames(this._set).length},i.prototype.add=function(r,a){var o=t?r:n.toSetString(r),l=t?this.has(r):e.call(this._set,o),c=this._array.length;(!l||a)&&this._array.push(r),l||(t?this._set.set(r,c):this._set[o]=c)},i.prototype.has=function(r){if(t)return this._set.has(r);var a=n.toSetString(r);return e.call(this._set,a)},i.prototype.indexOf=function(r){if(t){var a=this._set.get(r);if(a>=0)return a}else{var o=n.toSetString(r);if(e.call(this._set,o))return this._set[o]}throw new Error('"'+r+'" is not in the set.')},i.prototype.at=function(r){if(r>=0&&r<this._array.length)return this._array[r];throw new Error("No element indexed by "+r)},i.prototype.toArray=function(){return this._array.slice()},hc.ArraySet=i,hc}var dc={},Zm;function p$(){if(Zm)return dc;Zm=1;var n=lo();function e(i,s){var r=i.generatedLine,a=s.generatedLine,o=i.generatedColumn,l=s.generatedColumn;return a>r||a==r&&l>=o||n.compareByGeneratedPositionsInflated(i,s)<=0}function t(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return t.prototype.unsortedForEach=function(s,r){this._array.forEach(s,r)},t.prototype.add=function(s){e(this._last,s)?(this._last=s,this._array.push(s)):(this._sorted=!1,this._array.push(s))},t.prototype.toArray=function(){return this._sorted||(this._array.sort(n.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},dc.MappingList=t,dc}var Gm;function sb(){if(Gm)return uc;Gm=1;var n=nb(),e=lo(),t=ib().ArraySet,i=p$().MappingList;function s(r){r||(r={}),this._file=e.getArg(r,"file",null),this._sourceRoot=e.getArg(r,"sourceRoot",null),this._skipValidation=e.getArg(r,"skipValidation",!1),this._sources=new t,this._names=new t,this._mappings=new i,this._sourcesContents=null}return s.prototype._version=3,s.fromSourceMap=function(a){var o=a.sourceRoot,l=new s({file:a.file,sourceRoot:o});return a.eachMapping(function(c){var u={generated:{line:c.generatedLine,column:c.generatedColumn}};c.source!=null&&(u.source=c.source,o!=null&&(u.source=e.relative(o,u.source)),u.original={line:c.originalLine,column:c.originalColumn},c.name!=null&&(u.name=c.name)),l.addMapping(u)}),a.sources.forEach(function(c){var u=c;o!==null&&(u=e.relative(o,c)),l._sources.has(u)||l._sources.add(u);var h=a.sourceContentFor(c);h!=null&&l.setSourceContent(c,h)}),l},s.prototype.addMapping=function(a){var o=e.getArg(a,"generated"),l=e.getArg(a,"original",null),c=e.getArg(a,"source",null),u=e.getArg(a,"name",null);this._skipValidation||this._validateMapping(o,l,c,u),c!=null&&(c=String(c),this._sources.has(c)||this._sources.add(c)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:o.line,generatedColumn:o.column,originalLine:l!=null&&l.line,originalColumn:l!=null&&l.column,source:c,name:u})},s.prototype.setSourceContent=function(a,o){var l=a;this._sourceRoot!=null&&(l=e.relative(this._sourceRoot,l)),o!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(l)]=o):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(l)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},s.prototype.applySourceMap=function(a,o,l){var c=o;if(o==null){if(a.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);c=a.file}var u=this._sourceRoot;u!=null&&(c=e.relative(u,c));var h=new t,d=new t;this._mappings.unsortedForEach(function(f){if(f.source===c&&f.originalLine!=null){var m=a.originalPositionFor({line:f.originalLine,column:f.originalColumn});m.source!=null&&(f.source=m.source,l!=null&&(f.source=e.join(l,f.source)),u!=null&&(f.source=e.relative(u,f.source)),f.originalLine=m.line,f.originalColumn=m.column,m.name!=null&&(f.name=m.name))}var g=f.source;g!=null&&!h.has(g)&&h.add(g);var y=f.name;y!=null&&!d.has(y)&&d.add(y)},this),this._sources=h,this._names=d,a.sources.forEach(function(f){var m=a.sourceContentFor(f);m!=null&&(l!=null&&(f=e.join(l,f)),u!=null&&(f=e.relative(u,f)),this.setSourceContent(f,m))},this)},s.prototype._validateMapping=function(a,o,l,c){if(o&&typeof o.line!="number"&&typeof o.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(a&&"line"in a&&"column"in a&&a.line>0&&a.column>=0&&!o&&!l&&!c)){if(a&&"line"in a&&"column"in a&&o&&"line"in o&&"column"in o&&a.line>0&&a.column>=0&&o.line>0&&o.column>=0&&l)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:a,source:l,original:o,name:c}))}},s.prototype._serializeMappings=function(){for(var a=0,o=1,l=0,c=0,u=0,h=0,d="",f,m,g,y,b=this._mappings.toArray(),P=0,M=b.length;P<M;P++){if(m=b[P],f="",m.generatedLine!==o)for(a=0;m.generatedLine!==o;)f+=";",o++;else if(P>0){if(!e.compareByGeneratedPositionsInflated(m,b[P-1]))continue;f+=","}f+=n.encode(m.generatedColumn-a),a=m.generatedColumn,m.source!=null&&(y=this._sources.indexOf(m.source),f+=n.encode(y-h),h=y,f+=n.encode(m.originalLine-1-c),c=m.originalLine-1,f+=n.encode(m.originalColumn-l),l=m.originalColumn,m.name!=null&&(g=this._names.indexOf(m.name),f+=n.encode(g-u),u=g)),d+=f}return d},s.prototype._generateSourcesContent=function(a,o){return a.map(function(l){if(!this._sourcesContents)return null;o!=null&&(l=e.relative(o,l));var c=e.toSetString(l);return Object.prototype.hasOwnProperty.call(this._sourcesContents,c)?this._sourcesContents[c]:null},this)},s.prototype.toJSON=function(){var a={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(a.file=this._file),this._sourceRoot!=null&&(a.sourceRoot=this._sourceRoot),this._sourcesContents&&(a.sourcesContent=this._generateSourcesContent(a.sources,a.sourceRoot)),a},s.prototype.toString=function(){return JSON.stringify(this.toJSON())},uc.SourceMapGenerator=s,uc}var ma={},fc={},Um;function m$(){return Um||(Um=1,(function(n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2;function e(t,i,s,r,a,o){var l=Math.floor((i-t)/2)+t,c=a(s,r[l],!0);return c===0?l:c>0?i-l>1?e(l,i,s,r,a,o):o==n.LEAST_UPPER_BOUND?i<r.length?i:-1:l:l-t>1?e(t,l,s,r,a,o):o==n.LEAST_UPPER_BOUND?l:t<0?-1:t}n.search=function(i,s,r,a){if(s.length===0)return-1;var o=e(-1,s.length,i,s,r,a||n.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&r(s[o],s[o-1],!0)===0;)--o;return o}})(fc)),fc}var pc={},qm;function g$(){if(qm)return pc;qm=1;function n(i,s,r){var a=i[s];i[s]=i[r],i[r]=a}function e(i,s){return Math.round(i+Math.random()*(s-i))}function t(i,s,r,a){if(r<a){var o=e(r,a),l=r-1;n(i,o,a);for(var c=i[a],u=r;u<a;u++)s(i[u],c)<=0&&(l+=1,n(i,l,u));n(i,l+1,u);var h=l+1;t(i,s,r,h-1),t(i,s,h+1,a)}}return pc.quickSort=function(i,s){t(i,s,0,i.length-1)},pc}var Wm;function O$(){if(Wm)return ma;Wm=1;var n=lo(),e=m$(),t=ib().ArraySet,i=nb(),s=g$().quickSort;function r(c,u){var h=c;return typeof c=="string"&&(h=n.parseSourceMapInput(c)),h.sections!=null?new l(h,u):new a(h,u)}r.fromSourceMap=function(c,u){return a.fromSourceMap(c,u)},r.prototype._version=3,r.prototype.__generatedMappings=null,Object.defineProperty(r.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),r.prototype.__originalMappings=null,Object.defineProperty(r.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),r.prototype._charIsMappingSeparator=function(u,h){var d=u.charAt(h);return d===";"||d===","},r.prototype._parseMappings=function(u,h){throw new Error("Subclasses must implement _parseMappings")},r.GENERATED_ORDER=1,r.ORIGINAL_ORDER=2,r.GREATEST_LOWER_BOUND=1,r.LEAST_UPPER_BOUND=2,r.prototype.eachMapping=function(u,h,d){var f=h||null,m=d||r.GENERATED_ORDER,g;switch(m){case r.GENERATED_ORDER:g=this._generatedMappings;break;case r.ORIGINAL_ORDER:g=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var y=this.sourceRoot;g.map(function(b){var P=b.source===null?null:this._sources.at(b.source);return P=n.computeSourceURL(y,P,this._sourceMapURL),{source:P,generatedLine:b.generatedLine,generatedColumn:b.generatedColumn,originalLine:b.originalLine,originalColumn:b.originalColumn,name:b.name===null?null:this._names.at(b.name)}},this).forEach(u,f)},r.prototype.allGeneratedPositionsFor=function(u){var h=n.getArg(u,"line"),d={source:n.getArg(u,"source"),originalLine:h,originalColumn:n.getArg(u,"column",0)};if(d.source=this._findSourceIndex(d.source),d.source<0)return[];var f=[],m=this._findMapping(d,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,e.LEAST_UPPER_BOUND);if(m>=0){var g=this._originalMappings[m];if(u.column===void 0)for(var y=g.originalLine;g&&g.originalLine===y;)f.push({line:n.getArg(g,"generatedLine",null),column:n.getArg(g,"generatedColumn",null),lastColumn:n.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++m];else for(var b=g.originalColumn;g&&g.originalLine===h&&g.originalColumn==b;)f.push({line:n.getArg(g,"generatedLine",null),column:n.getArg(g,"generatedColumn",null),lastColumn:n.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++m]}return f},ma.SourceMapConsumer=r;function a(c,u){var h=c;typeof c=="string"&&(h=n.parseSourceMapInput(c));var d=n.getArg(h,"version"),f=n.getArg(h,"sources"),m=n.getArg(h,"names",[]),g=n.getArg(h,"sourceRoot",null),y=n.getArg(h,"sourcesContent",null),b=n.getArg(h,"mappings"),P=n.getArg(h,"file",null);if(d!=this._version)throw new Error("Unsupported version: "+d);g&&(g=n.normalize(g)),f=f.map(String).map(n.normalize).map(function(M){return g&&n.isAbsolute(g)&&n.isAbsolute(M)?n.relative(g,M):M}),this._names=t.fromArray(m.map(String),!0),this._sources=t.fromArray(f,!0),this._absoluteSources=this._sources.toArray().map(function(M){return n.computeSourceURL(g,M,u)}),this.sourceRoot=g,this.sourcesContent=y,this._mappings=b,this._sourceMapURL=u,this.file=P}a.prototype=Object.create(r.prototype),a.prototype.consumer=r,a.prototype._findSourceIndex=function(c){var u=c;if(this.sourceRoot!=null&&(u=n.relative(this.sourceRoot,u)),this._sources.has(u))return this._sources.indexOf(u);var h;for(h=0;h<this._absoluteSources.length;++h)if(this._absoluteSources[h]==c)return h;return-1},a.fromSourceMap=function(u,h){var d=Object.create(a.prototype),f=d._names=t.fromArray(u._names.toArray(),!0),m=d._sources=t.fromArray(u._sources.toArray(),!0);d.sourceRoot=u._sourceRoot,d.sourcesContent=u._generateSourcesContent(d._sources.toArray(),d.sourceRoot),d.file=u._file,d._sourceMapURL=h,d._absoluteSources=d._sources.toArray().map(function(E){return n.computeSourceURL(d.sourceRoot,E,h)});for(var g=u._mappings.toArray().slice(),y=d.__generatedMappings=[],b=d.__originalMappings=[],P=0,M=g.length;P<M;P++){var v=g[P],C=new o;C.generatedLine=v.generatedLine,C.generatedColumn=v.generatedColumn,v.source&&(C.source=m.indexOf(v.source),C.originalLine=v.originalLine,C.originalColumn=v.originalColumn,v.name&&(C.name=f.indexOf(v.name)),b.push(C)),y.push(C)}return s(d.__originalMappings,n.compareByOriginalPositions),d},a.prototype._version=3,Object.defineProperty(a.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}a.prototype._parseMappings=function(u,h){for(var d=1,f=0,m=0,g=0,y=0,b=0,P=u.length,M=0,v={},C={},E=[],A=[],B,Z,q,X,j;M<P;)if(u.charAt(M)===";")d++,M++,f=0;else if(u.charAt(M)===",")M++;else{for(B=new o,B.generatedLine=d,X=M;X<P&&!this._charIsMappingSeparator(u,X);X++);if(Z=u.slice(M,X),q=v[Z],q)M+=Z.length;else{for(q=[];M<X;)i.decode(u,M,C),j=C.value,M=C.rest,q.push(j);if(q.length===2)throw new Error("Found a source, but no line and column");if(q.length===3)throw new Error("Found a source and line, but no column");v[Z]=q}B.generatedColumn=f+q[0],f=B.generatedColumn,q.length>1&&(B.source=y+q[1],y+=q[1],B.originalLine=m+q[2],m=B.originalLine,B.originalLine+=1,B.originalColumn=g+q[3],g=B.originalColumn,q.length>4&&(B.name=b+q[4],b+=q[4])),A.push(B),typeof B.originalLine=="number"&&E.push(B)}s(A,n.compareByGeneratedPositionsDeflated),this.__generatedMappings=A,s(E,n.compareByOriginalPositions),this.__originalMappings=E},a.prototype._findMapping=function(u,h,d,f,m,g){if(u[d]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+u[d]);if(u[f]<0)throw new TypeError("Column must be greater than or equal to 0, got "+u[f]);return e.search(u,h,m,g)},a.prototype.computeColumnSpans=function(){for(var u=0;u<this._generatedMappings.length;++u){var h=this._generatedMappings[u];if(u+1<this._generatedMappings.length){var d=this._generatedMappings[u+1];if(h.generatedLine===d.generatedLine){h.lastGeneratedColumn=d.generatedColumn-1;continue}}h.lastGeneratedColumn=1/0}},a.prototype.originalPositionFor=function(u){var h={generatedLine:n.getArg(u,"line"),generatedColumn:n.getArg(u,"column")},d=this._findMapping(h,this._generatedMappings,"generatedLine","generatedColumn",n.compareByGeneratedPositionsDeflated,n.getArg(u,"bias",r.GREATEST_LOWER_BOUND));if(d>=0){var f=this._generatedMappings[d];if(f.generatedLine===h.generatedLine){var m=n.getArg(f,"source",null);m!==null&&(m=this._sources.at(m),m=n.computeSourceURL(this.sourceRoot,m,this._sourceMapURL));var g=n.getArg(f,"name",null);return g!==null&&(g=this._names.at(g)),{source:m,line:n.getArg(f,"originalLine",null),column:n.getArg(f,"originalColumn",null),name:g}}}return{source:null,line:null,column:null,name:null}},a.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(u){return u==null}):!1},a.prototype.sourceContentFor=function(u,h){if(!this.sourcesContent)return null;var d=this._findSourceIndex(u);if(d>=0)return this.sourcesContent[d];var f=u;this.sourceRoot!=null&&(f=n.relative(this.sourceRoot,f));var m;if(this.sourceRoot!=null&&(m=n.urlParse(this.sourceRoot))){var g=f.replace(/^file:\/\//,"");if(m.scheme=="file"&&this._sources.has(g))return this.sourcesContent[this._sources.indexOf(g)];if((!m.path||m.path=="/")&&this._sources.has("/"+f))return this.sourcesContent[this._sources.indexOf("/"+f)]}if(h)return null;throw new Error('"'+f+'" is not in the SourceMap.')},a.prototype.generatedPositionFor=function(u){var h=n.getArg(u,"source");if(h=this._findSourceIndex(h),h<0)return{line:null,column:null,lastColumn:null};var d={source:h,originalLine:n.getArg(u,"line"),originalColumn:n.getArg(u,"column")},f=this._findMapping(d,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,n.getArg(u,"bias",r.GREATEST_LOWER_BOUND));if(f>=0){var m=this._originalMappings[f];if(m.source===d.source)return{line:n.getArg(m,"generatedLine",null),column:n.getArg(m,"generatedColumn",null),lastColumn:n.getArg(m,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},ma.BasicSourceMapConsumer=a;function l(c,u){var h=c;typeof c=="string"&&(h=n.parseSourceMapInput(c));var d=n.getArg(h,"version"),f=n.getArg(h,"sections");if(d!=this._version)throw new Error("Unsupported version: "+d);this._sources=new t,this._names=new t;var m={line:-1,column:0};this._sections=f.map(function(g){if(g.url)throw new Error("Support for url field in sections not implemented.");var y=n.getArg(g,"offset"),b=n.getArg(y,"line"),P=n.getArg(y,"column");if(b<m.line||b===m.line&&P<m.column)throw new Error("Section offsets must be ordered and non-overlapping.");return m=y,{generatedOffset:{generatedLine:b+1,generatedColumn:P+1},consumer:new r(n.getArg(g,"map"),u)}})}return l.prototype=Object.create(r.prototype),l.prototype.constructor=r,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var c=[],u=0;u<this._sections.length;u++)for(var h=0;h<this._sections[u].consumer.sources.length;h++)c.push(this._sections[u].consumer.sources[h]);return c}}),l.prototype.originalPositionFor=function(u){var h={generatedLine:n.getArg(u,"line"),generatedColumn:n.getArg(u,"column")},d=e.search(h,this._sections,function(m,g){var y=m.generatedLine-g.generatedOffset.generatedLine;return y||m.generatedColumn-g.generatedOffset.generatedColumn}),f=this._sections[d];return f?f.consumer.originalPositionFor({line:h.generatedLine-(f.generatedOffset.generatedLine-1),column:h.generatedColumn-(f.generatedOffset.generatedLine===h.generatedLine?f.generatedOffset.generatedColumn-1:0),bias:u.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(u){return u.consumer.hasContentsOfAllSources()})},l.prototype.sourceContentFor=function(u,h){for(var d=0;d<this._sections.length;d++){var f=this._sections[d],m=f.consumer.sourceContentFor(u,!0);if(m)return m}if(h)return null;throw new Error('"'+u+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(u){for(var h=0;h<this._sections.length;h++){var d=this._sections[h];if(d.consumer._findSourceIndex(n.getArg(u,"source"))!==-1){var f=d.consumer.generatedPositionFor(u);if(f){var m={line:f.line+(d.generatedOffset.generatedLine-1),column:f.column+(d.generatedOffset.generatedLine===f.line?d.generatedOffset.generatedColumn-1:0)};return m}}}return{line:null,column:null}},l.prototype._parseMappings=function(u,h){this.__generatedMappings=[],this.__originalMappings=[];for(var d=0;d<this._sections.length;d++)for(var f=this._sections[d],m=f.consumer._generatedMappings,g=0;g<m.length;g++){var y=m[g],b=f.consumer._sources.at(y.source);b=n.computeSourceURL(f.consumer.sourceRoot,b,this._sourceMapURL),this._sources.add(b),b=this._sources.indexOf(b);var P=null;y.name&&(P=f.consumer._names.at(y.name),this._names.add(P),P=this._names.indexOf(P));var M={source:b,generatedLine:y.generatedLine+(f.generatedOffset.generatedLine-1),generatedColumn:y.generatedColumn+(f.generatedOffset.generatedLine===y.generatedLine?f.generatedOffset.generatedColumn-1:0),originalLine:y.originalLine,originalColumn:y.originalColumn,name:P};this.__generatedMappings.push(M),typeof M.originalLine=="number"&&this.__originalMappings.push(M)}s(this.__generatedMappings,n.compareByGeneratedPositionsDeflated),s(this.__originalMappings,n.compareByOriginalPositions)},ma.IndexedSourceMapConsumer=l,ma}var mc={},Xm;function y$(){if(Xm)return mc;Xm=1;var n=sb().SourceMapGenerator,e=lo(),t=/(\r?\n)/,i=10,s="$$$isSourceNode$$$";function r(a,o,l,c,u){this.children=[],this.sourceContents={},this.line=a??null,this.column=o??null,this.source=l??null,this.name=u??null,this[s]=!0,c!=null&&this.add(c)}return r.fromStringWithSourceMap=function(o,l,c){var u=new r,h=o.split(t),d=0,f=function(){var P=v(),M=v()||"";return P+M;function v(){return d<h.length?h[d++]:void 0}},m=1,g=0,y=null;return l.eachMapping(function(P){if(y!==null)if(m<P.generatedLine)b(y,f()),m++,g=0;else{var M=h[d]||"",v=M.substr(0,P.generatedColumn-g);h[d]=M.substr(P.generatedColumn-g),g=P.generatedColumn,b(y,v),y=P;return}for(;m<P.generatedLine;)u.add(f()),m++;if(g<P.generatedColumn){var M=h[d]||"";u.add(M.substr(0,P.generatedColumn)),h[d]=M.substr(P.generatedColumn),g=P.generatedColumn}y=P},this),d<h.length&&(y&&b(y,f()),u.add(h.splice(d).join(""))),l.sources.forEach(function(P){var M=l.sourceContentFor(P);M!=null&&(c!=null&&(P=e.join(c,P)),u.setSourceContent(P,M))}),u;function b(P,M){if(P===null||P.source===void 0)u.add(M);else{var v=c?e.join(c,P.source):P.source;u.add(new r(P.originalLine,P.originalColumn,v,M,P.name))}}},r.prototype.add=function(o){if(Array.isArray(o))o.forEach(function(l){this.add(l)},this);else if(o[s]||typeof o=="string")o&&this.children.push(o);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+o);return this},r.prototype.prepend=function(o){if(Array.isArray(o))for(var l=o.length-1;l>=0;l--)this.prepend(o[l]);else if(o[s]||typeof o=="string")this.children.unshift(o);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+o);return this},r.prototype.walk=function(o){for(var l,c=0,u=this.children.length;c<u;c++)l=this.children[c],l[s]?l.walk(o):l!==""&&o(l,{source:this.source,line:this.line,column:this.column,name:this.name})},r.prototype.join=function(o){var l,c,u=this.children.length;if(u>0){for(l=[],c=0;c<u-1;c++)l.push(this.children[c]),l.push(o);l.push(this.children[c]),this.children=l}return this},r.prototype.replaceRight=function(o,l){var c=this.children[this.children.length-1];return c[s]?c.replaceRight(o,l):typeof c=="string"?this.children[this.children.length-1]=c.replace(o,l):this.children.push("".replace(o,l)),this},r.prototype.setSourceContent=function(o,l){this.sourceContents[e.toSetString(o)]=l},r.prototype.walkSourceContents=function(o){for(var l=0,c=this.children.length;l<c;l++)this.children[l][s]&&this.children[l].walkSourceContents(o);for(var u=Object.keys(this.sourceContents),l=0,c=u.length;l<c;l++)o(e.fromSetString(u[l]),this.sourceContents[u[l]])},r.prototype.toString=function(){var o="";return this.walk(function(l){o+=l}),o},r.prototype.toStringWithSourceMap=function(o){var l={code:"",line:1,column:0},c=new n(o),u=!1,h=null,d=null,f=null,m=null;return this.walk(function(g,y){l.code+=g,y.source!==null&&y.line!==null&&y.column!==null?((h!==y.source||d!==y.line||f!==y.column||m!==y.name)&&c.addMapping({source:y.source,original:{line:y.line,column:y.column},generated:{line:l.line,column:l.column},name:y.name}),h=y.source,d=y.line,f=y.column,m=y.name,u=!0):u&&(c.addMapping({generated:{line:l.line,column:l.column}}),h=null,u=!1);for(var b=0,P=g.length;b<P;b++)g.charCodeAt(b)===i?(l.line++,l.column=0,b+1===P?(h=null,u=!1):u&&c.addMapping({source:y.source,original:{line:y.line,column:y.column},generated:{line:l.line,column:l.column},name:y.name})):l.column++}),this.walkSourceContents(function(g,y){c.setSourceContent(g,y)}),{code:l.code,map:c}},mc.SourceNode=r,mc}var Hm;function b$(){return Hm||(Hm=1,pa.SourceMapGenerator=sb().SourceMapGenerator,pa.SourceMapConsumer=O$().SourceMapConsumer,pa.SourceNode=y$().SourceNode),pa}const v$="2.1.0",S$={version:v$};var Ym;function w$(){return Ym||(Ym=1,(function(n){(function(){var e,t,i,s,r,a,o,l,c,u,h,d,f,m,g,y,b,P,M,v,C,E,A,B,Z,q;r=u$(),a=d$(),e=r.Syntax;function X(p){return wt.Expression.hasOwnProperty(p.type)}function j(p){return wt.Statement.hasOwnProperty(p.type)}t={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,Coalesce:3,LogicalOR:4,LogicalAND:5,BitwiseOR:6,BitwiseXOR:7,BitwiseAND:8,Equality:9,Relational:10,BitwiseSHIFT:11,Additive:12,Multiplicative:13,Exponentiation:14,Await:15,Unary:15,Postfix:16,OptionalChaining:17,Call:18,New:19,TaggedTemplate:20,Member:21,Primary:22},i={"??":t.Coalesce,"||":t.LogicalOR,"&&":t.LogicalAND,"|":t.BitwiseOR,"^":t.BitwiseXOR,"&":t.BitwiseAND,"==":t.Equality,"!=":t.Equality,"===":t.Equality,"!==":t.Equality,is:t.Equality,isnt:t.Equality,"<":t.Relational,">":t.Relational,"<=":t.Relational,">=":t.Relational,in:t.Relational,instanceof:t.Relational,"<<":t.BitwiseSHIFT,">>":t.BitwiseSHIFT,">>>":t.BitwiseSHIFT,"+":t.Additive,"-":t.Additive,"*":t.Multiplicative,"%":t.Multiplicative,"/":t.Multiplicative,"**":t.Exponentiation};var H=1,se=2,oe=4,Pe=8,Me=16,Be=32,Ke=64,Ct=se|oe,yt=H|se,he=H|se|oe,et=H,pe=oe,Et=H|oe,Ze=H,ve=H|Be,Je=0,Pt=H|Me,li=H|Pe;function Bn(){return{indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:`
`,space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null}}function Lt(p,w){var S="";for(w|=0;w>0;w>>>=1,p+=p)w&1&&(S+=p);return S}function Sn(p){return/[\r\n]/g.test(p)}function ot(p){var w=p.length;return w&&a.code.isLineTerminator(p.charCodeAt(w-1))}function an(p,w){var S;for(S in w)w.hasOwnProperty(S)&&(p[S]=w[S]);return p}function ti(p,w){var S,x;function N(W){return typeof W=="object"&&W instanceof Object&&!(W instanceof RegExp)}for(S in w)w.hasOwnProperty(S)&&(x=w[S],N(x)?N(p[S])?ti(p[S],x):p[S]=ti({},x):p[S]=x);return p}function Vi(p){var w,S,x,N,W;if(p!==p)throw new Error("Numeric literal whose value is NaN");if(p<0||p===0&&1/p<0)throw new Error("Numeric literal whose value is negative");if(p===1/0)return c?"null":u?"1e400":"1e+400";if(w=""+p,!u||w.length<3)return w;for(S=w.indexOf("."),!c&&w.charCodeAt(0)===48&&S===1&&(S=0,w=w.slice(1)),x=w,w=w.replace("e+","e"),N=0,(W=x.indexOf("e"))>0&&(N=+x.slice(W+1),x=x.slice(0,W)),S>=0&&(N-=x.length-S-1,x=+(x.slice(0,S)+x.slice(S+1))+""),W=0;x.charCodeAt(x.length+W-1)===48;)--W;return W!==0&&(N-=W,x=x.slice(0,W)),N!==0&&(x+="e"+N),(x.length<w.length||h&&p>1e12&&Math.floor(p)===p&&(x="0x"+p.toString(16)).length<w.length)&&+x===p&&(w=x),w}function ms(p,w){return(p&-2)===8232?(w?"u":"\\u")+(p===8232?"2028":"2029"):p===10||p===13?(w?"":"\\")+(p===10?"n":"r"):String.fromCharCode(p)}function zi(p){var w,S,x,N,W,J,le,Ce;if(S=p.toString(),p.source){if(w=S.match(/\/([^/]*)$/),!w)return S;for(x=w[1],S="",le=!1,Ce=!1,N=0,W=p.source.length;N<W;++N)J=p.source.charCodeAt(N),Ce?(S+=ms(J,Ce),Ce=!1):(le?J===93&&(le=!1):J===47?S+="\\":J===91&&(le=!0),S+=ms(J,Ce),Ce=J===92);return"/"+S+"/"+x}return S}function xs(p,w){var S;return p===8?"\\b":p===12?"\\f":p===9?"\\t":(S=p.toString(16).toUpperCase(),c||p>255?"\\u"+"0000".slice(S.length)+S:p===0&&!a.code.isDecimalDigit(w)?"\\0":p===11?"\\x0B":"\\x"+"00".slice(S.length)+S)}function ji(p){if(p===92)return"\\\\";if(p===10)return"\\n";if(p===13)return"\\r";if(p===8232)return"\\u2028";if(p===8233)return"\\u2029";throw new Error("Incorrectly classified character")}function Zi(p){var w,S,x,N;for(N=d==="double"?'"':"'",w=0,S=p.length;w<S;++w)if(x=p.charCodeAt(w),x===39){N='"';break}else if(x===34){N="'";break}else x===92&&++w;return N+p+N}function ui(p){var w="",S,x,N,W=0,J=0,le,Ce;for(S=0,x=p.length;S<x;++S){if(N=p.charCodeAt(S),N===39)++W;else if(N===34)++J;else if(N===47&&c)w+="\\";else if(a.code.isLineTerminator(N)||N===92){w+=ji(N);continue}else if(!a.code.isIdentifierPartES5(N)&&(c&&N<32||!c&&!f&&(N<32||N>126))){w+=xs(N,p.charCodeAt(S+1));continue}w+=String.fromCharCode(N)}if(le=!(d==="double"||d==="auto"&&J<W),Ce=le?"'":'"',!(le?W:J))return Ce+w+Ce;for(p=w,w=Ce,S=0,x=p.length;S<x;++S)N=p.charCodeAt(S),(N===39&&le||N===34&&!le)&&(w+="\\"),w+=String.fromCharCode(N);return w+Ce}function zn(p){var w,S,x,N="";for(w=0,S=p.length;w<S;++w)x=p[w],N+=Array.isArray(x)?zn(x):x;return N}function Ae(p,w){if(!E)return Array.isArray(p)?zn(p):p;if(w==null){if(p instanceof s)return p;w={}}return w.loc==null?new s(null,null,E,p,w.name||null):new s(w.loc.start.line,w.loc.start.column,E===!0?w.loc.source||null:E,p,w.name||null)}function Ut(){return g||" "}function Le(p,w){var S,x,N,W;return S=Ae(p).toString(),S.length===0?[w]:(x=Ae(w).toString(),x.length===0?[p]:(N=S.charCodeAt(S.length-1),W=x.charCodeAt(0),(N===43||N===45)&&N===W||a.code.isIdentifierPartES5(N)&&a.code.isIdentifierPartES5(W)||N===47&&W===105?[p,Ut(),w]:a.code.isWhiteSpace(N)||a.code.isLineTerminator(N)||a.code.isWhiteSpace(W)||a.code.isLineTerminator(W)?[p,w]:[p,g,w]))}function bt(p){return[o,p]}function tt(p){var w;w=o,o+=l,p(o),o=w}function ni(p){var w;for(w=p.length-1;w>=0&&!a.code.isLineTerminator(p.charCodeAt(w));--w);return p.length-1-w}function Es(p,w){var S,x,N,W,J,le,Ce,Ye;for(S=p.split(/\r\n|[\r\n]/),le=Number.MAX_VALUE,x=1,N=S.length;x<N;++x){for(W=S[x],J=0;J<W.length&&a.code.isWhiteSpace(W.charCodeAt(J));)++J;le>J&&(le=J)}for(typeof w<"u"?(Ce=o,S[1][le]==="*"&&(w+=" "),o=w):(le&1&&--le,Ce=o),x=1,N=S.length;x<N;++x)Ye=Ae(bt(S[x].slice(le))),S[x]=E?Ye.join(""):Ye;return o=Ce,S.join(`
`)}function wn(p,w){if(p.type==="Line"){if(ot(p.value))return"//"+p.value;var S="//"+p.value;return B||(S+=`
`),S}return v.format.indent.adjustMultilineComment&&/[\n\r]/.test(p.value)?Es("/*"+p.value+"*/",w):"/*"+p.value+"*/"}function ci(p,w){var S,x,N,W,J,le,Ce,Ye,lt,En,Zn,Pi,Ai,cn;if(p.leadingComments&&p.leadingComments.length>0){if(W=w,B){for(N=p.leadingComments[0],w=[],Ye=N.extendedRange,lt=N.range,Zn=A.substring(Ye[0],lt[0]),cn=(Zn.match(/\n/g)||[]).length,cn>0?(w.push(Lt(`
`,cn)),w.push(bt(wn(N)))):(w.push(Zn),w.push(wn(N))),En=lt,S=1,x=p.leadingComments.length;S<x;S++)N=p.leadingComments[S],lt=N.range,Pi=A.substring(En[1],lt[0]),cn=(Pi.match(/\n/g)||[]).length,w.push(Lt(`
`,cn)),w.push(bt(wn(N))),En=lt;Ai=A.substring(lt[1],Ye[1]),cn=(Ai.match(/\n/g)||[]).length,w.push(Lt(`
`,cn))}else for(N=p.leadingComments[0],w=[],P&&p.type===e.Program&&p.body.length===0&&w.push(`
`),w.push(wn(N)),ot(Ae(w).toString())||w.push(`
`),S=1,x=p.leadingComments.length;S<x;++S)N=p.leadingComments[S],Ce=[wn(N)],ot(Ae(Ce).toString())||Ce.push(`
`),w.push(bt(Ce));w.push(bt(W))}if(p.trailingComments)if(B)N=p.trailingComments[0],Ye=N.extendedRange,lt=N.range,Zn=A.substring(Ye[0],lt[0]),cn=(Zn.match(/\n/g)||[]).length,cn>0?(w.push(Lt(`
`,cn)),w.push(bt(wn(N)))):(w.push(Zn),w.push(wn(N)));else for(J=!ot(Ae(w).toString()),le=Lt(" ",ni(Ae([o,w,l]).toString())),S=0,x=p.trailingComments.length;S<x;++S)N=p.trailingComments[S],J?(S===0?w=[w,l]:w=[w,le],w.push(wn(N,le))):w=[w,bt(wn(N))],S!==x-1&&!ot(Ae(w).toString())&&(w=[w,`
`]);return w}function jn(p,w,S){var x,N=0;for(x=p;x<w;x++)A[x]===`
`&&N++;for(x=1;x<N;x++)S.push(m)}function $t(p,w,S){return w<S?["(",p,")"]:p}function Gi(p){var w,S,x;for(x=p.split(/\r\n|\n/),w=1,S=x.length;w<S;w++)x[w]=m+o+x[w];return x}function ks(p,w){var S,x,N;return S=p[v.verbatim],typeof S=="string"?x=$t(Gi(S),t.Sequence,w):(x=Gi(S.content),N=S.precedence!=null?S.precedence:t.Sequence,x=$t(x,N,w)),Ae(x,p)}function wt(){}wt.prototype.maybeBlock=function(p,w){var S,x,N=this;return x=!v.comment||!p.leadingComments,p.type===e.BlockStatement&&x?[g,this.generateStatement(p,w)]:p.type===e.EmptyStatement&&x?";":(tt(function(){S=[m,bt(N.generateStatement(p,w))]}),S)},wt.prototype.maybeBlockSuffix=function(p,w){var S=ot(Ae(w).toString());return p.type===e.BlockStatement&&(!v.comment||!p.leadingComments)&&!S?[w,g]:S?[w,o]:[w,m,o]};function dt(p){return Ae(p.name,p)}function Kt(p,w){return p.async?"async"+(w?Ut():g):""}function K(p){var w=p.generator&&!v.moz.starlessGenerator;return w?"*"+g:""}function te(p){var w=p.value,S="";return w.async&&(S+=Kt(w,!p.computed)),w.generator&&(S+=K(w)?"*":""),S}wt.prototype.generatePattern=function(p,w,S){return p.type===e.Identifier?dt(p):this.generateExpression(p,w,S)},wt.prototype.generateFunctionParams=function(p){var w,S,x,N;if(N=!1,p.type===e.ArrowFunctionExpression&&!p.rest&&(!p.defaults||p.defaults.length===0)&&p.params.length===1&&p.params[0].type===e.Identifier)x=[Kt(p,!0),dt(p.params[0])];else{for(x=p.type===e.ArrowFunctionExpression?[Kt(p,!1)]:[],x.push("("),p.defaults&&(N=!0),w=0,S=p.params.length;w<S;++w)N&&p.defaults[w]?x.push(this.generateAssignment(p.params[w],p.defaults[w],"=",t.Assignment,he)):x.push(this.generatePattern(p.params[w],t.Assignment,he)),w+1<S&&x.push(","+g);p.rest&&(p.params.length&&x.push(","+g),x.push("..."),x.push(dt(p.rest))),x.push(")")}return x},wt.prototype.generateFunctionBody=function(p){var w,S;return w=this.generateFunctionParams(p),p.type===e.ArrowFunctionExpression&&(w.push(g),w.push("=>")),p.expression?(w.push(g),S=this.generateExpression(p.body,t.Assignment,he),S.toString().charAt(0)==="{"&&(S=["(",S,")"]),w.push(S)):w.push(this.maybeBlock(p.body,li)),w},wt.prototype.generateIterationForStatement=function(p,w,S){var x=["for"+(w.await?Ut()+"await":"")+g+"("],N=this;return tt(function(){w.left.type===e.VariableDeclaration?tt(function(){x.push(w.left.kind+Ut()),x.push(N.generateStatement(w.left.declarations[0],Je))}):x.push(N.generateExpression(w.left,t.Call,he)),x=Le(x,p),x=[Le(x,N.generateExpression(w.right,t.Assignment,he)),")"]}),x.push(this.maybeBlock(w.body,S)),x},wt.prototype.generatePropertyKey=function(p,w){var S=[];return w&&S.push("["),S.push(this.generateExpression(p,t.Assignment,he)),w&&S.push("]"),S},wt.prototype.generateAssignment=function(p,w,S,x,N){return t.Assignment<x&&(N|=H),$t([this.generateExpression(p,t.Call,N),g+S+g,this.generateExpression(w,t.Assignment,N)],t.Assignment,x)},wt.prototype.semicolon=function(p){return!b&&p&Be?"":";"},wt.Statement={BlockStatement:function(p,w){var S,x,N=["{",m],W=this;return tt(function(){p.body.length===0&&B&&(S=p.range,S[1]-S[0]>2&&(x=A.substring(S[0]+1,S[1]-1),x[0]===`
`&&(N=["{"]),N.push(x)));var J,le,Ce,Ye;for(Ye=Ze,w&Pe&&(Ye|=Me),J=0,le=p.body.length;J<le;++J)B&&(J===0&&(p.body[0].leadingComments&&(S=p.body[0].leadingComments[0].extendedRange,x=A.substring(S[0],S[1]),x[0]===`
`&&(N=["{"])),p.body[0].leadingComments||jn(p.range[0],p.body[0].range[0],N)),J>0&&!p.body[J-1].trailingComments&&!p.body[J].leadingComments&&jn(p.body[J-1].range[1],p.body[J].range[0],N)),J===le-1&&(Ye|=Be),p.body[J].leadingComments&&B?Ce=W.generateStatement(p.body[J],Ye):Ce=bt(W.generateStatement(p.body[J],Ye)),N.push(Ce),ot(Ae(Ce).toString())||B&&J<le-1&&p.body[J+1].leadingComments||N.push(m),B&&J===le-1&&(p.body[J].trailingComments||jn(p.body[J].range[1],p.range[1],N))}),N.push(bt("}")),N},BreakStatement:function(p,w){return p.label?"break "+p.label.name+this.semicolon(w):"break"+this.semicolon(w)},ContinueStatement:function(p,w){return p.label?"continue "+p.label.name+this.semicolon(w):"continue"+this.semicolon(w)},ClassBody:function(p,w){var S=["{",m],x=this;return tt(function(N){var W,J;for(W=0,J=p.body.length;W<J;++W)S.push(N),S.push(x.generateExpression(p.body[W],t.Sequence,he)),W+1<J&&S.push(m)}),ot(Ae(S).toString())||S.push(m),S.push(o),S.push("}"),S},ClassDeclaration:function(p,w){var S,x;return S=["class"],p.id&&(S=Le(S,this.generateExpression(p.id,t.Sequence,he))),p.superClass&&(x=Le("extends",this.generateExpression(p.superClass,t.Unary,he)),S=Le(S,x)),S.push(g),S.push(this.generateStatement(p.body,ve)),S},DirectiveStatement:function(p,w){return v.raw&&p.raw?p.raw+this.semicolon(w):Zi(p.directive)+this.semicolon(w)},DoWhileStatement:function(p,w){var S=Le("do",this.maybeBlock(p.body,Ze));return S=this.maybeBlockSuffix(p.body,S),Le(S,["while"+g+"(",this.generateExpression(p.test,t.Sequence,he),")"+this.semicolon(w)])},CatchClause:function(p,w){var S,x=this;return tt(function(){var N;p.param?(S=["catch"+g+"(",x.generateExpression(p.param,t.Sequence,he),")"],p.guard&&(N=x.generateExpression(p.guard,t.Sequence,he),S.splice(2,0," if ",N))):S=["catch"]}),S.push(this.maybeBlock(p.body,Ze)),S},DebuggerStatement:function(p,w){return"debugger"+this.semicolon(w)},EmptyStatement:function(p,w){return";"},ExportDefaultDeclaration:function(p,w){var S=["export"],x;return x=w&Be?ve:Ze,S=Le(S,"default"),j(p.declaration)?S=Le(S,this.generateStatement(p.declaration,x)):S=Le(S,this.generateExpression(p.declaration,t.Assignment,he)+this.semicolon(w)),S},ExportNamedDeclaration:function(p,w){var S=["export"],x,N=this;return x=w&Be?ve:Ze,p.declaration?Le(S,this.generateStatement(p.declaration,x)):(p.specifiers&&(p.specifiers.length===0?S=Le(S,"{"+g+"}"):p.specifiers[0].type===e.ExportBatchSpecifier?S=Le(S,this.generateExpression(p.specifiers[0],t.Sequence,he)):(S=Le(S,"{"),tt(function(W){var J,le;for(S.push(m),J=0,le=p.specifiers.length;J<le;++J)S.push(W),S.push(N.generateExpression(p.specifiers[J],t.Sequence,he)),J+1<le&&S.push(","+m)}),ot(Ae(S).toString())||S.push(m),S.push(o+"}")),p.source?S=Le(S,["from"+g,this.generateExpression(p.source,t.Sequence,he),this.semicolon(w)]):S.push(this.semicolon(w))),S)},ExportAllDeclaration:function(p,w){return["export"+g,"*"+g,"from"+g,this.generateExpression(p.source,t.Sequence,he),this.semicolon(w)]},ExpressionStatement:function(p,w){var S,x;function N(le){var Ce;return le.slice(0,5)!=="class"?!1:(Ce=le.charCodeAt(5),Ce===123||a.code.isWhiteSpace(Ce)||a.code.isLineTerminator(Ce))}function W(le){var Ce;return le.slice(0,8)!=="function"?!1:(Ce=le.charCodeAt(8),Ce===40||a.code.isWhiteSpace(Ce)||Ce===42||a.code.isLineTerminator(Ce))}function J(le){var Ce,Ye,lt;if(le.slice(0,5)!=="async"||!a.code.isWhiteSpace(le.charCodeAt(5)))return!1;for(Ye=6,lt=le.length;Ye<lt&&a.code.isWhiteSpace(le.charCodeAt(Ye));++Ye);return Ye===lt||le.slice(Ye,Ye+8)!=="function"?!1:(Ce=le.charCodeAt(Ye+8),Ce===40||a.code.isWhiteSpace(Ce)||Ce===42||a.code.isLineTerminator(Ce))}return S=[this.generateExpression(p.expression,t.Sequence,he)],x=Ae(S).toString(),x.charCodeAt(0)===123||N(x)||W(x)||J(x)||M&&w&Me&&p.expression.type===e.Literal&&typeof p.expression.value=="string"?S=["(",S,")"+this.semicolon(w)]:S.push(this.semicolon(w)),S},ImportDeclaration:function(p,w){var S,x,N=this;return p.specifiers.length===0?["import",g,this.generateExpression(p.source,t.Sequence,he),this.semicolon(w)]:(S=["import"],x=0,p.specifiers[x].type===e.ImportDefaultSpecifier&&(S=Le(S,[this.generateExpression(p.specifiers[x],t.Sequence,he)]),++x),p.specifiers[x]&&(x!==0&&S.push(","),p.specifiers[x].type===e.ImportNamespaceSpecifier?S=Le(S,[g,this.generateExpression(p.specifiers[x],t.Sequence,he)]):(S.push(g+"{"),p.specifiers.length-x===1?(S.push(g),S.push(this.generateExpression(p.specifiers[x],t.Sequence,he)),S.push(g+"}"+g)):(tt(function(W){var J,le;for(S.push(m),J=x,le=p.specifiers.length;J<le;++J)S.push(W),S.push(N.generateExpression(p.specifiers[J],t.Sequence,he)),J+1<le&&S.push(","+m)}),ot(Ae(S).toString())||S.push(m),S.push(o+"}"+g)))),S=Le(S,["from"+g,this.generateExpression(p.source,t.Sequence,he),this.semicolon(w)]),S)},VariableDeclarator:function(p,w){var S=w&H?he:Ct;return p.init?[this.generateExpression(p.id,t.Assignment,S),g,"=",g,this.generateExpression(p.init,t.Assignment,S)]:this.generatePattern(p.id,t.Assignment,S)},VariableDeclaration:function(p,w){var S,x,N,W,J,le=this;S=[p.kind],J=w&H?Ze:Je;function Ce(){for(W=p.declarations[0],v.comment&&W.leadingComments?(S.push(`
`),S.push(bt(le.generateStatement(W,J)))):(S.push(Ut()),S.push(le.generateStatement(W,J))),x=1,N=p.declarations.length;x<N;++x)W=p.declarations[x],v.comment&&W.leadingComments?(S.push(","+m),S.push(bt(le.generateStatement(W,J)))):(S.push(","+g),S.push(le.generateStatement(W,J)))}return p.declarations.length>1?tt(Ce):Ce(),S.push(this.semicolon(w)),S},ThrowStatement:function(p,w){return[Le("throw",this.generateExpression(p.argument,t.Sequence,he)),this.semicolon(w)]},TryStatement:function(p,w){var S,x,N,W;if(S=["try",this.maybeBlock(p.block,Ze)],S=this.maybeBlockSuffix(p.block,S),p.handlers)for(x=0,N=p.handlers.length;x<N;++x)S=Le(S,this.generateStatement(p.handlers[x],Ze)),(p.finalizer||x+1!==N)&&(S=this.maybeBlockSuffix(p.handlers[x].body,S));else{for(W=p.guardedHandlers||[],x=0,N=W.length;x<N;++x)S=Le(S,this.generateStatement(W[x],Ze)),(p.finalizer||x+1!==N)&&(S=this.maybeBlockSuffix(W[x].body,S));if(p.handler)if(Array.isArray(p.handler))for(x=0,N=p.handler.length;x<N;++x)S=Le(S,this.generateStatement(p.handler[x],Ze)),(p.finalizer||x+1!==N)&&(S=this.maybeBlockSuffix(p.handler[x].body,S));else S=Le(S,this.generateStatement(p.handler,Ze)),p.finalizer&&(S=this.maybeBlockSuffix(p.handler.body,S))}return p.finalizer&&(S=Le(S,["finally",this.maybeBlock(p.finalizer,Ze)])),S},SwitchStatement:function(p,w){var S,x,N,W,J,le=this;if(tt(function(){S=["switch"+g+"(",le.generateExpression(p.discriminant,t.Sequence,he),")"+g+"{"+m]}),p.cases)for(J=Ze,N=0,W=p.cases.length;N<W;++N)N===W-1&&(J|=Be),x=bt(this.generateStatement(p.cases[N],J)),S.push(x),ot(Ae(x).toString())||S.push(m);return S.push(bt("}")),S},SwitchCase:function(p,w){var S,x,N,W,J,le=this;return tt(function(){for(p.test?S=[Le("case",le.generateExpression(p.test,t.Sequence,he)),":"]:S=["default:"],N=0,W=p.consequent.length,W&&p.consequent[0].type===e.BlockStatement&&(x=le.maybeBlock(p.consequent[0],Ze),S.push(x),N=1),N!==W&&!ot(Ae(S).toString())&&S.push(m),J=Ze;N<W;++N)N===W-1&&w&Be&&(J|=Be),x=bt(le.generateStatement(p.consequent[N],J)),S.push(x),N+1!==W&&!ot(Ae(x).toString())&&S.push(m)}),S},IfStatement:function(p,w){var S,x,N,W=this;return tt(function(){S=["if"+g+"(",W.generateExpression(p.test,t.Sequence,he),")"]}),N=w&Be,x=Ze,N&&(x|=Be),p.alternate?(S.push(this.maybeBlock(p.consequent,Ze)),S=this.maybeBlockSuffix(p.consequent,S),p.alternate.type===e.IfStatement?S=Le(S,["else ",this.generateStatement(p.alternate,x)]):S=Le(S,Le("else",this.maybeBlock(p.alternate,x)))):S.push(this.maybeBlock(p.consequent,x)),S},ForStatement:function(p,w){var S,x=this;return tt(function(){S=["for"+g+"("],p.init?p.init.type===e.VariableDeclaration?S.push(x.generateStatement(p.init,Je)):(S.push(x.generateExpression(p.init,t.Sequence,Ct)),S.push(";")):S.push(";"),p.test&&(S.push(g),S.push(x.generateExpression(p.test,t.Sequence,he))),S.push(";"),p.update&&(S.push(g),S.push(x.generateExpression(p.update,t.Sequence,he))),S.push(")")}),S.push(this.maybeBlock(p.body,w&Be?ve:Ze)),S},ForInStatement:function(p,w){return this.generateIterationForStatement("in",p,w&Be?ve:Ze)},ForOfStatement:function(p,w){return this.generateIterationForStatement("of",p,w&Be?ve:Ze)},LabeledStatement:function(p,w){return[p.label.name+":",this.maybeBlock(p.body,w&Be?ve:Ze)]},Program:function(p,w){var S,x,N,W,J;for(W=p.body.length,S=[P&&W>0?`
`:""],J=Pt,N=0;N<W;++N)!P&&N===W-1&&(J|=Be),B&&(N===0&&(p.body[0].leadingComments||jn(p.range[0],p.body[N].range[0],S)),N>0&&!p.body[N-1].trailingComments&&!p.body[N].leadingComments&&jn(p.body[N-1].range[1],p.body[N].range[0],S)),x=bt(this.generateStatement(p.body[N],J)),S.push(x),N+1<W&&!ot(Ae(x).toString())&&(B&&p.body[N+1].leadingComments||S.push(m)),B&&N===W-1&&(p.body[N].trailingComments||jn(p.body[N].range[1],p.range[1],S));return S},FunctionDeclaration:function(p,w){return[Kt(p,!0),"function",K(p)||Ut(),p.id?dt(p.id):"",this.generateFunctionBody(p)]},ReturnStatement:function(p,w){return p.argument?[Le("return",this.generateExpression(p.argument,t.Sequence,he)),this.semicolon(w)]:["return"+this.semicolon(w)]},WhileStatement:function(p,w){var S,x=this;return tt(function(){S=["while"+g+"(",x.generateExpression(p.test,t.Sequence,he),")"]}),S.push(this.maybeBlock(p.body,w&Be?ve:Ze)),S},WithStatement:function(p,w){var S,x=this;return tt(function(){S=["with"+g+"(",x.generateExpression(p.object,t.Sequence,he),")"]}),S.push(this.maybeBlock(p.body,w&Be?ve:Ze)),S}},an(wt.prototype,wt.Statement),wt.Expression={SequenceExpression:function(p,w,S){var x,N,W;for(t.Sequence<w&&(S|=H),x=[],N=0,W=p.expressions.length;N<W;++N)x.push(this.generateExpression(p.expressions[N],t.Assignment,S)),N+1<W&&x.push(","+g);return $t(x,t.Sequence,w)},AssignmentExpression:function(p,w,S){return this.generateAssignment(p.left,p.right,p.operator,w,S)},ArrowFunctionExpression:function(p,w,S){return $t(this.generateFunctionBody(p),t.ArrowFunction,w)},ConditionalExpression:function(p,w,S){return t.Conditional<w&&(S|=H),$t([this.generateExpression(p.test,t.Coalesce,S),g+"?"+g,this.generateExpression(p.consequent,t.Assignment,S),g+":"+g,this.generateExpression(p.alternate,t.Assignment,S)],t.Conditional,w)},LogicalExpression:function(p,w,S){return p.operator==="??"&&(S|=Ke),this.BinaryExpression(p,w,S)},BinaryExpression:function(p,w,S){var x,N,W,J,le,Ce;return J=i[p.operator],N=p.operator==="**"?t.Postfix:J,W=p.operator==="**"?J:J+1,J<w&&(S|=H),le=this.generateExpression(p.left,N,S),Ce=le.toString(),Ce.charCodeAt(Ce.length-1)===47&&a.code.isIdentifierPartES5(p.operator.charCodeAt(0))?x=[le,Ut(),p.operator]:x=Le(le,p.operator),le=this.generateExpression(p.right,W,S),p.operator==="/"&&le.toString().charAt(0)==="/"||p.operator.slice(-1)==="<"&&le.toString().slice(0,3)==="!--"?(x.push(Ut()),x.push(le)):x=Le(x,le),p.operator==="in"&&!(S&H)?["(",x,")"]:(p.operator==="||"||p.operator==="&&")&&S&Ke?["(",x,")"]:$t(x,J,w)},CallExpression:function(p,w,S){var x,N,W;for(x=[this.generateExpression(p.callee,t.Call,yt)],p.optional&&x.push("?."),x.push("("),N=0,W=p.arguments.length;N<W;++N)x.push(this.generateExpression(p.arguments[N],t.Assignment,he)),N+1<W&&x.push(","+g);return x.push(")"),S&se?$t(x,t.Call,w):["(",x,")"]},ChainExpression:function(p,w,S){t.OptionalChaining<w&&(S|=se);var x=this.generateExpression(p.expression,t.OptionalChaining,S);return $t(x,t.OptionalChaining,w)},NewExpression:function(p,w,S){var x,N,W,J,le;if(N=p.arguments.length,le=S&oe&&!y&&N===0?Et:et,x=Le("new",this.generateExpression(p.callee,t.New,le)),!(S&oe)||y||N>0){for(x.push("("),W=0,J=N;W<J;++W)x.push(this.generateExpression(p.arguments[W],t.Assignment,he)),W+1<J&&x.push(","+g);x.push(")")}return $t(x,t.New,w)},MemberExpression:function(p,w,S){var x,N;return x=[this.generateExpression(p.object,t.Call,S&se?yt:et)],p.computed?(p.optional&&x.push("?."),x.push("["),x.push(this.generateExpression(p.property,t.Sequence,S&se?he:Et)),x.push("]")):(!p.optional&&p.object.type===e.Literal&&typeof p.object.value=="number"&&(N=Ae(x).toString(),N.indexOf(".")<0&&!/[eExX]/.test(N)&&a.code.isDecimalDigit(N.charCodeAt(N.length-1))&&!(N.length>=2&&N.charCodeAt(0)===48)&&x.push(" ")),x.push(p.optional?"?.":"."),x.push(dt(p.property))),$t(x,t.Member,w)},MetaProperty:function(p,w,S){var x;return x=[],x.push(typeof p.meta=="string"?p.meta:dt(p.meta)),x.push("."),x.push(typeof p.property=="string"?p.property:dt(p.property)),$t(x,t.Member,w)},UnaryExpression:function(p,w,S){var x,N,W,J,le;return N=this.generateExpression(p.argument,t.Unary,he),g===""?x=Le(p.operator,N):(x=[p.operator],p.operator.length>2?x=Le(x,N):(J=Ae(x).toString(),le=J.charCodeAt(J.length-1),W=N.toString().charCodeAt(0),((le===43||le===45)&&le===W||a.code.isIdentifierPartES5(le)&&a.code.isIdentifierPartES5(W))&&x.push(Ut()),x.push(N))),$t(x,t.Unary,w)},YieldExpression:function(p,w,S){var x;return p.delegate?x="yield*":x="yield",p.argument&&(x=Le(x,this.generateExpression(p.argument,t.Yield,he))),$t(x,t.Yield,w)},AwaitExpression:function(p,w,S){var x=Le(p.all?"await*":"await",this.generateExpression(p.argument,t.Await,he));return $t(x,t.Await,w)},UpdateExpression:function(p,w,S){return p.prefix?$t([p.operator,this.generateExpression(p.argument,t.Unary,he)],t.Unary,w):$t([this.generateExpression(p.argument,t.Postfix,he),p.operator],t.Postfix,w)},FunctionExpression:function(p,w,S){var x=[Kt(p,!0),"function"];return p.id?(x.push(K(p)||Ut()),x.push(dt(p.id))):x.push(K(p)||g),x.push(this.generateFunctionBody(p)),x},ArrayPattern:function(p,w,S){return this.ArrayExpression(p,w,S,!0)},ArrayExpression:function(p,w,S,x){var N,W,J=this;return p.elements.length?(W=x?!1:p.elements.length>1,N=["[",W?m:""],tt(function(le){var Ce,Ye;for(Ce=0,Ye=p.elements.length;Ce<Ye;++Ce)p.elements[Ce]?(N.push(W?le:""),N.push(J.generateExpression(p.elements[Ce],t.Assignment,he))):(W&&N.push(le),Ce+1===Ye&&N.push(",")),Ce+1<Ye&&N.push(","+(W?m:g))}),W&&!ot(Ae(N).toString())&&N.push(m),N.push(W?o:""),N.push("]"),N):"[]"},RestElement:function(p,w,S){return"..."+this.generatePattern(p.argument)},ClassExpression:function(p,w,S){var x,N;return x=["class"],p.id&&(x=Le(x,this.generateExpression(p.id,t.Sequence,he))),p.superClass&&(N=Le("extends",this.generateExpression(p.superClass,t.Unary,he)),x=Le(x,N)),x.push(g),x.push(this.generateStatement(p.body,ve)),x},MethodDefinition:function(p,w,S){var x,N;return p.static?x=["static"+g]:x=[],p.kind==="get"||p.kind==="set"?N=[Le(p.kind,this.generatePropertyKey(p.key,p.computed)),this.generateFunctionBody(p.value)]:N=[te(p),this.generatePropertyKey(p.key,p.computed),this.generateFunctionBody(p.value)],Le(x,N)},Property:function(p,w,S){return p.kind==="get"||p.kind==="set"?[p.kind,Ut(),this.generatePropertyKey(p.key,p.computed),this.generateFunctionBody(p.value)]:p.shorthand?p.value.type==="AssignmentPattern"?this.AssignmentPattern(p.value,t.Sequence,he):this.generatePropertyKey(p.key,p.computed):p.method?[te(p),this.generatePropertyKey(p.key,p.computed),this.generateFunctionBody(p.value)]:[this.generatePropertyKey(p.key,p.computed),":"+g,this.generateExpression(p.value,t.Assignment,he)]},ObjectExpression:function(p,w,S){var x,N,W,J=this;return p.properties.length?(x=p.properties.length>1,tt(function(){W=J.generateExpression(p.properties[0],t.Sequence,he)}),!x&&!Sn(Ae(W).toString())?["{",g,W,g,"}"]:(tt(function(le){var Ce,Ye;if(N=["{",m,le,W],x)for(N.push(","+m),Ce=1,Ye=p.properties.length;Ce<Ye;++Ce)N.push(le),N.push(J.generateExpression(p.properties[Ce],t.Sequence,he)),Ce+1<Ye&&N.push(","+m)}),ot(Ae(N).toString())||N.push(m),N.push(o),N.push("}"),N)):"{}"},AssignmentPattern:function(p,w,S){return this.generateAssignment(p.left,p.right,"=",w,S)},ObjectPattern:function(p,w,S){var x,N,W,J,le,Ce=this;if(!p.properties.length)return"{}";if(J=!1,p.properties.length===1)le=p.properties[0],le.type===e.Property&&le.value.type!==e.Identifier&&(J=!0);else for(N=0,W=p.properties.length;N<W;++N)if(le=p.properties[N],le.type===e.Property&&!le.shorthand){J=!0;break}return x=["{",J?m:""],tt(function(Ye){var lt,En;for(lt=0,En=p.properties.length;lt<En;++lt)x.push(J?Ye:""),x.push(Ce.generateExpression(p.properties[lt],t.Sequence,he)),lt+1<En&&x.push(","+(J?m:g))}),J&&!ot(Ae(x).toString())&&x.push(m),x.push(J?o:""),x.push("}"),x},ThisExpression:function(p,w,S){return"this"},Super:function(p,w,S){return"super"},Identifier:function(p,w,S){return dt(p)},ImportDefaultSpecifier:function(p,w,S){return dt(p.id||p.local)},ImportNamespaceSpecifier:function(p,w,S){var x=["*"],N=p.id||p.local;return N&&x.push(g+"as"+Ut()+dt(N)),x},ImportSpecifier:function(p,w,S){var x=p.imported,N=[x.name],W=p.local;return W&&W.name!==x.name&&N.push(Ut()+"as"+Ut()+dt(W)),N},ExportSpecifier:function(p,w,S){var x=p.local,N=[x.name],W=p.exported;return W&&W.name!==x.name&&N.push(Ut()+"as"+Ut()+dt(W)),N},Literal:function(p,w,S){var x;if(p.hasOwnProperty("raw")&&C&&v.raw)try{if(x=C(p.raw).body[0].expression,x.type===e.Literal&&x.value===p.value)return p.raw}catch{}return p.regex?"/"+p.regex.pattern+"/"+p.regex.flags:typeof p.value=="bigint"?p.value.toString()+"n":p.bigint?p.bigint+"n":p.value===null?"null":typeof p.value=="string"?ui(p.value):typeof p.value=="number"?Vi(p.value):typeof p.value=="boolean"?p.value?"true":"false":zi(p.value)},GeneratorExpression:function(p,w,S){return this.ComprehensionExpression(p,w,S)},ComprehensionExpression:function(p,w,S){var x,N,W,J,le=this;return x=p.type===e.GeneratorExpression?["("]:["["],v.moz.comprehensionExpressionStartsWithAssignment&&(J=this.generateExpression(p.body,t.Assignment,he),x.push(J)),p.blocks&&tt(function(){for(N=0,W=p.blocks.length;N<W;++N)J=le.generateExpression(p.blocks[N],t.Sequence,he),N>0||v.moz.comprehensionExpressionStartsWithAssignment?x=Le(x,J):x.push(J)}),p.filter&&(x=Le(x,"if"+g),J=this.generateExpression(p.filter,t.Sequence,he),x=Le(x,["(",J,")"])),v.moz.comprehensionExpressionStartsWithAssignment||(J=this.generateExpression(p.body,t.Assignment,he),x=Le(x,J)),x.push(p.type===e.GeneratorExpression?")":"]"),x},ComprehensionBlock:function(p,w,S){var x;return p.left.type===e.VariableDeclaration?x=[p.left.kind,Ut(),this.generateStatement(p.left.declarations[0],Je)]:x=this.generateExpression(p.left,t.Call,he),x=Le(x,p.of?"of":"in"),x=Le(x,this.generateExpression(p.right,t.Sequence,he)),["for"+g+"(",x,")"]},SpreadElement:function(p,w,S){return["...",this.generateExpression(p.argument,t.Assignment,he)]},TaggedTemplateExpression:function(p,w,S){var x=yt;S&se||(x=et);var N=[this.generateExpression(p.tag,t.Call,x),this.generateExpression(p.quasi,t.Primary,pe)];return $t(N,t.TaggedTemplate,w)},TemplateElement:function(p,w,S){return p.value.raw},TemplateLiteral:function(p,w,S){var x,N,W;for(x=["`"],N=0,W=p.quasis.length;N<W;++N)x.push(this.generateExpression(p.quasis[N],t.Primary,he)),N+1<W&&(x.push("${"+g),x.push(this.generateExpression(p.expressions[N],t.Sequence,he)),x.push(g+"}"));return x.push("`"),x},ModuleSpecifier:function(p,w,S){return this.Literal(p,w,S)},ImportExpression:function(p,w,S){return $t(["import(",this.generateExpression(p.source,t.Assignment,he),")"],t.Call,w)}},an(wt.prototype,wt.Expression),wt.prototype.generateExpression=function(p,w,S){var x,N;return N=p.type||e.Property,v.verbatim&&p.hasOwnProperty(v.verbatim)?ks(p,w):(x=this[N](p,w,S),v.comment&&(x=ci(p,x)),Ae(x,p))},wt.prototype.generateStatement=function(p,w){var S,x;return S=this[p.type](p,w),v.comment&&(S=ci(p,S)),x=Ae(S).toString(),p.type===e.Program&&!P&&m===""&&x.charAt(x.length-1)===`
`&&(S=E?Ae(S).replaceRight(/\s+$/,""):x.replace(/\s+$/,"")),Ae(S,p)};function Y(p){var w;if(w=new wt,j(p))return w.generateStatement(p,Ze);if(X(p))return w.generateExpression(p,t.Sequence,he);throw new Error("Unknown node type: "+p.type)}function de(p,w){var S=Bn(),x,N;return w!=null?(typeof w.indent=="string"&&(S.format.indent.style=w.indent),typeof w.base=="number"&&(S.format.indent.base=w.base),w=ti(S,w),l=w.format.indent.style,typeof w.base=="string"?o=w.base:o=Lt(l,w.format.indent.base)):(w=S,l=w.format.indent.style,o=Lt(l,w.format.indent.base)),c=w.format.json,u=w.format.renumber,h=c?!1:w.format.hexadecimal,d=c?"double":w.format.quotes,f=w.format.escapeless,m=w.format.newline,g=w.format.space,w.format.compact&&(m=g=l=o=""),y=w.format.parentheses,b=w.format.semicolons,P=w.format.safeConcatenation,M=w.directive,C=c?null:w.parse,E=w.sourceMap,A=w.sourceCode,B=w.format.preserveBlankLines&&A!==null,v=w,E&&(n.browser?s=l$.sourceMap.SourceNode:s=b$().SourceNode),x=Y(p),E?(N=x.toStringWithSourceMap({file:w.file,sourceRoot:w.sourceMapRoot}),w.sourceContent&&N.map.setSourceContent(w.sourceMap,w.sourceContent),w.sourceMapWithCode?N:N.map.toString()):(N={code:x.toString(),map:null},w.sourceMapWithCode?N:N.code)}Z={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},q=Bn().format,n.version=S$.version,n.generate=de,n.attachComments=r.attachComments,n.Precedence=ti({},t),n.browser=!1,n.FORMAT_MINIFY=Z,n.FORMAT_DEFAULTS=q})()})(sc)),sc}var C$=w$();class P${constructor(){this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.context={skip:()=>this.should_skip=!0,remove:()=>this.should_remove=!0,replace:e=>this.replacement=e}}replace(e,t,i,s){e&&t&&(i!=null?e[t][i]=s:e[t]=s)}remove(e,t,i){e&&t&&(i!=null?e[t].splice(i,1):delete e[t])}}class A$ extends P${constructor(e,t){super(),this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.context={skip:()=>this.should_skip=!0,remove:()=>this.should_remove=!0,replace:i=>this.replacement=i},this.enter=e,this.leave=t}visit(e,t,i,s){if(e){if(this.enter){const a=this.should_skip,o=this.should_remove,l=this.replacement;this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.enter.call(this.context,e,t,i,s),this.replacement&&(e=this.replacement,this.replace(t,i,s,e)),this.should_remove&&this.remove(t,i,s);const c=this.should_skip,u=this.should_remove;if(this.should_skip=a,this.should_remove=o,this.replacement=l,c)return e;if(u)return null}let r;for(r in e){const a=e[r];if(a&&typeof a=="object")if(Array.isArray(a)){const o=a;for(let l=0;l<o.length;l+=1){const c=o[l];Km(c)&&(this.visit(c,e,r,l)||l--)}}else Km(a)&&this.visit(a,e,r,null)}if(this.leave){const a=this.replacement,o=this.should_remove;this.replacement=null,this.should_remove=!1,this.leave.call(this.context,e,t,i,s),this.replacement&&(e=this.replacement,this.replace(t,i,s,e)),this.should_remove&&this.remove(t,i,s);const l=this.should_remove;if(this.replacement=a,this.should_remove=o,l)return null}}return e}}function Km(n){return n!==null&&typeof n=="object"&&"type"in n&&typeof n.type=="string"}function x$(n,{enter:e,leave:t}){return new A$(e,t).visit(n,null)}let E$=[],El=new Map;function k$(n,e={}){var d;const{wrapAsync:t=!1,addReturn:i=!0,emitMiniLocations:s=!0,emitWidgets:r=!0}=e;let a=o$(n,{ecmaVersion:2022,allowAwaitOutsideFunction:!0,locations:!0}),o=[];const l=(f,m)=>{const g=El.get("minilang");if(g){const y=`[${f}]`,b=g.getLocations(y,m.start);o=o.concat(b)}else{const y=by(`"${f}"`,m.start,n);o=o.concat(y)}};let c=[];x$(a,{enter(f,m){var g,y,b;if(Q$(f)){const{name:P}=f.tag,M=El.get(P),v=f.quasi.quasis[0].value.raw,C=f.quasi.start+1;if(s){const E=M.getLocations(v,C);o=o.concat(E)}return this.skip(),this.replace(Z$(P,v,C))}if(V$(f,"tidal")){const P=f.quasi.quasis[0].value.raw,M=f.quasi.start+1;if(s){const v=z$(P,M);o=o.concat(v)}return this.skip(),this.replace(j$(P,M))}if(D$(f,m)){const{quasis:P}=f,{raw:M}=P[0].value;return this.skip(),s&&l(M,f),this.replace(Jm(M,f))}if(M$(f)){const{value:P}=f;return this.skip(),s&&l(P,f),this.replace(Jm(P,f))}if($$(f))return r&&c.push({from:f.arguments[0].start,to:f.arguments[0].end,value:f.arguments[0].raw,min:((g=f.arguments[1])==null?void 0:g.value)??0,max:((y=f.arguments[2])==null?void 0:y.value)??1,step:(b=f.arguments[3])==null?void 0:b.value,type:"slider"}),this.replace(_$(f));if(T$(f)){const P=f.callee.property.name,M=c.filter(C=>C.type===P).length,v={to:f.end,index:M,type:P,id:e.id};return r&&c.push(v),this.replace(B$(f,v))}if(F$(f,m))return this.replace(R$(f));if(I$(f))return this.replace(L$(f))},leave(f,m,g,y){}});let{body:u}=a;if(!u.length)console.warn("empty body -> fallback to silence"),u.push({type:"ExpressionStatement",expression:{type:"Identifier",name:"silence"}});else if(!((d=u==null?void 0:u[u.length-1])!=null&&d.expression))throw new Error("unexpected ast format without body expression");if(i){const{expression:f}=u[u.length-1];u[u.length-1]={type:"ReturnStatement",argument:f}}let h=C$.generate(a);return t&&(h=`(async ()=>{${h}})()`),s?{output:h,miniLocations:o,widgets:c}:{output:h}}function M$(n,e,t){return n.type!=="Literal"?!1:n.raw[0]==='"'}function D$(n,e){return n.type==="TemplateLiteral"&&e.type!=="TaggedTemplateExpression"}function Jm(n,e){const{start:t}=e,i=El.get("minilang");let s="m";return i&&i.name&&(s=i.name),{type:"CallExpression",callee:{type:"Identifier",name:s},arguments:[{type:"Literal",value:n},{type:"Literal",value:t}],optional:!1}}function $$(n){return n.type==="CallExpression"&&n.callee.name==="slider"}function T$(n){var e;return n.type==="CallExpression"&&E$.includes((e=n.callee.property)==null?void 0:e.name)}function _$(n){const e="slider_"+n.arguments[0].start;return n.arguments.unshift({type:"Literal",value:e,raw:e}),n.callee.name="sliderWithID",n}function N$(n){return`${n.id||""}_widget_${n.type}_${n.index}`}function B$(n,e){const t=N$(e);return n.arguments.unshift({type:"Literal",value:t,raw:t}),n}function F$(n,e){return n.type==="CallExpression"&&n.callee.name==="samples"&&e.type!=="AwaitExpression"}function R$(n){return{type:"AwaitExpression",argument:n}}function I$(n){return n.type==="LabeledStatement"}function L$(n){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"MemberExpression",object:n.body.expression,property:{type:"Identifier",name:"p"}},arguments:[{type:"Literal",value:n.label.name,raw:`'${n.label.name}'`}]}}}function Q$(n){return n.type==="TaggedTemplateExpression"&&El.has(n.tag.name)}function V$(n,e){return n.type==="TaggedTemplateExpression"&&n.tag.name===e}function z$(n,e){return n.split("").reduce((t,i,s)=>(i!=='"'||(!t.length||t[t.length-1].length>1?t.push([s+1]):t[t.length-1].push(s)),t),[]).map(([t,i])=>{const s=n.slice(t,i);return by(`"${s}"`,e+t-1)}).flat()}function j$(n,e){return{type:"CallExpression",callee:{type:"Identifier",name:"tidal"},arguments:[{type:"Literal",value:n},{type:"Literal",value:e}],optional:!1}}function Z$(n,e,t){return{type:"CallExpression",callee:{type:"Identifier",name:n},arguments:[{type:"Literal",value:e},{type:"Literal",value:t}],optional:!1}}class G${constructor(){this.modal=null,this.onLoginSuccess=null}init(){this.createModal(),this.attachEventListeners(),this.checkAuthStatus()}createModal(){document.body.insertAdjacentHTML("beforeend",`
      <div class="login-modal-overlay" id="login-modal-overlay" style="display: none;">
        <div class="login-modal">
          <div class="login-modal-header">
            <h2>Login to Strudesk 4000</h2>
            <button class="login-modal-close" id="login-modal-close" aria-label="Close">&times;</button>
          </div>
          <div class="login-modal-body">
            <p>Sign in to save and share your patterns</p>
            <div class="login-buttons">
              <button class="login-button login-button-google" id="login-google">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
                  <path d="M9 18c2.43 0 4.467-.806 5.965-2.18l-2.908-2.258c-.806.54-1.837.86-3.057.86-2.35 0-4.34-1.587-5.053-3.72H.957v2.332C2.438 15.983 5.482 18 9 18z" fill="#34A853"/>
                  <path d="M3.947 10.712c-.18-.54-.282-1.117-.282-1.712s.102-1.172.282-1.712V4.956H.957C.348 6.174 0 7.55 0 9s.348 2.826.957 4.044l2.99-2.332z" fill="#FBBC05"/>
                  <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.956L3.947 7.288C4.66 5.153 6.65 3.58 9 3.58z" fill="#EA4335"/>
                </svg>
                Continue with Google
              </button>
              <button class="login-button login-button-github" id="login-github">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                Continue with GitHub
              </button>
            </div>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("login-modal-overlay")}attachEventListeners(){const e=document.getElementById("login-modal-close");e&&e.addEventListener("click",()=>this.hide()),this.modal&&this.modal.addEventListener("click",r=>{r.target===this.modal&&this.hide()});const t=document.getElementById("login-google");t&&t.addEventListener("click",async()=>{const{authAPI:r}=await rn(async()=>{const{authAPI:a}=await Promise.resolve().then(()=>rs);return{authAPI:a}},void 0);window.location.href=r.getGoogleLoginUrl()});const i=document.getElementById("login-github");i&&i.addEventListener("click",async()=>{const{authAPI:r}=await rn(async()=>{const{authAPI:a}=await Promise.resolve().then(()=>rs);return{authAPI:a}},void 0);window.location.href=r.getGithubLoginUrl()}),new URLSearchParams(window.location.search).get("auth")==="success"&&(this.checkAuthStatus(),window.history.replaceState({},document.title,window.location.pathname))}async checkAuthStatus(){try{const{getCurrentUser:e}=await rn(async()=>{const{getCurrentUser:i}=await Promise.resolve().then(()=>rs);return{getCurrentUser:i}},void 0),t=await e();t&&this.onLoginSuccess&&this.onLoginSuccess(t)}catch{}}show(){this.modal&&(this.modal.style.display="flex",document.body.style.overflow="hidden")}hide(){this.modal&&(this.modal.style.display="none",document.body.style.overflow="")}setOnLoginSuccess(e){this.onLoginSuccess=e}}const qh="/api";class gc extends Error{constructor(e,t,i){super(e),this.status=t,this.data=i}}async function ai(n,e={}){const t=`${qh}${n}`,i={...e,credentials:"include",headers:{"Content-Type":"application/json",...e.headers}};try{const s=await fetch(t,i),r=await s.json().catch(()=>({}));if(!s.ok)throw new gc(r.error||"Request failed",s.status,r);return r}catch(s){throw s instanceof gc?s:new gc(s.message||"Network error",0,null)}}const Yd={async getCurrentUser(){return ai("/auth/me")},async logout(){return ai("/auth/logout",{method:"POST"})},getGoogleLoginUrl(){return`${qh}/auth/google`},getGithubLoginUrl(){return`${qh}/auth/github`}},kl={async listUsers(n="",e=50){const t=new URLSearchParams;return n&&t.append("search",n),t.append("limit",e),ai(`/users?${t.toString()}`)},async getUser(n){return ai(`/users/${n}`)},async updateUser(n,e){return ai(`/users/${n}`,{method:"PUT",body:JSON.stringify(e)})},async searchUsers(n){return ai(`/users/search/${encodeURIComponent(n)}`)}},Wh={async createPattern(n){return ai("/patterns",{method:"POST",body:JSON.stringify(n)})},async getPatterns(n={}){const e=new URLSearchParams;n.type&&e.append("type",n.type),n.isPublic!==void 0&&e.append("isPublic",n.isPublic),n.shared!==void 0&&e.append("shared",n.shared);const t=e.toString();return ai(`/patterns${t?`?${t}`:""}`)},async getPattern(n){return ai(`/patterns/${n}`)},async updatePattern(n,e){return ai(`/patterns/${n}`,{method:"PUT",body:JSON.stringify(e)})},async deletePattern(n){return ai(`/patterns/${n}`,{method:"DELETE"})},async sharePattern(n,e){return ai(`/patterns/${n}/share`,{method:"POST",body:JSON.stringify({userIds:e})})},async getPatternUsers(n){return ai(`/patterns/${n}/users`)}};async function ou(){try{return await Yd.getCurrentUser()}catch{return null}}const rs=Object.freeze(Object.defineProperty({__proto__:null,authAPI:Yd,getCurrentUser:ou,patternsAPI:Wh,usersAPI:kl},Symbol.toStringTag,{value:"Module"}));class U${constructor(){this.modal=null,this.user=null,this.onUpdate=null}init(){this.createModal(),this.attachEventListeners()}createModal(){document.body.insertAdjacentHTML("beforeend",`
      <div class="user-profile-modal-overlay" id="user-profile-modal-overlay" style="display: none;">
        <div class="user-profile-modal">
          <div class="user-profile-modal-header">
            <h2>Edit Profile</h2>
            <button class="user-profile-modal-close" id="user-profile-modal-close" aria-label="Close">&times;</button>
          </div>
          <div class="user-profile-modal-body">
            <form id="user-profile-form">
              <div class="form-group">
                <label for="profile-avatar-url">Profile Image</label>
                <div class="avatar-preview-container">
                  <img id="profile-avatar-preview" src="" alt="Avatar preview" style="display: none; width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 2px solid #ddd;" />
                  <input type="url" id="profile-avatar-url" placeholder="https://example.com/your-image.jpg" />
                  <small>Enter a URL to your profile image</small>
                </div>
              </div>

              <div class="form-group">
                <label for="profile-artist-name">Artist Name (Pseudonym)</label>
                <input type="text" id="profile-artist-name" placeholder="Your artist name or pseudonym" />
                <small>This will be used as the default copyright holder for your patterns</small>
              </div>

              <div class="form-group">
                <label>Social Media Links</label>
                <div class="social-links-grid">
                  <div class="social-link-item">
                    <label for="social-twitter">Twitter/X</label>
                    <input type="url" id="social-twitter" placeholder="https://twitter.com/username" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-instagram">Instagram</label>
                    <input type="url" id="social-instagram" placeholder="https://instagram.com/username" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-soundcloud">SoundCloud</label>
                    <input type="url" id="social-soundcloud" placeholder="https://soundcloud.com/username" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-bandcamp">Bandcamp</label>
                    <input type="url" id="social-bandcamp" placeholder="https://username.bandcamp.com" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-youtube">YouTube</label>
                    <input type="url" id="social-youtube" placeholder="https://youtube.com/@username" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-spotify">Spotify</label>
                    <input type="url" id="social-spotify" placeholder="https://open.spotify.com/artist/..." />
                  </div>
                  <div class="social-link-item">
                    <label for="social-website">Website</label>
                    <input type="url" id="social-website" placeholder="https://yourwebsite.com" />
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="user-profile-info">
                  <p><strong>Name:</strong> <span id="profile-display-name"></span></p>
                  <p><strong>Email:</strong> <span id="profile-display-email"></span></p>
                </div>
              </div>

              <div class="user-profile-modal-footer">
                <button type="button" class="btn-cancel" id="profile-cancel-btn">Cancel</button>
                <button type="submit" class="btn-save" id="profile-save-btn">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("user-profile-modal-overlay")}attachEventListeners(){const e=document.getElementById("user-profile-modal-close");e&&e.addEventListener("click",()=>this.hide());const t=document.getElementById("profile-cancel-btn");t&&t.addEventListener("click",()=>this.hide()),this.modal&&this.modal.addEventListener("click",s=>{s.target===this.modal&&this.hide()});const i=document.getElementById("user-profile-form");i&&i.addEventListener("submit",async s=>{s.preventDefault(),await this.saveProfile()})}async loadUserData(){try{const e=await ou();if(!e)throw new Error("Not authenticated");this.user=e;const t=await kl.getUser(e.id);this.user=t;const i=document.getElementById("profile-avatar-url"),s=document.getElementById("profile-avatar-preview");i&&(i.value=t.avatarUrl||"",i.addEventListener("input",u=>{const h=u.target.value.trim();s&&(h?(s.src=h,s.style.display="block",s.onerror=()=>{s.style.display="none"}):s.style.display="none")}),t.avatarUrl&&s&&(s.src=t.avatarUrl,s.style.display="block",s.onerror=()=>{s.style.display="none"}));const r=document.getElementById("profile-artist-name");r&&(r.value=t.artistName||"");const a=document.getElementById("profile-display-name");a&&(a.textContent=t.name);const o=document.getElementById("profile-display-email");o&&(o.textContent=t.email);const l=t.socialLinks||{};return["twitter","instagram","soundcloud","bandcamp","youtube","spotify","website"].forEach(u=>{const h=document.getElementById(`social-${u}`);h&&(h.value=l[u]||"")}),t}catch(e){return console.error("Error loading user data:",e),alert("Failed to load profile data"),null}}async saveProfile(){var e,t;if(!this.user){alert("User not loaded");return}try{const i=((e=document.getElementById("profile-avatar-url"))==null?void 0:e.value.trim())||null,s=((t=document.getElementById("profile-artist-name"))==null?void 0:t.value.trim())||null,r={};["twitter","instagram","soundcloud","bandcamp","youtube","spotify","website"].forEach(l=>{const c=document.getElementById(`social-${l}`);c&&c.value.trim()&&(r[l]=c.value.trim())});const o=await kl.updateUser(this.user.id,{avatarUrl:i,artistName:s,socialLinks:r});this.user=o,this.onUpdate&&this.onUpdate(o),this.hide(),alert("Profile updated successfully!")}catch(i){console.error("Error saving profile:",i),alert("Failed to save profile: "+(i.message||"Unknown error"))}}async show(){this.modal&&(await this.loadUserData(),this.modal.style.display="flex",document.body.style.overflow="hidden")}hide(){this.modal&&(this.modal.style.display="none",document.body.style.overflow="")}setOnUpdate(e){this.onUpdate=e}}class q${constructor(){this.modal=null,this.users=[],this.searchTimeout=null}init(){this.createModal(),this.attachEventListeners()}createModal(){document.body.insertAdjacentHTML("beforeend",`
      <div class="user-profiles-modal-overlay" id="user-profiles-modal-overlay" style="display: none;">
        <div class="user-profiles-modal">
          <div class="user-profiles-modal-header">
            <h2>User Profiles</h2>
            <button class="user-profiles-modal-close" id="user-profiles-modal-close" aria-label="Close">&times;</button>
          </div>
          <div class="user-profiles-modal-body">
            <div class="profiles-search-container">
              <input 
                type="text" 
                id="profiles-search-input" 
                placeholder="Search users by name, email, or artist name..." 
                class="profiles-search-input"
              />
            </div>
            <div class="profiles-list" id="profiles-list">
              <div class="profiles-loading">Loading profiles...</div>
            </div>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("user-profiles-modal-overlay")}attachEventListeners(){const e=document.getElementById("user-profiles-modal-close");e&&e.addEventListener("click",()=>this.hide()),this.modal&&this.modal.addEventListener("click",i=>{i.target===this.modal&&this.hide()});const t=document.getElementById("profiles-search-input");t&&t.addEventListener("input",i=>{const s=i.target.value.trim();clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.loadUsers(s)},300)})}async loadUsers(e=""){const t=document.getElementById("profiles-list");if(t)try{t.innerHTML='<div class="profiles-loading">Loading profiles...</div>';const i=await kl.listUsers(e,100);if(this.users=i,i.length===0){t.innerHTML='<div class="profiles-empty">No users found.</div>';return}t.innerHTML=i.map(s=>this.renderUserCard(s)).join("")}catch(i){console.error("Error loading users:",i),t.innerHTML='<div class="profiles-error">Failed to load profiles. Please try again.</div>'}}renderUserCard(e){var o;const t=e.avatarUrl||"https://via.placeholder.com/80?text="+encodeURIComponent(e.name.charAt(0).toUpperCase()),i=e.artistName?`<div class="user-card-artist">${this.escapeHtml(e.artistName)}</div>`:"",s=((o=e._count)==null?void 0:o.patterns)||0,r=e.socialLinks||{},a=this.renderSocialLinks(r);return`
      <div class="user-card" data-user-id="${e.id}">
        <div class="user-card-avatar">
          <img src="${t}" alt="${this.escapeHtml(e.name)}" onerror="this.src='https://via.placeholder.com/80?text=' + encodeURIComponent('${this.escapeHtml(e.name.charAt(0).toUpperCase())}')" />
        </div>
        <div class="user-card-info">
          <div class="user-card-name">${this.escapeHtml(e.name)}</div>
          ${i}
          <div class="user-card-email">${this.escapeHtml(e.email)}</div>
          <div class="user-card-stats">
            <span class="user-card-patterns">${s} pattern${s!==1?"s":""}</span>
          </div>
          ${a}
        </div>
      </div>
    `}getSocialIcon(e){return{twitter:'<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>',instagram:'<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>',soundcloud:'<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M1.175 13.5c-.619 0-1.125-.506-1.125-1.125s.506-1.125 1.125-1.125h1.125v2.25H1.175zm2.25-3c-.619 0-1.125-.506-1.125-1.125S2.806 8.25 3.425 8.25h1.125v2.25H3.425zm2.25-2.25c-.619 0-1.125-.506-1.125-1.125S5.056 6 5.675 6h1.125v2.25H5.675zm2.25-1.5c-.619 0-1.125-.506-1.125-1.125S7.306 4.5 7.925 4.5H9.05v2.25H7.925zm2.25-1.5c-.619 0-1.125-.506-1.125-1.125S9.556 3 10.175 3h1.125v2.25h-1.125zm2.25 0c-.619 0-1.125-.506-1.125-1.125S11.806 3 12.425 3h1.125v2.25h-1.125zm2.25 1.5c-.619 0-1.125-.506-1.125-1.125S14.056 4.5 14.675 4.5h1.125v2.25h-1.125zm2.25 1.5c-.619 0-1.125-.506-1.125-1.125S16.306 6 16.925 6h1.125v2.25h-1.125zm2.25 2.25c-.619 0-1.125-.506-1.125-1.125S18.556 8.25 19.175 8.25h1.125v2.25h-1.125zm2.25 3c-.619 0-1.125-.506-1.125-1.125S20.806 11.25 21.425 11.25h1.125v2.25h-1.125z"/></svg>',bandcamp:'<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M0 18.75l7.5-7.5L0 3.75V0h24v3.75L16.5 11.25l7.5 7.5V24H0v-5.25z"/></svg>',youtube:'<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/></svg>',spotify:'<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.84-.179-.84-.66 0-.419.36-.66.78-.54 4.56 1.021 8.52 1.561 11.64 1.92.42.06.66.36.6.78zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.42 1.56-.3.421-1.02.599-1.56.3z"/></svg>',website:'<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM18.92 8h-2.95c-.32-1.25-.78-2.45-1.38-3.56 1.84.63 3.37 1.91 4.33 3.56zM12 4.04c.83 1.2 1.48 2.53 1.91 3.96h-3.82c.43-1.43 1.08-2.76 1.91-3.96zM4.26 14C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2H4.26zm.82 2h2.95c.32 1.25.78 2.45 1.38 3.56-1.84-.63-3.37-1.9-4.33-3.56zm2.95-8H5.08c.96-1.66 2.49-2.93 4.33-3.56C8.81 5.55 8.35 6.75 8.03 8zM12 19.96c-.83-1.2-1.48-2.53-1.91-3.96h3.82c-.43 1.43-1.08 2.76-1.91 3.96zM14.34 14H9.66c-.09-.66-.16-1.32-.16-2 0-.68.07-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2zm.25 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95c-.96 1.65-2.49 2.93-4.33 3.56zM16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2h-3.38z"/></svg>'}[e]||'<svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>'}renderSocialLinks(e){const t=[];return Object.entries(e).forEach(([i,s])=>{if(s){const r=this.getSocialIcon(i);t.push(`<a href="${this.escapeHtml(s)}" target="_blank" rel="noopener noreferrer" class="user-card-social-link" title="${i}">${r}</a>`)}}),t.length===0?"":`<div class="user-card-social">${t.join("")}</div>`}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async show(){if(this.modal){this.modal.style.display="flex",document.body.style.overflow="hidden",await this.loadUsers();const e=document.getElementById("profiles-search-input");e&&setTimeout(()=>e.focus(),100)}}hide(){if(this.modal){this.modal.style.display="none",document.body.style.overflow="";const e=document.getElementById("profiles-search-input");e&&(e.value="")}}}class W${constructor(){this.modal=null,this.onSave=null,this.currentPattern=null,this.patternType=null,this.elementId=null,this.selectedUsers=[]}init(){this.createModal(),this.attachEventListeners()}createModal(){document.body.insertAdjacentHTML("beforeend",`
      <div class="save-pattern-modal-overlay" id="save-pattern-modal-overlay" style="display: none;">
        <div class="save-pattern-modal">
          <div class="save-pattern-modal-header">
            <h2>Save Pattern</h2>
            <button class="save-pattern-modal-close" id="save-pattern-modal-close" aria-label="Close">&times;</button>
          </div>
          <div class="save-pattern-modal-body">
            <form id="save-pattern-form">
              <div class="form-group">
                <label for="save-pattern-title">Title (optional)</label>
                <input type="text" id="save-pattern-title" placeholder="e.g., My Awesome Beat" />
              </div>

              <div class="form-group">
                <label for="save-pattern-artist">Artist Name (optional)</label>
                <input type="text" id="save-pattern-artist" placeholder="Leave empty to use your default artist name" />
                <small>Override your default artist name for this pattern</small>
              </div>

              <div class="form-group">
                <label for="save-pattern-version-name">Version Name (optional)</label>
                <input type="text" id="save-pattern-version-name" placeholder="e.g., Remix, Live, Studio" />
                <small>Add a label to this version (version number is automatic)</small>
              </div>

              <div class="form-group" id="save-pattern-genre-group" style="display: none;">
                <label for="save-pattern-genre">Genre/Style (optional)</label>
                <select id="save-pattern-genre">
                  <option value="">Select a genre...</option>
                  <optgroup label="Electronic">
                    <option value="Techno">Techno</option>
                    <option value="House">House</option>
                    <option value="Trance">Trance</option>
                    <option value="Dubstep">Dubstep</option>
                    <option value="Drum & Bass">Drum & Bass</option>
                    <option value="Ambient">Ambient</option>
                    <option value="IDM">IDM</option>
                    <option value="Electro">Electro</option>
                    <option value="Synthwave">Synthwave</option>
                    <option value="Industrial">Industrial</option>
                  </optgroup>
                  <optgroup label="Hip Hop & Urban">
                    <option value="Hip Hop">Hip Hop</option>
                    <option value="Trap">Trap</option>
                    <option value="R&B">R&B</option>
                    <option value="Grime">Grime</option>
                    <option value="Drill">Drill</option>
                  </optgroup>
                  <optgroup label="Rock & Alternative">
                    <option value="Rock">Rock</option>
                    <option value="Alternative">Alternative</option>
                    <option value="Indie">Indie</option>
                    <option value="Punk">Punk</option>
                    <option value="Metal">Metal</option>
                    <option value="Post-Rock">Post-Rock</option>
                  </optgroup>
                  <optgroup label="Jazz & Blues">
                    <option value="Jazz">Jazz</option>
                    <option value="Blues">Blues</option>
                    <option value="Smooth Jazz">Smooth Jazz</option>
                    <option value="Bebop">Bebop</option>
                    <option value="Fusion">Fusion</option>
                  </optgroup>
                  <optgroup label="World & Folk">
                    <option value="World">World</option>
                    <option value="Folk">Folk</option>
                    <option value="Traditional">Traditional</option>
                    <option value="Ethnic">Ethnic</option>
                  </optgroup>
                  <optgroup label="Pop & Dance">
                    <option value="Pop">Pop</option>
                    <option value="Dance">Dance</option>
                    <option value="EDM">EDM</option>
                    <option value="Disco">Disco</option>
                    <option value="Funk">Funk</option>
                  </optgroup>
                  <optgroup label="Experimental">
                    <option value="Experimental">Experimental</option>
                    <option value="Noise">Noise</option>
                    <option value="Avant-garde">Avant-garde</option>
                    <option value="Minimal">Minimal</option>
                  </optgroup>
                  <optgroup label="Other">
                    <option value="Cinematic">Cinematic</option>
                    <option value="Game Music">Game Music</option>
                    <option value="Other">Other</option>
                  </optgroup>
                </select>
                <small>Select a genre to help with pattern matching and discovery</small>
              </div>

              <div class="form-group">
                <label class="privacy-toggle-label">
                  <input type="checkbox" id="save-pattern-public" />
                  <span>Make this pattern public</span>
                </label>
                <small>Public patterns can be seen and used by all users</small>
              </div>

              <div class="form-group" id="save-pattern-share-group" style="display: none;">
                <label>Share with specific users (optional)</label>
                <div class="user-search-container">
                  <input type="text" id="save-pattern-user-search" placeholder="Search users by name or email..." />
                  <div class="user-search-results" id="save-pattern-user-results"></div>
                </div>
                <div class="selected-users" id="save-pattern-selected-users"></div>
              </div>

              <div class="save-pattern-modal-footer">
                <button type="button" class="btn-cancel" id="save-pattern-cancel-btn">Cancel</button>
                <button type="submit" class="btn-save" id="save-pattern-save-btn">Save Pattern</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("save-pattern-modal-overlay")}attachEventListeners(){const e=document.getElementById("save-pattern-modal-close");e&&e.addEventListener("click",()=>this.hide());const t=document.getElementById("save-pattern-cancel-btn");t&&t.addEventListener("click",()=>this.hide()),this.modal&&this.modal.addEventListener("click",o=>{o.target===this.modal&&this.hide()});const i=document.getElementById("save-pattern-form");i&&i.addEventListener("submit",async o=>{o.preventDefault(),await this.savePattern()});const s=document.getElementById("save-pattern-public"),r=document.getElementById("save-pattern-share-group");s&&r&&s.addEventListener("change",o=>{o.target.checked?(r.style.display="none",this.selectedUsers=[],this.updateSelectedUsers()):r.style.display="block"});const a=document.getElementById("save-pattern-user-search");if(a){let o;a.addEventListener("input",l=>{clearTimeout(o);const c=l.target.value.trim();c.length>=2?o=setTimeout(()=>this.searchUsers(c),300):this.clearUserSearchResults()})}}async searchUsers(e){try{const{usersAPI:t}=await rn(async()=>{const{usersAPI:s}=await Promise.resolve().then(()=>rs);return{usersAPI:s}},void 0),i=await t.searchUsers(e);this.displayUserSearchResults(i)}catch(t){console.error("Error searching users:",t)}}displayUserSearchResults(e){const t=document.getElementById("save-pattern-user-results");if(t){if(e.length===0){t.innerHTML='<div class="user-search-no-results">No users found</div>';return}t.innerHTML=e.filter(i=>!this.selectedUsers.find(s=>s.id===i.id)).map(i=>`
        <div class="user-search-result-item" data-user-id="${i.id}">
          <img src="${i.avatarUrl||""}" alt="${i.name}" class="user-search-avatar" onerror="this.style.display='none'">
          <div class="user-search-result-info">
            <div class="user-search-result-name">${i.name}</div>
            <div class="user-search-result-email">${i.email}</div>
          </div>
          <button type="button" class="user-search-add-btn">Add</button>
        </div>
      `).join(""),t.querySelectorAll(".user-search-result-item").forEach(i=>{const s=i.querySelector(".user-search-add-btn"),r=i.dataset.userId,a=e.find(o=>o.id===r);s&&a&&s.addEventListener("click",()=>{this.addUserToShare(a),i.remove()})})}}clearUserSearchResults(){const e=document.getElementById("save-pattern-user-results");e&&(e.innerHTML="")}addUserToShare(e){this.selectedUsers.find(i=>i.id===e.id)||(this.selectedUsers.push(e),this.updateSelectedUsers());const t=document.getElementById("save-pattern-user-search");t&&(t.value=""),this.clearUserSearchResults()}removeUserFromShare(e){this.selectedUsers=this.selectedUsers.filter(t=>t.id!==e),this.updateSelectedUsers()}updateSelectedUsers(){const e=document.getElementById("save-pattern-selected-users");if(e){if(this.selectedUsers.length===0){e.innerHTML="";return}e.innerHTML=this.selectedUsers.map(t=>`
      <div class="selected-user-item">
        <img src="${t.avatarUrl||""}" alt="${t.name}" class="selected-user-avatar" onerror="this.style.display='none'">
        <span class="selected-user-name">${t.name}</span>
        <button type="button" class="selected-user-remove" data-user-id="${t.id}">&times;</button>
      </div>
    `).join(""),e.querySelectorAll(".selected-user-remove").forEach(t=>{t.addEventListener("click",()=>{this.removeUserFromShare(t.dataset.userId)})})}}async show(e,t,i=null){var a,o,l,c;if(!this.modal)return;this.currentPattern=e,this.patternType=t,this.elementId=i,this.selectedUsers=[];const s=document.getElementById("save-pattern-genre-group");s&&(s.style.display=t==="master"?"block":"none"),(a=document.getElementById("save-pattern-title"))!=null&&a.value&&(document.getElementById("save-pattern-title").value=""),(o=document.getElementById("save-pattern-artist"))!=null&&o.value&&(document.getElementById("save-pattern-artist").value=""),(l=document.getElementById("save-pattern-version-name"))!=null&&l.value&&(document.getElementById("save-pattern-version-name").value="");const r=document.getElementById("save-pattern-genre");r&&(r.value=""),(c=document.getElementById("save-pattern-public"))!=null&&c.checked&&(document.getElementById("save-pattern-public").checked=!1),this.updateSelectedUsers(),this.clearUserSearchResults(),this.modal.style.display="flex",document.body.style.overflow="hidden"}hide(){this.modal&&(this.modal.style.display="none",document.body.style.overflow="")}async savePattern(){var e,t,i,s,r;if(!this.currentPattern){alert("No pattern to save");return}try{if(!await ou()){alert("Please log in to save patterns");return}const o=((e=document.getElementById("save-pattern-title"))==null?void 0:e.value.trim())||null,l=((t=document.getElementById("save-pattern-artist"))==null?void 0:t.value.trim())||null,c=((i=document.getElementById("save-pattern-version-name"))==null?void 0:i.value.trim())||null,u=((s=document.getElementById("save-pattern-genre"))==null?void 0:s.value.trim())||null,h=((r=document.getElementById("save-pattern-public"))==null?void 0:r.checked)||!1;let d=this.currentPattern;const f=d.split(`
`);let m=0,g=f.length;for(let P=0;P<f.length;P++)if(f[P].trim()===""&&P>0&&f[P-1].trim().startsWith("//")){m=P+1;break}for(let P=f.length-1;P>=0;P--)if(f[P].includes("Made with Strudesk 4000")){g=P;break}d=f.slice(m,g).join(`
`).trim();const y={type:this.patternType,elementId:this.elementId,patternCode:d,title:o,artistName:l,versionName:c,genre:this.patternType==="master"?u:null,isPublic:h,metadata:{}},b=await Wh.createPattern(y);!h&&this.selectedUsers.length>0&&await Wh.sharePattern(b.id,this.selectedUsers.map(P=>P.id)),this.onSave&&this.onSave(b),this.hide(),alert("Pattern saved successfully!")}catch(a){console.error("Error saving pattern:",a),alert("Failed to save pattern: "+(a.message||"Unknown error"))}}setOnSave(e){this.onSave=e}}const rb={bd:"Bass drum, Kick drum",sd:"Snare drum",rim:"Rimshot",cp:"Clap",hh:"Closed hi-hat",oh:"Open hi-hat",cr:"Crash",rd:"Ride",ht:"High tom",mt:"Medium tom",lt:"Low tom",sh:"Shakers",cb:"Cowbell",tb:"Tambourine",perc:"Other percussions",misc:"Miscellaneous samples",fx:"Effects"},Dr=new Set(["RolandTR808","RolandTR909","RolandTR707","RhythmAce","AkaiLinn","ViscoSpaceDrum","CasioRZ1"]),X$="https://raw.githubusercontent.com/felixroos/dough-samples/main/vcsl.json",Ml="vcsl:";let or=null,$r=null;const eg="World Instruments",tg="VCSL Instruments",ng=["Chordophones","Aerophones","Membranophones","Electrophones","Idiophones"],Xh=[{value:"mridangam",label:"Mridangam Percussion Set"}],H$=new Set(Xh.map(n=>n.value.toLowerCase())),Oc=n=>{if(!n||typeof n!="string")return{rawValue:"",bankValue:"",isVcslInstrument:!1,vcslInstrument:""};if(n.startsWith(Ml)){const e=n.slice(Ml.length);return{rawValue:n,bankValue:"vcsl",isVcslInstrument:!0,vcslInstrument:e}}return{rawValue:n,bankValue:n,isVcslInstrument:!1,vcslInstrument:""}},ab=n=>n?n.replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase()):"",Y$=n=>{if(!n)return"";if(typeof n=="string")return n;if(Array.isArray(n))return typeof n[0]=="string"?n[0]:"";if(typeof n=="object"){const e=Object.values(n)[0];if(typeof e=="string")return e;if(Array.isArray(e)&&typeof e[0]=="string")return e[0]}return""},K$=(n,e)=>{const t=(n||e||"").toLowerCase();return/(membranophone|idiophone|drum|percussion|bongo|cajon|shaker|triangle|tambourine|clave|cowbell|snare|kick|timpani|gong|cymbal)/i.test(t)?"drums":"world"},J$=(n,e)=>{if(!n||!e)return n;try{return new URL(n,e).toString()}catch{return n}},Hh=(n,e)=>{if(typeof n=="string")return J$(n,e);if(Array.isArray(n))return n.map(t=>Hh(t,e));if(n&&typeof n=="object"){const t={};return Object.entries(n).forEach(([i,s])=>{t[i]=Hh(s,e)}),t}return n},e5=n=>{if(!n||typeof n!="object")return n;const e=n._base||"",t={};return Object.entries(n).forEach(([i,s])=>{i!=="_base"&&(t[i]=Hh(s,e))}),t},t5=n=>{if(!n||typeof n!="string")return"Other";const e=n.match(/^([^/]+)/);if(!e)return"Other";try{const t=decodeURIComponent(e[1]);return t.charAt(0).toUpperCase()+t.slice(1)}catch{return e[1]}},n5=n=>{const e=ng.indexOf(n);return e===-1?ng.length+1:e},i5=async()=>or||$r||($r=fetch(X$).then(async n=>{if(!n.ok)throw new Error(`Failed to load VCSL instruments: ${n.status}`);const e=await n.json();e5(e);const i=Object.entries(e||{}).filter(([s])=>s&&s!=="_base").map(([s,r])=>{const a=Y$(r),o=t5(a),l=K$(a,o);return{value:s,optionValue:`${Ml}${s}`,label:`VCSL · ${ab(s)}`,category:l,samplePath:a,family:o,familyOrder:n5(o)}}).sort((s,r)=>s.familyOrder!==r.familyOrder?s.familyOrder-r.familyOrder:s.label.localeCompare(r.label));return or=i,i}).catch(n=>(console.warn("⚠️ Unable to load VCSL instrument list:",n),or=[],[])).finally(()=>{$r=null}),$r),Na={RolandTR808:"Roland TR-808",RolandTR909:"Roland TR-909",RolandTR707:"Roland TR-707",RhythmAce:"Rhythm Ace",AkaiLinn:"Akai Linn",ViscoSpaceDrum:"Visco Space Drum",CasioRZ1:"Casio RZ-1"},ig=/\b(note|n)\s*\(/i,sg=/\bn\(\s*["'][^"']*["']\s*\)/i,Un=n=>!n||typeof n!="string"?!1:(ig.lastIndex=0,ig.test(n)),Mi=n=>!n||typeof n!="string"?!1:(sg.lastIndex=0,sg.test(n)),ir=n=>{if(!n)return"Channel";const e=n.match(/element-(\d+)/i);return e&&e[1]?`Channel ${e[1]}`:n},s5=(n,e)=>{const t=ir(n),i=e?e.trim():"";if(!i||/^element\s*\d+$/i.test(i))return t;if(/^channel\s*\d+$/i.test(i))return i;const s=i.replace(/^channel\s*\d+\s*(–|-)\s*/i,"");return`${t} – ${s}`},mi=(n,e)=>{const t=document.querySelector(`[data-sound-id="${n}"]`);if(!t)return;const i=t.querySelector(".element-title");i&&(i.textContent=s5(n,e));const s=t.querySelector(".config-button");s&&(s.textContent=e&&e.trim()?e.trim():"Configure Sound")},Bo=n=>n?Object.prototype.hasOwnProperty.call(Na,n)?Na[n]:n.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Za-z])(\d+)/g,"$1 $2").trim():"",rg={RolandTR808:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"cp",label:"CP",sample:"cp"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"},{key:"cb",label:"CB",sample:"cb"},{key:"sh",label:"SH",sample:"sh"}],RolandTR909:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"cp",label:"CP",sample:"cp"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],RolandTR707:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],RhythmAce:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],AkaiLinn:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],ViscoSpaceDrum:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],CasioRZ1:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}]},r5=[{id:"roland808-simple-bd-hh",label:"Roland 808 – Kick & Hat",bank:"RolandTR808",description:"Simple BD/HH groove shown in the step editor",pattern:'s("bd ~ hh ~ bd ~ hh ~ bd ~ hh ~ bd ~ hh ~").bank("RolandTR808")',editorBadge:"Step editor"},{id:"drum-beat-generator",label:"Beat Generator",bank:"",description:"Opens in code editor for generative BD patterns",pattern:'s("bd").bank("RolandTR808").segment(16).degradeBy(.5).ribbon(16,1)',editorBadge:"Code"},{id:"random-modifiers",label:"Random Modifiers",bank:"",description:"chooseCycles randomizes BD / HH / SD each cycle",pattern:'s(chooseCycles("bd","hh","sd")).bank("RolandTR808").fast(8)',editorBadge:"Code"},{id:"mridangam-pulse",label:"Mridangam Percussion Set",bank:"",description:"Classical tha · dhi · thom · nam motif on the mridangam bank",pattern:`"tha dhi thom nam".drop("0 -1 -2 -3").sound().bank("mridangam")

/* Available sounds: tha · dhi · dhin · thom · nam · na · ta · ka · ki · gumki · dhum · chaapu · ardha */`,editorBadge:"Code"}],ob=[{id:"independent-params",label:"Note Names and Filter Pattern",bank:"",description:"note, cutoff, gain and sound controlled independently",pattern:'note("F3 A3 C3 E3").cutoff("<500 1000 2000 [4000 8000]>").gain(.8).s("sawtooth").log()'},{id:"semitones-scale-transpose",label:"Semitones, Scale & Transpose",bank:"",description:"Transposes notes inside the scale by the number of steps",pattern:`"[-8 [2,4,6]]*2".scale('c:ionian').scaleTranspose("<0 -1 -2 -3 -4 -5 -6 -4>*2").note().s("piano")`,useNoteNames:!1},{id:"simple-arpeggios",label:"Simple Arpeggios in Semitones & Chords",bank:"",description:"Combines numeric semitones with chord progressions",pattern:'n("0 1 2 3").chord("<C Am F G>").voicing()',useNoteNames:!1},{id:"simple-backing-track",label:"Simple Backing Track",bank:"",description:"Together with layer, struct and voicings, this can be used to create a basic backing track",pattern:`"<C^7 A7b13 Dm7 G7>*2".layer(
  x => x.voicings("lefthand").struct("[~ x]*2").note(),
  x => x.rootNotes(2).note().s("sawtooth").cutoff(800)
)`},{id:"vcsl-vocal-bed",label:"VCSL World Textures",bank:"",description:"Layered Ball Whistle + Bongo textures from the VCSL set",pattern:'sound("<ballwhistle ~ bongo ~>*2").bank("vcsl").slow(2).room(.35).shape(.2)'},{id:"jazz-blues-in-f",label:"Jazz Blues in F",bank:"",description:"Classic jazz-blues progression with layered voicings and struct patterns",pattern:`(() => {
  const chords = chord(\`<

F7 Bb7 F7 [Cm7 F7]

Bb7 Bo F7 [Am7 D7]

Gm7 C7 [F7 D7] [Gm7 C7]

>\`);

  return stack(
    n("7 8 [10 9] 8").set(chords).voicing().dec(.2),
    chords.struct("- x - x").voicing().room(.5),
    n("0 - 1 -").set(chords).mode("root:g2").voicing()
  );
})()`},{id:"mini-notation-example",label:"Mini-notation Example",bank:"",description:"Layered mini-notation demo showing melody + bass progressions",pattern:`note(\`<

[e5 [b4 c5] d5 [c5 b4]]

[a4 [a4 c5] e5 [d5 c5]]

[b4 [~ c5] d5 e5]

[c5 a4 a4 ~]

[[~ d5] [~ f5] a5 [g5 f5]]

[e5 [~ c5] e5 [d5 c5]]

[b4 [b4 c5] d5 e5]

[c5 a4 a4 ~]

,

[[e2 e3]*4]

[[a2 a3]*4]

[[g#2 g#3]*2 [e2 e3]*2]

[a2 a3 a2 a3 a2 a3 b1 c2]

[[d2 d3]*4]

[[c2 c3]*4]

[[b1 b2]*2 [e2 e3]*2]

[[a1 a2]*4]

>\`)`}],a5=[{id:"sampler-begin",label:"begin",description:"Skip the first section of each triggered sample.",tooltip:"A 0–1 pattern that trims the start of each hit (0.25 removes the first quarter).",pattern:`samples({
  "rave": "rave/AREUREADY.wav"
}, "github:tidalcycles/dirt-samples")

s("rave")
  .begin("<0 0.25 0.5 0.75>")
  .fast(2)`},{id:"sampler-end",label:"end",description:"Cut the tail of the sample instead of the beginning.",tooltip:"Same as .begin but trims from the end (1 = full sample, 0.5 = half length).",pattern:`s("bd*2,oh*4").bank("RolandTR808")
  .end("<0.1 0.2 0.5 1>")
  .fast(2)`},{id:"sampler-loop",label:"loop",description:"Keep a sample looping regardless of the cycle length.",tooltip:"Enable sustained looping (1 = on) — tempo is free-running.",pattern:`s("casio")
  .loop(1)`},{id:"sampler-loopBegin",label:"loopBegin",description:"Set the point inside the sample where looping starts.",tooltip:"Choose the loop start within 0–1 of the file; must be before loopEnd.",pattern:`s("space").loop(1)
  .loopBegin("<0 0.125 0.25>")
  ._scope()`},{id:"sampler-loopEnd",label:"loopEnd",description:"Set the point inside the sample where looping ends.",tooltip:"Choose the loop end (0–1). Must be after loopBegin for a valid loop.",pattern:`s("space").loop(1)
  .loopEnd("<1 0.75 0.5 0.25>")
  ._scope()`},{id:"sampler-cut",label:"cut",description:"Use classic drum-machine style choke groups.",tooltip:"Samples in the same cut group (1 here) stop each other when they retrigger.",pattern:`s("[oh hh]*4").bank("RolandTR808")
  .cut(1)`},{id:"sampler-clip",label:"clip",description:"Shorten or lengthen the note duration without altering tempo.",tooltip:"Multiplies sustain by the factor; values <1 gate the sample early.",pattern:`note("c a f e")
  .s("piano")
  .clip("<0.5 1 2>")
  .legato(1)`},{id:"sampler-loopAt",label:"loopAt",description:"Time-stretch samples to a specific number of cycles.",tooltip:"Stretches/compresses playback so the loop fits exactly 2 cycles.",pattern:`samples({
  "rhodes": "https://cdn.freesound.org/previews/132/132051_316502-lq.mp3"
})

s("rhodes").loopAt(2)`},{id:"sampler-fit",label:"fit",description:"Resize a sample to the length of each event.",tooltip:"Fits every triggered slice to its event duration — great for breakbeats.",pattern:`samples({
  "rhodes": "https://cdn.freesound.org/previews/132/132051-lq.mp3"
})

s("rhodes/2")
  .fit()`},{id:"sampler-chop",label:"chop",description:"Split samples into equal slices for granular tricks.",tooltip:"Cuts each hit into 4 tiny grains, then reorders/repeats them in two cycles.",pattern:`samples({
  "rhodes": "https://cdn.freesound.org/previews/132/132051-lq.mp3"
})

s("rhodes")
  .chop(4)
  .rev()
  .loopAt(2)`},{id:"sampler-striate",label:"striate",description:"Sequentially scan through chunks of each sample.",tooltip:"Each trigger jumps forward through 6 slices of the source file.",pattern:`s("numbers:0 numbers:1 numbers:2")
  .striate(6)
  .slow(3)`},{id:"sampler-slice",label:"slice",description:"Address slices explicitly using indexes or fractional lists.",tooltip:"Divide the file into slices and trigger them via patterns or fractional lists.",pattern:`samples("github:tidalcycles/dirt-samples")

s("breaks165")
  .slice(8, "0 1 <2 2*2> 3 [4 0] 5 6 7")
  .slow(0.75)

s("breaks125")
  .fit()
  .slice([0, 0.25, 0.5, 0.75], "0 1 1 <2 3>")`},{id:"sampler-splice",label:"splice",description:"Slice like .slice but time-stretches to match step length.",tooltip:"Each slice is warped to fill its step, so rhythms stay tight.",pattern:`samples("github:tidalcycles/dirt-samples")

s("breaks165")
  .splice(8, "0 1 [2 3 0]@2 3 0@2 7")`},{id:"sampler-scrub",label:"scrub",description:"Manually scrub through audio (great for granular tape FX).",tooltip:"Supply 0–1 positions (optionally with :speed) to scrub through the waveform.",pattern:`samples("github:switchangel/pad")
s("swpad:0")
  .scrub("{0.1!2 0.25@3 0.7!2 <0.8:1.5>}%8")

samples("github:yaxu/clean-breaks/main")
s("amen/4")
  .fit()
  .scrub(pattern("{0@3 0@2 4@3}%8").div(16))`},{id:"sampler-speed",label:"speed",description:"Pitch-shift or reverse by changing playback speed.",tooltip:"Positive speeds raise the pitch; negatives play the sample backwards.",pattern:`s("bd*6")
  .speed("1 2 4 1 -2 -4")

speed("1 1.5*2 [2 1.1]")
  .s("piano")
  .clip(1)`}].map(n=>({...n,editorBadge:"Code"}));ob.forEach(n=>{n.editorBadge||(n.editorBadge="Code")});const yc=[{id:"song-acidic-tooth",label:'Song · "acidic tooth" @by eddyflux',pattern:`// "acidic tooth" @by eddyflux
// @version 1.0

setcps(1)

stack(

  /* Channel 1 */
  stack(
    s("bd*2").mask("<0@4 1@16>"),
    s("hh*8").gain(saw.mul(saw.fast(2))).clip(sine)
    .mask("<0@8 1@16>")
  ).bank('RolandTR909')

  ,

  /* Channel 2 */
  note("[<g1 f1>/8](<3 5>,8)")
  .clip(perlin.range(.15,1.5))
  .release(.1)
  .s("sawtooth")
  .lpf(sine.range(400,800).slow(16))
  .lpq(cosine.range(6,14).slow(3))
  .lpenv(sine.mul(4).slow(4))
  .lpd(.2).lpa(.02)
  .ftype('24db')
  .rarely(add(note(12)))
  .room(.2).shape(.3).postgain(.5)
  .superimpose(x=>x.add(note(12)).delay(.5).bpf(1000))
  .gain("[.2 1@3]*2") // fake sidechain

)`.trim()}],ag=new URL("./assets/samples/voice/Strudesk4000_de.mp3",document.baseURI).href;let ri=null;const og=25,lg=25,ug="strudel_channel_history:",bc="strudel_master_history",ga={get(n){try{return window.localStorage.getItem(n)}catch(e){return console.warn("Pattern history storage get failed:",e),null}},set(n,e){try{window.localStorage.setItem(n,e)}catch(t){console.warn("Pattern history storage set failed:",t)}}},Xn=(()=>{const n=new Map;let e=null;const t=u=>{if(!u)return[];try{const h=JSON.parse(u);return Array.isArray(h)?h:[]}catch{return[]}},i=(u,h)=>{ga.set(u,JSON.stringify(h))};return{saveChannelVersion:(u,h)=>{const d=(h||"").trim();if(!u||!d||n.get(u)===d)return;const f=`${ug}${u}`;let m=t(ga.get(f));if(m.length&&m[0].pattern===d){n.set(u,d);return}const g={id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,pattern:d,createdAt:Date.now()};m.unshift(g),m.length>og&&(m=m.slice(0,og)),i(f,m),n.set(u,d)},getChannelVersions:u=>u?t(ga.get(`${ug}${u}`)):[],markChannelSnapshot:(u,h)=>{u&&n.set(u,(h||"").trim())},saveMasterVersion:u=>{const h=(u||"").trim();if(!h||h===e){e=h;return}let d=t(ga.get(bc));if(d.length&&d[0].pattern===h){e=h;return}const f={id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,pattern:h,createdAt:Date.now()};d.unshift(f),d.length>lg&&(d=d.slice(0,lg)),i(bc,d),e=h},getMasterVersions:()=>t(ga.get(bc)),markMasterSnapshot:u=>{e=(u||"").trim()}}})();window.__patternHistory=Xn;const o5=()=>{const n=document.getElementById("pattern-history-modal");if(!n)return{openChannelHistory:()=>{},openMasterHistory:()=>{},close:()=>{}};const e=document.getElementById("pattern-history-title"),t=document.getElementById("pattern-history-list"),i=document.getElementById("pattern-history-tabs"),s=document.getElementById("pattern-history-close");let r=null,a=[],o="local";const l=b=>b.replace(/[&<>"']/g,P=>{switch(P){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return P}}),c=b=>{try{return new Date(b).toLocaleString()}catch{return""}},u=()=>{n.classList.remove("is-open"),n.setAttribute("aria-hidden","true"),r=null,a=[]},h=()=>{n.classList.add("is-open"),n.setAttribute("aria-hidden","false")},d=(b,P={})=>{const{includeMasterSongs:M=!1,isCloudPatterns:v=!1}=P,C=document.createDocumentFragment();if(Array.isArray(b)&&b.length>0)b.forEach((A,B)=>{const Z=document.createElement("div");Z.className="pattern-history-entry";let q=A.patternCode||A.pattern||"";const X=q.length>240?`${q.slice(0,240)}…`:q,j=(B+1).toString().padStart(2,"0");let H=c(A.createdAt);if(v){const se=[];A.title&&se.push(`"${A.title}"`),A.artistName&&se.push(`by ${A.artistName}`),A.version&&se.push(`v${A.version}${A.versionName?` (${A.versionName})`:""}`),A.userCount>0&&se.push(`${A.userCount} user${A.userCount>1?"s":""}`),se.length>0&&(H=se.join(" • "))}Z.innerHTML=`
          <div class="pattern-history-meta">
            <span class="pattern-history-index">#${j}</span>
            <p class="pattern-history-date">${l(H)}</p>
          </div>
          <pre class="pattern-history-snippet">${l(X)}</pre>
          <div class="pattern-history-actions">
            <button type="button" class="pattern-history-load" data-version-id="${A.id}" data-is-cloud="${v}">Load</button>
          </div>
        `,C.appendChild(Z)});else{const A=document.createElement("p");A.className="pattern-history-empty",A.textContent="No saved versions yet.",C.appendChild(A)}if(M&&yc.length&&o==="local"){const A=document.createElement("h4");A.className="pattern-history-section-title",A.textContent="Songs",C.appendChild(A),yc.forEach((B,Z)=>{const q=document.createElement("div");q.className="pattern-history-entry pattern-history-entry--song";const X=B.pattern.length>400?`${B.pattern.slice(0,400)}…`:B.pattern,j=(Z+1).toString().padStart(2,"0");q.innerHTML=`
          <div class="pattern-history-meta">
            <span class="pattern-history-index">#${j}</span>
            <p class="pattern-history-date">${l(B.label)}</p>
          </div>
          <pre class="pattern-history-snippet">${l(X)}</pre>
          <div class="pattern-history-actions">
            <button type="button" class="pattern-history-load" data-song-id="${B.id}">Load</button>
          </div>
        `,C.appendChild(q)})}t.innerHTML="",t.appendChild(C)};t.addEventListener("click",async b=>{const P=b.target.closest(".pattern-history-load");if(!P||!ri)return;const M=P.dataset.versionId,v=P.dataset.songId,C=P.dataset.isCloud==="true";if(v&&(r==null?void 0:r.type)==="master"){const B=yc.find(Z=>Z.id===v);if(!B)return;ri.applyMasterHistoryEntry(B.pattern),u();return}let E=a.find(B=>B.id===M);if(C&&E)try{const{patternsAPI:B}=await rn(async()=>{const{patternsAPI:q}=await Promise.resolve().then(()=>rs);return{patternsAPI:q}},void 0);E=await B.getPattern(M)}catch(B){console.error("Error loading cloud pattern:",B),alert("Failed to load pattern");return}if(!E)return;const A=E.patternCode||E.pattern;A&&((r==null?void 0:r.type)==="channel"?ri.applyChannelHistoryEntry(r.elementId,A):(r==null?void 0:r.type)==="master"&&ri.applyMasterHistoryEntry(A),u())}),s==null||s.addEventListener("click",u),n.addEventListener("click",b=>{b.target===n&&u()});const f=async(b,P=null)=>{try{const{patternsAPI:M,getCurrentUser:v}=await rn(async()=>{const{patternsAPI:B,getCurrentUser:Z}=await Promise.resolve().then(()=>rs);return{patternsAPI:B,getCurrentUser:Z}},void 0),C=await v();if(!C)return[];const E={type:b};let A=[];return o==="my-patterns"?(A=await M.getPatterns({type:b,isPublic:!1}),A=A.filter(B=>B.userId===C.id)):o==="public"?A=await M.getPatterns({type:b,isPublic:!0}):o==="shared"&&(A=await M.getPatterns({type:b,shared:!0})),A}catch(M){return console.error("Error loading cloud patterns:",M),[]}},m=async b=>{if(o=b,i&&i.querySelectorAll(".pattern-history-tab").forEach(P=>{P.classList.toggle("active",P.dataset.tab===b)}),t.innerHTML='<p class="pattern-history-empty">Loading…</p>',b==="local")(r==null?void 0:r.type)==="channel"?(a=Xn.getChannelVersions(r.elementId),d(a)):(r==null?void 0:r.type)==="master"&&(a=Xn.getMasterVersions(),d(a,{includeMasterSongs:!0}));else{const P=await f((r==null?void 0:r.type)||"master",r==null?void 0:r.elementId);a=P,d(P,{isCloudPatterns:!0})}},g=async b=>{if(!b)return;r={type:"channel",elementId:b},e.textContent=`${ir(b)} history`,h();const{getCurrentUser:P}=await rn(async()=>{const{getCurrentUser:v}=await Promise.resolve().then(()=>rs);return{getCurrentUser:v}},void 0),M=await P();i&&(i.style.display=M?"flex":"none"),t.innerHTML='<p class="pattern-history-empty">Loading…</p>',o="local",a=Xn.getChannelVersions(b),d(a)},y=async()=>{r={type:"master"},e.textContent="Master history",h();const{getCurrentUser:b}=await rn(async()=>{const{getCurrentUser:M}=await Promise.resolve().then(()=>rs);return{getCurrentUser:M}},void 0),P=await b();i&&(i.style.display=P?"flex":"none"),t.innerHTML='<p class="pattern-history-empty">Loading…</p>',o="local",a=Xn.getMasterVersions(),d(a,{includeMasterSongs:!0})};return i&&i.addEventListener("click",b=>{const P=b.target.closest(".pattern-history-tab");P&&m(P.dataset.tab)}),{openChannelHistory:g,openMasterHistory:y,close:u}};let Jo=null;const l5=n=>{var s,r;if(!Jo)return;const e=n.target.closest("[data-history-save]");if(e){n.preventDefault();const a=e.dataset.historySave;if(a==="channel"){const o=e.closest(".sound-element"),l=o==null?void 0:o.getAttribute("data-sound-id");l&&ri&&((s=ri.saveChannelWithEffects)==null||s.call(ri,l))}else a==="master"&&ri&&((r=ri.saveMasterHistoryEntry)==null||r.call(ri));return}const t=n.target.closest('[data-history-target="channel"]');if(t){n.preventDefault();const a=t.closest(".sound-element"),o=a==null?void 0:a.getAttribute("data-sound-id");o&&Jo.openChannelHistory(o);return}n.target.closest("#load-master-history-btn")&&(n.preventDefault(),Jo.openMasterHistory())},cg=()=>{Jo=o5(),document.addEventListener("click",l5)},vc=[{key:"bd",label:"BD",sample:"bd"},{key:"sn",label:"SN",sample:"sd"},{key:"hh",label:"HH",sample:"hh"}],Kd={superpiano:"piano",wood:"jazz"},xa=["sine","square","triangle","sawtooth","supersaw","pulse"],Tr=["piano","supersaw","gtr","casio","jazz","metal","folkharp"],lb=Object.keys(Kd),u5=new Set([...xa,...Tr,...lb]),c5=["note()","n()","sound()","s()","bank()","beat()","vowel()","chord()","voicing()","addVoicings()","gain()","adsr()","scale()","pan()","speed()","slow()","fast()","early()","late()","legato()","euclid()","euclidRot()","euclidLegato()","rev()","palindrome()","iter()","iterBack()","ply()","range()","rangex()","range2()","lpf()","lpa()","lpd()","lps()","lpq()","lpattack()","lpdecay()","lpsustain()","lprelease()","orbit()","postgain()","irand()","seg()","hpf()","hpq()","bpf()","bpg()","bpq()","fancor()","lpenv()","ftype()","attack()","decay()","sustain()","release()","tremolo()","resonance()","cutoff()","noise()","tremolosync()","tremoloskew()","tremolodepth()","tremolophase()","tremoloshape()","sometimes()","stack()","clip()","sub()","mul()","div()","floor()","ceil()","ratio()","as()","saw()","sine()","cosine()","tri()","square()","rand()","saw2()","sine2()","cosine2()","tri2()","square2()","rand2()","perlin()","brand()","brandBy()","mouseX()","mouseY()","choose()","wchoose()","chooseCycles()","wchooseCycles()","degradeBy()","degrade()","undegradeBy()","undegrade()","sometimesBy()","sometimes()","someCyclesBy()","someCycles()","often()","rarely()","almostNever()","almostAlways()","never()","always()","lastOf()","firstOf()","when()","chunk()","chunkBack()","fastChunk()","arp()","arpWith()","struct()","mask()","reset()","restart()","hush()","invert()","pick()","pickmod()","pickF()","pickmodF()","pickRestart()","pickmodRestart()","pickReset()","pickmodReset()","inhabit()","inhabitmod()","squeeze()","superimpose()","layer()","off()","echo()","echoWith()","transpose()","scaleTranspose()","rootNotes()","pace()","stepcat()","stepalt()","expand()","contract()","extend()","take()","drop()","polymeter()","shrink()","grow()","tour()","zip()","vib()","vibmod()","add()","anchor()","dict()","penv()","segment()","compress()","zoom()","linger()","fastGap()","inside()","outside()","cpm()","ribbon()","swingBy()","swing()","patt()","dec()","mode()","set()","struct()","pick()","pattack()","pdecay()","prelease()","pcurve()","panchor()","velocity()","fm()","fmh()","fmattack()","fmdecay()","fmsustain()","fmenv()","zrand()","curve()","slide()","deltaSlide()","zmod()","zcrush()","zdelay()","pitchJump()","pitchJumpTime()","lfo()","compressor()","control()","ccn()","ccv()","midimap()","midimaps()","defaultmidimap()","midi()","midiport()","midicmd()","midibend()","miditouch()","progNum()","sysex()","sysexid()","sysexdata()","osc()","mqtt()","xfade()","jux()","juxBy()","coarse()","crush()","distort()","delay()","delaytime()","delayfeedback()","room()","roomsize()","roomfade()","roomlp()","roomdim()","iresponse()","phaser()","phaserdepth()","phasercenter()","phasersweep()","duckorbit()","duckattack()","duckdepth()"],el=["stack()","vowel()","beat()","bank()","sound()","chord()","note()"],h5=['sound("sawtooth")','sound("square")','sound("triangle")','sound("sine")','sound("white")','sound("pink")','sound("brown")'],d5=["beat","chord","note","sound","stack"],f5=new Map([['sound("brown")',"pattern-snippet-tag-sound-brown"],['sound("pink")',"pattern-snippet-tag-sound-pink"],['sound("white")',"pattern-snippet-tag-sound-white"]]),p5=new Set(["core"]),m5=new Set(["filters-lp","filters-hp","filters-bp"]),g5=new Set(["filters-lp","filters-hp","filters-bp"]),Oa=new Map;function Sc(n){return n<=20?0:n>=2e4?1:n<=100?(n-20)/80*.25:n<=500?.25+(n-100)/400*.25:n<=5e3?.5+(n-500)/4500*.3:.8+(n-5e3)/15e3*.2}function wc(n){return n<=0?20:n>=1?2e4:n<=.25?20+n/.25*80:n<=.5?100+(n-.25)/.25*400:n<=.8?500+(n-.5)/.3*4500:5e3+(n-.8)/.2*15e3}const Yi={lpf:{min:20,max:2e4,step:10,default:2e4,unit:"Hz"},hpf:{min:20,max:2e4,step:10,default:20,unit:"Hz"},bpf:{min:20,max:2e4,step:10,default:1e3,unit:"Hz"},lpq:{min:0,max:20,step:.1,default:0,unit:""},hpq:{min:0,max:20,step:.1,default:0,unit:""},bpq:{min:0,max:20,step:.1,default:0,unit:""},bpg:{min:-20,max:20,step:.1,default:0,unit:"dB"},attack:{min:0,max:2,step:.01,default:.01,unit:"s"},decay:{min:0,max:2,step:.01,default:.1,unit:"s"},sustain:{min:0,max:1,step:.01,default:.5,unit:""},release:{min:0,max:5,step:.01,default:.1,unit:"s"},lpattack:{min:0,max:2,step:.01,default:.01,unit:"s"},lpdecay:{min:0,max:2,step:.01,default:.1,unit:"s"},lpsustain:{min:0,max:1,step:.01,default:.5,unit:""},lprelease:{min:0,max:5,step:.01,default:.1,unit:"s"},hpattack:{min:0,max:2,step:.01,default:.01,unit:"s"},hpdecay:{min:0,max:2,step:.01,default:.1,unit:"s"},hpsustain:{min:0,max:1,step:.01,default:.5,unit:""},hprelease:{min:0,max:5,step:.01,default:.1,unit:"s"},bpattack:{min:0,max:2,step:.01,default:.01,unit:"s"},bpdecay:{min:0,max:2,step:.01,default:.1,unit:"s"},bpsustain:{min:0,max:1,step:.01,default:.5,unit:""},bprelease:{min:0,max:5,step:.01,default:.1,unit:"s"},bpenv:{min:0,max:1,step:.01,default:.5,unit:""},hpenv:{min:0,max:1,step:.01,default:.5,unit:""},pattack:{min:0,max:2,step:.01,default:.01,unit:"s"},pdecay:{min:0,max:2,step:.01,default:.1,unit:"s"},prelease:{min:0,max:5,step:.01,default:.1,unit:"s"},gain:{min:0,max:2,step:.01,default:.8,unit:""},postgain:{min:0,max:2,step:.01,default:1,unit:""},velocity:{min:0,max:1,step:.01,default:.5,unit:""},pan:{min:-1,max:1,step:.01,default:0,unit:""},slow:{min:.1,max:10,step:.1,default:2,unit:"x"},fast:{min:.1,max:10,step:.1,default:2,unit:"x"},early:{min:0,max:1,step:.01,default:.25,unit:""},late:{min:0,max:1,step:.01,default:.25,unit:""},delay:{min:0,max:1,step:.01,default:0,unit:""},delaytime:{min:0,max:1,step:.01,default:.25,unit:"s"},delayfeedback:{min:0,max:1,step:.01,default:.5,unit:""},room:{min:0,max:5,step:.01,default:0,unit:""},roomsize:{min:0,max:4,step:.01,default:.5,unit:""},roomfade:{min:0,max:1,step:.01,default:.5,unit:""},roomlp:{min:20,max:2e4,step:10,default:20,unit:"Hz"},roomdim:{min:0,max:1,step:.01,default:0,unit:""},iresponse:{min:0,max:1,step:.01,default:0,unit:""},phaser:{min:0,max:1,step:.01,default:0,unit:""},phaserdepth:{min:0,max:1,step:.01,default:.5,unit:""},phasercenter:{min:0,max:1,step:.01,default:.5,unit:""},phasersweep:{min:0,max:1,step:.01,default:.5,unit:""},duckattack:{min:0,max:2,step:.01,default:.01,unit:"s"},duckdepth:{min:0,max:1,step:.01,default:.5,unit:""},tremolo:{min:0,max:1,step:.01,default:0,unit:""},tremolodepth:{min:0,max:1,step:.01,default:.5,unit:""},tremoloskew:{min:0,max:1,step:.01,default:.5,unit:""},tremolophase:{min:0,max:1,step:.01,default:0,unit:""},resonance:{min:0,max:20,step:.1,default:0,unit:""},cutoff:{min:20,max:2e4,step:10,default:2e4,unit:"Hz"},speed:{min:.1,max:10,step:.1,default:1,unit:"x"},legato:{min:0,max:1,step:.01,default:0,unit:""},cpm:{min:60,max:300,step:1,default:120,unit:"BPM"}},Ba=[{id:"core",order:0,label:"Core",heading:"Core",matcher:n=>["stack","beat","bank","sound","s","note","n"].includes(n),className:"snippet-group-core"},{id:"amplitude-modulation",order:1,label:"Amplitude Modulation",heading:"Amplitude Modulation",matcher:n=>["tremolo","tremolosync","tremolodepth","tremoloskew","tremolophase","tremoloshape"].includes(n),className:"snippet-group-amplitude-modulation"},{id:"amplitude-envelope",order:2,label:"Amplitude Envelope",heading:"Amplitude Envelope",matcher:n=>["attack","decay","sustain","release","adsr"].includes(n),className:"snippet-group-amplitude-envelope"},{id:"filter-envelope",order:3,label:"Filter Envelope",heading:"Filter Envelope",matcher:n=>["lpattack","lpdecay","lpsustain","lprelease","lpenv"].includes(n),className:"snippet-group-filter-envelope"},{id:"pitch-envelope",order:4,label:"Pitch Envelope",heading:"Pitch Envelope",matcher:n=>["pattack","pdecay","prelease","penv","pcurve","panchor"].includes(n),className:"snippet-group-pitch-envelope"},{id:"dynamics",order:5,label:"Dynamics",heading:"Dynamics",matcher:n=>["gain","velocity","compressor","postgain","xfade"].includes(n),className:"snippet-group-dynamics"},{id:"panning",order:6,label:"Panning",heading:"Panning",matcher:n=>["jux","juxby","pan"].includes(n),className:"snippet-group-panning"},{id:"waveshaping",order:7,label:"Waveshaping",heading:"Waveshaping",matcher:n=>["coarse","crush","distort"].includes(n),className:"snippet-group-waveshaping"},{id:"global-effects",order:8,label:"Global Effects",heading:"Global Effects",matcher:n=>["orbit"].includes(n),className:"snippet-group-global-effects"},{id:"delay",order:9,label:"Delay",heading:"Delay",matcher:n=>["delay","delaytime","delayfeedback"].includes(n),className:"snippet-group-delay"},{id:"reverb",order:10,label:"Reverb",heading:"Reverb",matcher:n=>["room","roomsize","roomfade","roomlp","roomdim","iresponse"].includes(n),className:"snippet-group-reverb"},{id:"phaser",order:11,label:"Phaser",heading:"Phaser",matcher:n=>["phaser","phaserdepth","phasercenter","phasersweep"].includes(n),className:"snippet-group-phaser"},{id:"duck",order:12,label:"Duck",heading:"Duck",matcher:n=>["duckorbit","duckattack","duckdepth"].includes(n),className:"snippet-group-duck"},{id:"filters-hp",order:5,label:"Filters · High-pass",heading:"Filters · High-pass",matcher:n=>n.startsWith("hp"),className:"snippet-group-filters-hp"},{id:"filters-bp",order:6,label:"Filters · Band-pass",heading:"Filters · Band-pass",matcher:n=>n.startsWith("bp"),className:"snippet-group-filters-bp"},{id:"filters-lp",order:7,label:"Filters · Low-pass",heading:"Filters · Low-pass",matcher:n=>n.startsWith("lp")||n==="ftype"||n==="vowel"||n==="applygraduallowpass",className:"snippet-group-filters-lp"},{id:"time",order:8,label:"Time Modifiers",heading:"Time Modifiers",matcher:n=>["slow","fast","early","late","clip","legato","euclid","euclidrot","euclidlegato","rev","palindrome","iter","iterback","ply","segment","compress","zoom","linger","fastgap","inside","outside","cpm","ribbon","swingby","swing"].includes(n),className:"snippet-group-time"},{id:"control-operators",order:9,label:"Control · Operators",heading:"Control Parameters · Operators",matcher:n=>["add","sub","mul","div","floor","ceil","range","rangex","range2","ratio","as"].includes(n),className:"snippet-group-controls"},{id:"signals",order:10,label:"Signals",heading:"Signals",matcher:n=>["saw","sine","cosine","tri","square","rand","saw2","sine2","cosine2","tri2","square2","rand2","perlin","irand","brand","brandby"].includes(n),className:"snippet-group-signals"},{id:"visual-feedback",order:11,label:"Visual Feedback",heading:"Visual Feedback",matcher:(n,e)=>{if(n==="color"||n==="markcss"||["fscope","generategraph","pianoroll","pitchwheel","scope","spiral","wordfall"].includes(n))return!0;if(!e||typeof e!="string")return!1;const t=e.toLowerCase();return t.includes("_punchcard")||t.includes("_pianoroll")||t.includes("_scope")||t.includes("_spiral")||t.includes("_pitchwheel")||t.includes("_spectrum")},className:"snippet-group-visual-feedback"},{id:"synths",order:12,label:"Synths",heading:"Synths",matcher:(n,e)=>n==="sound"?typeof e=="string"&&e.includes('sound("'):["decay","sustain","attack","release","cutoff","noise","vib","vibmod","fm","fmh","fmattack","fmdecay","fmsustain","fmenv","fmwave","zrand","curve","slide","deltaslide","zmod","zcrush","zdelay","pitchjump","pitchjumptime","lfo","tremolo","octave","pw","pwrate","pwsweep","spread","unison","isaw","isaw2","itri","itri2"].includes(n),className:"snippet-group-synths"},{id:"tonal",order:13,label:"Tonal Functions",heading:"Tonal Functions",matcher:n=>["voicing","voicings","addvoicings","scale","transpose","scaletranspose","rootnotes","chord","dict","anchor","mode","below","duck","above","offset","n","note"].includes(n),className:"snippet-group-tonal"},{id:"stepwise",order:14,label:"Stepwise Patterning",heading:"Stepwise Patterning",matcher:n=>["pace","stepcat","stepalt","expand","contract","extend","take","drop","polymeter","shrink","grow","tour","zip"].includes(n),className:"snippet-group-stepwise"},{id:"random",order:15,label:"Random Modifiers",heading:"Random Modifiers",matcher:n=>["choose","wchoose","choosecycles","wchoosecycles","degradeby","degrade","undegradeby","undegrade","sometimesby","sometimes","somecyclesby","somecycles","often","rarely","almostnever","almostalways","never","always"].includes(n),className:"snippet-group-random"},{id:"conditional",order:16,label:"Conditional Modifiers",heading:"Conditional Modifiers",matcher:n=>["lastof","firstof","when","chunk","chunkback","fastchunk","arp","arpwith","struct","mask","reset","restart","hush","invert","pick","pickmod","pickf","pickmodf","pickrestart","pickmodrestart","pickreset","pickmodreset","inhabit","inhabitmod","squeeze"].includes(n),className:"snippet-group-conditional"},{id:"accumulation",order:17,label:"Accumulation Modifiers",heading:"Accumulation Modifiers",matcher:n=>["superimpose","layer","off","echo","echowith"].includes(n),className:"snippet-group-accumulation"},{id:"midi",order:18,label:"MIDI",heading:"MIDI",matcher:n=>n.includes("midi")||n.startsWith("ccn")||n.startsWith("ccv")||n==="prognum"||n==="sysex"||n==="sysexid"||n==="sysexdata"||n==="control",className:"snippet-group-midi",exclude:["pianoroll"]},{id:"device",order:19,label:"Device Motion",heading:"Device Motion",matcher:n=>["orientation","acceleration","accelerate","accelerationx","accelerationy","accelerationz","rotationx","rotationy","rotationz","gravityx","gravityy","gravityz","mousex","mousey"].some(t=>n.includes(t)),className:"snippet-group-device"},{id:"external-communication",order:20,label:"External Communication",heading:"External Communication",matcher:n=>["osc","mqtt"].includes(n),className:"snippet-group-external-communication"},{id:"other",order:Number.MAX_SAFE_INTEGER,label:"Other",heading:"Other",matcher:()=>!0,className:"snippet-group-other"}],Fo=Ba.reduce((n,e)=>(n.set(e.id,e),n),new Map),O5={sound:["bank","note","chord","delay","room","phaser","gain","lpf","pan"],s:["bank","note","chord","delay","room","phaser","gain","lpf","pan"],note:["chord","scale","voicing","transpose","scaletranspose","rootnotes","attack","decay","release","lpf","gain","pan"],stack:["beat","sound","note","gain","pan"],beat:["sound","s","euclid","mask","slow","fast","rev","iter"],bank:["sound","s","gain","pan","slow","fast","euclid","mask","delay","room","crush","distort"],lpf:["lpenv","lpattack","lpdecay","lpsustain","lprelease","lpq","ftype","hpf","bpf","gain"],hpf:["hpattack","hpdecay","hpsustain","hprelease","hpq","lpf","bpf","gain"],bpf:["bpattack","bpdecay","bpsustain","bprelease","bpq","bpg","lpf","hpf","gain"],lpenv:["lpf","lpattack","lpdecay","lpsustain","lprelease","lpq"],lpattack:["lpf","lpenv","lpdecay","lpsustain","lprelease"],lpdecay:["lpf","lpenv","lpattack","lpsustain","lprelease"],lpsustain:["lpf","lpenv","lpattack","lpdecay","lprelease"],lprelease:["lpf","lpenv","lpattack","lpdecay","lpsustain"],lpq:["lpf","lpenv"],hpq:["hpf"],bpq:["bpf","bpg"],bpg:["bpf","bpq"],ftype:["lpf"],vowel:["lpf","ftype"],attack:["decay","sustain","release","adsr","gain","lpf"],decay:["attack","sustain","release","adsr","gain"],sustain:["attack","decay","release","adsr","gain"],release:["attack","decay","sustain","adsr","gain"],adsr:["attack","decay","sustain","release","gain"],pattack:["pdecay","prelease","penv","pcurve","panchor"],pdecay:["pattack","prelease","penv","pcurve"],prelease:["pattack","pdecay","penv","pcurve"],penv:["pattack","pdecay","prelease","pcurve","panchor"],pcurve:["penv","pattack","pdecay","prelease"],panchor:["penv","pattack"],delay:["delaytime","delayfeedback"],delaytime:["delay","delayfeedback"],delayfeedback:["delay","delaytime"],room:["roomsize","roomfade","roomlp","roomdim","iresponse"],roomsize:["room","roomfade","roomlp","roomdim"],roomfade:["room","roomsize","roomlp"],roomlp:["room","roomsize","roomfade"],roomdim:["room","roomsize"],iresponse:["room","roomsize"],phaser:["phaserdepth","phasercenter","phasersweep"],phaserdepth:["phaser","phasercenter","phasersweep"],phasercenter:["phaser","phaserdepth","phasersweep"],phasersweep:["phaser","phaserdepth","phasercenter"],duckorbit:["duckattack","duckdepth"],duckattack:["duckorbit","duckdepth"],duckdepth:["duckorbit","duckattack"],gain:["velocity","compressor","postgain","pan","delay","room"],velocity:["gain","attack","decay"],compressor:["gain","postgain"],postgain:["gain","compressor"],xfade:["gain"],pan:["jux","juxby","gain"],jux:["juxby","pan"],juxby:["jux","pan"],crush:["distort","coarse","gain"],distort:["crush","coarse","gain"],coarse:["crush","distort"],slow:["fast","early","late","clip","legato","swing"],fast:["slow","early","late","clip","legato"],early:["late","slow","fast","clip"],late:["early","slow","fast","clip"],clip:["slow","fast","legato","early","late"],legato:["clip","early","late","slow","fast"],euclid:["euclidrot","euclidlegato","mask","beat","slow","fast"],euclidrot:["euclid","euclidlegato","mask"],euclidlegato:["euclid","euclidrot","mask"],rev:["palindrome","iter","iterback"],palindrome:["rev","iter","iterback"],iter:["iterback","rev","palindrome"],iterback:["iter","rev","palindrome"],ply:["segment","compress","zoom"],segment:["ply","compress","zoom","ribbon"],compress:["ply","segment"],zoom:["linger","fastgap","ply","segment"],linger:["zoom","fastgap"],fastgap:["zoom","linger"],inside:["outside","clip"],outside:["inside","clip"],swing:["swingby","cpm","slow","fast"],swingby:["swing","cpm"],cpm:["swing","swingby"],ribbon:["segment","ply"],add:["sub","mul","div","range","rangex"],sub:["add","mul","div","range"],mul:["add","sub","div","range"],div:["add","sub","mul","range"],range:["rangex","range2","add","sub","mul"],rangex:["range","range2"],range2:["range","rangex"],floor:["ceil","ratio"],ceil:["floor","ratio"],ratio:["floor","ceil"],as:["range"],saw:["sine","tri","square","rand","range"],sine:["saw","cosine","tri","square","range"],cosine:["sine","saw","tri","square"],tri:["saw","sine","square","rand"],square:["saw","sine","tri","rand"],rand:["saw","sine","tri","square","irand","brand"],saw2:["sine2","tri2","square2","rand2"],sine2:["saw2","cosine2","tri2","square2"],cosine2:["sine2","saw2","tri2","square2"],tri2:["saw2","sine2","square2","rand2"],square2:["saw2","sine2","tri2","rand2"],rand2:["saw2","sine2","tri2","square2"],perlin:["rand","brand","range"],irand:["rand","brand"],brand:["rand","irand","brandby"],brandby:["brand"],chord:["voicing","addvoicings","scale","transpose","scaletranspose","rootnotes","dict","mode","note"],voicing:["chord","addvoicings","scale","transpose","note"],addvoicings:["voicing","chord"],scale:["chord","voicing","transpose","scaletranspose","rootnotes","dict","mode","note"],transpose:["scale","scaletranspose","chord","note","offset"],scaletranspose:["scale","transpose","chord"],rootnotes:["scale","chord","transpose"],dict:["chord","scale","note"],anchor:["penv","pcurve","panchor","scale"],mode:["scale","chord","note"],below:["above","note","chord"],above:["below","note","chord"],offset:["transpose","scale","note"],n:["note","chord","scale","voicing","transpose"],cutoff:["lpf","resonance","lpenv"],resonance:["cutoff","lpf","lpq"],noise:["sound","cutoff","lpf"],vib:["vibmod","tremolo"],vibmod:["vib"],fm:["fmh","fmattack","fmdecay","fmsustain","fmenv","fmwave"],fmh:["fm","fmattack","fmdecay"],fmattack:["fm","fmdecay","fmsustain","fmenv"],fmdecay:["fm","fmattack","fmsustain","fmenv"],fmsustain:["fm","fmattack","fmdecay","fmenv"],fmenv:["fm","fmattack","fmdecay","fmsustain"],fmwave:["fm"],zrand:["rand","brand"],curve:["slide","deltaslide"],slide:["curve","deltaslide"],deltaslide:["slide","curve"],zmod:["vib","vibmod"],zcrush:["crush","distort"],zdelay:["delay","delaytime"],pitchjump:["pitchjumptime","penv"],pitchjumptime:["pitchjump"],lfo:["tremolo","vib"],octave:["transpose","note"],pw:["pwrate","pwsweep"],pwrate:["pw","pwsweep"],pwsweep:["pw","pwrate"],spread:["unison","pan"],unison:["spread"],isaw:["isaw2","itri","itri2"],isaw2:["isaw","itri","itri2"],itri:["isaw","isaw2","itri2"],itri2:["isaw","isaw2","itri"],tremolo:["tremolosync","tremolodepth","tremoloskew","tremolophase","tremoloshape","lfo"],tremolosync:["tremolo","tremolodepth"],tremolodepth:["tremolo","tremolosync"],tremoloskew:["tremolo","tremolophase"],tremolophase:["tremolo","tremoloshape"],tremoloshape:["tremolo","tremolophase"],choose:["wchoose","sometimes","rarely"],wchoose:["choose","sometimes"],choosecycles:["wchoosecycles","somecycles"],wchoosecycles:["choosecycles","somecycles"],degradeby:["degrade","sometimes"],degrade:["degradeby","sometimes"],undegradeby:["undegrade"],undegrade:["undegradeby"],sometimesby:["sometimes","rarely","often"],sometimes:["sometimesby","rarely","often","choose"],somecyclesby:["somecycles","choosecycles"],somecycles:["somecyclesby","choosecycles"],often:["sometimes","rarely","almostalways"],rarely:["sometimes","often","almostnever"],almostnever:["rarely","never"],almostalways:["often","always"],never:["almostnever"],always:["almostalways"],lastof:["firstof","when","mask"],firstof:["lastof","when","mask"],when:["lastof","firstof","mask","struct"],chunk:["chunkback","fastchunk","mask","struct"],chunkback:["chunk","fastchunk","mask"],fastchunk:["chunk","chunkback","mask"],arp:["arpwith","chord","voicing","note"],arpwith:["arp","chord"],struct:["mask","pick","when","beat"],mask:["struct","when","euclid","beat","chunk"],reset:["restart","pickreset"],restart:["reset","pickrestart"],hush:["silence"],invert:["rev","palindrome"],pick:["pickmod","pickf","pickmodf","struct","mask"],pickmod:["pick","pickmodf","struct"],pickf:["pick","pickmodf","struct"],pickmodf:["pick","pickf","struct"],pickrestart:["pickmodrestart","restart"],pickmodrestart:["pickrestart"],pickreset:["pickmodreset","reset"],pickmodreset:["pickreset"],inhabit:["inhabitmod","mask","struct"],inhabitmod:["inhabit","mask"],squeeze:["compress","segment"],superimpose:["layer","off","echo"],layer:["superimpose","off"],off:["superimpose","layer"],echo:["echowith","delay","superimpose"],echowith:["echo"],pace:["stepcat","stepalt","polymeter","slow","fast"],stepcat:["pace","stepalt","polymeter"],stepalt:["pace","stepcat"],expand:["contract","extend","take","drop"],contract:["expand","extend","take","drop"],extend:["expand","contract","take","drop"],take:["drop","extend","expand","contract"],drop:["take","extend","expand","contract"],polymeter:["pace","stepcat","slow","fast"],shrink:["grow","compress"],grow:["shrink","expand"],tour:["zip","iter"],zip:["tour","iter"],orientation:["acceleration","rotationx","rotationy","rotationz"],acceleration:["accelerationx","accelerationy","accelerationz","gravityx","gravityy","gravityz"],accelerate:["acceleration"],accelerationx:["accelerationy","accelerationz","gravityx"],accelerationy:["accelerationx","accelerationz","gravityy"],accelerationz:["accelerationx","accelerationy","gravityz"],rotationx:["rotationy","rotationz","orientation"],rotationy:["rotationx","rotationz","orientation"],rotationz:["rotationx","rotationy","orientation"],gravityx:["gravityy","gravityz","accelerationx"],gravityy:["gravityx","gravityz","accelerationy"],gravityz:["gravityx","gravityy","accelerationz"],mousex:["mousey","pan","range"],mousey:["mousex","gain","range"],osc:["mqtt"],mqtt:["osc"],midi:["midiport","midicmd","midibend","miditouch"],midiport:["midi"],midicmd:["midi"],midibend:["midi","miditouch"],miditouch:["midi","midibend"],midimap:["midimaps","defaultmidimap"],midimaps:["midimap","defaultmidimap"],defaultmidimap:["midimap","midimaps"],ccn:["ccv","control"],ccv:["ccn","control"],control:["ccn","ccv"],prognum:["midi"],sysex:["sysexid","sysexdata"],sysexid:["sysex","sysexdata"],sysexdata:["sysex","sysexid"],orbit:["duckorbit","pan"],scope:["fscope","pianoroll","spiral"],fscope:["scope","pianoroll"],pianoroll:["scope","fscope"],spiral:["scope"],pitchwheel:["penv"],color:["markcss"],markcss:["color"],vowel:["ftype","lpf"],speed:["slow","fast"],seg:["segment"],fancor:["lpf"],patt:["struct"],dec:["decay"],set:["struct"],irand:["rand","brand"]};function Ti(n){if(!n||typeof n!="string")return"";const e=n.replace(/^[.]+/,""),t=e.match(/^([a-zA-Z0-9_]+)/);return(t?t[1]:e).toLowerCase()}function Cc(n){if(!n||typeof n!="string")return!1;if(el.includes(n))return!0;const e=n.toLowerCase();return d5.some(t=>{const i=`.${t}`,s=`${t}(`;return e.includes(i)||e.includes(s)})}function Pc(n){if(!n||typeof n!="string")return"";const e=n.replace(/^[.]+/,"").toLowerCase();for(const[t,i]of f5.entries()){const s=t.toLowerCase();if(e===s||e.includes(s))return i}return""}function Yh(n){const e=document.createElement("div");return e.innerHTML=n||"",(e.textContent||e.innerText||"").trim()}let Ac=null,Ro=null;async function Kh(){return Ro||(Ac||(Ac=rn(()=>import("./index-CuqbEPxt.js"),[]).then(n=>{var i;const e=((i=n==null?void 0:n.reference)==null?void 0:i.docs)||{},t=new Map;for(const s of Object.values(e)){if(!s||!s.name)continue;const r=s.name.trim().toLowerCase();if(!r||t.has(r))continue;const a=Array.isArray(s.params)?s.params.map(o=>{var l;return{name:(o==null?void 0:o.name)||"",types:Array.isArray((l=o==null?void 0:o.type)==null?void 0:l.names)?o.type.names.slice():[],description:Yh((o==null?void 0:o.description)||"")}}):[];t.set(r,{name:s.name.trim(),descriptionHtml:s.description||"",descriptionText:Yh(s.description||""),params:a})}return t}).catch(n=>(console.warn("⚠️ Unable to load Strudel reference docs:",n),new Map))),Ro=await Ac,Ro)}function xc(n){return n?(typeof n.descriptionText=="string"||(n.descriptionText=Yh(n.descriptionHtml||"")),n.descriptionText):""}function ub(n){if(!n)return null;const e=n.toLowerCase(),t=e.match(/between\s+([-\d.]+)\s+and\s+([-\d.]+)/);if(t)return`${t[1]}-${t[2]}`;const i=e.match(/([-\d.]+)\s*-\s*([-\d.]+)/);return i?`${i[1]}-${i[2]}`:null}function y5(n){if(!n)return"";const e=n.name||"value",t=n.types||[],i=n.description||"",s=ub(i);return t.includes("number")?s?`${e}:${s}`:`${e}:number`:t.includes("string")?`${e}`:t.includes("Pattern")?`${e}:pattern`:e}function Ec(n){if(!n)return"";const e=n.name||"value",t=n.types||[],i=n.description||"",s=ub(i);return t.includes("number")?s?`${e} (number ${s})`:`${e} (number)`:t.includes("string")?`${e} (string)`:t.includes("Pattern")?`${e} (pattern)`:i?`${e} (${i})`:e}function hg(n,e){if(!n||typeof n!="string"||!n.endsWith("()"))return n;const t=(e==null?void 0:e.params)||[];if(!t.length)return n;const i=t.map(y5).filter(Boolean);return i.length?`${n.slice(0,-1)}${i.join(", ")})`:n}let kn=null,bs=null,dg=!1;function b5(){if(kn&&document.body.contains(kn))return kn;if(kn=document.createElement("div"),kn.id="pattern-snippet-tooltip",kn.className="pattern-snippet-tooltip",kn.setAttribute("role","tooltip"),kn.setAttribute("aria-hidden","true"),document.body.appendChild(kn),!dg){dg=!0;const n=()=>Wn();window.addEventListener("scroll",n,!0),window.addEventListener("resize",n,{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Wn()},!0)}return kn}function Wn(n=bs){kn&&(kn.classList.remove("visible"),kn.style.display="none",kn.style.visibility="hidden",kn.innerHTML="",kn.setAttribute("aria-hidden","true"),n&&n instanceof HTMLElement&&n.removeAttribute("aria-describedby"),bs&&bs!==n&&bs.removeAttribute("aria-describedby"),bs=null)}function kc(n){if(!n||!(n instanceof HTMLElement)||!document.body.contains(n))return;const e=b5();bs&&bs!==n&&Wn(bs);const t=n.dataset.tooltipTitle||n.textContent||"",i=n.dataset.tooltipDescription||"",s=n.dataset.tooltipParams||"";if(e.innerHTML="",t){const f=document.createElement("div");f.className="pattern-snippet-tooltip-title",f.textContent=t,e.appendChild(f)}if(i){const f=document.createElement("div");f.className="pattern-snippet-tooltip-body",i.split(`
`).forEach((m,g)=>{const y=m.trim();y&&(g>0&&f.appendChild(document.createElement("br")),f.appendChild(document.createTextNode(y)))}),f.childNodes.length>0&&e.appendChild(f)}if(s){const f=document.createElement("div");f.className="pattern-snippet-tooltip-params",s.split(`
`).forEach(m=>{const g=m.trim();if(!g)return;const y=document.createElement("div");y.textContent=g,f.appendChild(y)}),f.childElementCount>0&&e.appendChild(f)}e.style.display="block",e.style.visibility="hidden",e.classList.remove("visible");const r=n.getBoundingClientRect(),a=window.innerWidth||document.documentElement.clientWidth||0,o=window.innerHeight||document.documentElement.clientHeight||0,l=e.getBoundingClientRect(),c=8;let u=r.bottom+c;if(u+l.height>o-12){const f=r.top-l.height-c;f>=12?u=f:u=Math.max(12,o-l.height-12)}let h=r.left+r.width/2-l.width/2;const d=a-l.width-12;h>d&&(h=d),h<12&&(h=12),e.style.left=`${Math.round(h)}px`,e.style.top=`${Math.round(u)}px`,e.style.visibility="visible",e.classList.add("visible"),e.setAttribute("aria-hidden","false"),e.id||(e.id="pattern-snippet-tooltip"),n.setAttribute("aria-describedby",e.id),bs=n}let Mc=null,Dc=null,fg="",$c=null;function cb(n){return!n||typeof n!="string"?"":n.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\s+/g," ").trim()}function v5(n,e){if(!e)return n;const t=cb(e),i=new Set((t.match(/\.[a-zA-Z_][a-zA-Z0-9_]*/g)||[]).map(s=>Ti(s)));return n.filter(s=>{const r=Ti(s);return Yi[r]?!0:!i.has(r)})}async function pg(n=""){const e=cb(n);if(e===fg&&$c)return $c;Dc||(Mc||(Mc=(async()=>{const r=new Map;c5.forEach(g=>{const y=Ti(g);!r.has(y)&&g&&r.set(y,g)});const a=await Kh();a.forEach((g,y)=>{r.has(y)||/^[a-z][\w]*$/i.test(g.name)&&r.set(y,`${g.name}()`)});const o=Ba.reduce((g,y)=>(g.set(y.id,{snippets:[]}),g),new Map),l=new Set(el.map(g=>Ti(g))),c=new Map;Array.from(r.entries()).sort((g,y)=>g[0].localeCompare(y[0])).forEach(([g,y])=>{const b=a.get(g),P=Ba.find(v=>v.exclude&&v.exclude.includes(g)?!1:v.matcher(g,y,b))||Fo.get("other"),M=o.get(P.id);M&&M.snippets.push({snippet:y,groupId:P.id,className:P.className,heading:P.heading}),l.has(g)&&c.set(g,{snippet:y,groupId:P.id,className:P.className,heading:P.heading})});const u=el.map(g=>{const y=Ti(g);return c.get(y)||{snippet:g,groupId:"core",className:Fo.get("core").className,heading:Fo.get("core").heading}}).filter(Boolean).sort((g,y)=>g.snippet.localeCompare(y.snippet)),h=[],d=new Set;u.forEach(g=>{const{snippet:y,groupId:b,className:P,heading:M}=g;h.push({snippet:y,groupId:b,className:P,heading:M})}),[...Ba].sort((g,y)=>g.heading.localeCompare(y.heading)).forEach(g=>{const y=o.get(g.id);!y||!y.snippets.length||(d.has(g.id)||d.add(g.id),y.snippets.slice().sort((b,P)=>b.snippet.localeCompare(P.snippet)).forEach(({snippet:b,className:P,heading:M})=>{el.includes(b)||h.push({snippet:b,groupId:g.id,className:P,heading:M})}))});const m=Fo.get("synths");return m&&h5.forEach(g=>{h.some(y=>y.snippet===g)||h.push({snippet:g,groupId:m.id,className:m.className,heading:m.heading})}),Dc=h,h})()),await Mc);const t=Dc||[],i=v5(t.map(r=>r.snippet),e),s=t.filter(r=>i.includes(r.snippet));return fg=e,$c=s,s}function Io(n){if(!n||typeof n!="string")return n;const e=n.trim();return Kd[e.toLowerCase()]||e}function Tc(n){if(!n||typeof n!="string")return n;let e=n;for(const[t,i]of Object.entries(Kd)){const s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(\\.s\\(["'])${s}(["']\\))`,"gi");e=e.replace(r,(o,l,c)=>`${l}${i}${c}`);const a=new RegExp(`(sound\\(["'])${s}(["']\\))`,"gi");e=e.replace(a,(o,l,c)=>`${l}${i}${c}`)}return e}function mg(n){if(!n||typeof n!="string")return!1;for(const e of u5){const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\.s\\(["']${t}["']\\)`,"i").test(n))return!0}return/\b(note|n)\s*\(/.test(n)}function S5(n){if(!n||typeof n!="string")return"";const e=n.trim();if(!e)return"";if(e.includes("sound(")||e.includes("s(")||Un(e))return e;const t=e.split(/\s+/).filter(a=>a.trim()),i=[],s=[];for(const a of t)if(a)if(a.startsWith("."))s.push(a);else{const o=a.split("(")[0].trim();o&&(rb.hasOwnProperty(o.toLowerCase())||o.length>0)&&i.push(o)}if(i.length===0)return e;let r=`sound("${i.join(" ")}")`;return s.length>0&&(r+=s.join("")),r}function Di(n){let e=4,t=4;if(typeof n=="string"&&n.includes("/")){const[a,o]=n.split("/"),l=parseInt(a,10),c=parseInt(o,10);Number.isFinite(l)&&l>0&&(e=l),Number.isFinite(c)&&c>0&&(t=c)}const i=16/t,s=Math.max(1,Math.round(i)),r=Math.max(e,1)*s;return{signature:`${e}/${t}`,numerator:e,denominator:t,stepsPerBeat:s,totalSteps:r}}const w5=(n,e,t,i)=>{const s=(n-90)*Math.PI/180;return[t+Math.cos(s)*e,i+Math.sin(s)*e]},gg=(n,e,t,i,s=0)=>{const r=(n+s)*360;return w5(r,e*n,t,i)};function Og(n,e){let{from:t=0,to:i=3,margin:s=40,cx:r=100,cy:a=100,rotate:o=0,thickness:l=s/2,color:c="#4c51bf",cap:u="round",stretch:h=1,fromOpacity:d=1,toOpacity:f=1}=e;t*=h,i*=h,o*=h,n.lineWidth=l,n.lineCap=u,n.strokeStyle=c,n.globalAlpha=d,n.beginPath();let[m,g]=gg(t,s,r,a,o);n.moveTo(m,g);const y=1/60;let b=t;for(;b<=i;){const[P,M]=gg(b,s,r,a,o);n.globalAlpha=(b-t)/(i-t)*f,n.lineTo(P,M),b+=y}n.stroke(),n.globalAlpha=1}class yg{constructor(){ri=this,this.activeElements=new Set,this.initialized=!1,this.currentEditingElementId=null,this.mutedElements=new Set,this.soloedElements=new Set,this.elementCounter=4,this.masterActive=!1,this.masterPatternField=null,this._applyingVisualizer=!1,this.elementEffects={},this.elementFilters={},this.elementSynthesis={},this.currentTimeSignature="4/4",this.currentTimeSignatureMetrics=Di(this.currentTimeSignature),this.masterPunchcardContainer=null,this.masterPunchcardHeaderNote=null,this.masterPunchcardCanvas=null,this.masterPunchcardCtx=null,this.masterPunchcardPlaceholder=null,this.masterPunchcardIsRendering=!1,this.masterPunchcardPendingRefresh=!1,this.masterPunchcardResizeTimer=null,this.externalVisualizerCanvas=null,this.externalVisualizerObserver=null,this.externalVisualizerType=null,this.scopeAnimationFrame=null,this.barchartAnimationFrame=null,this.scopeDataArray=null,this.spectrumDataArray=null,this.activeVisualizerLoop=null,this.introSamplePlayed=!1,this._introSampleActivationHandler=null,this.nativeHighlightingEnabled=!1,this.nativeHighlightingDisabled=!1,this.nativeHighlightRetryCount=0,this.nativeHighlightRetryTimer=null,this.visualizerFullscreenBtn=null,this.handleVisualizerFullscreenChange=this.handleVisualizerFullscreenChange.bind(this),document.addEventListener("fullscreenchange",this.handleVisualizerFullscreenChange),document.addEventListener("webkitfullscreenchange",this.handleVisualizerFullscreenChange),document.addEventListener("mozfullscreenchange",this.handleVisualizerFullscreenChange),document.addEventListener("MSFullscreenChange",this.handleVisualizerFullscreenChange)}async init(){V.appInstance=this,tn.onUpdate("tempo",i=>{V.setTempo(i)}),tn.onUpdate("key",i=>{V.setKey(i),console.log(`🎹 Key changed to: ${i}`)}),tn.onUpdate("scale",i=>{V.setScale(i),console.log(`🎼 Scale changed to: ${i||"(none)"}`)}),tn.onUpdate("timeSignature",i=>{if(this.currentTimeSignature=i||"4/4",this.currentTimeSignatureMetrics=Di(this.currentTimeSignature),V.setTimeSignature(i),console.log(`🎵 Time signature changed to: ${i}`),typeof this.applyTimeSignatureToDrumGrid=="function")try{this.applyTimeSignatureToDrumGrid(this.currentTimeSignature)}catch(s){console.warn("⚠️ Could not update drum grid for new time signature:",s)}this.refreshMasterPunchcard("time-signature-change").catch(s=>{console.warn("⚠️ Could not refresh punchcard after time signature change:",s)})}),tn.setSoundTrigger((i,s)=>{V.isAudioReady()&&(s.type==="synthesized"?V.playSynthesizedSound(i,s.pattern).catch(r=>{console.error(`Error triggering control sound for ${i}:`,r)}):s.type==="strudel"&&V.playStrudelPattern(i,s.pattern).catch(r=>{console.error(`Error triggering control sound for ${i}:`,r)}))}),this.registerElements(),this.setupElementControls(),V.onSoundsReady(()=>{console.log("🎉 Sounds are ready - activating green dots"),this.setAllElementsLoaded(),tn.updateStatus("Ready - Click elements to start/stop patterns (Press Escape to stop all)"),this.enableNativeStrudelHighlighting()}),V.onMasterPatternUpdate(async()=>{console.log("🔄 Master pattern updated - refreshing display"),this.updateMasterPatternDisplay(),this.updateActiveElementsDisplay(),this.refreshMasterPunchcard("master-update").catch(i=>{console.warn("⚠️ Could not refresh punchcard after master update:",i)})}),V.onMasterStateChange((i,s)=>{console.log(`🎚️ Master state changed: ${i?"playing":"stopped"}, elements: ${s.join(", ")}`),this.masterActive=i;const r=document.getElementById("play-master-btn"),a=document.querySelector(".master-active-dot");r&&(i?(r.textContent="❚❚",r.title="Pause Master",r.classList.add("active")):(r.textContent="▶",r.title="Play Master",r.classList.remove("active"))),a&&(i?a.classList.add("active"):a.classList.remove("active")),s.forEach(o=>{this.updateStatusDots(o,!0,i)}),i||document.querySelectorAll(".element-circle").forEach(o=>{o.classList.remove("playing")}),i?(this.hideMasterPunchcardPlaceholder(),this.enableNativeStrudelHighlighting()):this.showMasterPunchcardPlaceholder()}),this.setupAudioInitialization(),this.setupMasterChannel();const e=i=>{console.log("Key pressed:",i.key),(i.key==="Escape"||i.keyCode===27)&&(console.log("🛑 Emergency stop activated (Escape key pressed)"),i.preventDefault(),i.stopPropagation(),V.stopAllSounds(),tn.updateStatus("🛑 All sounds stopped"),this.activeElements.clear(),this.updateActiveElementsDisplay(),zt.elements.forEach(s=>{const r=this.elementHasPattern(s.id);this.updateStatusDots(s.id,r,!1)}))};document.addEventListener("keydown",e,!0),window.addEventListener("keydown",e,!0),console.log("✅ Escape key handler registered");const t=document.getElementById("stop-all-btn");t?(t.addEventListener("click",()=>{console.log("🛑 Stop All button clicked"),V.stopAllSounds(),tn.updateStatus("🛑 All sounds stopped"),this.activeElements.clear(),this.updateActiveElementsDisplay(),zt.elements.forEach(i=>{const s=this.elementHasPattern(i.id);this.updateStatusDots(i.id,s,!1)})}),console.log("✅ Stop All button handler registered")):console.warn("⚠️ Stop All button not found in DOM"),this.initialized=!0,this.setAllElementsNotLoaded(),this.migrateLocalStorageQuotes(),this.loadAllElementConfigs(),this.setupModal(),this.setupAddElementButton(),tn.updateStatus("Ready - Click anywhere to enable audio (Press Escape to stop all sounds)"),setTimeout(()=>{try{cD(),this.enableNativeStrudelHighlighting()}catch(i){console.warn("⚠️ Strudel REPL editor initialization failed (non-critical):",i.message),console.log("💡 Pattern editing will use plain textareas instead")}},100),console.log("Interactive Sound App initialized"),console.log("💡 Tip: Press Escape key or click Stop All button to silence everything")}initializeElementVisualizations(e=null,t=null){(e?[e]:document.querySelectorAll(".sound-element")).forEach(s=>{const r=t||s.dataset.soundId;if(!r)return;s.querySelector(".config-button");const a=this.loadElementConfig(r);if(a&&a.pattern&&a.pattern.trim()!==""){this.updateSynthesisSectionVisibility(r,a.pattern);const l=a.title&&a.title.trim()?a.title:a.bank?Na[a.bank]||a.bank:"";mi(r,l)}else mi(r,"")})}setupMasterChannel(){const e=document.getElementById("master-volume"),t=document.getElementById("master-pan"),i=document.getElementById("master-mute-btn"),s=document.getElementById("master-volume-value"),r=document.getElementById("master-pan-value");if(e){const a=parseFloat(e.value);V.masterVolume=a/100,s&&(s.textContent=Math.round(a)),console.log(`🎚️ Master volume slider initialized: ${a}% (${V.masterVolume})`),e.addEventListener("input",o=>{const l=parseFloat(o.target.value);console.log(`🎚️ Master volume slider changed: ${l}%`),V.setMasterVolume(l/100),s&&(s.textContent=Math.round(l)),V.updateMasterPattern(this.soloedElements,this.mutedElements)}),V.isAudioReady()&&V.masterGainNode?(console.log(`🎚️ Audio already ready, setting master volume to ${a}%`),V.setMasterVolume(a/100)):console.log("🎚️ Audio not ready yet, master volume will be set on initialization")}else console.warn("⚠️ Master volume slider not found in DOM");if(t){const a=parseFloat(t.value);V.masterPan=a,r&&(r.textContent=a.toFixed(2)),console.log(`🎚️ Master pan slider initialized: ${a}`),t.addEventListener("input",o=>{const l=parseFloat(o.target.value);console.log(`🎚️ Master pan slider changed: ${l}`),V.setMasterPan(l),r&&(r.textContent=l.toFixed(2)),V.updateMasterPattern(this.soloedElements,this.mutedElements)}),V.isAudioReady()&&V.masterPanNode?(console.log(`🎚️ Audio already ready, setting master pan to ${a}`),V.setMasterPan(a)):console.log("🎚️ Audio not ready yet, master pan will be set on initialization")}else console.warn("⚠️ Master pan slider not found in DOM");i&&i.addEventListener("click",()=>{console.log("🎚️ Master mute button clicked");const a=V.toggleMasterMute();i.textContent=a?"🔇":"🔊",i.title=a?"Unmute Master":"Mute Master",console.log(`🎚️ Master mute toggled: ${a?"MUTED":"UNMUTED"}`)}),this.setupMasterPatternControls(),this.setupMasterPunchcard(),console.log("✅ Master channel controls setup complete")}tryPlayIntroSample(){if(this.introSamplePlayed||!ag||!V)return;const e=typeof V.getAudioContext=="function"?V.getAudioContext():null,t=V.isAudioReady()&&e,i=()=>{try{V.playAudioFile("intro-sample",ag),this.introSamplePlayed=!0,this.detachIntroSampleActivationHandlers()}catch(s){console.warn("⚠️ Unable to play intro sample automatically:",s)}};t?e.state!=="running"?e.resume().then(()=>{i()}).catch(s=>{console.warn("⚠️ Unable to resume audio context for intro sample:",s),this.attachIntroSampleActivationHandlers()}):i():this.attachIntroSampleActivationHandlers()}attachIntroSampleActivationHandlers(){this._introSampleActivationHandler||this.introSamplePlayed||(this._introSampleActivationHandler=()=>{if(V!=null&&V.getAudioContext){const e=V.getAudioContext();e&&e.state==="suspended"&&e.resume().catch(()=>{})}this.tryPlayIntroSample()},document.addEventListener("pointerdown",this._introSampleActivationHandler,{passive:!0}),document.addEventListener("keydown",this._introSampleActivationHandler))}detachIntroSampleActivationHandlers(){this._introSampleActivationHandler&&(document.removeEventListener("pointerdown",this._introSampleActivationHandler),document.removeEventListener("keydown",this._introSampleActivationHandler),this._introSampleActivationHandler=null)}setupMasterPatternControls(){this.masterPatternField=document.getElementById("master-pattern");const e=document.getElementById("play-master-btn"),t=document.getElementById("update-master-btn"),i=document.querySelector(".master-active-dot");if(!this.masterPatternField){console.warn("⚠️ Master pattern field not found in DOM");return}e&&(e.addEventListener("click",async()=>{if(this.masterActive)console.log("⏸️ Pause Master button clicked"),(await V.stopMasterPattern()).success&&(this.masterActive=!1,V.masterActive=!1,e.textContent="▶",e.title="Play Master",e.classList.remove("active"),i&&i.classList.remove("active"),console.log("✅ Master playback paused"));else{console.log("▶️ Play Master button clicked");const o="modal-preview";if(V.isPlaying(o)){console.log("⏹️ Stopping modal preview before playing master"),V.stopSound(o);const u=document.getElementById("modal-preview-btn");u&&(u.textContent="▶ Preview Pattern",u.classList.remove("active"))}const l=ft("master-pattern").trim();if(l&&l!==V.getMasterPatternCode()){if(V.masterPattern=V.formatMasterPatternWithTempoComment(l),typeof this.syncElementsFromMasterPattern=="function")try{this.syncElementsFromMasterPattern(V.masterPattern)}catch(u){console.warn("⚠️ Could not sync elements from master code before play:",u)}console.log("📝 Updated master pattern code directly before playing")}this.selectedVisualizer&&this.selectedVisualizer!=="punchcard"?(console.log(`🎨 Preparing canvas for visualizer "${this.selectedVisualizer}"`),this.prepareCanvasForExternalVisualizer()):this.showMasterPunchcardPlaceholder(),console.log(`🎨 Applying visualizer "${this.selectedVisualizer||"punchcard"}" before playing`);try{await this.applyVisualizerToMaster()}catch(u){console.warn("⚠️ Error applying visualizer, continuing with playback:",u)}const c=await V.playMasterPattern();c.success?(this.masterActive=!0,e.textContent="❚❚",e.title="Pause Master",e.classList.add("active"),i&&i.classList.add("active"),console.log("✅ Master playback started")):(console.error("❌ Failed to play master:",c.error),alert(`Failed to play master: ${c.error}`))}}),this._masterSpacebarHandlerAttached||(this._masterSpacebarHandlerAttached=!0,document.addEventListener("keydown",async o=>{var h;if(o.code!=="Space")return;const l=document.activeElement,c=(h=l==null?void 0:l.tagName)==null?void 0:h.toLowerCase();l!=null&&l.isContentEditable||c==="textarea"||c==="input"&&(l==null?void 0:l.type)!=="button"&&(l==null?void 0:l.type)!=="checkbox"&&(l==null?void 0:l.type)!=="range"||c==="select"||(o.preventDefault(),e.click())})));const s=document.getElementById("export-audio-btn");s&&s.addEventListener("click",async()=>{if(console.log("🎵 Export Audio button clicked"),!V.getMasterPatternCode()||V.getMasterPatternCode().trim()===""){alert("No master pattern to export. Please create a pattern first.");return}const o=prompt("Enter export duration in seconds (default: 16):","16");if(o===null)return;const l=parseInt(o)||16;s.disabled=!0,s.textContent="⏳ Exporting...";try{const c=await V.exportAudioWAV(l);c.success?(c.warning?alert(`⚠️ Audio exported as ${c.format.toUpperCase()}!

${c.warning}`):alert(`✅ Audio exported successfully as ${c.format.toUpperCase()}!`),console.log("✅ Audio export complete")):(alert(`❌ Export failed: ${c.error}`),console.error("❌ Audio export failed:",c.error))}catch(c){alert(`❌ Export error: ${c.message}`),console.error("❌ Audio export error:",c)}finally{s.disabled=!1,s.textContent="🎵 Export Audio"}}),t&&t.addEventListener("click",async()=>{console.log("💾 Update Master button clicked");const o=ft("master-pattern").trim();if(!o){alert("Master pattern is empty");return}const l=await V.setMasterPatternCode(o);l.success?(console.log("✅ Master pattern code updated"),alert("Master pattern updated successfully!")):(console.error("❌ Failed to update master:",l.error),alert(`Failed to update master: ${l.error}`))});const r=document.getElementById("copy-code-btn");r&&r.addEventListener("click",async()=>{const o=this.masterPatternField.value.trim();if(!o){alert("Master pattern is empty");return}try{const l="// Created with Strudesk 4000 by eKommissar",c=o.startsWith(l)?o:`${l}

${o}`;await navigator.clipboard.writeText(c);const u=r.textContent;r.textContent="✓ Copied!",r.title="Copied!",setTimeout(()=>{r.textContent=u,r.title="Copy"},2e3),console.log("✅ Master pattern code copied to clipboard")}catch(l){console.error("❌ Failed to copy code:",l),alert("Failed to copy code to clipboard")}});const a=document.getElementById("clear-all-btn");a&&a.addEventListener("click",()=>{confirm("Are you sure you want to clear all? This will clear the master pattern and all element configurations.")&&(console.log("🗑️ Clear All button clicked"),this.resetAll())}),console.log("✅ Master pattern controls setup complete")}setupMasterPunchcard(){if(this.masterPunchcardContainer=document.getElementById("master-punchcard"),this.masterPunchcardCanvas=document.getElementById("master-punchcard-canvas"),this.masterPunchcardPlaceholder=this.masterPunchcardContainer?this.masterPunchcardContainer.querySelector(".punchcard-placeholder"):null,!this.masterPunchcardContainer||!this.masterPunchcardCanvas){console.warn("⚠️ Master punchcard elements not found in DOM");return}const e=this.getMasterPunchcardContext();e&&(window.__strudelVisualizerCtx=e),this.selectedVisualizer="scope";const t=document.getElementById("visualizer-select");this.visualizerSelect=t,t&&(t.value=this.selectedVisualizer,t.addEventListener("change",async i=>{this.selectedVisualizer=i.target.value,console.log(`🎨 Visualizer changed to: ${this.selectedVisualizer}`),this.selectedVisualizer!=="punchcard"?this.prepareCanvasForExternalVisualizer():this.showMasterPunchcardPlaceholder(),await this.applyVisualizerToMaster(),this.refreshMasterPunchcard("visualizer-change").catch(s=>{console.warn("⚠️ Unable to refresh punchcard after visualizer change:",s)})})),this.visualizerFullscreenBtn=document.getElementById("visualizer-fullscreen-btn"),this.visualizerFullscreenBtn&&(this.visualizerFullscreenBtn.addEventListener("click",()=>{this.toggleVisualizerFullscreen()}),this.updateVisualizerFullscreenButton(!1)),this.showMasterPunchcardPlaceholder(),window.addEventListener("resize",()=>{this.masterPunchcardResizeTimer&&clearTimeout(this.masterPunchcardResizeTimer),this.masterPunchcardResizeTimer=setTimeout(()=>{this.refreshMasterPunchcard("resize").catch(i=>{console.warn("⚠️ Unable to refresh punchcard after resize:",i)})},150)}),this.refreshMasterPunchcard("initial").catch(i=>{console.warn("⚠️ Unable to render initial punchcard:",i)})}getCurrentFullscreenElement(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null}async toggleVisualizerFullscreen(){if(!this.masterPunchcardContainer)return;const e=this.getCurrentFullscreenElement(),t=this.masterPunchcardContainer.classList.contains("is-fullscreen")&&!e;if(e===this.masterPunchcardContainer||t){e===this.masterPunchcardContainer?document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen():(this.masterPunchcardContainer.classList.remove("is-fullscreen"),document.body.style.overflow="",this.updateVisualizerFullscreenButton(!1),this.removeMobileFullscreenCloseButton());return}try{if(this.masterPunchcardContainer.requestFullscreen){await this.masterPunchcardContainer.requestFullscreen();return}if(this.masterPunchcardContainer.webkitRequestFullscreen)try{const i=typeof Element<"u"&&Element.ALLOW_KEYBOARD_INPUT!==void 0?Element.ALLOW_KEYBOARD_INPUT:void 0;i!==void 0?await this.masterPunchcardContainer.webkitRequestFullscreen(i):await this.masterPunchcardContainer.webkitRequestFullscreen();return}catch(i){console.warn("⚠️ Webkit fullscreen failed, trying fallback:",i)}if(this.masterPunchcardContainer.mozRequestFullScreen){await this.masterPunchcardContainer.mozRequestFullScreen();return}if(this.masterPunchcardContainer.msRequestFullscreen){await this.masterPunchcardContainer.msRequestFullscreen();return}if(this.isMobileDevice()){this.masterPunchcardContainer.classList.add("is-fullscreen"),document.body.style.overflow="hidden",this.updateVisualizerFullscreenButton(!0),this.addMobileFullscreenCloseButton(),setTimeout(()=>{this.refreshMasterPunchcard("css-fullscreen").catch(i=>{console.warn("⚠️ Unable to refresh punchcard after CSS fullscreen:",i)})},100);return}console.warn("⚠️ Fullscreen API not supported on this device")}catch(i){console.warn("⚠️ Unable to enter visualizer fullscreen:",i),this.isMobileDevice()&&(this.masterPunchcardContainer.classList.add("is-fullscreen"),document.body.style.overflow="hidden",this.updateVisualizerFullscreenButton(!0),this.addMobileFullscreenCloseButton(),setTimeout(()=>{this.refreshMasterPunchcard("css-fullscreen-fallback").catch(s=>{console.warn("⚠️ Unable to refresh punchcard after CSS fullscreen fallback:",s)})},100))}}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768&&"ontouchstart"in window}addMobileFullscreenCloseButton(){if(this.removeMobileFullscreenCloseButton(),!this.masterPunchcardContainer)return;const e=document.createElement("button");e.id="mobile-fullscreen-close",e.className="mobile-fullscreen-close-btn",e.innerHTML="✕",e.setAttribute("aria-label","Close fullscreen"),e.addEventListener("click",()=>{this.toggleVisualizerFullscreen()}),this.masterPunchcardContainer.appendChild(e)}removeMobileFullscreenCloseButton(){const e=document.getElementById("mobile-fullscreen-close");e&&e.remove()}updateVisualizerFullscreenButton(e){this.visualizerFullscreenBtn&&(this.visualizerFullscreenBtn.classList.toggle("is-active",e),this.visualizerFullscreenBtn.setAttribute("aria-label",e?"Exit visualizer fullscreen":"Enter visualizer fullscreen"))}handleVisualizerFullscreenChange(){const t=this.getCurrentFullscreenElement()===this.masterPunchcardContainer;this.masterPunchcardContainer&&(this.masterPunchcardContainer.classList.toggle("is-fullscreen",t),!t&&this.isMobileDevice()?(document.body.style.overflow="",this.removeMobileFullscreenCloseButton()):t&&this.isMobileDevice()&&setTimeout(()=>{this.addMobileFullscreenCloseButton()},100)),this.updateVisualizerFullscreenButton(t),this.refreshMasterPunchcard("fullscreen-change").catch(i=>{console.warn("⚠️ Unable to refresh punchcard after fullscreen change:",i)})}async applyVisualizerToMaster(){var h;console.log(`🎨 Applying visualizer "${this.selectedVisualizer}" to master pattern`),this.scopeSpectrumObserver=null,this.scopeSpectrumCopyLoop=null,this.teardownExternalVisualizerCanvas(),this.stopVisualizerAnimation(),this.selectedVisualizer!=="pianoroll"&&document.querySelectorAll('canvas[data-processed="true"]').forEach(f=>{f.id!=="master-punchcard-canvas"&&f.remove()}),this.prepareCanvasForExternalVisualizer();let e=V.getMasterPatternCode();if(!e||e.trim()===""){if(V.trackedPatterns&&V.trackedPatterns.size>0&&(console.log(`🔄 Master pattern is empty but ${V.trackedPatterns.size} tracked pattern(s) found - rebuilding master pattern`),V.updateMasterPattern(new Set,new Set),e=V.getMasterPatternCode()),!e||e.trim()===""){const d=ft("master-pattern").trim();d&&d!==""&&(console.log("📝 Reading master pattern from editor"),e=d)}(!e||e.trim()==="")&&(console.warn("⚠️ No master pattern to apply visualizer to, using silence"),e="silence")}e=e.replace(/\/\/.*$/gm,""),e=e.replace(/\/\*[\s\S]*?\*\//g,d=>/\/\*\s*Channel\s+\d+\s*\*\//i.test(d)?d:""),e=e.replace(/\n\s*\n/g,`
`).trim();const t=(d,f)=>{let m=1;for(let g=f+1;g<d.length;g++)if(d[g]==="(")m++;else if(d[g]===")"&&(m--,m===0))return g;return-1};["scope","tscope","fscope","spectrum","visual","pianoroll","barchart"].forEach(d=>{const f=new RegExp(`\\.\\s*_?${d}\\s*\\(`,"gi");let m;for(;(m=f.exec(e))!==null;){const g=m.index,y=m.index+m[0].length-1,b=t(e,y);if(b!==-1)e=e.substring(0,g)+e.substring(b+1),f.lastIndex=0;else break}}),e=e.trim().replace(/\.\s*$/,"").replace(/\.\.+/g,".").trim();let s=e;const r="master-punchcard-canvas";if(this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart"||this.selectedVisualizer==="spectrum"){V.setupVisualizerAnalyser(),await new Promise(m=>setTimeout(m,100));const d=r,f=((h=window.strudel)==null?void 0:h.getAnalyserById)||globalThis.getAnalyserById;if(f)try{const m=f(d);m&&m.context===V.audioContext?console.log(`✅ Verified analyser "${d}" is ready in correct audio context`):console.warn(`⚠️ Analyser "${d}" not ready or in wrong context`)}catch(m){console.warn("⚠️ Could not verify analyser:",m.message)}}const a=document.getElementById(r);if(a){a.style.position="relative",a.style.display="block",a.style.visibility="visible",a.style.opacity="1",a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%",a.id=r;const d=document.getElementById("master-punchcard");if(d&&a.parentNode!==d&&d.appendChild(a),d){const f=d.getBoundingClientRect(),m=window.devicePixelRatio||1,g=Math.max(f.width||320,320),y=Math.max(f.height||200,200);a.width=g*m,a.height=y*m,a.style.width=`${g}px`,a.style.height=`${y}px`,(this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart"||this.selectedVisualizer==="spectrum")&&(a.offsetHeight,console.log(`✅ Canvas "${r}" is ready for ${this.selectedVisualizer}:`,{id:a.id,width:a.width,height:a.height,visible:a.style.display!=="none",inDOM:document.contains(a)}))}}else console.error(`❌ Canvas "${r}" not found!`);if((this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart"||this.selectedVisualizer==="spectrum")&&(a&&a.id!==r&&(a.id=r),this.masterPunchcardCanvas.style.display="block"),this.selectedVisualizer==="pianoroll")try{const d=mu(r,{contextType:"2d"});window.__strudelVisualizerCtx=d,console.log(`✅ Registered canvas "${r}" with getDrawContext for ${this.selectedVisualizer}`)}catch(d){console.warn(`⚠️ Failed to register canvas with getDrawContext for ${this.selectedVisualizer}:`,d)}this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart"?s=e:this.selectedVisualizer==="spectrum"?s=`${e}._spectrum({
        id: '${r}',
        ctx: (window.__strudelVisualizerCtx || (document.getElementById('master-punchcard-canvas') && document.getElementById('master-punchcard-canvas').getContext && document.getElementById('master-punchcard-canvas').getContext('2d'))),
        thickness: 3,
        speed: 1,
        min: -80,
        max: 0
      })`:this.selectedVisualizer==="pianoroll"&&(this.externalVisualizerType="pianoroll",this.watchForExternalVisualizerCanvas("pianoroll"),this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="none"),s=`${e}.pianoroll({ 
          cycles: 4,
          playhead: 0.5,
          fill: true,
          fillActive: true,
          stroke: true,
          strokeActive: true,
          autorange: true,
          colorizeInactive: true,
          background: '#05060a'
        })`),console.log(`🎨 Pattern with visualizer: ${s.substring(0,150)}...`),console.log("🎨 Full pattern with visualizer:",s),(!s||s.trim()==="")&&(console.warn("⚠️ Pattern with visualizer is empty, using base pattern"),s=e||"silence");const l=this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart",c=!l&&this.selectedVisualizer!=="punchcard";let u=!0;c?(u=new RegExp(`\\.\\s*_?${this.selectedVisualizer}\\s*\\(`).test(s),u?console.log(`✅ Visualizer "${this.selectedVisualizer}" found in pattern`):console.error(`❌ Visualizer "${this.selectedVisualizer}" not found in pattern! Pattern:`,s)):l&&console.log(`✅ Using internal analyser visualizer for ${this.selectedVisualizer}`),await V.setMasterPatternCode(s),this.selectedVisualizer==="scope"?this.startScopeVisualizerLoop():this.selectedVisualizer==="barchart"?this.startBarchartVisualizerLoop():this.selectedVisualizer==="pianoroll"&&(this.watchForExternalVisualizerCanvas("pianoroll"),this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="none"),this.hideMasterPunchcardPlaceholder()),this.refreshMasterPunchcard("visualizer-applied").catch(d=>{console.warn("⚠️ Unable to refresh punchcard after applying visualizer:",d)})}showMasterPunchcardPlaceholder(){this.masterPunchcardContainer&&(this.masterPunchcardPlaceholder&&this.masterPunchcardPlaceholder.classList.remove("hidden"),this.masterPunchcardCanvas&&this.masterPunchcardCtx&&(this.masterPunchcardCtx.setTransform(1,0,0,1,0,0),this.masterPunchcardCtx.clearRect(0,0,this.masterPunchcardCanvas.width,this.masterPunchcardCanvas.height)))}async refreshMasterPunchcard(e="auto"){if(!this.masterPunchcardContainer)return;const t=V.getMasterPatternCode();if(!t||t.trim()===""){this.showMasterPunchcardPlaceholder();return}const i=this.shouldUseSpiralVisualizer(t),s=!i&&this.shouldUseScopeVisualizer(t),r=!i&&!s&&this.shouldUseSpectrumVisualizer(t),a=!i&&!s&&!r&&this.shouldUsePitchwheelVisualizer(t),o=!i&&!s&&!r&&!a&&this.shouldUsePianorollVisualizer(t),l=!i&&!s&&!r&&!a&&!o&&this.shouldUseBarchartVisualizer(t);r&&this.selectedVisualizer!=="spectrum"&&(!this.selectedVisualizer||["scope","punchcard","barchart"].includes(this.selectedVisualizer))&&(this.selectedVisualizer="spectrum",this.visualizerSelect&&(this.visualizerSelect.value="spectrum")),o&&this.selectedVisualizer!=="pianoroll"&&(!this.selectedVisualizer||["scope","punchcard","barchart","spectrum"].includes(this.selectedVisualizer))&&(this.selectedVisualizer="pianoroll",this.visualizerSelect&&(this.visualizerSelect.value="pianoroll"));const c=this.selectedVisualizer||"punchcard";if(c==="scope"){this.prepareCanvasForExternalVisualizer(),this.startScopeVisualizerLoop(),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(c==="barchart"){this.prepareCanvasForExternalVisualizer(),this.startBarchartVisualizerLoop(),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(c==="spectrum"){this.prepareCanvasForExternalVisualizer(),this.watchForExternalVisualizerCanvas("spectrum"),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(c==="pianoroll"){this.watchForExternalVisualizerCanvas("pianoroll"),this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="none"),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(c!=="scope"&&c!=="barchart"&&this.stopVisualizerAnimation(),s||r||i||a||o||l){(this.selectedVisualizer||"punchcard")==="punchcard"&&s&&this.watchForExternalVisualizerCanvas("scope"),o&&(this.watchForExternalVisualizerCanvas("pianoroll"),this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="none")),this.prepareCanvasForExternalVisualizer(),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(this.masterPunchcardIsRendering){this.masterPunchcardPendingRefresh=!0;return}this.masterPunchcardIsRendering=!0;try{const u=this.currentTimeSignatureMetrics||Di(this.currentTimeSignature||"4/4"),h=await this.computeMasterPunchcardData(t,u);if(!h||h.error){const f=h!=null&&h.error?`Unable to render punchcard: ${h.error}`:"Unable to render punchcard.";console.warn(f,{reason:e,data:h}),this.showMasterPunchcardPlaceholder();return}if(!h.counts||h.counts.length===0){this.showMasterPunchcardPlaceholder();return}if(Math.max(...h.counts)<=0){this.showMasterPunchcardPlaceholder();return}this.renderMasterPunchcard(u,h)}finally{this.masterPunchcardIsRendering=!1,this.masterPunchcardPendingRefresh&&(this.masterPunchcardPendingRefresh=!1,this.refreshMasterPunchcard("queued-refresh").catch(u=>{console.warn("⚠️ Queued punchcard refresh failed:",u)}))}}renderMasterPunchcard(e,t){!this.masterPunchcardContainer||!this.masterPunchcardCanvas||(this.hideMasterPunchcardPlaceholder(),this.drawMasterPunchcardCanvas(e,t))}prepareCanvasForExternalVisualizer(){if(!this.masterPunchcardContainer||!this.masterPunchcardCanvas){console.warn("⚠️ Canvas elements not found for visualizer");return}const e=this.masterPunchcardCanvas.id;if(console.log(`🎨 Preparing canvas for external visualizer: ${e}`),!document.getElementById(e)){console.error(`❌ Canvas "${e}" not found via getElementById!`);return}console.log(`✅ Canvas "${e}" is accessible via getElementById`),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardCanvas.style.position="relative",this.masterPunchcardCanvas.style.left="0",this.masterPunchcardCanvas.style.top="0",this.masterPunchcardCanvas.style.width="100%",this.masterPunchcardCanvas.style.height="100%",this.masterPunchcardCanvas.style.display="block";const i=["scope","barchart","spectrum"];this.masterPunchcardCanvas.style.background=i.includes(this.selectedVisualizer)?"#05060a":"rgba(255, 255, 255, 0.9)";let s;try{s=mu(e,{contextType:"2d"}),console.log(`✅ Got draw context via getDrawContext for ${e}`)}catch(r){console.warn("⚠️ getDrawContext failed, falling back to native:",r),s=this.masterPunchcardCanvas.getContext("2d")}if(s&&(this.sizeCanvasToContainer(this.masterPunchcardCanvas,s),window.__strudelVisualizerCtx=s,window.strudel&&window.strudel.controls))try{window.strudel.controls.setCanvas(e),console.log(`✅ Registered canvas "${e}" with Strudel controls`)}catch(r){console.log("ℹ️ Could not register with strudel.controls:",r.message)}}sizeCanvasToContainer(e,t){if(!e||!this.masterPunchcardContainer)return;const i=this.masterPunchcardContainer.getBoundingClientRect(),s=Math.max(i.width||this.masterPunchcardContainer.offsetWidth||320,240),r=Math.max(i.height||this.masterPunchcardContainer.offsetHeight||200,220),a=window.devicePixelRatio||1;e.width=s*a,e.height=r*a,e.style.width="100%",e.style.height="100%",e.style.display="block",e.style.opacity="1",t&&(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),t.setTransform(a,0,0,a,0,0))}ensureVisualizerAnalyser(){return V?(V.visualizerAnalyser||typeof V.setupVisualizerAnalyser=="function"&&V.setupVisualizerAnalyser(),V.visualizerAnalyser||null):null}stopVisualizerAnimation(){this.scopeAnimationFrame&&(cancelAnimationFrame(this.scopeAnimationFrame),this.scopeAnimationFrame=null),this.barchartAnimationFrame&&(cancelAnimationFrame(this.barchartAnimationFrame),this.barchartAnimationFrame=null),this.activeVisualizerLoop=null}drawVisualizerMessage(e){const t=this.masterPunchcardCanvas,i=this.getMasterPunchcardContext();if(!t||!i)return;this.sizeCanvasToContainer(t,i);const s=window.devicePixelRatio||1,r=t.width/s,a=t.height/s;i.fillStyle="rgba(5, 6, 10, 0.92)",i.fillRect(0,0,r,a),i.fillStyle="#94a3b8",i.font='14px "Fira Sans", "Inter", system-ui, sans-serif',i.textAlign="center",i.textBaseline="middle",i.fillText(e,r/2,a/2)}startScopeVisualizerLoop(){if(this.activeVisualizerLoop==="scope")return;const e=this.masterPunchcardCanvas,t=this.getMasterPunchcardContext();if(!e||!t)return;const i=this.ensureVisualizerAnalyser();if(!i){this.drawVisualizerMessage("Scope analyser unavailable");return}const s=i.fftSize||2048;(!this.scopeDataArray||this.scopeDataArray.length!==s)&&(this.scopeDataArray=new Uint8Array(s)),this.activeVisualizerLoop="scope";const r=()=>{if(this.selectedVisualizer!=="scope"){this.stopVisualizerAnimation();return}const a=this.getMasterPunchcardContext();if(!a){this.stopVisualizerAnimation();return}this.hideMasterPunchcardPlaceholder(),this.masterPunchcardCanvas.style.display="block",this.sizeCanvasToContainer(e,a),i.getByteTimeDomainData(this.scopeDataArray);const o=window.devicePixelRatio||1,l=e.width/o,c=e.height/o;a.fillStyle="rgba(5, 6, 10, 0.92)",a.fillRect(0,0,l,c);const u=c/2;a.strokeStyle="#38bdf8",a.lineWidth=2,a.beginPath();const h=l/this.scopeDataArray.length;let d=0;for(let f=0;f<this.scopeDataArray.length;f++){const g=this.scopeDataArray[f]/128*c/2;f===0?a.moveTo(d,g):a.lineTo(d,g),d+=h}a.lineTo(l,u),a.stroke(),a.strokeStyle="rgba(14, 165, 233, 0.4)",a.beginPath(),a.moveTo(0,u),a.lineTo(l,u),a.stroke(),this.scopeAnimationFrame=requestAnimationFrame(r)};r()}startBarchartVisualizerLoop(){var l;if(this.activeVisualizerLoop==="barchart")return;const e=this.masterPunchcardCanvas,t=this.getMasterPunchcardContext();if(!e||!t)return;const i=this.ensureVisualizerAnalyser();if(!i){this.drawVisualizerMessage("Spectrum analyser unavailable");return}const s=i.frequencyBinCount||1024;(!this.spectrumDataArray||this.spectrumDataArray.length!==s)&&(this.spectrumDataArray=new Uint8Array(s));const a=(((l=i.context)==null?void 0:l.sampleRate)||44100)/2;this.activeVisualizerLoop="barchart";const o=()=>{if(this.selectedVisualizer!=="barchart"){this.stopVisualizerAnimation();return}const c=this.getMasterPunchcardContext();if(!c){this.stopVisualizerAnimation();return}this.hideMasterPunchcardPlaceholder(),this.masterPunchcardCanvas.style.display="block",this.sizeCanvasToContainer(e,c),i.getByteFrequencyData(this.spectrumDataArray);const u=window.devicePixelRatio||1,h=e.width/u,d=e.height/u;c.fillStyle="rgba(5, 6, 10, 0.92)",c.fillRect(0,0,h,d);const f=Math.min(200,Math.floor(h/2)),m=[];for(let y=0;y<this.spectrumDataArray.length;y++){const b=y/this.spectrumDataArray.length*a;if(b>=20&&b<=2e4){const P=Sc(b),M=this.spectrumDataArray[y]/255;m.push({position:P,value:M,frequency:b})}}m.sort((y,b)=>y.position-b.position);const g=h/f;for(let y=0;y<f;y++){const b=y/f,P=1/f,M=b<.3?P*4:b<.6?P*2:P,v=m.filter(q=>Math.abs(q.position-b)<M);let C=v.length>0?Math.max(...v.map(q=>q.value)):0;if(C===0&&m.length>0){let q=0,X=1/0;for(const j of m){const H=Math.abs(j.position-b);if(H<X)X=H,q=j.value;else if(H>X)break}C=q}const E=Math.max(C*d,2),A=b*h,B=d-E,Z=c.createLinearGradient(A,B,A,d);Z.addColorStop(0,"rgba(56, 189, 248, 0.95)"),Z.addColorStop(1,"rgba(14, 116, 144, 0.75)"),c.fillStyle=Z,c.fillRect(A,B,g+1,E)}this.barchartAnimationFrame=requestAnimationFrame(o)};o()}teardownExternalVisualizerCanvas(){this.externalVisualizerObserver&&(this.externalVisualizerObserver.disconnect(),this.externalVisualizerObserver=null),this.externalVisualizerCanvas&&this.externalVisualizerCanvas.parentNode&&this.externalVisualizerCanvas.remove(),this.externalVisualizerCanvas=null,this.externalVisualizerType=null,this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="")}attachExternalVisualizerCanvas(e){return!e||!this.masterPunchcardContainer?!1:(this.masterPunchcardCanvas.style.display="none",this.hideMasterPunchcardPlaceholder(),this.masterPunchcardContainer.style.position===""&&(this.masterPunchcardContainer.style.position="relative"),e.dataset.visualizerAttached="true",e.style.position="relative",e.style.left="0",e.style.top="0",e.style.pointerEvents="auto",this.sizeCanvasToContainer(e,e.getContext("2d")),this.masterPunchcardContainer.appendChild(e),this.externalVisualizerCanvas=e,!0)}watchForExternalVisualizerCanvas(e){const t=()=>{const i=this.findExternalVisualizerCanvasCandidate(e);return i?this.attachExternalVisualizerCanvas(i):!1};t()||(this.externalVisualizerObserver=new MutationObserver(()=>{t()&&this.externalVisualizerObserver&&(this.externalVisualizerObserver.disconnect(),this.externalVisualizerObserver=null)}),this.externalVisualizerObserver.observe(document.body,{childList:!0,subtree:!0}))}findExternalVisualizerCanvasCandidate(e){const t=Array.from(document.querySelectorAll("canvas"));for(const i of t)if(i!==this.masterPunchcardCanvas&&i.dataset.visualizerAttached!=="true"&&(e==="pianoroll"&&this.isPianorollCanvas(i)||e==="scope"&&this.isScopeCanvas(i)||e==="spectrum"&&this.isSpectrumCanvas(i)))return i;return null}isPianorollCanvas(e){if(!e)return!1;if(e.dataset.pianoroll!==void 0)return!0;const t=e.className||"";if(/pianoroll/i.test(t))return!0;const i=e.getBoundingClientRect();return i.width===0||i.height===0?!1:i.width>window.innerWidth*.6&&i.height>window.innerHeight*.4}isScopeCanvas(e){if(!e)return!1;const t=(e.id||"").toLowerCase(),i=(e.className||"").toLowerCase();if(t.includes("scope")||i.includes("scope")||e.dataset.scope!==void 0)return!0;const s=e.getBoundingClientRect();return s.width>window.innerWidth*.5&&s.height<260}isSpectrumCanvas(e){if(!e)return!1;const t=(e.id||"").toLowerCase(),i=(e.className||"").toLowerCase();if(t.includes("spectrum")||i.includes("spectrum")||e.dataset.spectrum!==void 0)return!0;const s=e.getBoundingClientRect();return s.width>window.innerWidth*.5&&s.height<400}hideMasterPunchcardPlaceholder(){this.masterPunchcardPlaceholder&&this.masterPunchcardPlaceholder.classList.add("hidden")}shouldUseSpiralVisualizer(e){return e?/\.\s*_?spiral\s*\(/i.test(e):!1}shouldUseScopeVisualizer(e){return e?/\.\s*_?(?:t?scope)\s*\(/i.test(e):!1}shouldUseSpectrumVisualizer(e){return e?/\.\s*_?spectrum\s*\(/i.test(e):!1}shouldUsePitchwheelVisualizer(e){return e?/\.\s*_?pitchwheel\s*\(/i.test(e):!1}shouldUsePianorollVisualizer(e){return e?/\.\s*_?pianoroll\s*\(/i.test(e):!1}shouldUseBarchartVisualizer(e){return e?/\.\s*_?barchart\s*\(/i.test(e):!1}extractSpiralOptions(e){if(!e)return{};const t=e.match(/\.\s*_?spiral\s*\(\s*\{([^}]*)\}\s*\)/i);if(!t)return{};const i={};return t[1].split(",").forEach(r=>{const[a,o]=r.split(":");if(!a||!o)return;const l=a.trim(),c=o.trim(),u=Number(c.replace(/[^0-9.+-eE]/g,""));Number.isNaN(u)?/true|false/i.test(c)?i[l]=/^true$/i.test(c):i[l]=c.replace(/['"]/g,""):i[l]=u}),i}getMasterPunchcardContext(){if(!this.masterPunchcardCanvas)return null;if(!this.masterPunchcardCtx)try{this.masterPunchcardCtx=mu(this.masterPunchcardCanvas.id,{contextType:"2d"})}catch(e){console.warn("⚠️ Falling back to native canvas context:",e),this.masterPunchcardCtx=this.masterPunchcardCanvas.getContext("2d")}return this.masterPunchcardCtx}drawMasterPunchcardCanvas(e,t){const i=this.masterPunchcardCanvas,s=this.getMasterPunchcardContext();if(!i||!s)return;const r=this.masterPunchcardContainer.getBoundingClientRect(),a=Math.max(r.width||this.masterPunchcardContainer.offsetWidth||600,240),o=Math.max(r.height||this.masterPunchcardContainer.offsetHeight||200,200),l=window.devicePixelRatio||1;(i.width!==a*l||i.height!==o*l)&&(i.width=a*l,i.height=o*l,i.style.width=`${a}px`,i.style.height=`${o}px`),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height),s.save(),s.setTransform(l,0,0,l,0,0);const c=16,u=a-c*2,h=o-c*3,d=c,f=o-c*1.5,m=s.createLinearGradient(0,0,a,o);m.addColorStop(0,"rgba(102, 126, 234, 0.06)"),m.addColorStop(1,"rgba(118, 75, 162, 0.08)"),s.fillStyle=m,s.fillRect(0,0,a,o);const{counts:g,hits:y}=t,{totalSteps:b,stepsPerBeat:P}=e;g.length!==b&&console.warn("⚠️ Punchcard data length mismatch",{expected:b,received:g.length});const M=Math.max(...g,1e-4),v=u/b;s.strokeStyle="rgba(102, 126, 234, 0.25)",s.lineWidth=1,s.beginPath();for(let C=0;C<=b;C+=P){const E=d+C*v;s.moveTo(E,f),s.lineTo(E,f-h)}s.stroke(),g.forEach((C,E)=>{const A=Math.max(C/M,0),B=h*A,Z=d+E*v,q=f-B;if(B<=2){s.fillStyle="rgba(148, 163, 184, 0.35)",s.fillRect(Z+v*.3,f-3,v*.4,3);return}const X=s.createLinearGradient(Z,q,Z,f);X.addColorStop(0,"rgba(102, 126, 234, 0.9)"),X.addColorStop(1,"rgba(118, 75, 162, 0.85)"),s.fillStyle=X;const j=Z+v*.2,H=v*.6,se=Math.min(v*.3,8);typeof s.roundRect=="function"?(s.beginPath(),s.roundRect(j,q,H,B,se),s.fill()):s.fillRect(j,q,H,B);const oe=y==null?void 0:y[E];if(oe&&oe.length){s.fillStyle="rgba(26, 32, 44, 0.75)",s.font='10px "Fira Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',s.textAlign="center",s.textBaseline="bottom";const Pe=oe.slice(0,2).join(" • ");s.fillText(Pe,Z+v/2,q-4)}}),s.strokeStyle="rgba(79, 70, 229, 0.55)",s.lineWidth=1.5,s.beginPath(),s.moveTo(d,f),s.lineTo(d+u,f),s.stroke(),s.restore()}renderMasterSpiral(e,t,i={}){if(!this.masterPunchcardContainer||!this.masterPunchcardCanvas)return;const s=t.events||[];if(!s.length){this.showMasterPunchcardPlaceholder();return}this.hideMasterPunchcardPlaceholder(),this.drawMasterSpiralCanvas(e,s,i)}drawMasterSpiralCanvas(e,t,i={}){const s=this.masterPunchcardCanvas,r=this.getMasterPunchcardContext();if(!s||!r)return;const a=this.masterPunchcardContainer.getBoundingClientRect(),o=Math.max(a.width||this.masterPunchcardContainer.offsetWidth||320,240),l=Math.max(a.height||this.masterPunchcardContainer.offsetHeight||240,220),c=window.devicePixelRatio||1;(s.width!==o*c||s.height!==l*c)&&(s.width=o*c,s.height=l*c,s.style.width=`${o}px`,s.style.height=`${l}px`),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,s.width,s.height),r.save(),r.setTransform(c,0,0,c,0,0);const u=Number.isFinite(i.padding)?i.padding:32,h=Number.isFinite(i.inset)?i.inset:3,d=Number.isFinite(i.stretch)?i.stretch:1,f=Number.isFinite(i.rotations)?i.rotations:Math.max(e.numerator??4,4),m=Number.isFinite(i.steady)?i.steady:.9,g=Number.isFinite(i.thickness)?i.thickness:6,y=typeof i.cap=="string"?i.cap:"round",b=r.createLinearGradient(0,0,o,l);b.addColorStop(0,"rgba(102, 126, 234, 0.08)"),b.addColorStop(1,"rgba(118, 75, 162, 0.12)"),r.fillStyle=b,r.fillRect(0,0,o,l);const P=o/2,M=l/2,C=Math.max(Math.min(o,l)/2-u,40)/Math.max(f+h+1,1),A=m*0,B={margin:C,cx:P,cy:M,stretch:d,cap:y,thickness:g},Z="rgba(76, 81, 191, 0.85)",q="rgba(148, 163, 184, 0.35)",X=Math.max(...t.map(se=>se.weight??1),1),j=f;t.forEach(se=>{const oe=Number.isFinite(se.begin)?se.begin:0,Pe=Number.isFinite(se.endClipped)?se.endClipped:Number.isFinite(se.end)?se.end:oe,Me=Number.isFinite(se.weight)?Math.max(se.weight,.1):1,Be=se.color||Z,Ke=h+oe*j,Ct=h+Math.max(Pe,oe)*j;Og(r,{...B,from:Ke,to:Ct,rotate:A,thickness:B.thickness*(.6+Me/X*.8),color:Be})});const H=h+j+1;Og(r,{...B,from:h,to:H,rotate:A,color:q,thickness:B.thickness*.6,fromOpacity:.35,toOpacity:.1}),r.restore()}async computeMasterPunchcardData(e,t){try{V.strudelLoaded||await V.initStrudel()}catch(P){return console.warn("⚠️ Unable to initialize Strudel for punchcard:",P),{error:"Strudel is not ready yet."}}if(!window.strudel||typeof window.strudel.evaluate!="function")return{error:"Strudel evaluate function is unavailable."};let i=e;console.log("═══════════════════════════════════════════════════════════"),console.log("🔍 PUNCHCARD EVALUATION - Original pattern:"),console.log("   Full pattern:",i),console.log("───────────────────────────────────────────────────────────"),i=i.replace(/\/\/.*$/gm,""),i=i.replace(/\/\*[\s\S]*?\*\//g,""),i=i.replace(/\n\s*\n/g,`
`).trim(),i=i.replace(/\)\s*\.\s*\((gain|pan)\s*\(/g,").$1("),/\)\s*\.\s*(gain|pan)\s*\(/.test(i)||(i=i.replace(/([a-zA-Z_$][a-zA-Z0-9_$]*\s*\([^()]*\)(?:\s*\.\s*[a-zA-Z_$][a-zA-Z0-9_$]*\s*\([^()]*\))*)\s*\.\s*(gain|pan)\s*\(/g,(P,M,v)=>M.trim().startsWith("(")?P:`(${M}).${v}(`)),console.log("🔍 PUNCHCARD EVALUATION - After removing comments and fixing modifiers:"),console.log("   Pattern:",i),console.log("───────────────────────────────────────────────────────────");const r=(P,M)=>{let v=1;for(let C=M+1;C<P.length;C++)if(P[C]==="(")v++;else if(P[C]===")"&&(v--,v===0))return C;return-1},a=["scope","tscope","fscope","spectrum","visual","spiral"];if(a.forEach(P=>{const M=new RegExp(`\\.\\s*_?${P}\\s*\\(`,"gi");let v,C=0;for(;(v=M.exec(i))!==null;){const E=v.index,A=v.index+v[0].length-1,B=r(i,A);if(B!==-1)i=i.substring(0,E)+i.substring(B+1),C++,console.log(`  Stripped .${P}(...) occurrence #${C}`),M.lastIndex=0;else{console.warn(`  Could not find matching ) for .${P}( at position ${A}`);break}}}),i=i.trim(),i=i.replace(/\.\s*$/,"").replace(/\.\.+/g,".").trim(),console.log("🔍 PUNCHCARD EVALUATION - After stripping:"),console.log("   Stripped pattern:",i),console.log("───────────────────────────────────────────────────────────"),!i||i.trim()==="")return console.warn("⚠️ Pattern is empty after stripping visualizers"),{error:"Pattern is empty after removing visualizers."};if(a.some(P=>new RegExp(`\\.\\s*_?${P}\\s*\\(`,"i").test(i)))return console.warn("═══════════════════════════════════════════════════════════"),console.warn("⚠️ PUNCHCARD EVALUATION - FAILED TO STRIP VISUALIZERS"),console.warn("   Pattern still contains visualizers after stripping:"),console.warn("   ",i),console.warn("   This will cause Mini parser errors. Skipping punchcard evaluation."),console.warn("═══════════════════════════════════════════════════════════"),{error:"Pattern contains visualizers that could not be stripped."};if(console.log("✅ PUNCHCARD EVALUATION - Ready to evaluate (no visualizers detected)"),console.log("═══════════════════════════════════════════════════════════"),!i||i.trim()==="")return console.warn("⚠️ Pattern is empty after stripping - cannot evaluate"),{error:"Pattern is empty after processing"};console.log("📝 Final pattern to evaluate:",i);try{await V.ensurePatternResourcesLoaded(i)}catch(P){console.warn("⚠️ Unable to preload resources for punchcard evaluation:",P)}const l=P=>{if(P==null)return 0;if(typeof P=="number")return P;if(typeof P.valueOf=="function"){const v=P.valueOf();if(typeof v=="number"&&!Number.isNaN(v))return v}if(typeof P=="object"&&P!==null&&"n"in P&&"d"in P){const v=Number(P.n??0),C=Number(P.d??1);return C!==0?v/C:0}const M=Number(P);return Number.isFinite(M)?M:0},c=P=>P?typeof P=="string"?P:P.label?P.label:P.sample?P.sample:P.s?P.s:P.note?P.note:P.n?P.n:P.sound?P.sound:P.instrument?P.instrument:null:null;let u;try{const P=await Hb(i,k$,{wrapAsync:!1,addReturn:!1,emitMiniLocations:!1});u=P==null?void 0:P.pattern,console.log("🔍 Evaluated pattern object:",u)}catch(P){return console.error("❌ Failed to evaluate pattern for punchcard:",P),{error:(P==null?void 0:P.message)||"Pattern evaluation failed."}}if(!u&&window.strudel&&typeof window.strudel.evaluate=="function"){console.log("🔁 strudelCoreEvaluate returned no pattern - attempting fallback via window.strudel.evaluate");try{const P=`globalThis.__punchcard_pattern = ${i}`;console.log("🔍 Fallback evaluation code:",P.substring(0,200));const M=await window.strudel.evaluate(P);if(globalThis.__punchcard_pattern)u=globalThis.__punchcard_pattern,console.log("🔍 Fallback pattern object from globalThis:",u);else if(M&&typeof M.queryArc=="function")u=M,console.log("🔍 Fallback pattern object from eval result:",u);else if(M&&M._Pattern)u=M,console.log("🔍 Fallback pattern object (has _Pattern):",u);else{const v=await window.strudel.evaluate(i);v&&(typeof v.queryArc=="function"||v._Pattern)&&(u=v,console.log("🔍 Fallback pattern object from direct eval:",u))}}catch(P){console.warn("⚠️ Fallback evaluation failed:",P),console.warn("⚠️ Pattern that failed:",i.substring(0,200))}}if(!(u&&(typeof u.queryArc=="function"||typeof u.query=="function"||u._Pattern===!0))){if(console.warn("⚠️ Pattern did not return a valid Strudel pattern object"),console.warn("⚠️ Pattern object type:",typeof u),console.warn("⚠️ Pattern object:",u),console.warn("⚠️ Pattern that failed:",i.substring(0,300)),window.strudel&&typeof window.strudel.evaluate=="function")try{const M=`(${i})`,v=await window.strudel.evaluate(M);v&&(typeof v.queryArc=="function"||typeof v.query=="function"||v._Pattern===!0)&&(u=v,console.log("✅ Last attempt succeeded with wrapped pattern"))}catch(M){console.warn("⚠️ Last attempt also failed:",M)}if(!(u&&(typeof u.queryArc=="function"||typeof u.query=="function"||u._Pattern===!0)))return{error:"Pattern expression did not return a Strudel pattern."}}let d;try{if(typeof u.queryArc=="function")d=u.queryArc(0,1)||[];else if(typeof u.query=="function")d=u.query(0,1)||[];else if(u.__steps&&typeof u.__steps=="object")d=[],console.warn("⚠️ Pattern has _Pattern but no queryArc/query - attempting to extract haps from __steps");else throw new Error("Pattern object does not have queryArc, query, or __steps")}catch(P){return console.error("❌ Failed to query pattern arc for punchcard:",P),{error:(P==null?void 0:P.message)||"Pattern queryArc failed."}}try{delete globalThis.__punchcard_pattern}catch{globalThis.__punchcard_pattern=void 0}const f={events:d.map(P=>{const M=P==null?void 0:P.part,v=P==null?void 0:P.whole,C=l(M?M.begin??M.start??0:(v==null?void 0:v.begin)??0);let E=l(M?M.end??M.finish??M.begin??0:(v==null?void 0:v.end)??(v==null?void 0:v.begin)??0);(!Number.isFinite(E)||E<C)&&(E=C);const A=(P==null?void 0:P.value)??null,B=c(A),Z=A&&typeof A=="object"?A.note??A.n??null:null,q=A&&typeof A=="object"?A.sound??A.s??null:null,X=A&&typeof A=="object"?A.sample??null:null,j=A&&typeof A=="object"?A.instrument??null:null,H=A&&typeof A=="object"?A.source??A.path??null:null,se=typeof A=="string"?A:null,oe=A&&typeof A=="object"&&A.velocity!=null?Number(A.velocity):1,Pe=A&&typeof A=="object"&&A.gain!=null?Number(A.gain):1,Me=(Number.isFinite(oe)?oe:1)*(Number.isFinite(Pe)?Pe:1);return{begin:C,end:E,endClipped:l((P==null?void 0:P.endClipped)??E),wholeBegin:l((v==null?void 0:v.begin)??C),wholeEnd:l((v==null?void 0:v.end)??E),label:B,weight:Number.isFinite(Me)&&Me>0?Me:1,color:A&&typeof A=="object"&&A.color?A.color:null,tags:Array.isArray(P==null?void 0:P.tags)?P.tags:[],meta:{label:B,note:Z,sound:q,sample:X,instrument:j,source:H,rawString:se}}})};if(!f||f.error)return console.warn("⚠️ Parsed result has error:",f==null?void 0:f.error),{error:(f==null?void 0:f.error)||"Unknown error from Strudel evaluation."};const{totalSteps:m}=t,g=new Array(m).fill(0),y=new Array(m).fill(null).map(()=>[]),b=f.events||[];return b.forEach(P=>{if(!P)return;const{begin:M,end:v,endClipped:C,label:E,weight:A}=P,B=(Number(M)%1+1)%1,Z=Number.isFinite(C)?C:v;let q=(Number(Z)%1+1)%1;(!Number.isFinite(q)||q<B)&&(q=B);const X=Math.min(m-1,Math.max(0,Math.floor(B*m))),j=Math.min(m-1,Math.max(X,Math.ceil(q*m)-1)),H=Number.isFinite(A)?Math.max(A,.1):1;for(let se=X;se<=j;se+=1)if(g[se]+=H,E){const oe=y[se];oe.includes(E)||oe.push(E)}}),{counts:g,hits:y,events:b}}enableNativeStrudelHighlighting(e=500){if(this.nativeHighlightingEnabled||this.nativeHighlightingDisabled)return;const t=(globalThis==null?void 0:globalThis.Strudel)||(globalThis==null?void 0:globalThis.strudel)||(window==null?void 0:window.Strudel)||(window==null?void 0:window.strudel),i=t&&typeof t.enableHighlighting=="function"?t.enableHighlighting:null;if(i)try{i.call(t),this.nativeHighlightingEnabled=!0,this.nativeHighlightRetryCount=0,this.nativeHighlightRetryTimer&&(clearTimeout(this.nativeHighlightRetryTimer),this.nativeHighlightRetryTimer=null),console.log("✅ Enabled Strudel.enableHighlighting()");return}catch(r){console.warn("⚠️ Strudel.enableHighlighting() failed:",r),this.nativeHighlightingDisabled=!0;return}if(this.nativeHighlightRetryTimer)return;if(this.nativeHighlightRetryCount>=5){console.warn("⚠️ Strudel.enableHighlighting() unavailable; falling back without editor highlights."),this.nativeHighlightingDisabled=!0,this.nativeHighlightRetryCount=0;return}this.nativeHighlightRetryCount+=1;const s=Math.min(e*2,4e3);this.nativeHighlightRetryTimer=setTimeout(()=>{this.nativeHighlightRetryTimer=null,this.enableNativeStrudelHighlighting(s)},s)}updateMasterPatternDisplay(){if(!this.masterPatternField)return;const e=V.getMasterPatternCode();e&&e.trim()!==""?(Mt("master-pattern",e),this.masterPatternField.placeholder="",console.log(`📝 Updated master pattern display: ${e.substring(0,100)}...`)):(Mt("master-pattern",""),this.masterPatternField.placeholder="Combined pattern will appear here...")}updateMasterIndicators(){zt.elements.forEach(e=>{const t=e.id,i=document.querySelector(`[data-sound-id="${t}"]`);if(i){const s=i.querySelector(".master-status-indicator");s&&(V.trackedPatterns.has(t)?s.classList.add("active"):s.classList.remove("active"))}})}registerElements(e=null){(e||zt.elements.map(i=>{const s=document.querySelector(i.selector);return s?{element:s,elementId:i.id}:null}).filter(i=>i!==null)).forEach(({element:i,elementId:s})=>{i&&(i.getAttribute("data-sound-id"),i.addEventListener("click",r=>{if(r.target.classList.contains("config-button")||r.target.classList.contains("pause-button")||r.target.classList.contains("solo-button")||r.target.classList.contains("mute-button")||r.target.classList.contains("gain-slider")||r.target.classList.contains("pan-slider")||r.target.classList.contains("collapsible-toggle")||r.target.classList.contains("collapsible-content")||r.target.classList.contains("effect-slider")||r.target.classList.contains("filter-slider")||r.target.closest(".collapsible-section"))return;const a=i.getAttribute("data-sound-id");console.log(`🖱️ Click triggered for ${a}`),this.activeElements.has(a)?this.deactivateElement(a,i,"click"):this.activateElement(a,i,"click")}))})}setupElementControls(){zt.elements.forEach(e=>{const t=document.querySelector(e.selector);if(!t)return;const i=e.id,s=t.querySelector(".gain-slider"),r=t.querySelector(".pan-slider");if(s){const c=parseFloat(s.value);V.setElementGain(i,c),s.addEventListener("input",u=>{u.stopPropagation();const h=parseFloat(u.target.value);V.setElementGain(i,h),V.updateTrackedElementGain(i,h),this.updateMasterPatternDisplay()})}if(r){const c=parseFloat(r.value);V.setElementPan(i,c),r.addEventListener("input",u=>{u.stopPropagation();const h=parseFloat(u.target.value);V.setElementPan(i,h),V.updateTrackedElementPan(i,h),this.updateMasterPatternDisplay()})}const a=t.querySelector(".pause-button");a&&a.addEventListener("click",async c=>{c.stopPropagation(),await this.handlePauseButton(i)});const o=t.querySelector(".solo-button");o&&o.addEventListener("click",c=>{c.stopPropagation(),this.handleSoloButton(i,o)});const l=t.querySelector(".mute-button");l&&l.addEventListener("click",c=>{c.stopPropagation(),this.handleMuteButton(i,l)}),this.setupCollapsibleSections(t,i)})}setupCollapsibleSections(e,t){if(!e||!t){console.warn("⚠️ setupCollapsibleSections: Invalid element or elementId",{element:e,elementId:t});return}const i=e.querySelectorAll(".collapsible-toggle");console.log(`🎛️ Setting up collapsible sections for ${t}: ${i.length} toggle buttons found`),i.forEach(s=>{s.addEventListener("click",r=>{r.stopPropagation(),s.classList.toggle("active");const a=s.nextElementSibling;a&&a.classList.contains("collapsible-content")&&a.classList.toggle("active")})}),this.setupFilterDropdowns(e,t),this.setupEffectsDropdowns(e,t),this.setupSynthesisDropdowns(e,t)}setupFilterDropdowns(e,t){const i=e.querySelector(".filters-content");if(!i)return;i.innerHTML="",[{key:"hpf",label:"HPF",params:[{key:"hpf",label:"Frequency",unit:"Hz"},{key:"hpq",label:"HPQ",unit:""}]},{key:"lpf",label:"LPF",params:[{key:"lpf",label:"Frequency",unit:"Hz"},{key:"lpq",label:"LPQ",unit:""}]},{key:"bpf",label:"BPF",params:[{key:"bpf",label:"Frequency",unit:"Hz"},{key:"bpq",label:"Q",unit:""}]}].forEach((r,a)=>{const o=document.createElement("div");o.className="filter-collapsible-row";const c={hpf:"snippet-group-filters-hp",lpf:"snippet-group-filters-lp",bpf:"snippet-group-filters-bp"}[r.key]||"";o.innerHTML=`
        <button class="filter-toggle ${c}" data-filter-key="${r.key}">
          <span class="toggle-icon">▶</span> ${r.label}
        </button>
        <div class="filter-sliders-container" style="display: none;">
          <!-- Sliders will be added here -->
        </div>
      `,i.appendChild(o);const u=o.querySelector(".filter-toggle"),h=o.querySelector(".filter-sliders-container");u.addEventListener("click",d=>{d.stopPropagation(),u.classList.toggle("active");const f=u.classList.contains("active");h.style.display=f?"block":"none";const m=u.querySelector(".toggle-icon");m.textContent=f?"▼":"▶",f&&h.children.length===0&&r.params.forEach(g=>{const y=Yi[g.key];if(!y)return;let b=y.default.toString();g.key==="bpg"&&g.unit==="dB"?b=`${y.default>=0?"+":""}${y.default.toFixed(1)} dB`:g.unit&&(b=`${y.default}${g.unit?" "+g.unit:""}`);const P=document.createElement("div");P.className="slider-row",P.innerHTML=`
              <div class="slider-label-row">
                <label>${g.label}</label>
                <span class="slider-value">${b}</span>
              </div>
              <input type="range" class="filter-slider" data-filter-type="${r.key}" data-param-key="${g.key}" 
                     min="${y.min}" max="${y.max}" step="${y.step}" 
                     value="${y.default}" />
            `,h.appendChild(P);const M=P.querySelector(".filter-slider");M&&!M.dataset.hasListener&&(M.dataset.hasListener="true",M.addEventListener("input",async v=>{const C=parseFloat(v.target.value),E=P.querySelector(".slider-value");if(E)if(g.key.includes("f"))E.textContent=Math.round(C)+" Hz";else if(g.key==="bpg"&&g.unit==="dB"){const A=C>=0?"+":"";E.textContent=`${A}${C.toFixed(1)} dB`}else E.textContent=C.toFixed(1)+(g.unit?" "+g.unit:"");await this.updateElementFilters(t)}))})})})}setupEffectsDropdowns(e,t){const i=e.querySelector(".effects-content");if(!i)return;i.innerHTML="",[{key:"delay",label:"Delay",params:[{key:"delay",label:"Delay Mix"},{key:"delayfeedback",label:"Delay Feedback"},{key:"delaytime",label:"Delay Time"}]},{key:"room",label:"Reverb",params:[{key:"room",label:"Room Mix"},{key:"roomsize",label:"Room Size"},{key:"roomlp",label:"Low-pass"},{key:"roomdim",label:"Dimension"},{key:"roomfade",label:"Fade"},{key:"iresponse",label:"Impulse Response"}]}].forEach(r=>{const a=document.createElement("div");a.className="effect-collapsible-row";const l={delay:"snippet-group-delay",room:"snippet-group-reverb"}[r.key]||"";a.innerHTML=`
        <button class="effect-toggle ${l}" data-effect-key="${r.key}">
          <span class="toggle-icon">▶</span> ${r.label}
        </button>
        <div class="effect-sliders-container" style="display: none;">
          <!-- Sliders will be added here -->
        </div>
      `,i.appendChild(a);const c=a.querySelector(".effect-toggle"),u=a.querySelector(".effect-sliders-container");c.addEventListener("click",async h=>{h.stopPropagation(),c.classList.toggle("active");const d=c.classList.contains("active");u.style.display=d?"block":"none";const f=c.querySelector(".toggle-icon");f.textContent=d?"▼":"▶",d&&u.children.length===0&&r.params.forEach(m=>{const g=Yi[m.key];if(!g)return;const y=document.createElement("div");y.className="slider-row",y.innerHTML=`
              <div class="slider-label-row">
                <label>${m.label}</label>
                <span class="slider-value">${g.default.toFixed(2)}${g.unit?" "+g.unit:""}</span>
              </div>
              <input type="range" class="effect-slider" data-effect-key="${m.key}" 
                     min="${g.min}" max="${g.max}" step="${g.step}" 
                     value="${g.default}" />
            `,u.appendChild(y);const b=y.querySelector(".effect-slider");b&&!b.dataset.hasListener&&(b.dataset.hasListener="true",b.addEventListener("input",async P=>{const M=parseFloat(P.target.value),v=y.querySelector(".slider-value");v&&(v.textContent=M.toFixed(2)+(g.unit?" "+g.unit:"")),await this.updateElementEffects(t)}))}),await this.updateElementEffects(t)})})}setupSynthesisDropdowns(e,t){const i=e.querySelector(".synthesis-content");if(!i)return;i.innerHTML="";const s=document.createElement("div");s.className="synthesis-sliders-container",[{key:"attack",label:"Attack",min:0,max:2,step:.01,default:.01,unit:"s"},{key:"decay",label:"Decay",min:0,max:2,step:.01,default:.1,unit:"s"},{key:"sustain",label:"Sustain",min:0,max:1,step:.01,default:.5,unit:""},{key:"release",label:"Release",min:0,max:5,step:.01,default:.1,unit:"s"}].forEach(a=>{const o=document.createElement("div");o.className="slider-row",o.innerHTML=`
        <div class="slider-label-row">
          <label>${a.label}</label>
          <span class="slider-value">${a.default.toFixed(2)}${a.unit?" "+a.unit:""}</span>
        </div>
        <input type="range" class="synth-slider ${a.key}-slider" 
               min="${a.min}" max="${a.max}" step="${a.step}" 
               value="${a.default}" />
      `,s.appendChild(o);const l=o.querySelector(".synth-slider");l&&!l.dataset.hasListener&&(l.dataset.hasListener="true",l.addEventListener("input",async c=>{const u=parseFloat(c.target.value),h=o.querySelector(".slider-value");h&&(h.textContent=u.toFixed(2)+(a.unit?" "+a.unit:"")),await this.updateElementSynthesis(t)}))}),i.appendChild(s)}async updateElementEffects(e){const t=document.querySelector(`[data-sound-id="${e}"]`);if(!t)return;const i=t.querySelectorAll(".effect-collapsible-row"),s={};i.forEach(a=>{const l=a.querySelector(".effect-toggle").classList.contains("active"),c=a.querySelectorAll(".effect-slider");l&&c.length>0&&c.forEach(u=>{const h=u.dataset.effectKey;h&&(s[h]=parseFloat(u.value))})}),this.elementEffects||(this.elementEffects={}),this.elementEffects[e]=s,console.log(`🎛️ Effects updated for ${e}:`,this.elementEffects[e]),this._effectsApplyTimers=this._effectsApplyTimers||new Map,this._effectsApplyTimers.has(e)&&clearTimeout(this._effectsApplyTimers.get(e));const r=setTimeout(()=>{this.applyEffectsAndFiltersToPattern(e),this._effectsApplyTimers.delete(e)},150);this._effectsApplyTimers.set(e,r)}async updateElementFilters(e){const t=document.querySelector(`[data-sound-id="${e}"]`);if(!t)return;const i=t.querySelectorAll(".filter-collapsible-row"),s={};i.forEach(a=>{const l=a.querySelector(".filter-toggle").classList.contains("active"),c=a.querySelectorAll(".filter-slider");l&&c.length>0&&c.forEach(u=>{const h=u.dataset.paramKey;h&&(s[h]=parseFloat(u.value))})}),this.elementFilters||(this.elementFilters={}),this.elementFilters[e]=s,console.log(`🔊 Filters updated for ${e}:`,this.elementFilters[e]),this._filtersApplyTimers=this._filtersApplyTimers||new Map,this._filtersApplyTimers.has(e)&&clearTimeout(this._filtersApplyTimers.get(e));const r=setTimeout(()=>{this.applyEffectsAndFiltersToPattern(e),this._filtersApplyTimers.delete(e)},150);this._filtersApplyTimers.set(e,r)}async updateElementSynthesis(e){const t=document.querySelector(`[data-sound-id="${e}"]`);if(!t)return;const i=t.querySelector(".attack-slider"),s=t.querySelector(".decay-slider"),r=t.querySelector(".sustain-slider"),a=t.querySelector(".release-slider"),o=i?parseFloat(i.value):.01,l=s?parseFloat(s.value):.1,c=r?parseFloat(r.value):.5,u=a?parseFloat(a.value):.1;this.elementSynthesis||(this.elementSynthesis={}),this.elementSynthesis[e]={attack:o,decay:l,sustain:c,release:u},console.log(`🎹 Synthesis updated for ${e}:`,this.elementSynthesis[e]),this._synthApplyTimers=this._synthApplyTimers||new Map,this._synthApplyTimers.has(e)&&clearTimeout(this._synthApplyTimers.get(e));const h=setTimeout(()=>{this.applyEffectsAndFiltersToPattern(e),this._synthApplyTimers.delete(e)},150);this._synthApplyTimers.set(e,h)}getPatternWithEffects(e,t){var c,u,h;if(!t)return t;const i=((c=this.elementEffects)==null?void 0:c[e])||{},s=((u=this.elementFilters)==null?void 0:u[e])||{},r=((h=this.elementSynthesis)==null?void 0:h[e])||{},a=(d,f)=>{if(f===void 0)return!1;const m=Yi[d];return m?f!==m.default:!0},o=(d,f)=>{if(f===void 0)return"";const m=Yi[d];return(m==null?void 0:m.unit)==="Hz"||d==="roomlp"?Math.round(f):f.toFixed(2)};let l=[];return a("delay",i.delay)&&l.push(`.delay(${o("delay",i.delay)})`),a("delayfeedback",i.delayfeedback)&&l.push(`.delayfeedback(${o("delayfeedback",i.delayfeedback)})`),a("delaytime",i.delaytime)&&l.push(`.delaytime(${o("delaytime",i.delaytime)})`),a("room",i.room)&&l.push(`.room(${o("room",i.room)})`),a("roomsize",i.roomsize)&&l.push(`.roomsize(${o("roomsize",i.roomsize)})`),a("roomlp",i.roomlp)&&i.roomlp<Yi.roomlp.default&&l.push(`.roomlp(${o("roomlp",i.roomlp)})`),a("roomdim",i.roomdim)&&l.push(`.roomdim(${o("roomdim",i.roomdim)})`),a("roomfade",i.roomfade)&&l.push(`.roomfade(${o("roomfade",i.roomfade)})`),a("iresponse",i.iresponse)&&l.push(`.iresponse(${o("iresponse",i.iresponse)})`),s.lpf!==void 0&&s.lpf<2e4&&l.push(`.lpf(${Math.round(s.lpf)})`),s.hpf!==void 0&&s.hpf>20&&l.push(`.hpf(${Math.round(s.hpf)})`),s.bpf!==void 0&&l.push(`.bpf(${Math.round(s.bpf)})`),s.bpq!==void 0&&s.bpq>0&&l.push(`.bpq(${s.bpq.toFixed(1)})`),s.lpq!==void 0&&s.lpq>0&&l.push(`.lpq(${s.lpq.toFixed(1)})`),s.hpq!==void 0&&s.hpq>0&&l.push(`.hpq(${s.hpq.toFixed(1)})`),r.attack!==void 0&&r.attack!==.01&&l.push(`.attack(${r.attack.toFixed(2)})`),r.decay!==void 0&&r.decay!==.1&&l.push(`.decay(${r.decay.toFixed(2)})`),r.sustain!==void 0&&r.sustain!==.5&&l.push(`.sustain(${r.sustain.toFixed(2)})`),r.release!==void 0&&r.release!==.1&&l.push(`.release(${r.release.toFixed(2)})`),l.length>0?t+l.join(""):t}async applyEffectsAndFiltersToPattern(e){const t=this.loadElementConfig(e);if(!t||!t.pattern)return;const i=t.pattern,s=this.getPatternWithEffects(e,i);s!==i&&console.log(`🎚️ Applying effects/filters/synthesis to ${e}: ${s}`),V.trackedPatterns&&V.trackedPatterns.has(e)?(await V.updatePatternInPlace(e,s,!0),this.updateMasterPatternDisplay()):V.isPlaying(e)||await V.cachePatternForElement(e,s)}applyChannelHistoryEntry(e,t){var r,a;if(!e||!t)return;const i=t.trim(),s=this.loadElementConfig(e)||{};Xn.markChannelSnapshot(e,i),this.saveElementConfig(e,{...s,pattern:i},!0),this.currentEditingElementId!==e&&this.openModal(e),setTimeout(()=>{Mt("modal-pattern",i)},50),(a=(r=this.uiController)==null?void 0:r.updateStatus)==null||a.call(r,`Loaded history for ${e}. Save to apply.`)}applyMasterHistoryEntry(e){var i,s;if(!e)return;const t=e.trim();Mt("master-pattern",t),V.masterPattern=t,Xn.markMasterSnapshot(t),this.updateMasterPatternDisplay(),(s=(i=this.uiController)==null?void 0:i.updateStatus)==null||s.call(i,"Loaded master pattern history entry.")}async saveChannelWithEffects(e){var a,o,l,c;const t=this.loadElementConfig(e);if(!t||!t.pattern){(o=(a=this.uiController)==null?void 0:a.updateStatus)==null||o.call(a,"Nothing to save for this channel.");return}const i=this.getPatternWithEffects(e,t.pattern),{getCurrentUser:s}=await rn(async()=>{const{getCurrentUser:u}=await Promise.resolve().then(()=>rs);return{getCurrentUser:u}},void 0);if(await s()&&window.savePatternDialog)await window.savePatternDialog.show(i,"channel",e),window.savePatternDialog.setOnSave(async u=>{var d,f;const h={...t,pattern:i};this.saveElementConfig(e,h,!1),Xn.markChannelSnapshot(e,i),(f=(d=this.uiController)==null?void 0:d.updateStatus)==null||f.call(d,`Saved channel ${e} to cloud.`)});else{const u={...t,pattern:i};this.saveElementConfig(e,u,!1),Xn.markChannelSnapshot(e,i),(c=(l=this.uiController)==null?void 0:l.updateStatus)==null||c.call(l,`Saved channel ${e} locally.`)}}async saveMasterHistoryEntry(){var a,o,l,c;const e=document.getElementById("master-pattern"),i=((e?e.value:"")||"").trim();if(!i){(o=(a=this.uiController)==null?void 0:a.updateStatus)==null||o.call(a,"Master pattern is empty.");return}const{getCurrentUser:s}=await rn(async()=>{const{getCurrentUser:u}=await Promise.resolve().then(()=>rs);return{getCurrentUser:u}},void 0);await s()&&window.savePatternDialog?(await window.savePatternDialog.show(i,"master",null),window.savePatternDialog.setOnSave(async u=>{var h,d;Xn.saveMasterVersion(i),Xn.markMasterSnapshot(i),V.masterPattern=i,this.updateMasterPatternDisplay(),(d=(h=this.uiController)==null?void 0:h.updateStatus)==null||d.call(h,"Saved master pattern to cloud.")})):(Xn.saveMasterVersion(i),Xn.markMasterSnapshot(i),V.masterPattern=i,this.updateMasterPatternDisplay(),(c=(l=this.uiController)==null?void 0:l.updateStatus)==null||c.call(l,"Saved master pattern locally."))}updateSynthesisSectionVisibility(e,t){const i=document.querySelector(`[data-sound-id="${e}"]`);if(!i)return;const s=i.querySelector(".synthesis-section");if(!s)return;const r=Tc(t);mg(r)?(s.style.display="block",console.log(`🎹 Showing synthesis section for ${e} (synth pattern detected)`)):(s.style.display="none",console.log(`🎹 Hiding synthesis section for ${e} (not a synth pattern)`))}async handlePauseButton(e){const t=document.querySelector(`[data-sound-id="${e}"]`);if(!t)return;const i=t.querySelector(".element-indicator"),s=t.querySelector(".pause-button");(s==null?void 0:s.classList.contains("paused"))?(s==null||s.classList.remove("paused"),i==null||i.classList.remove("paused"),this.elementHasPattern(e)&&await V.triggerSound(e),console.log(`▶️ Resumed ${e}`)):(s==null||s.classList.add("paused"),i==null||i.classList.add("paused"),i==null||i.classList.remove("looped"),V.pauseSound(e),console.log(`⏸️ Paused ${e}`))}handleSoloButton(e,t){this.soloedElements.has(e)?(this.soloedElements.delete(e),t.classList.remove("active"),console.log(`🎵 Unsolo: ${e}`)):(this.soloedElements.add(e),t.classList.add("active"),console.log(`🎵 Solo: ${e}`)),this.updateElementAudioStates()}handleMuteButton(e,t){this.mutedElements.has(e)?(this.mutedElements.delete(e),t.classList.remove("active"),console.log(`🔊 Unmute: ${e}`)):(this.mutedElements.add(e),t.classList.add("active"),console.log(`🔇 Mute: ${e}`)),this.updateElementAudioStates()}updateElementAudioStates(){const e=this.soloedElements.size>0;zt.elements.forEach(t=>{const i=t.id,s=this.mutedElements.has(i),r=this.soloedElements.has(i);let a;s?a=0:e?a=r?1:0:a=1;const o=document.querySelector(`[data-sound-id="${i}"]`);if(o){const l=o.querySelector(".gain-slider"),c=l?parseFloat(l.value):.8;V.setElementGain(i,c*a)}}),V.updateMasterPattern(this.soloedElements,this.mutedElements),this.updateMasterPatternDisplay()}activateElement(e,t,i){if(console.log(`🎵 Activating ${e} via ${i}`),this.masterActive&&V.trackedPatterns.has(e)){console.log(`   ⚠️ Master is playing and ${e} is tracked - ignoring individual activation`),tn.updateStatus(`Cannot play ${e} individually while master is active. Stop master first.`);return}tn.setElementState(t,"focus"),this.updateStatusDots(e,this.elementHasPattern(e),!1),tn.updateStatus("Ready")}deactivateElement(e,t,i){if(console.log(`🔇 Deactivating ${e} (was triggered by ${i})`),this.activeElements.has(e)){this.activeElements.delete(e),console.log(`   Stopping sound for ${e}`),V.stopSound(e);const s=this.elementHasPattern(e);this.updateStatusDots(e,s,!1),tn.setElementState(t,null),this.updateActiveElementsDisplay(),this.activeElements.size===0&&tn.updateStatus("Ready")}}updateActiveElementsDisplay(){const e=Array.from(this.activeElements).map(i=>{const s=zt.getElementConfig(i);return(s==null?void 0:s.description)||i});tn.updateActiveElements(e);const t=document.getElementById("slots-info");if(t){const i=V.trackedPatterns?Array.from(V.trackedPatterns.keys()):[],s=new Set([...this.activeElements,...i]);if(s.size===0)t.textContent="None active";else{const r=Array.from(s).map(a=>{var f,m;const o=(f=V.strudelPatternSlots)==null?void 0:f.get(a),l=(m=V.trackedPatterns)==null?void 0:m.has(a),c=this.activeElements.has(a);let u="";try{const g=localStorage.getItem(`element-config-${a}`);g&&(u=JSON.parse(g).pattern||"")}catch{}if(!u){const g=zt.getElementConfig(a);u=(g==null?void 0:g.pattern)||""}let h="";c&&l?h=" (A+M)":c?h=" (A)":l&&(h=" (M)");const d=o?`${a}→${o}${h}`:`${a}${h}`;if(u&&u.trim()){const g=u.length>80?u.substring(0,80)+"...":u;return`${d}: ${g}`}else return d});t.textContent=r.join(" | ")}}}elementHasPattern(e){const t=zt.getElementConfig(e);if(t!=null&&t.pattern&&t.pattern.trim()!=="")return!0;try{const i=localStorage.getItem(`element-config-${e}`);if(i){const s=JSON.parse(i);if(s.pattern&&s.pattern.trim()!=="")return!0}}catch{}return!1}updateStatusDots(e,t,i){const s=document.querySelector(`[data-sound-id="${e}"]`);if(!s)return;const r=s.querySelector(".loaded-dot"),a=s.querySelector(".playing-dot"),o=s.querySelector(".element-circle");if(r&&(t?r.classList.remove("active"):r.classList.add("active")),a){const l=this.loadElementConfig(e);l&&l.pattern&&l.pattern.trim()!==""?(a.classList.add("active"),i?a.classList.add("is-playing"):a.classList.remove("is-playing")):(a.classList.remove("active"),a.classList.remove("is-playing"))}o&&(i?(o.classList.add("playing"),console.log(`🟢 Circle turned green for ${e} (playing)`)):o.classList.remove("playing"))}isDrumPattern(e){if(!e||typeof e!="string")return!1;const t=e.match(/sound\(["']([^"']+)["']\)|s\(["']([^"']+)["']\)/);if(!t)return!1;const i=t[1]||t[2];return i?i.split(/\s+/).filter(a=>a.trim()).some(a=>rb.hasOwnProperty(a.toLowerCase())):!1}convertNumericPatternToNoteNames(e,t,i){if(!e||!i)return e;const s=y=>typeof y=="string"&&/[b]/i.test(y),r=new Map([["Abb","G"],["Bbb","A"],["Cbb","Bb"],["Dbb","C"],["Ebb","D"],["Fbb","Eb"],["Gbb","F"],["A##","B"],["B##","C#"],["C##","D"],["D##","E"],["E##","F#"],["F##","G"],["G##","A"],["Fb","E"],["Cb","B"],["E#","F"],["B#","C"]]),a=new Map([["A#","Bb"],["C#","Db"],["D#","Eb"],["F#","Gb"],["G#","Ab"]]);function o(y,b){const P=y.match(/^([A-Ga-g])([#b]{0,2})(-?\d+)?$/);if(!P)return y;const M=P[1].toUpperCase(),v=P[2]||"",C=P[3]||"",E=`${M}${v}`;if(r.has(E))return`${r.get(E)}${C}`;if(b&&v==="#"){const A=a.get(`${M}#`);if(A)return`${A}${C}`}return`${M}${v}${C}`}const c={major:"major",minor:"minor",chromatic:"chromatic",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic",ionian:"major",aeolian:"minor","melodic minor":"melodic minor","dorian b2":"dorian b2","lydian augmented":"lydian augmented","lydian dominant":"lydian dominant","mixolydian b6":"mixolydian b6","locrian #2":"locrian #2",altered:"altered","harmonic minor":"harmonic minor","locrian #6":"locrian #6","ionian #5":"ionian #5","dorian #4":"dorian #4","phrygian dominant":"phrygian dominant","lydian #2":"lydian #2",ultralocrian:"ultralocrian","harmonic major":"harmonic major","dorian b5":"dorian b5","phrygian b4":"phrygian b4","lydian b3":"lydian b3","mixolydian b2":"mixolydian b2","lydian augmented #2":"lydian augmented #2","locrian bb7":"locrian bb7","major pentatonic":"major pentatonic","suspended pentatonic":"suspended pentatonic","man gong":"man gong",ritusen:"ritusen","minor pentatonic mode 5":"minor pentatonic","minor pentatonic":"minor pentatonic","blues minor pentatonic":"minor pentatonic","major pentatonic mode 3":"major pentatonic",egyptian:"egyptian","minor pentatonic mode 5":"minor pentatonic","whole tone":"whole tone","half-whole diminished":"dominant diminished","whole-half diminished":"diminished","minor blues":"blues"}[i]||i;let u="C";if(t){const y=t.trim().match(/^([a-gA-G])([#b]?)/);y?u=`${y[1].toUpperCase()}${y[2]||""}`:u=t.trim()}const h=`${u} ${c}`,d=va.get(h);if(!d||!d.notes||d.notes.length===0)return console.warn(`⚠️ Could not get scale notes for "${h}"`),e;const f=s(u),m=d.notes.map(y=>o(`${y}`,f).replace(/-?\d+$/,""));console.log(`🎼 Scale "${h}" notes:`,m);const g=/\b(n|note)\s*\(\s*(["'])([^"']+)\2\s*\)/g;return e.replace(g,(y,b,P,M)=>{const v=/(\s+|[,;:<>()[\]{}|\\/]+|\*+)/g,C=[];let E=0,A;for(;(A=v.exec(M))!==null;)A.index>E&&C.push({type:"number",value:M.substring(E,A.index)}),C.push({type:"separator",value:A[0]}),E=A.index+A[0].length;E<M.length&&C.push({type:"number",value:M.substring(E)});const B=[];for(const Z of C)if(Z.type==="separator")B.push(Z.value);else{const q=parseInt(Z.value.trim(),10);if(isNaN(q))B.push(Z.value);else{const X=m.length||1,j=Math.floor(q/X),H=(q%X+X)%X,se=m[H],Pe=4+j,Me=o(`${se}${Pe}`,f);B.push(Me)}}return`note(${P}${B.join("")}${P})`})}getAllScaleNotesAsPattern(e,t){if(!t)return"";const s={major:"major",minor:"minor",chromatic:"chromatic",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic",ionian:"major",aeolian:"minor","dorian b2":"dorian b2","lydian augmented":"lydian augmented","lydian dominant":"lydian dominant","mixolydian b6":"mixolydian b6","locrian #2":"locrian #2",altered:"altered","harmonic minor":"harmonic minor","locrian #6":"locrian #6","ionian #5":"ionian #5","dorian #4":"dorian #4","phrygian dominant":"phrygian dominant","lydian #2":"lydian #2",ultralocrian:"ultralocrian","harmonic major":"harmonic major","dorian b5":"dorian b5","phrygian b4":"phrygian b4","lydian b3":"lydian b3","mixolydian b2":"mixolydian b2","lydian augmented #2":"lydian augmented #2","locrian bb7":"locrian bb7","major pentatonic":"major pentatonic","minor pentatonic":"minor pentatonic","suspended pentatonic":"suspended pentatonic","man gong":"man gong",ritusen:"ritusen","major pentatonic mode 3":"major pentatonic","minor pentatonic mode 5":"minor pentatonic","blues minor pentatonic":"minor pentatonic","whole tone":"whole tone","half-whole diminished":"dominant diminished","whole-half diminished":"diminished","minor blues":"blues"}[t]||t;let r="C";if(e){const u=e.trim().match(/^([a-gA-G])([#b]?)/);u?r=`${u[1].toUpperCase()}${u[2]||""}`:r=e.trim()}const a=`${r} ${s}`,o=va.get(a);if(!o||!o.notes||o.notes.length===0)return console.warn(`⚠️ Could not get scale notes for "${a}"`),"";const l=o.notes;return console.log(`🎼 Scale "${a}" notes:`,l),`n("${Array.from({length:l.length},(u,h)=>h).join(" ")}")`}getAllScaleNotesAsNoteNames(e,t){if(!t)return"";const s={major:"major",minor:"minor",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic"}[t]||t;let r="C";if(e){const u=e.trim().match(/^([a-gA-G])([#b]?)/);u?r=`${u[1].toUpperCase()}${u[2]||""}`:r=e.trim()}const a=`${r} ${s}`,o=va.get(a);if(!o||!o.notes||o.notes.length===0)return console.warn(`⚠️ Could not get scale notes for "${a}"`),"";const l=o.notes;return console.log(`🎼 Scale "${a}" notes:`,l),`note("${l.map(u=>`${u}4`).join(" ")}")`}resetAll(){console.log("🔄 Resetting all elements and master pattern..."),V.stopAllSounds(),document.querySelectorAll(".sound-element").forEach(s=>{const r=s.dataset.soundId;r&&parseInt(r.replace("element-",""))>4&&(console.log(`🗑️ Removing dynamically created element: ${r}`),s.remove())}),this.elementCounter=4,console.log("🗑️ Clearing all localStorage..."),localStorage.clear(),V.trackedPatterns.clear(),V.updateMasterPattern(),this.masterPatternField&&(Mt("master-pattern",""),this.masterPatternField.placeholder="Combined pattern will appear here..."),document.querySelectorAll(".sound-element").forEach(s=>{const r=s.dataset.soundId;if(r){const a=zt.getElementConfig(r);a&&(a.pattern="",a.description="No sound assigned",a.title="",a.sampleUrl="",a.bank=void 0,a.key=void 0,a.scale=void 0,a.keepNotesAsWritten=!1),V.removeElementFromMaster(r),mi(r,""),this.updateStatusDots(r,!1,!1);const o=s.querySelector(".element-circle");o&&o.classList.remove("playing");const l=s.querySelector(".master-status-indicator");l&&l.classList.remove("active");const c=s.querySelector(".gain-slider"),u=s.querySelector(".pan-slider");c&&(c.value=.8),u&&(u.value=0),s.querySelectorAll(".filter-collapsible-row").forEach(m=>{const g=m.querySelector(".filter-toggle"),y=m.querySelector(".filter-sliders-container");if(g){g.classList.remove("active");const b=g.querySelector(".toggle-icon");b&&(b.textContent="▶")}y&&(y.style.display="none",y.innerHTML="")}),s.querySelectorAll(".effect-collapsible-row").forEach(m=>{const g=m.querySelector(".effect-toggle"),y=m.querySelector(".effect-sliders-container");if(g){g.classList.remove("active");const b=g.querySelector(".toggle-icon");b&&(b.textContent="▶")}y&&(y.style.display="none",y.innerHTML="")});const f=s.querySelector(".synthesis-section");if(f){f.style.display="none";const m=f.querySelector(".synthesis-content");m&&(m.innerHTML="")}}}),this.activeElements.clear(),this.mutedElements.clear(),this.soloedElements.clear(),this.elementEffects={},this.elementFilters={},this.elementSynthesis={},this.masterActive=!1,this.currentEditingElementId=null,this.selectedVisualizer="scope";const i=document.getElementById("visualizer-select");if(i&&(i.value="scope"),this.masterPunchcardCanvas){const s=this.masterPunchcardCanvas.getContext("2d");s&&s.clearRect(0,0,this.masterPunchcardCanvas.width,this.masterPunchcardCanvas.height)}this.updateActiveElementsDisplay(),this.updateMasterPatternDisplay(),this.updateMasterIndicators(),tn.updateStatus("✅ All cleared")}setAllElementsNotLoaded(){zt.elements.forEach(e=>{this.updateStatusDots(e.id,!1,!1)}),console.log("🔴 All element status dots marked as NOT loaded (red)")}setAllElementsLoaded(){zt.elements.forEach(e=>{let t=!1;if(e.pattern&&e.pattern.trim()!==""&&(t=!0),!t)try{const i=localStorage.getItem(`element-config-${e.id}`);if(i){const s=JSON.parse(i);s.pattern&&s.pattern.trim()!==""&&(t=!0)}}catch{}this.updateStatusDots(e.id,t,!1)}),console.log("✅ Element status dots updated based on configured patterns")}setupAudioInitialization(){const e=async t=>{V.isAudioReady()||(await V.initialize()?(tn.updateStatus("Audio enabled - Loading sounds..."),document.removeEventListener("click",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",e),document.removeEventListener("mousedown",e)):tn.updateStatus("Click to enable audio (required for sound playback)"))};document.addEventListener("click",e,{once:!1}),document.addEventListener("touchstart",e,{once:!1}),document.addEventListener("keydown",e,{once:!1}),document.addEventListener("mousedown",e,{once:!1})}loadAllElementConfigs(){zt.elements.forEach(e=>{const t=this.loadElementConfig(e.id);if(t){const i=t.title&&t.title.trim()?t.title:t.bank&&t.bank.trim()?Na[t.bank]||t.bank.replace("github:tidalcycles/",""):"";mi(e.id,i),t.pattern!==void 0&&(e.pattern=t.pattern),t.title!==void 0&&(e.description=t.title)}else mi(e.id,e.description||"")})}migrateLocalStorageQuotes(){try{console.log("🔧 Migrating localStorage to fix fancy quotes...");let e=0;for(let t=0;t<localStorage.length;t++){const i=localStorage.key(t);if(i&&i.startsWith("element-config-"))try{const s=localStorage.getItem(i);if(s){const r=JSON.parse(s);if(r&&r.pattern){const a=r.pattern,o=a.replace(/[""]/g,'"').replace(/['']/g,"'");a!==o&&(r.pattern=o,localStorage.setItem(i,JSON.stringify(r)),e++,console.log(`  ✅ Fixed quotes in ${i}`))}}}catch(s){console.warn(`  ⚠️ Could not migrate ${i}:`,s)}}e>0?console.log(`✅ Migrated ${e} patterns with fancy quotes`):console.log("✅ No patterns needed migration")}catch(e){console.error("Error during localStorage migration:",e)}}loadElementConfig(e){try{const t=localStorage.getItem(`element-config-${e}`);if(t){const i=JSON.parse(t);if(i&&i.pattern&&(i.pattern=i.pattern.replace(/[""]/g,'"').replace(/['']/g,"'"),i.pattern=Tc(i.pattern)),i&&i.bank){const s=Io(i.bank);s!==i.bank&&console.log(`🔁 Normalized synth bank from "${i.bank}" to "${s}" for ${e}`),i.bank=s}return i}}catch(t){console.error(`Error loading config for ${e}:`,t)}return null}saveElementConfig(e,t,i=!1){try{if(t.bank&&typeof t.bank=="string"){const u=Io(t.bank);u!==t.bank&&(console.log(`🔁 Normalized bank selection from "${t.bank}" to "${u}" before saving`),t.bank=u)}if(t.pattern&&typeof t.pattern=="string"){const u=Tc(t.pattern);u!==t.pattern&&(console.log("🔁 Updated pattern to use canonical synth names before saving"),t.pattern=u),Xn.saveChannelVersion(e,t.pattern)}localStorage.setItem(`element-config-${e}`,JSON.stringify(t));const s=zt.getElementConfig(e);s&&(t.pattern!==void 0&&(s.pattern=t.pattern),t.title!==void 0&&(s.description=t.title),t.sampleUrl&&t.sampleUrl.trim()!==""?(s.audioFile=t.sampleUrl,s.type="audio"):(s.audioFile=void 0,s.type="strudel"));const r=t.title&&t.title.trim()?t.title:t.bank?Na[t.bank]||t.bank.replace("github:tidalcycles/",""):"";mi(e,r);const a=document.querySelector(`[data-sound-id="${e}"]`);if(a){const u=t.pattern&&mg(t.pattern),h=a.querySelector(".synthesis-section");h&&u&&(h.style.display="block",console.log(`✅ ${e}: Synthesis section shown for synth pattern`))}const o=t.pattern&&t.pattern.trim()!=="",l=this.activeElements.has(e);this.updateStatusDots(e,o,!1),this.updateSynthesisSectionVisibility(e,t.pattern);const c=V.masterActive;if(t.pattern!==void 0&&(V.invalidatePatternCache(e),V.preEvaluatePattern(e,t.pattern).catch(u=>{console.log(`⚠️ Failed to pre-evaluate pattern for ${e}:`,u)})),!i&&t.pattern!==void 0&&t.pattern.trim()!==""){const u=document.querySelector(`[data-sound-id="${e}"]`);let h=.8,d=0;if(u){const m=u.querySelector(".gain-slider"),g=u.querySelector(".pan-slider");m&&(h=parseFloat(m.value)),g&&(d=parseFloat(g.value))}const f=V.saveElementToMaster(e,t.pattern,h,d);if(f.success){if(V.updateMasterPattern(this.soloedElements,this.mutedElements),!c&&V.masterActive){if(typeof V.stopMasterPattern=="function")try{V.stopMasterPattern()}catch(m){console.warn("⚠️ Could not stop master after save:",m)}V.masterActive=!1}if(!c&&window.strudel&&window.strudel.scheduler&&window.strudel.scheduler.started)try{window.strudel.scheduler.stop()}catch(m){console.warn("⚠️ Could not stop scheduler after save:",m)}this.updateMasterPatternDisplay(),this.updateMasterIndicators(),console.log(`✅ Pattern saved to master for ${e}`)}else console.error(`❌ Failed to save pattern to master for ${e}:`,f.error)}console.log(`✅ Saved config for ${e}:`,t)}catch(s){console.error(`Error saving config for ${e}:`,s)}}setupModal(){const e=document.getElementById("config-modal");if(!e)return;const t=this,i=document.getElementById("modal-pattern-bank"),s=document.getElementById("modal-sample-url"),r=document.getElementById("modal-sample-name"),a=document.getElementById("modal-add-sample-btn"),o=document.getElementById("modal-sample-file"),l=D=>{const T={baseUrl:"./",samplePath:""};if(!D||typeof D!="string")return T;const _=D.trim();if(!_)return T;try{const F=new URL(_),L=F.pathname||"",z=L.endsWith("/")&&L.length>1?L.slice(0,-1):L,Q=z.lastIndexOf("/");if(Q!==-1){const G=z.slice(Q+1)||"",re=z.slice(0,Q+1);return{baseUrl:`${F.origin}${re}`,samplePath:G||_}}return{baseUrl:`${F.origin}/`,samplePath:z||F.origin}}catch{const F=_.replace(/\\/g,"/"),L=F.lastIndexOf("/");return L!==-1?{baseUrl:F.slice(0,L+1),samplePath:F.slice(L+1)||F}:{baseUrl:"./",samplePath:F||"sample.wav"}}},c=(D="")=>D.replace(/[\r\n]+/g,"").trim(),u=(D="")=>JSON.stringify(D??""),h=(D,T,_)=>{const F=u(D||"sample"),L=c(_||D||""),z=u(L),Q=c(T||"./"),G=u(Q||"./"),re=`samples({
  ${F}: ${z}
}, { baseUrl: ${G} })`,Oe=`sound(${F})`,ae=`(${re},
 ${Oe})`,Xe=(ft("modal-pattern")||"").trim(),qe=Xe?`${Xe}

${ae}`:ae;Mt("modal-pattern",qe),typeof oe=="function"&&oe(),r.value="",s.value="",o&&(o.value=""),r.focus()};a&&a.addEventListener("click",()=>{if(!r||!s)return;const D=r.value.trim(),T=s.value.trim(),_=o&&o.files&&o.files.length>0;if(!D||!T&&!_){alert("Please provide a Sample Name and either a Sample URL or select a file.");return}if(T){const{baseUrl:F,samplePath:L}=l(T);h(D,F,L||D)}else if(_){const F=o.files[0],L=new FileReader;L.onload=z=>{const Q=z.target.result;typeof Q=="string"&&Q.length>0?h(D,"./",Q):alert("Unable to read the selected file. Please try again.")},L.onerror=()=>{alert("Unable to read the selected file. Please try again.")},L.readAsDataURL(F)}});const d=()=>{i&&i.querySelectorAll('option[data-source="specialty-vcsl"]').forEach(D=>D.remove())},f=(D=i?i.value:"")=>{if(!i)return;const T=i.value,_=D??T;let F=Array.from(i.children).find(ae=>ae.tagName==="OPTGROUP"&&ae.label&&ae.label.toLowerCase()==="drums"),L=Array.from(i.children).find(ae=>ae.tagName==="OPTGROUP"&&ae.label&&ae.label.toLowerCase().includes("waveform")),z=Array.from(i.children).find(ae=>ae.tagName==="OPTGROUP"&&ae.label&&ae.label.toLowerCase().includes("synth")),Q=Array.from(i.children).find(ae=>ae.tagName==="OPTGROUP"&&ae.label===eg),G=Array.from(i.children).find(ae=>ae.tagName==="OPTGROUP"&&ae.label===tg);F||(F=document.createElement("optgroup"),F.label="Drums",i.insertBefore(F,i.firstChild)),L||(L=document.createElement("optgroup"),L.label="Basic Waveforms",F.nextSibling?i.insertBefore(L,F.nextSibling):i.appendChild(L)),z||(z=document.createElement("optgroup"),z.label="Sample-based Synths",L.nextSibling?i.insertBefore(z,L.nextSibling):i.appendChild(z)),Q||(Q=document.createElement("optgroup"),Q.label=eg,z.nextSibling?i.insertBefore(Q,z.nextSibling):i.appendChild(Q)),G||(G=document.createElement("optgroup"),G.label=tg,i.appendChild(G)),F.innerHTML="";const re=document.createElement("option");re.value="",re.textContent="Default",F.appendChild(re),Array.from(Dr).sort((ae,fe)=>Bo(ae).localeCompare(Bo(fe))).forEach(ae=>{const fe=document.createElement("option");fe.value=ae,fe.textContent=Bo(ae),F.appendChild(fe)}),Q.innerHTML="",G.innerHTML="",Xh.forEach(({value:ae,label:fe})=>{const Xe=document.createElement("option");Xe.value=ae,Xe.textContent=fe,ae.toLowerCase()==="vcsl"?G.appendChild(Xe):Q.appendChild(Xe)}),d(),Array.isArray(or)&&or.length>0?or.forEach(ae=>{const fe=document.createElement("option");fe.value=ae.optionValue,fe.textContent=ae.label,fe.dataset.source="specialty-vcsl",fe.dataset.instrument=ae.value,G.appendChild(fe)}):$r||i5().then(()=>{f(D)}).catch(()=>{}),_&&i.querySelector(`option[value="${_}"]`)?i.value=_:T&&i.querySelector(`option[value="${T}"]`)?i.value=T:i.value=""};f();const m=document.getElementById("modal-drum-grid-section"),g=document.getElementById("modal-drum-grid-timesig"),y=(()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem("drumGridEditorMode")}catch{return null}})(),b={active:!1,totalSteps:0,built:!1,patternEditorEnabled:y?y==="code":!0,updatingFromPattern:!1,updatingFromGrid:!1,currentBankRows:null,checkboxes:{},numBars:1,currentBar:1,barTokens:[]},P=document.getElementById("modal-pattern-editor-select"),M=e.querySelector(".pattern-label-row");let v=e.querySelector(".pattern-snippet-container"),C=v?v.querySelector(".pattern-snippet-list"):null,E=v?v.querySelector(".pattern-snippet-search"):null;const A=document.getElementById("modal-presets-toggle"),B=document.getElementById("modal-presets-content"),Z=document.getElementById("modal-drum-presets"),q=document.getElementById("modal-tonal-presets"),X=document.getElementById("modal-sampler-presets"),j=document.getElementById("modal-preview-btn"),H=D=>{if(!A||!B)return;A.setAttribute("aria-expanded",D.toString()),B.classList.toggle("is-open",D),B.setAttribute("aria-hidden",(!D).toString());const T=A.closest(".modal-presets");T&&T.classList.toggle("collapsed",!D)},se=()=>{B&&B.hasAttribute("hidden")&&B.removeAttribute("hidden"),H(!1)},oe=()=>{if(!j)return;const D=ft("modal-pattern"),T=!!(D&&D.trim().length>0);j.disabled=!T};let Pe=null;(async()=>{var Q;const D=ft("modal-pattern"),T=E?E.value.trim().toLowerCase():"",[_,F]=await Promise.all([pg(D),Kh()]);if(!v){v=document.createElement("div"),v.className="pattern-snippet-container",v.setAttribute("aria-disabled","false");const G=document.createElement("span");if(G.className="pattern-snippet-heading",G.textContent="Add to pattern:",v.appendChild(G),E=document.createElement("input"),E.type="search",E.className="pattern-snippet-search",E.setAttribute("placeholder","Search tags…"),E.setAttribute("aria-label","Search snippet tags"),v.appendChild(E),C=document.createElement("div"),C.className="pattern-snippet-list",v.appendChild(C),M){const re=e.querySelector(".modal-presets");re&&re.parentElement===M.parentElement?re.insertAdjacentElement("afterend",v):M.insertAdjacentElement("afterend",v)}else(Q=e.querySelector(".form-group"))==null||Q.insertAdjacentElement("afterbegin",v)}C||(C=v.querySelector(".pattern-snippet-list")),E||(E=v.querySelector(".pattern-snippet-search")),this.selectedTagKey||(this.selectedTagKey=null);let L=this.selectedTagKey;const z=(G,re,Oe,ae)=>{Wn(),G.innerHTML="";const fe=!!(ae&&ae.trim().length),Xe=ae||"",qe=new Map,We=[];re.forEach(ue=>{const ze=typeof ue=="string"?ue:ue.snippet,Ue=typeof ue=="string"?"other":ue.groupId||"other",mt=typeof ue=="string"?"":ue.className||"",rt=(typeof ue=="string"?"Other":ue.heading)||"Other",st=Ti(ze),Tt=Oe.get(st);let Fe=hg(ze,Tt);st==="bank"&&Fe.includes("display bank(bank)")&&(Fe="bank()");const Qt=Fe.replace(/^[.]+/,"");let _t=Qt;const xe=Qt.match(/^sound\s*\(\s*["']([^"']+)["']\s*\)/i);xe&&xe[1]?_t=`sound("${xe[1]}")`:_t=_t.replace(/\([^)]*\)/g,"()");const Nt=_t.toLowerCase(),R=rt.toLowerCase();Xe&&!Nt.includes(Xe)&&!st.includes(Xe)&&!R.includes(Xe)||(qe.has(Ue)||(qe.set(Ue,{id:Ue,heading:rt,className:mt,items:[]}),We.push(qe.get(Ue))),qe.get(Ue).items.push({snippet:ze,insertionSnippet:Qt,displayLabel:_t,key:st,className:mt,heading:rt,referenceEntry:Tt}))}),We.sort((ue,ze)=>{const Ue=(ue.heading||"").toLowerCase(),mt=(ze.heading||"").toLowerCase();return Ue.localeCompare(mt)});let $e=!1;const me=new Map;if(re.forEach(ue=>{const ze=typeof ue=="string"?ue:ue.snippet,Ue=Ti(ze);me.has(Ue)||me.set(Ue,ue)}),We.forEach(ue=>{if(!Array.isArray(ue.items)||!ue.items.length)return;ue.items.sort((Fe,Qt)=>{const _t=(Fe.displayLabel||"").toLowerCase(),xe=(Qt.displayLabel||"").toLowerCase();return _t<xe?-1:_t>xe?1:0}),$e=!0;const ze=document.createElement("div");ze.className="pattern-snippet-group",ze.dataset.groupId=ue.id;const Ue=m5.has(ue.id)?g5:p5,mt=Oa.has(ue.id)?Oa.get(ue.id):Ue.has(ue.id),rt=fe?!0:mt;Oa.has(ue.id)||Oa.set(ue.id,mt);const st=document.createElement("button");st.type="button",st.className="pattern-snippet-group-heading",st.textContent=ue.heading,st.setAttribute("aria-expanded",rt?"true":"false");const Tt=document.createElement("div");Tt.className="pattern-snippet-group-items",rt||ze.classList.add("collapsed"),st.addEventListener("click",()=>{Wn();const Qt=!ze.classList.toggle("collapsed");st.setAttribute("aria-expanded",Qt?"true":"false"),Oa.set(ue.id,Qt)}),ue.items.forEach(Fe=>{var Te,Jt,kt,ut;const Qt=document.createElement("div");Qt.className="pattern-snippet-item",Qt.dataset.snippetKey=Ti(Fe.snippet);const _t=Ti(Fe.snippet);let xe=Yi[_t];if(!xe&&Fe.snippet){const ie=Fe.snippet.match(/\(([a-zA-Z_]+):number\)/),Bt=Fe.snippet.match(/\(([0-9.]+)\)/);if(ie||Bt){let je=Bt?parseFloat(Bt[1]):null;if(ie&&!je){const ct=ie[1];Yi[_t]?xe=Yi[_t]:ct.includes("attack")||ct.includes("decay")||ct.includes("release")?xe={min:0,max:2,step:.01,default:.01,unit:"s"}:ct.includes("sustain")||ct.includes("modulation")||ct.includes("env")?xe={min:0,max:1,step:.01,default:.5,unit:""}:xe={min:0,max:1,step:.01,default:.5,unit:""}}else if(Bt&&je!==null){let ct=Math.max(0,je*.1),Ee=je*10,Vt=je<1?.01:je<10?.1:1;je>=20&&je<=2e4?(ct=20,Ee=2e4,Vt=10):je>=0&&je<=1?(ct=0,Ee=1,Vt=.01):je>=-1&&je<=1&&(ct=-1,Ee=1,Vt=.01),xe={min:ct,max:Ee,step:Vt,default:je,unit:""}}}}if(!!xe){const ie=document.createElement("button");ie.type="button";const Bt=Pc(Fe.snippet),je=!Bt&&Fe.groupId!=="core"&&Cc(Fe.snippet),ct=[Fe.className||"",Bt,je?"pattern-snippet-tag-core":""].filter(Boolean).join(" ");ie.className=`pattern-snippet-tag ${ct}`.trim(),ie.dataset.snippet=Fe.snippet,ie.dataset.insertion=Fe.insertionSnippet;let Ee=Fe.displayLabel;const Vt=Ee.match(/\(([a-zA-Z_]+):number\)/);Vt?Ee=`${Vt[1]}()`:Ee.includes('sound("')&&Ee.includes('")')?Ee=Fe.displayLabel:Ee=Ee.replace(/\([^)]*\)/g,"()"),ie.textContent=Ee,ie.setAttribute("aria-label",Fe.displayLabel);const Ft=document.createElement("div");Ft.className="slider-row snippet-slider-row",Ft.style.display="none",Ft.style.width="100%",Ft.style.marginTop="8px",Ft.style.padding="8px",Ft.style.backgroundColor="rgba(102, 126, 234, 0.05)",Ft.style.border="1px solid rgba(102, 126, 234, 0.2)",Ft.style.borderRadius="4px";const hn=document.createElement("label");hn.textContent=Fe.displayLabel.replace(/\(\)$/,""),hn.style.fontSize="0.75rem",hn.style.fontWeight="600",hn.style.color="#4c51bf",hn.style.marginBottom="4px";const qt=document.createElement("div");qt.style.display="flex",qt.style.alignItems="center",qt.style.gap="8px",qt.style.width="100%";const Ge=document.createElement("input");Ge.type="range",Ge.className="snippet-slider",Ge.dataset.snippet=Fe.snippet,Ge.dataset.tagKey=_t,Ge.style.flex="1";let ge;const hi=_t,vt=xe.unit==="Hz"&&(_t==="lpf"||_t==="hpf"||_t==="bpf"||_t==="cutoff"||_t==="roomlp");if(vt){Ge.min="0",Ge.max="1",Ge.step="0.001";const dn=(()=>{const nn=ft("modal-pattern")||"",Wt=new RegExp(`\\.${hi}\\(([^)]+)\\)`,"g").exec(nn);return Wt?Wt[1]:null})();let fn=dn?parseFloat(dn):xe.default;fn=Math.max(xe.min,Math.min(xe.max,fn));const di=Sc(fn);Ge.value=String(di),ge=document.createElement("span"),ge.className="slider-value",ge.style.minWidth="60px",ge.style.textAlign="right",ge.style.fontSize="0.75rem",ge.style.fontWeight="600",ge.textContent=Math.round(fn)+" "+xe.unit,Ge.addEventListener("input",nn=>{const De=parseFloat(nn.target.value),Wt=wc(De);ge.textContent=Math.round(Wt)+" "+xe.unit})}else{Ge.min=String(xe.min),Ge.max=String(xe.max),Ge.step=String(xe.step);const dn=(()=>{const fn=ft("modal-pattern")||"",nn=new RegExp(`\\.${hi}\\(([^)]+)\\)`,"g").exec(fn);return nn?nn[1]:null})();Ge.value=String(dn||xe.default),ge=document.createElement("span"),ge.className="slider-value",ge.style.minWidth="60px",ge.style.textAlign="right",ge.style.fontSize="0.75rem",ge.style.fontWeight="600",ge.textContent=Ge.value+(xe.unit?" "+xe.unit:""),Ge.addEventListener("input",fn=>{const di=fn.target.value;ge.textContent=di+(xe.unit?" "+xe.unit:"")})}Ge.addEventListener("change",xi=>{let dn=xi.target.value;if(vt){const Wt=parseFloat(dn),Fn=wc(Wt);dn=Math.round(Fn),ge.textContent=dn+" "+xe.unit}else ge.textContent=dn+(xe.unit?" "+xe.unit:"");const fn=ft("modal-pattern")||"",di=`.${hi}(${dn})`,nn=new RegExp(`\\.${hi}\\([^)]*\\)`,"g");if(nn.test(fn)){const Wt=fn.replace(nn,di);Mt("modal-pattern",Wt)}else{const Wt=fn.trim()+di;Mt("modal-pattern",Wt)}}),ie.addEventListener("click",xi=>{if(xi.stopPropagation(),xi.preventDefault(),Ft.style.display==="none"||Ft.style.display===""){Ft.style.display="flex",Ft.style.flexDirection="column",Ft.style.gap="4px";const fn=ft("modal-pattern")||"",nn=new RegExp(`\\.${hi}\\(([^)]+)\\)`,"g").exec(fn);if(nn){let De=nn[1];if(vt){const Wt=parseFloat(De),Fn=Math.max(xe.min,Math.min(xe.max,Wt)),Ds=Sc(Fn);Ge.value=String(Ds),ge.textContent=Math.round(Fn)+" "+xe.unit}else Ge.value=De,ge.textContent=De+(xe.unit?" "+xe.unit:"")}else{let De=Ge.value;if(vt){const Ds=parseFloat(Ge.value);De=Math.round(wc(Ds))}const Wt=`.${hi}(${De})`,Fn=fn.trim()+Wt;Mt("modal-pattern",Fn)}}});const Rt=((Te=Fe.referenceEntry)==null?void 0:Te.name)||Fe.displayLabel.replace(/^[.]+/,"").trim(),Ms=xc(Fe.referenceEntry),Pr=Array.isArray((Jt=Fe.referenceEntry)==null?void 0:Jt.params)?Fe.referenceEntry.params.map(Ec).filter(Boolean).join(`
`):"";ie.dataset.tooltipTitle=Rt||Fe.displayLabel,ie.dataset.tooltipDescription=Ms||"",ie.dataset.tooltipParams=Pr||"";const en=()=>kc(ie),Ys=()=>Wn(ie);ie.addEventListener("mouseenter",en),ie.addEventListener("mouseleave",Ys),ie.addEventListener("focus",en),ie.addEventListener("blur",Ys),qt.appendChild(Ge),qt.appendChild(ge),Ft.appendChild(hn),Ft.appendChild(qt),Qt.appendChild(ie),Qt.appendChild(Ft)}else{const ie=document.createElement("button");ie.type="button";const Bt=Pc(Fe.snippet),je=!Bt&&Fe.groupId!=="core"&&Cc(Fe.snippet),ct=[Fe.className||"",Bt,je?"pattern-snippet-tag-core":""].filter(Boolean).join(" ");ie.className=`pattern-snippet-tag ${ct}`.trim(),ie.dataset.snippet=Fe.snippet,ie.dataset.insertion=Fe.insertionSnippet,ie.textContent=Fe.displayLabel,ie.setAttribute("aria-label",Fe.displayLabel);const Ee=((kt=Fe.referenceEntry)==null?void 0:kt.name)||Fe.displayLabel.replace(/^[.]+/,"").trim(),Vt=xc(Fe.referenceEntry),Ft=Array.isArray((ut=Fe.referenceEntry)==null?void 0:ut.params)?Fe.referenceEntry.params.map(Ec).filter(Boolean).join(`
`):"";ie.dataset.tooltipTitle=Ee||Fe.displayLabel,ie.dataset.tooltipDescription=Vt||"",ie.dataset.tooltipParams=Ft||"";const hn=()=>kc(ie),qt=()=>Wn(ie);ie.addEventListener("mouseenter",hn),ie.addEventListener("mouseleave",qt),ie.addEventListener("focus",hn),ie.addEventListener("blur",qt),ie.addEventListener("click",qt),Qt.appendChild(ie)}Tt.appendChild(Qt);const R=L||t.selectedTagKey;if(R&&_t===R){const ie=O5[_t];if(ie&&Array.isArray(ie)&&ie.length>0){const Bt=document.createElement("div");Bt.className="pattern-snippet-suggestions";const je=document.createElement("div");je.className="pattern-snippet-suggestions-label",je.textContent="Suggested:",Bt.appendChild(je);const ct=document.createElement("div");ct.className="pattern-snippet-suggestions-list";const Vt=ie.filter(Ft=>me.has(Ft)).slice(0,8);Vt.forEach(Ft=>{const hn=me.get(Ft),qt=typeof hn=="string"?hn:hn.snippet,Ge=Ti(qt),ge=Oe.get(Ge),vt=hg(qt,ge).replace(/^[.]+/,"");let Rt=vt;Rt=Rt.replace(/\([^)]*\)/g,"()");let Ms="other",Pr="";for(const Fn of Ba)if(Fn.matcher(Ge,qt)){Ms=Fn.id,Pr=Fn.className;break}const en=document.createElement("button");en.type="button";const Ys=Pc(qt),xi=!Ys&&Ms!=="core"&&Cc(qt),dn=[Pr,Ys,xi?"pattern-snippet-tag-core":"","pattern-snippet-tag-suggested"].filter(Boolean).join(" ");en.className=`pattern-snippet-tag ${dn}`.trim(),en.dataset.snippet=qt,en.dataset.insertion=vt,en.textContent=Rt,en.setAttribute("aria-label",Rt),en.addEventListener("click",Fn=>{Fn.stopPropagation(),!v.classList.contains("disabled")&&b.patternEditorEnabled&&(L=Ge,t.selectedTagKey=Ge,Wn(en),Em("modal-pattern",vt),typeof Pe=="function"&&Pe().catch(Ds=>console.warn("⚠️ Unable to refresh snippet tags:",Ds)))});const fn=(ge==null?void 0:ge.name)||Rt.replace(/^[.]+/,"").trim(),di=xc(ge),nn=Array.isArray(ge==null?void 0:ge.params)?ge.params.map(Ec).filter(Boolean).join(`
`):"";en.dataset.tooltipTitle=fn||Rt,en.dataset.tooltipDescription=di||"",en.dataset.tooltipParams=nn||"";const De=()=>kc(en),Wt=()=>Wn(en);en.addEventListener("mouseenter",De),en.addEventListener("mouseleave",Wt),en.addEventListener("focus",De),en.addEventListener("blur",Wt),ct.appendChild(en)}),Vt.length>0&&(Bt.appendChild(ct),Tt.appendChild(Bt))}}}),ze.appendChild(st),ze.appendChild(Tt),G.appendChild(ze)}),!$e){const ue=document.createElement("div");ue.className="pattern-snippet-empty",ue.textContent="No tags match your search.",G.appendChild(ue)}};C&&z(C,_,F,T),Pe=async()=>{if(!C)return;const G=await pg(ft("modal-pattern")),re=await Kh(),Oe=E?E.value.trim().toLowerCase():"";L=t.selectedTagKey,z(C,G,re,Oe)},t.refreshSnippetButtons=Pe,C&&!C.dataset.listenersAttached&&(C.addEventListener("click",G=>{const re=G.target.closest(".pattern-snippet-tag");if(!re||v.classList.contains("disabled")||!b.patternEditorEnabled)return;const Oe=re.closest(".pattern-snippet-item");if(Oe&&Oe.dataset.snippetKey){const Xe=Oe.dataset.snippetKey;if(Yi[Xe])return}const ae=re.dataset.insertion||re.dataset.snippet;if(!ae)return;const fe=Ti(ae);L=fe,t.selectedTagKey=fe,Wn(re),Em("modal-pattern",ae),typeof Pe=="function"&&Pe().catch(Xe=>console.warn("⚠️ Unable to refresh snippet tags:",Xe))}),C.addEventListener("mouseleave",()=>{Wn()}),C.addEventListener("scroll",()=>{Wn()}),C.dataset.listenersAttached="true"),E&&!E.dataset.listenerAttached&&(E.addEventListener("input",()=>{Wn(),typeof Pe=="function"&&Pe().catch(G=>console.warn("⚠️ Unable to refresh snippet tags:",G))}),E.dataset.listenerAttached="true")})().catch(D=>{console.warn("⚠️ Unable to prepare pattern snippet tags:",D)}),oe();const Be=D=>{try{if(!e)return;this.currentEditingElementId=D,pe(!0),P&&(P.value="code");const T=document.getElementById("modal-element-id");T&&(T.textContent=D||"");const _=this.loadElementConfig?this.loadElementConfig(D):null,F=(_==null?void 0:_.bank)||"",L=(_==null?void 0:_.vcslInstrument)||"",z=F==="vcsl"&&L?`${Ml}${L}`:F;f(z),i&&(i.value=z);const Q=(_==null?void 0:_.pattern)||"";Mt("modal-pattern",Q||"");const G=document.getElementById("modal-key-select"),re=document.getElementById("modal-scale-select");G&&(_!=null&&_.key||(_==null?void 0:_.key)==="")&&(G.value=_.key||""),re&&(_!=null&&_.scale||(_==null?void 0:_.scale)==="")&&(re.value=_.scale||"chromatic"),w(),p(),oe(),Cr(),zn(),se(),e.style.display="block"}catch(T){console.warn("⚠️ Failed to open modal:",T)}},Ke=()=>{try{if(!e)return;e.style.display="none",V&&typeof V.stopSound=="function"&&V.stopSound("modal-preview")}catch(D){console.warn("⚠️ Failed to close modal:",D)}};if(j&&!j.dataset.listenerAttached){let D=!1;j.addEventListener("click",async()=>{const T="modal-preview";if(V.trackedPatterns&&V.trackedPatterns.has(T)){V.stopSound&&V.stopSound(T);try{const ae=V.trackedPatterns?V.trackedPatterns.size:0;D&&ae===0&&V.stopMasterPattern&&await V.stopMasterPattern()}catch{}D=!1,j.textContent="▶ Preview Pattern",j.classList.remove("active"),tn.updateStatus("⏹ Preview stopped");return}b.active&&ji();let F=ft("modal-pattern");if(!F||!F.trim()){tn.updateStatus("⚠️ No pattern to preview");return}const z=(i?Oc(i.value):{bankValue:""}).bankValue;console.log("🎵 Preview: Original pattern:",F),console.log("🎵 Preview: Bank value:",z);const Q=[...xa,...Tr],G=z&&Q.includes(z.toLowerCase()),re=z&&Dr.has(z);if(z&&z!=="")if(re&&!G)if(F.includes(".bank("))F=F.replace(/\.bank\(["'][^"']*["']\)/g,`.bank("${z}")`);else if(F.includes(".gain(")||F.includes(".pan(")||F.includes(".fast(")||F.includes(".slow(")){const ae=F.match(/(\.(gain|pan|fast|slow)\([^)]*\))/);if(ae){const fe=ae.index;F=F.slice(0,fe)+`.bank("${z}")`+F.slice(fe)}else F=`${F}.bank("${z}")`}else F=`${F}.bank("${z}")`;else G&&(F=F.replace(/\.bank\(["'][^"']*["']\)/g,""),F=F.replace(/\.+$/,"").trim());else F=F.replace(/\.bank\(["'][^"']*["']\)/g,""),F=F.replace(/\.+$/,"").trim();console.log("🎵 Preview: Final pattern before preview:",F);const Oe=this.currentEditingElementId;if(Oe){const ae=V.elementGainValues.get(Oe)||.8,fe=V.elementPanValues.get(Oe)||0,Xe=ae*.501;V.elementGainValues.set(T,Xe),V.elementPanValues.set(T,fe),console.log(`🎵 Preview: Using gain=${Xe} (${ae} * 0.501 for -6dB), pan=${fe} from element ${Oe}`)}if(z&&z!==""){console.log(`🎵 Preview: Ensuring bank "${z}" is loaded...`);try{await V.loadBank(z),console.log(`✅ Preview: Bank "${z}" loaded successfully`)}catch(ae){console.warn(`⚠️ Preview: Could not load bank "${z}":`,ae)}}tn.updateStatus("▶ Previewing pattern…"),j.textContent="⏹ Stop Preview",j.classList.add("active");try{const ae=!!V.masterActive;await V.playStrudelPattern(T,F),!V.masterActive&&V.playMasterPattern&&await V.playMasterPattern(),D=!ae&&!!V.masterActive,tn.updateStatus("✅ Preview playing")}catch(ae){console.error("Preview failed:",ae),tn.updateStatus("⚠️ Preview failed – check console for details"),j.textContent="▶ Preview Pattern",j.classList.remove("active")}}),j.dataset.listenerAttached="true"}const Ct=D=>{Wn(),hD("modal-pattern",D);const T=document.getElementById("modal-pattern");T&&T.classList.toggle("pattern-editor-readonly",!D),v&&(v.classList.toggle("disabled",!D),v.setAttribute("aria-disabled",(!D).toString())),E&&(E.disabled=!D)},yt=()=>{var _;P&&(P.value=b.patternEditorEnabled?"code":"step"),Ct(b.patternEditorEnabled);const D=document.getElementById("modal-pattern-editor-wrapper");D&&(D.style.display=b.patternEditorEnabled?"block":"none",he()),v&&(v.style.display=b.patternEditorEnabled?"block":"none");const T=(_=document.getElementById("modal-time-signature-select"))==null?void 0:_.closest(".form-group");T&&(T.style.display=b.patternEditorEnabled?"none":"block")},he=()=>{const D=document.getElementById("modal-note-conversion-control");if(!D)return;const T=ft("modal-pattern"),_=T&&Un(T);_&&Mi(T),_?D.style.display="block":D.style.display="none"},et=document.getElementById("modal-pattern");if(et&&!et.dataset.previewListenerAttached){const D=T=>{if(!T||typeof T!="string"||!T.includes("(silence)")||!/\b(note|n)\s*\(/i.test(T))return T;const _=T.trim().startsWith("(silence)"),F=T.trim().match(/^\(silence\)\.\s*([\s\S]+)$/);if(_&&F){const z=F[1].trim().replace(/^\.+/,""),Q=T.search(/\b(note|n)\s*\(/i);if(Q>=0){let G=T.indexOf("(",Q),re=0,Oe=-1;for(let ae=G;ae<T.length;ae++){const fe=T[ae];if(fe==="(")re++;else if(fe===")"&&(re--,re===0)){Oe=ae;break}}if(Oe>G){let fe=`${T.substring(Q,Oe+1).trim()}`;return z&&!/^\s*$/.test(z)&&(fe=`${fe}.${z}`.replace(/\.\.+/g,".").replace(/\.($|\s)/,"$1").trim()),fe}}}let L=T.replace(/\(silence\)/g,"").replace(/\.\.+/g,".").trim();return L=L.replace(/^\./,"").trim(),L};et.addEventListener("input",()=>{const T=ft("modal-pattern"),_=D(T);_!==T&&Mt("modal-pattern",_),oe(),he(),_&&Mi(_)&&(En=_),lt=!1,Ui(ft("modal-pattern"),!0);const F=document.getElementById("modal-key-scale-group"),L=ft("modal-pattern"),z=L&&Un(L),Q=i?i.value:"",G=Q&&Tr.includes(Q.toLowerCase());F&&(F.style.display=z||G?"block":"none"),typeof Pe=="function"&&Pe().catch(re=>console.warn("⚠️ Unable to refresh snippet tags:",re))}),et.dataset.previewListenerAttached="true"}const pe=D=>{b.patternEditorEnabled=!!D,yt();try{typeof localStorage<"u"&&localStorage.setItem("drumGridEditorMode",b.patternEditorEnabled?"code":"step")}catch{}},Et=D=>{const T=Oc(D);return T.bankValue&&Dr.has(T.bankValue)},Ze=D=>{g&&(g.textContent=`${D.signature} · ${D.totalSteps} steps`)},ve=()=>{const D=document.getElementById("modal-drum-grid-bar-count"),T=document.getElementById("modal-drum-grid-bar-arrow-left"),_=document.getElementById("modal-drum-grid-bar-arrow-right");D&&(b.numBars===1?D.textContent="1 bar":D.textContent=`Bar ${b.currentBar} of ${b.numBars}`),T&&(T.style.display=b.numBars>1&&b.currentBar>1?"flex":"none"),_&&(_.style.display=b.numBars>1&&b.currentBar<b.numBars?"flex":"none")},Je=D=>{if(D<1||D>b.numBars)return;const T=document.getElementById("modal-time-signature-select"),_=(T==null?void 0:T.value)||this.currentTimeSignature||"4/4",F=Di(_);ti(F),b.currentBar=D,ve();const L=i?i.value:"";if(b.built=!1,Bn(F,L),!b.barTokens||!b.barTokens.length){const z=ft("modal-pattern"),Q=Lt(z);an(F,Q||[])}else ot(F);Vi(F)},Pt=()=>{const D=document.getElementById("modal-time-signature-select"),T=(D==null?void 0:D.value)||this.currentTimeSignature||"4/4",_=Di(T);ti(_),b.numBars++,ot(_);const F=_.totalSteps;b.barTokens[b.numBars-1]=new Array(F).fill("~"),ve(),Je(b.numBars)},li=()=>{!b.active||b.updatingFromPattern||ji()},Bn=(D,T)=>{if(!m)return;const _=T&&rg[T]?rg[T]:vc;if(!(!b.built||b.totalSteps!==D.totalSteps||JSON.stringify(b.currentBankRows)!==JSON.stringify(_)))return;const L=document.getElementById("modal-drum-grid-container");if(!L){console.error("❌ ensureDrumGridBuilt: Drum grid container not found!"),console.error("   Looking for: modal-drum-grid-container"),console.error("   Modal exists:",!!m),m&&console.error("   Drum grid section children:",Array.from(m.children).map(z=>z.id||z.className));return}console.log("🔨 Building drum grid with",_.length,"rows,",D.totalSteps,"steps"),console.log("   Grid container found:",L,"current children:",L.children.length),L.innerHTML="",b.checkboxes={},b.currentBankRows=_,_.forEach(({key:z,label:Q,sample:G})=>{const re=document.createElement("div");re.className="drum-grid-row",re.setAttribute("data-row",z);const Oe=document.createElement("span");Oe.className="drum-grid-row-label",Oe.textContent=Q,re.appendChild(Oe);const ae=document.createElement("div");ae.className="drum-grid-steps",ae.id=`drum-grid-steps-${z}`,ae.style.gridTemplateColumns=`repeat(${D.totalSteps}, minmax(18px, 1fr))`,b.checkboxes[z]=[],D.totalSteps*b.numBars;const fe=(b.currentBar-1)*D.totalSteps,Xe=fe+D.totalSteps;for(let qe=fe;qe<Xe;qe+=1){const We=document.createElement("div");We.className="drum-grid-step";const $e=qe-fe;$e>0&&$e%4===0&&We.classList.add("quarter-boundary");const me=document.createElement("input");me.type="checkbox",me.dataset.row=z,me.dataset.step=String(qe),me.dataset.bar=String(b.currentBar),me.addEventListener("change",li),We.appendChild(me),ae.appendChild(We),b.checkboxes[z].push(me)}re.appendChild(ae),L.appendChild(re)}),ot(D),Vi(D),b.totalSteps=D.totalSteps,b.built=!0},Lt=D=>{if(!D||typeof D!="string")return null;const T=D.match(/(?:s|sound)\(\s*["'`]([^"'`]+)["'`]\s*\)/i);if(!T||!T[1])return null;const _=T[1].trim();return _?_.split(/\s+/).filter(Boolean):null};function Sn(D){if(!D)return[];const T=D.trim();if(!T||T==="~")return[];let _=T;return(_.startsWith("[")&&_.endsWith("]")||_.startsWith("{")&&_.endsWith("}"))&&(_=_.slice(1,-1)),_=_.replace(/[,]+/g," "),_.split(/\s+/).map(F=>F.trim()).filter(Boolean)}function ot(D){b.barTokens||(b.barTokens=[]);const T=D.totalSteps,_=Math.max(1,b.numBars);for(b.barTokens.length>_&&(b.barTokens.length=_);b.barTokens.length<_;)b.barTokens.push(new Array(T).fill("~"));b.barTokens=b.barTokens.map(F=>{const L=Array.isArray(F)?F.slice(0,T):[];for(;L.length<T;)L.push("~");return L})}function an(D,T){const _=D.totalSteps,F=Math.max(1,b.numBars),L=_*F;let z=Array.isArray(T)?T.slice(0,L):[];z.length<L&&(z=z.concat(new Array(L-z.length).fill("~"))),b.barTokens=[];for(let Q=0;Q<F;Q++){const G=Q*_;b.barTokens.push(z.slice(G,G+_))}ot(D)}function ti(D){if(!b.active||b.updatingFromPattern||!b.checkboxes)return;const T=b.currentBar-1;if(T<0)return;ot(D);const _=D.totalSteps,F=b.currentBankRows||vc,L=new Array(_).fill("~");for(let z=0;z<_;z+=1){const Q=[];F.forEach(({key:G,sample:re})=>{const Oe=b.checkboxes[G],ae=Oe?Oe[z]:null;ae&&ae.checked&&Q.push(re)}),Q.length===1?L[z]=Q[0]:Q.length>1&&(L[z]=`[${Q.join(" ")}]`)}b.barTokens[T]=L}function Vi(D){if(!b.checkboxes)return;ot(D);const T=b.currentBar-1,_=b.barTokens[T];if(!_)return;(b.currentBankRows||vc).forEach(({key:L,sample:z})=>{const Q=b.checkboxes[L];Q&&Q.forEach((G,re)=>{if(!G)return;const Oe=Sn(_[re]);G.checked=Oe.includes(z)})})}function ms(){return Array.isArray(b.barTokens)?b.barTokens.flat():[]}const zi=(D,T)=>{if(!m||!b.active)return;const _=Lt(D),F=T.totalSteps;if(_&&_.length){const L=Math.max(1,Math.ceil(_.length/F));b.numBars!==L&&(b.numBars=L,b.currentBar>b.numBars&&(b.currentBar=b.numBars),ve()),an(T,_)}else b.barTokens.length?ot(T):an(T,[]);b.updatingFromPattern=!0,Vi(T),b.updatingFromPattern=!1},xs=D=>(ot(D),ms()),ji=()=>{if(!m||!b.active||!i)return;const D=document.getElementById("modal-time-signature-select"),T=(D==null?void 0:D.value)||this.currentTimeSignature||"4/4",_=Di(T);ti(_);const L=xs(_).join(" "),z=i.value,Q=z&&z!==""?`.bank("${z}")`:"",G=`s("${L}")${Q}`;b.updatingFromGrid=!0,Mt("modal-pattern",G),b.updatingFromGrid=!1},Zi=(D,T)=>{if(!m){console.warn("⚠️ Drum grid section not found");return}const _=i?i.value:"";console.log("🎹 Showing drum grid for bank:",_,"metrics:",D);const F=document.getElementById("modal-drum-grid-container");if(!F){console.error("❌ Drum grid container not found!");return}console.log("✅ Grid container found:",F),Bn(D,_),Ze(D),m.style.display="block",b.active=!0,zi(T,D),ve();const L=F.querySelectorAll(".drum-grid-row");console.log("✅ Drum grid shown, active:",b.active,"rows:",L.length)},ui=()=>{m&&(m.style.display="none",b.active=!1,b.built=!1,b.numBars=1,b.currentBar=1,ve())};yt();const zn=()=>{if(!i){console.log("⚠️ refreshDrumGridForCurrentState: bankSelect not found");return}const D=i.value,T=Et(D);if(console.log("🔄 refreshDrumGridForCurrentState: bankValue=",D,"isDrum=",T,"patternEditorEnabled=",b.patternEditorEnabled),P&&(P.style.display=T?"block":"none"),!T){console.log("📝 Not a drum bank, enabling pattern editor"),pe(!0),ui(),yt();return}const _=ft("modal-pattern");if(_&&_.trim(),Lt(_),b.patternEditorEnabled){console.log("📝 Pattern editor enabled, hiding drum grid"),ui(),yt();return}console.log("🎹 Showing drum grid for drum bank");const F=document.getElementById("modal-time-signature-select"),L=(F==null?void 0:F.value)||this.currentTimeSignature||"4/4",z=Di(L);console.log("🎹 Calling showDrumGrid with metrics:",z,"pattern:",_),Zi(z,_)},Ae=document.getElementById("modal-pattern");Ae&&Ae.addEventListener("input",()=>{if(!b.active||b.updatingFromGrid||!i||!Et(i.value))return;const D=document.getElementById("modal-time-signature-select"),T=(D==null?void 0:D.value)||this.currentTimeSignature||"4/4",_=Di(T),F=Ae.value?Ae.value.trim():"",L=Lt(Ae.value);if(F&&(!L||L.length===0)){pe(!0),ui();return}zi(Ae.value,_)});const Ut=D=>{var Q;if(!D)return;const T=this.currentEditingElementId;if(T){const G=document.getElementById("modal-title");G&&(G.value=D.label);const re=document.getElementById("modal-element-id");if(re&&(re.textContent=ir(T)),mi(T,D.label),typeof this.saveElementConfig=="function"){const ae={...((Q=this.loadElementConfig)==null?void 0:Q.call(this,T))||{},title:D.label};this.saveElementConfig(T,ae,!0)}}const _=typeof D.bank=="string"?D.bank:"",F=()=>{if(typeof D.useNoteNames=="boolean")return D.useNoteNames;const G=D.pattern||"";return G.includes("note(")||G.includes('note("')},L=()=>{if(D.pattern){const G=document.getElementById("modal-keep-notes-as-written");G&&(G.checked=F()),Mt("modal-pattern",D.pattern.trim()),oe()}_&&Et(_)?(pe(!1),zn()):(pe(!0),ui(),yt()),Ae&&Ae.focus()},z=document.getElementById("modal-keep-notes-as-written");if(z&&(z.checked=F()),i){const G=_||"";if(i.value!==G){i.value=G,i.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(L,60);return}}L()};se();const Le=D=>{if(!D||!D.classList.contains("has-tooltip"))return;const T=D.getBoundingClientRect();if(T.width===0&&T.height===0){requestAnimationFrame(()=>Le(D));return}const _=(e==null?void 0:e.querySelector(".modal-presets-content"))||e,F=_?_.getBoundingClientRect():{left:0,width:window.innerWidth},L=F.left+F.width/2,Q=T.left+T.width/2>L;D.classList.toggle("tooltip-align-right",Q),D.classList.toggle("tooltip-align-left",!Q)};let bt=null;const tt=()=>{bt||(bt=requestAnimationFrame(()=>{bt=null;const D=e==null?void 0:e.querySelectorAll(".modal-preset-button.has-tooltip");D==null||D.forEach(T=>Le(T))}))};window.addEventListener("resize",tt);const ni=(D,T)=>{!D||!Array.isArray(T)||(D.innerHTML="",T.forEach(_=>{const F=document.createElement("button");F.type="button",F.className="modal-preset-button";const L=_.editorBadge?`<span class="modal-preset-badge${_.editorBadge.toLowerCase().includes("code")?" is-code":_.editorBadge.toLowerCase().includes("step")?" is-step":""}">${_.editorBadge}</span>`:"",z=_.secondaryLabel?`<div class="modal-preset-secondary-row">${_.secondaryLabel}</div>`:"";F.innerHTML=`
          <div class="modal-preset-heading-row">
            <strong>${_.label}</strong>
            ${L}
          </div>
          ${z}
          ${_.description?`<span class="modal-preset-description">${_.description}</span>`:""}
        `,_.tooltip&&(F.classList.add("has-tooltip"),F.setAttribute("data-tooltip",_.tooltip),F.addEventListener("mouseenter",()=>Le(F)),F.addEventListener("focus",()=>Le(F)),requestAnimationFrame(()=>Le(F))),F.addEventListener("click",()=>Ut(_)),D.appendChild(F)}),tt())},Es=()=>{e.querySelectorAll(".modal-presets-subtoggle").forEach(T=>{const _=T.getAttribute("data-target"),F=_?document.getElementById(_):T.nextElementSibling;if(!F)return;const L=Q=>{T.setAttribute("aria-expanded",String(Q)),F.classList.toggle("is-open",Q);const G=T.closest(".modal-presets-group");G&&G.classList.toggle("collapsed",!Q)},z=F.classList.contains("is-open");L(z),T.addEventListener("click",()=>{const Q=T.getAttribute("aria-expanded")!=="true";L(Q)})})};A&&B&&A.addEventListener("click",()=>{const T=!(A.getAttribute("aria-expanded")==="true");H(T)}),ni(Z,r5),ni(q,ob),ni(X,a5),Es(),P&&P.addEventListener("change",D=>{const T=D.target.value==="code";pe(T),zn()});const wn=document.getElementById("modal-time-signature-select");wn&&wn.addEventListener("change",D=>{const T=D.target.value;if(T&&(this.currentTimeSignature=T,b.active)){const _=Di(T),F=ft("modal-pattern"),L=i?i.value:"";Bn(_,L),Ze(_),Zi(_,F)}});const ci=document.getElementById("modal-drum-grid-bar-count"),jn=document.getElementById("modal-drum-grid-add-bar"),$t=document.getElementById("modal-drum-grid-bar-arrow-left"),Gi=document.getElementById("modal-drum-grid-bar-arrow-right");ci&&(ci.addEventListener("click",()=>{const D=b.currentBar<b.numBars?b.currentBar+1:1;Je(D)}),ci.style.cursor="pointer",ci.title="Click to switch between bars"),$t&&$t.addEventListener("click",D=>{D.stopPropagation(),b.currentBar>1&&Je(b.currentBar-1)}),Gi&&Gi.addEventListener("click",D=>{D.stopPropagation(),b.currentBar<b.numBars&&Je(b.currentBar+1)}),jn&&jn.addEventListener("click",D=>{D.stopPropagation(),Pt()}),this.applyTimeSignatureToDrumGrid=D=>{if(!m||!b.active)return;const T=Di(D||"4/4"),_=ft("modal-pattern"),F=i?i.value:"";Bn(T,F),Ze(T),Zi(T,_)};const ks=e.querySelector(".modal-close");ks&&ks.addEventListener("click",Ke);const wt=document.getElementById("modal-sample-file");wt&&wt.addEventListener("change",D=>{var z,Q;const T=D.target.files&&D.target.files.length>0?D.target.files[0]:null,_=(z=document.getElementById("modal-pattern-bank"))==null?void 0:z.closest(".form-group"),F=(Q=document.getElementById("modal-time-signature-select"))==null?void 0:Q.closest(".form-group"),L=document.getElementById("modal-title");if(T){if(_&&(_.style.display="none"),F&&(F.style.display="none"),L){const re=T.name.replace(/\.[^/.]+$/,"");L.value=re}}else _&&(_.style.display="block")});const dt=document.getElementById("modal-key-select"),Kt=document.getElementById("modal-scale-select"),K={container:document.getElementById("modal-scale-chord-suggestions"),title:document.getElementById("modal-scale-chord-title"),characteristic:document.getElementById("modal-scale-characteristic"),dropdown:document.getElementById("modal-chord-progression-select")},te=(D,T)=>{try{const _=D.trim(),F=T.map(z=>z);return cP.fromRomanNumerals(_,F).filter(Boolean).map((z,Q)=>!z||z===""?T[Q]:z)}catch(_){return console.warn("Error converting Roman numerals to chords:",_,"Romans:",T),T.map(F=>F.replace(/b/g,"♭").replace(/#/g,"♯"))}},Y={ionian:{displayName:"Ionian (Major)",colorTone:"7 (natural)",progressions:{"2-chord":[{label:"I – IV",romans:["I","IV"]},{label:"I – V",romans:["I","V"]},{label:"I – vi",romans:["I","vi"]}],"3-chord":[{label:"I – IV – V",romans:["I","IV","V"]},{label:"I – V – vi",romans:["I","V","vi"]},{label:"I – iii – vi",romans:["I","iii","vi"]}],"4-chord":[{label:"I – IV – V – I",romans:["I","IV","V","I"]},{label:"I – vi – IV – V",romans:["I","vi","IV","V"]},{label:"I – V – vi – IV (pop classic)",romans:["I","V","vi","IV"]}]}},dorian:{displayName:"Dorian",colorTone:"natural 6 in a minor scale",progressions:{"2-chord":[{label:"i – IV",romans:["i","IV"]},{label:"i – ii",romans:["i","ii"]}],"3-chord":[{label:"i – IV – v",romans:["i","IV","v"]},{label:"i – ii – IV",romans:["i","ii","IV"]},{label:"i – IV – VII",romans:["i","IV","VII"]}],"4-chord":[{label:"i – IV – i – v",romans:["i","IV","i","v"]},{label:"i – ii – IV – i",romans:["i","ii","IV","i"]},{label:"i – IV – vii° – i",romans:["i","IV","vii°","i"]}]}},phrygian:{displayName:"Phrygian",colorTone:"♭2 (very dark/tense)",progressions:{"2-chord":[{label:"i – ♭II",romans:["i","bII"]},{label:"i – v",romans:["i","v"]}],"3-chord":[{label:"i – ♭II – i",romans:["i","bII","i"]},{label:"i – v – ♭II",romans:["i","v","bII"]}],"4-chord":[{label:"i – ♭II – vii – i",romans:["i","bII","vii","i"]},{label:"i – v – ♭II – i",romans:["i","v","bII","i"]}]}},lydian:{displayName:"Lydian",colorTone:"♯4 (bright, dreamy, floaty)",progressions:{"2-chord":[{label:"I – II",romans:["I","II"]},{label:"I – Vmaj7",romans:["I","Vmaj7"]}],"3-chord":[{label:"I – II – I",romans:["I","II","I"]},{label:"I – V – II",romans:["I","V","II"]}],"4-chord":[{label:"I – II – V – I",romans:["I","II","V","I"]},{label:"I – vii – II – I",romans:["I","vii","II","I"]}]}},mixolydian:{displayName:"Mixolydian",colorTone:"♭7 (rock-dominant sound)",progressions:{"2-chord":[{label:"I – ♭VII",romans:["I","bVII"]},{label:"I – v",romans:["I","v"]}],"3-chord":[{label:"I – ♭VII – IV",romans:["I","bVII","IV"]},{label:"I – IV – ♭VII",romans:["I","IV","bVII"]}],"4-chord":[{label:"I – ♭VII – IV – I",romans:["I","bVII","IV","I"]},{label:"I – v – ♭VII – IV",romans:["I","v","bVII","IV"]}]}},aeolian:{displayName:"Aeolian (Natural Minor)",colorTone:"♭6",progressions:{"2-chord":[{label:"i – ♭VI",romans:["i","bVI"]},{label:"i – ♭VII",romans:["i","bVII"]}],"3-chord":[{label:"i – ♭VII – ♭VI",romans:["i","bVII","bVI"]},{label:"i – iv – ♭VI",romans:["i","iv","bVI"]}],"4-chord":[{label:"i – ♭VII – ♭VI – v",romans:["i","bVII","bVI","v"]},{label:"i – iv – ♭VII – ♭VI",romans:["i","iv","bVII","bVI"]}]}},locrian:{displayName:"Locrian",colorTone:"♭2, ♭5 (very unstable)",progressions:{"2-chord":[{label:"iø – ♭II",romans:["iø","bII"]},{label:"iø – v",romans:["iø","v"]}],"3-chord":[{label:"iø – ♭II – iø",romans:["iø","bII","iø"]},{label:"iø – v – ♭II",romans:["iø","v","bII"]}],"4-chord":[{label:"iø – ♭II – v – iø",romans:["iø","bII","v","iø"]}]}},"melodic minor":{displayName:"Melodic Minor (Jazz Minor)",colorTone:"i−maj7",progressions:{"2-chord":[{label:"i−maj7 – IV7",romans:["imMaj7","IV7"]}],"3-chord":[{label:"i−maj7 – IV7 – v",romans:["imMaj7","IV7","v"]}],"4-chord":[{label:"i−maj7 – ii – IV7 – i−maj7",romans:["imMaj7","ii","IV7","imMaj7"]}]}},"lydian dominant":{displayName:"Lydian Dominant",colorTone:"♯11",progressions:{"2-chord":[{label:"I7 – II",romans:["I7","II"]}],"3-chord":[{label:"I7 – ♭VII – II",romans:["I7","bVII","II"]}],"4-chord":[{label:"I7 – iiø – ♭VII – I7",romans:["I7","iiø","bVII","I7"]}]}},altered:{displayName:"Altered (Super-Locrian)",colorTone:"V7alt",progressions:{"2-chord":[{label:"V7alt → i",romans:["V7alt","i"]},{label:"V7alt → Imaj7",romans:["V7alt","Imaj7"]}],"3-chord":[{label:"iiø – V7alt – i",romans:["iiø","V7alt","i"]}]}},"harmonic minor":{displayName:"Harmonic Minor",colorTone:"i−maj7",progressions:{"2-chord":[{label:"i – V",romans:["i","V"]}],"3-chord":[{label:"i – iv – V",romans:["i","iv","V"]}],"4-chord":[{label:"i – iv – V – i",romans:["i","iv","V","i"]}]}},"phrygian dominant":{displayName:"Phrygian Dominant",colorTone:"Major chord on ♭II + dominant on V",progressions:{"2-chord":[{label:"i – ♭II",romans:["i","bII"]},{label:"V – i",romans:["V","i"]}],"3-chord":[{label:"V – ♭II – i",romans:["V","bII","i"]}],"4-chord":[{label:"i – ♭II – V – i",romans:["i","bII","V","i"]}]}},"dorian #4":{displayName:"Ukrainian Dorian (Dorian ♯4)",colorTone:"Dorian ♯4",progressions:{"2-chord":[{label:"i – IV",romans:["i","IV"]}],"3-chord":[{label:"i – ♭VII – IV",romans:["i","bVII","IV"]}],"4-chord":[{label:"i – iv – ♭VII – IV",romans:["i","iv","bVII","IV"]}]}},"whole tone":{displayName:"Whole Tone",colorTone:"V7♯5",progressions:{"2-chord":[{label:"V7♯5 – V7♯5",romans:["V7#5","V7#5"]},{label:"V7♯5 – I",romans:["V7#5","I"]}],"3-chord":[{label:"V7♯5 – ♭III+ – V7♯5",romans:["V7#5","bIII+","V7#5"]}]}},"half-whole diminished":{displayName:"Half–Whole Diminished",colorTone:"V7♭9♯11♭13",progressions:{"2-chord":[{label:"V7♭9 – V7♭9",romans:["V7b9","V7b9"]}],"3-chord":[{label:"iiø – V7♭9 – i",romans:["iiø","V7b9","i"]}]}},"whole-half diminished":{displayName:"Whole–Half Diminished",colorTone:"°7",progressions:{"2-chord":[{label:"°7 – °7",romans:["°7","°7"]}],"3-chord":[{label:"°7 – °7 – °7",romans:["°7","°7","°7"]}],"4-chord":[{label:"°7 – ♭III – vi – °7",romans:["°7","bIII","vi","°7"]}]}}},de=D=>!D||typeof D!="string"?"":D.replace(/bb(?=\d)/gi,"♭♭").replace(/b(?=\d)/gi,"♭").replace(/#(?=\d)/g,"♯").split(/\s+/).filter(Boolean).map(_=>_.charAt(0).toUpperCase()+_.slice(1)).join(" "),p=()=>{const D=document.getElementById("modal-scale-notes-display");if(!D)return;const T=dt?(dt.value||"").trim():"",_=Kt?(Kt.value||"").trim():"";if(!_||_==="chromatic"){D.textContent="";return}try{const L={major:"major",minor:"minor",chromatic:"chromatic",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic",ionian:"major",aeolian:"minor","melodic minor":"melodic minor","dorian b2":"dorian b2","lydian augmented":"lydian augmented","lydian dominant":"lydian dominant","mixolydian b6":"mixolydian b6","locrian #2":"locrian #2",altered:"altered","harmonic minor":"harmonic minor","locrian #6":"locrian #6","ionian #5":"ionian #5","dorian #4":"dorian #4","phrygian dominant":"phrygian dominant","lydian #2":"lydian #2",ultralocrian:"ultralocrian","harmonic major":"harmonic major","dorian b5":"dorian b5","phrygian b4":"phrygian b4","lydian b3":"lydian b3","mixolydian b2":"mixolydian b2","lydian augmented #2":"lydian augmented #2","locrian bb7":"locrian bb7","major pentatonic":"major pentatonic","suspended pentatonic":"suspended pentatonic","man gong":"man gong",ritusen:"ritusen","minor pentatonic":"minor pentatonic","blues minor pentatonic":"minor pentatonic","major pentatonic mode 3":"major pentatonic",egyptian:"egyptian","whole tone":"whole tone","half-whole diminished":"dominant diminished","whole-half diminished":"diminished","minor blues":"blues"}[_.toLowerCase()]||_.toLowerCase();let z="C";if(T){const fe=T.trim().match(/^([a-gA-G])([#b]?)/);fe?z=`${fe[1].toUpperCase()}${fe[2]||""}`:z=T.trim()}const Q=`${z} ${L}`,G=va.get(Q);if(!G||!G.notes||G.notes.length===0){D.textContent="";return}const Oe=G.notes.map((fe,Xe)=>`${fe.replace(/-?\d+$/,"")} = ${Xe}`),ae=`<strong>${z.toLowerCase()}:${L}</strong> ${Oe.join(", ")}`;D.innerHTML=ae}catch(F){console.warn("Error displaying scale notes:",F),D.textContent=""}},w=()=>{if(!K.container||!K.dropdown)return;const D=dt?(dt.value||"").trim():"",T=Kt?(Kt.value||"").trim():"";if(K.dropdown.innerHTML='<option value="">Select a progression...</option>',!D||!T){K.container.style.display="none",K.container.dataset.state="idle",K.title&&(K.title.textContent="Select a key and scale to view chord progressions."),K.characteristic&&(K.characteristic.textContent="");return}const _=T.toLowerCase(),F=Y[_],L=(F==null?void 0:F.displayName)||de(T);if(K.container.style.display="block",K.title&&(K.title.textContent=`${D} ${L} Chord Progressions`),!F||!F.progressions){K.container.dataset.state="placeholder",K.characteristic&&(K.characteristic.textContent="No chord progressions available for this scale yet.");return}K.container.dataset.state="ready",K.characteristic&&(K.characteristic.textContent=`Color tone: ${F.colorTone||"N/A"}`),["2-chord","3-chord","4-chord"].forEach(Q=>{const G=F.progressions[Q];if(G&&G.length>0){const re=document.createElement("optgroup");re.label=Q.charAt(0).toUpperCase()+Q.slice(1).replace("-"," "),G.forEach(Oe=>{const ae=document.createElement("option"),fe=te(D,Oe.romans),Xe=fe.length>0?`${Oe.label} (${fe.join(" – ")})`:Oe.label;ae.value=JSON.stringify({romans:Oe.romans,label:Oe.label}),ae.textContent=Xe,re.appendChild(ae)}),K.dropdown.appendChild(re)}})};w(),p(),K.dropdown&&K.dropdown.addEventListener("change",D=>{const T=D.target.value;if(!(!T||T===""))try{const _=JSON.parse(T),F=dt?(dt.value||"").trim():"";if(!F){console.warn("No key selected for chord progression");return}const L=te(F,_.romans);if(L.length>0){let Q=ft("modal-pattern")||"";Q=Q.replace(/\bn\s*\([^)]*\)\s*\.\s*scale\s*\([^)]*\)(?:\s*\.\s*[a-zA-Z]+\s*\([^)]*\))*/gi,""),Q=Q.replace(/\bn\s*\(["'][^"']*["']\)\s*\.\s*scale\s*\(["'][^"']*["']\)(?:\s*\.\s*[a-zA-Z]+\s*\([^)]*\))*/gi,""),Q=Q.replace(/^\s*\.\s*/,"").replace(/\s*\.\s*$/,"").trim();const re=`n().chord("<${L.join(" ")}>").voicing()`;Mt("modal-pattern",re)}}catch(_){console.warn("Error parsing chord progression data:",_)}});const S=D=>{if(typeof D!="string")return!1;let T=0,_=!1,F="";for(let L=0;L<D.length;L++){const z=D[L];if(_){if(z==="\\"){L++;continue}z===F&&(_=!1,F="");continue}if(z==='"'||z==="'"){_=!0,F=z;continue}if(z==="("&&T++,z===")"&&T--,T<0)return!1}return!_&&T===0},x=(D,T,_=!1)=>{if(!D||!D.trim())return D;let F=D.trim();if(_){const L=/\.\s*bank\s*\(\s*["'][^"']*["']\s*\)/gi;L.test(F)?F=F.replace(L,`.bank("${T}")`):F=`${F}.bank("${T}")`}else{const L=/\.\s*(s|sound)\s*\(\s*["'][^"']*["']\s*\)/gi;L.test(F)?F=F.replace(L,`.s("${T}")`):F=`${F}.s("${T}")`}return F},N=D=>{if(!D||!D.trim())return"";const T=D.trim();if(/(\.\s*(bank|s|sound)\s*\()|(\b(note|n|stack|sound)\s*\()/i.test(T))return T;const F=S5(T);return F?F.trim():""},W=(D,T,_,F)=>{let z=(D||"").trim();const Q=/\.\s*(s|sound|scale)\s*\(/i.test(z);z?(!z.startsWith("(")||!z.endsWith(")"))&&(Q||(z=`(${z})`)):z="(silence)";const G=z.match(/\.\s*scale\s*\(\s*['"]([^'"]+)['"]\s*\)/i),re=G?G[1]:null,Oe=z.match(/\.\s*(s|sound)\s*\(\s*["']([^"']+)["']\s*\)/i),ae=Oe?Oe[2]:null;let fe=z.replace(/\.\s*scale\s*\([^)]*\)/gi,"").replace(/\.\s*(s|sound)\s*\([^)]*\)/gi,"");if(_&&_.trim()!==""||T&&T.trim()!==""){const qe=T&&T.trim()!==""?T.trim().toLowerCase():"c",We=_&&_.trim()!==""?_.trim():"major";fe=`${fe}.scale('${qe}:${We}')`}else re&&(fe=`${fe}.scale('${re}')`);return ae&&(fe=`${fe}.s("${ae}")`),fe},J=(D=!1)=>{w(),p();const T=ft("modal-pattern"),_=dt&&dt.value||null,F=Kt&&Kt.value||null;if(console.log(`🎼 applyKeyScaleToPattern called: keyValue="${_}", scaleValue="${F}"`),!_&&!F){console.log("⚠️ No key/scale selected, skipping");return}const L=document.getElementById("modal-keep-notes-as-written"),z=D||L&&L.checked,Q=_&&_.trim()!==""?_:null,G=F&&F.trim()!==""?F:null;if(!T||T.trim()===""||!Un(T)){let $e=null;if(T&&T.trim()!==""){const ue=T.match(/\.\s*(s|sound)\s*\(\s*["']([^"']+)["']\s*\)/i);ue&&ue[2]&&($e=ue[2])}if(!$e){const ue=document.getElementById("modal-pattern-bank");ue&&ue.value&&($e=ue.value.toLowerCase())}let me="";if(z){if(typeof this.getAllScaleNotesAsNoteNames=="function"&&(me=this.getAllScaleNotesAsNoteNames(_||"C",F||"chromatic")||""),!me){const ue=this.getAllScaleNotesAsPattern(_||"C",F||"chromatic");ue&&(me=this.convertNumericPatternToNoteNames(ue,_||"C",F||"chromatic"))}}else{const ue=this.getAllScaleNotesAsPattern(_||"C",F||"chromatic");if(ue){const ze=ue.match(/(?:note|n)\s*\(\s*["']([^"']+)["']\s*\)/),Ue=ze?ze[1]:"0 1 2 3 4 5",mt=`${(_||"C").toLowerCase()}:${F||"chromatic"}`;me=`n("${Ue}").scale('${mt}')`}}if(!me){console.warn("⚠️ Could not generate scale notes for empty/non-note pattern");return}$e&&(me=`${me}.s("${$e}")`),S(me)?(Mt("modal-pattern",me),console.log(`🎼 Inserted scale notes for empty/non-note pattern: ${me}`)):console.warn("⚠️ Generated scale-notes pattern failed quick syntax check; not applying");return}const re=/\b(note|n)\s*\(/.test(T),Oe=/\b(note|n)\s*\(\s*["'][a-g][#b]?/.test(T),ae=/\b(note|n)\s*\(\s*["'][a-g][#b]?[a-z0-9]*\s*[a-z]/.test(T)||/\b(note|n)\s*\(\s*["'][^"']*\b(maj|min|m|dim|aug|sus|add|7|9|11|13)\b/i.test(T),fe=/\.\s*chord\s*\(/i.test(T),Xe=/\b(note|n)\s*\(\s*["'][^"']*[a-g][#b]?\s/.test(T),qe=Oe||ae||Xe||fe,We=re&&!qe&&!fe;if(qe&&!We){console.log("ℹ️ Pattern uses explicit note names – skipping key/scale rewrite");return}if(re&&Mi(T)&&!qe&&!fe){const $e=cn(Q,G);if(!$e){console.log("ℹ️ Numeric pattern: no scale selected, skipping rewrite");return}let me=T.replace(/\.\s*scale\s*\((['"])(?:(?=(\\?))\2.)*?\1\)/gi,"");me=me.replace(/\.\s*scale\s*\([^)]*\)/gi,""),me=me.replace(/\.+/g,".").replace(/\.\s*\./g,".").trim(),me=me.replace(/\.+$/,"").trim(),me=wr(me,$e),Mt("modal-pattern",me),Ui(me,!0),console.log(`ℹ️ Numeric pattern updated with scale modifier ${$e}`);return}if(z&&Oe&&!fe){const $e=V.convertNoteNamesToSemitones(T),me=Q||"C",ue=G||"chromatic";let ze=$e?this.convertNumericPatternToNoteNames($e,me,ue):null;if((!ze||ze===T)&&(ze=this.convertNumericPatternToNoteNames(T,me,ue)),ze&&ze!==T){const Ue=cn(Q,G);Ue&&(Ce=Ue),lt=!0,Ui(ze,!0),Mt("modal-pattern",ze),Q&&(V.currentKey=Q),G&&(V.currentScale=G);const mt=document.getElementById("modal-pattern");if(mt){try{mt.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{mt.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}}console.log(`🎼 Converted note names to new key/scale: ${ze.substring(0,120)}...`);return}else console.log(`⚠️ Note names unchanged after conversion attempt (key=${me}, scale=${ue})`)}if(!fe&&We){console.log(`🎼 applyKeyScaleToPattern: keyValue="${_}", scaleValue="${F}", pattern="${T.substring(0,50)}..."`);let $e=T;if(G&&(Q||G))if(z){const ue=/\b(note|n)\s*\(\s*["'][a-gA-G][#b]?\d/.test(T);if(/\b(n|note)\s*\(\s*["'][\d\s]+["']/.test(T)&&!ue)$e=this.convertNumericPatternToNoteNames(T,Q,G),console.log(`🎼 Converted numeric pattern to note names in ${G}: ${$e.substring(0,100)}...`);else if(ue){const Ue=V.convertNoteNamesToSemitones(T);Ue&&Ue!==T?($e=this.convertNumericPatternToNoteNames(Ue,Q,G),console.log(`🎼 Converted note names to ${G} scale: ${$e.substring(0,100)}...`)):$e=this.convertNumericPatternToNoteNames(T,Q,G)}try{const Ue=this.getAllScaleNotesAsPattern(Q||"C",G||"chromatic");if(Ue){const rt=this.convertNumericPatternToNoteNames(Ue,Q||"C",G||"chromatic").match(/\b(note|n)\s*\(\s*["']([^"']+)["']\s*\)/i),st=$e.match(/\b(note|n)\s*\(\s*["']([^"']+)["']\s*\)/i);if(rt&&st){const Tt=rt[2];$e=$e.replace(/\b(note|n)\s*\(\s*["'][^"']+["']\s*\)/i,(Fe,Qt)=>`${Qt}("${Tt}")`),console.log(`🎼 Resized note names to match scale: ${Tt}`)}}}catch{}}else{const ue=W(T,Q,G);if(S(ue)){$e=ue;const ze=$e.match(/\b(n|note)\s*\(\s*["']([^"']+)["']\s*\)/i);if(ze&&ze[2]){const Ue=ze[2].trim().split(/\s+/).map(rt=>parseInt(rt,10)).filter(rt=>!isNaN(rt)),mt=this.getAllScaleNotesAsPattern(Q||"C",G||"chromatic");if(mt){const rt=mt.match(/\b(n|note)\s*\(\s*["']([^"']+)["']\s*\)/i),st=rt?rt[2]:null;if(st){const Tt=st.trim().split(/\s+/).length;Ue.length!==Tt&&($e=$e.replace(/\b(n|note)\s*\(\s*["'][^"']+["']\s*\)/i,(Fe,Qt)=>`${Qt}("${st}")`),console.log(`🎼 Resized numeric degrees to match scale (${Tt} steps): ${st}`))}}}}else $e=T;console.log(`🎼 Semitone mode: upserted scale=${G} key=${Q}`)}let me=$e;if(console.log(`🎼 applyKeyScaleToPattern: result="${me?me.substring(0,80):"null"}..."`),console.log(`🎼 Pattern comparison - original length: ${T.length}, new length: ${me?me.length:0}, same: ${me===T}`),!z&&me&&Mi(me)){const ue=ia(me,Q,G);ue&&ue!==me&&(me=ue,console.log(`🎼 Normalized numeric pattern to scale degrees (${G||"chromatic"})`))}if(!z&&me&&(Q||G))try{const ue=this.getAllScaleNotesAsPattern(Q||"C",G||"chromatic"),ze=ue&&ue.match(/\b(n|note)\s*\(\s*["']([^"']+)["']\s*\)/i),Ue=ze?ze[2]:null,mt=me.match(/\b(n|note)\s*\(\s*["']([^"']+)["']\s*\)/i);if(Ue&&mt&&mt[2]){const Fe=mt[2].trim().split(/\s+/);Fe.every(xe=>/^-?\d+$/.test(xe))&&Fe.every((xe,Nt)=>parseInt(xe,10)===Nt)&&(me=me.replace(/\b(n|note)\s*\(\s*["'][^"']+["']\s*\)/i,(xe,Nt)=>`${Nt}("${Ue}")`),console.log(`🎼 Resized numeric degrees to match scale (${G||"chromatic"}): ${Ue}`))}const rt=Q||"C",st=G||"chromatic",Tt=this.convertNumericPatternToNoteNames(me,rt,st);if(Tt){const Fe=V.convertNoteNamesToScaleDegrees(Tt,rt,st);Fe&&S(Fe)&&(me=Fe,console.log(`🎼 Normalized numeric degrees to scale length (${st})`))}}catch(ue){console.warn("⚠️ Degree resize failed:",ue)}if(z&&(Q||G)){const ue=cn(Q||null,G||null);ue&&(Ce=ue)}if(me){!z&&Mi(me)&&(me=ia(me,Q,G),En=me),lt=!1,Ui(me,!0),Mt("modal-pattern",me),Q&&(V.currentKey=Q),G&&(V.currentScale=G);const ue=document.getElementById("modal-pattern");if(ue){try{ue.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{ue.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}}console.log(`✅ Applied key/scale to pattern immediately: ${me.substring(0,100)}...`)}else console.log("⚠️ Pattern unchanged - applyGlobalSettingsToPattern returned null or undefined")}else if(!fe&&qe&&!z){const $e=le(T);let me=Q||null,ue=G||null;$e&&(me=me||$e.key||null,ue=ue||$e.scale||null);const ze=me||"C",Ue=ue||"chromatic",mt=V.convertNoteNamesToScaleDegrees(T,ze,Ue),st=(ia(mt||T,Q,G)||T).replace(/\.\s*scale\s*\([^)]*\)/gi,""),Tt=wr(st,cn(Q,G));if(S(Tt)){Mt("modal-pattern",Tt),Q&&(V.currentKey=Q),G&&(V.currentScale=G);const Fe=document.getElementById("modal-pattern");if(Fe){try{Fe.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{Fe.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}}console.log(`✅ Converted note names to semitone degrees for scale: ${Tt.substring(0,120)}...`)}else console.log("⚠️ Conversion to semitones or upsert failed validation; leaving pattern unchanged")}else console.log(`⚠️ Cannot apply scale - hasChordModifier: ${fe}, isNumericPattern: ${We}, hasNoteFunction: ${re}, hasExplicitNotes: ${qe}`)};dt&&!dt.dataset.listenerAttached&&(dt.addEventListener("change",()=>{p(),J(!1)}),dt.dataset.listenerAttached="true"),Kt&&!Kt.dataset.listenerAttached&&(Kt.addEventListener("change",()=>{p(),J(!1)}),Kt.dataset.listenerAttached="true"),p();const le=D=>{const T=D.match(/\.\s*scale\s*\(\s*['"]([^'"]+)['"]\s*\)/i);if(T&&T[1]){const _=T[1];if(_.includes(":")){const[F,L]=_.split(":");return{key:F.trim(),scale:L.trim()}}else return{key:"C",scale:_.trim()}}return null};let Ce=null,Ye=null,lt=!1,En=null,Zn=null,Pi=null,Ai=null;const cn=(D,T)=>{const _=D&&D.trim()!=="",F=T&&T.trim()!=="";if(!_&&!F)return null;const L=_?D.trim().toLowerCase():"c",z=F?T.trim():"major";return`.scale('${L}:${z}')`},lu=D=>{if(!D||typeof D!="string")return null;const T=D.match(/\bnote\s*\(\s*["']([^"']+)["']/i);if(!T||!T[1])return null;const F=T[1].match(/([a-gA-G])([#b]?)/);if(!F)return null;const L=F[1].toUpperCase(),z=F[2]?F[2]:"";return`${L}${z}`},Ui=(D,T=!1)=>{if(!D||!Un(D)){Ye=null,lt=!1;return}if(lt&&!T)return;if(Mi(D)){Ye=D;return}const _=V.convertNoteNamesToSemitones(D);_&&Mi(_)&&(Ye=_)},wr=(D,T)=>{if(!D||!T||/\.\s*scale\s*\(/i.test(D))return D;const _=D.search(/\.(s|sound)\s*\(/i);if(_!==-1){const L=D.slice(0,_),z=D.slice(_);return`${L}${T}${z}`}const F=D.trim();return F.startsWith("(")&&F.endsWith(")")?`${D}${T}`:`(${D})${T}`},ia=(D,T,_)=>{if(!D||!Mi(D))return D;const F=!T||!T.trim()||!_||!_.trim()?le(D):null,L=T&&T.trim()||(F==null?void 0:F.key)||"C",z=_&&_.trim()||(F==null?void 0:F.scale)||"chromatic",Q=this.convertNumericPatternToNoteNames(D,L,z);if(!Q)return D;const G=V.convertNoteNamesToScaleDegrees(Q,L,z);if(G&&Mi(G)){const re=V.getScaleSemitoneSteps(L,z);if(!re||re.length===0)return G;const Oe=re.length;return(fe=>{const Xe=/\b(n|note)\s*\(\s*(["'])([\s\S]*?)\2\s*\)/gi;return fe.replace(Xe,(qe,We,$e,me)=>{const ue=me.trim().split(/\s+/);if(ue.length<=Oe)return qe;const ze=ue.map(rt=>{const st=parseInt(rt,10);return Number.isFinite(st)?st:null});if(ze.some(rt=>rt===null)||!ze.every((rt,st)=>rt===st))return qe;const mt=Array.from({length:Oe},(rt,st)=>String(st)).join(" ");return`${We}(${$e}${mt}${$e})`})})(G)}return D},uu=(D,T,_=!1)=>{if(!D||!Un(D))return D;const F=V.patternHasNoteNames&&V.patternHasNoteNames(D)||/\b(note|n)\s*\(\s*["'][^"']*[a-gA-G][#b]?\d/i.test(D),L=V.patternHasNumericNotePattern&&V.patternHasNumericNotePattern(D)||/\b(note|n)\s*\(\s*["'][\d\s\-~<>[\]]+["']/i.test(D)&&!F;if(T){if(L&&!F){lt||(Ye=D),lt=!0;const z=le(D),Q=document.getElementById("modal-key-select"),G=document.getElementById("modal-scale-select");let re=Q&&Q.value||null,Oe=G&&G.value||null;return z&&(re=z.key,Oe=z.scale,console.log(`🎼 Using scale from pattern .scale() modifier: ${re}:${Oe}`)),re||Oe?t.convertNumericPatternToNoteNames(D,re,Oe||"major"):(console.log("⚠️ No key/scale selected, using C major for conversion"),t.convertNumericPatternToNoteNames(D,"C","major"))}return D}else{if(F&&!L){if(lt=!1,Ye&&Mi(Ye))return console.log("🔁 Restoring semitone snapshot for note-name toggle"),Ye;const z=le(D);let Q=null,G=null;if(z)Q=z.key,G=z.scale;else{const Oe=lu(D);if(Oe)Q=Oe,G="chromatic";else{const ae=document.getElementById("modal-key-select"),fe=document.getElementById("modal-scale-select");Q=ae&&ae.value||"C",G=fe&&fe.value||"chromatic"}}let re=V.convertNoteNamesToScaleDegrees(D,Q||"C",G||"chromatic");if(re&&re!==D){const Oe=cn(Q||"C",G||"chromatic");return Oe&&(re=wr(re,Oe)),console.log(`🔄 Converted note names to scale degrees: ${re.substring(0,80)}...`),Ui(re,!0),En=re,re}return D}return D}},Hs=document.getElementById("modal-keep-notes-as-written");Hs&&!Hs.dataset.listenerAttached&&(Hs.addEventListener("change",()=>{const D=ft("modal-pattern"),T=Hs.checked;let _;T&&Pi&&Ai&&D===Ai?(_=Pi,console.log("🔁 Restoring original note-name pattern from snapshot")):!T&&Zn&&D===Zn&&En?(_=En,console.log("🔁 Restoring canonical numeric pattern from snapshot")):_=uu(D,T,!0);const F=document.getElementById("modal-key-select"),L=document.getElementById("modal-scale-select");if(T?lt=!0:lt=!1,T&&_){const z=/\.\s*scale\s*\((['"])(?:(?=(\\?))\2.)*?\1\)/gi,Q=_.match(z);if(Q&&Q.length>0)Ce=Q[Q.length-1];else{const G=cn(F==null?void 0:F.value,L==null?void 0:L.value);G&&(Ce=G)}_=_.replace(z,""),_=_.replace(/\.\s*scale\s*\([^)]*\)/gi,""),_=_.replace(/\.+/g,".").replace(/\.\s*\./g,".").trim(),_=_.replace(/\.+$/,"").trim(),console.log("🗑️ Removed .scale() modifier when switching to note names")}else!T&&_&&Ce&&(_=wr(_,Ce));_!==D?(Mt("modal-pattern",_),T?(En=D,Zn=_,lt=!0,Pi=null,Ai=null):(Zn=null,lt=!1,D&&Un(D)?(Pi=D,Ai=_):(Pi=null,Ai=null),Ui(_,!0)),console.log(`🔄 Converted pattern ${T?"to note names":"to semitones"}: ${_.substring(0,100)}...`)):T||(Zn=null,lt=!1,Pi=null,Ai=null,Ui(D,!0)),Cr()}),Hs.dataset.listenerAttached="true");const Cr=()=>{const D=document.getElementById("modal-key-scale-group");if(!D)return;document.getElementById("modal-keep-notes-as-written");const T=ft("modal-pattern"),_=T&&Un(T);D.style.display=_?"block":"none"};Ui(ft("modal-pattern"),!0);const cu=D=>D.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),hu=(D,T)=>{if(!D||!T)return D;let _=D.trim();const F=(z,Q,G)=>{if(!G)return z;const re=new RegExp(`\\s*\\.\\s*${Q}\\s*\\(\\s*${cu(G)}\\s*\\)\\s*$`,"i");let Oe=z;for(;re.test(Oe);)Oe=Oe.replace(re,"").trim();return Oe};return typeof T.gain=="number"&&Math.abs(T.gain-1)>1e-6&&(_=F(_,"gain",T.gain.toFixed(2))),typeof T.pan=="number"&&Math.abs(T.pan)>1e-6&&(_=F(_,"pan",T.pan.toFixed(2))),_=(z=>{let Q=z;for(;Q.startsWith("(")&&Q.endsWith(")");){let G=0,re=!0;for(let Oe=0;Oe<Q.length;Oe++){const ae=Q[Oe];if(ae==="("?G++:ae===")"&&G--,G===0&&Oe<Q.length-1){re=!1;break}}if(re&&G===0)Q=Q.slice(1,-1).trim();else break}return Q})(_.trim()),_};this.syncElementsFromMasterPattern=D=>{var T,_;if(!D||typeof D!="string"){console.warn("⚠️ Cannot sync elements - master pattern missing or invalid");return}try{const F=/^\/\/\s*Controls Selected Tempo:[^\n]*\n?/im;let L=D.replace(F,"").trim();if(!L){console.warn("⚠️ Master pattern empty after sanitizing, skipping element sync");return}let z=L;const Q=L.indexOf("stack(");if(Q!==-1){const ae=L.indexOf("(",Q);if(ae!==-1){let fe=1,Xe=ae+1,qe=!1,We=null;for(;Xe<L.length&&fe>0;){const $e=L[Xe],me=L[Xe-1];if(qe)$e===We&&me!=="\\"&&(qe=!1,We=null);else if($e==='"'||$e==="'")qe=!0,We=$e;else if($e==="(")fe++;else if($e===")"&&(fe--,fe===0)){z=L.slice(ae+1,Xe);break}Xe++}}}const G=/\s*\/\*\s*Channel\s+(\d+)\s*\*\/([\s\S]*?)(?=(\s*\/\*\s*Channel\s+\d+\s*\*\/)|$)/g;let re;const Oe=[];for(;(re=G.exec(z))!==null;){const ae=parseInt(re[1],10);if(!Number.isFinite(ae)||ae<1)continue;let fe=re[2].trim();if(!fe||(fe=fe.replace(/^,+/,"").replace(/,+$/,"").trim(),!fe))continue;const Xe=((T=re[0])==null?void 0:T.trim())||fe,qe=`element-${ae}`,We=(_=V.trackedPatterns)==null?void 0:_.get(qe),me=hu(fe,We)||fe,ze={...this.loadElementConfig(qe)||{},pattern:me};if(this.saveElementConfig(qe,ze,!0),V.trackedPatterns){const Ue=(We==null?void 0:We.gain)??(typeof V.getElementGain=="function"?V.getElementGain(qe):.8),mt=(We==null?void 0:We.pan)??(typeof V.getElementPan=="function"?V.getElementPan(qe):0),rt=(We==null?void 0:We.muted)??!1,st=(We==null?void 0:We.soloed)??!1;V.trackedPatterns.set(qe,{rawPattern:Xe,pattern:me,gain:Ue,pan:mt,muted:rt,soloed:st})}if(this.currentEditingElementId===qe){const Ue=ft("modal-pattern");if((Ue==null?void 0:Ue.trim())!==fe.trim()&&(Mt("modal-pattern",fe),console.log(`📝 Updated modal editor for ${qe} to match master pattern`)),b.active&&i&&Et(i.value)){console.log("🔁 Refreshing drum grid to match updated pattern"),b.updatingFromPattern=!0;const rt=document.getElementById("modal-time-signature-select"),st=(rt==null?void 0:rt.value)||this.currentTimeSignature||"4/4",Tt=Di(st);zi(fe,Tt),b.updatingFromPattern=!1}}Oe.push(qe)}Oe.length>0?console.log(`🔄 Synced master pattern changes to elements: ${Oe.join(", ")}`):console.warn("ℹ️ No channel definitions found while syncing master pattern")}catch(F){console.warn("⚠️ Failed to sync master pattern to elements:",F)}},setTimeout(()=>{const D=ft("modal-pattern"),T=dt&&dt.value||null,_=Kt&&Kt.value||null;D&&Un(D)&&(T||_)&&(console.log(`🎼 Applying initial key/scale on modal open: key="${T}", scale="${_}"`),J())},200),i&&!i.dataset.listenerAttached&&i.addEventListener("change",async D=>{var Fe,Qt,_t;const T=D.target.value,_=Oc(T),F=_.bankValue;console.log("📦 Bank select changed to:",T),i.value!==T&&(i.value=T);const L=this.currentEditingElementId,z=(xe={},Nt=!0)=>{if(!L)return;const Te={...this.loadElementConfig(L)||{},...xe};_.isVcslInstrument?Te.vcslInstrument=_.vcslInstrument:"vcslInstrument"in Te&&delete Te.vcslInstrument,this.saveElementConfig(L,Te,Nt)};if(F&&F!==""){wt&&(wt.value="");const xe=(Fe=document.getElementById("modal-pattern-bank"))==null?void 0:Fe.closest(".form-group");xe&&(xe.style.display="block"),Cr(),this.selectedTagKey="bank",typeof this.refreshSnippetButtons=="function"&&setTimeout(()=>{this.refreshSnippetButtons().catch(Nt=>console.warn("⚠️ Unable to refresh snippet tags:",Nt))},100)}else Cr(),this.selectedTagKey=null,typeof this.refreshSnippetButtons=="function"&&setTimeout(()=>{this.refreshSnippetButtons().catch(xe=>console.warn("⚠️ Unable to refresh snippet tags:",xe))},100);if(!L){console.warn("⚠️ No elementId when bank changed");return}const Q=document.getElementById("status-text"),G=document.getElementById("modal-pattern"),re=!!(V!=null&&V.masterActive),Oe=ft("modal-pattern");F&&F!==""&&(!Oe||Oe.trim()==="")&&G&&(G.placeholder='Drums and Percussion: s("bd sd rim cp hh oh cr rd ht mt lt sh cb tb perc misc fx"), Synths: note("c3 d3 [e3 f3]")');const ae=(Qt=document.getElementById("modal-sample-url"))==null?void 0:Qt.closest(".form-group"),fe=(_t=document.getElementById("modal-sample-file"))==null?void 0:_t.closest(".form-group"),Xe=document.getElementById("modal-sample-name-group"),qe=F&&F!=="";if(ae&&(ae.style.display=qe?"none":"block"),fe&&(fe.style.display=qe?"none":"block"),Xe&&(Xe.style.display=qe?"none":"block"),!F||F===""){console.log("📦 Using Default (no bank)"),G.placeholder="",Q&&(Q.textContent="📦 Using Default samples");const xe=document.getElementById("modal-title");xe.value="Default";const Nt=document.getElementById("modal-element-id");Nt&&(Nt.textContent=ir(L)),mi(L,"Default"),z({title:"Default",bank:void 0},!1),console.log(`📝 Saved title "Default" for ${L}`);let R=ft("modal-pattern").trim(),Te=N(R);Te&&Te.trim()!==""?(Te=Te.replace(/\.\s*bank\s*\(\s*["'][^"']*["']\s*\)/gi,""),Te=Te.replace(/\.+/g,".").replace(/\.\s*\./g,".").trim(),Te=Te.replace(/\.+$/,"").trim(),Mt("modal-pattern",Te),G.placeholder="",console.log(`📝 Removed .bank() modifier only, preserving pattern: ${Te.substring(0,80)}...`)):G.placeholder=""}else{const xe=(Jt,kt)=>{if(!Jt||Jt.trim()==="")return kt;let ut=Jt.trim();return!ut.endsWith(".")&&!kt.startsWith(".")&&(ut+="."),ut+=kt,ut.replace(/\.\.+/g,".").replace(/\.\s+\./g,".").trim()};if(_.isVcslInstrument){const Jt=_.vcslInstrument,kt=ab(Jt),ut=document.getElementById("modal-title");Q&&(Q.textContent=`🎙️ VCSL Instrument: ${kt}`),ut&&(ut.value=kt);const ie=document.getElementById("modal-element-id");ie&&(ie.textContent=ir(L)),mi(L,kt),z({title:kt,bank:"vcsl"},!0);let Bt=ft("modal-pattern").trim(),je=N(Bt);const ct=/sound\s*\(\s*["'][^"']*["']\s*\)/i,Ee=je&&je.trim()!==""?je:"";Ee?ct.test(Ee)?je=Ee.replace(ct,`sound("${Jt}")`):Ee.includes(".s(")?je=Ee.replace(/\.s\s*\(\s*["'][^"']*["']\s*\)/i,`.sound("${Jt}")`):je=xe(Ee,`sound("${Jt}")`):je=`sound("${Jt}")`,je=x(je,"vcsl",!0),Mt("modal-pattern",je),G.placeholder="",setTimeout(()=>{he()},50);return}const Nt=Io(F);if([...xa,...Tr].includes(Nt)||lb.includes(F)){const Jt=document.getElementById("modal-title"),kt={piano:"Piano",supersaw:"Saw Synth",gtr:"Guitar",casio:"Casio",wood:"Jazz",jazz:"Jazz",metal:"Metal",folkharp:"Folk Harp",superpiano:"Piano"},ut=kt[Nt]||kt[F]||Nt.charAt(0).toUpperCase()+Nt.slice(1);console.log(`🎹 Using synth sound: ${Nt}`),Q&&(Q.textContent=`🎹 Using ${ut}`),Jt.value=ut;const ie=document.getElementById("modal-element-id");ie&&(ie.textContent=ir(L)),mi(L,ut),z({title:ut,bank:F}),console.log(`📝 Saved title "${ut}" for ${L}`);let Bt=ft("modal-pattern").trim(),je=N(Bt);je&&je.trim()!==""?(console.log(`🎹 BANK CHANGE: Updating .s() modifier only, preserving pattern: ${je.substring(0,80)}...`),je=x(je,Nt,!1),console.log(`🎹 BANK CHANGE: Updated pattern: ${je.substring(0,80)}...`)):(je=`note("c3").s("${Nt}")`,console.log(`🎹 BANK CHANGE: Created minimal pattern with .s("${Nt}")`)),Mt("modal-pattern",je),G.placeholder="";const ct=document.getElementById("modal-keep-notes-as-written");ct&&(ct.checked=!0,console.log("🎹 Set note names toggle to ON for synth/waveform")),setTimeout(()=>{he()},50);const Ee=ft("modal-pattern");console.log(`🎹 BANK CHANGE: Verified textarea contains: ${Ee}`)}else{console.log(`📦 Loading bank: ${F}`),Q&&(Q.textContent=`📦 Loading bank: ${F}...`);const Jt=["RolandTR808","RolandTR909","RolandTR707","RhythmAce","AkaiLinn","ViscoSpaceDrum","CasioRZ1"],kt=[...xa,...Tr,"insect","wind","east","crow","space","numbers","superpiano","jazz"],ut=(F==null?void 0:F.toLowerCase())||"",ie=H$.has(ut),Bt=Jt.includes(F)||kt.includes(ut);let je=!1;if(ie)try{je=await V.loadBank(ut),je?(console.log(`✅ Specialty sample bank loaded: ${ut}`),Q&&(Q.textContent=`✅ Bank loaded: ${ut}`)):(console.log(`⚠️ Specialty sample bank "${ut}" may not be fully loaded`),Q&&(Q.textContent=`⚠️ Bank "${ut}" may not be available`))}catch(ct){console.error(`Error loading specialty bank ${ut}:`,ct),je=!1,Q&&(Q.textContent=`⚠️ Error loading bank: ${ut}`)}else if(Bt)je=!0,console.log(`✅ Built-in bank/waveform: ${F} (no loading required)`),Q&&(Q.textContent=`✅ Built-in: ${F}`);else try{je=await V.loadBank(F),je?(console.log(`✅ Bank loaded: ${F}`),Q&&(Q.textContent=`✅ Bank loaded: ${F}`)):(console.log(`⚠️ Bank "${F}" may not be fully loaded, but continuing...`),Q&&(Q.textContent=`⚠️ Bank "${F}" may not be available`))}catch(ct){console.error(`Error loading bank ${F}:`,ct),je=!1,Q&&(Q.textContent=`⚠️ Error loading bank: ${F}`)}try{const ct=document.getElementById("modal-title");let Ee;const Vt=Xh.find(vt=>vt.value===ut);F.startsWith("github:")?Ee=F.replace("github:tidalcycles/",""):Dr.has(F)?Ee=Bo(F):Vt?Ee=Vt.label:Ee=F,ct.value=Ee;const Ft=document.getElementById("modal-element-id");if(Ft&&(Ft.textContent=ir(L)),mi(L,Ee),this.activeElements.has(L)){console.log(`🛑 Stopping sound for ${L} (bank selected, not auto-playing)`),V.stopSound(L),this.activeElements.delete(L);const vt=document.querySelector(`[data-sound-id="${L}"]`);if(vt){const Rt=vt.querySelector(".element-circle");Rt&&Rt.classList.remove("playing"),this.updateStatusDots(L,!0,!1)}}const hn=this.loadElementConfig(L)||{};try{const vt={...hn,title:Ee,bank:F};localStorage.setItem(`elementConfig_${L}`,JSON.stringify(vt)),console.log(`📝 Saved title "${Ee}" and bank "${F}" for ${L} (NOT saved to master)`)}catch(vt){console.warn("⚠️ Could not save config:",vt)}let qt=ft("modal-pattern").trim();console.log(`📝 Bank change: currentPattern="${qt.substring(0,100)}..."`);let Ge=N(qt);console.log(`📝 Bank change: normalizedPattern="${Ge.substring(0,100)}..."`);const ge=Dr.has(F),hi=xa.includes(ut)||Tr.includes(ut)||["sawtooth","square","triangle","sine"].includes(ut);if(console.log(`📝 Bank change: isDrumBank=${ge}, isSynthOrWaveform=${hi}, isSpecialSampleBank=${ie}, bankValue="${F}"`),ge||ie){const vt=ie?ut:F;if(Ge&&Ge.trim()!==""){const Rt=Ge;Ge=x(Ge,vt,!0),console.log(`📝 Updated .bank("${vt}") modifier`),console.log(`   Before: ${Rt.substring(0,80)}...`),console.log(`   After: ${Ge.substring(0,80)}...`)}else ie?Ge=`${vt==="mridangam"?'sound("tha dhi thom nam")':'sound("ahh ~ ohh")'}.bank("${vt}")`:Ge=`s("bd").bank("${vt}")`,console.log(`📝 Created minimal pattern with .bank("${vt}")`);Mt("modal-pattern",Ge),G.placeholder=""}else if(hi){const vt=Io(F);if(Ge&&Ge.trim()!==""){const Ms=Ge;Ge=x(Ge,vt,!1),console.log(`📝 Updated .s("${vt}") modifier`),console.log(`   Before: ${Ms.substring(0,80)}...`),console.log(`   After: ${Ge.substring(0,80)}...`)}else Ge=`note("c3").s("${vt}")`,console.log(`📝 Created minimal pattern with .s("${vt}")`);Mt("modal-pattern",Ge),G.placeholder="";const Rt=document.getElementById("modal-keep-notes-as-written");Rt&&(Rt.checked=!0,console.log("📝 Set note names toggle to ON for synth/waveform"))}else G.placeholder='Add a pattern, e.g., sound("bd").bank("CustomBank")';console.log(`📝 Final pattern in editor: ${ft("modal-pattern").substring(0,100)}...`),setTimeout(()=>{he()},50)}catch(ct){console.error("Error loading bank:",ct)}}}const We=document.getElementById("modal-title"),$e=We?We.value.trim():"",me=G?G.value.trim():"";let ue;me&&me.includes("(")&&me.includes(")")&&(me.match(/\([^)]+\)/g)||[]).some(xe=>xe.includes("drum")||xe.includes("Kick")||xe.includes("hi-hat"))?ue=N(me):ue=me;const ze=document.getElementById("modal-keep-notes-as-written"),Ue=ze&&ze.checked;if(ue&&Un(ue)&&!Mi(ue)&&!Ue){const xe=V.convertPatternForScale(ue);xe&&xe!==ue&&(ue=xe,G&&Mt("modal-pattern",xe))}if(!re&&this.activeElements.has(L)){console.log(`🛑 Stopping sound for ${L} (bank changed, not auto-playing)`),V.stopSound(L),this.activeElements.delete(L);const xe=document.querySelector(`[data-sound-id="${L}"]`);if(xe){const Nt=xe.querySelector(".element-circle");Nt&&Nt.classList.remove("playing"),this.updateStatusDots(L,!0,!1)}}else re&&console.log(`⏭️ Master running – skipping element stop for ${L}`);const mt=document.querySelector(`[data-sound-id="${L}"]`);if(!re&&mt){const xe=mt.querySelector(".loop-button");xe&&xe.classList.contains("active")&&(console.log(`🛑 Stopping loop for ${L} (bank changed)`),xe.classList.remove("active"),V.stopSound(L))}const rt=document.getElementById("modal-keep-notes-as-written"),st=rt?rt.checked:!1;this.saveElementConfig(L,{title:$e||bankDisplayName,pattern:ue,bank:F||void 0,keepNotesAsWritten:st},!0),console.log(`💾 Saved config with bank: ${F}`),V.invalidatePatternCache(L),ue&&(await V.preEvaluatePattern(L,ue),console.log(`📦 Pre-evaluated pattern for ${L} (silent, ready for manual trigger)`));const Tt=F&&Dr.has(F);console.log("📦 Bank change: isDrum=",Tt,"bankValue=",F),Tt?(console.log("📦 Drum bank selected – preserving current editor mode"),b.patternEditorEnabled?zn():(b.built=!1,setTimeout(()=>{zn()},0))):(console.log("📦 Not a drum bank, using code editor"),pe(!0),zn())});const uo=e.querySelector(".btn-cancel");uo&&uo.addEventListener("click",()=>{Ke()});const co=e.querySelector(".btn-save");co&&co.addEventListener("click",()=>{if(!this.currentEditingElementId)return;b.active&&ji();let D=document.getElementById("modal-title").value.trim();D==="No sound assigned"&&(D="");const T=ft("modal-pattern").trim();let _;T.includes(".bank(")||T.includes(".s(")||T.includes(".synth(")||Un(T)||T.includes("sound(")||T.includes("s(")?_=T:_=N(T);const F=document.getElementById("modal-keep-notes-as-written"),L=F?F.checked:!1;if(_&&Un(_)){const We=/\b(note|n)\s*\(\s*["'][a-gA-G][#b]?\d/.test(_),$e=/\b(n|note)\s*\(\s*["'][\d\s\-]+["']/.test(_)&&!/\b(note|n)\s*\(\s*["'][a-gA-G]/.test(_);We&&!$e?console.log(`📝 Preserving note names format: ${_.substring(0,50)}...`):$e&&!We&&console.log(`📝 Preserving semitones format: ${_.substring(0,50)}...`)}const z=L,Q=document.getElementById("modal-key-select"),G=document.getElementById("modal-scale-select"),re=Q&&Q.value||null,Oe=G&&G.value||null;if(console.log(`🎼 Modal save: Reading key/scale from dropdowns - elementKey="${re}", elementScale="${Oe}", modalKeySelect.value="${Q==null?void 0:Q.value}", modalScaleSelect.value="${G==null?void 0:G.value}"`),_&&Un(_)&&(re||Oe)){const We=/\b(note|n)\s*\(/.test(_),$e=/\b(note|n)\s*\(\s*["'][a-gA-G][#b]?\d/.test(_),me=/\b(n|note)\s*\(\s*["'][\d\s\-]+["']/.test(_)&&!/\b(note|n)\s*\(\s*["'][a-gA-G]/.test(_),ue=/\.\s*chord\s*\(/i.test(_),ze=We&&me&&!$e&&!ue;if(console.log(`🎼 Modal save: pattern="${_.substring(0,50)}...", hasNoteFunction=${We}, hasNoteNames=${$e}, hasNumericNotes=${me}, isNumericPattern=${ze}, elementKey="${re}", elementScale="${Oe}"`),!ue&&ze&&!$e){const Ue=V.applyGlobalSettingsToPattern(_,!1,!1,re||null,Oe||null);console.log(`🎼 Modal save: patternWithScale="${Ue?Ue.substring(0,80):"null"}..."`),Ue&&Ue!==_?(_=Ue,Mt("modal-pattern",_),console.log(`✅ Applied key/scale to pattern: ${_.substring(0,80)}...`)):console.log("⚠️ Scale not applied - pattern unchanged or applyGlobalSettingsToPattern returned same pattern")}else console.log($e?"📝 Pattern uses note names - preserving format, not applying scale modifier":`⚠️ Scale not applied - hasChordModifier=${ue}, isNumericPattern=${ze}`)}else console.log(`⚠️ Key/Scale not applied - pattern: ${!!_}, hasNoteCall: ${_?Un(_):!1}, elementKey: ${re}, elementScale: ${Oe}`);const ae=document.getElementById("modal-sample-url").value.trim(),fe=document.getElementById("modal-sample-file"),Xe=i?i.value:"";let qe=ae;if(fe.files&&fe.files.length>0){const We=fe.files[0],$e=new FileReader;$e.onload=me=>{qe=me.target.result,this.saveElementConfig(this.currentEditingElementId,{title:D||this.currentEditingElementId,pattern:_,sampleUrl:qe,fileName:We.name,bank:Xe||void 0,keepNotesAsWritten:z,key:re,scale:Oe}),Ke()},$e.readAsDataURL(We)}else this.saveElementConfig(this.currentEditingElementId,{title:D||this.currentEditingElementId,pattern:_,sampleUrl:qe,bank:Xe||void 0,keepNotesAsWritten:z,key:re,scale:Oe}),Ke()}),e.addEventListener("click",D=>{D.target===e&&Ke()}),document.addEventListener("keydown",D=>{D.key==="Escape"&&e.style.display!=="none"&&Ke()}),document.querySelectorAll(".config-button").forEach(D=>{D.addEventListener("click",T=>{T.stopPropagation();const _=D.closest(".sound-element");if(_){const F=_.getAttribute("data-sound-id");F&&Be(F)}})}),this.openConfigModal=Be}isOverlapping(e,t){return!(e.x+e.width<t.x||t.x+t.width<e.x||e.y+e.height<t.y||t.y+t.height<e.y)}setupAddElementButton(){const e=document.getElementById("add-element-btn");e&&e.addEventListener("click",()=>{this.createNewElement()})}createNewElement(){this.elementCounter++;const e=`element-${this.elementCounter}`,t=this.elementCounter;console.log(`➕ Creating new element: ${e}`);const i=document.querySelector(".elements-container"),s=document.getElementById("add-element-btn");if(!i||!s)return;const r=`
      <div class="sound-element" data-sound-id="${e}">
        <input type="range" class="gain-slider" min="0" max="1" step="0.01" value="0.8" orient="vertical" />
        <div class="volume-label">Gain</div>
        <div class="channel-label">Channel ${t}</div>
        <input type="range" class="pan-slider" min="-1" max="1" step="0.01" value="0" orient="horizontal" />
        <div class="pan-label">Pan</div>
        <div class="status-dots">
          <div class="status-dot loaded-dot" title="Sound Loaded"></div>
          <div class="status-dot playing-dot" title="Playing"></div>
        </div>
        <div class="master-status-indicator" title="Pattern saved to Master">M</div>
        <div class="element-title">Element ${t}</div>
        <div class="element-indicator"></div>
        <div class="element-circle"></div>
        <div class="spiral-visualization-container" style="display: none;"></div>
        <div class="element-controls">
          <button class="solo-button" title="Solo">S</button>
          <button class="mute-button" title="Mute">M</button>
        </div>
        
        <!-- Synthesis Section (ADSR Envelope) - Only for synth sounds -->
        <div class="collapsible-section synthesis-section" style="display: none;">
          <button class="collapsible-toggle" data-target="synthesis">
            <span class="toggle-icon">▶</span> Synthesis
          </button>
          <div class="collapsible-content synthesis-content">
            <div class="slider-row">
              <label>Attack</label>
              <input type="range" class="synth-slider attack-slider" min="0" max="2" step="0.01" value="0.01" />
              <span class="slider-value">0.01</span>
            </div>
            <div class="slider-row">
              <label>Decay</label>
              <input type="range" class="synth-slider decay-slider" min="0" max="2" step="0.01" value="0.1" />
              <span class="slider-value">0.1</span>
            </div>
            <div class="slider-row">
              <label>Sustain</label>
              <input type="range" class="synth-slider sustain-slider" min="0" max="1" step="0.01" value="0.5" />
              <span class="slider-value">0.5</span>
            </div>
            <div class="slider-row">
              <label>Release</label>
              <input type="range" class="synth-slider release-slider" min="0" max="5" step="0.01" value="0.1" />
              <span class="slider-value">0.1</span>
            </div>
          </div>
        </div>
        
        <!-- Filters Section -->
        <div class="collapsible-section">
          <button class="collapsible-toggle" data-target="filters">
            <span class="toggle-icon">▶</span> Filters
          </button>
          <div class="collapsible-content filters-content">
            <div class="slider-row">
              <label>Low-pass</label>
              <span class="slider-endpoint slider-endpoint--min">20 Hz</span>
              <input type="range" class="filter-slider lpf-slider" min="20" max="20000" step="10" value="20000" />
              <span class="slider-value">20000</span>
              <span class="slider-endpoint slider-endpoint--max">20 kHz</span>
            </div>
            <div class="slider-row">
              <label>High-pass</label>
              <span class="slider-endpoint slider-endpoint--min">20 Hz</span>
              <input type="range" class="filter-slider hpf-slider" min="20" max="20000" step="10" value="20" />
              <span class="slider-value">20</span>
              <span class="slider-endpoint slider-endpoint--max">20 kHz</span>
            </div>
            <div class="slider-row">
              <label>Resonance</label>
              <input type="range" class="filter-slider resonance-slider" min="0" max="20" step="0.1" value="0" />
              <span class="slider-value">0</span>
            </div>
          </div>
        </div>
        
        <!-- Effects Section -->
        <div class="collapsible-section">
          <button class="collapsible-toggle" data-target="effects">
            <span class="toggle-icon">▶</span> Effects
          </button>
          <div class="collapsible-content effects-content">
            <div class="slider-row">
              <label>Reverb</label>
              <input type="range" class="effect-slider reverb-slider" min="0" max="1" step="0.01" value="0" />
              <span class="slider-value">0</span>
            </div>
            <div class="slider-row">
              <label>Delay</label>
              <input type="range" class="effect-slider delay-slider" min="0" max="1" step="0.01" value="0" />
              <span class="slider-value">0</span>
            </div>
            <div class="slider-row">
              <label>Distortion</label>
              <input type="range" class="effect-slider distortion-slider" min="0" max="10" step="0.1" value="0" />
              <span class="slider-value">0</span>
            </div>
          </div>
        </div>
        
        <div class="element-action-buttons">
        <button class="config-button">Configure Sound</button>
          <div class="history-button-row">
            <button class="history-button" type="button" data-history-target="channel">Load</button>
            <button class="history-button history-button--primary" type="button" data-history-save="channel">Save</button>
          </div>
        </div>
      </div>
    `;s.insertAdjacentHTML("beforebegin",r);const a=document.querySelector(`[data-sound-id="${e}"]`);if(a){zt.elements.push({id:e,selector:`[data-sound-id="${e}"]`,type:"strudel",pattern:"",description:"No sound assigned"}),this.registerElements([{element:a,elementId:e}]),this.setupElementControlsForElement(a,e);const o=a.querySelector(".config-button");o&&this.openConfigModal&&o.addEventListener("click",c=>{c.stopPropagation(),this.openConfigModal(e)});const l=a.querySelector(".config-button");if(l&&(l.textContent="Configure Sound"),mi(e,""),this.initializeElementVisualizations(a,e),l){const c=this.loadElementConfig(e);(!c||!c.pattern||c.pattern.trim()==="")&&(l.textContent="Configure Sound")}console.log(`✅ Element ${e} created and fully initialized`)}}setupElementControlsForElement(e,t){if(!e||!t)return;const i=e.querySelector(".gain-slider"),s=e.querySelector(".pan-slider");if(i){const o=parseFloat(i.value);V.setElementGain(t,o),i.addEventListener("input",l=>{l.stopPropagation();const c=parseFloat(l.target.value);V.setElementGain(t,c),V.updateTrackedElementGain(t,c),this.updateMasterPatternDisplay()})}if(s){const o=parseFloat(s.value);V.setElementPan(t,o),s.addEventListener("input",l=>{l.stopPropagation();const c=parseFloat(l.target.value);V.setElementPan(t,c),V.updateTrackedElementPan(t,c),this.updateMasterPatternDisplay()})}const r=e.querySelector(".solo-button");r&&r.addEventListener("click",o=>{o.stopPropagation(),this.handleSoloButton(t,r)});const a=e.querySelector(".mute-button");a&&a.addEventListener("click",o=>{o.stopPropagation(),this.handleMuteButton(t,a)}),this.setupCollapsibleSections(e,t)}}let Lo=null,ya=null,ba=null,Qo=null,_c=null;async function bg(){ya=new G$,ya.init(),ya.setOnLoginSuccess(a=>{Lo=a,Nc(a)});try{const a=await ou();a?(Lo=a,Nc(a)):Bc()}catch{Bc()}const n=document.getElementById("header-login-btn");n&&n.addEventListener("click",()=>{ya&&ya.show()});const e=document.getElementById("user-menu-button"),t=document.getElementById("user-menu-dropdown");e&&t&&(e.addEventListener("click",a=>{a.stopPropagation(),t.classList.toggle("active")}),document.addEventListener("click",a=>{!e.contains(a.target)&&!t.contains(a.target)&&t.classList.remove("active")}));const i=document.getElementById("user-logout-btn");i&&i.addEventListener("click",async()=>{try{await Yd.logout(),Lo=null,Bc(),t.classList.remove("active")}catch(a){console.error("Logout error:",a)}});const s=document.getElementById("user-profile-link");s&&s.addEventListener("click",async a=>{a.preventDefault(),ba&&await ba.show(),t.classList.remove("active")}),ba=new U$,ba.init(),ba.setOnUpdate(a=>{Lo=a,Nc(a)}),Qo=new q$,Qo.init();const r=document.getElementById("user-profiles-link");r&&r.addEventListener("click",async a=>{a.preventDefault(),Qo&&await Qo.show(),t.classList.remove("active")}),_c=new W$,_c.init(),window.savePatternDialog=_c}function Nc(n){const e=document.getElementById("header-login-btn"),t=document.getElementById("user-menu"),i=document.getElementById("user-name"),s=document.getElementById("user-avatar");e&&(e.style.display="none"),t&&(t.style.display="block"),i&&(i.textContent=n.name||n.email),s&&n.avatarUrl&&(s.src=n.avatarUrl,s.style.display="block")}function Bc(){const n=document.getElementById("header-login-btn"),e=document.getElementById("user-menu");n&&(n.style.display="block"),e&&(e.style.display="none")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{new yg().init(),cg(),bg()}):(new yg().init(),cg(),bg());export{N5 as A,T5 as B,k5 as C,B5 as D,Vc as E,cP as F,_5 as G,va as H,Ug as I,Gg as J,oS as K,Tl as L,Wg as M,ld as N,PS as O,Ig as P,Qn as Q,AS as R,$l as S,od as T,lS as U,ud as V,Zg as W,Vg as X,L5 as Y,E5 as a,_l as b,wS as c,td as d,Qc as e,qg as f,Hg as g,Bg as h,rd as i,Ha as j,dr as k,Xg as l,Ng as m,Zt as n,CS as o,br as p,Mg as q,gw as r,nd as s,os as t,M5 as u,x5 as v,D5 as w,A5 as x,$5 as y,mw as z};
