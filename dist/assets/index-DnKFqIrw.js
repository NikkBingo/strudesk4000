const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/strudel-web-D2TLs97f.js","assets/strudel-core-DKU3hnf1.js","assets/index-BN03qUel.js"])))=>i.map(i=>d[i]);
import{Z as uu}from"./strudel-web-D2TLs97f.js";import{v as Kd,z as cu,h as ea,c as Rb,G as Lb,W as dg,g as Ib,L as fg,B as hu,d as oo,E as Vb}from"./strudel-core-DKU3hnf1.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();const zb="modulepreload",Zb=function(n){return"/"+n},Jd={},Jt=function(e,t,i){let s=Promise.resolve();if(t&&t.length>0){let a=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=a(t.map(c=>{if(c=Zb(c),c in Jd)return;Jd[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":zb,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((f,m)=>{d.addEventListener("load",f),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&r(o.reason);return e().catch(r)})},Lt={elements:[{id:"element-1",selector:'[data-sound-id="element-1"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-2",selector:'[data-sound-id="element-2"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-3",selector:'[data-sound-id="element-3"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-4",selector:'[data-sound-id="element-4"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-5",selector:'[data-sound-id="element-5"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-6",selector:'[data-sound-id="element-6"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-7",selector:'[data-sound-id="element-7"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-8",selector:'[data-sound-id="element-8"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-9",selector:'[data-sound-id="element-9"]',type:"strudel",pattern:"",description:"No sound assigned"},{id:"element-10",selector:'[data-sound-id="element-10"]',type:"strudel",pattern:"",description:"No sound assigned"}],defaults:{proximityThreshold:100,hoverEnabled:!0,proximityEnabled:!0,volume:.5,fadeInTime:.1,fadeOutTime:.2},controls:{"proximity-threshold":{type:"synthesized",pattern:'sound("cp cp ~ cp")',description:"Threshold tick"},volume:{type:"synthesized",pattern:'sound("~ cp cp cp")',description:"Volume tick"}},getElementConfig(n){return this.elements.find(e=>e.id===n)},getSynthesizedElements(){return this.elements.filter(n=>n.type==="synthesized")},getAudioElements(){return this.elements.filter(n=>n.type==="audio")},getControlConfig(n){return this.controls[n]}};function jb(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function qb(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var pg=[0,2,4,-1,1,3,5],mg=pg.map(n=>Math.floor(n*7/12));function Gb(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=pg[e]+7*t;if(i===void 0)return[s*r];const a=i-mg[e]-4*t;return[s*r,s*a]}var Wb=[3,0,4,1,5,2,6];function Xb(n){const[e,t,i]=n,s=Wb[Ub(e)],r=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:r,dir:i};const a=t+4*r+mg[s];return{step:s,alt:r,oct:a,dir:i}}function Ub(n){const e=(n+1)%7;return e<0?7+e:e}var ef=(n,e)=>Array(Math.abs(e)+1).join(n),Dc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),Yb="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Hb="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Kb=new RegExp("^"+Yb+"|"+Hb+"$");function Jb(n){const e=Kb.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var tf={};function Yo(n){return typeof n=="string"?tf[n]||(tf[n]=ev(n)):qb(n)?Yo(iv(n)):jb(n)?Yo(n.name):Dc}var nf=[0,2,4,5,7,9,11],gg="PMMPPMM";function ev(n){const e=Jb(n);if(e[0]==="")return Dc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=gg[s];if(r==="M"&&i==="P")return Dc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=nv(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(nf[s]+u+12*h),f=(l*(nf[s]+u)%12+12)%12,m=Gb({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function tv(n,e){const[t,i=0]=n,s=t*7+i*12<0,r=e||s?[-t,-i,-1]:[t,i,1];return Yo(Xb(r))}function nv(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function iv(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=gg[e]==="M"?"majorable":"perfectable";return o+a+sv(l,t)}function sv(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?ef("A",e):ef("d",n==="perfectable"?e:e+1)}function rv(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function av(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var Og=[0,2,4,-1,1,3,5],yg=Og.map(n=>Math.floor(n*7/12));function ov(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=Og[e]+7*t;if(i===void 0)return[s*r];const a=i-yg[e]-4*t;return[s*r,s*a]}var lv=[3,0,4,1,5,2,6];function uv(n){const[e,t,i]=n,s=lv[cv(e)],r=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:r,dir:i};const a=t+4*r+yg[s];return{step:s,alt:r,oct:a,dir:i}}function cv(n){const e=(n+1)%7;return e<0?7+e:e}var sf=(n,e)=>Array(Math.abs(e)+1).join(n),bg=Object.freeze({empty:!0,name:"",letter:"",acc:"",pc:"",step:NaN,alt:NaN,chroma:NaN,height:NaN,coord:[],midi:null,freq:null}),rf=new Map,hv=n=>"CDEFGAB".charAt(n),Cl=n=>n<0?sf("b",-n):sf("#",n),Gh=n=>n[0]==="b"?-n.length:n.length;function Vt(n){const e=JSON.stringify(n),t=rf.get(e);if(t)return t;const i=typeof n=="string"?mv(n):av(n)?Vt(gv(n)):rv(n)?Vt(n.name):bg;return rf.set(e,i),i}var dv=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Wh(n){const e=dv.exec(n);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function fv(n){return Vt(uv(n))}var pv=(n,e)=>(n%e+e)%e,du=[0,2,4,5,7,9,11];function mv(n){const e=Wh(n);if(e[0]===""||e[3]!=="")return bg;const t=e[0],i=e[1],s=e[2],r=(t.charCodeAt(0)+3)%7,a=Gh(i),o=s.length?+s:void 0,l=ov({step:r,alt:a,oct:o}),c=t+i+s,u=t+i,h=(du[r]+a+120)%12,d=o===void 0?pv(du[r]+a,12)-1188:du[r]+a+12*(o+1),f=d>=0&&d<=127?d:null,m=o===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:h,coord:l,freq:m,height:d,letter:t,midi:f,name:c,oct:o,pc:u,step:r}}function gv(n){const{step:e,alt:t,oct:i}=n,s=hv(e);if(!s)return"";const r=s+Cl(t);return i||i===0?r+i:r}function ss(n,e){const t=Vt(n),i=Array.isArray(e)?e:Yo(e).coord;if(t.empty||!i||i.length<2)return"";const s=t.coord,r=s.length===1?[s[0]+i[0]]:[s[0]+i[0],s[1]+i[1]];return fv(r).name}function vg(n,e){const t=n.length;return i=>{if(!e)return"";const s=i<0?(t- -i%t)%t:i%t,r=Math.floor(i/t),a=ss(e,[0,r]);return ss(a,n[s])}}function Xh(n,e){const t=Vt(n),i=Vt(e);if(t.empty||i.empty)return"";const s=t.coord,r=i.coord,a=r[0]-s[0],o=s.length===2&&r.length===2?r[1]-s[1]:-Math.floor(a*7/12),l=i.height===t.height&&i.midi!==null&&t.oct===i.oct&&t.step>i.step;return tv([a,o],l).name}function Ov(n,e){const t=[];for(;e--;t[e]=e+n);return t}function yv(n,e){const t=[];for(;e--;t[e]=n-e);return t}function Uh(n,e){return n<e?Ov(n,e-n+1):yv(n,n-e+1)}function Zr(n,e){const t=e.length,i=(n%t+t)%t;return e.slice(i,t).concat(e.slice(0,i))}function Sg(n){return n.filter(e=>e===0||e)}function bv(n,e=Math.random){let t,i,s=n.length;for(;s;)t=Math.floor(e()*s--),i=n[s],n[s]=n[t],n[t]=i;return n}function wg(n){return n.length===0?[[]]:wg(n.slice(1)).reduce((e,t)=>e.concat(n.map((i,s)=>{const r=t.slice();return r.splice(s,0,n[0]),r})),[])}var d3={compact:Sg,permutations:wg,range:Uh,rotate:Zr,shuffle:bv};function vv(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function Sv(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var Pg=[0,2,4,-1,1,3,5],wv=Pg.map(n=>Math.floor(n*7/12));function Pv(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=Pg[e]+7*t;if(i===void 0)return[s*r];const a=i-wv[e]-4*t;return[s*r,s*a]}var af=(n,e)=>Array(Math.abs(e)+1).join(n),Mc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),xv="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Cv="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Av=new RegExp("^"+xv+"|"+Cv+"$");function kv(n){const e=Av.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var of={};function Tc(n){return typeof n=="string"?of[n]||(of[n]=Ev(n)):Sv(n)?Tc(Dv(n)):vv(n)?Tc(n.name):Mc}var lf=[0,2,4,5,7,9,11],xg="PMMPPMM";function Ev(n){const e=kv(n);if(e[0]==="")return Mc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=xg[s];if(r==="M"&&i==="P")return Mc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=$v(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(lf[s]+u+12*h),f=(l*(lf[s]+u)%12+12)%12,m=Pv({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function $v(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function Dv(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=xg[e]==="M"?"majorable":"perfectable";return o+a+Mv(l,t)}function Mv(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?af("A",e):af("d",n==="perfectable"?e:e+1)}var rs={empty:!0,name:"",setNum:0,chroma:"000000000000",normalized:"000000000000",intervals:[]},Yh=n=>Number(n).toString(2).padStart(12,"0"),uf=n=>parseInt(n,2),Tv=/^[01]{12}$/;function Hh(n){return Tv.test(n)}var _v=n=>typeof n=="number"&&n>=0&&n<=4095,Fv=n=>n&&Hh(n.chroma),cf={[rs.chroma]:rs};function hn(n){const e=Hh(n)?n:_v(n)?Yh(n):Array.isArray(n)?Gv(n):Fv(n)?n.chroma:rs.chroma;return cf[e]=cf[e]||qv(e)}var Bv=hn,Cg=n=>hn(n).chroma,Nv=n=>hn(n).intervals,Qv=n=>hn(n).setNum,Rv=["1P","2m","2M","3m","3M","4P","5d","5P","6m","6M","7m","7M"];function Lv(n){const e=[];for(let t=0;t<12;t++)n.charAt(t)==="1"&&e.push(Rv[t]);return e}function Iv(n){return hn(n).intervals.map(e=>ss("C",e))}function Vv(){return Uh(2048,4095).map(Yh)}function Ag(n,e=!0){const i=hn(n).chroma.split("");return Sg(i.map((s,r)=>{const a=Zr(r,i);return e&&a[0]==="0"?null:a.join("")}))}function zv(n,e){return hn(n).setNum===hn(e).setNum}function Kh(n){const e=hn(n).setNum;return t=>{const i=hn(t).setNum;return e&&e!==i&&(i&e)===i}}function kg(n){const e=hn(n).setNum;return t=>{const i=hn(t).setNum;return e&&e!==i&&(i|e)===i}}function Eg(n){const e=hn(n);return t=>{const i=Vt(t);return e&&!i.empty&&e.chroma.charAt(i.chroma)==="1"}}function Zv(n){const e=Eg(n);return t=>t.filter(e)}var f3={get:hn,chroma:Cg,num:Qv,intervals:Nv,chromas:Vv,isSupersetOf:kg,isSubsetOf:Kh,isNoteIncludedIn:Eg,isEqual:zv,filter:Zv,modes:Ag,notes:Iv,pcset:Bv};function jv(n){const e=n.split("");return e.map((t,i)=>Zr(i,e).join(""))}function qv(n){const e=uf(n),t=jv(n).map(uf).filter(r=>r>=2048).sort()[0],i=Yh(t),s=Lv(n);return{empty:!1,name:"",setNum:e,chroma:n,normalized:i,intervals:s}}function Gv(n){if(n.length===0)return rs.chroma;let e;const t=[0,0,0,0,0,0,0,0,0,0,0,0];for(let i=0;i<n.length;i++)e=Vt(n[i]),e.empty&&(e=Tc(n[i])),e.empty||(t[e.chroma]=1);return t.join("")}var Wv=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],Xv=Wv;({...rs});var Jh=[],Bo={};function p3(){return Jh.slice()}function Uv(n,e,t){const i=Hv(n),s={...hn(n),name:t||"",quality:i,intervals:n,aliases:e};Jh.push(s),s.name&&(Bo[s.name]=s),Bo[s.setNum]=s,Bo[s.chroma]=s,s.aliases.forEach(r=>Yv(s,r))}function Yv(n,e){Bo[e]=n}function Hv(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}Xv.forEach(([n,e,t])=>Uv(n.split(" "),t.split(" "),e));Jh.sort((n,e)=>n.setNum-e.setNum);function Al(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}var $g=[0,2,4,5,7,9,11],Kv=({step:n,alt:e})=>($g[n]+e+120)%12,Dg=({step:n,alt:e,oct:t,dir:i=1})=>i*($g[n]+e+12*(t===void 0?-100:t)),Jv=n=>{const e=Dg(n);return n.oct!==void 0&&e>=-12&&e<=115?e+12:null};function ed(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"}var Mg=[0,2,4,-1,1,3,5],Tg=Mg.map(n=>Math.floor(n*7/12));function td(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=Mg[e]+7*t;if(i===void 0)return[s*r];const a=i-Tg[e]-4*t;return[s*r,s*a]}var eS=[3,0,4,1,5,2,6];function nd(n){const[e,t,i]=n,s=eS[tS(e)],r=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:r,dir:i};const a=t+4*r+Tg[s];return{step:s,alt:r,oct:a,dir:i}}function tS(n){const e=(n+1)%7;return e<0?7+e:e}var hf=(n,e)=>Array(Math.abs(e)+1).join(n),_c={empty:!0,name:"",acc:""},nS="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",iS="(AA|A|P|M|m|d|dd)([-+]?\\d+)",sS=new RegExp("^"+nS+"|"+iS+"$");function _g(n){const e=sS.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var df={};function Rn(n){return typeof n=="string"?df[n]||(df[n]=rS(n)):ed(n)?Rn(oS(n)):Al(n)?Rn(n.name):_c}var ff=[0,2,4,5,7,9,11],Fg="PMMPPMM";function rS(n){const e=_g(n);if(e[0]==="")return _c;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=Fg[s];if(r==="M"&&i==="P")return _c;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=aS(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(ff[s]+u+12*h),f=(l*(ff[s]+u)%12+12)%12,m=td({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function kl(n,e){const[t,i=0]=n,s=t*7+i*12<0,r=e||s?[-t,-i,-1]:[t,i,1];return Rn(nd(r))}function aS(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function oS(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=Fg[e]==="M"?"majorable":"perfectable";return o+a+lS(l,t)}function lS(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?hf("A",e):hf("d",n==="perfectable"?e:e+1)}var pf=(n,e)=>Array(Math.abs(e)+1).join(n),Bg={empty:!0,name:"",pc:"",acc:""},mf=new Map,Ng=n=>"CDEFGAB".charAt(n),Qg=n=>n<0?pf("b",-n):pf("#",n),Rg=n=>n[0]==="b"?-n.length:n.length;function ur(n){const e=JSON.stringify(n),t=mf.get(e);if(t)return t;const i=typeof n=="string"?hS(n):ed(n)?ur(dS(n)):Al(n)?ur(n.name):Bg;return mf.set(e,i),i}var uS=/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/;function Lg(n){const e=uS.exec(n);return e?[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]:["","","",""]}function Ig(n){return ur(nd(n))}var cS=(n,e)=>(n%e+e)%e,fu=[0,2,4,5,7,9,11];function hS(n){const e=Lg(n);if(e[0]===""||e[3]!=="")return Bg;const t=e[0],i=e[1],s=e[2],r=(t.charCodeAt(0)+3)%7,a=Rg(i),o=s.length?+s:void 0,l=td({step:r,alt:a,oct:o}),c=t+i+s,u=t+i,h=(fu[r]+a+120)%12,d=o===void 0?cS(fu[r]+a,12)-1188:fu[r]+a+12*(o+1),f=d>=0&&d<=127?d:null,m=o===void 0?null:Math.pow(2,(d-69)/12)*440;return{empty:!1,acc:i,alt:a,chroma:h,coord:l,freq:m,height:d,letter:t,midi:f,name:c,oct:o,pc:u,step:r}}function dS(n){const{step:e,alt:t,oct:i}=n,s=Ng(e);if(!s)return"";const r=s+Qg(t);return i||i===0?r+i:r}function Fc(n,e){const t=ur(n),i=Array.isArray(e)?e:Rn(e).coord;if(t.empty||!i||i.length<2)return"";const s=t.coord,r=s.length===1?[s[0]+i[0]]:[s[0]+i[0],s[1]+i[1]];return Ig(r).name}function fS(n,e){const t=n.length;return i=>{if(!e)return"";const s=i<0?(t- -i%t)%t:i%t,r=Math.floor(i/t),a=Fc(e,[0,r]);return Fc(a,n[s])}}function pS(n,e){const t=ur(n),i=ur(e);if(t.empty||i.empty)return"";const s=t.coord,r=i.coord,a=r[0]-s[0],o=s.length===2&&r.length===2?r[1]-s[1]:-Math.floor(a*7/12),l=i.height===t.height&&i.midi!==null&&t.midi!==null&&t.step>i.step;return kl([a,o],l).name}var mS=(n,e)=>Array(Math.abs(e)+1).join(n);function El(n,e,t){return function(...i){return console.warn(`${n} is deprecated. Use ${e}.`),t.apply(this,i)}}var gS=El("isNamed","isNamedPitch",Al);const m3=Object.freeze(Object.defineProperty({__proto__:null,accToAlt:Rg,altToAcc:Qg,chroma:Kv,coordToInterval:kl,coordToNote:Ig,coordinates:td,deprecate:El,distance:pS,fillStr:mS,height:Dg,interval:Rn,isNamed:gS,isNamedPitch:Al,isPitch:ed,midi:Jv,note:ur,pitch:nd,stepToLetter:Ng,tokenizeInterval:_g,tokenizeNote:Lg,tonicIntervalsTransposer:fS,transpose:Fc},Symbol.toStringTag,{value:"Module"}));var OS=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],yS=OS,bS={...rs,name:"",quality:"Unknown",intervals:[],aliases:[]},jr=[],rr={};function Vg(n){return rr[n]||bS}var vS=El("ChordType.chordType","ChordType.get",Vg);function SS(){return jr.map(n=>n.name).filter(n=>n)}function wS(){return jr.map(n=>n.aliases[0]).filter(n=>n)}function PS(){return Object.keys(rr)}function zg(){return jr.slice()}var xS=El("ChordType.entries","ChordType.all",zg);function CS(){jr=[],rr={}}function Zg(n,e,t){const i=kS(n),s={...hn(n),name:t||"",quality:i,intervals:n,aliases:e};jr.push(s),s.name&&(rr[s.name]=s),rr[s.setNum]=s,rr[s.chroma]=s,s.aliases.forEach(r=>AS(s,r))}function AS(n,e){rr[e]=n}function kS(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}yS.forEach(([n,e,t])=>Zg(n.split(" "),t.split(" "),e));jr.sort((n,e)=>n.setNum-e.setNum);var g3={names:SS,symbols:wS,get:Vg,all:zg,add:Zg,removeAll:CS,keys:PS,entries:xS,chordType:vS},ES=[["1P 2M 3M 5P 6M","major pentatonic","pentatonic"],["1P 2M 3M 4P 5P 6M 7M","major","ionian"],["1P 2M 3m 4P 5P 6m 7m","minor","aeolian"],["1P 2M 3m 3M 5P 6M","major blues"],["1P 3m 4P 5d 5P 7m","minor blues","blues"],["1P 2M 3m 4P 5P 6M 7M","melodic minor"],["1P 2M 3m 4P 5P 6m 7M","harmonic minor"],["1P 2M 3M 4P 5P 6M 7m 7M","bebop"],["1P 2M 3m 4P 5d 6m 6M 7M","diminished","whole-half diminished"],["1P 2M 3m 4P 5P 6M 7m","dorian"],["1P 2M 3M 4A 5P 6M 7M","lydian"],["1P 2M 3M 4P 5P 6M 7m","mixolydian","dominant"],["1P 2m 3m 4P 5P 6m 7m","phrygian"],["1P 2m 3m 4P 5d 6m 7m","locrian"],["1P 3M 4P 5P 7M","ionian pentatonic"],["1P 3M 4P 5P 7m","mixolydian pentatonic","indian"],["1P 2M 4P 5P 6M","ritusen"],["1P 2M 4P 5P 7m","egyptian"],["1P 3M 4P 5d 7m","neopolitan major pentatonic"],["1P 3m 4P 5P 6m","vietnamese 1"],["1P 2m 3m 5P 6m","pelog"],["1P 2m 4P 5P 6m","kumoijoshi"],["1P 2M 3m 5P 6m","hirajoshi"],["1P 2m 4P 5d 7m","iwato"],["1P 2m 4P 5P 7m","in-sen"],["1P 3M 4A 5P 7M","lydian pentatonic","chinese"],["1P 3m 4P 6m 7m","malkos raga"],["1P 3m 4P 5d 7m","locrian pentatonic","minor seven flat five pentatonic"],["1P 3m 4P 5P 7m","minor pentatonic","vietnamese 2"],["1P 3m 4P 5P 6M","minor six pentatonic"],["1P 2M 3m 5P 6M","flat three pentatonic","kumoi"],["1P 2M 3M 5P 6m","flat six pentatonic"],["1P 2m 3M 5P 6M","scriabin"],["1P 3M 5d 6m 7m","whole tone pentatonic"],["1P 3M 4A 5A 7M","lydian #5P pentatonic"],["1P 3M 4A 5P 7m","lydian dominant pentatonic"],["1P 3m 4P 5P 7M","minor #7M pentatonic"],["1P 3m 4d 5d 7m","super locrian pentatonic"],["1P 2M 3m 4P 5P 7M","minor hexatonic"],["1P 2A 3M 5P 5A 7M","augmented"],["1P 2M 4P 5P 6M 7m","piongio"],["1P 2m 3M 4A 6M 7m","prometheus neopolitan"],["1P 2M 3M 4A 6M 7m","prometheus"],["1P 2m 3M 5d 6m 7m","mystery #1"],["1P 2m 3M 4P 5A 6M","six tone symmetric"],["1P 2M 3M 4A 5A 6A","whole tone","messiaen's mode #1"],["1P 2m 4P 4A 5P 7M","messiaen's mode #5"],["1P 2M 3M 4P 5d 6m 7m","locrian major","arabian"],["1P 2m 3M 4A 5P 6m 7M","double harmonic lydian"],["1P 2m 2A 3M 4A 6m 7m","altered","super locrian","diminished whole tone","pomeroy"],["1P 2M 3m 4P 5d 6m 7m","locrian #2","half-diminished","aeolian b5"],["1P 2M 3M 4P 5P 6m 7m","mixolydian b6","melodic minor fifth mode","hindu"],["1P 2M 3M 4A 5P 6M 7m","lydian dominant","lydian b7","overtone"],["1P 2M 3M 4A 5A 6M 7M","lydian augmented"],["1P 2m 3m 4P 5P 6M 7m","dorian b2","phrygian #6","melodic minor second mode"],["1P 2m 3m 4d 5d 6m 7d","ultralocrian","superlocrian bb7","superlocrian diminished"],["1P 2m 3m 4P 5d 6M 7m","locrian 6","locrian natural 6","locrian sharp 6"],["1P 2A 3M 4P 5P 5A 7M","augmented heptatonic"],["1P 2M 3m 4A 5P 6M 7m","dorian #4","ukrainian dorian","romanian minor","altered dorian"],["1P 2M 3m 4A 5P 6M 7M","lydian diminished"],["1P 2M 3M 4A 5A 7m 7M","leading whole tone"],["1P 2M 3M 4A 5P 6m 7m","lydian minor"],["1P 2m 3M 4P 5P 6m 7m","phrygian dominant","spanish","phrygian major"],["1P 2m 3m 4P 5P 6m 7M","balinese"],["1P 2m 3m 4P 5P 6M 7M","neopolitan major"],["1P 2M 3M 4P 5P 6m 7M","harmonic major"],["1P 2m 3M 4P 5P 6m 7M","double harmonic major","gypsy"],["1P 2M 3m 4A 5P 6m 7M","hungarian minor"],["1P 2A 3M 4A 5P 6M 7m","hungarian major"],["1P 2m 3M 4P 5d 6M 7m","oriental"],["1P 2m 3m 3M 4A 5P 7m","flamenco"],["1P 2m 3m 4A 5P 6m 7M","todi raga"],["1P 2m 3M 4P 5d 6m 7M","persian"],["1P 2m 3M 5d 6m 7m 7M","enigmatic"],["1P 2M 3M 4P 5A 6M 7M","major augmented","major #5","ionian augmented","ionian #5"],["1P 2A 3M 4A 5P 6M 7M","lydian #9"],["1P 2m 2M 4P 4A 5P 6m 7M","messiaen's mode #4"],["1P 2m 3M 4P 4A 5P 6m 7M","purvi raga"],["1P 2m 3m 3M 4P 5P 6m 7m","spanish heptatonic"],["1P 2M 3m 3M 4P 5P 6M 7m","bebop minor"],["1P 2M 3M 4P 5P 5A 6M 7M","bebop major"],["1P 2m 3m 4P 5d 5P 6m 7m","bebop locrian"],["1P 2M 3m 4P 5P 6m 7m 7M","minor bebop"],["1P 2M 3M 4P 5d 5P 6M 7M","ichikosucho"],["1P 2M 3m 4P 5P 6m 6M 7M","minor six diminished"],["1P 2m 3m 3M 4A 5P 6M 7m","half-whole diminished","dominant diminished","messiaen's mode #2"],["1P 3m 3M 4P 5P 6M 7m 7M","kafi raga"],["1P 2M 3M 4P 4A 5A 6A 7M","messiaen's mode #6"],["1P 2M 3m 3M 4P 5d 5P 6M 7m","composite blues"],["1P 2M 3m 3M 4A 5P 6m 7m 7M","messiaen's mode #3"],["1P 2m 2M 3m 4P 4A 5P 6m 6M 7M","messiaen's mode #7"],["1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M","chromatic"]],$S=ES,DS={...rs,intervals:[],aliases:[]},$l=[],ar={};function jg(){return $l.map(n=>n.name)}function Dl(n){return ar[n]||DS}var MS=Dl;function ja(){return $l.slice()}var TS=ja;function _S(){return Object.keys(ar)}function FS(){$l=[],ar={}}function qg(n,e,t=[]){const i={...hn(n),name:e,intervals:n,aliases:t};return $l.push(i),ar[i.name]=i,ar[i.setNum]=i,ar[i.chroma]=i,i.aliases.forEach(s=>BS(i,s)),i}function BS(n,e){ar[e]=n}$S.forEach(([n,e,...t])=>qg(n.split(" "),e,t));var O3={names:jg,get:Dl,all:ja,add:qg,removeAll:FS,keys:_S,entries:TS,scaleType:MS},NS=[[.125,"dl",["large","duplex longa","maxima","octuple","octuple whole"]],[.25,"l",["long","longa"]],[.5,"d",["double whole","double","breve"]],[1,"w",["whole","semibreve"]],[2,"h",["half","minim"]],[4,"q",["quarter","crotchet"]],[8,"e",["eighth","quaver"]],[16,"s",["sixteenth","semiquaver"]],[32,"t",["thirty-second","demisemiquaver"]],[64,"sf",["sixty-fourth","hemidemisemiquaver"]],[128,"h",["hundred twenty-eighth"]],[256,"th",["two hundred fifty-sixth"]]],QS=NS,Ml=[];QS.forEach(([n,e,t])=>jS(n,e,t));var RS={empty:!0,name:"",value:0,fraction:[0,0],shorthand:"",dots:"",names:[]};function LS(){return Ml.reduce((n,e)=>(e.names.forEach(t=>n.push(t)),n),[])}function IS(){return Ml.map(n=>n.shorthand)}var VS=/^([^.]+)(\.*)$/;function id(n){const[e,t,i]=VS.exec(n)||[],s=Ml.find(o=>o.shorthand===t||o.names.includes(t));if(!s)return RS;const r=qS(s.fraction,i.length),a=r[0]/r[1];return{...s,name:n,dots:i,value:a,fraction:r}}var zS=n=>id(n).value,ZS=n=>id(n).fraction,y3={names:LS,shorthands:IS,get:id,value:zS,fraction:ZS};function jS(n,e,t){Ml.push({empty:!1,dots:"",name:"",value:1/n,fraction:n<1?[1/n,1]:[1,n],shorthand:e,names:t})}function qS(n,e){const t=Math.pow(2,e);let i=n[0]*t,s=n[1]*t;const r=i;for(let a=0;a<e;a++)i+=r/Math.pow(2,a+1);for(;i%2===0&&s%2===0;)i/=2,s/=2;return[i,s]}function GS(){return"1P 2M 3M 4P 5P 6m 7m".split(" ")}var Gg=Rn,WS=n=>Rn(n).name,XS=n=>Rn(n).semitones,US=n=>Rn(n).q,YS=n=>Rn(n).num;function HS(n){const e=Rn(n);return e.empty?"":e.simple+e.q}function KS(n){const e=Rn(n);if(e.empty)return"";const t=(7-e.step)%7,i=e.type==="perfectable"?-e.alt:-(e.alt+1);return Rn({step:t,alt:i,oct:e.oct,dir:e.dir}).name}var JS=[1,2,2,3,3,4,5,5,6,6,7,7],ew="P m M m M P d P m M m M".split(" ");function tw(n){const e=n<0?-1:1,t=Math.abs(n),i=t%12,s=Math.floor(t/12);return e*(JS[i]+7*s)+ew[i]}var nw=Xh,Wg=Xg((n,e)=>[n[0]+e[0],n[1]+e[1]]),iw=n=>e=>Wg(n,e),sw=Xg((n,e)=>[n[0]-e[0],n[1]-e[1]]);function rw(n,e){const t=Gg(n);if(t.empty)return"";const[i,s,r]=t.coord;return kl([i+e,s,r]).name}var aw={names:GS,get:Gg,name:WS,num:YS,semitones:XS,quality:US,fromSemitones:tw,distance:nw,invert:KS,simplify:HS,add:Wg,addTo:iw,substract:sw,transposeFifths:rw};function Xg(n){return(e,t)=>{const i=Rn(e).coord,s=Rn(t).coord;if(i&&s){const r=n(i,s);return kl(r).name}}}function Ug(n){return+n>=0&&+n<=127}function ow(n){if(Ug(n))return+n;const e=Vt(n);return e.empty?null:e.midi}function lw(n,e=440){return Math.pow(2,(n-69)/12)*e}var uw=Math.log(2),cw=Math.log(440);function sd(n){const e=12*(Math.log(n)-cw)/uw+69;return Math.round(e*100)/100}var hw="C C# D D# E F F# G G# A A# B".split(" "),dw="C Db D Eb E F Gb G Ab A Bb B".split(" ");function gr(n,e={}){if(isNaN(n)||n===-1/0||n===1/0)return"";n=Math.round(n);const i=(e.sharps===!0?hw:dw)[n%12];if(e.pitchClass)return i;const s=Math.floor(n/12)-1;return i+s}function rd(n){return n%12}function fw(n){return n.split("").reduce((e,t,i)=>(i<12&&t==="1"&&e.push(i),e),[])}function pw(n){return n.map(rd).sort((e,t)=>e-t).filter((e,t,i)=>t===0||e!==i[t-1])}function ad(n){return Array.isArray(n)?pw(n):fw(n)}function mw(n){const e=ad(n);return t=>{const i=rd(t);for(let s=0;s<12;s++){if(e.includes(i+s))return t+s;if(e.includes(i-s))return t-s}}}function Yg(n,e){const t=ad(n),i=t.length;return s=>{const r=s<0?(i- -s%i)%i:s%i,a=Math.floor(s/i);return t[r]+a*12+e}}function gw(n,e){const t=Yg(n,e);return i=>{if(i!==0)return t(i>0?i-1:i)}}var b3={chroma:rd,freqToMidi:sd,isMidi:Ug,midiToFreq:lw,midiToNoteName:gr,pcsetNearest:mw,pcset:ad,pcsetDegrees:gw,pcsetSteps:Yg,toMidi:ow},Ow=["C","D","E","F","G","A","B"],Hg=n=>n.name,Kg=n=>n.map(Vt).filter(e=>!e.empty);function yw(n){return n===void 0?Ow.slice():Array.isArray(n)?Kg(n).map(Hg):[]}var Ti=Vt,bw=n=>Ti(n).name,vw=n=>Ti(n).pc,Sw=n=>Ti(n).acc,ww=n=>Ti(n).oct,Pw=n=>Ti(n).midi,xw=n=>Ti(n).freq,Cw=n=>Ti(n).chroma;function Jg(n){return gr(n)}function Aw(n){return gr(sd(n))}function kw(n){return gr(sd(n),{sharps:!0})}function Ew(n){return gr(n,{sharps:!0})}var $w=Xh,Mi=ss,Dw=ss,e0=n=>e=>Mi(e,n),Mw=e0,t0=n=>e=>Mi(n,e),Tw=t0;function Ho(n,e){return Mi(n,[e,0])}var _w=Ho;function Fw(n,e){return Mi(n,[0,e])}var od=(n,e)=>n.height-e.height,Bw=(n,e)=>e.height-n.height;function n0(n,e){return e=e||od,Kg(n).sort(e).map(Hg)}function i0(n){return n0(n,od).filter((e,t,i)=>t===0||e!==i[t-1])}var Nw=n=>{const e=Ti(n);return e.empty?"":gr(e.midi||e.chroma,{sharps:e.alt>0,pitchClass:e.midi===null})};function s0(n,e){const t=Ti(n);if(t.empty)return"";const i=Ti(e||gr(t.midi||t.chroma,{sharps:t.alt<0,pitchClass:!0}));if(i.empty||i.chroma!==t.chroma)return"";if(t.oct===void 0)return i.pc;const s=t.chroma-t.alt,r=i.chroma-i.alt,a=s>11||r<0?-1:s<0||r>11?1:0,o=t.oct+a;return i.pc+o}var Bc={names:yw,get:Ti,name:bw,pitchClass:vw,accidentals:Sw,octave:ww,midi:Pw,ascending:od,descending:Bw,distance:$w,sortedNames:n0,sortedUniqNames:i0,fromMidi:Jg,fromMidiSharps:Ew,freq:xw,fromFreq:Aw,fromFreqSharps:kw,chroma:Cw,transpose:Mi,tr:Dw,transposeBy:e0,trBy:Mw,transposeFrom:t0,trFrom:Tw,transposeFifths:Ho,transposeOctaves:Fw,trFifths:_w,simplify:Nw,enharmonic:s0};function r0(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function a0(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var o0=[0,2,4,-1,1,3,5],Qw=o0.map(n=>Math.floor(n*7/12));function Rw(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=o0[e]+7*t;if(i===void 0)return[s*r];const a=i-Qw[e]-4*t;return[s*r,s*a]}var gf=(n,e)=>Array(Math.abs(e)+1).join(n),Nc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),Lw="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",Iw="(AA|A|P|M|m|d|dd)([-+]?\\d+)",Vw=new RegExp("^"+Lw+"|"+Iw+"$");function zw(n){const e=Vw.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var Of={};function Qc(n){return typeof n=="string"?Of[n]||(Of[n]=Zw(n)):a0(n)?Qc(qw(n)):r0(n)?Qc(n.name):Nc}var yf=[0,2,4,5,7,9,11],l0="PMMPPMM";function Zw(n){const e=zw(n);if(e[0]==="")return Nc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=l0[s];if(r==="M"&&i==="P")return Nc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=jw(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(yf[s]+u+12*h),f=(l*(yf[s]+u)%12+12)%12,m=Rw({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function jw(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function qw(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=l0[e]==="M"?"majorable":"perfectable";return o+a+Gw(l,t)}function Gw(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?gf("A",e):gf("d",n==="perfectable"?e:e+1)}var u0={empty:!0,name:"",chordType:""},bf={};function Ns(n){return typeof n=="string"?bf[n]||(bf[n]=Jw(n)):typeof n=="number"?Ns(Tl[n]||""):a0(n)?Uw(n):r0(n)?Ns(n.name):u0}var Ww=Ns;function Xw(n=!0){return(n?Tl:Kw).slice()}function Uw(n){return Ns(Cl(n.alt)+Tl[n.step])}var Yw=/^(#{1,}|b{1,}|x{1,}|)(IV|I{1,3}|VI{0,2}|iv|i{1,3}|vi{0,2})([^IViv]*)$/;function Hw(n){return Yw.exec(n)||["","","",""]}var c0="I II III IV V VI VII",Tl=c0.split(" "),Kw=c0.toLowerCase().split(" ");function Jw(n){const[e,t,i,s]=Hw(n);if(!i)return u0;const r=i.toUpperCase(),a=Tl.indexOf(r),o=Gh(t),l=1;return{empty:!1,name:e,roman:i,interval:Qc({step:a,alt:o,dir:l}).name,acc:t,chordType:s,alt:o,step:a,major:i===r,oct:0,dir:l}}var v3={names:Xw,get:Ns,romanNumeral:Ww},bn=Object.freeze([]),h0={type:"major",tonic:"",alteration:0,keySignature:""},No={tonic:"",grades:bn,intervals:bn,scale:bn,triads:bn,chords:bn,chordsHarmonicFunction:bn,chordScales:bn,secondaryDominants:bn,secondaryDominantSupertonics:bn,substituteDominantsMinorRelative:bn,substituteDominants:bn,substituteDominantSupertonics:bn,secondaryDominantsMinorRelative:bn},eP={...h0,...No,type:"major",minorRelative:"",scale:bn,substituteDominants:bn,secondaryDominantSupertonics:bn,substituteDominantsMinorRelative:bn},tP={...h0,type:"minor",relativeMajor:"",natural:No,harmonic:No,melodic:No},pu=(n,e,t="")=>e.map((i,s)=>`${n[s]}${t}${i}`);function _l(n,e,t,i,s){return r=>{const a=n.map(f=>Ns(f).interval||""),o=a.map(f=>Mi(r,f)),l=pu(o,t),c=o.map(f=>Mi(f,"5P")).map(f=>o.includes(f)&&!l.includes(f+"7")?f+"7":""),u=vf(c,e),h=c.map(f=>{if(!f)return"";const m=f.slice(0,-1);return Mi(m,"5d")+"7"}),d=vf(h,e);return{tonic:r,grades:n,intervals:a,scale:o,triads:pu(o,e),chords:l,chordsHarmonicFunction:i.slice(),chordScales:pu(o,s," "),secondaryDominants:c,secondaryDominantSupertonics:u,substituteDominants:h,substituteDominantSupertonics:d,secondaryDominantsMinorRelative:u,substituteDominantsMinorRelative:d}}}var vf=(n,e)=>n.map((t,i)=>{if(!t)return"";const s=t.slice(0,-1),r=Mi(s,"5P");return e[i].endsWith("m")?r+"m7":r+"m7b5"}),d0=(n,e)=>{const t=Vt(n),i=Vt(e);return t.empty||i.empty?0:i.coord[0]-t.coord[0]},nP=_l("I II III IV V VI VII".split(" ")," m m   m dim".split(" "),"maj7 m7 m7 maj7 7 m7 m7b5".split(" "),"T SD T SD D T D".split(" "),"major,dorian,phrygian,lydian,mixolydian,minor,locrian".split(",")),iP=_l("I II bIII IV V bVI bVII".split(" "),"m dim  m m  ".split(" "),"m7 m7b5 maj7 m7 m7 maj7 7".split(" "),"T SD T SD D SD SD".split(" "),"minor,locrian,major,dorian,phrygian,lydian,mixolydian".split(",")),sP=_l("I II bIII IV V bVI VII".split(" "),"m dim aug m   dim".split(" "),"mMaj7 m7b5 +maj7 m7 7 maj7 o7".split(" "),"T SD T SD D SD D".split(" "),"harmonic minor,locrian 6,major augmented,lydian diminished,phrygian dominant,lydian #9,ultralocrian".split(",")),rP=_l("I II bIII IV V VI VII".split(" "),"m m aug   dim dim".split(" "),"m6 m7 +maj7 7 7 m7b5 m7b5".split(" "),"T SD T SD D  ".split(" "),"melodic minor,dorian b2,lydian augmented,lydian dominant,mixolydian b6,locrian #2,altered".split(","));function aP(n){const e=Vt(n).pc;if(!e)return eP;const t=nP(e),i=d0("C",e);return{...t,type:"major",minorRelative:Mi(e,"-3m"),alteration:i,keySignature:Cl(i)}}function oP(n){const e=Vt(n).pc;if(!e)return tP;const t=d0("C",e)-3;return{type:"minor",tonic:e,relativeMajor:Mi(e,"3m"),alteration:t,keySignature:Cl(t),natural:iP(e),harmonic:sP(e),melodic:rP(e)}}function lP(n){return typeof n=="number"?Ho("C",n):typeof n=="string"&&/^b+|#+$/.test(n)?Ho("C",Gh(n)):null}var S3={majorKey:aP,majorTonicFromKeySignature:lP,minorKey:oP};function uP(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function cP(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var f0=[0,2,4,-1,1,3,5],p0=f0.map(n=>Math.floor(n*7/12));function hP(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=f0[e]+7*t;if(i===void 0)return[s*r];const a=i-p0[e]-4*t;return[s*r,s*a]}var dP=[3,0,4,1,5,2,6];function fP(n){const[e,t,i]=n,s=dP[pP(e)],r=Math.floor((e+1)/7);if(t===void 0)return{step:s,alt:r,dir:i};const a=t+4*r+p0[s];return{step:s,alt:r,oct:a,dir:i}}function pP(n){const e=(n+1)%7;return e<0?7+e:e}var Sf=(n,e)=>Array(Math.abs(e)+1).join(n),Rc=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),mP="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",gP="(AA|A|P|M|m|d|dd)([-+]?\\d+)",OP=new RegExp("^"+mP+"|"+gP+"$");function yP(n){const e=OP.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var wf={};function Da(n){return typeof n=="string"?wf[n]||(wf[n]=bP(n)):cP(n)?Da(wP(n)):uP(n)?Da(n.name):Rc}var Pf=[0,2,4,5,7,9,11],m0="PMMPPMM";function bP(n){const e=yP(n);if(e[0]==="")return Rc;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=m0[s];if(r==="M"&&i==="P")return Rc;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=SP(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(Pf[s]+u+12*h),f=(l*(Pf[s]+u)%12+12)%12,m=hP({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function vP(n,e){const[t,i=0]=n,r=t*7+i*12<0?[-t,-i,-1]:[t,i,1];return Da(fP(r))}function SP(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function wP(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=m0[e]==="M"?"majorable":"perfectable";return o+a+PP(l,t)}function PP(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?Sf("A",e):Sf("d",n==="perfectable"?e:e+1)}var xP=Da;function CP(n){const e=Da(n);return e.empty?"":e.simple+e.q}function AP(n,e){const t=xP(n);if(t.empty)return"";const[i,s,r]=t.coord;return vP([i+e,s,r]).name}var ld=[[0,2773,0,"ionian","","Maj7","major"],[1,2902,2,"dorian","m","m7"],[2,3418,4,"phrygian","m","m7"],[3,2741,-1,"lydian","","Maj7"],[4,2774,1,"mixolydian","","7"],[5,2906,3,"aeolian","m","m7","minor"],[6,3434,5,"locrian","dim","m7b5"]],xf={...rs,name:"",alt:0,modeNum:NaN,triad:"",seventh:"",aliases:[]},ud=ld.map(DP),Lc={};ud.forEach(n=>{Lc[n.name]=n,n.aliases.forEach(e=>{Lc[e]=n})});function cr(n){return typeof n=="string"?Lc[n.toLowerCase()]||xf:n&&n.name?cr(n.name):xf}var kP=cr;function g0(){return ud.slice()}var EP=g0;function $P(){return ud.map(n=>n.name)}function DP(n){const[e,t,i,s,r,a,o]=n,l=o?[o]:[],c=Number(t).toString(2);return{empty:!1,intervals:Dl(s).intervals,modeNum:e,chroma:c,normalized:c,name:s,setNum:t,alt:i,triad:r,seventh:a,aliases:l}}function MP(n,e){return cr(n).intervals.map(t=>ss(e,t))}function O0(n){return(e,t)=>{const i=cr(e);if(i.empty)return[];const s=Zr(i.modeNum,n),r=i.intervals.map(a=>ss(t,a));return s.map((a,o)=>r[o]+a)}}var TP=O0(ld.map(n=>n[4])),_P=O0(ld.map(n=>n[5]));function y0(n,e){const t=cr(e),i=cr(n);return t.empty||i.empty?"":CP(AP("1P",i.alt-t.alt))}function FP(n,e,t){return ss(t,y0(n,e))}var w3={get:cr,names:$P,all:g0,distance:y0,relativeTonic:FP,notes:MP,triads:TP,seventhChords:_P,entries:EP,mode:kP},BP=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],NP=BP;({...rs});var b0=[],Qo={};function QP(n,e,t){const i=LP(n),s={...hn(n),name:t||"",quality:i,intervals:n,aliases:e};b0.push(s),s.name&&(Qo[s.name]=s),Qo[s.setNum]=s,Qo[s.chroma]=s,s.aliases.forEach(r=>RP(s,r))}function RP(n,e){Qo[e]=n}function LP(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}NP.forEach(([n,e,t])=>QP(n.split(" "),t.split(" "),e));b0.sort((n,e)=>n.setNum-e.setNum);function IP(n){return n!==null&&typeof n=="object"&&"name"in n&&typeof n.name=="string"}function VP(n){return n!==null&&typeof n=="object"&&"step"in n&&typeof n.step=="number"&&"alt"in n&&typeof n.alt=="number"&&!isNaN(n.step)&&!isNaN(n.alt)}var v0=[0,2,4,-1,1,3,5],zP=v0.map(n=>Math.floor(n*7/12));function ZP(n){const{step:e,alt:t,oct:i,dir:s=1}=n,r=v0[e]+7*t;if(i===void 0)return[s*r];const a=i-zP[e]-4*t;return[s*r,s*a]}var Cf=(n,e)=>Array(Math.abs(e)+1).join(n),Ic=Object.freeze({empty:!0,name:"",num:NaN,q:"",type:"",step:NaN,alt:NaN,dir:NaN,simple:NaN,semitones:NaN,chroma:NaN,coord:[],oct:NaN}),jP="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",qP="(AA|A|P|M|m|d|dd)([-+]?\\d+)",GP=new RegExp("^"+jP+"|"+qP+"$");function WP(n){const e=GP.exec(`${n}`);return e===null?["",""]:e[1]?[e[1],e[2]]:[e[4],e[3]]}var Af={};function Ko(n){return typeof n=="string"?Af[n]||(Af[n]=XP(n)):VP(n)?Ko(YP(n)):IP(n)?Ko(n.name):Ic}var kf=[0,2,4,5,7,9,11],S0="PMMPPMM";function XP(n){const e=WP(n);if(e[0]==="")return Ic;const t=+e[0],i=e[1],s=(Math.abs(t)-1)%7,r=S0[s];if(r==="M"&&i==="P")return Ic;const a=r==="M"?"majorable":"perfectable",o=""+t+i,l=t<0?-1:1,c=t===8||t===-8?t:l*(s+1),u=UP(a,i),h=Math.floor((Math.abs(t)-1)/7),d=l*(kf[s]+u+12*h),f=(l*(kf[s]+u)%12+12)%12,m=ZP({step:s,alt:u,oct:h,dir:l});return{empty:!1,name:o,num:t,q:i,step:s,alt:u,dir:l,type:a,simple:c,semitones:d,chroma:f,coord:m,oct:h}}function UP(n,e){return e==="M"&&n==="majorable"||e==="P"&&n==="perfectable"?0:e==="m"&&n==="majorable"?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?-1*(n==="perfectable"?e.length:e.length+1):0}function YP(n){const{step:e,alt:t,oct:i=0,dir:s}=n;if(!s)return"";const r=e+1+7*i,a=r===0?e+1:r,o=s<0?"-":"",l=S0[e]==="M"?"majorable":"perfectable";return o+a+HP(l,t)}function HP(n,e){return e===0?n==="majorable"?"M":"P":e===-1&&n==="majorable"?"m":e>0?Cf("A",e):Cf("d",n==="perfectable"?e:e+1)}function KP(n){const[e,t,i,s]=Wh(n);return e===""?mu("",n):e==="A"&&s==="ug"?mu("","aug"):mu(e+t,i+s)}function mu(n,e){const t=e.split("/");if(t.length===1)return[n,t[0],""];const[i,s,r,a]=Wh(t[1]);return i!==""&&r===""&&a===""?[n,t[0],i+s]:[n,e,""]}function JP(n,e){return e.map(Ns).map(i=>ss(n,Ko(i))+i.chordType)}function ex(n,e){return e.map(t=>{const[i,s]=KP(t),r=Xh(n,i);return Ns(Ko(r)).name+s})}var tx={fromRomanNumerals:JP,toRomanNumerals:ex},nx=[["1P 3M 5P","major","M ^  maj"],["1P 3M 5P 7M","major seventh","maj7 Δ ma7 M7 Maj7 ^7"],["1P 3M 5P 7M 9M","major ninth","maj9 Δ9 ^9"],["1P 3M 5P 7M 9M 13M","major thirteenth","maj13 Maj13 ^13"],["1P 3M 5P 6M","sixth","6 add6 add13 M6"],["1P 3M 5P 6M 9M","sixth added ninth","6add9 6/9 69 M69"],["1P 3M 6m 7M","major seventh flat sixth","M7b6 ^7b6"],["1P 3M 5P 7M 11A","major seventh sharp eleventh","maj#4 Δ#4 Δ#11 M7#11 ^7#11 maj7#11"],["1P 3m 5P","minor","m min -"],["1P 3m 5P 7m","minor seventh","m7 min7 mi7 -7"],["1P 3m 5P 7M","minor/major seventh","m/ma7 m/maj7 mM7 mMaj7 m/M7 -Δ7 mΔ -^7 -maj7"],["1P 3m 5P 6M","minor sixth","m6 -6"],["1P 3m 5P 7m 9M","minor ninth","m9 -9"],["1P 3m 5P 7M 9M","minor/major ninth","mM9 mMaj9 -^9"],["1P 3m 5P 7m 9M 11P","minor eleventh","m11 -11"],["1P 3m 5P 7m 9M 13M","minor thirteenth","m13 -13"],["1P 3m 5d","diminished","dim ° o"],["1P 3m 5d 7d","diminished seventh","dim7 °7 o7"],["1P 3m 5d 7m","half-diminished","m7b5 ø -7b5 h7 h"],["1P 3M 5P 7m","dominant seventh","7 dom"],["1P 3M 5P 7m 9M","dominant ninth","9"],["1P 3M 5P 7m 9M 13M","dominant thirteenth","13"],["1P 3M 5P 7m 11A","lydian dominant seventh","7#11 7#4"],["1P 3M 5P 7m 9m","dominant flat ninth","7b9"],["1P 3M 5P 7m 9A","dominant sharp ninth","7#9"],["1P 3M 7m 9m","altered","alt7"],["1P 4P 5P","suspended fourth","sus4 sus"],["1P 2M 5P","suspended second","sus2"],["1P 4P 5P 7m","suspended fourth seventh","7sus4 7sus"],["1P 5P 7m 9M 11P","eleventh","11"],["1P 4P 5P 7m 9m","suspended fourth flat ninth","b9sus phryg 7b9sus 7b9sus4"],["1P 5P","fifth","5"],["1P 3M 5A","augmented","aug + +5 ^#5"],["1P 3m 5A","minor augmented","m#5 -#5 m+"],["1P 3M 5A 7M","augmented seventh","maj7#5 maj7+5 +maj7 ^7#5"],["1P 3M 5P 7M 9M 11A","major sharp eleventh (lydian)","maj9#11 Δ9#11 ^9#11"],["1P 2M 4P 5P","","sus24 sus4add9"],["1P 3M 5A 7M 9M","","maj9#5 Maj9#5"],["1P 3M 5A 7m","","7#5 +7 7+ 7aug aug7"],["1P 3M 5A 7m 9A","","7#5#9 7#9#5 7alt"],["1P 3M 5A 7m 9M","","9#5 9+"],["1P 3M 5A 7m 9M 11A","","9#5#11"],["1P 3M 5A 7m 9m","","7#5b9 7b9#5"],["1P 3M 5A 7m 9m 11A","","7#5b9#11"],["1P 3M 5A 9A","","+add#9"],["1P 3M 5A 9M","","M#5add9 +add9"],["1P 3M 5P 6M 11A","","M6#11 M6b5 6#11 6b5"],["1P 3M 5P 6M 7M 9M","","M7add13"],["1P 3M 5P 6M 9M 11A","","69#11"],["1P 3m 5P 6M 9M","","m69 -69"],["1P 3M 5P 6m 7m","","7b6"],["1P 3M 5P 7M 9A 11A","","maj7#9#11"],["1P 3M 5P 7M 9M 11A 13M","","M13#11 maj13#11 M13+4 M13#4"],["1P 3M 5P 7M 9m","","M7b9"],["1P 3M 5P 7m 11A 13m","","7#11b13 7b5b13"],["1P 3M 5P 7m 13M","","7add6 67 7add13"],["1P 3M 5P 7m 9A 11A","","7#9#11 7b5#9 7#9b5"],["1P 3M 5P 7m 9A 11A 13M","","13#9#11"],["1P 3M 5P 7m 9A 11A 13m","","7#9#11b13"],["1P 3M 5P 7m 9A 13M","","13#9"],["1P 3M 5P 7m 9A 13m","","7#9b13"],["1P 3M 5P 7m 9M 11A","","9#11 9+4 9#4"],["1P 3M 5P 7m 9M 11A 13M","","13#11 13+4 13#4"],["1P 3M 5P 7m 9M 11A 13m","","9#11b13 9b5b13"],["1P 3M 5P 7m 9m 11A","","7b9#11 7b5b9 7b9b5"],["1P 3M 5P 7m 9m 11A 13M","","13b9#11"],["1P 3M 5P 7m 9m 11A 13m","","7b9b13#11 7b9#11b13 7b5b9b13"],["1P 3M 5P 7m 9m 13M","","13b9"],["1P 3M 5P 7m 9m 13m","","7b9b13"],["1P 3M 5P 7m 9m 9A","","7b9#9"],["1P 3M 5P 9M","","Madd9 2 add9 add2"],["1P 3M 5P 9m","","Maddb9"],["1P 3M 5d","","Mb5"],["1P 3M 5d 6M 7m 9M","","13b5"],["1P 3M 5d 7M","","M7b5"],["1P 3M 5d 7M 9M","","M9b5"],["1P 3M 5d 7m","","7b5"],["1P 3M 5d 7m 9M","","9b5"],["1P 3M 7m","","7no5"],["1P 3M 7m 13m","","7b13"],["1P 3M 7m 9M","","9no5"],["1P 3M 7m 9M 13M","","13no5"],["1P 3M 7m 9M 13m","","9b13"],["1P 3m 4P 5P","","madd4"],["1P 3m 5P 6m 7M","","mMaj7b6"],["1P 3m 5P 6m 7M 9M","","mMaj9b6"],["1P 3m 5P 7m 11P","","m7add11 m7add4"],["1P 3m 5P 9M","","madd9"],["1P 3m 5d 6M 7M","","o7M7"],["1P 3m 5d 7M","","oM7"],["1P 3m 6m 7M","","mb6M7"],["1P 3m 6m 7m","","m7#5"],["1P 3m 6m 7m 9M","","m9#5"],["1P 3m 5A 7m 9M 11P","","m11A"],["1P 3m 6m 9m","","mb6b9"],["1P 2M 3m 5d 7m","","m9b5"],["1P 4P 5A 7M","","M7#5sus4"],["1P 4P 5A 7M 9M","","M9#5sus4"],["1P 4P 5A 7m","","7#5sus4"],["1P 4P 5P 7M","","M7sus4"],["1P 4P 5P 7M 9M","","M9sus4"],["1P 4P 5P 7m 9M","","9sus4 9sus"],["1P 4P 5P 7m 9M 13M","","13sus4 13sus"],["1P 4P 5P 7m 9m 13m","","7sus4b9b13 7b9b13sus4"],["1P 4P 7m 10m","","4 quartal"],["1P 5P 7m 9m 11P","","11b9"]],ix=nx;({...rs});var cd=[],Ro={};function sx(){return cd.slice()}function rx(n,e,t){const i=ox(n),s={...hn(n),name:t||"",quality:i,intervals:n,aliases:e};cd.push(s),s.name&&(Ro[s.name]=s),Ro[s.setNum]=s,Ro[s.chroma]=s,s.aliases.forEach(r=>ax(s,r))}function ax(n,e){Ro[e]=n}function ox(n){const e=t=>n.indexOf(t)!==-1;return e("5A")?"Augmented":e("3M")?"Major":e("5d")?"Diminished":e("3m")?"Minor":"Unknown"}ix.forEach(([n,e,t])=>rx(n.split(" "),t.split(" "),e));cd.sort((n,e)=>n.setNum-e.setNum);var lx={empty:!0,name:"",type:"",tonic:null,setNum:NaN,chroma:"",normalized:"",aliases:[],notes:[],intervals:[]};function w0(n){if(typeof n!="string")return["",""];const e=n.indexOf(" "),t=Vt(n.substring(0,e));if(t.empty){const s=Vt(n);return s.empty?["",n.toLowerCase()]:[s.name,""]}const i=n.substring(t.name.length+1).toLowerCase();return[t.name,i.length?i:""]}var ux=jg;function as(n){const e=Array.isArray(n)?n:w0(n),t=Vt(e[0]).name,i=Dl(e[1]);if(i.empty)return lx;const s=i.name,r=t?i.intervals.map(o=>ss(t,o)):[],a=t?t+" "+s:s;return{...i,name:a,type:s,tonic:t,notes:r}}var cx=as;function hx(n,e={}){const t=Cg(n),i=Vt(e.tonic??n[0]??""),s=i.chroma;if(s===void 0)return[];const r=t.split("");r[s]="1";const a=Zr(s,r).join(""),o=ja().find(c=>c.chroma===a),l=[];return o&&l.push(i.name+" "+o.name),e.match==="exact"||P0(a).forEach(c=>{l.push(i.name+" "+c)}),l}function dx(n){const e=as(n),t=Kh(e.chroma);return sx().filter(i=>t(i.chroma)).map(i=>i.aliases[0])}function P0(n){const e=Hh(n)?n:as(n).chroma,t=kg(e);return ja().filter(i=>t(i.chroma)).map(i=>i.name)}function fx(n){const e=Kh(as(n).chroma);return ja().filter(t=>e(t.chroma)).map(t=>t.name)}function x0(n){const e=n.map(s=>Vt(s).pc).filter(s=>s),t=e[0],i=i0(e);return Zr(i.indexOf(t),i)}function px(n){const e=as(n);if(e.empty)return[];const t=e.tonic?e.notes:e.intervals;return Ag(e.chroma).map((i,s)=>{const r=as(i).name;return r?[t[s],r]:["",""]}).filter(i=>i[0])}function mx(n){const e=Array.isArray(n)?x0(n):as(n).notes,t=e.map(i=>Vt(i).chroma);return i=>{const s=Vt(typeof i=="number"?Jg(i):i),r=s.height;if(r===void 0)return;const a=r%12,o=t.indexOf(a);if(o!==-1)return s0(s.name,e[o])}}function gx(n){const e=mx(n);return(t,i)=>{const s=Vt(t).height,r=Vt(i).height;return s===void 0||r===void 0?[]:Uh(s,r).map(e).filter(a=>a)}}function Ox(n){const{intervals:e,tonic:t}=as(n),i=vg(e,t);return s=>s?i(s>0?s-1:s):""}function yx(n){const{intervals:e,tonic:t}=as(n);return vg(e,t)}var Lo={degrees:Ox,detect:hx,extended:P0,get:as,modeNames:px,names:ux,rangeOf:gx,reduced:fx,scaleChords:dx,scaleNotes:x0,steps:yx,tokenize:w0,scale:cx};let gu=null,Ef=null,$f=null,Df=null,Mf=null,Tf=null;const bx=(n,e)=>{if(!n||!e)return n;try{return new URL(n,e).toString()}catch{return n}},Vc=(n,e)=>{if(typeof n=="string")return bx(n,e);if(Array.isArray(n))return n.map(t=>Vc(t,e));if(n&&typeof n=="object"){const t={};return Object.entries(n).forEach(([i,s])=>{t[i]=Vc(s,e)}),t}return n},vx=n=>{if(!n||typeof n!="object")return n;const e=n._base||"",t={};return Object.entries(n).forEach(([i,s])=>{i!=="_base"&&(t[i]=Vc(s,e))}),t},Ou="https://raw.githubusercontent.com/felixroos/dough-samples/main";async function ta(){return gu||(gu=Promise.all([Jt(()=>import("./strudel-core-DKU3hnf1.js").then(n=>n.b),[]),Jt(()=>import("./strudel-web-D2TLs97f.js").then(n=>n.a),__vite__mapDeps([0,1])),Jt(()=>import("./strudel-web-D2TLs97f.js").then(n=>n.b),__vite__mapDeps([0,1])),Jt(()=>import("./index-BN03qUel.js"),__vite__mapDeps([2,1,0]))]).then(n=>(Ef=n[0],Df=n[1],$f=n[2],Mf=n[3],Tf=null,{coreModule:Ef,webModule:Df,webaudioModule:$f,tonalModule:Mf,samplerModule:Tf}))),gu}const ma={superpiano:"piano",wood:"jazz"};function yu(n){if(!n||typeof n!="string")return n;let e=n;for(const[t,i]of Object.entries(ma)){const s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(\\.s\\(["'])${s}(["']\\))`,"gi");e=e.replace(r,(o,l,c)=>`${l}${i}${c}`);const a=new RegExp(`(sound\\(["'])${s}(["']\\))`,"gi");e=e.replace(a,(o,l,c)=>`${l}${i}${c}`)}return e}const bu={major:"major",minor:"minor",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic",ionian:"major",aeolian:"minor","melodic minor":"melodic minor","dorian b2":"dorian b2","lydian augmented":"lydian augmented","lydian dominant":"lydian dominant","mixolydian b6":"mixolydian b6","locrian #2":"locrian #2",altered:"altered","harmonic minor":"harmonic minor","locrian #6":"locrian #6","ionian #5":"ionian #5","dorian #4":"dorian #4","phrygian dominant":"phrygian dominant","lydian #2":"lydian #2",ultralocrian:"ultralocrian","harmonic major":"harmonic major","dorian b5":"dorian b5","phrygian b4":"phrygian b4","lydian b3":"lydian b3","mixolydian b2":"mixolydian b2","lydian augmented #2":"lydian augmented #2","locrian bb7":"locrian bb7","major pentatonic":"major pentatonic","suspended pentatonic":"suspended pentatonic","man gong":"man gong",ritusen:"ritusen","minor pentatonic mode 5":"minor pentatonic","minor pentatonic":"minor pentatonic","blues minor pentatonic":"minor pentatonic","major pentatonic mode 3":"major pentatonic",egyptian:"egyptian","minor pentatonic mode 5":"minor pentatonic","whole tone":"whole tone","half-whole diminished":"dominant diminished","whole-half diminished":"diminished","minor blues":"blues"};function _f(n){const e=/(\s+|[,;:<>()[\]{}|\\/]+|\*+)/g,t=n.split(e);let i=!1,s=null;for(let r=0;r<t.length;r++){const a=t[r];if(!a||e.test(a)){e.lastIndex=0;continue}const o=a.match(/^([a-gA-G])([#b]?)(-?\d+)?(@[\d.]+)?$/);if(!o){e.lastIndex=0;continue}const l=o[1].toUpperCase(),c=o[2]||"",u=o[3]?parseInt(o[3],10):null,h=o[4]||"",d=[];u!==null&&!Number.isNaN(u)&&d.push(u),s!==null&&(d.push(Math.round(s/12)-1),d.push(Math.round(s/12)),d.push(Math.round(s/12)+1)),d.push(3,4,5);let f=null;for(const y of d){const b=`${l}${c}${y}`,P=Bc.get(b);if(P&&Number.isFinite(P.midi)){f=P;break}}if(!f||!Number.isFinite(f.midi))return null;const m=Math.round(f.midi);s===null&&(s=m);const g=m-s;t[r]=String(g)+h,i=!0,e.lastIndex=0}return i?t.join(""):null}function Ff(n){if(!n||typeof n!="string")return n;const e=/\bnote\s*\(\s*([a-gA-G][^'"()]*?)\s*\)/gi;let t=n.replace(e,(s,r)=>{const a=(r||"").trim();if(!a)return s;const o=_f(a);return o===null?s:`n("${o}")`});const i=/\bnote\s*\(\s*(['"])([\s\S]*?)\1\s*\)/gi;return t=t.replace(i,(s,r,a)=>{const o=_f(a);return o===null?s:`n(${r}${o}${r})`}),t}let Bf=!1,vu=null,Su=null;function Ys(){if(Bf)return;Bf=!0,vu=vu||console.error,Su=Su||console.warn;const n=e=>{if(e&&e.length>0){let t="",i=null;if(typeof e[0]=="string"?t=e[0]:e[0]instanceof Error||typeof e[0]=="object"&&e[0]!==null?(t=e[0].message||String(e[0]),i=e[0]):t=String(e[0]),t.includes("AudioContext")&&(t.includes("not allowed")||t.includes("start")||t.includes("resume")||t.includes("user gesture"))||t.includes("@strudel/core was loaded more than once")||t.includes("undefined instead of pattern")||t.includes('got "undefined" instead of pattern')||t.includes("got undefined instead of pattern")||t.includes("Pattern evaluation failed: got undefined"))return!0;let s=t;for(let a=0;a<e.length;a++)(typeof e[a]=="string"||e[a]&&e[a].toString)&&(s+=" "+String(e[a]));const r=s.toLowerCase();if(s.includes("not found! Is it loaded?")||s.includes("not found")||r.includes("not found")||s.includes("sound ")&&s.includes("not found")||s.includes("[getTrigger] error")||s.includes("[getTrigger]")||t.includes("[getTrigger]")||s.includes("[eval] error")||s.includes("[eval]")||t.includes("[eval]")||s.includes("Unexpected token")||s.includes("createPeriodicWave")||s.includes("length of the real array provided (0)")||s.includes("minimum bound (2)")||s.includes('got "undefined" instead of pattern')||s.includes("got undefined instead of pattern")||s.includes("undefined instead of pattern")||r.includes("undefined instead of pattern")||t.includes("undefined instead of pattern")||s.includes("RolandTR909")||s.includes("RolandTR808")||s.includes("RolandTR")||r.includes("rolandtr")||t.includes("RolandTR")||s.includes("[superdough]")||s.includes("cannot schedule sounds in the past")||t.includes("[superdough]")||t.includes("cannot schedule sounds in the past")||(t.includes("SyntaxError")||s.includes("SyntaxError"))&&(t.includes("JSON")||s.includes("JSON"))||t.includes("<!DOCTYPE")||s.includes("<!DOCTYPE")||t.includes("Unexpected token")&&t.includes("<")||s.includes("Unexpected token")&&s.includes("<")||t.includes("is not valid JSON")||s.includes("is not valid JSON")||s.includes("Unexpected non-whitespace character after JSON")||s.includes("Unexpected token")&&s.includes("JSON")||s.includes("error loading")&&(s.includes("CycleTones")||s.includes("strudel.json"))||s.includes("Failed to load default sound banks")||t.includes("Failed to load default sound banks")||i&&i.isUndefinedPattern===!0)return!0}return!1};console.error=(...e)=>{const t=n(e);if(!t&&e.length>0){const i=e[0],s=typeof i=="string"?i:String(i);if(s.includes("[eval]")||s.includes("[getTrigger]")||s.includes("RolandTR")||s.includes("undefined instead of pattern")||s.includes("not found")||s.includes("createPeriodicWave")||s.includes("length of the real array provided (0)")||s.includes("minimum bound (2)")||s.includes("Unexpected token"))return}t||vu.apply(console,e)},console.warn=(...e)=>{const t=n(e);if(!t&&e.length>0){const i=e[0],s=typeof i=="string"?i:String(i);if(s.includes("[eval]")||s.includes("[getTrigger]")||s.includes("RolandTR")||s.includes("undefined instead of pattern")||s.includes("not found")||s.includes("[superdough]")||s.includes("cannot schedule sounds in the past")||s.includes("CycleTones not available")||s.includes("falling back to dirt-samples")||s.includes("createPeriodicWave")||s.includes("length of the real array provided (0)")||s.includes("minimum bound (2)")||s.includes("Unexpected token"))return}t||Su.apply(console,e)}}Ys();function yn(n,...e){try{n&&typeof n._logRoute=="function"&&n._logRoute(...e)}catch{}}class Sx{constructor(){this.audioContext=null,this.appInstance=null,this.volume=Lt.defaults.volume,this.activeSounds=new Map,this.audioBuffers=new Map,this.oscillators=new Map,this.elementGainNodes=new Map,this.elementPanNodes=new Map,this.elementGainValues=new Map,this.elementPanValues=new Map,this.currentEvaluatingSlot=null,this.initialized=!1,this.strudelSoundBanksLoaded=!1,this.strudelSoundBankLoading=!1,this.soundsPreloaded=!1,this.onSoundsReadyCallback=null,this.onMasterPatternUpdateCallback=null,this.onMasterStateChangeCallback=null,this.strudelLoading=!1,this.strudelLoaded=!1,this.strudelPatternSlots=new Map,this.patternSlotToElementId=new Map,this.nextPatternSlot=1,this.previewSlotName="d16",this.reservedSlots=new Set([this.previewSlotName]),this.loadedBanks=new Set,this.currentTempo=120,this.currentKey="C",this.currentScale="chromatic",this.currentTimeSignature="",this.patternCache=new Map,this.masterGainNode=null,this._manualStrudelOutputNode=null,this._manualStrudelOutputDisabled=!1,this.masterPanNode=null,this.masterVolume=.7,this.masterPan=0,this.masterMuted=!1,this.masterVolumeBeforeMute=.7,this.visualizerAnalyser=null,this.visualizerAnalyserTapGain=null,this.visualizerAnalyserTapGainConnected=!1,this.debugAudioRouting=!1,this._logRoute=(...e)=>{this.debugAudioRouting&&console.log(...e)},this._routingBypass=!1,this.masterPattern="",this.masterSlot="d0",this.trackedPatterns=new Map,this.masterActive=!1,this.masterPlaybackStartTime=null,this.masterPlaybackSpeed=1,this.masterPlaybackTempo=this.currentTempo,this.masterOnlyPlayback=!0,this.previewElementIds=new Set,this.sampleNameToSpecialtyBank=new Map,this.specialtyManifests=new Map,this._pendingMasterPatternRefreshReason=null,this._masterPatternRefreshTimer=null,this._masterPatternEvalPromise=Promise.resolve(),this._cachedScaleContext=null,this._cachedScaleKey="",this.mediaRecorder=null,this.recordedChunks=[],this.isRecording=!1}getPatternSlot(e){if(e==="modal-preview"){const i=this.previewSlotName,s=this.patternSlotToElementId.get(i);return s&&s!==e&&(console.log(`⚠️ Preview slot ${i} previously mapped to ${s}, reassigning...`),this.strudelPatternSlots.delete(s),this.patternSlotToElementId.delete(i),this.getPatternSlot(s)),this.strudelPatternSlots.set(e,i),this.patternSlotToElementId.set(i,e),i}if(!this.strudelPatternSlots.has(e)){let i=this.nextPatternSlot,s=`d${i}`;for(;this.reservedSlots.has(s);)i++,i>16&&(i=1),s=`d${i}`;this.strudelPatternSlots.set(e,s),this.patternSlotToElementId.set(s,e),console.log(`🎵 Assigned ${e} to pattern slot ${s}`),i++,i>16&&(i=1),this.nextPatternSlot=i}const t=this.strudelPatternSlots.get(e);return console.log(`🎵 ${e} using slot ${t}`),t}onSoundsReady(e){this.onSoundsReadyCallback=e}onMasterPatternUpdate(e){this.onMasterPatternUpdateCallback=e}onMasterStateChange(e){this.onMasterStateChangeCallback=e}async initializeStrudelAndSounds(){try{if(console.log("📦 Loading Strudel from CDN..."),!window.strudel||!window.strudel.evaluate||typeof globalThis.silence!="object"||typeof globalThis.sound!="function"?(console.log("Loading Strudel (window.strudel exists:",!!window.strudel,", functions exposed:",typeof globalThis.sound=="function",")"),await this.loadStrudelFromCDN()):console.log("Strudel already loaded and functions exposed"),!window.strudel||!window.strudel.evaluate)return console.error("Strudel failed to load properly"),!1;if(typeof globalThis.silence!="object"||typeof globalThis.sound!="function")return console.error("Strudel loaded but functions not exposed to globalThis!"),console.log("  typeof globalThis.silence:",typeof globalThis.silence,"(should be object)"),console.log("  typeof globalThis.sound:",typeof globalThis.sound,"(should be function)"),console.log("  typeof globalThis.note:",typeof globalThis.note,"(should be function)"),!1;if(console.log("✅ Strudel loaded successfully with functions exposed"),console.log("🔇 Ensuring all patterns are silent..."),globalThis.silence&&typeof globalThis.silence=="object")for(let i=1;i<=16;i++)try{window.strudel.evaluate(`d${i} = silence`).catch(()=>{})}catch{}else console.warn("⚠️ silence pattern not available yet - skipping pattern slot initialization");return console.log("📦 Loading sound banks..."),await this.ensureDefaultSoundBanks()?console.log("✅ Default sound banks loaded"):console.warn("⚠️ Default sound banks failed to load"),console.log("📦 Preloading all sounds..."),await this.preloadAllCommonDrumSounds(),console.log("📦 Pre-loading all configured patterns..."),this.preloadAllPatterns().catch(i=>{console.log("⚠️ Pattern pre-loading failed:",i)}),this.soundsPreloaded=!0,console.log("✅✅✅ All sounds ready and preloaded!"),!0}catch(e){return console.error("Error initializing Strudel/sounds:",e),!1}}async initialize(){var e;if(this.initialized&&this.audioContext&&this.audioContext.state==="running")return!0;try{if(this.audioContext&&this.audioContext.state==="closed"&&(this.audioContext=null),!this.audioContext){const t=window.AudioContext||window.webkitAudioContext;window.__OriginalAudioContext||(window.__OriginalAudioContext=t),this.audioContext=new t;const i=this.audioContext,s=function(){return yn(this,"🎚️ AudioContext constructor hijacked - returning our shared context"),i};if(s.prototype=t.prototype,s.__proto__=t,window.AudioContext=s,window.webkitAudioContext&&(window.webkitAudioContext=s),window.__hijackedAudioContext=i,this.audioContext.__masterPanNode=!0,console.log("✅ AudioContext hijacked - all future AudioContext creations will use our shared context"),this.masterPanNode=this.audioContext.createStereoPanner(),this.masterGainNode=this.audioContext.createGain(),this._realDestination=this.audioContext.destination,this.masterPanNode.connect(this.masterGainNode),this.masterGainNode.connect(this._realDestination),yn(this,`🎚️ ✅ INITIAL: Connected masterPan -> masterGain -> destination (gain=${this.masterGainNode.gain.value.toFixed(3)})`),this.masterGainNode.gain.value=this.masterVolume,this.masterPanNode.pan.value=this.masterPan,this.gainNode=this.masterGainNode,console.log("💡 Master channel ready - will route Strudel through it during init"),this.strudelLoaded||(yn(this,"🎚️ Loading Strudel after hijacking AudioContext (master nodes ready for destination)..."),await this.loadStrudelFromCDN()),!AudioNode.prototype.__originalConnect){AudioNode.prototype.__originalConnect=AudioNode.prototype.connect;const r=this.masterPanNode,a=this.masterGainNode,o=this.audioContext,l=this,c=this._realDestination;AudioNode.prototype.connect=function(u,h,d){var q,W,U,Z,Y,ne,re,ve,Ce,De,Ue,Pt,yt,ue;if(l&&l._routingBypass===!0)return this.__originalConnect.call(this,u,h,d);const f=this.context,m=u==null?void 0:u.context,g=f&&f===o,y=m&&m===o,b=u===c||u===o.destination;if(!g||!(y||u&&!m&&b))return this.__originalConnect.call(this,u,h,d);if(l&&l.masterActive){const Je=this.constructor.name,he=((q=u==null?void 0:u.constructor)==null?void 0:q.name)||"unknown",Et=u===c||u===o.destination||((W=u==null?void 0:u.constructor)==null?void 0:W.name)==="AudioDestinationNode";l._allConnectionsDebugLogged||(l._allConnectionsDebugLogged=new Set);const Ze=`${Je}->${he}`;l._allConnectionsDebugLogged.has(Ze)||(console.log(`🔊 CONNECTION DEBUG: ${Je} -> ${he}, isDestination=${Et}, context=${this.context===o?"OUR":"OTHER"}`),l._allConnectionsDebugLogged.add(Ze))}const k=this.constructor.name==="AnalyserNode",w=u===c||u===o.destination,C=u&&u.constructor&&u.constructor.name==="AudioDestinationNode";if((w||C)&&!k){l._allDestConnectionsLogged||(l._allDestConnectionsLogged=new Set);const Je=`${this.constructor.name}->${(U=u==null?void 0:u.constructor)==null?void 0:U.name}`;l._allDestConnectionsLogged.has(Je)||(l._logRoute(`🎚️ 🔴 DESTINATION CONNECTION: ${this.constructor.name} -> ${(Z=u==null?void 0:u.constructor)==null?void 0:Z.name}, masterActive=${l.masterActive}, trackedPatterns=${l.trackedPatterns.size}`),l._allDestConnectionsLogged.add(Je))}if(l.masterActive&&!k){l._allConnectionsLogged||(l._allConnectionsLogged=new Set);const Je=`${this.constructor.name}->${(Y=u==null?void 0:u.constructor)==null?void 0:Y.name}`;l._allConnectionsLogged.has(Je)||(l._logRoute(`🎚️ Connection attempt: ${this.constructor.name} -> ${(ne=u==null?void 0:u.constructor)==null?void 0:ne.name}, isMasterDest=${w}, isAnyDest=${C}, masterActive=${l.masterActive}`),l._allConnectionsLogged.add(Je))}const $=(w||C)&&!k,A=l.masterActive&&l.trackedPatterns.size>0,Q=A;if($){l._masterDestinationConnectLogged||(l._logRoute(`🎚️ ✅ INTERCEPTING connection to destination: ${this.constructor.name} -> ${(re=u==null?void 0:u.constructor)==null?void 0:re.name}, masterActive=${l.masterActive}, trackedPatterns=${l.trackedPatterns.size}`),l._masterDestinationConnectLogged=!0),l._nodeTypeConnectLogged||(l._nodeTypeConnectLogged=new Set);const Je=this.constructor.name;if(l._nodeTypeConnectLogged.has(Je)||(l._logRoute(`🎚️ Intercepting ${Je} connecting to ${(ve=u==null?void 0:u.constructor)==null?void 0:ve.name}`),l._nodeTypeConnectLogged.add(Je)),A){const me=r||a;if(me){if(r&&a)try{r.connect(a)}catch(Ye){Ye.message.includes("already")||console.warn(`⚠️ Master chain connect error: ${Ye.message}`)}if(a&&l._realDestination)try{a.connect(l._realDestination)}catch(Ye){Ye.message.includes("already")||console.warn(`⚠️ Master destination connect error: ${Ye.message}`)}return this.__punchcardMasterRouted=!0,this.__punchcardMasterConnectionNode=me,this.__originalConnect.call(this,me,h,d)}}let he=null;if(!Q&&l.masterActive&&l.trackedPatterns.size>0){const me=Array.from(l.trackedPatterns.keys());if(me.length===1)he=me[0],l._singleElementMasterRoutingLogged||(l._logRoute(`🎚️ Single element master detected, routing through ${he} (trackedPatterns.size=${l.trackedPatterns.size})`),l._logRoute(`🎚️ currentEvaluatingSlot=${l.currentEvaluatingSlot}, patternSlotToElementId mapping:`,Array.from(l.patternSlotToElementId.entries())),l._singleElementMasterRoutingLogged=!0);else if(l.currentEvaluatingSlot){const Ye=l.patternSlotToElementId.get(l.currentEvaluatingSlot);Ye&&me.includes(Ye)&&(he=Ye,l._logRoute(`🎚️ Multi-element evaluate: routing via currentEvaluatingSlot ${l.currentEvaluatingSlot} -> ${he}`))}}if(l.masterActive&&!he&&l.currentEvaluatingSlot&&(he=l.patternSlotToElementId.get(l.currentEvaluatingSlot),he?l._logRoute(`🎚️ Found element from currentEvaluatingSlot: ${he} (slot: ${l.currentEvaluatingSlot})`):l._logRoute(`🎚️ currentEvaluatingSlot=${l.currentEvaluatingSlot} but no mapping found. Available mappings:`,Array.from(l.patternSlotToElementId.entries()))),!he)for(const[me,Ye]of l.patternSlotToElementId.entries())try{const xt=globalThis[me];if(xt&&xt!==globalThis.silence){he=Ye,l._logRoute(`🎚️ Found element from active slot: ${he} (slot: ${me})`);break}}catch{}if(he){const me=l.getElementAudioNodes(he);if(me&&me.gainNode){const Ye=me.panNode;if(this.__punchcardMasterRouted&&this.__punchcardMasterConnectionNode&&typeof this.disconnect=="function"){try{this.disconnect(this.__punchcardMasterConnectionNode),l._logRoute(`🎚️ Disconnected ${this.constructor.name} from master fallback before routing through element chain`)}catch{}this.__punchcardMasterRouted=!1,this.__punchcardMasterConnectionNode=null}if(Ye)if(l.masterPanNode||l.masterGainNode)try{l._panNodeConnectedToMaster||(l._panNodeConnectedToMaster=new Set);const mn=`${he}-${l.masterPanNode?"pan":"gain"}`;if(!l._panNodeConnectedToMaster.has(mn)){let ot=!1;if(l.masterPanNode)try{Ye.connect(l.masterPanNode),ot=!0,l._panNodeConnectedToMaster.add(mn),l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.has(he)||(l._logRoute(`🎚️ ✅ Connected ${he} panNode -> masterPanNode`),l._panNodeConnectedLogged.add(he))}catch(en){if(en.message.includes("already connected")||en.message.includes("already been connected"))l._panNodeConnectedToMaster.add(mn),ot=!0;else throw en}else if(l.masterGainNode)try{Ye.connect(l.masterGainNode),ot=!0,l._panNodeConnectedToMaster.add(mn),l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.has(he)||(l._logRoute(`🎚️ ✅ Connected ${he} panNode -> masterGainNode (fallback)`),l._panNodeConnectedLogged.add(he))}catch(en){if(en.message.includes("already connected")||en.message.includes("already been connected"))l._panNodeConnectedToMaster.add(mn),ot=!0;else throw en}ot||console.error(`❌ ${he} panNode: Master nodes exist but connection failed!`)}}catch(mn){l._panNodeConnectionErrorLogged||(l._panNodeConnectionErrorLogged=new Set),l._panNodeConnectionErrorLogged.has(he)||(console.error(`❌ Failed to connect ${he} panNode to master chain:`,mn.message),console.error("   panNode:",Ye),console.error("   masterPanNode:",l.masterPanNode),console.error("   masterGainNode:",l.masterGainNode),l._panNodeConnectionErrorLogged.add(he))}else l._panNodeNotConnectedLogged||(l._panNodeNotConnectedLogged=new Set),l._panNodeNotConnectedLogged.has(he)||(console.warn(`⚠️ ${he} panNode: Master nodes not available yet (will connect when available)`),l._panNodeNotConnectedLogged.add(he));let xt=[];xt.push(`gainNode: gain=${me.gainNode.gain.value.toFixed(3)}, inputs=${me.gainNode.numberOfInputs}, outputs=${me.gainNode.numberOfOutputs}`),Ye?xt.push(`panNode: pan=${Ye.pan.value.toFixed(3)}, inputs=${Ye.numberOfInputs}, outputs=${Ye.numberOfOutputs}`):xt.push("panNode: MISSING"),l.masterPanNode?xt.push(`masterPanNode: inputs=${l.masterPanNode.numberOfInputs}, outputs=${l.masterPanNode.numberOfOutputs}`):xt.push("masterPanNode: MISSING"),l.masterGainNode?xt.push(`masterGainNode: gain=${l.masterGainNode.gain.value.toFixed(3)}, inputs=${l.masterGainNode.numberOfInputs}, outputs=${l.masterGainNode.numberOfOutputs}`):xt.push("masterGainNode: MISSING"),l._chainVerificationLogged||(l._chainVerificationLogged=new Set),l._chainVerificationLogged.has(he)||(l._logRoute(`🎚️ INTERCEPTED: Routing ${he} audio through element gain node (${this.constructor.name} -> ${me.gainNode.constructor.name})`),l._logRoute(`🎚️ Audio chain verification for ${he}:`,xt.join(", ")),l._chainVerificationLogged.add(he));const ai=me.panNode;if(ai&&!((Ce=l._panNodeConnectedLogged)!=null&&Ce.has(he)))try{if(l.masterPanNode)try{ai.connect(l.masterPanNode),l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.add(he),l._logRoute(`🎚️ ✅ CRITICAL: Connected ${he} panNode -> masterPanNode`)}catch{l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.add(he)}else if(l.masterGainNode)try{ai.connect(l.masterGainNode),l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.add(he),l._logRoute(`🎚️ ✅ CRITICAL: Connected ${he} panNode -> masterGainNode (fallback)`)}catch{l._panNodeConnectedLogged||(l._panNodeConnectedLogged=new Set),l._panNodeConnectedLogged.add(he)}}catch(Nt){console.error(`❌ CRITICAL: Failed to connect ${he} panNode: ${Nt.message}`)}const Tn=this.__originalConnect.call(this,me.gainNode,h,d);if(l._masterGainDestVerifiedAfterRouting||(l._masterGainDestVerifiedAfterRouting=new Set),!l._masterGainDestVerifiedAfterRouting.has(he))if(l._masterGainDestVerifiedAfterRouting.add(he),l._logRoute(`🎚️ 🔍 VERIFYING: masterGainNode=${!!l.masterGainNode}, _realDestination=${!!l._realDestination}, gain=${((Pt=(Ue=(De=l.masterGainNode)==null?void 0:De.gain)==null?void 0:Ue.value)==null?void 0:Pt.toFixed(3))||"N/A"}, muted=${l.masterMuted}`),l.masterGainNode&&l._realDestination)try{l.masterGainNode.connect(l._realDestination),l._logRoute(`🎚️ ✅ CRITICAL: Connected masterGainNode -> destination after routing ${he} (gain=${l.masterGainNode.gain.value.toFixed(3)}, muted=${l.masterMuted})`)}catch(Nt){l._logRoute(`🎚️ ✅ CRITICAL: masterGainNode -> destination already connected for ${he} (${Nt.message})`)}else console.error(`❌ CRITICAL: Cannot verify masterGainNode -> destination: masterGainNode=${!!l.masterGainNode}, _realDestination=${!!l._realDestination}`);return l._connectionSuccessLogged||(l._connectionSuccessLogged=new Set),l._connectionSuccessLogged.has(he)||(l._logRoute(`🎚️ Connection result for ${he}: ${Tn?"SUCCESS":"FAILED"}, source inputs now: ${me.gainNode.numberOfInputs}`),l._connectionSuccessLogged.add(he)),this.__punchcardElementRouted!==!0&&(this.__punchcardElementRouted=!0),Tn}else console.error(`❌ CRITICAL: Element ${he} found but no gain node available - elementNodes=${!!me}, gainNode=${!!(me!=null&&me.gainNode)}`),console.error("❌ This means audio will bypass element controls!"),he=null}else{if(A){l._stackMasterRoutingLogged||(console.log(`🎚️ Stack() pattern: Routing through master chain (${l.trackedPatterns.size} elements)`),l._stackMasterRoutingLogged=!0);const Ye=r||a;if(Ye)return this.__originalConnect.call(this,Ye,h,d)}l._noElementRoutingLogged||(l._logRoute(`🎚️ No element found for routing - trackedPatterns.size=${l.trackedPatterns.size}, currentEvaluatingSlot=${l.currentEvaluatingSlot}`),l._logRoute("🎚️ Available pattern slot mappings:",Array.from(l.patternSlotToElementId.entries())),l._logRoute("🎚️ Tracked elements:",Array.from(l.trackedPatterns.keys())),l._noElementRoutingLogged=!0)}if(l.masterActive&&l.trackedPatterns.size===1&&!he){const me=Array.from(l.trackedPatterns.keys());l._logRoute(`🎚️ 🔍 FALLBACK CHECK: trackedPatterns.size=${l.trackedPatterns.size}, elementId=${he}, trackedElementIds=${me.join(", ")}`),me.length===1?(he=me[0],l._logRoute(`🎚️ ⚠️ Fallback: Using tracked element ${he} for routing (elementId was null)`)):console.warn(`🎚️ ⚠️ Fallback: trackedElementIds.length=${me.length}, expected 1`)}else l.trackedPatterns.size!==1?console.log(`🎚️ 🔍 FALLBACK SKIP: trackedPatterns.size=${l.trackedPatterns.size}, elementId=${he} (not single element, skipping fallback)`):he&&console.log(`🎚️ 🔍 FALLBACK SKIP: trackedPatterns.size=${l.trackedPatterns.size}, elementId=${he} (elementId already set, skipping fallback)`);if(he){console.log(`🎚️ 🔍 FALLBACK ROUTING ATTEMPT: elementId=${he}, attempting to get elementNodes...`);const me=l.getElementAudioNodes(he);if(console.log(`🎚️ 🔍 FALLBACK ROUTING: elementNodes=${!!me}, gainNode=${!!(me!=null&&me.gainNode)}, panNode=${!!(me!=null&&me.panNode)}`),me&&me.gainNode){const Ye=me.panNode;if(Ye&&r)try{try{Ye.disconnect(r)}catch{}Ye.connect(r)}catch{}return console.log(`🎚️ ✅ FALLBACK ROUTING: Routing ${this.constructor.name} through ${he} element chain (gain=${me.gainNode.gain.value.toFixed(3)})`),this.__originalConnect.call(this,me.gainNode,h,d)}else console.error(`❌ CRITICAL FALLBACK: Element ${he} found but elementNodes or gainNode is missing - elementNodes=${!!me}, gainNode=${!!(me!=null&&me.gainNode)}`),console.error("❌ Audio will route through master chain, bypassing element controls!")}else console.log("🎚️ 🔍 FALLBACK ROUTING SKIP: elementId is null, will route through master chain");const Ze=A||l.trackedPatterns.size===0||!l.masterActive?r||a:null;if(Ze){if(this.__punchcardElementRouted)return console.log(`🎚️ Skipping master fallback for ${this.constructor.name} (already routed through element chain)`),this.__originalConnect.call(this,u,h,d);l._masterRoutingLogged||(l._masterRoutingLogged=new Set);const me=`master-${Ze.constructor.name}`;if(!l._masterRoutingLogged.has(me)){if(l._masterRoutingLogged.add(me),console.log(`🎚️ ⚠️ FALLBACK: Routing ${this.constructor.name} through master chain (${Ze.constructor.name}) - element routing not available`),console.log(`🎚️ ⚠️ FALLBACK: masterGainNode.gain=${((ue=(yt=a==null?void 0:a.gain)==null?void 0:yt.value)==null?void 0:ue.toFixed(3))||"N/A"}, muted=${l.masterMuted}, connected to destination=${!!l._realDestination}`),r&&a)try{r.connect(a),console.log("🎚️ ✅ FALLBACK: Verified masterPanNode -> masterGainNode connection")}catch(xt){xt.message.includes("already connected")||xt.message.includes("already been connected")?console.log("🎚️ ✅ FALLBACK: masterPanNode -> masterGainNode already connected"):console.warn(`⚠️ FALLBACK: Could not connect masterPanNode -> masterGainNode: ${xt.message}`)}if(a&&l._realDestination)try{a.connect(l._realDestination),console.log(`🎚️ ✅ FALLBACK: Ensured masterGainNode -> destination connection (gain=${a.gain.value.toFixed(3)})`)}catch(xt){console.log(`🎚️ ✅ FALLBACK: masterGainNode -> destination already connected (${xt.message})`)}}const Ye=this.__originalConnect.call(this,Ze,h,d);return this.__punchcardMasterRouted=!0,this.__punchcardMasterConnectionNode=Ze,Ye}if(!r&&!a&&console.warn("⚠️ No master nodes available, allowing direct connection to destination"),a&&c)try{a.connect(c),l._masterGainDestVerified||(console.log("🎚️ ✅ Ensured masterGainNode -> destination connection (critical for audio output)"),l._masterGainDestVerified=!0)}catch(me){!l._masterGainDestVerified&&me.message&&!me.message.includes("already connected")&&(console.log(`🎚️ masterGainNode -> destination: ${me.message.includes("already")?"already connected":"connection verified"}`),l._masterGainDestVerified=!0)}}return this.__originalConnect.call(this,u,h,d)},console.log("🎚️ Patched AudioNode.prototype.connect to route through element gain nodes or master channel"),console.log("🎚️ Hijacking verification: AudioNode.prototype.__originalConnect exists:",!!AudioNode.prototype.__originalConnect),console.log("🎚️ Hijacking verification: AudioNode.prototype.connect is patched:",AudioNode.prototype.connect!==AudioNode.prototype.__originalConnect)}this.audioContext.__masterPanNode=this.masterPanNode,console.log("Audio context created with master channel, state:",this.audioContext.state),yn(this,`🎚️ Master initialized: volume=${(this.masterVolume*100).toFixed(0)}%, pan=${this.masterPan.toFixed(2)}`)}if(this.audioContext.state==="suspended")try{Ys(),await this.audioContext.resume(),this.audioContext.state==="running"?console.log("Audio context resumed successfully"):console.log("Audio context state:",this.audioContext.state)}catch(t){return t.message&&t.message.includes("user gesture")||console.error("Cannot resume audio context:",t),!1}return this.audioContext&&this.audioContext.state==="running"?(this.initialized=!0,console.log("Sound Manager initialized successfully"),this.masterGainNode&&(this.masterGainNode.gain.value=this.masterVolume),this.masterPanNode&&(this.masterPanNode.pan.value=this.masterPan),yn(this,`🎚️ Master values set: volume=${(this.masterVolume*100).toFixed(0)}%, pan=${this.masterPan.toFixed(2)}`),console.log("🎵 Starting Strudel initialization and sound bank loading..."),this.initializeStrudelAndSounds().catch(t=>{console.error("Failed to initialize Strudel/sounds:",t)}),this.preloadAudioFiles().catch(t=>{console.log("Background audio preload failed:",t)}),!0):(console.warn("Audio context not in running state:",(e=this.audioContext)==null?void 0:e.state),!1)}catch(t){return console.error("Failed to initialize audio context:",t),this.initialized=!1,!1}}async preloadAudioFiles(){const e=Lt.getAudioElements();for(const t of e)if(t.audioFile)try{(await fetch(t.audioFile,{method:"HEAD"})).ok?await this.loadAudioFile(t.id,t.audioFile):console.log(`Skipping preload for ${t.id} (file not found): ${t.audioFile}`)}catch{}}async loadAudioFile(e,t){try{const i=await fetch(t);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const s=await i.arrayBuffer(),r=await this.audioContext.decodeAudioData(s);return this.audioBuffers.set(e,r),r}catch(i){throw console.error(`Error loading audio file ${t}:`,i),i}}setVolume(e){this.volume=Math.max(0,Math.min(1,e)),this.gainNode&&(this.gainNode.gain.value=this.volume)}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e)),this.masterGainNode?(this.masterGainNode.gain.value=this.masterVolume,yn(this,`🎚️ Master volume set to ${(this.masterVolume*100).toFixed(0)}% (gainNode instant via Web Audio API)`)):yn(this,`🎚️ Master volume stored as ${(this.masterVolume*100).toFixed(0)}% (gainNode not ready yet)`)}setMasterPan(e){this.masterPan=Math.max(-1,Math.min(1,e)),this.masterPanNode?(this.masterPanNode.pan.value=this.masterPan,yn(this,`🎚️ Master pan set to ${this.masterPan.toFixed(2)} (panNode instant via Web Audio API)`)):yn(this,`🎚️ Master pan stored as ${this.masterPan.toFixed(2)} (panNode not ready yet)`)}toggleMasterMute(){return this.masterMuted=!this.masterMuted,this.masterMuted?(this.masterVolumeBeforeMute=this.masterVolume,this.masterGainNode&&(this.masterGainNode.gain.value=0),console.log("🔇 Master muted (instant via Web Audio API)")):(this.masterGainNode&&(this.masterGainNode.gain.value=this.masterVolumeBeforeMute),this.masterVolume=this.masterVolumeBeforeMute,console.log(`🔊 Master unmuted (volume: ${(this.masterVolume*100).toFixed(0)}%) (instant via Web Audio API)`)),this.masterMuted}getElementAudioNodes(e){if(!this.audioContext)return null;if(!this.elementGainNodes.has(e)){const t=this.audioContext.createGain(),i=this.audioContext.createStereoPanner(),s=this.elementGainValues.get(e)||.8,r=this.elementPanValues.get(e)||0;this.elementGainNodes.set(e,t),this.elementPanNodes.set(e,i),this.elementGainValues.set(e,s),this.elementPanValues.set(e,r),t.gain.value=s*this.volume,i.pan.value=r,t.connect(i);let a=!1;if(this.masterPanNode)try{i.connect(this.masterPanNode),a=!0,yn(this,`🎚️ ${e}: Connected panNode to masterPanNode during node creation`)}catch(o){console.warn(`⚠️ ${e}: Failed to connect panNode to masterPanNode:`,o.message)}else if(this.masterGainNode)try{i.connect(this.masterGainNode),a=!0,yn(this,`🎚️ ${e}: Connected panNode to masterGainNode during node creation`)}catch(o){console.warn(`⚠️ ${e}: Failed to connect panNode to masterGainNode:`,o.message)}else if(this.gainNode)try{i.connect(this.gainNode),a=!0,yn(this,`🎚️ ${e}: Connected panNode to gainNode during node creation`)}catch(o){console.warn(`⚠️ ${e}: Failed to connect panNode to gainNode:`,o.message)}a||console.warn(`⚠️ ${e}: panNode not connected to master chain (master nodes may not exist yet - will connect on first audio connection)`),yn(this,`🎚️ Element audio chain for ${e}:`),console.log(`   gainNode (${t.numberOfInputs} inputs, ${t.numberOfOutputs} outputs)`),console.log(`   panNode (${i.numberOfInputs} inputs, ${i.numberOfOutputs} outputs)`),console.log(`   masterPanNode (${this.masterPanNode?this.masterPanNode.numberOfInputs:"N/A"} inputs)`),yn(this,`🎚️ Created element audio chain for ${e}: gain -> pan -> master`)}return{gainNode:this.elementGainNodes.get(e),panNode:this.elementPanNodes.get(e)}}disposeElementAudioNodes(e){if(!e)return;const t=this.elementGainNodes.get(e),i=this.elementPanNodes.get(e);if(t){try{t.disconnect()}catch{}this.elementGainNodes.delete(e)}if(i){try{i.disconnect()}catch{}this.elementPanNodes.delete(e)}this.elementGainValues.delete(e),this.elementPanValues.delete(e),this._panNodeConnectedToMaster&&(this._panNodeConnectedToMaster.delete(`${e}-pan`),this._panNodeConnectedToMaster.delete(`${e}-gain`))}isNotePattern(e){return!e||typeof e!="string"?!1:/\b(note|n)\s*\(/.test(e)}applyElementGainPanToPattern(e,t,i={}){const{applyGainInPattern:s=!0,applyPanInPattern:r=!0,applyTempoInPattern:a=!0}=i,o=this.elementGainValues.get(t)||.8,l=this.elementPanValues.get(t)||0,c=this.currentTempo||120;let u=e;u=u.replace(/\.postgain\s*\([^)]*\)/g,""),u=u.replace(/\.pan\s*\([^)]*\)/g,""),u=u.replace(/\.\.+/g,".").trim(),u=u.replace(/\.+$/,"").trim(),s&&(/\.postgain\s*\([^)]*\)\s*$/i.test(u)?u=u.replace(/\.postgain\s*\([^)]*\)\s*$/i,`.postgain(${o})`):u=`${u}.postgain(${o})`),r&&l!==0&&(u+=`.pan(${l})`);const h=c/120;return a&&(h>1?u+=`.fast(${h})`:h<1&&(u+=`.slow(${1/h})`)),console.log(`Applied gain=${o.toFixed(2)}, pan=${l.toFixed(2)}, tempo=${c} BPM (speed=${h.toFixed(2)}x) to ${t}`),u}async processPattern(e,t,i={}){const{preserveBanks:s=!1,attemptBankLoad:r=!1}=i||{};if(!e||typeof e!="string"||e.trim()==="")return null;let a=e.replace(/\s+/g," ").trim();if(a=a.replace(/\s+\./g,".").trim(),a=a.replace(/\.\.+/g,".").trim(),a=a.replace(/\.(cpm|fast|slow)\([^)]*\)/g,"").trim(),a=a.replace(/\.\.+/g,".").trim(),a=yu(a),!a||a==="")return console.warn(`[${t}] Pattern became empty after processing - cannot process`),null;const o=a.match(/\.bank\(["']([^"']+)["']\)/g);if(o){const c=o.map(h=>h.match(/\.bank\(["']([^"']+)["']\)/)[1]);console.log(`[${t}] Pattern uses bank(s):`,c);let u=!1;for(const h of c){const d=h,m=["RolandTR808","RolandTR909","RolandTR707","RhythmAce","AkaiLinn","ViscoSpaceDrum","CasioRZ1"].includes(d);let g=this.loadedBanks.has(d)||m;if(!g&&r&&typeof this.loadBank=="function")try{console.log(`[${t}] Attempting to load bank "${d}" for pattern processing`),await this.loadBank(d)?(this.loadedBanks.add(d),g=!0,console.log(`[${t}] Bank "${d}" loaded successfully for pattern processing`)):console.warn(`[${t}] Bank "${d}" could not be loaded on demand`)}catch(y){console.warn(`[${t}] Error loading bank "${d}":`,y)}!g&&!s?(console.warn(`⚠️ Bank "${d}" not loaded - removing .bank() modifier from pattern`),a=a.replace(new RegExp(`\\.bank(["']${d.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}["'])`,"g"),""),u=!0):!g&&s?console.warn(`⚠️ Bank "${d}" is not loaded but preserving .bank() for preview`):m&&(console.log(`[${t}] Bank "${d}" is built-in - keeping .bank() modifier`),this.loadedBanks.add(d))}if(a=a.replace(/\.+$/,"").trim(),u&&!s&&(!a||a.trim()===""))return console.warn("⚠️ Pattern became empty after removing unloaded banks"),null;console.log(`[${t}] Pattern after bank cleanup:`,a.substring(0,100))}const l=i.applyGainInPattern!==void 0?i.applyGainInPattern:this.masterActive;return a=this.applyElementGainPanToPattern(a,t,{applyGainInPattern:l}),!a||a.trim()===""?(console.warn(`[${t}] Pattern became empty after applying gain/pan - cannot process`),null):a}async preEvaluatePattern(e,t){if(!window.strudel||!window.strudel.evaluate)return console.log(`[${e}] Cannot pre-evaluate: Strudel not ready`),!1;if(!t||typeof t!="string"||t.trim()==="")return console.log(`[${e}] No pattern to pre-evaluate`),this.patternCache.set(e,{processedPattern:null,patternSlot:this.getPatternSlot(e),isPreEvaluated:!1,originalPattern:t||""}),!1;const i=await this.processPattern(t,e);if(!i)return console.warn(`[${e}] Pattern processing failed - cannot cache`),this.patternCache.set(e,{processedPattern:null,patternSlot:this.getPatternSlot(e),isPreEvaluated:!1,originalPattern:t}),!1;const s=this.getPatternSlot(e);try{const r=`${s} = silence`;return await window.strudel.evaluate(r),this.patternCache.set(e,{processedPattern:i,patternSlot:s,isPreEvaluated:!0,originalPattern:t}),console.log(`✅ Pre-evaluated and cached pattern for ${e} in ${s} (silent, ready for manual trigger)`),!0}catch(r){return console.warn(`[${e}] Failed to pre-evaluate pattern:`,r),this.patternCache.set(e,{processedPattern:i,patternSlot:s,isPreEvaluated:!1,originalPattern:t}),!1}}invalidatePatternCache(e){this.patternCache.delete(e),console.log(`🗑️ Invalidated pattern cache for ${e}`)}async preloadAllPatterns(){if(!window.strudel||!window.strudel.evaluate){console.log("Cannot preload patterns: Strudel not ready");return}console.log("📦 Pre-loading all configured patterns...");const e=Lt.elements||[];let t=0,i=0;for(const s of e){const r=s.id;let a=null;try{const l=localStorage.getItem(`element-config-${r}`);l&&(a=JSON.parse(l))}catch{}const o=(a==null?void 0:a.pattern)||(s==null?void 0:s.pattern)||"";o&&o.trim()!==""&&(await this.preEvaluatePattern(r,o)?t++:i++)}console.log(`✅ Pre-loaded ${t} patterns${i>0?`, ${i} failed`:""}`)}setElementGain(e,t){const i=Math.max(0,Math.min(1,t)),s=this.elementGainValues.get(e);this.elementGainValues.set(e,i),console.log(`[${e}] Gain set to ${i.toFixed(2)}`);const r=this.elementGainNodes.get(e);r&&(r.gain.value=i*this.volume,yn(this,`🎚️ Updated ${e} gain node to ${(i*this.volume).toFixed(2)}`)),s!==i&&(this.patternCache.get(e)&&(this.patternCache.delete(e),console.log(`🗑️ Invalidated pattern cache for ${e} (gain changed)`)),this.trackedPatterns.has(e)&&this.updateTrackedElementGain(e,i)),this.isPlaying(e)&&!this.masterActive&&s!==i&&this.updatePlayingPattern(e)}setElementPan(e,t){const i=Math.max(-1,Math.min(1,t)),s=this.elementPanValues.get(e);this.elementPanValues.set(e,i),console.log(`[${e}] Pan set to ${i.toFixed(2)}`);const r=this.elementPanNodes.get(e);r&&(r.pan.value=i,yn(this,`🎚️ Updated ${e} pan node to ${i.toFixed(2)}`)),s!==i&&(this.patternCache.get(e)&&(this.patternCache.delete(e),console.log(`🗑️ Invalidated pattern cache for ${e} (pan changed)`)),this.trackedPatterns.has(e)&&this.updateTrackedElementPan(e,i)),this.isPlaying(e)&&!this.masterActive&&s!==i&&this.updatePlayingPattern(e)}async updatePlayingPattern(e){const t=this.activeSounds.get(e);if(!t||t.type!=="strudel")return;const i=this.elementGainValues.get(e)||.8;if(i<=.001){console.log(`[${e}] Gain is ${i} (effectively muted) - stopping playback`),this.stopSound(e);return}const s=this.strudelPatternSlots.get(e);if(!(!s||!window.strudel||!window.strudel.evaluate))try{const r=Lt.getElementConfig(e);if(!r||!r.pattern)return;let a=r.pattern.replace(/\._scope\(\)/g,"");a=this.applyElementGainPanToPattern(a,e,{applyGainInPattern:!1}),await window.strudel.evaluate(`${s} = ${a}`),console.log(`✅ Updated ${s} with new gain/pan`)}catch(r){console.warn(`Could not update pattern for ${e}:`,r)}}async updatePatternInPlace(e,t){if(this.trackedPatterns.has(e)){const r=this.trackedPatterns.get(e),a=t.replace(/[""]/g,'"').replace(/['']/g,"'");r.rawPattern=a,r.pattern=this.convertPatternForScale(a)||a,yn(this,`🎚️ Updated tracked pattern for ${e} in master: ${t.substring(0,60)}...`),this.updateMasterPattern(this.soloedElements,this.mutedElements)}const i=this.activeSounds.get(e);if(!i||i.type!=="strudel")return;const s=this.strudelPatternSlots.get(e);if(!(!s||!window.strudel||!window.strudel.evaluate))try{let r=t.replace(/\s+/g," ").trim();r=r.replace(/\s+\./g,".").trim(),r=r.replace(/\.\.+/g,".").trim(),r=r.replace(/\.(cpm|fast|slow)\([^)]*\)/g,"").trim(),r=r.replace(/\.\.+/g,".").trim();const a=r.match(/\.bank\(["']([^"']+)["']\)/g);if(a){const o=a.map(l=>l.match(/\.bank\(["']([^"']+)["']\)/)[1]);for(const l of o)this.loadedBanks.has(l)||(r=r.replace(new RegExp(`\\.bank(["']${l}["'])`,"g"),""));r=r.replace(/\.+$/,"").trim()}r=this.applyElementGainPanToPattern(r,e,{applyGainInPattern:this.masterActive}),await window.strudel.evaluate(`${s} = ${r}`),console.log(`✅ Updated ${s} pattern in place: ${r.substring(0,60)}...`)}catch(r){console.warn(`Could not update pattern in place for ${e}:`,r)}}getElementGain(e){return this.elementGainValues.get(e)||.8}getElementPan(e){return this.elementPanValues.get(e)||0}async playSynthesizedSound(e,t){if(!this.initialized||!this.audioContext){console.log("Audio not initialized - waiting for user interaction");return}if(this.audioContext.state==="suspended")try{if(Ys(),await this.audioContext.resume(),this.audioContext.state!=="running"){console.log("Audio context not running - user interaction required");return}}catch{console.log("Audio context needs user interaction");return}this.stopSound(e);const i=this.parsePattern(t);if(i.sounds.length===0){console.warn(`No sounds parsed from pattern: ${t}`);return}console.log(`Playing pattern for ${e}:`,t,i);try{const s=this.createOscillatorForPattern(i,e);s&&s.gain?(this.activeSounds.set(e,{type:"synthesized",oscillator:s,gain:s.gain}),console.log(`Sound started for ${e}`)):console.error(`Failed to create oscillator for ${e}`)}catch(s){console.error(`Error playing sound for ${e}:`,s)}}parsePattern(e){let t=e;const i=e.match(/(?:sound|s)\(["']([^"']+)["']\)/);i&&(t=i[1]);const s={bd:{freq:60,duration:.1,type:"sine"},sd:{freq:200,duration:.05,type:"noise"},hh:{freq:800,duration:.02,type:"square"},cp:{freq:400,duration:.08,type:"triangle"},misc:{freq:300,duration:.06,type:"triangle"}},r=[];if(t.split(",").forEach((l,c)=>{let u=l.trim();u=u.replace(/(\w+)\*(\d+)/g,(f,m,g)=>Array(parseInt(g)).fill(m).join(" ")),u=u.replace(/\[([^\]]+)\]/g,(f,m)=>m.trim());const h=u.trim().split(/\s+/);let d=0;for(const f of h){if(f==="~"||f===""){d++;continue}s[f]&&r.push({...s[f],time:d*.25}),d++}}),r.length===0)return console.warn(`No sounds found in pattern: ${e}`),{sounds:[],duration:0};r.sort((l,c)=>l.time-c.time);const o=Math.max(...r.map(l=>l.time+l.duration));return{sounds:r,duration:Math.max(o,.5)}}parseIndexPattern(e){const t=[];let i=e.replace(/<([^>]+)>/g,(r,a)=>a.trim().split(/\s+/)[0]);i=i.replace(/\[([^\]]+)\]/g,(r,a)=>a.trim()),i=i.replace(/(\d+)\*(\d+)/g,(r,a,o)=>Array(parseInt(o)).fill(a).join(" "));const s=i.trim().split(/\s+/);for(const r of s){const a=parseInt(r);isNaN(a)||t.push(a)}return t}createPatternFromIndices(e){const t=["bd","sd","hh","cp","bd","sd","hh","cp"];return`sound("${e.map(s=>t[s%t.length]||"~").join(" ")}")`}createPatternFromSampleName(e){return e.includes("break")||e.includes("165")?'sound("bd ~ sd ~ bd ~ sd hh")':'sound("bd sd hh ~ cp ~ hh ~")'}createOscillatorForPattern(e,t){if(!this.audioContext)return console.error("Audio context not initialized"),{gain:null,stop:()=>{}};const i=this.audioContext.createGain(),s=t?this.getElementAudioNodes(t):null;s?(i.connect(s.gainNode),i.gain.value=1):(i.connect(this.gainNode),i.gain.value=this.volume);const r=this.audioContext.currentTime;e.sounds.forEach((o,l)=>{const c=r+o.time;if(o.type==="noise"){const u=Math.floor(this.audioContext.sampleRate*o.duration),h=this.audioContext.createBuffer(1,u,this.audioContext.sampleRate),d=h.getChannelData(0);for(let g=0;g<u;g++)d[g]=Math.random()*2-1;const f=this.audioContext.createBufferSource();f.buffer=h;const m=this.audioContext.createGain();f.connect(m),m.connect(i),m.gain.setValueAtTime(0,c),m.gain.linearRampToValueAtTime(.3,c+.01),m.gain.exponentialRampToValueAtTime(.01,c+o.duration),f.start(c),f.stop(c+o.duration)}else{const u=this.audioContext.createOscillator();u.type=o.type,u.frequency.value=o.freq;const h=this.audioContext.createGain();u.connect(h),h.connect(i),h.gain.setValueAtTime(0,c),h.gain.linearRampToValueAtTime(.5,c+.01),h.gain.exponentialRampToValueAtTime(.01,c+o.duration),u.start(c),u.stop(c+o.duration)}});const a=r+e.duration;return i.gain.setValueAtTime(this.volume,a),i.gain.exponentialRampToValueAtTime(.01,a+.1),{gain:i,stop:()=>{try{i.gain.cancelScheduledValues(this.audioContext.currentTime),i.gain.setValueAtTime(i.gain.value,this.audioContext.currentTime),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),setTimeout(()=>i.disconnect(),150)}catch(o){console.error("Error stopping sound:",o)}}}}playAudioFile(e,t){if(!this.initialized||!this.audioContext){console.warn("Audio not initialized yet. Please click anywhere first to enable audio.");return}this.audioContext.state==="suspended"&&(Ys(),this.audioContext.resume().catch(s=>{console.error("Failed to resume audio context:",s)})),this.stopSound(e);const i=this.audioBuffers.get(e);i?this.playAudioBuffer(e,i):this.loadAudioFile(e,t).then(s=>{this.playAudioBuffer(e,s)}).catch(s=>{console.error(`Failed to play audio for ${e}:`,s)})}playAudioBuffer(e,t){const i=this.audioContext.createBufferSource();i.buffer=t;const s=this.audioContext.createGain();i.connect(s);const r=this.getElementAudioNodes(e);r?(s.connect(r.gainNode),s.gain.value=1):(s.connect(this.gainNode),s.gain.value=this.volume);const a=r?1:this.volume;s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(a,this.audioContext.currentTime+Lt.defaults.fadeInTime),i.onended=()=>{this.activeSounds.delete(e)},i.start(0),this.activeSounds.set(e,{type:"audio",source:i,gain:s})}async playStrudelPattern(e,t,i,s=!1){if(!t||typeof t!="string"||t.trim()===""){console.log(`[${e}] No pattern assigned - skipping playback`);return}const r=this.elementGainValues.get(e)||.8;if(r<=.001){console.log(`[${e}] Gain is ${r} (effectively muted) - stopping playback`),this.stopSound(e);return}if(this.masterOnlyPlayback){const o=typeof e=="string"&&e.toLowerCase().includes("preview"),l=o,c=await this.routePatternThroughMaster(e,t,{isPreview:o,autoStart:l});return console.log(`🎚️ Routed ${e} through master-only playback`,c),c}if(!s){const o=document.querySelector(`[data-sound-id="${e}"]`);if(o){const l=o.querySelector(".loop-button");if((l==null?void 0:l.classList.contains("active"))&&this.isPlaying(e)){console.log(`🔄 ${e} has loop active and is playing - skipping sound trigger to prevent layering`);return}}}if(!this.initialized||!this.audioContext){console.log("Audio not initialized - attempting to initialize now...");try{await this.initialize()||console.warn("⚠️ Audio initialization failed - sounds may not play until user clicks")}catch(o){console.warn("⚠️ Error initializing audio:",o)}}if(this.strudelSoundBanksLoaded||console.log(`⏳ Sound banks not fully loaded yet for ${e}, but attempting to play anyway...`),this.audioContext.state==="suspended"){console.log(`🔄 Audio context is suspended for ${e}, attempting to resume...`);try{Ys(),await this.audioContext.resume(),await new Promise(o=>setTimeout(o,50)),this.audioContext.state!=="running"?(console.warn(`⚠️ Audio context not running after resume attempt - state: ${this.audioContext.state}`),console.warn("   User interaction (click) may be required to resume audio")):console.log(`✅ Audio context resumed successfully for ${e}`)}catch(o){console.warn("⚠️ Failed to resume audio context:",o),console.warn("   User interaction (click) may be required to resume audio")}}this.stopSound(e),window.strudel&&window.strudel.scheduler&&!window.strudel.scheduler.started&&(console.log(`▶️ Starting scheduler for ${e} playback...`),await window.strudel.scheduler.start()),console.log(`Playing Strudel pattern for ${e}:`,t);try{if(window.strudel||await this.loadStrudelFromCDN(),!window.strudel||!window.strudel.evaluate||typeof window.strudel.evaluate!="function")throw console.error("❌ window.strudel.evaluate is not available"),console.error("window.strudel:",window.strudel),new Error("Strudel REPL evaluate function is not available. Strudel may not have initialized correctly.");if(console.log("Strudel evaluate is available..."),typeof globalThis.note=="function"&&typeof globalThis.sound=="function")console.log("✅ Core functions verified and available");else{const u=new Error("Core functions not available");console.warn("Core functions not available, attempting to load...");try{const{coreModule:h}=await ta();window.__coreModule=h,await window.strudel.evaluate(`
            (function() {
              const core = window.__coreModule || {};
              if (core && typeof core === 'object') {
                Object.assign(globalThis, core);
              }
              globalThis.__core_loaded = true;
            })();
          `);for(let d=0;d<20;d++){try{if(await window.strudel.evaluate("globalThis.__core_loaded === true")&&typeof globalThis.note=="function"){console.log("✅ Core functions loaded into REPL");break}}catch{}await new Promise(f=>setTimeout(f,100))}}catch(h){console.warn("Could not load core functions:",h)}}await this.ensureDefaultSoundBanks()||console.warn("⚠️ Continuing without default sound banks - patterns may fail");try{console.log("Registering sawtooth sound...");try{const{webaudioModule:u}=await ta(),h=`
                (function() {
                  const webaudio = window.__webaudioModule || {};
                  const { registerSound, getAudioContext } = webaudio;
                  
                  registerSound('sawtooth', (time, value, onended) => {
                    let { freq } = value;
                    const ctx = getAudioContext();
                    const o = new OscillatorNode(ctx, { type: 'sawtooth', frequency: Number(freq) || 440 });
                    o.start(time);
                    const g = new GainNode(ctx, { gain: 0.3 });
                    o.connect(g);
                    const stop = (time) => {
                      o.stop(time);
                      o.disconnect();
                      g.disconnect();
                      onended();
                    };
                    o.addEventListener('ended', () => {
                      o.disconnect();
                      g.disconnect();
                      onended();
                    });
                    return { node: g, stop };
                  }, { type: 'synth' });
                  
                  // Make registerSound and getAudioContext available globally for future use
                  globalThis.registerSound = registerSound;
                  globalThis.getAudioContext = getAudioContext;
                })();
              `;window.__webaudioModule=u,await window.strudel.evaluate(h),await new Promise(d=>setTimeout(d,200)),console.log("✅ Sawtooth sound registered (will be verified on first use)")}catch(u){console.warn("Could not use webaudio module:",u);try{const{webaudioModule:h}=await ta();window.__webaudioModule=h,await window.strudel.evaluate(`
                  (function() {
                    const webaudio = window.__webaudioModule || {};
                    const { registerSound, getAudioContext } = webaudio;
                  
                  if (registerSound && getAudioContext) {
                    registerSound('sawtooth', (time, value, onended) => {
                      let { freq } = value;
                      const ctx = getAudioContext();
                      const o = new OscillatorNode(ctx, { type: 'sawtooth', frequency: Number(freq) || 440 });
                      o.start(time);
                      const g = new GainNode(ctx, { gain: 0.3 });
                      o.connect(g);
                      const stop = (time) => {
                        o.stop(time);
                      };
                      o.addEventListener('ended', () => {
                        o.disconnect();
                        g.disconnect();
                        onended();
                      });
                      return { node: g, stop };
                    }, { type: 'synth' });
                  }
                })();
              `),await new Promise(f=>setTimeout(f,200)),console.log("✅ Sawtooth sound registered via REPL")}catch(h){console.warn("Could not register sawtooth via fallback:",h)}}}catch(u){console.warn("Could not register sawtooth sound:",u),console.warn("Pattern may still work if sawtooth is a default sound")}if(i){const u=window.strudel.samples||globalThis.samples;if(u&&typeof u=="function")try{if(typeof i=="string")console.log("Loading custom samples with string:",i),await u(i),console.log("Custom samples loaded successfully");else if(typeof i=="object"&&i!==null){const h=Lt.getElementConfig(e),d=(h==null?void 0:h.samplesBaseUrl)||"";console.log("Loading custom samples:",i),console.log("Base URL:",d),await u(i,{baseUrl:d}),console.log("Custom samples loaded successfully")}}catch(h){console.error("Error loading custom samples:",h)}}try{if(typeof globalThis.note=="function"&&typeof globalThis.sound=="function")console.log("✅ Verified core functions are available");else{const g=new Error("Core functions not available");console.warn("Core functions check failed, attempting to load..."),console.warn("⚠️ Core functions not available, attempting to load now...");try{const{coreModule:y}=await ta();window.__coreModule=y,await window.strudel.evaluate(`
              (function() {
                const core = window.__coreModule || {};
                if (core && typeof core === 'object') {
                  Object.assign(globalThis, core);
                }
                globalThis.__core_loaded = true;
              })();
            `);for(let b=0;b<20;b++){try{if(await window.strudel.evaluate("globalThis.__core_loaded === true")&&typeof globalThis.note=="function")break}catch{}await new Promise(P=>setTimeout(P,100))}}catch(y){throw console.error("❌ Failed to load core functions:",y),new Error("Core Strudel functions (note, samples, etc.) are not available in REPL context. Pattern evaluation will fail.")}}console.log("Evaluating pattern:",t);const u=this.getPatternSlot(e);console.log(`Assigning pattern to ${u} for element ${e}`);const h=this.getElementAudioNodes(e);(!h||!h.gainNode)&&console.warn(`⚠️ Could not prepare audio nodes for ${e} (pattern slot ${u})`),this.currentEvaluatingSlot=u;let d=null;const f=this.patternCache.get(e);if(f&&f.originalPattern===t&&f.processedPattern)d=f.processedPattern,console.log(`⚡ Using cached pattern for ${e} (instant trigger)`),d=this.applyElementGainPanToPattern(f.processedPattern.replace(/\.gain\([^)]*\)/g,"").replace(/\.pan\([^)]*\)/g,"").replace(/\.fast\([^)]*\)/g,"").replace(/\.slow\([^)]*\)/g,"").trim(),e,{applyGainInPattern:this.masterActive});else{if(console.log(`📝 Processing pattern for ${e} (not cached)`),d=await this.processPattern(t,e,{applyGainInPattern:this.masterActive}),!d){console.warn(`[${e}] Pattern processing failed - cannot evaluate`);try{const g=typeof globalThis.silence=="object"?`${u} = globalThis.silence`:`${u} = silence`;await window.strudel.evaluate(g);return}catch(g){console.error(`Failed to set ${u} to silence:`,g);return}}this.patternCache.set(e,{processedPattern:d,patternSlot:u,isPreEvaluated:!1,originalPattern:t})}if(!d||d.trim()===""){console.warn(`[${e}] Pattern became empty - cannot evaluate`);return}const m=`${u} = ${d}`;console.log(`🎼 ${e} → ${u}:`),console.log(`   Full Pattern: ${d}`),console.log(`   Assignment: ${m}`);try{window.strudel&&window.strudel.scheduler&&!window.strudel.scheduler.started&&(console.log(`▶️ Starting scheduler for ${e} pattern evaluation...`),await window.strudel.scheduler.start());const g=await window.strudel.evaluate(m);this.currentEvaluatingSlot=u;const y=this.soundsPreloaded?500:1e3;if(setTimeout(()=>{this.currentEvaluatingSlot===u&&(this.currentEvaluatingSlot=null)},y),g&&typeof g=="object"&&g.message&&g.message.includes("undefined instead of pattern")){console.warn("⚠️ Pattern returned undefined - setting to silence");try{const b=typeof globalThis.silence=="object"?`${u} = globalThis.silence`:`${u} = silence`;await window.strudel.evaluate(b);return}catch(b){console.error(`Failed to set ${u} to silence:`,b);return}}console.log(`✅ Pattern assignment attempted for ${u}`)}catch(g){if(g.message&&g.message.includes("undefined instead of pattern")){console.error("❌ Pattern evaluation failed: pattern returned undefined"),console.error("   This usually means:"),console.error("   - Bank samples aren't loaded (check .bank() usage)"),console.error("   - Pattern syntax is invalid"),console.error("   - Required samples/sounds aren't available"),console.error(`   Pattern: ${d.substring(0,100)}`);try{const y=typeof globalThis.silence=="object"?`${u} = globalThis.silence`:`${u} = silence`;await window.strudel.evaluate(y),console.log(`✅ Set ${u} to silence due to pattern error`)}catch(y){console.error(`Failed to set ${u} to silence:`,y)}return}if(g.message.includes("not defined")||g.message.includes("ReferenceError")){console.log(`Slot ${u} doesn't exist, creating it...`);try{const y=typeof globalThis.silence=="object"?`${u} = globalThis.silence`:`${u} = silence`;await window.strudel.evaluate(y),await window.strudel.evaluate(m),console.log(`✅ Pattern assigned to ${u} after slot creation`)}catch(y){if(console.error(`❌ Failed to assign pattern to ${u} even after creating slot:`,y),y.message&&y.message.includes("undefined instead of pattern")){console.error("   Pattern still invalid - setting to silence");try{const b=typeof globalThis.silence=="object"?`${u} = globalThis.silence`:`${u} = silence`;await window.strudel.evaluate(b)}catch(b){console.error(`Failed to set ${u} to silence:`,b)}return}throw y}}else{console.error(`❌ Failed to assign pattern to ${u}:`,g);try{const y=typeof globalThis.silence=="object"?`${u} = globalThis.silence`:`${u} = silence`;await window.strudel.evaluate(y),console.log(`✅ Set ${u} to silence as fallback`)}catch(y){console.error(`Failed to set ${u} to silence:`,y)}return}}}catch(u){if(console.error("❌ Error evaluating pattern:",u),console.error("Pattern was:",t),console.error("Error details:",u.message),u.message&&u.message.includes("undefined instead of pattern")||u.isUndefinedPattern===!0){console.warn("⚠️ Pattern evaluation returned undefined"),console.warn("   This usually means:"),console.warn("   - Bank samples aren't loaded (check .bank() usage)"),console.warn("   - Pattern syntax is invalid"),console.warn("   - Required samples/sounds aren't available"),console.warn(`   Pattern: ${t.substring(0,100)}`);const h=this.getPatternSlot(e);try{await window.strudel.evaluate(`${h} = silence`),console.log(`✅ Set ${h} to silence due to pattern error`)}catch(d){console.warn(`⚠️ Failed to set ${h} to silence:`,d.message)}return}throw(u.message.includes("note is not defined")||u.message.includes("s is not defined"))&&(console.error("❌ Core Strudel functions (note, s, etc.) are not available in REPL context"),console.error("This means Strudel REPL was not properly initialized with core functions"),console.error("Pattern cannot be evaluated without core functions - NOT using fallback")),u}console.log(`Strudel pattern started for ${e}`),this.currentEvaluatingSlot=null;const l=this.strudelPatternSlots.get(e);if(typeof e=="string"&&e.toLowerCase().includes("preview"))this.trackedPatterns.has(e)&&(this.trackedPatterns.delete(e),console.log(`🗑️ Removed preview element ${e} from master tracking`),this.updateMasterPattern(this.soloedElements,this.mutedElements));else if(!this.trackedPatterns.has(e)){const u=this.getElementGain(e)||.8,h=this.getElementPan(e)||0,d=t.replace(/[""]/g,'"').replace(/['']/g,"'");this.trackedPatterns.set(e,{pattern:d,gain:u,pan:h,muted:!1,soloed:!1}),console.log(`➕ Auto-added ${e} to master tracked patterns`),this.updateMasterPattern(this.soloedElements,this.mutedElements)}this.activeSounds.set(e,{type:"strudel",patternSlot:l,stop:()=>{window.strudel.evaluate&&l&&(console.log(`🔇 Stopping ${e} (${l}) - setting to silence`),window.strudel.evaluate(`${l} = silence`).then(()=>{console.log(`✅ ${l} silenced`)}).catch(u=>{console.error(`❌ Error stopping pattern in ${l}:`,u)}))}});return}catch(o){console.warn("Failed to load Strudel from local packages:",o)}console.warn("Using simplified pattern parsing as fallback...");const a=t.match(/s\(["']([^"']+)["']\)/);if(a){const o=a[1],l=t.match(/\.slice\((\d+)\s*,\s*"([^"]+)"\)/);if(l){const c=this.parseIndexPattern(l[2]),u=this.createPatternFromIndices(c);await this.playSynthesizedSound(e,u)}else{const c=this.createPatternFromSampleName(o);await this.playSynthesizedSound(e,c)}}else await this.playSynthesizedSound(e,t)}async loadStrudelFromCDN(){var i,s;const e=typeof globalThis.silence=="object"&&typeof globalThis.sound=="function"&&typeof globalThis.note=="function";if(this.strudelLoaded&&window.strudel&&window.strudel.evaluate&&e){console.log("Strudel already loaded, initialized, and functions exposed");return}if(e||console.log("Functions not exposed, need to reload/expose:",{silence:typeof globalThis.silence+" (should be object)",sound:typeof globalThis.sound+" (should be function)",note:typeof globalThis.note+" (should be function)"}),this.strudelLoading){for(console.log("Strudel is currently loading, waiting...");this.strudelLoading;)await new Promise(r=>setTimeout(r,100));if(this.strudelLoaded&&window.strudel){console.log("Strudel loading completed by another call");return}}this.strudelLoading=!0,console.log("Loading Strudel...");try{const{webModule:r,coreModule:a,webaudioModule:o,tonalModule:l}=await ta(),c=r;console.log("✅ Loaded Strudel from local packages");let u=null,h=null,d=!1,f=o.webaudioOutput||((i=o.default)==null?void 0:i.webaudioOutput)||(c==null?void 0:c.webaudioOutput);!f&&typeof o=="function"&&(f=o),!f&&typeof o.default=="function"&&(f=o.default);const m=c.repl||r.repl,g=c.initStrudel||r.initStrudel;if(!m&&!g)throw new Error("Strudel REPL not available");if(console.log("Available initialization methods:",{hasRepl:!!m,hasInitStrudel:!!g}),!f||typeof f!="function")throw console.error("webaudioModule structure:",Object.keys(o||{})),console.error("webaudioOutput type:",typeof f),new Error("Strudel webaudioOutput not available or not a function");console.log("✅ Core module loaded, available functions:",Object.keys(a).filter(k=>typeof a[k]=="function").slice(0,15)),console.log("webaudioOutput type:",typeof f),this.strudelOutputFactory=f,console.log("Merging modules..."),console.log("  coreModule keys:",a?Object.keys(a).length:0),console.log("  tonalModule keys:",l?Object.keys(l).length:0),console.log("  webaudioModule keys:",o?Object.keys(o).length:0),console.log("  webModule keys:",r?Object.keys(r).length:0);const y={...a||{},...l||{},...o||{},...r||{}};if(Object.keys(y).forEach(k=>{y[k]===void 0&&delete y[k]}),console.log("After merge - allModules total keys:",Object.keys(y).length),console.log("After merge - function count:",Object.keys(y).filter(k=>typeof y[k]=="function").length),typeof globalThis.silence=="object"&&typeof globalThis.sound=="function"&&typeof globalThis.note=="function"?(console.log("Strudel functions already properly exposed to globalThis, skipping..."),console.log("Verification - typeof globalThis.silence:",typeof globalThis.silence,"(Pattern object)"),console.log("Verification - typeof globalThis.sound:",typeof globalThis.sound,"(function)"),console.log("Verification - typeof globalThis.note:",typeof globalThis.note,"(function)")):(console.log("Exposing all Strudel functions to globalThis..."),console.log("allModules keys:",Object.keys(y).length),console.log("Sample functions:",Object.keys(y).filter(k=>typeof y[k]=="function").slice(0,10)),Object.assign(globalThis,y),globalThis.__strudelModulesExposed=!0,console.log("✅ Exposed",Object.keys(y).filter(k=>typeof y[k]=="function").length,"functions to globalThis"),console.log("Verification - typeof globalThis.silence:",typeof globalThis.silence,"(Pattern object)"),console.log("Verification - typeof globalThis.sound:",typeof globalThis.sound,"(function)"),console.log("Verification - typeof globalThis.note:",typeof globalThis.note,"(function)")),h=r.samples||o.samples||c.samples,h?(globalThis.samples=h,console.log("✅ Samples function exposed to globalThis")):console.warn("⚠️ No samples function found in any module"),(r.getAudioContext||o.getAudioContext)&&console.log("✅ Audio context getter available"),console.log("🎚️ Using element channel routing:",!!(this.masterPanNode&&this.masterGainNode)),!globalThis.__strudelPatternsPreInitialized){console.log("🎰 PRE-REPL: Initializing pattern slots d0-d16 on globalThis...");const k=y.silence||globalThis.silence;if(k&&typeof k=="object"){for(let w=0;w<=16;w++)globalThis[`d${w}`]=k;console.log("✅ PRE-REPL: Pattern slots initialized with silence pattern")}else{console.warn("⚠️ PRE-REPL: silence pattern not available, creating empty pattern objects");const w={_type:"pattern",query:()=>[],firstCycle:()=>[]};for(let C=0;C<=16;C++)globalThis[`d${C}`]=w}globalThis.__strudelPatternsPreInitialized=!0,console.log("✅ PRE-REPL: Pattern slots are now defined on globalThis")}if(g&&typeof g=="function"){console.log("Using initStrudel for proper initialization...");try{const k={audioContext:this.audioContext,getTime:()=>this.audioContext?this.audioContext.currentTime:0,editPattern:()=>{},setUrl:()=>{}};console.log("🎚️ initStrudel options:",Object.keys(k));const w=await g(k);u=w.repl||w,console.log("✅ initStrudel completed, replInstance:",!!u),console.log("replInstance type:",typeof u),console.log("replInstance.evaluate available:",typeof(u==null?void 0:u.evaluate)),console.log("strudelContext keys:",Object.keys(w)),console.log("🔍 Checking strudelContext for webaudio output...");const C=["strudelContext.webaudio","strudelContext.scheduler.webaudio","replInstance.webaudio","replInstance.scheduler.webaudio","strudelContext.output","replInstance.output"];w.scheduler&&(window.strudel=window.strudel||{},window.strudel.scheduler=w.scheduler,console.log("✅ Stored scheduler from strudelContext to window.strudel.scheduler"),w.scheduler.webaudio&&console.log("✅ Found webaudio in strudelContext.scheduler.webaudio")),w.webaudio&&(console.log("✅ Found webaudio in strudelContext.webaudio"),window.strudel=window.strudel||{},window.strudel.webaudio=w.webaudio),u&&u.scheduler&&(console.log("✅ Found scheduler in replInstance"),u.scheduler.webaudio&&console.log("✅ Found webaudio in replInstance.scheduler.webaudio")),(!u||typeof u.evaluate!="function")&&(console.warn("replInstance.evaluate not available, creating REPL manually..."),u=m({audioContext:this.audioContext,getTime:()=>this.audioContext.currentTime}),console.log("Created manual REPL, evaluate available:",typeof u.evaluate))}catch(k){console.warn("initStrudel failed, falling back to manual REPL:",k),u=m({audioContext:this.audioContext,getTime:()=>this.audioContext.currentTime})}}else console.log("Creating REPL manually (initStrudel not available)..."),u=m({audioContext:this.audioContext,getTime:()=>this.audioContext.currentTime});console.log("🎰 Checking if pattern slots need initialization..."),console.log("   replInstance:",!!u),console.log("   replInstance.evaluate:",typeof(u==null?void 0:u.evaluate)),console.log("   __strudelPatternsInitialized:",!!globalThis.__strudelPatternsInitialized),!globalThis.__strudelPatternsInitialized&&u&&u.evaluate?(console.log("🎰 Initializing pattern slots d0-d16..."),await(async()=>{for(let w=0;w<=16;w++)try{await u.evaluate(`d${w} = silence`),console.log(`  ✓ d${w} initialized with silence`)}catch{try{await u.evaluate(`d${w} = stack()`),console.log(`  ✓ d${w} initialized with stack()`)}catch($){console.error(`  ✗ Failed to initialize d${w}:`,$.message)}}})(),console.log("✅ Pattern slot initialization complete"),globalThis.__strudelPatternsInitialized=!0,u.scheduler&&(console.log("⏸️ Scheduler NOT auto-started - will start when user presses play/preview"),setTimeout(()=>{const w=u.scheduler;if(w.webaudio||w._webaudio){const C=w.webaudio||w._webaudio;if(C.output||C.outputNode){const $=C.output||C.outputNode;try{$.disconnect(),$.connect(this.masterPanNode),console.log("✅ Connected webaudio output to master")}catch(A){console.warn("⚠️ Could not connect webaudio output:",A)}}}},500))):globalThis.__strudelPatternsInitialized?console.log("✅ Pattern slots already initialized"):console.warn("⚠️ Cannot initialize pattern slots - replInstance not available"),console.log("✅ REPL initialized - functions available via globalThis");try{let k=null;try{k=await Jt(()=>import("./strudel-web-D2TLs97f.js").then(C=>C.i),__vite__mapDeps([0,1])),console.log("✅ Draw module imported from local packages")}catch{k=await Jt(()=>import("https://unpkg.com/@strudel/draw@1.2.4/dist/index.mjs"),[]),console.log("✅ Draw module imported from CDN")}const w=((s=a==null?void 0:a.Pattern)==null?void 0:s.prototype)||(typeof Pattern<"u"?Pattern.prototype:null)||(globalThis.Pattern?globalThis.Pattern.prototype:null);if(w&&(!w._spectrum&&w.spectrum&&(w._spectrum=w.spectrum),!w._pianoroll&&w.pianoroll&&(w._pianoroll=w.pianoroll)),k&&u&&u.evaluate){const C="https://unpkg.com/@strudel/draw@1.2.4/dist/index.mjs";try{await u.evaluate(`
              (async function() {
                // Import the draw module - this automatically adds methods to Pattern.prototype
                const draw = await import('${C}')
                // Export getDrawContext for use in visualizers
                if (draw.getDrawContext) {
                  globalThis.getDrawContext = draw.getDrawContext
                }
                if (typeof Pattern !== 'undefined') {
                  if (!Pattern.prototype._spectrum && Pattern.prototype.spectrum) {
                    Pattern.prototype._spectrum = Pattern.prototype.spectrum;
                  }
                  if (!Pattern.prototype._pianoroll && Pattern.prototype.pianoroll) {
                    Pattern.prototype._pianoroll = Pattern.prototype.pianoroll;
                  }
                }
              })()
            `),await new Promise($=>setTimeout($,300))}catch($){console.warn("⚠️ Could not load @strudel/draw in REPL context:",$)}}}catch(k){console.warn("⚠️ Could not load @strudel/draw functions:",k)}if(this.strudelRepl=u,this.audioContext&&(r.getAudioContext||o.getAudioContext)&&typeof(r.getAudioContext||o.getAudioContext)=="function")try{r.getAudioContext&&Object.defineProperty(r,"getAudioContext",{value:()=>(console.log("🎚️ Strudel getAudioContext() called - returning our shared context"),this.audioContext),writable:!0,configurable:!0}),o.getAudioContext&&Object.defineProperty(o,"getAudioContext",{value:()=>(console.log("🎚️ Strudel webaudio getAudioContext() called - returning our shared context"),this.audioContext),writable:!0,configurable:!0}),console.log("✅ Patched Strudel getAudioContext() to return our shared context")}catch(w){w.message.includes("Cannot redefine property")||console.warn("⚠️ Could not patch getAudioContext (module may be read-only):",w.message)}if(u&&u.scheduler){const k=u.scheduler;k.audioContext&&k.audioContext!==this.audioContext&&(console.log("🎚️ Replacing scheduler audioContext with our shared context"),k.audioContext=this.audioContext),k.superdough&&k.superdough.audioContext&&k.superdough.audioContext!==this.audioContext&&(console.log("🎚️ Replacing superdough audioContext with our shared context"),k.superdough.audioContext=this.audioContext)}if(this.exposeSampleListHelper(o,r),u&&u.scheduler&&this.masterPanNode&&this.masterGainNode)try{const k=u.scheduler;if(console.log("🔍 Checking for scheduler output..."),console.log("  scheduler.output:",!!k.output),console.log("  scheduler keys:",Object.keys(k).slice(0,15)),k.output){console.log("  scheduler.output type:",k.output.constructor.name);try{k.output.disconnect(),k.output.connect(this.masterPanNode),console.log("✅ Connected scheduler.output to masterPanNode")}catch(w){console.warn("⚠️ Could not connect scheduler.output:",w)}}if(k.superdough||k.output||k.audioOutput){const w=k.superdough||k.audioOutput||k.output;if(console.log("  Found superdough/audioOutput:",w?w.constructor.name:"null"),w&&typeof w.connect=="function")try{w.disconnect(),w.connect(this.masterPanNode),console.log("✅ Connected superdough/audioOutput to masterPanNode")}catch(C){console.warn("⚠️ Could not connect superdough/audioOutput:",C)}}if(k.audioContext){const w=k.audioContext.destination;try{Object.defineProperty(k.audioContext,"destination",{get:()=>this.masterPanNode||w,configurable:!0}),console.log("🎚️ Patched scheduler audioContext.destination")}catch(C){console.warn("⚠️ Could not patch scheduler audioContext:",C)}}}catch(k){console.warn("⚠️ Could not intercept scheduler output:",k)}u&&u.scheduler&&console.log("⏸️ REPL scheduler found (will be started after pattern slots are initialized)...");const P=async k=>{try{const w=await u.evaluate(k);return w===void 0&&k.includes("=")&&!k.trim().startsWith("//")&&(/^d\d+\s*=\s*/.test(k.trim())||/\w+\s*=\s*s\(|sound\(|note\(/.test(k))&&(console.warn(`⚠️ Pattern assignment returned undefined: ${k.substring(0,80)}`),console.warn("   This usually means the pattern is invalid or samples aren't loaded")),(w!==void 0||!k.includes("="))&&console.log(`Eval result for "${k.substring(0,50)}...":`,typeof w,w),w}catch(w){if(w.message&&w.message.includes("undefined instead of pattern")){const C=new Error("Pattern evaluation failed: got undefined instead of pattern");throw C.originalError=w,C.code=k,C.isUndefinedPattern=!0,console.warn("⚠️ Pattern evaluation error: got undefined instead of pattern"),console.warn(`   Code: ${k.substring(0,100)}`),console.warn("   This usually means:"),console.warn("   - Bank samples aren't loaded (check .bank() usage)"),console.warn("   - Pattern syntax is invalid"),console.warn("   - Required samples/sounds aren't available"),C}throw console.error("Evaluation error:",w),w}};h||(h=r.samples||c.samples||u&&u.samples),window.strudel={initialized:!0,evaluate:P,samples:h||(()=>{}),repl:u,scheduler:u==null?void 0:u.scheduler},this.strudelLoaded=!0,this.strudelLoading=!1,console.log("Checking Strudel functions availability..."),console.log("  typeof silence:",typeof globalThis.silence),console.log("  typeof sound:",typeof globalThis.sound),console.log("  typeof note:",typeof globalThis.note),console.log("✅ REPL ready (functions available via globalThis)"),this.currentTempo=120;try{await window.strudel.evaluate("cps = 1"),console.log("✅ Initial tempo set to 120 BPM (base cps=1, using .fast()/.slow() on patterns)")}catch(k){console.warn("⚠️ Could not set initial cps:",k)}return}catch(r){console.error("Failed to load Strudel module:",r),this.strudelLoading=!1}const t=["https://unpkg.com/@strudel/web@1.2.5/dist/index.mjs","https://cdn.jsdelivr.net/npm/@strudel/web@1.2.5/dist/index.mjs","https://esm.sh/@strudel/web@1.2.5"];for(const r of t)try{console.log(`Trying to load Strudel from: ${r}`);const a=await import(r),o=a.repl,l=a.samples;if(!o){console.warn("Strudel module missing repl. Available exports:",Object.keys(a));continue}const c=a.initStrudel;c&&c({audioContext:this.audioContext,output:this.audioContext});let u=null;try{try{u=await Jt(()=>import("./strudel-core-DKU3hnf1.js").then(d=>d.b),[]),console.log("✅ Core module imported from local packages")}catch{u=await Jt(()=>import("https://unpkg.com/@strudel/core@1.2.5/dist/index.mjs"),[]),console.log("✅ Core module imported from CDN")}console.log("Available exports:",Object.keys(u).slice(0,10))}catch(d){console.warn("Could not import core module:",d)}const h=o({getTime:()=>this.audioContext.currentTime,scope:u?{...u}:void 0});if(u)try{await h.evaluate(`
              (async function() {
                const core = await import('https://unpkg.com/@strudel/core@1.2.5/dist/index.mjs')
                Object.assign(globalThis, core)
              })()
            `),await new Promise(f=>setTimeout(f,300)),console.log("✅ Core functions also loaded via evaluation")}catch(d){console.warn("Could not load core functions via evaluation:",d)}try{let d=null;try{d=await Jt(()=>import("./strudel-web-D2TLs97f.js").then(f=>f.i),__vite__mapDeps([0,1])),console.log("✅ Draw module imported from local packages")}catch{d=await Jt(()=>import("https://unpkg.com/@strudel/draw@1.2.4/dist/index.mjs"),[]),console.log("✅ Draw module imported from CDN")}if(d){const f="https://unpkg.com/@strudel/draw@1.2.4/dist/index.mjs";await h.evaluate(`
              (async function() {
                // Import the draw module - this automatically adds methods to Pattern.prototype
                await import('${f}')
                // Also export getDrawContext for use in visualizers
                const draw = await import('${f}')
                if (draw.getDrawContext) {
                  const originalGetDrawContext = draw.getDrawContext;
                  // Patch getDrawContext to use our canvas when available
                  globalThis.getDrawContext = function(id, options) {
                    // If no ID or default ID, try to use our canvas context
                    if ((!id || id === 'test-canvas') && window.__strudelVisualizerCtx) {
                      return window.__strudelVisualizerCtx;
                    }
                    // Otherwise use original function
                    return originalGetDrawContext(id, options);
                  };
                }
              })()
            `),await new Promise(m=>setTimeout(m,300))}}catch(d){console.warn("⚠️ Could not load @strudel/draw functions:",d)}window.strudel={initialized:!0,evaluate:h.evaluate,samples:l},this.strudelLoaded=!0,this.strudelLoading=!1,console.log("Strudel loaded from CDN successfully");return}catch(a){console.warn(`Failed to load from ${r}:`,a.message);continue}throw this.strudelLoading=!1,new Error("Failed to load Strudel from all CDN sources")}async triggerSound(e){let t=null;try{const o=localStorage.getItem(`element-config-${e}`);o&&(t=JSON.parse(o))}catch(o){console.error(`Error loading custom config for ${e}:`,o)}const i=Lt.getElementConfig(e);if(!i&&!t){console.warn(`No config found for element: ${e}`);return}const s=t&&typeof t.sampleUrl=="string"&&t.sampleUrl.trim()!==""?t.sampleUrl.trim():i&&i.audioFile&&typeof i.audioFile=="string"&&i.audioFile.trim()!==""?i.audioFile.trim():null;if(s){try{await this.initialize()||console.warn("⚠️ Audio engine not fully initialized; attempting custom sample playback anyway.")}catch(o){console.warn("⚠️ Unable to initialize audio engine for custom sample playback:",o)}this.stopSound(e),console.log(`🔊 Playing custom sample for ${e}`),this.playAudioFile(e,s);return}let r=(t==null?void 0:t.pattern)!==void 0?t.pattern:i==null?void 0:i.pattern;const a=(i==null?void 0:i.type)||"strudel";if(!r||typeof r=="string"&&r.trim()===""){console.log(`[${e}] No pattern assigned - skipping sound trigger`);return}if(this.appInstance&&a==="strudel"){const o=this.appInstance.getPatternWithEffects(e,r);o!==r&&(console.log(`   Applying effects to ${e} for individual playback`),r=o)}console.log(`Triggering sound for ${e} (type: ${a})`),t!=null&&t.sampleUrl&&await this.loadCustomSample(e,t.sampleUrl),a==="synthesized"?await this.playSynthesizedSound(e,r):a==="strudel"?await this.playStrudelPattern(e,r,i==null?void 0:i.samples):a==="audio"&&this.playAudioFile(e,(i==null?void 0:i.audioFile)||(t==null?void 0:t.sampleUrl))}async loadCustomSample(e,t){console.log(`Loading custom sample for ${e} from ${t.substring(0,50)}...`)}pauseSound(e){if(this.masterOnlyPlayback){this.removeElementFromMaster(e).success&&this.masterActive&&this.playMasterPattern().catch(s=>console.warn("⚠️ Failed to refresh master after pause:",s)),this.activeSounds.delete(e);return}const t=this.strudelPatternSlots.get(e);if(t&&window.strudel&&window.strudel.evaluate)try{const i=typeof globalThis.silence=="object"?`${t} = globalThis.silence`:`${t} = silence`;window.strudel.evaluate(i),console.log(`⏸️ Paused ${e} (set ${t} to silence)`)}catch(i){console.error(`Error pausing sound for ${e}:`,i)}this.activeSounds.delete(e)}stopSound(e){if(this.masterOnlyPlayback){this.removeElementFromMaster(e).success&&this.masterActive&&this.playMasterPattern().catch(r=>console.warn("⚠️ Failed to refresh master after stop:",r)),this.activeSounds.delete(e);return}const t=this.activeSounds.get(e),i=typeof e=="string"&&e.toLowerCase().includes("preview");if(window.strudel&&window.strudel.evaluate)try{const s=this.getPatternSlot(e),r=typeof globalThis.silence=="object"?`${s} = globalThis.silence`:`${s} = silence`;window.strudel.evaluate(r).catch(a=>{console.log(`Cleared pattern slot ${s} for ${e}`)})}catch{}if(t){if(t.type==="synthesized"&&t.oscillator)t.oscillator.stop&&t.oscillator.stop();else if(t.type==="strudel"&&t.stop)t.stop(),this.activeSounds.delete(e);else if(t.type==="audio"&&t.source){const s=t.gain,r=this.audioContext.currentTime;s.gain.cancelScheduledValues(r),s.gain.setValueAtTime(s.gain.value,r),s.gain.linearRampToValueAtTime(0,r+Lt.defaults.fadeOutTime),setTimeout(()=>{t.source.stop(),this.activeSounds.delete(e)},Lt.defaults.fadeOutTime*1e3+50);return}else if(t.type==="sustaining"){this.stopSustainingTone(e);return}this.activeSounds.delete(e)}if(i){const s=this.strudelPatternSlots.get(e);s&&(this.patternSlotToElementId.delete(s),this.strudelPatternSlots.delete(e),console.log(`🧹 Cleared preview slot mapping (${s}) for ${e}`)),this.disposeElementAudioNodes(e),console.log(`🧹 Disposed preview audio nodes for ${e}`)}}async stopAllSounds(){var s;if(this._stoppingAllSounds)return;this._stoppingAllSounds=!0,console.log("🛑🛑🛑 EMERGENCY STOP - Killing all audio 🛑🛑🛑");const e=((s=this.audioContext)==null?void 0:s.currentTime)||0;this.masterGainNode?(this.masterGainNode.gain.setValueAtTime(0,e),console.log("✓ Master gain set to 0 (immediate)"),setTimeout(()=>{var r;this.masterGainNode&&!this.masterMuted&&(this.masterGainNode.gain.setValueAtTime(this.masterVolume,((r=this.audioContext)==null?void 0:r.currentTime)||0),console.log(`✓ Master gain restored to ${(this.masterVolume*100).toFixed(0)}%`))},100)):this.gainNode&&(this.gainNode.gain.setValueAtTime(0,e),console.log("✓ Gain set to 0 (immediate)"),setTimeout(()=>{var r;this.gainNode&&(this.gainNode.gain.setValueAtTime(this.volume,((r=this.audioContext)==null?void 0:r.currentTime)||0),console.log(`✓ Gain restored to ${(this.volume*100).toFixed(0)}%`))},100));let t=!1;if(window.strudel&&window.strudel.repl&&window.strudel.repl.scheduler)try{const r=window.strudel.repl.scheduler;typeof r.stop=="function"&&(r.stop(),t=!0,console.log("✓ Stopped REPL scheduler (immediate)"))}catch{}if(window.strudel&&window.strudel.evaluate){console.log("🔇 Silencing all Strudel pattern slots (d1-d16)...");const r=[];for(let a=0;a<=16;a++){const o=`d${a}`;try{r.push(window.strudel.evaluate(`${o} = silence`).catch(()=>{}))}catch{}}try{await Promise.all(r),console.log("✅ All pattern slots silenced")}catch{}}const i=Array.from(this.activeSounds.keys());console.log(`🔇 Stopping ${i.length} tracked sounds`);for(const r of i)try{this.stopSound(r),console.log(`✓ Stopped ${r}`)}catch{console.log(`Could not stop ${r}`)}this.activeSounds.clear(),this.oscillators.forEach((r,a)=>{try{r.stop&&r.stop(),r.disconnect&&r.disconnect(),console.log(`✓ Disconnected oscillator ${a}`)}catch{}}),this.oscillators.clear(),this.masterActive=!1,this.currentEvaluatingSlot=null,this.masterPattern="",this.trackedPatterns&&this.trackedPatterns.clear&&this.trackedPatterns.clear(),console.log("✅✅✅ EMERGENCY STOP COMPLETE ✅✅✅ (audio context left running, master muted)"),this._stoppingAllSounds=!1}async setTempo(e){this.currentTempo=e,this.masterPlaybackTempo=e;const t=Number.isFinite(e)&&e>0?e/120:1;if(this.masterActive&&this.masterPlaybackStartTime!=null){const i=this.audioContext,s=i?i.currentTime:performance.now()/1e3,r=this.masterPlaybackSpeed||1,a=Math.max(0,s-this.masterPlaybackStartTime),o=r>0?a*r%1:0;this.masterPlaybackSpeed=t>0?t:1,this.masterPlaybackStartTime=s-o/this.masterPlaybackSpeed}else this.masterPlaybackSpeed=t>0?t:1;if(!window.strudel||!window.strudel.evaluate){console.warn("⚠️ Strudel not loaded yet - cannot set tempo");return}console.log(`🎚️ Tempo set to ${e} BPM (using .cpm() on patterns)`),await this.updateAllPatternsWithNewTempo(),this.trackedPatterns.size>0&&(console.log("🔄 Updating master with new tempo"),this.updateMasterPattern())}async ensureStrudelWorkletsReady(e,t=!1){try{if(!window.strudel||!window.strudel.repl||!window.strudel.repl.scheduler)return;const s=window.strudel.repl.scheduler.superdough;if(!s||!(t||typeof e=="string"&&/\b(supersaw|pulse)\b/i.test(e))||this._workletsLoaded)return;typeof s.loadWorklets=="function"&&(console.log("⏳ Loading Strudel AudioWorklets..."),await s.loadWorklets(),this._workletsLoaded=!0,console.log("✅ Strudel AudioWorklets loaded"))}catch(i){console.warn("⚠️ Could not load Strudel AudioWorklets:",(i==null?void 0:i.message)||i)}}setKey(e){this.currentKey=e||"",this._cachedScaleContext=null,this._cachedScaleKey="",this.currentKey?console.log(`🎹 Key set to ${e}`):console.log("🎹 Key cleared (no key selected)"),this.updateAllPatternsWithNewScale()}updateAllPatternsWithNewScale(){this.trackedPatterns.size>0&&(console.log("🔄 Updating master with new key/scale"),this.updateMasterPattern());for(const[e,t]of this.trackedPatterns.entries()){if(!t)continue;const i=t.pattern||t.rawPattern;if(!i)continue;const s=this.convertPatternForScale(i);t.pattern=s||i}for(const[e,t]of this.activeSounds.entries()){if(t.type!=="strudel")continue;const i=this.loadElementConfig?this.loadElementConfig(e):null,s=(i==null?void 0:i.pattern)||t.originalPattern||"";if(!s)continue;const a=this.convertPatternForScale(s)||s;this.updatePatternInPlace(e,a).catch(()=>{})}}setScale(e){this.currentScale=(e||"").trim()||"chromatic",this._cachedScaleContext=null,this._cachedScaleKey="",this.currentScale?console.log(`🎼 Scale set to ${this.currentScale}`):console.log("🎼 Scale cleared (no scale selected)"),this.updateAllPatternsWithNewScale()}setTimeSignature(e){this.currentTimeSignature=e,console.log(`🎵 Time signature set to ${e}`);const[t,i]=e.split("/").map(Number);this.currentBeats=t,this.currentNoteValue=i,console.log(`   ${t} beats per measure, ${i} note gets the beat`),this.trackedPatterns.size>0&&(console.log("🔄 Updating master with new time signature"),this.updateMasterPattern())}extractChannelNumber(e,t=0){if(!e||typeof e!="string")return t+1;const i=e.match(/(\d+)$/);if(i&&i[1]){const s=parseInt(i[1],10);if(Number.isFinite(s)&&s>0)return s}return t+1}formatNumberForPattern(e,t=6){return!Number.isFinite(e)||e===0?"0":e.toFixed(t).replace(/(\.\d*?[1-9])0+$/,"$1").replace(/\.0+$/,"").replace(/^-0$/,"0")}getScaleConversionContext(){return null}convertPatternForScale(e){if(!e||typeof e!="string")return e;const t=this.patternHasNoteNames(e),i=this.patternHasNumericNotePattern(e);return t&&!i?(console.log("📝 convertPatternForScale: Pattern uses note names, preserving format"),e):Ff(e)}convertNoteNamesToSemitones(e){return!e||typeof e!="string"?e:Ff(e)}convertNoteNamesToScaleDegrees(e,t,i){if(!e||typeof e!="string")return e;const s=t&&t.trim()||"C",r=i&&i.trim()||"chromatic",a=this.getScaleSemitoneSteps(s,r);if(!a||!a.length)return e;const l=`${s.replace(/\s+/g,"").toUpperCase()}`.match(/^([A-G])([#B]?)/i);if(!l)return e;const c=`${l[1].toUpperCase()}${l[2]||""}`,u=Bc.get(`${c}4`),h=Number.isFinite(u.midi)?u.midi:60,d=g=>{const y=/(\s+|[,;:<>()[\]{}|\\/]+|\*+)/g,b=[];let P=0,k;for(;(k=y.exec(g))!==null;)k.index>P&&b.push({type:"note",value:g.substring(P,k.index)}),b.push({type:"separator",value:k[0]}),P=k.index+k[0].length;P<g.length&&b.push({type:"note",value:g.substring(P)});let w=!1;for(let C=0;C<b.length;C++){const $=b[C];if($.type==="separator")continue;const A=$.value.trim();if(!A)continue;const Q=A.match(/^([a-gA-G])([#b]?)(-?\d+)?(@[\d.]+)?$/);if(!Q)continue;const q=Q[1].toUpperCase(),W=Q[2]||"",U=Q[3]?parseInt(Q[3],10):null,Z=Q[4]||"",Y=[];U!==null&&!Number.isNaN(U)&&Y.push(U);const ne=u.oct||4;Y.push(ne,ne-1,ne+1,3,4,5);let re=null;for(const yt of Y){const ue=Bc.get(`${q}${W}${yt}`);if(ue&&Number.isFinite(ue.midi)){re=ue.midi;break}}if(re===null)return null;const ve=re-h,Ce=(ve%12+12)%12,De=a.indexOf(Ce);if(De===-1)return null;const Pt=Math.floor((ve-a[De])/12)*a.length+De;b[C]={type:"note",value:`${Pt}${Z}`},w=!0}return w?b.map(C=>C.value).join(""):null},f=/\bnote\s*\(\s*(["'])([\s\S]*?)\1\s*\)/gi;return e.replace(f,(g,y,b)=>{const P=d(b);return P===null?g:`n(${y}${P}${y})`})}getScaleSemitoneSteps(e,t){const i=e&&typeof e=="string"?e.trim():"",s=t&&typeof t=="string"?t.trim():"",r=bu[s]||s||"chromatic";let a="C";if(i){const u=i.match(/^([a-gA-G])([#b]?)/);u?a=`${u[1].toUpperCase()}${u[2]||""}`:a=i}const o=Lo.get(`${a} ${r}`);if(!o||!Array.isArray(o.intervals)||o.intervals.length===0)return null;const l=o.intervals.map(u=>{const h=aw.semitones(u);return Number.isFinite(h)?h:null}).filter(u=>u!==null);if(!l.length)return null;const c=Array.from(new Set(l)).sort((u,h)=>u-h);return c[0]!==0&&c.unshift(0),c}patternHasNoteNames(e){if(!e||typeof e!="string")return!1;const t=/\b(note|n)\s*\(\s*["']([^"']+)["']/gi;let i;for(;(i=t.exec(e))!==null;){const s=i[2];if(/[a-gA-G][#b]?\d/.test(s)||/[a-gA-G][#b]?\s/.test(s))return!0}return!1}patternHasNumericNotePattern(e){if(!e||typeof e!="string")return!1;const t=/\b(note|n)\s*\(\s*["']([^"']+)["']/gi;let i,s=!1;for(;(i=t.exec(e))!==null;){s=!0;let r=i[2].replace(/[<>\[\]\{\}\|,]/g," ").trim();if(r&&(/[a-gA-G]/.test(r)||!/^[\d\s~\-\/]+$/.test(r)))return!1}return s}_ensureMasterPatternSanitized(){if(!this.masterPattern||typeof this.masterPattern!="string")return"";const e=this._sanitizePatternExpression(this.masterPattern);return e!==this.masterPattern&&(console.log("🧼 Sanitized master pattern before evaluation"),this.masterPattern=e),this.masterPattern}_repairBrokenSampleStrings(e){if(!e||typeof e!="string")return e;const t=/samples\s*\(\s*\{([\s\S]*?)\}\s*,\s*\{([\s\S]*?)\}\s*\)/g;return e.replace(t,(i,s,r)=>{var f,m;const a=/"([^"]+)"\s*:\s*"([\s\S]*?)"/g,o=[];let l;for(;(l=a.exec(s))!==null;){const g=(f=l[1])==null?void 0:f.trim(),y=(m=l[2])==null?void 0:m.replace(/[\r\n]+/g,"").trim();!g||!y||o.push([g,y])}if(!o.length)return i;const c=r.match(/baseUrl\s*:\s*"([\s\S]*?)"/),u=c?c[1].replace(/[\r\n]+/g,"").trim():"./";return`samples({
${o.map(([g,y])=>`  "${g}": "${y}"`).join(`,
`)}
}, { baseUrl: "${u||"./"}" })`})}_findMatchingParenIndex(e,t){let i=0,s=!1,r=!1,a=!1,o=!1,l=!1,c=!1;for(let u=t;u<e.length;u+=1){const h=e[u],d=e[u+1];if(c){c=!1;continue}if(l){h===`
`&&(l=!1);continue}if(o){h==="*"&&d==="/"&&(o=!1,u+=1);continue}if(h==="\\"){c=!0;continue}if(s){h==="'"&&(s=!1);continue}if(r){h==='"'&&(r=!1);continue}if(a){h==="`"&&(a=!1);continue}if(h==="'"&&!r&&!a){s=!0;continue}if(h==='"'&&!s&&!a){r=!0;continue}if(h==="`"&&!s&&!r){a=!0;continue}if(h==="/"&&d==="*"){o=!0,u+=1;continue}if(h==="/"&&d==="/"){l=!0,u+=1;continue}if(h==="("){i+=1;continue}if(h===")"){if(i-=1,i===0)return u;if(i<0)return-1}}return-1}_repairLeadingSampleStatements(e){if(!e||typeof e!="string")return e;const t=e.trimStart();if(t.startsWith("(() =>")||t.startsWith("(()=>"))return e;const i=e.slice(0,e.length-t.length),s=t.match(/^(?:\/\*[\s\S]*?\*\/\s*|\/\/[^\n]*\n\s*)+/),r=s?s[0]:"";let a=t.slice(r.length).trimStart();if(!a.startsWith("samples"))return e;const o=[];let l=0;for(;a.startsWith("samples",l);){const f=l,m=a.indexOf("(",f);if(m===-1)break;const g=this._findMatchingParenIndex(a,m);if(g===-1)break;const y=a.slice(f,g+1).trim();for(o.push(y),l=g+1;l<a.length&&/\s/.test(a[l]);)l+=1}if(!o.length)return e;const c=a.slice(l).trim();if(!c)return e;const u=o.map(f=>`  ${f};`).join(`
`),h=c.split(`
`).map(f=>`    ${f}`).join(`
`),d=`(() => {
${u}
  return (
${h}
  );
})()`;return`${i}${r}${d}`}_repairStringPatternOperators(e){if(!e||typeof e!="string")return e;let t="",i=0;const s=e.length,r=a=>a?/[,\(\{\[=:+\-*\/!&|?;%]/.test(a):!0;for(;i<s;){const a=e[i];if(a==='"'||a==="'"){const o=a;let l=i+1,c=!1;for(;l<s;){const y=e[l];if(!c&&y===o)break;!c&&y==="\\"?c=!0:c=!1,l+=1}if(l>=s){t+=e.slice(i);break}const u=e.slice(i,l+1);let h=i-1;for(;h>=0&&/\s/.test(e[h]);)h-=1;const d=h>=0?e[h]:"";let f=l+1;for(;f<s&&/\s/.test(e[f]);)f+=1;const m=e.startsWith(".div",f),g=r(d);m&&g?t+=`pattern(${u})`:t+=u,i=l+1;continue}t+=a,i+=1}return t}_sanitizePatternExpression(e){if(!e||typeof e!="string")return e;let t=this._repairBrokenSampleStrings(e);return t=this._repairLeadingSampleStatements(t),t=this._repairStringPatternOperators(t),t}applyMasterMixModifiers(e,t={}){if(!e||typeof e!="string"||e.trim()==="")return e;const{wrapStack:i=!1}=t;let s=e;if(i){const k=s.match(/stack\s*\(/);if(k){let w=k.index+k[0].length-1,C=1,$=w+1,A=!1,Q=null;for(;$<s.length&&C>0;){const q=s[$];!A&&(q==='"'||q==="'")?(A=!0,Q=q):A&&q===Q&&s[$-1]!=="\\"&&(A=!1,Q=null),A||(q==="("?C++:q===")"&&C--),C>0&&$++}C===0&&(s=s.substring(0,$+1).trimEnd())}}else s=s.replace(/\.gain\s*\([^)]*\)/g,""),s=s.replace(/\.pan\s*\([^)]*\)/g,""),s=s.replace(/\.cpm\s*\([^)]*\)/g,""),s=s.replace(/\.\.+/g,".").replace(/\.\s*$/,"").trim();s=s.replace(/\.\.+/g,".").replace(/\.\s*$/,"").trim();let r=e;if(i){const k=e.match(/stack\s*\(/);if(k){let w=k.index+k[0].length-1,C=1,$=w+1,A=!1,Q=null;for(;$<e.length&&C>0;){const q=e[$];!A&&(q==='"'||q==="'")?(A=!0,Q=q):A&&q===Q&&e[$-1]!=="\\"&&(A=!1,Q=null),A||(q==="("?C++:q===")"&&C--),C>0&&$++}C===0&&(r=e.substring($+1))}}const a=[...r.matchAll(/\.gain\s*\(\s*([^)]+)\s*\)/g)];if(a.length>0){const k=a[a.length-1],w=parseFloat(k[1]);Number.isFinite(w)&&(this.masterVolume=w)}const o=[...r.matchAll(/\.pan\s*\(\s*([^)]+)\s*\)/g)];if(o.length>0){const k=o[o.length-1],w=parseFloat(k[1]);Number.isFinite(w)&&(this.masterPan=w)}const l=[];Number.isFinite(this.masterVolume)&&Math.abs(this.masterVolume-1)>1e-6&&l.push(`.gain(${this.formatNumberForPattern(this.masterVolume,4)})`),Number.isFinite(this.masterPan)&&Math.abs(this.masterPan)>1e-6&&l.push(`.pan(${this.formatNumberForPattern(this.masterPan,4)})`);const c=Number.isFinite(this.currentTempo)&&this.currentTempo>0?this.currentTempo:120;if(Math.abs(c-120)>1e-6){const k=c/4;l.push(`.cpm(${this.formatNumberForPattern(k,6)})`)}if(!l.length)return s;e=s;const u=l,h=e.match(/^(\s*\/\/[^\n]*\n)+/);let d="",f=e;h&&(d=h[0],f=e.slice(d.length));const m=f.match(/\s*$/),g=m?m[0]:"",y=f.trim();if(!y)return e;if(i){const k=y.match(/stack\s*\(/);if(k){let C=k.index+k[0].length-1,$=1,A=C+1,Q=!1,q=null;for(;A<y.length&&$>0;){const W=y[A];!Q&&(W==='"'||W==="'")?(Q=!0,q=W):Q&&W===q&&y[A-1]!=="\\"&&(Q=!1,q=null),Q||(W==="("?$++:W===")"&&$--),$>0&&A++}if($===0){const W=y.slice(0,A+1);let Z=y.slice(A+1).trim(),Y=Z.length,ne=0;for(;ne<10&&(Z=Z.replace(/\.(gain|pan|cpm)\s*\([^)]*\)/g,""),Z=Z.replace(/\.\s*\(\s*(gain|pan|cpm)\s*\([^)]*\)\s*\)/g,""),Z=Z.replace(/\s*\(\s*(gain|pan|cpm)\s*\([^)]*\)\s*\)/g,""),Z=Z.replace(/\s*(gain|pan|cpm)\s*\([^)]*\)/g,""),Z=Z.replace(/\.\.+/g,".").replace(/\.\s*$/,"").replace(/^\s*\./,"").trim(),Z.length!==Y);)Y=Z.length,ne++;(Z.match(/(gain|pan|cpm)\s*\(/)||Z.match(/[().]/))&&(Z="");const re=W+(u.length>0?u.join(""):"");return`${d}${re}${g}`}}const w=y.lastIndexOf(")");if(w!==-1){const C=y.slice(0,w+1);let A=y.slice(w+1).trim(),Q=A.length,q=0;for(;q<10&&(A=A.replace(/\.(gain|pan|cpm)\s*\([^)]*\)/g,""),A=A.replace(/\.\s*\(\s*(gain|pan|cpm)\s*\([^)]*\)\s*\)/g,""),A=A.replace(/\s*\(\s*(gain|pan|cpm)\s*\([^)]*\)\s*\)/g,""),A=A.replace(/\s*(gain|pan|cpm)\s*\([^)]*\)/g,""),A=A.replace(/\.\.+/g,".").replace(/\.\s*$/,"").replace(/^\s*\./,"").trim(),A.length!==Q);)Q=A.length,q++;(A.match(/(gain|pan|cpm)\s*\(/)||A.match(/[().]/))&&(A="");const W=C+(u.length>0?u.join(""):"");return`${d}${W}${g}`}}const b=y.startsWith("(")&&y.endsWith(")"),P=u.length>0?b?`${y}${u.join("")}`:`(${y})${u.join("")}`:y;return`${d}${P}${g}`}applyGlobalSettingsToPattern(e,t=!1,i=!1,s=null,r=null){if(!e||e==="silence")return e;let a=e,o=t;const l=/\b(note|n)\s*\(/.test(a),c=this.patternHasNoteNames(a),u=/\b(note|n)\s*\(\s*["'][a-g][#b]?[a-z0-9]*\s*[a-z]/.test(a)||/\b(note|n)\s*\(\s*["'][^"']*\b(maj|min|m|dim|aug|sus|add|7|9|11|13)\b/i.test(a),h=/\.\s*chord\s*\(/i.test(a),d=/\b(note|n)\s*\(\s*["'][^"']*[a-g][#b]?\s/.test(a),f=c||u||d||h,m=this.patternHasNumericNotePattern(a),g=l&&!f&&!h&&m,y=s!==null?s:this.currentKey&&this.currentKey.trim()!==""?this.currentKey.trim():"",b=r!==null?r:this.currentScale&&this.currentScale.trim()!==""?this.currentScale.trim():"",P=y&&y.trim()!=="",k=b&&b.trim()!==""?b.trim():"";let w="",C="";if(P){const $=y.toLowerCase();$.includes("m")&&!$.includes("major")?(w=$.replace("m","").trim(),C="minor"):(w=$.replace("major","").trim(),C="major"),w||(w=$.trim())}if(g){let $="";if(P){const Q=k||C||"major",q=bu[Q]||Q,W=w||y.trim().toLowerCase();$=W?`${W}:${q}`:q}else k&&($=bu[k]||k);const A=/\.\s*scale\s*\(/i.test(a);if(A&&(a=a.replace(/\.\s*scale\s*\((['"])(?:(?=(\\?))\2.)*?\1\)/gi,""),a=a.replace(/\.\s*scale\s*\([^)]*\)/gi,""),a=a.replace(/\.+/g,".").replace(/\.\s*\./g,".").trim(),a=a.replace(/\.+$/,"").trim(),console.log("  🔄 Removed existing scale modifier")),$&&!h){const Q=`.scale('${$}')`,q=a.search(/\.(s|sound)\s*\(/);if(q!==-1){const W=a.slice(0,q),U=a.slice(q);a=`${W}${Q}${U}`}else o?a=`${a}${Q}`:(a=`(${a})${Q}`,o=!0);console.log(`  🎼 Applied scale: ${$}`)}else(P||k)&&console.log(h?"  ⏭️  Skipped scale application (pattern uses .chord() modifier)":A?"  ⏭️  Skipped scale application (pattern already has scale)":"  ⏭️  Skipped scale application (pattern not compatible with key/scale settings)")}else if(f&&(P||k)){let $="note name";h?$="chord modifier (.chord())":u&&($="chord"),console.log(`  ⏭️  Skipped scale for ${$} pattern (use numeric n() for scale/key changes)`)}else!l&&(P||k)&&console.log(`  ⏭️  Skipped scale for non-note pattern (Key: ${y||"none"}, Scale: ${k||"none"})`);return a}async updateAllPatternsWithNewTempo(){for(const[e,t]of this.activeSounds.entries())if(t.type==="strudel")try{const i=localStorage.getItem(`element-config-${e}`);if(i){const s=JSON.parse(i);s.pattern&&s.pattern.trim()!==""&&await this.updatePatternInPlace(e,s.pattern)}}catch{}}isPlaying(e){return this.activeSounds.has(e)}getAudioContext(){return this.audioContext}isAudioReady(){return this.initialized&&this.audioContext&&(this.audioContext.state==="running"||this.audioContext.state==="suspended")}playSustainingTone(e,t,i,s,r=null){if(!this.initialized||!this.audioContext)return;this.audioContext.state==="suspended"&&(Ys(),this.audioContext.resume().catch(d=>{console.error("Failed to resume audio context:",d)}));const a=(t-i)/(s-i),o=160,c=o*Math.pow(1e4/o,a);this.stopSustainingTone(e);const u=this.audioContext.createOscillator(),h=this.audioContext.createGain();if(u.type="sine",u.frequency.value=c,u.connect(h),r){const d=this.getElementAudioNodes(r);d?(h.connect(d.gainNode),h.gain.value=.3):(h.connect(this.gainNode),h.gain.value=this.volume*.3)}else h.connect(this.gainNode),h.gain.value=this.volume*.3;u.start(0),this.activeSounds.set(e,{type:"sustaining",oscillator:u,gain:h,frequency:c})}updateSustainingToneFrequency(e,t,i,s,r=null){if(!this.audioContext)return;this.audioContext.state==="suspended"&&(Ys(),this.audioContext.resume().catch(o=>{console.error("Failed to resume audio context:",o)}));const a=this.activeSounds.get(e);if(a&&a.type==="sustaining"&&a.oscillator)try{const o=(t-i)/(s-i),l=160,u=l*Math.pow(1e4/l,o);a.oscillator.frequency.setValueAtTime(u,this.audioContext.currentTime),a.frequency=u}catch(o){console.error("Error updating sustaining tone frequency:",o),this.playSustainingTone(e,t,i,s,r)}else this.playSustainingTone(e,t,i,s,r)}async checkSoundBanksStatus(){if(!window.strudel||!window.strudel.evaluate)return{loaded:!1,error:"Strudel not initialized"};try{return{loaded:(typeof globalThis.s=="function"&&typeof globalThis.sound=="function")===!0}}catch(e){return{loaded:!1,error:e.message}}}async ensureDefaultSoundBanks(){var e;if(!window.strudel||!window.strudel.evaluate){try{this.strudelLoaded||await this.initStrudel()}catch{}if(!window.strudel||!window.strudel.evaluate)return!1}if(this.strudelSoundBanksLoaded)return!0;if(this.strudelSoundBankLoading){for(;this.strudelSoundBankLoading;)await new Promise(t=>setTimeout(t,100));return this.strudelSoundBanksLoaded}this.strudelSoundBankLoading=!0;try{if(console.log("📦 Loading default Strudel sound banks (dirt-samples)..."),typeof document<"u"){const s=document.getElementById("status-text");s&&(s.textContent="📦 Loading default drum samples...")}const t=((e=window.strudel)==null?void 0:e.samples)||globalThis.samples;if(t&&typeof t=="function")try{console.log("📦 Loading default Strudel samples from dough-samples CDN...");const s=Ou,r={tidalDrums:!1,piano:!1,dirt:!1,vcsl:!1,mridangam:!1};if(await Promise.all([t(`${s}/tidal-drum-machines.json`).then(()=>{console.log("  ✅ Tidal drum machines loaded (TR-808, TR-909, TR-707, RhythmAce, AkaiLinn, etc.)"),r.tidalDrums=!0}).catch(a=>{console.warn("  ⚠️ Could not load tidal-drum-machines from CDN:",a.message),console.log("  📁 Will use local TR-808/TR-909 samples as fallback")}),t(`${s}/piano.json`).then(()=>{console.log("  ✅ Piano samples loaded"),r.piano=!0}).catch(a=>console.warn("  ⚠️ Could not load piano:",a.message)),t(`${s}/Dirt-Samples.json`).then(()=>{console.log("  ✅ Dirt-Samples loaded"),r.dirt=!0}).catch(a=>console.warn("  ⚠️ Could not load Dirt-Samples:",a.message)),t(`${s}/vcsl.json`).then(()=>{console.log("  ✅ VCSL (vocal) samples loaded"),r.vcsl=!0}).catch(a=>console.warn("  ⚠️ Could not load VCSL:",a.message)),t(`${s}/mridangam.json`).then(()=>{console.log("  ✅ Mridangam (percussion) samples loaded"),r.mridangam=!0}).catch(a=>console.warn("  ⚠️ Could not load mridangam:",a.message))]),console.log("✅ Default Strudel samples loaded from dough-samples CDN"),r.tidalDrums)console.log("📝 Note: TR-808 and TR-909 loaded from CDN (local samples available as backup)");else{console.log("📁 Loading local TR-808 and TR-909 samples as fallback...");try{await this.loadBank("RolandTR808"),await this.loadBank("RolandTR909"),console.log("✅ Local TR-808 and TR-909 samples loaded successfully")}catch(a){console.warn("⚠️ Could not load local TR-808/TR-909 samples:",a)}}}catch(s){console.warn("⚠️ Error loading samples from dough-samples:",s),console.log("   Attempting to load local TR-808/TR-909 samples...");try{await this.loadBank("RolandTR808"),await this.loadBank("RolandTR909"),console.log("✅ Local TR-808 and TR-909 samples loaded as fallback")}catch(r){console.warn("⚠️ Could not load local samples either:",r)}}this.strudelSoundBanksLoaded=!0,this.strudelSoundBankLoading=!1,console.log("✅ Default sound banks ready"),console.log("📦 Available: Piano, Dirt-Samples, VCSL, Mridangam, Drum Machines (TR-808, TR-909, TR-707, etc.)"),console.log("🧪 Testing pattern evaluation...");let i=!1;if(typeof globalThis.silence=="object"&&typeof globalThis.sound=="function"&&typeof globalThis.note=="function"){console.log("✅ Pattern functions available in globalThis");try{await window.strudel.evaluate("d16 = silence"),console.log("✅ Pattern assignment test passed"),i=!0}catch(s){console.warn("⚠️ Pattern assignment test failed:",s),await new Promise(r=>setTimeout(r,1e3));try{await window.strudel.evaluate("d16 = silence"),console.log("✅ Pattern assignment test passed on retry"),i=!0}catch(r){console.error("❌ Pattern assignment still failing:",r)}}}else console.error("❌ Pattern functions not available in globalThis"),console.log("  silence:",typeof globalThis.silence,"(should be object)"),console.log("  sound:",typeof globalThis.sound,"(should be function)"),console.log("  note:",typeof globalThis.note,"(should be function)");if(i&&this.onSoundsReadyCallback?(console.log("🔔 Notifying app that sounds are ready..."),this.onSoundsReadyCallback()):i||console.warn("⚠️ Sounds loaded but patterns not ready - dots will stay red"),typeof document<"u"){const s=document.getElementById("status-text");s&&(s.textContent="✅ Samples loaded - Ready!",setTimeout(()=>{s.textContent.includes("Samples loaded")&&(s.textContent="Ready - Click elements to start/stop patterns (Press Escape to stop all)")},2e3))}return!0}catch(t){return this.strudelSoundBankLoading=!1,t.message&&t.message.includes("CycleTones")?(console.log("⚠️ CycleTones not available - patterns will use dirt-samples if loaded"),!1):(console.error("❌ Failed to load default sound banks:",t),console.error("Error details:",t.message,t.stack),console.error("Strudel patterns may not work without default sound banks"),!1)}}async preloadAllCommonDrumSounds(){return console.log("📦 Preloading skipped (silent mode) - no audible patterns will be evaluated"),!0}exposeSampleListHelper(e,t){globalThis.getLoadedSamples=()=>{try{let i=null,s="";const r=(e==null?void 0:e.soundMap)||(t==null?void 0:t.soundMap);if(r&&(i=typeof r.get=="function"?r.get():r,i&&typeof i=="object"&&(s="webaudioModule/webModule.soundMap")),(!i||Object.keys(i).length===0)&&this.strudelRepl){const l=this.strudelRepl;if(l.scheduler){const c=l.scheduler;if(c.soundMap&&(i=typeof c.soundMap.get=="function"?c.soundMap.get():c.soundMap,i&&typeof i=="object"&&(s="repl.scheduler.soundMap")),(!i||Object.keys(i).length===0)&&c.context){const u=c.context;u.soundMap&&(i=typeof u.soundMap.get=="function"?u.soundMap.get():u.soundMap,i&&typeof i=="object"&&(s="repl.scheduler.context.soundMap"))}}}if((!i||Object.keys(i).length===0)&&window.strudel&&window.strudel.repl&&window.strudel.repl.scheduler){const l=window.strudel.repl.scheduler;l.soundMap&&(i=typeof l.soundMap.get=="function"?l.soundMap.get():l.soundMap,i&&typeof i=="object"&&(s="window.strudel.repl.scheduler.soundMap"))}if(!i||Object.keys(i).length===0){const l=(e==null?void 0:e.getSound)||(t==null?void 0:t.getSound);if(l&&typeof l=="function"){console.log("🔍 Attempting to detect samples via getSound function...");const c=["bd","sd","hh","cp","oh","cr","rim","tr808_bd","tr909_bd","RolandTR808_bd","RolandTR909_bd"],u=[];c.forEach(h=>{try{const d=l(h);d&&d!=="triangle"&&u.push(h)}catch{}}),u.length>0&&(console.log(`📊 Found ${u.length} samples via getSound:`,u),s="getSound detection")}}if((!i||Object.keys(i).length===0)&&this.strudelRepl){const l=this.strudelRepl;console.log("🔍 Checking REPL properties for sample registry..."),console.log("   REPL keys:",Object.keys(l).slice(0,20)),l.scheduler&&(console.log("   Scheduler keys:",Object.keys(l.scheduler).slice(0,20)),l.scheduler.context&&console.log("   Scheduler.context keys:",Object.keys(l.scheduler.context).slice(0,20))),l.samples&&typeof l.samples=="object"&&(i=l.samples,s="repl.samples",console.log("✅ Found samples in repl.samples"))}if((!i||Object.keys(i).length===0)&&window.strudel&&window.strudel.evaluate){console.log("🔍 Testing pattern evaluation to detect available samples...");const l=['s("bd")','s("bd").bank("tr808")','s("bd").bank("tr909")','sound("bd")'];for(const c of l)try{const u=window.strudel.evaluate(c);console.log(`   Pattern "${c}" evaluated successfully`)}catch(u){u.message&&(u.message.includes("not found")||u.message.includes("not loaded"))?console.log(`   Pattern "${c}" - sample not found (expected)`):console.log(`   Pattern "${c}" - error:`,u.message)}}if(!i||Object.keys(i).length===0){const l=Object.keys(globalThis).filter(c=>c.toLowerCase().includes("sample")||c.toLowerCase().includes("sound")||c.toLowerCase().includes("bank"));l.length>0&&(console.log("🔍 Found potential sample-related globals:",l),l.forEach(c=>{try{const u=globalThis[c];if(typeof u=="object"&&u!==null&&!Array.isArray(u)){const h=Object.keys(u);h.length>0&&(console.log(`   ${c} has ${h.length} keys:`,h.slice(0,10)),(!i||Object.keys(i).length===0)&&(i=u,s=`globalThis.${c}`))}}catch{}}))}if(!i||typeof i!="object"||Object.keys(i).length===0)return console.log("⚠️ soundMap not found or empty"),console.log("   Tried: webaudioModule, webModule, repl.scheduler, window.strudel"),console.log("   This might mean samples are loaded but not yet registered"),console.log("   Try loading a bank first, then check again"),{total:0,keys:[],byBank:{},source:"none",note:"No samples found. Samples may need to be loaded first."};const a=Object.keys(i);console.log(`📊 Total loaded samples: ${a.length} (from ${s})`),console.log("📋 All loaded sample names:",a);const o={};return a.forEach(l=>{const c=l.split("_");if(c.length>1){const u=c[0],h=c.slice(1).join("_");o[u]||(o[u]=[]),o[u].push(h)}else o.default||(o.default=[]),o.default.push(l)}),Object.keys(o).length>0&&(console.log("📦 Samples grouped by bank:"),Object.entries(o).forEach(([l,c])=>{console.log(`  ${l}: ${c.length} sounds`,c.slice(0,20))})),{total:a.length,keys:a,byBank:o,source:s}}catch(i){return console.error("❌ Error getting loaded samples:",i),console.error("   Stack:",i.stack),null}},console.log("✅ Helper function available: getLoadedSamples()"),console.log("   Call getLoadedSamples() in console to see all loaded samples")}async loadBank(e){var u,h,d,f,m;if(!window.strudel||!window.strudel.evaluate)throw console.warn("Cannot load bank: Strudel not initialized"),new Error("Strudel not initialized");if(!e||typeof e!="string")return console.warn("Cannot load bank: invalid name",e),!1;if(e=e.trim(),!e)return console.warn("Cannot load bank: empty name after trimming"),!1;const t=e.toLowerCase();if(new Set(["sine","square","triangle","sawtooth","supersaw","pulse","saw","saw2","saw3","saw4","saw8"]).has(e.toLowerCase()))return console.log(`⏭️ Skipping built-in oscillator synth "${e}" (no loading needed)`),this.loadedBanks.add(e.toLowerCase()),this.loadedBanks.add(e),!0;const s={RolandTR909:{RolandTR909_bd:["assets/sounds/Kicks/ESWTR909 Kick 01.wav","assets/sounds/Kicks/ESWTR909 Kick 02.wav","assets/sounds/Kicks/ESWTR909 Kick 03.wav","assets/sounds/Kicks/ESWTR909 Kick 04.wav","assets/sounds/Kicks/ESWTR909 Kick 05.wav","assets/sounds/Kicks/ESWTR909 Kick 06.wav","assets/sounds/Kicks/ESWTR909 Kick 07.wav","assets/sounds/Kicks/ESWTR909 Kick 08.wav","assets/sounds/Kicks/ESWTR909 Kick 09.wav","assets/sounds/Kicks/ESWTR909 Kick 10.wav"],RolandTR909_sd:["assets/sounds/Snares/ESWTR909 Snare 01.wav","assets/sounds/Snares/ESWTR909 Snare 02.wav","assets/sounds/Snares/ESWTR909 Snare 03.wav","assets/sounds/Snares/ESWTR909 Snare 04.wav","assets/sounds/Snares/ESWTR909 Snare 05.wav","assets/sounds/Snares/ESWTR909 Snare 06.wav","assets/sounds/Snares/ESWTR909 Snare 07.wav","assets/sounds/Snares/ESWTR909 Snare 08.wav","assets/sounds/Snares/ESWTR909 Snare 09.wav","assets/sounds/Snares/ESWTR909 Snare 10.wav","assets/sounds/Snares/ESWTR909 Snare 11.wav","assets/sounds/Snares/ESWTR909 Snare 12.wav"],RolandTR909_hh:["assets/sounds/Hats/ESWTR909 HH Closed 01.wav","assets/sounds/Hats/ESWTR909 HH Closed 02.wav","assets/sounds/Hats/ESWTR909 HH Closed 03.wav","assets/sounds/Hats/ESWTR909 HH Closed 04.wav","assets/sounds/Hats/ESWTR909 HH Closed 05.wav","assets/sounds/Hats/ESWTR909 HH Closed 06.wav","assets/sounds/Hats/ESWTR909 HH Closed 07.wav","assets/sounds/Hats/ESWTR909 HH Closed 08.wav","assets/sounds/Hats/ESWTR909 HH Closed 09.wav","assets/sounds/Hats/ESWTR909 HH Closed 10.wav"],RolandTR909_oh:["assets/sounds/Hats/ESWTR909 HH Open 01.wav","assets/sounds/Hats/ESWTR909 HH Open 02.wav","assets/sounds/Hats/ESWTR909 HH Open 03.wav","assets/sounds/Hats/ESWTR909 HH Open 04.wav","assets/sounds/Hats/ESWTR909 HH Open 05.wav","assets/sounds/Hats/ESWTR909 HH Open 06.wav","assets/sounds/Hats/ESWTR909 HH Open 07.wav","assets/sounds/Hats/ESWTR909 HH Open 08.wav"],RolandTR909_cp:["assets/sounds/Claps/ESWTR909 Clap 01.wav","assets/sounds/Claps/ESWTR909 Clap 02.wav","assets/sounds/Claps/ESWTR909 Clap 03.wav","assets/sounds/Claps/ESWTR909 Clap 04.wav","assets/sounds/Claps/ESWTR909 Clap 05.wav"],RolandTR909_cr:["assets/sounds/Hats/ESWTR909 HH Crash 01.wav","assets/sounds/Hats/ESWTR909 HH Crash 02.wav","assets/sounds/Hats/ESWTR909 HH Crash 03.wav","assets/sounds/Hats/ESWTR909 HH Crash 04.wav","assets/sounds/Hats/ESWTR909 HH Crash 05.wav"],RolandTR909_lt:["assets/sounds/Toms/ESWTR909 Tom 01.wav","assets/sounds/Toms/ESWTR909 Tom 02.wav","assets/sounds/Toms/ESWTR909 Tom 03.wav","assets/sounds/Toms/ESWTR909 Tom 04.wav","assets/sounds/Toms/ESWTR909 Tom 05.wav"],RolandTR909_mt:["assets/sounds/Toms/ESWTR909 Tom 06.wav","assets/sounds/Toms/ESWTR909 Tom 07.wav","assets/sounds/Toms/ESWTR909 Tom 08.wav","assets/sounds/Toms/ESWTR909 Tom 09.wav","assets/sounds/Toms/ESWTR909 Tom 10.wav"],RolandTR909_ht:["assets/sounds/Toms/ESWTR909 Tom 11.wav","assets/sounds/Toms/ESWTR909 Tom 12.wav","assets/sounds/Toms/ESWTR909 Tom 13.wav","assets/sounds/Toms/ESWTR909 Tom 14.wav","assets/sounds/Toms/ESWTR909 Tom 15.wav"]},RolandTR808:{RolandTR808_bd:["assets/sounds/Kicks/ESW909X Kick 01.wav","assets/sounds/Kicks/ESW909X Kick 02.wav","assets/sounds/Kicks/ESW909X Kick 03.wav","assets/sounds/Kicks/ESW909X Kick 04.wav","assets/sounds/Kicks/ESW909X Kick 05.wav"],RolandTR808_sd:["assets/sounds/Snares/ESW909X Snare 01.wav","assets/sounds/Snares/ESW909X Snare 02.wav","assets/sounds/Snares/ESW909X Snare 03.wav","assets/sounds/Snares/ESW909X Snare 04.wav","assets/sounds/Snares/ESW909X Snare 05.wav"],RolandTR808_cp:["assets/sounds/Claps/ESW909X Clap 01.wav","assets/sounds/Claps/ESW909X Clap 02.wav","assets/sounds/Claps/ESW909X Clap 03.wav","assets/sounds/Claps/ESW909X Clap 04.wav","assets/sounds/Claps/ESW909X Clap 05.wav"]}},r=["RolandTR707","RhythmAce","AkaiLinn","ViscoSpaceDrum","CasioRZ1"],a=["piano","superpiano","jazz","supersaw","folkharp","casio","insect","wind","wood","metal","east","crow","space","numbers","sawtooth","sine","square","triangle","saw","saw2","saw3","saw4","saw8","gtr"],o={mridangam:`${Ou}/mridangam.json`,vcsl:`${Ou}/vcsl.json`};if(o[t]){const g=((u=window.strudel)==null?void 0:u.samples)||globalThis.samples;if(!g||typeof g!="function")return console.warn(`⚠️ samples() function not available for specialty bank "${t}"`),!1;try{console.log(`📦 Loading specialty sample bank "${t}" from dough-samples`);let y=this.specialtyManifests.get(t);if(!y){const k=await fetch(o[t]);if(!k.ok)throw new Error(`HTTP ${k.status}`);const w=await k.json();y=vx(w),this.specialtyManifests.set(t,y)}const b={...y},P=Object.keys(y||{});return P.forEach(k=>{const w=`${t}_${k}`;b[w]||(b[w]=y[k])}),await g(b),P.forEach(k=>{const w=k.toLowerCase();this.sampleNameToSpecialtyBank.set(w,t),this.sampleNameToSpecialtyBank.set(`${t}_${w}`,t),this.loadedBanks.add(w),this.loadedBanks.add(k),this.loadedBanks.add(`${t}_${w}`),this.loadedBanks.add(`${t}_${k}`)}),this.loadedBanks.add(t),this.loadedBanks.add(e),console.log(`✅ Specialty bank "${t}" loaded`),!0}catch(y){return console.warn(`⚠️ Failed to load specialty bank "${t}":`,y.message||y),!1}}if(s[e]){console.log(`📦 Loading local custom bank "${e}" from assets folder...`);const g=((h=window.strudel)==null?void 0:h.samples)||globalThis.samples;if(g&&typeof g=="function")try{return await g(s[e]),console.log(`✅ Local custom bank "${e}" loaded successfully from assets`),this.loadedBanks.add(e),!0}catch(y){return console.error(`❌ Failed to load local bank "${e}":`,y),!1}else return console.error("❌ samples() function not available"),!1}if(r.includes(e)){console.log(`📦 Ensuring built-in drum bank "${e}" samples are loaded...`);try{const y=`d15 = s("bd sd hh cp oh cr rd ht mt lt sh cb tb pe").bank("${e}")`;if(await window.strudel.evaluate(y),window.strudel.scheduler&&typeof window.strudel.scheduler.tick=="function")for(let b=0;b<4;b++)window.strudel.scheduler.tick(),await new Promise(P=>setTimeout(P,50));else await new Promise(b=>setTimeout(b,200));return await window.strudel.evaluate("d15 = silence"),this.loadedBanks.add(e),console.log(`✅ Built-in drum bank "${e}" ready`),!0}catch(g){return console.warn(`⚠️ Could not preload built-in bank "${e}":`,g),this.loadedBanks.add(e),!0}}let l=t;if(ma[t]&&(l=ma[t],console.log(`🔄 Normalizing bank name "${e}" to "${l}"`)),a.includes(l)){const g=((d=window.strudel)==null?void 0:d.samples)||globalThis.samples;if(g&&typeof g=="function")try{return console.log(`📦 Loading sample bank "${l}" via samples()`),await g(l),this.loadedBanks.add(l),this.loadedBanks.add(t),console.log(`✅ Sample bank "${l}" loaded`),!0}catch(y){return console.warn(`⚠️ Failed to load sample bank "${l}":`,y.message||y),this.loadedBanks.add(l),this.loadedBanks.add(t),!1}else return console.warn(`⚠️ samples() function not available for loading "${l}"`),!1}if(e.startsWith("github:")){const g=((f=window.strudel)==null?void 0:f.samples)||globalThis.samples;if(!g||typeof g!="function")throw console.error("samples function not available!"),new Error("samples function not available");console.log(`📦 Loading bank via samples(): ${e}`);try{const y=await g(e);return console.log("samples() call completed, result:",y),console.log("⏳ Waiting for samples to load..."),await new Promise(b=>setTimeout(b,2e3)),console.log(`✅ Bank loaded: ${e}`),!0}catch(y){throw console.error(`❌ Failed to load bank ${e}:`,y),y}}else{console.log(`📦 Bank "${e}" is a predefined bank name`);const g=((m=window.strudel)==null?void 0:m.samples)||globalThis.samples;if(!g||typeof g!="function")return console.warn(`⚠️ samples function not available for loading bank "${e}"`),console.log(`   Bank "${e}" may need to be loaded manually`),!1;const y=[e];let b=!1;const P=console.error;console.error=(...w)=>{let C="";for(let Q=0;Q<w.length;Q++)typeof w[Q]=="string"?C+=" "+w[Q]:w[Q]&&w[Q].toString&&(C+=" "+String(w[Q]));const $=String(w[0]||""),A=C.toLowerCase();$.includes("JSON")||$.includes("SyntaxError")||$.includes("not found")||$.includes("RolandTR")||$.includes("404")||$.includes("Failed")||$.includes("<!DOCTYPE")||$.includes("Unexpected token")||$.includes("is not valid JSON")||$.includes("Unexpected non-whitespace")||C.includes("JSON")||C.includes("SyntaxError")||C.includes("not found")||C.includes("RolandTR")||C.includes("404")||C.includes("<!DOCTYPE")||C.includes("Unexpected token")||C.includes("is not valid JSON")||A.includes("json")||A.includes("syntaxerror")||A.includes("rolandtr")||P.apply(console,w)};try{for(const w of y)try{console.log(`   Trying to load from: ${w}`);const C=await g(w);console.log(`   ✅ Successfully called samples() with: ${w}`),b=!0;break}catch{console.log(`   ✗ Path "${w}" not available`);continue}}finally{console.error=P}return b?(console.log("⏳ Waiting for samples to load..."),await new Promise(w=>setTimeout(w,3e3)),console.log(`✅ Bank "${e}" loading initiated`),this.loadedBanks.add(e)):(console.log(`⚠️ Could not load "${e}" from any known path`),console.log(`   Bank "${e}" may be embedded in Strudel or unavailable`),console.log(`   To use this bank in patterns (if available), use: .bank("${e}")`),console.log(`   Example: sound("bd hh").bank("${e}")`)),b}}async ensurePatternResourcesLoaded(e){var c;if(!e||typeof e!="string"||typeof this.loadBank!="function")return;const t=this._sanitizePatternExpression(e)||e,i=new Set(["sine","square","triangle","sawtooth","supersaw","pulse","saw","saw2","saw3","saw4","saw8"]),s=new Set,r=/\.bank\(["']([^"']+)["']\)/g;let a;for(;(a=r.exec(t))!==null;)a[1]&&s.add(a[1]);const o=/\.s\(["']([^"']+)["']\)/g;for(;(a=o.exec(t))!==null;){const u=a[1];u&&(/\s|~|\[|\]|,/.test(u)||i.has(u.toLowerCase())||s.add(u))}const l=/\.sound\(["']([^"']+)["']\)/g;for(;(a=l.exec(t))!==null;){const u=a[1];u&&(i.has(u.toLowerCase())||s.add(u))}for(const u of s){if(this.loadedBanks.has(u)||!u)continue;const h=u.toLowerCase();if(i.has(h)){console.log(`⏭️ Skipping built-in oscillator synth "${u}" (no loading needed)`),this.loadedBanks.add(h),this.loadedBanks.add(u);continue}const d=(c=this.sampleNameToSpecialtyBank)==null?void 0:c.get(h);if(d){if(console.log(`⏭️ "${u}" is provided by specialty bank "${d}"`),!this.loadedBanks.has(d))try{await this.loadBank(d)}catch(m){console.warn(`⚠️ Could not ensure specialty bank "${d}" for "${u}":`,m)}this.loadedBanks.add(h),this.loadedBanks.add(u);continue}let f=h;if(ma[h]&&(f=ma[h],console.log(`🔄 Normalizing "${u}" to "${f}" for loading`)),this.loadedBanks.has(f)){console.log(`✅ Resource "${u}" already loaded as "${f}"`),this.loadedBanks.add(u);continue}try{console.log(`🎚️ ensurePatternResourcesLoaded: loading "${f}" for playback`),await this.loadBank(f)?(this.loadedBanks.add(f),this.loadedBanks.add(u),console.log(`✅ Resource "${f}" loaded`)):console.warn(`⚠️ Could not load resource "${f}" (continuing anyway)`)}catch(m){console.warn(`⚠️ Error loading resource "${f}" (continuing anyway):`,m.message||m)}}}stopSustainingTone(e){const t=this.activeSounds.get(e);if(t&&t.type==="sustaining"&&t.oscillator)try{const i=t.gain,s=this.audioContext.currentTime;i.gain.cancelScheduledValues(s),i.gain.setValueAtTime(i.gain.value,s),i.gain.linearRampToValueAtTime(0,s+.1),setTimeout(()=>{t.oscillator.stop(),this.activeSounds.delete(e)},100)}catch(i){console.error("Error stopping sustaining tone:",i),this.activeSounds.delete(e)}}saveElementToMaster(e,t,i,s){try{console.log(`💾 Saving ${e} to master: pattern="${t==null?void 0:t.substring(0,50)}...", gain=${i}, pan=${s}`);const r=(t||"").replace(/[""]/g,'"').replace(/['']/g,"'"),a=this._sanitizePatternExpression(r),o=this.patternHasNoteNames(a),l=this.patternHasNumericNotePattern(a);let c=a;if(/\bnote\s*\(/i.test(r)){const h=/\bnote\s*\(\s*(["'])([^"']*)\1/gi;let d=!1;c=c.replace(h,(f,m,g)=>{const y=g.replace(/[<>\[\]\{\}\|,]/g," ").trim();return y&&!/[a-gA-G]/.test(y)&&/^[\d\s~\-\/]+$/.test(y)?(d=!0,`n(${m}${g}${m}`):f}),d&&console.log(`🔄 Converted note() with semitones to n() for ${e}`)}return this.trackedPatterns.set(e,{rawPattern:c,pattern:c,gain:i||.8,pan:s||0,muted:!1,soloed:!1}),this.audioContext&&this.getElementAudioNodes(e)&&console.log(`  🎚️ Created audio nodes for ${e}`),console.log(`✅ Saved ${e} to master. Total tracks: ${this.trackedPatterns.size}`),{success:!0}}catch(r){return console.error(`❌ Error saving ${e} to master:`,r),{success:!1,error:r.message}}}async routePatternThroughMaster(e,t,{isPreview:i=!1,autoStart:s=!1}={}){if(!this.masterOnlyPlayback)return{success:!1,error:"Master-only playback is disabled"};const r=typeof t=="string"?t:"";if(!r.trim())return console.warn(`⚠️ Empty pattern for ${e}, removing from master`),this.removeElementFromMaster(e),this.masterActive&&await this.playMasterPattern(),{success:!1,error:"Pattern empty"};const o=this.getElementGain(e),l=this.getElementPan(e),c=this.saveElementToMaster(e,r,o,l);return c.success?(i?this.previewElementIds.add(e):this.previewElementIds.delete(e),this.updateMasterPattern(this.soloedElements,this.mutedElements),this.masterActive||s?this.playMasterPattern():{success:!0,autoStarted:!1}):c}removeElementFromMaster(e){try{return this.previewElementIds.delete(e),this.trackedPatterns.has(e)&&(this.trackedPatterns.delete(e),console.log(`🗑️ Removed ${e} from master. Remaining tracks: ${this.trackedPatterns.size}`),this.updateMasterPattern(),this.masterOnlyPlayback&&(this.masterPattern&&this.masterPattern.trim()?this.masterActive&&this.playMasterPattern().catch(t=>console.warn("⚠️ Failed to refresh master after removal:",t)):this.masterActive&&this.stopMasterPattern().catch(t=>console.warn("⚠️ Failed to stop master after removal:",t)))),{success:!0}}catch(t){return console.error(`❌ Error removing ${e} from master:`,t),{success:!1,error:t.message}}}updateTrackedElementGain(e,t){if(this.trackedPatterns.has(e)){const i=this.trackedPatterns.get(e);return i.gain=t,console.log(`🎚️ Updated ${e} gain in master: ${t.toFixed(2)}`),this.updateMasterPattern(this.soloedElements,this.mutedElements),this.scheduleMasterPatternRefresh(`gain change: ${e}`),{success:!0}}return{success:!1,reason:"Element not tracked in master"}}updateTrackedElementPan(e,t){if(this.trackedPatterns.has(e)){const i=this.trackedPatterns.get(e);return i.pan=t,console.log(`🎚️ Updated ${e} pan in master: ${t.toFixed(2)}`),this.updateMasterPattern(this.soloedElements,this.mutedElements),this.scheduleMasterPatternRefresh(`pan change: ${e}`),{success:!0}}return{success:!1,reason:"Element not tracked in master"}}scheduleMasterPatternRefresh(e="unspecified"){this._pendingMasterPatternRefreshReason=e,!this._masterPatternRefreshTimer&&(this._masterPatternRefreshTimer=setTimeout(()=>{this._masterPatternRefreshTimer=null,this._performScheduledMasterPatternRefresh()},60))}async _performScheduledMasterPatternRefresh(){if(!this.masterPattern||this.masterPattern.trim()===""){this._pendingMasterPatternRefreshReason=null;return}if(!this.masterActive){console.log(`🔁 Master refresh skipped (not active). Pending reason: ${this._pendingMasterPatternRefreshReason||"unspecified"}`),this._pendingMasterPatternRefreshReason=null;return}const e=this._pendingMasterPatternRefreshReason||"unspecified";this._pendingMasterPatternRefreshReason=null,this._masterPatternEvalPromise=this._masterPatternEvalPromise.catch(()=>{}).then(()=>this._reEvaluateMasterPattern(e));try{await this._masterPatternEvalPromise}catch(t){console.warn(`⚠️ Master pattern refresh failed (${e}):`,t)}}formatMasterPatternWithTempoComment(e){if(!e||typeof e!="string"||e.trim()==="")return e;const t=this.currentTempo||120,i="// Controls Selected Tempo:",r=e.split(`
`).filter(o=>!o.trim().startsWith(i)).join(`
`).trimEnd(),a=this._sanitizePatternExpression(r);return a!==r&&console.log("🧼 Sanitized master pattern when formatting tempo comment"),`${a}

${i} ${t} BPM`}updateMasterPattern(e=new Set,t=new Set){var i,s,r;try{console.log(`🎛️ Updating master pattern. Tracks: ${this.trackedPatterns.size}, Solo: ${e.size}, Muted: ${t.size}`);const a=[],o=[],l=[],c=e.size>0,u=this.getScaleConversionContext();let h=0;for(const[f,m]of this.trackedPatterns.entries()){const g=t.has(f),y=e.has(f),b=this.extractChannelNumber(f,h);if(h+=1,g||c&&!y){console.log(`  ⏭️ Skipping ${f} (muted: ${g}, solo active but not soloed: ${c&&!y})`);continue}if(m.gain<=0){console.log(`  ⏭️ Skipping ${f} (gain is ${m.gain})`);continue}const P=m.pattern||m.rawPattern||"",k=this._sanitizePatternExpression(P);if(k!==P&&(m.pattern=k,m.rawPattern=k),!k||k.trim()===""){console.log(`  ⏭️ Skipping ${f} (empty pattern)`);continue}const w=this.patternHasNoteNames(k),C=this.patternHasNumericNotePattern(k);let $=k;w&&!C?($=k,console.log(`  📝 Preserving note names format for ${f}: ${k.substring(0,50)}...`)):C&&!w?($=k,console.log(`  📝 Preserving semitones format for ${f}: ${k.substring(0,50)}...`)):($=k,console.log(`  📝 Preserving pattern format as-is for ${f}: ${k.substring(0,50)}...`)),m.pattern=$;let A=($||"").trim();if(A=A.replace(/[""]/g,'"').replace(/['']/g,"'"),(()=>{const re=/\/\*\s*Channel\s+\d+\s*\*\//i.test(A),ve=/\bstack\s*\(/i.test(A);return!(re||ve)})())for(;A.startsWith("(")&&A.endsWith(")");){let re=0,ve=!0;for(let Ce=0;Ce<A.length;Ce++)if(A[Ce]==="("?re++:A[Ce]===")"&&re--,re===0&&Ce<A.length-1){ve=!1;break}if(ve&&re===0)A=A.slice(1,-1).trim();else break}if(A.startsWith("(")){let re=0,ve=-1;for(let Ce=0;Ce<A.length;Ce++)if(A[Ce]==="("&&re++,A[Ce]===")"&&re--,re===0){ve=Ce;break}ve===-1&&(A=A.substring(1),console.log("  🔧 Stripped unmatched opening paren from pattern"))}A=yu(A),A=`${A.trim()}.postgain(${m.gain.toFixed(2)})`,m.pan!==0&&(A=`${A}.pan(${m.pan.toFixed(2)})`);const W=((s=(i=this.appInstance)==null?void 0:i.loadElementConfig)==null?void 0:s.call(i,f))||{};let U=W.key||null,Z=W.scale||null;if((!U||!Z)&&A.includes(".scale(")){const re=A.match(/\.\s*scale\s*\(\s*['"]([^'"]+)['"]\s*\)/i);if(re&&re[1]){const ve=re[1];if(ve.includes(":")){const[Ce,De]=ve.split(":");U=U||Ce.trim(),Z=Z||De.trim(),console.log(`  🎼 Extracted scale from pattern: ${U}:${Z}`)}else Z=Z||ve.trim(),U=U||"C",console.log(`  🎼 Extracted scale from pattern: ${U}:${Z}`)}}const Y=A.trim(),ne=Y.startsWith("(")&&Y.endsWith(")");if(A=this.applyGlobalSettingsToPattern(A,ne,!1,U,Z),m.pan===0){let re=A.trim();(()=>{for(;re.startsWith("(")&&re.endsWith(")");){let Ce=0,De=!0;for(let Ue=0;Ue<re.length;Ue++){const Pt=re[Ue];if(Pt==="("?Ce++:Pt===")"&&Ce--,Ce===0&&Ue<re.length-1){De=!1;break}}if(!De||Ce!==0)break;re=re.slice(1,-1).trim()}})(),A=re}a.push(A),l.push(b),o.push(`Channel ${b}`),console.log(`  ✅ Added ${f}: ${A.substring(0,100)}...`)}if(a.length===0)this.masterPattern="",console.log("🔇 No active patterns - master pattern cleared");else{let m=`stack(
${a.map((C,$)=>`  /* Channel ${l[$]??$+1} */
  ${C}`).join(`,

`)}
)`;m=this.applyMasterMixModifiers(m,{wrapStack:!0}),this.masterPattern=m;let g=0,y=!1,b=null,P=!1;for(let C=0;C<this.masterPattern.length;C++){const $=this.masterPattern[C],A=this.masterPattern[C+1];if(!y&&$==="/"&&A==="/"){P=!0,C++;continue}if(P&&$===`
`){P=!1;continue}if(!P){if(!P&&($==='"'||$==="'")){y?$===b&&this.masterPattern[C-1]!=="\\"&&(y=!1,b=null):(y=!0,b=$);continue}if(!y&&!P){if($==="(")g++;else if($===")"&&(g--,g<0)){console.error(`  ⚠️ UNBALANCED PARENTHESES! Extra closing paren at position ${C}`);break}}}}const k=(this.masterPattern.match(/\(/g)||[]).length,w=(this.masterPattern.match(/\)/g)||[]).length;if(console.log(`🎵 Master pattern (stack): ${this.masterPattern.substring(0,150)}...`),console.log(`  📊 Parentheses: ${k} open, ${w} close, depth=${g}, balanced: ${g===0}`),g!==0)if(console.error(`  ⚠️ UNBALANCED PARENTHESES! Depth=${g}, fixing...`),console.log(`  🧾 Master pattern before fix:
`,this.masterPattern),g>0)this.masterPattern+=")".repeat(g),console.log(`  ✅ Added ${g} closing paren(s)`);else{const C=Math.abs(g);let $=0;for(let A=this.masterPattern.length-1;A>=0&&$<C;A--)this.masterPattern[A]===")"&&(this.masterPattern=this.masterPattern.substring(0,A)+this.masterPattern.substring(A+1),$++);console.log(`  ✅ Removed ${$} extra closing paren(s)`)}}if(this.masterPattern&&((r=window.__patternHistory)!=null&&r.saveMasterVersion))try{window.__patternHistory.saveMasterVersion(this.masterPattern)}catch(f){console.warn("⚠️ Unable to record master history entry:",f)}const d=this.masterPattern;if(d&&d.trim()!==""){let f=this.convertPatternForScale(d)||d;this.masterPattern=this.formatMasterPatternWithTempoComment(f)}return console.log(`🎛️ Applied global settings to master pattern (Key: ${this.currentKey||"none"}, Scale: ${this.currentScale||(this.currentKey?"derived":"none")}, Time Sig: ${this.currentTimeSignature||"none"}, Volume: ${this.formatNumberForPattern(this.masterVolume,4)}, Pan: ${this.formatNumberForPattern(this.masterPan,4)}, Tempo: ${this.currentTempo||120} BPM)`),this.onMasterPatternUpdateCallback&&this.onMasterPatternUpdateCallback(),{success:!0,pattern:this.masterPattern}}catch(a){return console.error("❌ Error updating master pattern:",a),{success:!1,error:a.message}}}setupVisualizerAnalyser(){var i,s;if(!this.audioContext||!window.strudel)return;const e="master-punchcard-canvas",t=((i=window.strudel)==null?void 0:i.getAnalyserById)||globalThis.getAnalyserById;if(!t||typeof t!="function"){console.warn("⚠️ getAnalyserById not available - visualizers may not work");return}try{let r=null;try{r=t(e,2048,.8),r&&r.context!==this.audioContext&&(console.warn("⚠️ Analyser from getAnalyserById is in different audio context, creating new one"),r=null)}catch(a){console.warn("⚠️ Could not get analyser from getAnalyserById:",a.message)}if(!r){r=this.audioContext.createAnalyser(),r.fftSize=2048,r.smoothingTimeConstant=.8;const a=t,o=r;window.strudel&&(window.strudel.analysers&&typeof window.strudel.analysers=="object"&&(window.strudel.analysers[e]=r,console.log(`✅ Stored analyser "${e}" in Strudel's analyser registry`)),window.strudel.getAnalyserById=function(l,c,u){return l===e?o:a(l,c,u)}),globalThis.getAnalyserById&&(globalThis.getAnalyserById=function(l,c,u){return l===e?o:a(l,c,u)}),globalThis.analysers||(globalThis.analysers={}),globalThis.analysers[e]=r,console.log(`✅ Created analyser "${e}" in our audio context and patched getAnalyserById`)}if(this.visualizerAnalyser=r,this.masterGainNode&&r){const a=this._realDestination||((s=this.audioContext)==null?void 0:s.destination);if(!a)console.warn("⚠️ Cannot connect analyser - destination unavailable");else try{if(!this.visualizerAnalyserTapGain&&this.audioContext&&(this.visualizerAnalyserTapGain=this.audioContext.createGain(),this.visualizerAnalyserTapGain.gain.value=0),this.visualizerAnalyserTapGain){try{this.visualizerAnalyserTapGain.disconnect()}catch{}this.visualizerAnalyserTapGain.connect(a)}try{r.disconnect()}catch{}try{this.masterGainNode.disconnect(r)}catch{}this.masterGainNode.connect(r),this.visualizerAnalyserTapGain&&r.connect(this.visualizerAnalyserTapGain),console.log(`✅ Connected visualizer analyser "${e}" with silent tap to destination`),setTimeout(()=>{try{const o=new Uint8Array(r.frequencyBinCount);r.getByteFrequencyData(o);const l=o.some(h=>h>0),c=Math.max(...o);console.log(`🔍 Analyser data check: hasData=${l}, maxValue=${c}, frequencyBinCount=${r.frequencyBinCount}`);const u=document.getElementById(e);u?console.log(`🔍 Canvas check: found canvas with ID "${e}", width=${u.width}, height=${u.height}`):console.warn(`⚠️ Canvas with ID "${e}" not found!`)}catch(o){console.warn("⚠️ Could not check analyser data:",o)}},500)}catch(o){console.warn(`⚠️ Failed to connect analyser "${e}":`,o.message)}}else console.warn(`⚠️ Cannot connect analyser - masterGainNode: ${!!this.masterGainNode}, analyser: ${!!r}`)}catch(r){console.warn("⚠️ Failed to setup visualizer analyser:",r)}}applyVisualizerTargetsToPattern(e){if(!e||typeof e!="string")return e;const i="master-punchcard-canvas",s="window.__strudelVisualizerCtx || (document.getElementById('master-punchcard-canvas') && document.getElementById('master-punchcard-canvas').getContext && document.getElementById('master-punchcard-canvas').getContext('2d'))",r=["spectrum","scope","tscope","fscope","visual","pianoroll","barchart"];let a=e;const o=new RegExp(`\\.\\s*_(${r.join("|")})\\s*\\(`,"gi");a=a.replace(o,(u,h)=>u.replace(`_${h}`,h));const l=["spectrum","scope","tscope","fscope"],c=["visual","barchart","pianoroll"];return l.forEach(u=>{const h=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(`\\.\\s*_?${h}\\s*\\(\\s*\\)`,"gi");a=a.replace(d,m=>m.replace(/\(\s*\)/,`({ id: '${i}' })`));const f=new RegExp(`\\.\\s*_?${h}\\s*\\(\\s*\\{([^}]*)\\}\\s*\\)`,"gi");a=a.replace(f,(m,g)=>{let y=g.trim();return/(^|,)\s*id\s*:/.test(y)||(y=y.length>0?`${y}, id: '${i}'`:`id: '${i}'`),m.replace(g,y)})}),c.forEach(u=>{const h=u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=new RegExp(`\\.\\s*_?${h}\\s*\\(\\s*\\)`,"gi");a=a.replace(d,m=>m.replace(/\(\s*\)/,`({ id: '${i}', ctx: ${s} })`));const f=new RegExp(`\\.\\s*_?${h}\\s*\\(\\s*\\{([^}]*)\\}\\s*\\)`,"gi");a=a.replace(f,(m,g)=>{let y=g.trim();const b=/(^|,)\s*id\s*:/.test(y),P=/(^|,)\s*ctx\s*:/.test(y);return b||(y=y.length>0?`${y}, id: '${i}'`:`id: '${i}'`),P||(y=y.length>0?`${y}, ctx: ${s}`:`ctx: ${s}`),m.replace(g,y)})}),a!==e&&(console.log("🎨 Injected canvas ID into visualizer methods"),console.log(`   Before: ${e.substring(0,150)}...`),console.log(`   After: ${a.substring(0,150)}...`)),a}async _reEvaluateMasterPattern(e="manual"){if(!this.masterPattern||this.masterPattern.trim()==="")return console.log("⚠️ No master pattern to re-evaluate"),{success:!1,error:"No pattern to re-evaluate"};if(!window.strudel||typeof window.strudel.evaluate!="function")return{success:!1,error:"Strudel evaluate unavailable"};this._ensureMasterPatternSanitized();const t=this.masterSlot||"d0",i=`${t} = ${this.masterPattern.trim()}`;try{return console.log(`🔄 Re-evaluating master pattern (${e})...`),await window.strudel.evaluate(i),console.log(`✅ Master pattern re-evaluated (${e})`),{success:!0,slot:t}}catch(s){return console.error("❌ Failed to re-evaluate master pattern:",s),{success:!1,error:s.message}}}async _playMasterPatternSimple(){var i,s,r;if(!this.masterPattern||this.masterPattern.trim()==="")return console.log("⚠️ No master pattern to play (master-only mode)"),this.masterActive?await this._stopMasterPatternSimple():this.masterActive=!1,{success:!1,error:"No pattern to play"};if(await this.initialize(),this.strudelLoaded||await this.initStrudel(),this.masterGainNode){const a=((i=this.audioContext)==null?void 0:i.currentTime)||0;this.masterGainNode.gain.setValueAtTime(this.masterVolume,a)}if(this.masterPanNode&&this.masterPanNode.pan.setValueAtTime(this.masterPan,((s=this.audioContext)==null?void 0:s.currentTime)||0),!window.strudel||typeof window.strudel.evaluate!="function")return{success:!1,error:"Strudel evaluate unavailable"};this._ensureMasterPatternSanitized();const e=this.masterSlot||"d0",t=`${e} = ${this.masterPattern.trim()}`;try{return await window.strudel.evaluate(t),window.strudel.scheduler?window.strudel.scheduler.started||await window.strudel.scheduler.start():console.warn("⚠️ Strudel scheduler missing - cannot ensure playback"),this.masterActive=!0,this.masterPlaybackStartTime=((r=this.audioContext)==null?void 0:r.currentTime)||performance.now(),this.onMasterStateChangeCallback&&this.onMasterStateChangeCallback(!0,Array.from(this.trackedPatterns.keys())),{success:!0,slot:e}}catch(a){return console.error("❌ Failed to evaluate master pattern:",a),{success:!1,error:a.message}}}async playMasterPattern(){var e,t,i,s,r,a,o,l,c,u,h,d,f,m,g,y,b,P,k,w,C,$,A,Q,q,W,U,Z,Y,ne,re,ve,Ce,De,Ue,Pt,yt,ue,Je,he,Et,Ze,me,Ye,xt,ai,Tn,Nt,mn,ot,en,Jn,Qi,ds,Ri,Ps,Li,Ii,oi,In;if(this.masterOnlyPlayback)return this._playMasterPatternSimple();try{if(console.log("▶️ Playing master pattern..."),this.masterActive=!0,console.log("🎚️ masterActive set to TRUE before pattern evaluation"),console.log("🔍 PRE-PLAY: Verifying audio routing hijacking is active..."),console.log("   AudioNode.prototype.__originalConnect exists:",!!AudioNode.prototype.__originalConnect),console.log("   AudioNode.prototype.connect is patched:",AudioNode.prototype.connect!==AudioNode.prototype.__originalConnect),console.log("   masterActive:",this.masterActive),console.log("   trackedPatterns.size:",this.trackedPatterns.size),console.log("   masterPanNode exists:",!!this.masterPanNode),console.log("   masterGainNode exists:",!!this.masterGainNode),this.masterGainNode&&this.masterGainNode.gain.setValueAtTime(this.masterVolume,((e=this.audioContext)==null?void 0:e.currentTime)||0),(!this.audioContext||this.audioContext.state==="suspended")&&await this.initialize(),this.strudelLoaded||(console.log("⏳ Waiting for Strudel to initialize..."),await this.initStrudel()),this._ensureMasterPatternSanitized(),this.setupVisualizerAnalyser(),!this.masterPattern||this.masterPattern.trim()==="")return console.log("⚠️ No master pattern to play"),this.masterActive=!1,{success:!1,error:"No pattern to play"};if(this.audioContext&&this.audioContext.state==="suspended"){console.log("🔊 Audio context suspended, resuming...");try{await this.audioContext.resume(),console.log(`✅ Audio context resumed, state: ${this.audioContext.state}`)}catch(Se){console.warn("⚠️ Could not resume audio context:",Se)}}if(window.strudel&&window.strudel.evaluate){let Se=this.masterPattern.trim();if(!Se||Se==="")return console.error("❌ Master pattern is empty, cannot evaluate"),{success:!1,error:"Master pattern is empty"};console.log("🎼 Master pattern before processing:",Se.substring(0,200)),Se=yu(Se),Se=this.applyVisualizerTargetsToPattern(Se),console.log("🎼 Master pattern after visualizer injection:",Se.substring(0,200)),await this.ensureStrudelWorkletsReady(Se);const Zt=Se.match(/\.bank\(["']([^"']+)["']\)/g);if(Zt&&typeof this.loadBank=="function"){const K=[...new Set(Zt.map(te=>{const H=te.match(/\.bank\(["']([^"']+)["']\)/);return H?H[1]:null}).filter(Boolean))];for(const te of K)if(!this.loadedBanks.has(te))try{console.log(`🎚️ Master: ensuring bank "${te}" is loaded before playback`),await this.loadBank(te)?(this.loadedBanks.add(te),console.log(`✅ Master: bank "${te}" loaded`)):console.warn(`⚠️ Master: bank "${te}" could not be loaded (continuing anyway)`)}catch(H){console.warn(`⚠️ Master: error loading bank "${te}":`,H)}}await this.ensurePatternResourcesLoaded(Se),Se=Se.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\n\s*\n/g,`
`).trim();const Ne=Se;Se=Se.replace(/[""]/g,'"').replace(/['']/g,"'"),Ne!==Se&&(console.log("🔧 Normalized quotes in master pattern"),console.log(`  Before: ${Ne.substring(0,100)}...`),console.log(`  After:  ${Se.substring(0,100)}...`)),!Se.includes(".loop(")&&!Se.includes(".loop()")&&(Se=`${Se}.loop()`,console.log("🔄 Added .loop() to master pattern for continuous playback")),this.masterActive=!0,console.log("🎚️ masterActive set to TRUE before pattern evaluation"),this._masterDestinationConnectLogged=!1,this._singleElementMasterRoutingLogged=!1,this._noElementRoutingLogged=!1,this._nodeTypeConnectLogged=new Set,this._stackMasterRoutingLogged=!1,this._masterRoutingLogged=!1,this._panNodeConnectedToMaster=new Set,this._gainConnectDebugged=!1,this._stackElementRoutingLogged=new Set,this._chainVerificationLogged=new Set,this._connectionSuccessLogged=new Set,this._allConnectionsLogged=new Set,this._allDestConnectionsLogged=new Set,this._panNodeConnectedLogged=new Set,this._panNodeNotConnectedLogged=new Set,this._panNodeConnectionErrorLogged=new Set,this._masterGainDestVerifiedAfterRouting=new Set,this._masterGainDestVerified=!1,this._stackConnectionCount&&this._stackConnectionCount.set("total",0);const bt=this.masterSlot;this.currentEvaluatingSlot=bt,console.log(`🎚️ Master stack evaluation slot: ${bt}`),console.log(`🔧 Ensuring audio nodes exist for ${this.trackedPatterns.size} tracked elements...`);for(const[K]of this.trackedPatterns.entries()){const te=this.getElementAudioNodes(K);if(te){const H=this.elementGainValues.get(K)||.8;te.gainNode.gain.value=H*this.volume;let ce=[];ce.push(`gainNode: gain=${te.gainNode.gain.value.toFixed(3)}`),ce.push(`panNode: pan=${te.panNode.pan.value.toFixed(3)}`),console.log(`  ✅ ${K}: ${ce.join(", ")}`)}else console.warn(`  ⚠️ ${K}: Failed to create audio nodes`)}if(this.visualizerAnalyser&&this.masterGainNode){try{this.masterGainNode.disconnect(this.visualizerAnalyser)}catch{}try{this.masterGainNode.connect(this.visualizerAnalyser),console.log("✅ Reconnected visualizer analyser to master gain node")}catch(K){console.warn("⚠️ Could not reconnect visualizer analyser:",K)}}if(window.strudel&&window.strudel.scheduler&&!window.strudel.scheduler.started){console.log("▶️ Starting Strudel scheduler BEFORE pattern evaluation..."),await window.strudel.scheduler.start(),console.log("✅ Strudel scheduler started");const K=window.strudel.scheduler;console.log("🔍 POST-START: Checking scheduler for webaudio output..."),console.log(`   scheduler keys: ${Object.keys(K).slice(0,15).join(", ")}`);let te=K.webaudio||K._webaudio;if(!te&&window.strudel.webaudio&&(te=window.strudel.webaudio,console.log("   ✅ Found webaudio in window.strudel.webaudio")),te){console.log(`   ✅ Found webaudio, keys: ${Object.keys(te).slice(0,10).join(", ")}`);const H=te.output||te.outputNode;if(H){if(console.log(`   ✅ Found output node: ${H.constructor.name}`),this.trackedPatterns.size>0){const ce=Array.from(this.trackedPatterns.keys())[0],p=this.getElementAudioNodes(ce);if(p!=null&&p.gainNode)try{H.disconnect(),H.connect(p.gainNode),console.log(`   ✅ Routed webaudio output to ${ce} gainNode`)}catch(S){console.log(`   ✅ webaudio output already routed (${S.message})`)}}else if(this.masterPanNode)try{H.disconnect(),H.connect(this.masterPanNode),console.log("   ✅ Routed webaudio output to masterPanNode (fallback)")}catch(ce){console.log(`   ✅ webaudio output already routed to master (${ce.message})`)}}else console.log("   ⚠️ webaudio found but no output node")}else console.log("   ⚠️ No webaudio found in scheduler or window.strudel");if(K.superdough){const H=K.superdough;console.log(`   ✅ Found superdough, keys: ${Object.keys(H).slice(0,20).join(", ")}`),H.audioContext&&(console.log(`   🔍 superdough.audioContext: ${H.audioContext===this.audioContext?"OUR CONTEXT ✅":"DIFFERENT CONTEXT ⚠️"}`),console.log(`   🔍 superdough.audioContext.state: ${H.audioContext.state}`));const ce=["output","outputNode","_output","destination","_destination","gain","masterGain"];for(const p of ce)if(H[p]&&H[p]instanceof AudioNode){if(console.log(`   ✅ Found AudioNode at superdough.${p}: ${H[p].constructor.name}`),this.trackedPatterns.size>0){const S=Array.from(this.trackedPatterns.keys())[0],v=this.getElementAudioNodes(S);if(v!=null&&v.gainNode)try{H[p].disconnect(),H[p].connect(v.gainNode),console.log(`   ✅ Routed superdough.${p} to ${S} gainNode`)}catch(x){console.log(`   ✅ superdough.${p} already routed (${x.message})`)}}else if(this.masterPanNode)try{H[p].disconnect(),H[p].connect(this.masterPanNode),console.log(`   ✅ Routed superdough.${p} to masterPanNode`)}catch(S){console.log(`   ✅ superdough.${p} already routed to master (${S.message})`)}}}}else if(window.strudel&&window.strudel.scheduler&&window.strudel.scheduler.started){console.log("✅ Strudel scheduler already running");const K=window.strudel.scheduler;console.log("🔍 ALREADY-RUNNING: Checking scheduler for webaudio output..."),console.log(`   scheduler keys: ${Object.keys(K).slice(0,15).join(", ")}`);const te=K.webaudio||K._webaudio;if(te){console.log(`   ✅ Found webaudio, keys: ${Object.keys(te).slice(0,10).join(", ")}`);const H=te.output||te.outputNode;if(H){if(console.log(`   ✅ Found output node: ${H.constructor.name}`),this.trackedPatterns.size>0){const ce=Array.from(this.trackedPatterns.keys())[0],p=this.getElementAudioNodes(ce);if(p!=null&&p.gainNode)try{H.disconnect(),H.connect(p.gainNode),console.log(`   ✅ Routed webaudio output to ${ce} gainNode`)}catch(S){console.log(`   ✅ webaudio output already routed (${S.message})`)}}else if(this.masterPanNode)try{H.disconnect(),H.connect(this.masterPanNode),console.log("   ✅ Routed webaudio output to masterPanNode (fallback)")}catch(ce){console.log(`   ✅ webaudio output already routed to master (${ce.message})`)}}else console.log("   ⚠️ webaudio found but no output node")}else console.log("   ⚠️ No webaudio found in scheduler");if(K.superdough){const H=K.superdough;console.log(`   ✅ Found superdough, keys: ${Object.keys(H).slice(0,20).join(", ")}`),H.audioContext&&(console.log(`   🔍 superdough.audioContext: ${H.audioContext===this.audioContext?"OUR CONTEXT ✅":"DIFFERENT CONTEXT ⚠️"}`),console.log(`   🔍 superdough.audioContext.state: ${H.audioContext.state}`));const ce=["output","outputNode","_output","destination","_destination","gain","masterGain"];for(const p of ce)if(H[p]&&H[p]instanceof AudioNode){if(console.log(`   ✅ Found AudioNode at superdough.${p}: ${H[p].constructor.name}`),this.trackedPatterns.size>0){const S=Array.from(this.trackedPatterns.keys())[0],v=this.getElementAudioNodes(S);if(v!=null&&v.gainNode)try{H[p].disconnect(),H[p].connect(v.gainNode),console.log(`   ✅ Routed superdough.${p} to ${S} gainNode`)}catch(x){console.log(`   ✅ superdough.${p} already routed (${x.message})`)}}else if(this.masterPanNode)try{H[p].disconnect(),H[p].connect(this.masterPanNode),console.log(`   ✅ Routed superdough.${p} to masterPanNode`)}catch(S){console.log(`   ✅ superdough.${p} already routed to master (${S.message})`)}}}else console.log("   ⚠️ No superdough found in scheduler")}const et=`${bt} = ${Se}`;console.log("🎼 Evaluating master pattern:"),console.log(`   Full code: ${et}`),console.log(`   Code length: ${et.length} characters`),console.log(`   Evaluation slot: ${bt}`);const ei=((t=window.strudel)==null?void 0:t.repl)||window.strudel;if((i=ei==null?void 0:ei.scheduler)!=null&&i.superdough){const K=ei.scheduler.superdough;if(K.audioWorkletsLoaded===!1||K.audioWorkletsLoaded===void 0){console.log("⏳ Waiting for AudioWorklets to load...");let te=0;for(;(K.audioWorkletsLoaded===!1||K.audioWorkletsLoaded===void 0)&&te<50;)await new Promise(H=>setTimeout(H,100)),te++;K.audioWorkletsLoaded===!0?console.log(`✅ AudioWorklets loaded after ${te*100}ms`):console.warn(`⚠️ AudioWorklets may not be loaded after ${te*100}ms - proceeding anyway`)}else console.log("✅ AudioWorklets already loaded")}const xs=/\.scope\s*\(/.test(et),gn=/\.spectrum\s*\(/.test(et),li=/\.spiral\s*\(/.test(et),Vn=/\._?pianoroll\s*\(/.test(et),Mt=/\._?barchart\s*\(/.test(et);if(xs||gn||li||Vn||Mt){console.log(`   📊 Visualizer methods detected: scope=${xs}, spectrum=${gn}, spiral=${li}, pianoroll=${Vn}, barchart=${Mt}`);const K=/master-punchcard-canvas/.test(et);console.log(`   🎯 Canvas ID present in pattern: ${K}`);const te=et.match(/\.scope\([^)]*\)/),H=et.match(/\.spectrum\([^)]*\)/),ce=et.match(/\.spiral\([^)]*\)/),p=et.match(/\._?pianoroll\([^)]*\)/),S=et.match(/\._?barchart\([^)]*\)/);te&&console.log(`   📊 Scope call: ${te[0]}`),H&&console.log(`   📊 Spectrum call: ${H[0]}`),ce&&console.log(`   📊 Spiral call: ${ce[0]}`),p&&console.log(`   📊 Pianoroll call: ${p[0]}`),S&&console.log(`   📊 Barchart call: ${S[0]}`)}let Vi;try{Vi=await window.strudel.evaluate(et),console.log(`✅ Master pattern evaluated successfully, result type: ${typeof Vi}`)}catch(K){console.warn("⚠️ Pattern evaluation warning:",K.message),console.warn(`⚠️ Pattern code that failed: ${et.substring(0,300)}`)}try{const K=(s=window.strudel)==null?void 0:s.scheduler,te=globalThis==null?void 0:globalThis[bt];if(K&&te){console.log("🔍 PRE-PATTERN-SET: Checking scheduler state..."),console.log(`   scheduler.started: ${K.started}`),console.log(`   scheduler.pattern: ${K.pattern?"exists":"null"}`),console.log(`   scheduler keys before: ${Object.keys(K).slice(0,15).join(", ")}`);const H=["webaudio","_webaudio","superdough","_superdough","output","outputNode","audioContext"];for(const ce of H)K[ce]&&(console.log(`   ✅ Found ${ce} in scheduler: ${typeof K[ce]}`),K[ce]instanceof AudioNode&&console.log(`      → AudioNode: ${K[ce].constructor.name}`));try{K.pattern=te,console.log(`🎚️ Scheduler pattern set directly to ${bt}`),console.log("🔍 POST-PATTERN-SET: Checking scheduler state after pattern assignment..."),console.log(`   scheduler.pattern: ${K.pattern?"exists":"null"}`),await new Promise(ce=>setTimeout(ce,100));for(const ce of H)if(K[ce]&&!K[`_checked_${ce}`]){if(console.log(`   ✅ Found ${ce} after pattern set: ${typeof K[ce]}`),K[ce]instanceof AudioNode&&(console.log(`      → AudioNode: ${K[ce].constructor.name}`),this.trackedPatterns.size>0)){const p=Array.from(this.trackedPatterns.keys())[0],S=this.getElementAudioNodes(p);if(S!=null&&S.gainNode)try{K[ce].disconnect(),K[ce].connect(S.gainNode),console.log(`      ✅ Routed scheduler.${ce} to ${p} gainNode`)}catch(v){console.log(`      ✅ scheduler.${ce} already routed (${v.message})`)}}K[`_checked_${ce}`]=!0}}catch{await window.strudel.evaluate(`pattern = ${bt}`),console.log(`🎚️ Scheduler pattern set via REPL to ${bt}`)}}else console.log("ℹ️ Could not set scheduler pattern directly (scheduler/slot missing)")}catch(K){console.warn(`⚠️ Failed to set scheduler pattern to ${bt}:`,(K==null?void 0:K.message)||K)}console.log(`🔍 POST-EVALUATION: trackedPatterns.size=${this.trackedPatterns.size}`),console.log("🔍 POST-EVALUATION: Searching for audio nodes connected to destination...");try{if(this._realDestination&&this._realDestination._inputs){const K=this._realDestination._inputs;console.log(`   Found ${K.length} input(s) to destination`);for(let te=0;te<K.length;te++){const H=K[te];if(H&&H._node){const ce=H._node;if(console.log(`   Input ${te}: ${ce.constructor.name}`),this.trackedPatterns.size>0){const p=Array.from(this.trackedPatterns.keys())[0],S=this.getElementAudioNodes(p);if(S!=null&&S.gainNode)try{ce.disconnect(this._realDestination),ce.connect(S.gainNode),console.log(`   ✅ Rerouted ${ce.constructor.name} through ${p} gainNode`)}catch(v){console.log(`   ⚠️ Could not reroute ${ce.constructor.name}: ${v.message}`)}}}}}else console.log("   ⚠️ Cannot access destination inputs (might be browser-specific)")}catch(K){console.log(`   ⚠️ Error checking destination inputs: ${K.message}`)}if(console.log(`🔍 POST-EVALUATION: Audio context state=${((r=this.audioContext)==null?void 0:r.state)||"unknown"}`),console.log(`🔍 POST-EVALUATION: masterGainNode.gain=${((l=(o=(a=this.masterGainNode)==null?void 0:a.gain)==null?void 0:o.value)==null?void 0:l.toFixed(3))||"N/A"}, muted=${this.masterMuted}`),console.log(`🔍 POST-EVALUATION: masterVolume=${this.masterVolume}, volume=${this.volume}`),this.trackedPatterns.size>=1){const K=Array.from(this.trackedPatterns.keys());console.log(`🔍 POST-EVALUATION: elementIds=${K.join(", ")}`);for(const te of K){const H=this.elementGainValues.get(te)||.8,ce=this.getElementAudioNodes(te),p=((u=(c=ce==null?void 0:ce.gainNode)==null?void 0:c.gain)==null?void 0:u.value)||0;console.log(`🔍 POST-EVALUATION: ${te} - storedGain=${H.toFixed(3)}, actualGain=${p.toFixed(3)}, volume=${this.volume.toFixed(3)}, totalGain=${(p*((d=(h=this.masterGainNode)==null?void 0:h.gain)==null?void 0:d.value)||0).toFixed(3)}`)}try{const te=((f=window.strudel)==null?void 0:f.repl)||window.strudel;if(te!=null&&te.scheduler){const H=te.scheduler;console.log("🔍 POST-EVALUATION: Exploring scheduler object..."),console.log(`   scheduler keys: ${Object.keys(H).slice(0,20).join(", ")}`);let ce=H.webaudio||H._webaudio,p=null;if(ce)p=ce.output||ce.outputNode,console.log(`🔍 POST-EVALUATION: Found webaudio, outputNode=${p?p.constructor.name:"null"}`);else{console.log("🔍 POST-EVALUATION: webaudio not found, searching scheduler for output node...");for(const S of Object.keys(H)){const v=H[S];if(v&&typeof v=="object"){if(v.output&&v.output instanceof AudioNode){console.log(`🔍 POST-EVALUATION: Found output node in scheduler.${S}.output`),p=v.output;break}if(v.outputNode&&v.outputNode instanceof AudioNode){console.log(`🔍 POST-EVALUATION: Found output node in scheduler.${S}.outputNode`),p=v.outputNode;break}}}}console.log(`🎚️ 🔍 POST-EVALUATION: Final outputNode=${p?p.constructor.name:"null"}`);for(const S of K){const v=this.getElementAudioNodes(S);if(console.log(`🎚️ 🔍 POST-EVALUATION: ${S}: elementNodes=${!!v}, gainNode=${!!(v!=null&&v.gainNode)}`),v&&v.gainNode){if(p)try{p.disconnect(),p.connect(v.gainNode),console.log(`🎚️ ✅ POST-EVALUATION: Reconnected Strudel output -> ${S} gainNode`)}catch(F){console.warn(`⚠️ POST-EVALUATION: Could not reconnect Strudel output: ${F.message}`)}else console.warn("⚠️ POST-EVALUATION: Output node not found - audio may not route through element chain");const x=v.panNode;if(x&&this.masterPanNode)try{try{x.disconnect(this.masterPanNode)}catch{}x.connect(this.masterPanNode),console.log(`🎚️ ✅ POST-EVALUATION: Verified ${S} panNode -> masterPanNode`)}catch(F){console.warn(`⚠️ POST-EVALUATION: Could not verify panNode: ${F.message}`)}}}if(this.masterGainNode&&this._realDestination)try{this.masterGainNode.connect(this._realDestination),console.log(`🎚️ ✅ POST-EVALUATION: Verified masterGainNode -> destination (gain=${this.masterGainNode.gain.value.toFixed(3)}, muted=${this.masterMuted})`)}catch(S){S.message.includes("already connected")||S.message.includes("already been connected")?console.log(`🎚️ ✅ POST-EVALUATION: masterGainNode -> destination already connected (gain=${this.masterGainNode.gain.value.toFixed(3)}, muted=${this.masterMuted})`):console.warn(`⚠️ POST-EVALUATION: Could not verify masterGainNode -> destination: ${S.message}`)}}else console.warn("⚠️ POST-EVALUATION: Could not find scheduler")}catch(te){console.warn(`⚠️ POST-EVALUATION: Error reconnecting Strudel output: ${te.message}`)}}if(setTimeout(()=>{this.currentEvaluatingSlot===this.masterSlot&&(this.currentEvaluatingSlot=null)},this.soundsPreloaded?100:500),this.trackedPatterns.size===1){const K=Array.from(this.trackedPatterns.keys())[0],te=this.getElementAudioNodes(K);console.log(`🔍 AUDIO CHAIN VERIFICATION for ${K}:`),console.log("   📊 AUDIO ROUTING CHAIN (simplified, no masterAnalyser):"),console.log(`      1. Strudel output -> elementGainNode (gain=${((y=(g=(m=te==null?void 0:te.gainNode)==null?void 0:m.gain)==null?void 0:g.value)==null?void 0:y.toFixed(3))||"N/A"})`),console.log(`      2. elementGainNode -> elementPanNode (pan=${((k=(P=(b=te==null?void 0:te.panNode)==null?void 0:b.pan)==null?void 0:P.value)==null?void 0:k.toFixed(3))||"N/A"})`),console.log("      3. elementPanNode -> masterPanNode"),console.log(`      4. masterPanNode -> masterGainNode (gain=${(($=(C=(w=this.masterGainNode)==null?void 0:w.gain)==null?void 0:C.value)==null?void 0:$.toFixed(3))||"N/A"}, muted=${this.masterMuted})`),console.log("      5. masterGainNode -> destination (audio output)"),console.log("      6. masterGainNode -> visualizerAnalyser (parallel, for visualization)"),console.log("   ✅ SIMPLIFIED CHAIN: element gain -> element pan -> master pan -> master gain -> destination"),console.log(`   elementGainNode: ${te!=null&&te.gainNode?"EXISTS":"MISSING"} (gain=${((q=(Q=(A=te==null?void 0:te.gainNode)==null?void 0:A.gain)==null?void 0:Q.value)==null?void 0:q.toFixed(3))||"N/A"})`),console.log(`   elementPanNode: ${te!=null&&te.panNode?"EXISTS":"MISSING"} (pan=${((Z=(U=(W=te==null?void 0:te.panNode)==null?void 0:W.pan)==null?void 0:U.value)==null?void 0:Z.toFixed(3))||"N/A"})`),console.log(`   masterPanNode: ${this.masterPanNode?"EXISTS":"MISSING"}`),console.log(`   masterGainNode: ${this.masterGainNode?"EXISTS":"MISSING"} (gain=${((re=(ne=(Y=this.masterGainNode)==null?void 0:Y.gain)==null?void 0:ne.value)==null?void 0:re.toFixed(3))||"N/A"}, muted=${this.masterMuted})`),console.log(`   visualizerAnalyser: ${this.visualizerAnalyser?"EXISTS":"MISSING"}`),console.log(`   destination: ${this._realDestination?"EXISTS":"MISSING"}`),console.log(`   TOTAL GAIN: ${((((Ce=(ve=te==null?void 0:te.gainNode)==null?void 0:ve.gain)==null?void 0:Ce.value)||0)*(((Ue=(De=this.masterGainNode)==null?void 0:De.gain)==null?void 0:Ue.value)||0)).toFixed(3)} (element=${((ue=(yt=(Pt=te==null?void 0:te.gainNode)==null?void 0:Pt.gain)==null?void 0:yt.value)==null?void 0:ue.toFixed(3))||"0"} * master=${((Et=(he=(Je=this.masterGainNode)==null?void 0:Je.gain)==null?void 0:he.value)==null?void 0:Et.toFixed(3))||"0"})`);try{const H=((Ze=window.strudel)==null?void 0:Ze.repl)||window.strudel;if(H!=null&&H.scheduler){const ce=H.scheduler,p=ce.webaudio||ce._webaudio;if(p){const S=p.output||p.outputNode;S?(console.log(`   Strudel outputNode: EXISTS (${S.constructor.name})`),te!=null&&te.gainNode&&console.log("   ✅ Chain should be: Strudel output -> elementGain -> elementPan -> masterPan -> masterGain -> destination")):console.warn("   ⚠️ Strudel outputNode: NOT FOUND")}else console.warn("   ⚠️ Strudel webaudio: NOT FOUND")}}catch(H){console.warn(`   ⚠️ Could not verify Strudel output: ${H.message}`)}if(console.log("   🔍 VERIFYING MASTER CHAIN:"),console.log(`      masterPanNode: ${this.masterPanNode?"EXISTS":"MISSING"}`),console.log(`      masterGainNode: ${this.masterGainNode?"EXISTS":"MISSING"} (gain=${((xt=(Ye=(me=this.masterGainNode)==null?void 0:me.gain)==null?void 0:Ye.value)==null?void 0:xt.toFixed(3))||"N/A"})`),console.log(`      destination: ${this._realDestination?"EXISTS":"MISSING"}`),this.masterPanNode&&this.masterGainNode)try{this.masterPanNode.connect(this.masterGainNode),console.log("   ✅ VERIFIED: masterPanNode -> masterGainNode")}catch(H){H.message.includes("already connected")||H.message.includes("already been connected")?console.log("   ✅ VERIFIED: masterPanNode -> masterGainNode (already connected)"):console.warn(`   ⚠️ Could not verify masterPanNode -> masterGainNode: ${H.message}`)}if(this.masterGainNode&&this._realDestination)try{this.masterGainNode.connect(this._realDestination),console.log("   ✅ CONNECTED: masterGainNode -> destination (CRITICAL for audio output)")}catch(H){if(H.message&&H.message.includes("already connected")||H.message.includes("InvalidStateError"))console.log("   ✅ VERIFIED: masterGainNode -> destination (already connected)");else try{this.masterGainNode.connect(this._realDestination),console.log("   ✅ RECONNECTED: masterGainNode -> destination")}catch(ce){ce.message.includes("already connected")||ce.message.includes("already been connected")?console.log("   ✅ VERIFIED: masterGainNode -> destination (already connected)"):console.error(`   ❌ FAILED: Could not connect masterGainNode -> destination: ${ce.message}`)}}else console.warn(`   ⚠️ Cannot verify masterGainNode->destination: masterGainNode=${!!this.masterGainNode}, destination=${!!this._realDestination}`)}if(console.log("🔍 FINAL CHAIN VERIFICATION:"),this.trackedPatterns.size>0){const K=Array.from(this.trackedPatterns.keys());for(const te of K){const H=this.getElementAudioNodes(te);console.log(`   ${te}:`),console.log(`      elementGain: ${H!=null&&H.gainNode?"EXISTS":"MISSING"} (gain=${((Nt=(Tn=(ai=H==null?void 0:H.gainNode)==null?void 0:ai.gain)==null?void 0:Tn.value)==null?void 0:Nt.toFixed(3))||"N/A"})`),console.log(`      elementPan: ${H!=null&&H.panNode?"EXISTS":"MISSING"} (pan=${((en=(ot=(mn=H==null?void 0:H.panNode)==null?void 0:mn.pan)==null?void 0:ot.value)==null?void 0:en.toFixed(3))||"N/A"})`)}}if(console.log(`   masterPanNode: ${this.masterPanNode?"EXISTS":"MISSING"}`),console.log(`   masterGainNode: ${this.masterGainNode?"EXISTS":"MISSING"} (gain=${((ds=(Qi=(Jn=this.masterGainNode)==null?void 0:Jn.gain)==null?void 0:Qi.value)==null?void 0:ds.toFixed(3))||"N/A"}, muted=${this.masterMuted})`),console.log(`   visualizerAnalyser: ${this.visualizerAnalyser?"EXISTS":"MISSING"}`),console.log(`   destination: ${this._realDestination?"EXISTS":"MISSING"}`),this.masterPanNode&&this.masterGainNode)try{this.masterPanNode.connect(this.masterGainNode),console.log("   ✅ VERIFIED: masterPanNode -> masterGainNode (reconnected)")}catch(K){K.message.includes("already connected")||K.message.includes("already been connected")?console.log("   ✅ VERIFIED: masterPanNode -> masterGainNode (already connected)"):console.warn(`   ⚠️ Could not verify masterPanNode -> masterGainNode: ${K.message}`)}if(this.masterGainNode&&this._realDestination)try{this.masterGainNode.connect(this._realDestination),console.log(`   ✅ VERIFIED: masterGainNode -> destination (reconnected, gain=${this.masterGainNode.gain.value.toFixed(3)})`)}catch(K){K.message.includes("already connected")||K.message.includes("already been connected")?console.log(`   ✅ VERIFIED: masterGainNode -> destination (already connected, gain=${this.masterGainNode.gain.value.toFixed(3)})`):console.warn(`   ⚠️ Could not verify masterGainNode -> destination: ${K.message}`)}console.log("   🔍 FINAL: Searching for Strudel output node...");try{const K=((Ri=window.strudel)==null?void 0:Ri.repl)||window.strudel;if(console.log(`   🔍 FINAL: replInstance=${!!K}`),K!=null&&K.scheduler){const te=K.scheduler;console.log(`   🔍 FINAL: scheduler=${!!te}, keys=${Object.keys(te).slice(0,10).join(", ")}`);let H=null,ce=null;const p=te.webaudio||te._webaudio;if(p&&(H=p.output||p.outputNode,H&&(ce="scheduler.webaudio")),!H&&te.superdough){const S=te.superdough;if(console.log(`   🔍 FINAL: superdough found, keys=${Object.keys(S).slice(0,20).join(", ")}`),H=S.output||S.outputNode||S._output||S.destination||S._destination,H&&(ce="scheduler.superdough"),!H&&S.webaudio&&(console.log(`   🔍 FINAL: superdough.webaudio found, keys=${Object.keys(S.webaudio).slice(0,10).join(", ")}`),H=S.webaudio.output||S.webaudio.outputNode||S.webaudio.destination,H&&(ce="scheduler.superdough.webaudio")),!H&&S.audioContext&&console.log("   🔍 FINAL: superdough.audioContext found"),!H)for(const v of Object.keys(S)){const x=S[v];if(x&&typeof x=="object"&&(((Ps=x.constructor)==null?void 0:Ps.name)==="GainNode"||((Li=x.constructor)==null?void 0:Li.name)==="AudioNode"||x instanceof AudioNode)){console.log(`   🔍 FINAL: Found potential output node at superdough.${v} (${x.constructor.name})`),H=x,ce=`scheduler.superdough.${v}`;break}}}if(!H&&te._superdough){const S=te._superdough;H=S.output||S.outputNode||S._output,H&&(ce="scheduler._superdough")}if(console.log(`   🔍 FINAL: outputNode=${H?H.constructor.name:"null"}, source=${ce||"not found"}`),H&&this.trackedPatterns.size>0){const S=Array.from(this.trackedPatterns.keys())[0],v=this.getElementAudioNodes(S);if(console.log(`   🔍 FINAL: ${S}, elementNodes=${!!v}, gainNode=${!!(v!=null&&v.gainNode)}`),v!=null&&v.gainNode)try{H.disconnect(),H.connect(v.gainNode),console.log(`   ✅ FINAL: Reconnected Strudel output (${ce}) -> ${S} gainNode (THIS IS CRITICAL FOR AUDIO)`)}catch(x){console.log(`   ✅ FINAL: Strudel output already routed to ${S} gainNode (${x.message})`)}else console.error("   ❌ FINAL: Cannot reconnect - elementNodes or gainNode missing!")}else if(console.warn(`   ⚠️ FINAL: Cannot reconnect - outputNode=${!!H}, trackedPatterns.size=${this.trackedPatterns.size}`),!H&&(console.warn("   ⚠️ FINAL: Strudel output node not found in any expected location."),console.warn("   ⚠️ FINAL: This might mean Strudel creates audio nodes dynamically. Audio routing hijacking should catch connections."),console.warn('   ⚠️ FINAL: If you see "DESTINATION CONNECTION" logs, the hijacking is working. If not, Strudel might be using a different routing mechanism.'),console.log("   🔧 FINAL: Ensuring master chain is connected (fallback for dynamic audio nodes)..."),this.masterPanNode&&this.masterGainNode&&this._realDestination))try{this.masterGainNode.connect(this._realDestination),console.log(`   ✅ FINAL: Master chain verified and connected (gain=${this.masterGainNode.gain.value.toFixed(3)})`)}catch(S){console.log(`   ✅ FINAL: Master chain already connected (${S.message})`)}}else console.warn("   ⚠️ FINAL: scheduler not found in replInstance")}catch(K){console.error(`   ❌ FINAL: Error reconnecting Strudel output: ${K.message}`),console.error(`   ❌ FINAL: Stack: ${K.stack}`)}const Cs=this.audioContext?this.audioContext.currentTime:performance.now()/1e3;this.masterPlaybackStartTime=Cs,this.masterPlaybackTempo=this.currentTempo||120;const St=this.masterPlaybackTempo/120;this.masterPlaybackSpeed=Number.isFinite(St)&&St>0?St:1,console.log(`✅ Master pattern playing on ${this.masterSlot} (volume/pan/mute via Web Audio API)`),console.log(`🔊 Audio context state: ${((Ii=this.audioContext)==null?void 0:Ii.state)||"unknown"}`),console.log(`🔊 Master gain value: ${((In=(oi=this.masterGainNode)==null?void 0:oi.gain)==null?void 0:In.value)||"unknown"}`),console.log(`🔊 Master muted: ${this.masterMuted||!1}`),console.log("ℹ️ Note: If you see createPeriodicWave errors, they are suppressed but may affect audio playback"),this._audioNodeMonitorInterval&&clearInterval(this._audioNodeMonitorInterval);let mt=0;const Ht=20;return this._audioNodeMonitorInterval=setInterval(()=>{var K;if(mt++,mt>Ht){clearInterval(this._audioNodeMonitorInterval),this._audioNodeMonitorInterval=null,console.log(`🔍 Audio node monitoring stopped after ${Ht} checks`);return}try{const te=(K=window.strudel)==null?void 0:K.scheduler;if(te){const H=["webaudio","_webaudio","superdough","_superdough","output","outputNode"];for(const ce of H)if(te[ce]&&!te[`_monitored_${ce}`]){if(console.log(`🔍 MONITOR: Found ${ce} in scheduler at check ${mt}: ${typeof te[ce]}`),te[ce]instanceof AudioNode&&(console.log(`   → AudioNode: ${te[ce].constructor.name}`),this.trackedPatterns.size>0)){const p=Array.from(this.trackedPatterns.keys())[0],S=this.getElementAudioNodes(p);if(S!=null&&S.gainNode)try{te[ce].disconnect(),te[ce].connect(S.gainNode),console.log(`   ✅ MONITOR: Routed scheduler.${ce} to ${p} gainNode`)}catch(v){console.log(`   ✅ MONITOR: scheduler.${ce} already routed (${v.message})`)}}te[`_monitored_${ce}`]=!0}if(te.superdough&&!te._monitored_superdough){const ce=te.superdough;console.log(`🔍 MONITOR: Found superdough at check ${mt}, keys: ${Object.keys(ce).slice(0,10).join(", ")}`);const p=["output","outputNode","_output","destination","_destination","gain","masterGain"];for(const S of p)if(ce[S]&&ce[S]instanceof AudioNode&&(console.log(`   → Found AudioNode at superdough.${S}: ${ce[S].constructor.name}`),this.trackedPatterns.size>0)){const v=Array.from(this.trackedPatterns.keys())[0],x=this.getElementAudioNodes(v);if(x!=null&&x.gainNode)try{ce[S].disconnect(),ce[S].connect(x.gainNode),console.log(`   ✅ MONITOR: Routed superdough.${S} to ${v} gainNode`)}catch(F){console.log(`   ✅ MONITOR: superdough.${S} already routed (${F.message})`)}}te._monitored_superdough=!0}}}catch(te){console.warn(`🔍 MONITOR: Error checking scheduler: ${te.message}`)}},100),this.audioContext&&this.audioContext.state==="suspended"&&(console.warn("⚠️ AUDIO CONTEXT SUSPENDED: Audio context is suspended - attempting to resume..."),this.audioContext.resume().then(()=>{console.log("✅ Audio context resumed successfully")}).catch(K=>{console.error(`❌ Failed to resume audio context: ${K.message}`)})),this._audioChainCheckInterval&&clearInterval(this._audioChainCheckInterval),this._zeroGainLogged=!1,this._mutedLogged=!1,this._audioChainCheckInterval=setInterval(()=>{if(this.masterActive&&this.masterGainNode&&this._realDestination){try{this.masterGainNode.connect(this._realDestination)}catch{}this.masterGainNode.gain.value===0&&!this._zeroGainLogged&&(console.warn("⚠️ AUDIO CHAIN CHECK: masterGainNode.gain.value is 0 - no audio will play!"),this._zeroGainLogged=!0),this.masterMuted&&!this._mutedLogged&&(console.warn("⚠️ AUDIO CHAIN CHECK: masterGainNode is muted - no audio will play!"),this._mutedLogged=!0)}else this._audioChainCheckInterval&&(clearInterval(this._audioChainCheckInterval),this._audioChainCheckInterval=null)},1e3),this.onMasterStateChangeCallback&&this.onMasterStateChangeCallback(!0,Array.from(this.trackedPatterns.keys())),{success:!0}}else return console.error("❌ Strudel not properly initialized"),{success:!1,error:"Strudel not initialized"}}catch(Se){return console.error("❌ Error playing master pattern:",Se),{success:!1,error:Se.message}}}async _stopMasterPatternSimple(){var e;try{if(window.strudel&&typeof window.strudel.evaluate=="function"){const t=this.masterSlot||"d0";await window.strudel.evaluate(`${t} = silence`),window.strudel.scheduler&&window.strudel.scheduler.started&&typeof window.strudel.scheduler.stop=="function"&&await window.strudel.scheduler.stop()}return this.masterActive=!1,this.masterPlaybackStartTime=null,this.masterGainNode&&this.masterGainNode.gain.setValueAtTime(0,((e=this.audioContext)==null?void 0:e.currentTime)||0),this.onMasterStateChangeCallback&&this.onMasterStateChangeCallback(!1,[]),{success:!0}}catch(t){return console.error("❌ Error stopping master (simple mode):",t),{success:!1,error:t.message}}}async stopMasterPattern(){var e;if(this.masterOnlyPlayback)return this._stopMasterPatternSimple();try{if(console.log("⏹️ Stopping master pattern..."),window.strudel&&window.strudel.evaluate){window.strudel.repl&&window.strudel.repl.scheduler&&typeof window.strudel.repl.scheduler.stop=="function"&&(window.strudel.repl.scheduler.stop(),console.log("✓ Stopped REPL scheduler"));const t=`${this.masterSlot} = silence`;return await window.strudel.evaluate(t),window.strudel.repl&&window.strudel.repl.scheduler&&typeof window.strudel.repl.scheduler.start=="function"&&(window.strudel.repl.scheduler.start(),console.log("✓ Restarted REPL scheduler")),this.masterPlaybackStartTime=null,this.masterActive=!1,this.masterGainNode&&this.masterGainNode.gain.setValueAtTime(0,((e=this.audioContext)==null?void 0:e.currentTime)||0),this._audioChainCheckInterval&&(clearInterval(this._audioChainCheckInterval),this._audioChainCheckInterval=null),console.log("✅ Master pattern stopped"),this._masterTapLogged=!1,this._masterTapSuccess=new Set,this.onMasterStateChangeCallback&&this.onMasterStateChangeCallback(!1,[]),{success:!0}}else return console.error("❌ Strudel not available"),{success:!1,error:"Strudel not available"}}catch(t){return console.error("❌ Error stopping master pattern:",t),{success:!1,error:t.message}}}getMasterPatternCode(){if(this.masterPattern&&this.masterPattern.trim()!==""){const e="// Controls Selected Tempo:";this.masterPattern.split(`
`).some(i=>i.trim().startsWith(e))||(this.masterPattern=this.formatMasterPatternWithTempoComment(this.masterPattern))}return this._ensureMasterPatternSanitized(),this.masterPattern}isMasterActive(){return!!this.masterActive}getMasterPlaybackInfo(){return{isPlaying:!!this.masterActive,startTime:this.masterPlaybackStartTime,speed:this.masterPlaybackSpeed||1,tempo:this.masterPlaybackTempo||this.currentTempo||120}}async setMasterPatternCode(e){try{if(console.log(`✏️ Setting master pattern code: ${e.substring(0,100)}...`),e&&e.trim()!==""?this.masterPattern=this.formatMasterPatternWithTempoComment(e):this.masterPattern="",this._ensureMasterPatternSanitized(),this.appInstance&&typeof this.appInstance.syncElementsFromMasterPattern=="function")try{this.appInstance.syncElementsFromMasterPattern(this.masterPattern)}catch(t){console.warn("⚠️ Failed to sync elements from master pattern:",t)}if(this.masterActive){console.log("🔄 Master is active - re-evaluating with updated pattern (no stop).");try{await this.playMasterPattern()}catch(t){console.warn("⚠️ Could not re-evaluate master after code update:",t.message)}}return{success:!0}}catch(t){return console.error("❌ Error setting master pattern code:",t),{success:!1,error:t.message}}}async previewPattern(e,t="preview",i=null){var s,r,a;if(this.masterOnlyPlayback)return console.log(`👀 Preview via master stack (${t})`),this.routePatternThroughMaster(t,e,{isPreview:!0,autoStart:!0});try{console.log(`👀 Previewing pattern (received): ${e.substring(0,100)}...`),console.log(`👀 Full pattern to preview: ${e}`);const o="d16";if(this.currentEvaluatingSlot=o,this.patternSlotToElementId.set(o,t),console.log(`🎵 Preview: Mapped slot ${o} to elementId ${t} for audio routing`),window.strudel&&window.strudel.evaluate)try{await window.strudel.evaluate(`${o} = silence`),console.log(`✅ Preview slot ${o} cleared`)}catch(u){console.warn("⚠️ Error clearing preview slot:",u.message)}if((!this.audioContext||this.audioContext.state==="suspended")&&await this.initialize(),this.audioContext&&this.audioContext.state==="suspended"){console.log("🔊 Audio context suspended for preview, resuming...");try{await this.audioContext.resume(),console.log(`✅ Audio context resumed for preview, state: ${this.audioContext.state}`)}catch(u){console.warn("⚠️ Could not resume audio context for preview:",u)}}const l=this.getElementAudioNodes(t);(!l||!l.gainNode)&&console.warn(`⚠️ Could not prepare audio nodes for preview element ${t}`),this.strudelLoaded||(console.log("⏳ Waiting for Strudel to initialize..."),await this.initStrudel()),await this.ensurePatternResourcesLoaded(e),console.log(`🔍 Preview - Original pattern: ${e}`),console.log(`🔍 Preview - Pattern type check: isNotePattern=${this.isNotePattern(e)}, contains s(${e.includes("s(")}, contains sound(${e.includes("sound(")}, contains note(${/\bnote\s*\(/i.test(e)})`);let c=await this.processPattern(e,t,{preserveBanks:!0,attemptBankLoad:!0,applyGainInPattern:!1});if(!c)return console.error("❌ Pattern processing failed for preview"),{success:!1,error:"Pattern processing failed"};if(console.log(`🔍 Preview - After processPattern: ${c}`),console.log(`🔍 Preview - Processed pattern type check: isNotePattern=${this.isNotePattern(c)}, contains s(${c.includes("s(")}, contains sound(${c.includes("sound(")}, contains note(${/\bnote\s*\(/i.test(c)})`),!c.includes(".loop(")&&!c.includes(".loop()")&&(c=`${c}.loop()`,console.log("🔄 Added .loop() to preview pattern for continuous playback")),window.strudel&&window.strudel.evaluate){const u=`${o} = ${c}`;console.log(`🎼 Preview evaluating: ${u.substring(0,300)}...`),console.log(`🔍 Preview - Full pattern code (${u.length} chars): ${u}`);const h=u.match(/\.s\(["']([^"']+)["']\)/),d=u.match(/\.sound\(["']([^"']+)["']\)/),f=d?d[1]:h?h[1]:"unknown";console.log(`🎵 Preview waveform: ${f}`);try{if(await window.strudel.evaluate(u),console.log("✅ Preview pattern evaluated successfully"),window.strudel.scheduler&&(window.strudel.scheduler.started?console.log("🔄 Scheduler already running, ensuring pattern is active..."):(console.log("▶️ Starting Strudel scheduler for preview..."),await window.strudel.scheduler.start())),this.soundsPreloaded)await new Promise(g=>setTimeout(g,50)),setTimeout(()=>{this.currentEvaluatingSlot===o&&(this.currentEvaluatingSlot=null)},500);else{if(window.strudel.scheduler&&window.strudel.scheduler.tick)try{for(let g=0;g<2;g++)window.strudel.scheduler.tick(),await new Promise(y=>setTimeout(y,10))}catch(g){console.warn("⚠️ Could not trigger scheduler tick:",g)}await new Promise(g=>setTimeout(g,200)),setTimeout(()=>{this.currentEvaluatingSlot===o&&(this.currentEvaluatingSlot=null)},1e3)}}catch(g){return console.error("❌ Preview pattern evaluation error:",g.message),console.error(`❌ Failed pattern code: ${u}`),{success:!1,error:g.message}}console.log(`✅ Preview pattern is playing on ${o}`),console.log(`🔊 Audio context state: ${((s=this.audioContext)==null?void 0:s.state)||"unknown"}`),console.log(`🔊 Master gain value: ${((a=(r=this.masterGainNode)==null?void 0:r.gain)==null?void 0:a.value)||"unknown"}`),console.log(`🔊 Master muted: ${this.masterMuted||!1}`);const m=c.includes(".s(")||c.includes(".sound(");return console.log(`🔍 Preview pattern waveform check: ${m?"Has waveform (.s() or .sound())":"No waveform found"}`),{success:!0,previewSlot:o}}else return console.error("❌ Strudel not properly initialized"),{success:!1,error:"Strudel not initialized"}}catch(o){return console.error("❌ Error previewing pattern:",o),{success:!1,error:o.message}}}async stopPreview(){if(this.masterOnlyPlayback){console.log("⏹️ Stopping preview routed through master");for(const e of this.previewElementIds)this.removeElementFromMaster(e);return this.previewElementIds.clear(),this.masterActive&&(!this.masterPattern||!this.masterPattern.trim())?await this.stopMasterPattern():this.masterActive&&await this.playMasterPattern(),{success:!0}}try{return console.log("⏹️ Stopping preview..."),window.strudel&&window.strudel.evaluate?(await window.strudel.evaluate("d16 = silence"),console.log("✅ Preview stopped"),{success:!0}):{success:!1,error:"Strudel not available"}}catch(e){return console.error("❌ Error stopping preview:",e),{success:!1,error:e.message}}}async exportAudioWAV(e=16,t=44100){try{if(console.log(`📦 Exporting master pattern as WAV (${e} seconds)...`),!this.masterPattern||this.masterPattern.trim()==="")return{success:!1,error:"No master pattern to export"};this.strudelLoaded||await this.initStrudel();const s=new OfflineAudioContext(2,t*e,t).destination;return window.strudel&&window.strudel.repl&&window.strudel.repl.audioContext?(console.log("⚠️ Using MediaRecorder fallback for audio export"),await this.exportAudioMediaRecorder(e)):await this.exportAudioMediaRecorder(e)}catch(i){return console.error("❌ Error exporting WAV:",i),{success:!1,error:i.message}}}async exportAudioMediaRecorder(e=16){return new Promise(t=>{try{if(!this.audioContext){t({success:!1,error:"Audio context not initialized"});return}if(!this.masterGainNode||!this.masterPanNode){t({success:!1,error:"Master audio nodes not found"});return}const i=this.audioContext.sampleRate,s=Math.floor(i*e),r=2,a=4096,o=[];let l=!1,c=null;try{c=this.audioContext.createScriptProcessor(a,r,r);let d=0;c.onaudioprocess=f=>{d++;const m=f.inputBuffer,g=f.outputBuffer;for(let k=0;k<r;k++){const w=m.getChannelData(k);g.getChannelData(k).set(w)}const y=Math.max(...Array.from(m.getChannelData(0).map(Math.abs)));if((d<=5||d%50===0)&&console.log(`🔍 ScriptProcessor call #${d}: max amplitude = ${y.toFixed(6)}, isRecording = ${l}`),!l)return;const b=[];for(let k=0;k<r;k++){const w=m.getChannelData(k);b.push(new Float32Array(w))}const P=Math.max(...b[0].map(Math.abs));P>1e-4?(o.length%10===0||o.length<5)&&console.log(`📦 Recording chunk ${o.length}: max amplitude = ${P.toFixed(6)}`):o.length<5&&console.log(`📦 Recording chunk ${o.length}: SILENT (max amplitude = ${P.toFixed(6)})`),o.push(b)},console.log("✅ ScriptProcessorNode created")}catch(d){console.error("❌ Failed to create ScriptProcessorNode:",d),t({success:!1,error:"ScriptProcessorNode not supported: "+d.message});return}const u=this.masterActive;console.log("▶️ Setting up recording..."),console.log("🔍 Pattern code:",this.masterPattern.substring(0,100)),console.log("🔍 Pattern already playing:",u);let h;u?(console.log("▶️ Pattern already playing, ensuring scheduler is running..."),h=Promise.resolve().then(async()=>(window.strudel&&window.strudel.scheduler&&!window.strudel.scheduler.started&&(console.log("▶️ Starting Strudel scheduler..."),await window.strudel.scheduler.start()),{success:!0}))):(console.log("▶️ Pattern not playing, starting it now..."),h=this.playMasterPattern()),h.then(()=>{setTimeout(()=>{console.log("🔧 Setting up recording routing..."),console.log("🔍 Master active:",this.masterActive),console.log("🔍 Audio context state:",this.audioContext.state);try{this.masterGainNode.disconnect(),console.log("✅ Disconnected all connections from masterGainNode")}catch(d){console.warn("⚠️ Could not disconnect all:",d);try{this.masterGainNode.disconnect(this._realDestination),console.log("✅ Disconnected masterGainNode from destination")}catch(f){console.warn("⚠️ Could not disconnect from destination:",f)}}this.masterGainNode.connect(c),c.connect(this._realDestination),console.log("✅ Connected audio routing: masterGainNode -> scriptProcessor -> destination"),console.log("🔍 Verifying connections:"),console.log("  masterGainNode numberOfOutputs:",this.masterGainNode.numberOfOutputs),console.log("  scriptProcessor inputs:",c.numberOfInputs,"outputs:",c.numberOfOutputs),console.log("  Waiting for audio to flow through scriptProcessor..."),setTimeout(()=>{console.log(`🎙️ Recording started for ${e} seconds...`),console.log("🔍 Master active:",this.masterActive),console.log("🔍 Audio context state:",this.audioContext.state),console.log("🔍 ScriptProcessor connected - waiting for audio chunks..."),l=!0,setTimeout(()=>{var A;console.log(`⏹️ Stopping recording after ${e} seconds...`),console.log(`📦 Total chunks captured: ${o.length}`),l=!1;try{try{c.disconnect(this._realDestination)}catch{}try{this.masterGainNode.disconnect(c)}catch{}try{this.masterGainNode.connect(this._realDestination)}catch{try{this.masterGainNode.disconnect(this._realDestination),this.masterGainNode.connect(this._realDestination)}catch(q){console.warn("Could not restore connection:",q)}}console.log("✅ Restored original audio routing: masterGainNode -> destination")}catch(Q){console.warn("Error restoring audio routing:",Q);try{this.masterGainNode.connect(this._realDestination)}catch(q){console.error("Failed to restore connection:",q)}}if(u?console.log("✅ Pattern was already playing, leaving it running"):this.stopMasterPattern(),o.length===0){console.error("❌ No audio data recorded"),console.error("🔍 Debug info:"),console.error("  Master active:",this.masterActive),console.error("  Audio context state:",this.audioContext.state),console.error("  Master gain node:",!!this.masterGainNode),console.error("  Master pan node:",!!this.masterPanNode),console.error("  Script processor:",!!c),console.error("  Is recording flag:",l),console.error("  Pattern code length:",((A=this.masterPattern)==null?void 0:A.length)||0),t({success:!1,error:"No audio data was recorded. ScriptProcessorNode may not be receiving audio. Check console for debug info."});return}console.log(`📦 Recorded ${o.length} chunks`);const d=o.reduce((Q,q)=>Q+q[0].length,0);console.log(`📦 Total samples: ${d} (expected: ~${s})`);const f=new Float32Array(d),m=new Float32Array(d);let g=0;for(const Q of o){const q=Q[0].length;f.set(Q[0],g),Q[1]?m.set(Q[1],g):m.set(Q[0],g),g+=q}let y=0,b=0;const P=Math.max(1,Math.floor(d/1e3));for(let Q=0;Q<d;Q+=P){const q=Math.abs(f[Q]),W=Math.abs(m[Q]),U=Math.max(q,W);y=Math.max(y,U),U>1e-4&&b++}console.log(`🔍 Audio analysis: max amplitude = ${y.toFixed(6)}, non-zero samples = ${b}`);const k=[],w=[];for(let Q=0;Q<Math.min(10,d);Q++)k.push(Math.abs(f[Q]));for(let Q=Math.max(0,d-10);Q<d;Q++)w.push(Math.abs(f[Q]));console.log(`🔍 First 10 samples: ${k.map(Q=>Q.toFixed(4)).join(", ")}`),console.log(`🔍 Last 10 samples: ${w.map(Q=>Q.toFixed(4)).join(", ")}`),y<1e-4&&(console.warn("⚠️ Audio appears to be silent (all zeros or very quiet)"),console.warn("⚠️ Master volume:",this.masterVolume),console.warn("⚠️ Master muted:",this.masterMuted),console.warn("⚠️ This might indicate that audio is not reaching masterPanNode"));const C=this.audioContext.createBuffer(r,d,i);C.getChannelData(0).set(f),C.getChannelData(1).set(m);const $=this.audioBufferToWAV(C);if(console.log(`✅ WAV blob created: ${$.size} bytes`),$.size===0){t({success:!1,error:"WAV blob is empty"});return}this.downloadBlob($,"master-pattern.wav","audio/wav"),y<1e-4?t({success:!0,format:"wav",warning:"Audio file created but appears to be silent. Check that the pattern is playing and master volume is not muted."}):t({success:!0,format:"wav"})},e*1e3)},200)},500)}).catch(d=>{console.error("❌ Failed to start pattern for recording:",d);try{this.masterGainNode.disconnect(c),c.disconnect(this._realDestination),this.masterGainNode.connect(this._realDestination)}catch{}t({success:!1,error:"Failed to start pattern: "+d.message})})}catch(i){console.error("❌ Error in audio export:",i),t({success:!1,error:i.message})}})}parsePatternToMIDI(e){const t=[];this.currentTempo;const a=16*480;let o=[e];if(e.includes("stack(")){const c=e.match(/stack\s*\(([^)]+)\)/);if(c){const u=c[1];o=this.splitStackPatterns(u)}}const l={bd:36,kick:36,kickdrum:36,sd:38,snare:38,snaredrum:38,hh:42,hihat:42,closedhihat:42,oh:46,openhihat:46,cr:49,crash:49,rd:51,ride:51,ht:48,hightom:48,mt:47,midtom:47,lt:45,lowtom:45,cp:39,clap:39,rim:37,rimshot:37};return o.forEach((c,u)=>{const h=/note\s*\(["']([^"']+)["']\)/g;let d;const f=[];for(;(d=h.exec(c))!==null;){const g=d[1].split(/\s+/).filter(y=>y.trim());f.push(...g)}if(f.length>0){const m=a/f.length;f.forEach((g,y)=>{const b=this.noteToMIDI(g);if(b!==null){const P=Math.round(y*m),k=Math.round(m*.8);t.push({type:"noteOn",tick:P,channel:u%16,note:b,velocity:100}),t.push({type:"noteOff",tick:P+k,channel:u%16,note:b,velocity:0})}})}else{const m=/(?:sound|s)\s*\(["']([^"']+)["']\)/g;let g;for(;(g=m.exec(c))!==null;){const b=g[1].split(/\s+/).filter(k=>k.trim()),P=a/b.length;b.forEach((k,w)=>{const C=l[k.toLowerCase()]||36,$=Math.round(w*P),A=Math.round(P*.3);t.push({type:"noteOn",tick:$,channel:9,note:C,velocity:100}),t.push({type:"noteOff",tick:$+A,channel:9,note:C,velocity:0})})}}}),t.sort((c,u)=>c.tick-u.tick),t}splitStackPatterns(e){const t=[];let i="",s=0;for(let r=0;r<e.length;r++){const a=e[r];a==="("?(s++,i+=a):a===")"?(s--,i+=a):a===","&&s===0?(t.push(i.trim()),i=""):i+=a}return i.trim()&&t.push(i.trim()),t}noteToMIDI(e){const t=e.match(/^([a-gA-G])([#b]?)(\d+)$/);if(!t)return null;const[,i,s,r]=t,o=["c","d","e","f","g","a","b"].indexOf(i.toLowerCase());if(o===-1)return null;let l=12+parseInt(r)*12+o;return s==="#"?l+=1:s==="b"&&(l-=1),Math.max(0,Math.min(127,l))}createMIDIFile(e){const t=this.currentTempo||120,i=new Uint8Array([77,84,104,100,0,0,0,6,0,1,0,1,1,224]),s=[],r=Math.round(6e7/t);s.push({deltaTime:0,type:255,metaType:81,data:[r>>16&255,r>>8&255,r&255]});let a=0;e.forEach(h=>{const d=h.tick-a;a=h.tick,h.type==="noteOn"?s.push({deltaTime:d,type:144|h.channel,data:[h.note,h.velocity]}):h.type==="noteOff"&&s.push({deltaTime:d,type:128|h.channel,data:[h.note,h.velocity]})}),s.push({deltaTime:0,type:255,metaType:47,data:[]});const o=[];s.forEach(h=>{let d=h.deltaTime;const f=[];do{let m=d&127;d>>=7,f.length>0&&(m|=128),f.push(m)}while(d>0);o.push(...f),o.push(h.type),h.metaType!==void 0&&(o.push(h.metaType),o.push(h.data.length)),o.push(...h.data)});const l=o.length,c=new Uint8Array([77,84,114,107,l>>24&255,l>>16&255,l>>8&255,l&255,...o]),u=new Uint8Array(i.length+c.length);return u.set(i,0),u.set(c,i.length),new Blob([u],{type:"audio/midi"})}downloadBlob(e,t,i){const s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download=t,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}async blobToAudioBuffer(e){const t=await e.arrayBuffer();return await this.audioContext.decodeAudioData(t)}audioBufferToWAV(e){const t=e.numberOfChannels,i=e.sampleRate,s=1,r=16,a=r/8,o=t*a,l=i*o,c=e.length*o,u=44+c,h=new ArrayBuffer(u),d=new DataView(h),f=(y,b)=>{for(let P=0;P<b.length;P++)d.setUint8(y+P,b.charCodeAt(P))};f(0,"RIFF"),d.setUint32(4,u-8,!0),f(8,"WAVE"),f(12,"fmt "),d.setUint32(16,16,!0),d.setUint16(20,s,!0),d.setUint16(22,t,!0),d.setUint32(24,i,!0),d.setUint32(28,l,!0),d.setUint16(32,o,!0),d.setUint16(34,r,!0),f(36,"data"),d.setUint32(40,c,!0);let m=44;const g=[];for(let y=0;y<t;y++)g.push(e.getChannelData(y));for(let y=0;y<e.length;y++)for(let b=0;b<t;b++){const P=Math.max(-1,Math.min(1,g[b][y]));d.setInt16(m,P<0?P*32768:P*32767,!0),m+=2}return new Blob([h],{type:"audio/wav"})}async exportAudioWAVOffline(e=16,t=44100){try{return console.log("📦 Exporting master pattern as WAV using OfflineAudioContext..."),!this.masterPattern||this.masterPattern.trim()===""?{success:!1,error:"No master pattern to export"}:(this.strudelLoaded||await this.initStrudel(),await this.exportAudioMediaRecorder(e))}catch(i){return console.error("❌ Error exporting WAV offline:",i),{success:!1,error:i.message}}}}const I=new Sx;typeof window<"u"&&(window.soundManager=I);class wx{constructor(){this.updateCallbacks=new Map,this.soundTrigger=null,this.controlSoundTimers=new Map,this.activeSliders=new Set,this.tempoSliderActivated=!1,this.tapTimes=[],this.tapTimeout=null,this.tapTimeoutDelay=2e3,this.initializeControls()}setSoundTrigger(e){this.soundTrigger=e}triggerControlSound(e){if(!this.soundTrigger)return;const t=this.controlSoundTimers.get(e);t&&clearTimeout(t);const i=setTimeout(()=>{this.controlSoundTimers.delete(e);const s=Lt.getControlConfig(e);if(s&&s.type){const r=`control-${e}`;this.soundTrigger(r,s)}},100);this.controlSoundTimers.set(e,i)}initializeControls(){const e=document.getElementById("tempo-slider"),t=document.getElementById("tempo-value");if(e&&t){e.classList.add("inactive"),t.classList.add("inactive");const a=()=>this.markTempoSliderActive(e,t);e.addEventListener&&(e.addEventListener("pointerdown",a,{once:!0}),e.addEventListener("focus",a,{once:!0})),e.addEventListener("input",o=>{a();const l=parseInt(o.target.value);t.textContent=l,this.notify("tempo",l)})}const i=document.getElementById("tap-tempo-btn");i&&i.addEventListener("click",()=>{this.handleTapTempo(e,t,i)});const s=document.getElementById("key-select");s&&s.addEventListener("change",a=>{const o=a.target.value;o!==""&&this.notify("key",o)});const r=document.getElementById("scale-select");r&&r.addEventListener("change",a=>{const o=a.target.value;if(o===""){this.notify("scale","chromatic");return}this.notify("scale",o)})}markTempoSliderActive(e,t){this.tempoSliderActivated||(this.tempoSliderActivated=!0,e&&e.classList.remove("inactive"),t&&t.classList.remove("inactive"))}handleTapTempo(e,t,i){this.markTempoSliderActive(e,t);const s=Date.now();if(this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null),this.tapTimes.push(s),this.tapTimes.length>=3){const r=[];for(let l=1;l<this.tapTimes.length;l++)r.push(this.tapTimes[l]-this.tapTimes[l-1]);const a=r.reduce((l,c)=>l+c,0)/r.length;let o=Math.round(6e4/a);o=Math.max(60,Math.min(240,o)),e&&(e.value=o),t&&(t.textContent=o),this.notify("tempo",o),this.tapTimes.length>4&&(this.tapTimes=this.tapTimes.slice(-4))}else{const r=3-this.tapTimes.length;if(i){const a=i.textContent;i.textContent=`${r} more`,setTimeout(()=>{i.textContent=a},500)}}this.tapTimeout=setTimeout(()=>{this.tapTimes=[],this.tapTimeout=null,i&&(i.textContent="TAP")},this.tapTimeoutDelay)}onUpdate(e,t){this.updateCallbacks.has(e)||this.updateCallbacks.set(e,[]),this.updateCallbacks.get(e).push(t)}notify(e,t){const i=this.updateCallbacks.get(e);i&&i.forEach(s=>s(t))}updateStatus(e){const t=document.getElementById("status-text");t&&(t.textContent=e)}updateActiveElements(e){const t=document.getElementById("active-elements");t&&(e.length===0?t.textContent="None":t.textContent=e.join(", "))}setElementState(e,t){const i=e.querySelector(".element-indicator");i&&(i.className="element-indicator",t==="hover"?i.classList.add("hover"):t==="proximity"&&i.classList.add("proximity")),e.className="sound-element",t==="hover"?e.classList.add("is-hovered"):t==="proximity"&&e.classList.add("is-proximity")}}const Ut=new wx;let zc=[],C0=[];(()=>{let n="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,t=0;e<n.length;e++)(e%2?C0:zc).push(t=t+n[e])})();function Px(n){if(n<768)return!1;for(let e=0,t=zc.length;;){let i=e+t>>1;if(n<zc[i])t=i;else if(n>=C0[i])e=i+1;else return!0;if(e==t)return!1}}function Nf(n){return n>=127462&&n<=127487}const Qf=8205;function xx(n,e,t=!0,i=!0){return(t?A0:Cx)(n,e,i)}function A0(n,e,t){if(e==n.length)return e;e&&k0(n.charCodeAt(e))&&E0(n.charCodeAt(e-1))&&e--;let i=wu(n,e);for(e+=Rf(i);e<n.length;){let s=wu(n,e);if(i==Qf||s==Qf||t&&Px(s))e+=Rf(s),i=s;else if(Nf(s)){let r=0,a=e-2;for(;a>=0&&Nf(wu(n,a));)r++,a-=2;if(r%2==0)break;e+=2}else break}return e}function Cx(n,e,t){for(;e>0;){let i=A0(n,e-2,t);if(i<e)return i;e--}return 0}function wu(n,e){let t=n.charCodeAt(e);if(!E0(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return k0(i)?(t-55296<<10)+(i-56320)+65536:t}function k0(n){return n>=56320&&n<57344}function E0(n){return n>=55296&&n<56320}function Rf(n){return n<65536?1:2}class pt{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=Nr(this,e,t);let s=[];return this.decompose(0,e,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(t,this.length,s,1),Yi.from(s,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=Nr(this,e,t);let i=[];return this.decompose(e,t,i,0),Yi.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),s=new Sa(this),r=new Sa(e);for(let a=t,o=t;;){if(s.next(a),r.next(a),a=0,s.lineBreak!=r.lineBreak||s.done!=r.done||s.value!=r.value)return!1;if(o+=s.value.length,s.done||o>=i)return!0}}iter(e=1){return new Sa(this,e)}iterRange(e,t=this.length){return new $0(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let s=this.line(e).from;i=this.iterRange(s,Math.max(s,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new D0(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?pt.empty:e.length<=32?new Kt(e):Yi.from(Kt.split(e,[]))}}class Kt extends pt{constructor(e,t=Ax(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,s){for(let r=0;;r++){let a=this.text[r],o=s+a.length;if((t?i:o)>=e)return new kx(s,o,i,a);s=o+1,i++}}decompose(e,t,i,s){let r=e<=0&&t>=this.length?this:new Kt(Lf(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(s&1){let a=i.pop(),o=Io(r.text,a.text.slice(),0,r.length);if(o.length<=32)i.push(new Kt(o,a.length+r.length));else{let l=o.length>>1;i.push(new Kt(o.slice(0,l)),new Kt(o.slice(l)))}}else i.push(r)}replace(e,t,i){if(!(i instanceof Kt))return super.replace(e,t,i);[e,t]=Nr(this,e,t);let s=Io(this.text,Io(i.text,Lf(this.text,0,e)),t),r=this.length+i.length-(t-e);return s.length<=32?new Kt(s,r):Yi.from(Kt.split(s,[]),r)}sliceString(e,t=this.length,i=`
`){[e,t]=Nr(this,e,t);let s="";for(let r=0,a=0;r<=t&&a<this.text.length;a++){let o=this.text[a],l=r+o.length;r>e&&a&&(s+=i),e<l&&t>r&&(s+=o.slice(Math.max(0,e-r),t-r)),r=l+1}return s}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],s=-1;for(let r of e)i.push(r),s+=r.length+1,i.length==32&&(t.push(new Kt(i,s)),i=[],s=-1);return s>-1&&t.push(new Kt(i,s)),t}}class Yi extends pt{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,s){for(let r=0;;r++){let a=this.children[r],o=s+a.length,l=i+a.lines-1;if((t?l:o)>=e)return a.lineInner(e,t,i,s);s=o+1,i=l+1}}decompose(e,t,i,s){for(let r=0,a=0;a<=t&&r<this.children.length;r++){let o=this.children[r],l=a+o.length;if(e<=l&&t>=a){let c=s&((a<=e?1:0)|(l>=t?2:0));a>=e&&l<=t&&!c?i.push(o):o.decompose(e-a,t-a,i,c)}a=l+1}}replace(e,t,i){if([e,t]=Nr(this,e,t),i.lines<this.lines)for(let s=0,r=0;s<this.children.length;s++){let a=this.children[s],o=r+a.length;if(e>=r&&t<=o){let l=a.replace(e-r,t-r,i),c=this.lines-a.lines+l.lines;if(l.lines<c>>4&&l.lines>c>>6){let u=this.children.slice();return u[s]=l,new Yi(u,this.length-(t-e)+i.length)}return super.replace(r,o,l)}r=o+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){[e,t]=Nr(this,e,t);let s="";for(let r=0,a=0;r<this.children.length&&a<=t;r++){let o=this.children[r],l=a+o.length;a>e&&r&&(s+=i),e<l&&t>a&&(s+=o.sliceString(e-a,t-a,i)),a=l+1}return s}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Yi))return 0;let i=0,[s,r,a,o]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=t,r+=t){if(s==a||r==o)return i;let l=this.children[s],c=e.children[r];if(l!=c)return i+l.scanIdentical(c,t);i+=l.length+1}}static from(e,t=e.reduce((i,s)=>i+s.length+1,-1)){let i=0;for(let f of e)i+=f.lines;if(i<32){let f=[];for(let m of e)m.flatten(f);return new Kt(f,t)}let s=Math.max(32,i>>5),r=s<<1,a=s>>1,o=[],l=0,c=-1,u=[];function h(f){let m;if(f.lines>r&&f instanceof Yi)for(let g of f.children)h(g);else f.lines>a&&(l>a||!l)?(d(),o.push(f)):f instanceof Kt&&l&&(m=u[u.length-1])instanceof Kt&&f.lines+m.lines<=32?(l+=f.lines,c+=f.length+1,u[u.length-1]=new Kt(m.text.concat(f.text),m.length+1+f.length)):(l+f.lines>s&&d(),l+=f.lines,c+=f.length+1,u.push(f))}function d(){l!=0&&(o.push(u.length==1?u[0]:Yi.from(u,c)),c=-1,l=u.length=0)}for(let f of e)h(f);return d(),o.length==1?o[0]:new Yi(o,t)}}pt.empty=new Kt([""],0);function Ax(n){let e=-1;for(let t of n)e+=t.length+1;return e}function Io(n,e,t=0,i=1e9){for(let s=0,r=0,a=!0;r<n.length&&s<=i;r++){let o=n[r],l=s+o.length;l>=t&&(l>i&&(o=o.slice(0,i-s)),s<t&&(o=o.slice(t-s)),a?(e[e.length-1]+=o,a=!1):e.push(o)),s=l+1}return e}function Lf(n,e,t){return Io(n,[""],e,t)}class Sa{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Kt?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],r=this.offsets[i],a=r>>1,o=s instanceof Kt?s.text.length:s.children.length;if(a==(t>0?o:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(s instanceof Kt){let l=s.text[a+(t<0?-1:0)];if(this.offsets[i]+=t,l.length>Math.max(0,e))return this.value=e==0?l:t>0?l.slice(e):l.slice(0,l.length-e),this;e-=l.length}else{let l=s.children[a+(t<0?-1:0)];e>l.length?(e-=l.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(l),this.offsets.push(t>0?1:(l instanceof Kt?l.text.length:l.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class $0{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new Sa(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*t,this.value=s.length<=i?s:t<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class D0{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:s}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(pt.prototype[Symbol.iterator]=function(){return this.iter()},Sa.prototype[Symbol.iterator]=$0.prototype[Symbol.iterator]=D0.prototype[Symbol.iterator]=function(){return this});class kx{constructor(e,t,i,s){this.from=e,this.to=t,this.number=i,this.text=s}get length(){return this.to-this.from}}function Nr(n,e,t){return e=Math.max(0,Math.min(n.length,e)),[e,Math.max(e,Math.min(n.length,t))]}function Nn(n,e,t=!0,i=!0){return xx(n,e,t,i)}function Ex(n){return n>=56320&&n<57344}function $x(n){return n>=55296&&n<56320}function Or(n,e){let t=n.charCodeAt(e);if(!$x(t)||e+1==n.length)return t;let i=n.charCodeAt(e+1);return Ex(i)?(t-55296<<10)+(i-56320)+65536:t}function M0(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}function qa(n){return n<65536?1:2}const Zc=/\r\n?|\n/;var En=(function(n){return n[n.Simple=0]="Simple",n[n.TrackDel=1]="TrackDel",n[n.TrackBefore=2]="TrackBefore",n[n.TrackAfter=3]="TrackAfter",n})(En||(En={}));class is{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,s=0;t<this.sections.length;){let r=this.sections[t++],a=this.sections[t++];a<0?(e(i,s,r),s+=r):s+=a,i+=r}}iterChangedRanges(e,t=!1){jc(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],s=this.sections[t++];s<0?e.push(i,s):e.push(s,i)}return new is(e)}composeDesc(e){return this.empty?e:e.empty?this:T0(this,e)}mapDesc(e,t=!1){return e.empty?this:qc(this,e,t)}mapPos(e,t=-1,i=En.Simple){let s=0,r=0;for(let a=0;a<this.sections.length;){let o=this.sections[a++],l=this.sections[a++],c=s+o;if(l<0){if(c>e)return r+(e-s);r+=o}else{if(i!=En.Simple&&c>=e&&(i==En.TrackDel&&s<e&&c>e||i==En.TrackBefore&&s<e||i==En.TrackAfter&&c>e))return null;if(c>e||c==e&&t<0&&!o)return e==s||t<0?r:r+l;r+=l}s=c}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return r}touchesRange(e,t=e){for(let i=0,s=0;i<this.sections.length&&s<=t;){let r=this.sections[i++],a=this.sections[i++],o=s+r;if(a>=0&&s<=t&&o>=e)return s<e&&o>t?"cover":!0;s=o}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],s=this.sections[t++];e+=(e?" ":"")+i+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new is(e)}static create(e){return new is(e)}}class ln extends is{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return jc(this,(t,i,s,r,a)=>e=e.replace(s,s+(i-t),a),!1),e}mapDesc(e,t=!1){return qc(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let s=0,r=0;s<t.length;s+=2){let a=t[s],o=t[s+1];if(o>=0){t[s]=o,t[s+1]=a;let l=s>>1;for(;i.length<l;)i.push(pt.empty);i.push(a?e.slice(r,r+a):pt.empty)}r+=a}return new ln(t,i)}compose(e){return this.empty?e:e.empty?this:T0(this,e,!0)}map(e,t=!1){return e.empty?this:qc(this,e,t,!0)}iterChanges(e,t=!1){jc(this,e,t)}get desc(){return is.create(this.sections)}filter(e){let t=[],i=[],s=[],r=new Ma(this);e:for(let a=0,o=0;;){let l=a==e.length?1e9:e[a++];for(;o<l||o==l&&r.len==0;){if(r.done)break e;let u=Math.min(r.len,l-o);An(s,u,-1);let h=r.ins==-1?-1:r.off==0?r.ins:0;An(t,u,h),h>0&&Ts(i,t,r.text),r.forward(u),o+=u}let c=e[a++];for(;o<c;){if(r.done)break e;let u=Math.min(r.len,c-o);An(t,u,-1),An(s,u,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(u),o+=u}}return{changes:new ln(t,i),filtered:is.create(s)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],s=this.sections[t+1];s<0?e.push(i):s==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let s=[],r=[],a=0,o=null;function l(u=!1){if(!u&&!s.length)return;a<t&&An(s,t-a,-1);let h=new ln(s,r);o=o?o.compose(h.map(o)):h,s=[],r=[],a=0}function c(u){if(Array.isArray(u))for(let h of u)c(h);else if(u instanceof ln){if(u.length!=t)throw new RangeError(`Mismatched change set length (got ${u.length}, expected ${t})`);l(),o=o?o.compose(u.map(o)):u}else{let{from:h,to:d=h,insert:f}=u;if(h>d||h<0||d>t)throw new RangeError(`Invalid change range ${h} to ${d} (in doc of length ${t})`);let m=f?typeof f=="string"?pt.of(f.split(i||Zc)):f:pt.empty,g=m.length;if(h==d&&g==0)return;h<a&&l(),h>a&&An(s,h-a,-1),An(s,d-h,g),Ts(r,s,m),a=d}}return c(e),l(!o),o}static empty(e){return new ln(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let s=0;s<e.length;s++){let r=e[s];if(typeof r=="number")t.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((a,o)=>o&&typeof a!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)t.push(r[0],0);else{for(;i.length<s;)i.push(pt.empty);i[s]=pt.of(r.slice(1)),t.push(r[0],i[s].length)}}}return new ln(t,i)}static createSet(e,t){return new ln(e,t)}}function An(n,e,t,i=!1){if(e==0&&t<=0)return;let s=n.length-2;s>=0&&t<=0&&t==n[s+1]?n[s]+=e:s>=0&&e==0&&n[s]==0?n[s+1]+=t:i?(n[s]+=e,n[s+1]+=t):n.push(e,t)}function Ts(n,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<n.length)n[n.length-1]=n[n.length-1].append(t);else{for(;n.length<i;)n.push(pt.empty);n.push(t)}}function jc(n,e,t){let i=n.inserted;for(let s=0,r=0,a=0;a<n.sections.length;){let o=n.sections[a++],l=n.sections[a++];if(l<0)s+=o,r+=o;else{let c=s,u=r,h=pt.empty;for(;c+=o,u+=l,l&&i&&(h=h.append(i[a-2>>1])),!(t||a==n.sections.length||n.sections[a+1]<0);)o=n.sections[a++],l=n.sections[a++];e(s,c,r,u,h),s=c,r=u}}}function qc(n,e,t,i=!1){let s=[],r=i?[]:null,a=new Ma(n),o=new Ma(e);for(let l=-1;;){if(a.done&&o.len||o.done&&a.len)throw new Error("Mismatched change set lengths");if(a.ins==-1&&o.ins==-1){let c=Math.min(a.len,o.len);An(s,c,-1),a.forward(c),o.forward(c)}else if(o.ins>=0&&(a.ins<0||l==a.i||a.off==0&&(o.len<a.len||o.len==a.len&&!t))){let c=o.len;for(An(s,o.ins,-1);c;){let u=Math.min(a.len,c);a.ins>=0&&l<a.i&&a.len<=u&&(An(s,0,a.ins),r&&Ts(r,s,a.text),l=a.i),a.forward(u),c-=u}o.next()}else if(a.ins>=0){let c=0,u=a.len;for(;u;)if(o.ins==-1){let h=Math.min(u,o.len);c+=h,u-=h,o.forward(h)}else if(o.ins==0&&o.len<u)u-=o.len,o.next();else break;An(s,c,l<a.i?a.ins:0),r&&l<a.i&&Ts(r,s,a.text),l=a.i,a.forward(a.len-u)}else{if(a.done&&o.done)return r?ln.createSet(s,r):is.create(s);throw new Error("Mismatched change set lengths")}}}function T0(n,e,t=!1){let i=[],s=t?[]:null,r=new Ma(n),a=new Ma(e);for(let o=!1;;){if(r.done&&a.done)return s?ln.createSet(i,s):is.create(i);if(r.ins==0)An(i,r.len,0,o),r.next();else if(a.len==0&&!a.done)An(i,0,a.ins,o),s&&Ts(s,i,a.text),a.next();else{if(r.done||a.done)throw new Error("Mismatched change set lengths");{let l=Math.min(r.len2,a.len),c=i.length;if(r.ins==-1){let u=a.ins==-1?-1:a.off?0:a.ins;An(i,l,u,o),s&&u&&Ts(s,i,a.text)}else a.ins==-1?(An(i,r.off?0:r.len,l,o),s&&Ts(s,i,r.textBit(l))):(An(i,r.off?0:r.len,a.off?0:a.ins,o),s&&!a.off&&Ts(s,i,a.text));o=(r.ins>l||a.ins>=0&&a.len>l)&&(o||i.length>c),r.forward2(l),a.forward(l)}}}}class Ma{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?pt.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?pt.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class tr{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let i,s;return this.empty?i=s=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),s=e.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new tr(i,s,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return le.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return le.range(this.anchor,i)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return le.range(e.anchor,e.head)}static create(e,t,i){return new tr(e,t,i)}}class le{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:le.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new le([this.main],0)}addRange(e,t=!0){return le.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,le.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new le(e.ranges.map(t=>tr.fromJSON(t)),e.main)}static single(e,t=e){return new le([le.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<e.length;s++){let r=e[s];if(r.empty?r.from<=i:r.from<i)return le.normalized(e.slice(),t);i=r.to}return new le(e,t)}static cursor(e,t=0,i,s){return tr.create(e,e,(t==0?0:t<0?8:16)|(i==null?7:Math.min(6,i))|(s??16777215)<<6)}static range(e,t,i,s){let r=(i??16777215)<<6|(s==null?7:Math.min(6,s));return t<e?tr.create(t,e,48|r):tr.create(e,t,(t>e?8:0)|r)}static normalized(e,t=0){let i=e[t];e.sort((s,r)=>s.from-r.from),t=e.indexOf(i);for(let s=1;s<e.length;s++){let r=e[s],a=e[s-1];if(r.empty?r.from<=a.to:r.from<a.to){let o=a.from,l=Math.max(r.to,a.to);s<=t&&t--,e.splice(--s,2,r.anchor>r.head?le.range(l,o):le.range(o,l))}}return new le(e,t)}}function _0(n,e){for(let t of n.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let hd=0;class Be{constructor(e,t,i,s,r){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=s,this.id=hd++,this.default=e([]),this.extensions=typeof r=="function"?r(this):r}get reader(){return this}static define(e={}){return new Be(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:dd),!!e.static,e.enables)}of(e){return new Vo([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Vo(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new Vo(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function dd(n,e){return n==e||n.length==e.length&&n.every((t,i)=>t===e[i])}class Vo{constructor(e,t,i,s){this.dependencies=e,this.facet=t,this.type=i,this.value=s,this.id=hd++}dynamicSlot(e){var t;let i=this.value,s=this.facet.compareInput,r=this.id,a=e[r]>>1,o=this.type==2,l=!1,c=!1,u=[];for(let h of this.dependencies)h=="doc"?l=!0:h=="selection"?c=!0:(((t=e[h.id])!==null&&t!==void 0?t:1)&1)==0&&u.push(e[h.id]);return{create(h){return h.values[a]=i(h),1},update(h,d){if(l&&d.docChanged||c&&(d.docChanged||d.selection)||Gc(h,u)){let f=i(h);if(o?!If(f,h.values[a],s):!s(f,h.values[a]))return h.values[a]=f,1}return 0},reconfigure:(h,d)=>{let f,m=d.config.address[r];if(m!=null){let g=el(d,m);if(this.dependencies.every(y=>y instanceof Be?d.facet(y)===h.facet(y):y instanceof ri?d.field(y,!1)==h.field(y,!1):!0)||(o?If(f=i(h),g,s):s(f=i(h),g)))return h.values[a]=g,0}else f=i(h);return h.values[a]=f,1}}}}function If(n,e,t){if(n.length!=e.length)return!1;for(let i=0;i<n.length;i++)if(!t(n[i],e[i]))return!1;return!0}function Gc(n,e){let t=!1;for(let i of e)wa(n,i)&1&&(t=!0);return t}function Dx(n,e,t){let i=t.map(l=>n[l.id]),s=t.map(l=>l.type),r=i.filter(l=>!(l&1)),a=n[e.id]>>1;function o(l){let c=[];for(let u=0;u<i.length;u++){let h=el(l,i[u]);if(s[u]==2)for(let d of h)c.push(d);else c.push(h)}return e.combine(c)}return{create(l){for(let c of i)wa(l,c);return l.values[a]=o(l),1},update(l,c){if(!Gc(l,r))return 0;let u=o(l);return e.compare(u,l.values[a])?0:(l.values[a]=u,1)},reconfigure(l,c){let u=Gc(l,i),h=c.config.facets[e.id],d=c.facet(e);if(h&&!u&&dd(t,h))return l.values[a]=d,0;let f=o(l);return e.compare(f,d)?(l.values[a]=d,0):(l.values[a]=f,1)}}}const lo=Be.define({static:!0});class ri{constructor(e,t,i,s,r){this.id=e,this.createF=t,this.updateF=i,this.compareF=s,this.spec=r,this.provides=void 0}static define(e){let t=new ri(hd++,e.create,e.update,e.compare||((i,s)=>i===s),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(lo).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,s)=>{let r=i.values[t],a=this.updateF(r,s);return this.compareF(r,a)?0:(i.values[t]=a,1)},reconfigure:(i,s)=>{let r=i.facet(lo),a=s.facet(lo),o;return(o=r.find(l=>l.field==this))&&o!=a.find(l=>l.field==this)?(i.values[t]=o.create(i),1):s.config.address[this.id]!=null?(i.values[t]=s.field(this),0):(i.values[t]=this.create(i),1)}}}init(e){return[this,lo.of({field:this,create:e})]}get extension(){return this}}const Ks={lowest:4,low:3,default:2,high:1,highest:0};function na(n){return e=>new F0(e,n)}const Fl={highest:na(Ks.highest),high:na(Ks.high),default:na(Ks.default),low:na(Ks.low),lowest:na(Ks.lowest)};class F0{constructor(e,t){this.inner=e,this.prec=t}}class Bl{of(e){return new Wc(this,e)}reconfigure(e){return Bl.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Wc{constructor(e,t){this.compartment=e,this.inner=t}}class Jo{constructor(e,t,i,s,r,a){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=s,this.staticValues=r,this.facets=a,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let s=[],r=Object.create(null),a=new Map;for(let d of Mx(e,t,a))d instanceof ri?s.push(d):(r[d.facet.id]||(r[d.facet.id]=[])).push(d);let o=Object.create(null),l=[],c=[];for(let d of s)o[d.id]=c.length<<1,c.push(f=>d.slot(f));let u=i==null?void 0:i.config.facets;for(let d in r){let f=r[d],m=f[0].facet,g=u&&u[d]||[];if(f.every(y=>y.type==0))if(o[m.id]=l.length<<1|1,dd(g,f))l.push(i.facet(m));else{let y=m.combine(f.map(b=>b.value));l.push(i&&m.compare(y,i.facet(m))?i.facet(m):y)}else{for(let y of f)y.type==0?(o[y.id]=l.length<<1|1,l.push(y.value)):(o[y.id]=c.length<<1,c.push(b=>y.dynamicSlot(b)));o[m.id]=c.length<<1,c.push(y=>Dx(y,m,f))}}let h=c.map(d=>d(o));return new Jo(e,a,h,o,l,r)}}function Mx(n,e,t){let i=[[],[],[],[],[]],s=new Map;function r(a,o){let l=s.get(a);if(l!=null){if(l<=o)return;let c=i[l].indexOf(a);c>-1&&i[l].splice(c,1),a instanceof Wc&&t.delete(a.compartment)}if(s.set(a,o),Array.isArray(a))for(let c of a)r(c,o);else if(a instanceof Wc){if(t.has(a.compartment))throw new RangeError("Duplicate use of compartment in extensions");let c=e.get(a.compartment)||a.inner;t.set(a.compartment,c),r(c,o)}else if(a instanceof F0)r(a.inner,a.prec);else if(a instanceof ri)i[o].push(a),a.provides&&r(a.provides,o);else if(a instanceof Vo)i[o].push(a),a.facet.extensions&&r(a.facet.extensions,Ks.default);else{let c=a.extension;if(!c)throw new Error(`Unrecognized extension value in extension set (${a}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(c,o)}}return r(n,Ks.default),i.reduce((a,o)=>a.concat(o))}function wa(n,e){if(e&1)return 2;let t=e>>1,i=n.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;n.status[t]=4;let s=n.computeSlot(n,n.config.dynamicSlots[t]);return n.status[t]=2|s}function el(n,e){return e&1?n.config.staticValues[e>>1]:n.values[e>>1]}const B0=Be.define(),Xc=Be.define({combine:n=>n.some(e=>e),static:!0}),N0=Be.define({combine:n=>n.length?n[0]:void 0,static:!0}),Q0=Be.define(),R0=Be.define(),L0=Be.define(),I0=Be.define({combine:n=>n.length?n[0]:!1});class Ss{constructor(e,t){this.type=e,this.value=t}static define(){return new Tx}}class Tx{of(e){return new Ss(this,e)}}class _x{constructor(e){this.map=e}of(e){return new kt(this,e)}}class kt{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new kt(this.type,t)}is(e){return this.type==e}static define(e={}){return new _x(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let s of e){let r=s.map(t);r&&i.push(r)}return i}}kt.reconfigure=kt.define();kt.appendConfig=kt.define();class rn{constructor(e,t,i,s,r,a){this.startState=e,this.changes=t,this.selection=i,this.effects=s,this.annotations=r,this.scrollIntoView=a,this._doc=null,this._state=null,i&&_0(i,t.newLength),r.some(o=>o.type==rn.time)||(this.annotations=r.concat(rn.time.of(Date.now())))}static create(e,t,i,s,r,a){return new rn(e,t,i,s,r,a)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(rn.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}rn.time=Ss.define();rn.userEvent=Ss.define();rn.addToHistory=Ss.define();rn.remote=Ss.define();function Fx(n,e){let t=[];for(let i=0,s=0;;){let r,a;if(i<n.length&&(s==e.length||e[s]>=n[i]))r=n[i++],a=n[i++];else if(s<e.length)r=e[s++],a=e[s++];else return t;!t.length||t[t.length-1]<r?t.push(r,a):t[t.length-1]<a&&(t[t.length-1]=a)}}function V0(n,e,t){var i;let s,r,a;return t?(s=e.changes,r=ln.empty(e.changes.length),a=n.changes.compose(e.changes)):(s=e.changes.map(n.changes),r=n.changes.mapDesc(e.changes,!0),a=n.changes.compose(s)),{changes:a,selection:e.selection?e.selection.map(r):(i=n.selection)===null||i===void 0?void 0:i.map(s),effects:kt.mapEffects(n.effects,s).concat(kt.mapEffects(e.effects,r)),annotations:n.annotations.length?n.annotations.concat(e.annotations):e.annotations,scrollIntoView:n.scrollIntoView||e.scrollIntoView}}function Uc(n,e,t){let i=e.selection,s=Tr(e.annotations);return e.userEvent&&(s=s.concat(rn.userEvent.of(e.userEvent))),{changes:e.changes instanceof ln?e.changes:ln.of(e.changes||[],t,n.facet(N0)),selection:i&&(i instanceof le?i:le.single(i.anchor,i.head)),effects:Tr(e.effects),annotations:s,scrollIntoView:!!e.scrollIntoView}}function z0(n,e,t){let i=Uc(n,e.length?e[0]:{},n.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let r=1;r<e.length;r++){e[r].filter===!1&&(t=!1);let a=!!e[r].sequential;i=V0(i,Uc(n,e[r],a?i.changes.newLength:n.doc.length),a)}let s=rn.create(n,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return Nx(t?Bx(s):s)}function Bx(n){let e=n.startState,t=!0;for(let s of e.facet(Q0)){let r=s(n);if(r===!1){t=!1;break}Array.isArray(r)&&(t=t===!0?r:Fx(t,r))}if(t!==!0){let s,r;if(t===!1)r=n.changes.invertedDesc,s=ln.empty(e.doc.length);else{let a=n.changes.filter(t);s=a.changes,r=a.filtered.mapDesc(a.changes).invertedDesc}n=rn.create(e,s,n.selection&&n.selection.map(r),kt.mapEffects(n.effects,r),n.annotations,n.scrollIntoView)}let i=e.facet(R0);for(let s=i.length-1;s>=0;s--){let r=i[s](n);r instanceof rn?n=r:Array.isArray(r)&&r.length==1&&r[0]instanceof rn?n=r[0]:n=z0(e,Tr(r),!1)}return n}function Nx(n){let e=n.startState,t=e.facet(L0),i=n;for(let s=t.length-1;s>=0;s--){let r=t[s](n);r&&Object.keys(r).length&&(i=V0(i,Uc(e,r,n.changes.newLength),!0))}return i==n?n:rn.create(e,n.changes,n.selection,i.effects,i.annotations,i.scrollIntoView)}const Qx=[];function Tr(n){return n==null?Qx:Array.isArray(n)?n:[n]}var Dn=(function(n){return n[n.Word=0]="Word",n[n.Space=1]="Space",n[n.Other=2]="Other",n})(Dn||(Dn={}));const Rx=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Yc;try{Yc=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function Lx(n){if(Yc)return Yc.test(n);for(let e=0;e<n.length;e++){let t=n[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||Rx.test(t)))return!0}return!1}function Ix(n){return e=>{if(!/\S/.test(e))return Dn.Space;if(Lx(e))return Dn.Word;for(let t=0;t<n.length;t++)if(e.indexOf(n[t])>-1)return Dn.Word;return Dn.Other}}class At{constructor(e,t,i,s,r,a){this.config=e,this.doc=t,this.selection=i,this.values=s,this.status=e.statusTemplate.slice(),this.computeSlot=r,a&&(a._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)wa(this,o<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return wa(this,i),el(this,i)}update(...e){return z0(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:s}=t;for(let o of e.effects)o.is(Bl.reconfigure)?(t&&(s=new Map,t.compartments.forEach((l,c)=>s.set(c,l)),t=null),s.set(o.value.compartment,o.value.extension)):o.is(kt.reconfigure)?(t=null,i=o.value):o.is(kt.appendConfig)&&(t=null,i=Tr(i).concat(o.value));let r;t?r=e.startState.values.slice():(t=Jo.resolve(i,s,this),r=new At(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(l,c)=>c.reconfigure(l,this),null).values);let a=e.startState.facet(Xc)?e.newSelection:e.newSelection.asSingle();new At(t,e.newDoc,a,r,(o,l)=>l.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:le.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),s=this.changes(i.changes),r=[i.range],a=Tr(i.effects);for(let o=1;o<t.ranges.length;o++){let l=e(t.ranges[o]),c=this.changes(l.changes),u=c.map(s);for(let d=0;d<o;d++)r[d]=r[d].map(u);let h=s.mapDesc(c,!0);r.push(l.range.map(h)),s=s.compose(u),a=kt.mapEffects(a,u).concat(kt.mapEffects(Tr(l.effects),h))}return{changes:s,selection:le.create(r,t.mainIndex),effects:a}}changes(e=[]){return e instanceof ln?e:ln.of(e,this.doc.length,this.facet(At.lineSeparator))}toText(e){return pt.of(e.split(this.facet(At.lineSeparator)||Zc))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(wa(this,t),el(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let s=e[i];s instanceof ri&&this.config.address[s.id]!=null&&(t[i]=s.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i){for(let r in i)if(Object.prototype.hasOwnProperty.call(e,r)){let a=i[r],o=e[r];s.push(a.init(l=>a.spec.fromJSON(o,l)))}}return At.create({doc:e.doc,selection:le.fromJSON(e.selection),extensions:t.extensions?s.concat([t.extensions]):s})}static create(e={}){let t=Jo.resolve(e.extensions||[],new Map),i=e.doc instanceof pt?e.doc:pt.of((e.doc||"").split(t.staticFacet(At.lineSeparator)||Zc)),s=e.selection?e.selection instanceof le?e.selection:le.single(e.selection.anchor,e.selection.head):le.single(0);return _0(s,i.length),t.staticFacet(Xc)||(s=s.asSingle()),new At(t,i,s,t.dynamicSlots.map(()=>null),(r,a)=>a.create(r),null)}get tabSize(){return this.facet(At.tabSize)}get lineBreak(){return this.facet(At.lineSeparator)||`
`}get readOnly(){return this.facet(I0)}phrase(e,...t){for(let i of this.facet(At.phrases))if(Object.prototype.hasOwnProperty.call(i,e)){e=i[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(i,s)=>{if(s=="$")return"$";let r=+(s||1);return!r||r>t.length?i:t[r-1]})),e}languageDataAt(e,t,i=-1){let s=[];for(let r of this.facet(B0))for(let a of r(this,t,i))Object.prototype.hasOwnProperty.call(a,e)&&s.push(a[e]);return s}charCategorizer(e){return Ix(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:s}=this.doc.lineAt(e),r=this.charCategorizer(e),a=e-i,o=e-i;for(;a>0;){let l=Nn(t,a,!1);if(r(t.slice(l,a))!=Dn.Word)break;a=l}for(;o<s;){let l=Nn(t,o);if(r(t.slice(o,l))!=Dn.Word)break;o=l}return a==o?null:le.range(a+i,o+i)}}At.allowMultipleSelections=Xc;At.tabSize=Be.define({combine:n=>n.length?n[0]:4});At.lineSeparator=N0;At.readOnly=I0;At.phrases=Be.define({compare(n,e){let t=Object.keys(n),i=Object.keys(e);return t.length==i.length&&t.every(s=>n[s]==e[s])}});At.languageData=B0;At.changeFilter=Q0;At.transactionFilter=R0;At.transactionExtender=L0;Bl.reconfigure=kt.define();function Ga(n,e,t={}){let i={};for(let s of n)for(let r of Object.keys(s)){let a=s[r],o=i[r];if(o===void 0)i[r]=a;else if(!(o===a||a===void 0))if(Object.hasOwnProperty.call(t,r))i[r]=t[r](o,a);else throw new Error("Config merge conflict for field "+r)}for(let s in e)i[s]===void 0&&(i[s]=e[s]);return i}class hr{eq(e){return this==e}range(e,t=e){return Hc.create(e,t,this)}}hr.prototype.startSide=hr.prototype.endSide=0;hr.prototype.point=!1;hr.prototype.mapMode=En.TrackDel;let Hc=class Z0{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Z0(e,t,i)}};function Kc(n,e){return n.from-e.from||n.value.startSide-e.value.startSide}class fd{constructor(e,t,i,s){this.from=e,this.to=t,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,s=0){let r=i?this.to:this.from;for(let a=s,o=r.length;;){if(a==o)return a;let l=a+o>>1,c=r[l]-e||(i?this.value[l].endSide:this.value[l].startSide)-t;if(l==a)return c>=0?a:o;c>=0?o=l:a=l+1}}between(e,t,i,s){for(let r=this.findIndex(t,-1e9,!0),a=this.findIndex(i,1e9,!1,r);r<a;r++)if(s(this.from[r]+e,this.to[r]+e,this.value[r])===!1)return!1}map(e,t){let i=[],s=[],r=[],a=-1,o=-1;for(let l=0;l<this.value.length;l++){let c=this.value[l],u=this.from[l]+e,h=this.to[l]+e,d,f;if(u==h){let m=t.mapPos(u,c.startSide,c.mapMode);if(m==null||(d=f=m,c.startSide!=c.endSide&&(f=t.mapPos(u,c.endSide),f<d)))continue}else if(d=t.mapPos(u,c.startSide),f=t.mapPos(h,c.endSide),d>f||d==f&&c.startSide>0&&c.endSide<=0)continue;(f-d||c.endSide-c.startSide)<0||(a<0&&(a=d),c.point&&(o=Math.max(o,f-d)),i.push(c),s.push(d-a),r.push(f-a))}return{mapped:i.length?new fd(s,r,i,o):null,pos:a}}}class vt{constructor(e,t,i,s){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=s}static create(e,t,i,s){return new vt(e,t,i,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:s=0,filterTo:r=this.length}=e,a=e.filter;if(t.length==0&&!a)return this;if(i&&(t=t.slice().sort(Kc)),this.isEmpty)return t.length?vt.of(t):this;let o=new j0(this,null,-1).goto(0),l=0,c=[],u=new Qr;for(;o.value||l<t.length;)if(l<t.length&&(o.from-t[l].from||o.startSide-t[l].value.startSide)>=0){let h=t[l++];u.addInner(h.from,h.to,h.value)||c.push(h)}else o.rangeIndex==1&&o.chunkIndex<this.chunk.length&&(l==t.length||this.chunkEnd(o.chunkIndex)<t[l].from)&&(!a||s>this.chunkEnd(o.chunkIndex)||r<this.chunkPos[o.chunkIndex])&&u.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!a||s>o.to||r<o.from||a(o.from,o.to,o.value))&&(u.addInner(o.from,o.to,o.value)||c.push(Hc.create(o.from,o.to,o.value))),o.next());return u.finishInner(this.nextLayer.isEmpty&&!c.length?vt.empty:this.nextLayer.update({add:c,filter:a,filterFrom:s,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],s=-1;for(let a=0;a<this.chunk.length;a++){let o=this.chunkPos[a],l=this.chunk[a],c=e.touchesRange(o,o+l.length);if(c===!1)s=Math.max(s,l.maxPoint),t.push(l),i.push(e.mapPos(o));else if(c===!0){let{mapped:u,pos:h}=l.map(o,e);u&&(s=Math.max(s,u.maxPoint),t.push(u),i.push(h))}}let r=this.nextLayer.map(e);return t.length==0?r:new vt(i,t,r||vt.empty,s)}between(e,t,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],a=this.chunk[s];if(t>=r&&e<=r+a.length&&a.between(r,e-r,t-r,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return Ta.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Ta.from(e).goto(t)}static compare(e,t,i,s,r=-1){let a=e.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=r),o=t.filter(h=>h.maxPoint>0||!h.isEmpty&&h.maxPoint>=r),l=Vf(a,o,i),c=new ia(a,l,r),u=new ia(o,l,r);i.iterGaps((h,d,f)=>zf(c,h,u,d,f,s)),i.empty&&i.length==0&&zf(c,0,u,0,0,s)}static eq(e,t,i=0,s){s==null&&(s=999999999);let r=e.filter(u=>!u.isEmpty&&t.indexOf(u)<0),a=t.filter(u=>!u.isEmpty&&e.indexOf(u)<0);if(r.length!=a.length)return!1;if(!r.length)return!0;let o=Vf(r,a),l=new ia(r,o,0).goto(i),c=new ia(a,o,0).goto(i);for(;;){if(l.to!=c.to||!Jc(l.active,c.active)||l.point&&(!c.point||!l.point.eq(c.point)))return!1;if(l.to>s)return!0;l.next(),c.next()}}static spans(e,t,i,s,r=-1){let a=new ia(e,null,r).goto(t),o=t,l=a.openStart;for(;;){let c=Math.min(a.to,i);if(a.point){let u=a.activeForPoint(a.to),h=a.pointFrom<t?u.length+1:a.point.startSide<0?u.length:Math.min(u.length,l);s.point(o,c,a.point,u,h,a.pointRank),l=Math.min(a.openEnd(c),u.length)}else c>o&&(s.span(o,c,a.active,l),l=a.openEnd(c));if(a.to>i)return l+(a.point&&a.to>i?1:0);o=a.to,a.next()}}static of(e,t=!1){let i=new Qr;for(let s of e instanceof Hc?[e]:t?Vx(e):e)i.add(s.from,s.to,s.value);return i.finish()}static join(e){if(!e.length)return vt.empty;let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)for(let s=e[i];s!=vt.empty;s=s.nextLayer)t=new vt(s.chunkPos,s.chunk,t,Math.max(s.maxPoint,t.maxPoint));return t}}vt.empty=new vt([],[],null,-1);function Vx(n){if(n.length>1)for(let e=n[0],t=1;t<n.length;t++){let i=n[t];if(Kc(e,i)>0)return n.slice().sort(Kc);e=i}return n}vt.empty.nextLayer=vt.empty;class Qr{finishChunk(e){this.chunks.push(new fd(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Qr)).add(e,t,i)}addInner(e,t,i){let s=e-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(vt.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=vt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Vf(n,e,t){let i=new Map;for(let r of n)for(let a=0;a<r.chunk.length;a++)r.chunk[a].maxPoint<=0&&i.set(r.chunk[a],r.chunkPos[a]);let s=new Set;for(let r of e)for(let a=0;a<r.chunk.length;a++){let o=i.get(r.chunk[a]);o!=null&&(t?t.mapPos(o):o)==r.chunkPos[a]&&!(t!=null&&t.touchesRange(o,o+r.chunk[a].length))&&s.add(r.chunk[a])}return s}class j0{constructor(e,t,i,s=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<e||s.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Ta{constructor(e){this.heap=e}static from(e,t=null,i=-1){let s=[];for(let r=0;r<e.length;r++)for(let a=e[r];!a.isEmpty;a=a.nextLayer)a.maxPoint>=i&&s.push(new j0(a,t,i,r));return s.length==1?s[0]:new Ta(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)Pu(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)Pu(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Pu(this.heap,0)}}}function Pu(n,e){for(let t=n[e];;){let i=(e<<1)+1;if(i>=n.length)break;let s=n[i];if(i+1<n.length&&s.compare(n[i+1])>=0&&(s=n[i+1],i++),t.compare(s)<0)break;n[i]=t,n[e]=s,e=i}}class ia{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Ta.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){uo(this.active,e),uo(this.activeTo,e),uo(this.activeRank,e),this.minActive=Zf(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:s,rank:r}=this.cursor;for(;t<this.activeRank.length&&(r-this.activeRank[t]||s-this.activeTo[t])>0;)t++;co(this.active,t,i),co(this.activeTo,t,s),co(this.activeRank,t,r),e&&co(e,t,this.cursor.from),this.minActive=Zf(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&uo(i,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let r=this.cursor.value;if(!r.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let s=i.length-1;s>=0&&i[s]<e;s--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function zf(n,e,t,i,s,r){n.goto(e),t.goto(i);let a=i+s,o=i,l=i-e;for(;;){let c=n.to+l-t.to,u=c||n.endSide-t.endSide,h=u<0?n.to+l:t.to,d=Math.min(h,a);if(n.point||t.point?n.point&&t.point&&(n.point==t.point||n.point.eq(t.point))&&Jc(n.activeForPoint(n.to),t.activeForPoint(t.to))||r.comparePoint(o,d,n.point,t.point):d>o&&!Jc(n.active,t.active)&&r.compareRange(o,d,n.active,t.active),h>a)break;(c||n.openEnd!=t.openEnd)&&r.boundChange&&r.boundChange(h),o=h,u<=0&&n.next(),u>=0&&t.next()}}function Jc(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!=e[t]&&!n[t].eq(e[t]))return!1;return!0}function uo(n,e){for(let t=e,i=n.length-1;t<i;t++)n[t]=n[t+1];n.pop()}function co(n,e,t){for(let i=n.length-1;i>=e;i--)n[i+1]=n[i];n[e]=t}function Zf(n,e){let t=-1,i=1e9;for(let s=0;s<e.length;s++)(e[s]-i||n[s].endSide-n[t].endSide)<0&&(t=s,i=e[s]);return t}function Nl(n,e,t=n.length){let i=0;for(let s=0;s<t&&s<n.length;)n.charCodeAt(s)==9?(i+=e-i%e,s++):(i++,s=Nn(n,s));return i}function zx(n,e,t,i){for(let s=0,r=0;;){if(r>=e)return s;if(s==n.length)break;r+=n.charCodeAt(s)==9?t-r%t:1,s=Nn(n,s)}return n.length}const eh="ͼ",jf=typeof Symbol>"u"?"__"+eh:Symbol.for(eh),th=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),qf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Qs{constructor(e,t){this.rules=[];let{finish:i}=t||{};function s(a){return/^@/.test(a)?[a]:a.split(/,\s*/)}function r(a,o,l,c){let u=[],h=/^@(\w+)\b/.exec(a[0]),d=h&&h[1]=="keyframes";if(h&&o==null)return l.push(a[0]+";");for(let f in o){let m=o[f];if(/&/.test(f))r(f.split(/,\s*/).map(g=>a.map(y=>g.replace(/&/,y))).reduce((g,y)=>g.concat(y)),m,l);else if(m&&typeof m=="object"){if(!h)throw new RangeError("The value of a property ("+f+") should be a primitive value.");r(s(f),m,u,d)}else m!=null&&u.push(f.replace(/_.*/,"").replace(/[A-Z]/g,g=>"-"+g.toLowerCase())+": "+m+";")}(u.length||d)&&l.push((i&&!h&&!c?a.map(i):a).join(", ")+" {"+u.join(" ")+"}")}for(let a in e)r(s(a),e[a],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=qf[jf]||1;return qf[jf]=e+1,eh+e.toString(36)}static mount(e,t,i){let s=e[th],r=i&&i.nonce;s?r&&s.setNonce(r):s=new Zx(e,r),s.mount(Array.isArray(t)?t:[t],e)}}let Gf=new Map;class Zx{constructor(e,t){let i=e.ownerDocument||e,s=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let r=Gf.get(i);if(r)return e[th]=r;this.sheet=new s.CSSStyleSheet,Gf.set(i,this)}else this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);this.modules=[],e[th]=this}mount(e,t){let i=this.sheet,s=0,r=0;for(let a=0;a<e.length;a++){let o=e[a],l=this.modules.indexOf(o);if(l<r&&l>-1&&(this.modules.splice(l,1),r--,l=-1),l==-1){if(this.modules.splice(r++,0,o),i)for(let c=0;c<o.rules.length;c++)i.insertRule(o.rules[c],s++)}else{for(;r<l;)s+=this.modules[r++].rules.length;s+=o.rules.length,r++}}if(i)t.adoptedStyleSheets.indexOf(this.sheet)<0&&(t.adoptedStyleSheets=[this.sheet,...t.adoptedStyleSheets]);else{let a="";for(let l=0;l<this.modules.length;l++)a+=this.modules[l].getRules()+`
`;this.styleTag.textContent=a;let o=t.head||t;this.styleTag.parentNode!=o&&o.insertBefore(this.styleTag,o.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Rs={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},_a={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},jx=typeof navigator<"u"&&/Mac/.test(navigator.platform),qx=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Sn=0;Sn<10;Sn++)Rs[48+Sn]=Rs[96+Sn]=String(Sn);for(var Sn=1;Sn<=24;Sn++)Rs[Sn+111]="F"+Sn;for(var Sn=65;Sn<=90;Sn++)Rs[Sn]=String.fromCharCode(Sn+32),_a[Sn]=String.fromCharCode(Sn);for(var xu in Rs)_a.hasOwnProperty(xu)||(_a[xu]=Rs[xu]);function Gx(n){var e=jx&&n.metaKey&&n.shiftKey&&!n.ctrlKey&&!n.altKey||qx&&n.shiftKey&&n.key&&n.key.length==1||n.key=="Unidentified",t=!e&&n.key||(n.shiftKey?_a:Rs)[n.keyCode]||n.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}let Bn=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},nh=typeof document<"u"?document:{documentElement:{style:{}}};const ih=/Edge\/(\d+)/.exec(Bn.userAgent),q0=/MSIE \d/.test(Bn.userAgent),sh=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Bn.userAgent),Ql=!!(q0||sh||ih),Wf=!Ql&&/gecko\/(\d+)/i.test(Bn.userAgent),Cu=!Ql&&/Chrome\/(\d+)/.exec(Bn.userAgent),Wx="webkitFontSmoothing"in nh.documentElement.style,rh=!Ql&&/Apple Computer/.test(Bn.vendor),Xf=rh&&(/Mobile\/\w+/.test(Bn.userAgent)||Bn.maxTouchPoints>2);var Pe={mac:Xf||/Mac/.test(Bn.platform),windows:/Win/.test(Bn.platform),linux:/Linux|X11/.test(Bn.platform),ie:Ql,ie_version:q0?nh.documentMode||6:sh?+sh[1]:ih?+ih[1]:0,gecko:Wf,gecko_version:Wf?+(/Firefox\/(\d+)/.exec(Bn.userAgent)||[0,0])[1]:0,chrome:!!Cu,chrome_version:Cu?+Cu[1]:0,ios:Xf,android:/Android\b/.test(Bn.userAgent),webkit_version:Wx?+(/\bAppleWebKit\/(\d+)/.exec(Bn.userAgent)||[0,0])[1]:0,safari:rh,safari_version:rh?+(/\bVersion\/(\d+(\.\d+)?)/.exec(Bn.userAgent)||[0,0])[1]:0,tabSize:nh.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};function Fa(n){let e;return n.nodeType==11?e=n.getSelection?n:n.ownerDocument:e=n,e.getSelection()}function ah(n,e){return e?n==e||n.contains(e.nodeType!=1?e.parentNode:e):!1}function zo(n,e){if(!e.anchorNode)return!1;try{return ah(n,e.anchorNode)}catch{return!1}}function Ba(n){return n.nodeType==3?fr(n,0,n.nodeValue.length).getClientRects():n.nodeType==1?n.getClientRects():[]}function Pa(n,e,t,i){return t?Uf(n,e,t,i,-1)||Uf(n,e,t,i,1):!1}function dr(n){for(var e=0;;e++)if(n=n.previousSibling,!n)return e}function tl(n){return n.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(n.nodeName)}function Uf(n,e,t,i,s){for(;;){if(n==t&&e==i)return!0;if(e==(s<0?0:os(n))){if(n.nodeName=="DIV")return!1;let r=n.parentNode;if(!r||r.nodeType!=1)return!1;e=dr(n)+(s<0?0:1),n=r}else if(n.nodeType==1){if(n=n.childNodes[e+(s<0?-1:0)],n.nodeType==1&&n.contentEditable=="false")return!1;e=s<0?os(n):0}else return!1}}function os(n){return n.nodeType==3?n.nodeValue.length:n.childNodes.length}function Rl(n,e){let t=e?n.left:n.right;return{left:t,right:t,top:n.top,bottom:n.bottom}}function Xx(n){let e=n.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:n.innerWidth,top:0,bottom:n.innerHeight}}function G0(n,e){let t=e.width/n.offsetWidth,i=e.height/n.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-n.offsetWidth)<1)&&(t=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(e.height-n.offsetHeight)<1)&&(i=1),{scaleX:t,scaleY:i}}function Ux(n,e,t,i,s,r,a,o){let l=n.ownerDocument,c=l.defaultView||window;for(let u=n,h=!1;u&&!h;)if(u.nodeType==1){let d,f=u==l.body,m=1,g=1;if(f)d=Xx(c);else{if(/^(fixed|sticky)$/.test(getComputedStyle(u).position)&&(h=!0),u.scrollHeight<=u.clientHeight&&u.scrollWidth<=u.clientWidth){u=u.assignedSlot||u.parentNode;continue}let P=u.getBoundingClientRect();({scaleX:m,scaleY:g}=G0(u,P)),d={left:P.left,right:P.left+u.clientWidth*m,top:P.top,bottom:P.top+u.clientHeight*g}}let y=0,b=0;if(s=="nearest")e.top<d.top?(b=e.top-(d.top+a),t>0&&e.bottom>d.bottom+b&&(b=e.bottom-d.bottom+a)):e.bottom>d.bottom&&(b=e.bottom-d.bottom+a,t<0&&e.top-b<d.top&&(b=e.top-(d.top+a)));else{let P=e.bottom-e.top,k=d.bottom-d.top;b=(s=="center"&&P<=k?e.top+P/2-k/2:s=="start"||s=="center"&&t<0?e.top-a:e.bottom-k+a)-d.top}if(i=="nearest"?e.left<d.left?(y=e.left-(d.left+r),t>0&&e.right>d.right+y&&(y=e.right-d.right+r)):e.right>d.right&&(y=e.right-d.right+r,t<0&&e.left<d.left+y&&(y=e.left-(d.left+r))):y=(i=="center"?e.left+(e.right-e.left)/2-(d.right-d.left)/2:i=="start"==o?e.left-r:e.right-(d.right-d.left)+r)-d.left,y||b)if(f)c.scrollBy(y,b);else{let P=0,k=0;if(b){let w=u.scrollTop;u.scrollTop+=b/g,k=(u.scrollTop-w)*g}if(y){let w=u.scrollLeft;u.scrollLeft+=y/m,P=(u.scrollLeft-w)*m}e={left:e.left-P,top:e.top-k,right:e.right-P,bottom:e.bottom-k},P&&Math.abs(P-y)<1&&(i="nearest"),k&&Math.abs(k-b)<1&&(s="nearest")}if(f)break;(e.top<d.top||e.bottom>d.bottom||e.left<d.left||e.right>d.right)&&(e={left:Math.max(e.left,d.left),right:Math.min(e.right,d.right),top:Math.max(e.top,d.top),bottom:Math.min(e.bottom,d.bottom)}),u=u.assignedSlot||u.parentNode}else if(u.nodeType==11)u=u.host;else break}function Yx(n){let e=n.ownerDocument,t,i;for(let s=n.parentNode;s&&!(s==e.body||t&&i);)if(s.nodeType==1)!i&&s.scrollHeight>s.clientHeight&&(i=s),!t&&s.scrollWidth>s.clientWidth&&(t=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:t,y:i}}class Hx{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?os(t):0),i,Math.min(e.focusOffset,i?os(i):0))}set(e,t,i,s){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=s}}let Hs=null;Pe.safari&&Pe.safari_version>=26&&(Hs=!1);function W0(n){if(n.setActive)return n.setActive();if(Hs)return n.focus(Hs);let e=[];for(let t=n;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(n.focus(Hs==null?{get preventScroll(){return Hs={preventScroll:!0},!0}}:void 0),!Hs){Hs=!1;for(let t=0;t<e.length;){let i=e[t++],s=e[t++],r=e[t++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let Yf;function fr(n,e,t=e){let i=Yf||(Yf=document.createRange());return i.setEnd(n,t),i.setStart(n,e),i}function _r(n,e,t,i){let s={key:e,code:e,keyCode:t,which:t,cancelable:!0};i&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=i);let r=new KeyboardEvent("keydown",s);r.synthetic=!0,n.dispatchEvent(r);let a=new KeyboardEvent("keyup",s);return a.synthetic=!0,n.dispatchEvent(a),r.defaultPrevented||a.defaultPrevented}function Kx(n){for(;n;){if(n&&(n.nodeType==9||n.nodeType==11&&n.host))return n;n=n.assignedSlot||n.parentNode}return null}function X0(n){for(;n.attributes.length;)n.removeAttributeNode(n.attributes[0])}function Jx(n,e){let t=e.focusNode,i=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=i)return!1;for(i=Math.min(i,os(t));;)if(i){if(t.nodeType!=1)return!1;let s=t.childNodes[i-1];s.contentEditable=="false"?i--:(t=s,i=os(t))}else{if(t==n)return!0;i=dr(t),t=t.parentNode}}function U0(n){return n.scrollTop>Math.max(1,n.scrollHeight-n.clientHeight-4)}function Y0(n,e){for(let t=n,i=e;;){if(t.nodeType==3&&i>0)return{node:t,offset:i};if(t.nodeType==1&&i>0){if(t.contentEditable=="false")return null;t=t.childNodes[i-1],i=os(t)}else if(t.parentNode&&!tl(t))i=dr(t),t=t.parentNode;else return null}}function H0(n,e){for(let t=n,i=e;;){if(t.nodeType==3&&i<t.nodeValue.length)return{node:t,offset:i};if(t.nodeType==1&&i<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[i],i=0}else if(t.parentNode&&!tl(t))i=dr(t)+1,t=t.parentNode;else return null}}class $n{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new $n(e.parentNode,dr(e),t)}static after(e,t){return new $n(e.parentNode,dr(e)+1,t)}}const pd=[];class Dt{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let i=this.dom,s=null,r;for(let a of this.children){if(a.flags&7){if(!a.dom&&(r=s?s.nextSibling:i.firstChild)){let o=Dt.get(r);(!o||!o.parent&&o.canReuseDOM(a))&&a.reuseDOM(r)}a.sync(e,t),a.flags&=-8}if(r=s?s.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&r!=a.dom&&(t.written=!0),a.dom.parentNode==i)for(;r&&r!=a.dom;)r=Hf(r);else i.insertBefore(a.dom,r);s=a.dom}for(r=s?s.nextSibling:i.firstChild,r&&t&&t.node==i&&(t.written=!0);r;)r=Hf(r)}else if(this.flags&1)for(let i of this.children)i.flags&7&&(i.sync(e,t),i.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let s=os(e)==0?0:t==0?-1:1;for(;;){let r=e.parentNode;if(r==this.dom)break;s==0&&r.firstChild!=r.lastChild&&(e==r.firstChild?s=-1:s=1),e=r}s<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Dt.get(i);)i=i.nextSibling;if(!i)return this.length;for(let s=0,r=0;;s++){let a=this.children[s];if(a.dom==i)return r;r+=a.length+a.breakAfter}}domBoundsAround(e,t,i=0){let s=-1,r=-1,a=-1,o=-1;for(let l=0,c=i,u=i;l<this.children.length;l++){let h=this.children[l],d=c+h.length;if(c<e&&d>t)return h.domBoundsAround(e,t,c);if(d>=e&&s==-1&&(s=l,r=c),c>t&&h.dom.parentNode==this.dom){a=l,o=u;break}u=d,c=d+h.breakAfter}return{from:r,to:o<0?i+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:a<this.children.length&&a>=0?this.children[a].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=pd){this.markDirty();for(let s=e;s<t;s++){let r=this.children[s];r.parent==this&&i.indexOf(r)<0&&r.destroy()}i.length<250?this.children.splice(e,t-e,...i):this.children=[].concat(this.children.slice(0,e),i,this.children.slice(t));for(let s=0;s<i.length;s++)i[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new K0(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,s,r,a){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}Dt.prototype.breakAfter=0;function Hf(n){let e=n.nextSibling;return n.parentNode.removeChild(n),e}class K0{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function J0(n,e,t,i,s,r,a,o,l){let{children:c}=n,u=c.length?c[e]:null,h=r.length?r[r.length-1]:null,d=h?h.breakAfter:a;if(!(e==i&&u&&!a&&!d&&r.length<2&&u.merge(t,s,r.length?h:null,t==0,o,l))){if(i<c.length){let f=c[i];f&&(s<f.length||f.breakAfter&&(h!=null&&h.breakAfter))?(e==i&&(f=f.split(s),s=0),!d&&h&&f.merge(0,s,h,!0,0,l)?r[r.length-1]=f:((s||f.children.length&&!f.children[0].length)&&f.merge(0,s,null,!1,0,l),r.push(f))):f!=null&&f.breakAfter&&(h?h.breakAfter=1:a=1),i++}for(u&&(u.breakAfter=a,t>0&&(!a&&r.length&&u.merge(t,u.length,r[0],!1,o,0)?u.breakAfter=r.shift().breakAfter:(t<u.length||u.children.length&&u.children[u.children.length-1].length==0)&&u.merge(t,u.length,null,!1,o,0),e++));e<i&&r.length;)if(c[i-1].become(r[r.length-1]))i--,r.pop(),l=r.length?0:o;else if(c[e].become(r[0]))e++,r.shift(),o=r.length?0:l;else break;!r.length&&e&&i<c.length&&!c[e-1].breakAfter&&c[i].merge(0,0,c[e-1],!1,o,l)&&e--,(e<i||r.length)&&n.replaceChildren(e,i,r)}}function e1(n,e,t,i,s,r){let a=n.childCursor(),{i:o,off:l}=a.findPos(t,1),{i:c,off:u}=a.findPos(e,-1),h=e-t;for(let d of i)h+=d.length;n.length+=h,J0(n,c,u,o,l,i,0,s,r)}const eC=256;class _i extends Dt{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return this.flags&8||i&&(!(i instanceof _i)||this.length-(t-e)+i.length>eC||i.flags&8)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new _i(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new $n(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return tC(this.dom,e,t)}}class ys extends Dt{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let s of t)s.setParent(this)}setAttrs(e){if(X0(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,i,s,r,a){return i&&(!(i instanceof ys&&i.mark.eq(this.mark))||e&&r<=0||t<this.length&&a<=0)?!1:(e1(this,e,t,i?i.children.slice():[],r-1,a-1),this.markDirty(),!0)}split(e){let t=[],i=0,s=-1,r=0;for(let o of this.children){let l=i+o.length;l>e&&t.push(i<e?o.split(e-i):o),s<0&&i>=e&&(s=r),i=l,r++}let a=this.length-e;return this.length=e,s>-1&&(this.children.length=s,this.markDirty()),new ys(this.mark,t,a)}domAtPos(e){return t1(this,e)}coordsAt(e,t){return i1(this,e,t)}}function tC(n,e,t){let i=n.nodeValue.length;e>i&&(e=i);let s=e,r=e,a=0;e==0&&t<0||e==i&&t>=0?Pe.chrome||Pe.gecko||(e?(s--,a=1):r<i&&(r++,a=-1)):t<0?s--:r<i&&r++;let o=fr(n,s,r).getClientRects();if(!o.length)return null;let l=o[(a?a<0:t>=0)?0:o.length-1];return Pe.safari&&!a&&l.width==0&&(l=Array.prototype.find.call(o,c=>c.width)||l),a?Rl(l,a<0):l||null}class nr extends Dt{static create(e,t,i){return new nr(e,t,i)}constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}split(e){let t=nr.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,i,s,r,a){return i&&(!(i instanceof nr)||!this.widget.compare(i.widget)||e>0&&r<=0||t<this.length&&a<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e instanceof nr&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return pt.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):pt.empty}domAtPos(e){return(this.length?e==0:this.side>0)?$n.before(this.dom):$n.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let s=this.dom.getClientRects(),r=null;if(!s.length)return null;let a=this.side?this.side<0:e>0;for(let o=a?s.length-1:0;r=s[o],!(e>0?o==0:o==s.length-1||r.top<r.bottom);o+=a?-1:1);return Rl(r,!a)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Rr extends Dt{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Rr&&e.side==this.side}split(){return new Rr(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?$n.before(this.dom):$n.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return pt.empty}get isHidden(){return!0}}_i.prototype.children=nr.prototype.children=Rr.prototype.children=pd;function t1(n,e){let t=n.dom,{children:i}=n,s=0;for(let r=0;s<i.length;s++){let a=i[s],o=r+a.length;if(!(o==r&&a.getSide()<=0)){if(e>r&&e<o&&a.dom.parentNode==t)return a.domAtPos(e-r);if(e<=r)break;r=o}}for(let r=s;r>0;r--){let a=i[r-1];if(a.dom.parentNode==t)return a.domAtPos(a.length)}for(let r=s;r<i.length;r++){let a=i[r];if(a.dom.parentNode==t)return a.domAtPos(0)}return new $n(t,0)}function n1(n,e,t){let i,{children:s}=n;t>0&&e instanceof ys&&s.length&&(i=s[s.length-1])instanceof ys&&i.mark.eq(e.mark)?n1(i,e.children[0],t-1):(s.push(e),e.setParent(n)),n.length+=e.length}function i1(n,e,t){let i=null,s=-1,r=null,a=-1;function o(c,u){for(let h=0,d=0;h<c.children.length&&d<=u;h++){let f=c.children[h],m=d+f.length;m>=u&&(f.children.length?o(f,u-d):(!r||r.isHidden&&(t>0||iC(r,f)))&&(m>u||d==m&&f.getSide()>0)?(r=f,a=u-d):(d<u||d==m&&f.getSide()<0&&!f.isHidden)&&(i=f,s=u-d)),d=m}}o(n,e);let l=(t<0?i:r)||i||r;return l?l.coordsAt(Math.max(0,l==i?s:a),t):nC(n)}function nC(n){let e=n.dom.lastChild;if(!e)return n.dom.getBoundingClientRect();let t=Ba(e);return t[t.length-1]||null}function iC(n,e){let t=n.coordsAt(0,1),i=e.coordsAt(0,1);return t&&i&&i.top<t.bottom}function oh(n,e){for(let t in n)t=="class"&&e.class?e.class+=" "+n.class:t=="style"&&e.style?e.style+=";"+n.style:e[t]=n[t];return e}const Kf=Object.create(null);function nl(n,e,t){if(n==e)return!0;n||(n=Kf),e||(e=Kf);let i=Object.keys(n),s=Object.keys(e);if(i.length-(t&&i.indexOf(t)>-1?1:0)!=s.length-(t&&s.indexOf(t)>-1?1:0))return!1;for(let r of i)if(r!=t&&(s.indexOf(r)==-1||n[r]!==e[r]))return!1;return!0}function lh(n,e,t){let i=!1;if(e)for(let s in e)t&&s in t||(i=!0,s=="style"?n.style.cssText="":n.removeAttribute(s));if(t)for(let s in t)e&&e[s]==t[s]||(i=!0,s=="style"?n.style.cssText=t[s]:n.setAttribute(s,t[s]));return i}function sC(n){let e=Object.create(null);for(let t=0;t<n.attributes.length;t++){let i=n.attributes[t];e[i.name]=i.value}return e}class qr{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var gi=(function(n){return n[n.Text=0]="Text",n[n.WidgetBefore=1]="WidgetBefore",n[n.WidgetAfter=2]="WidgetAfter",n[n.WidgetRange=3]="WidgetRange",n})(gi||(gi={}));class nt extends hr{constructor(e,t,i,s){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(e){return new Wa(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new Ls(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,s;if(e.isBlockGap)i=-5e8,s=4e8;else{let{start:r,end:a}=s1(e,t);i=(r?t?-3e8:-1:5e8)-1,s=(a?t?2e8:1:-6e8)+1}return new Ls(e,i,s,t,e.widget||null,!0)}static line(e){return new Xa(e)}static set(e,t=!1){return vt.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}nt.none=vt.empty;class Wa extends nt{constructor(e){let{start:t,end:i}=s1(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,i;return this==e||e instanceof Wa&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((i=e.attrs)===null||i===void 0?void 0:i.class))&&nl(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}Wa.prototype.point=!1;class Xa extends nt{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof Xa&&this.spec.class==e.spec.class&&nl(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}Xa.prototype.mapMode=En.TrackBefore;Xa.prototype.point=!0;class Ls extends nt{constructor(e,t,i,s,r,a){super(t,i,r,e),this.block=s,this.isReplace=a,this.mapMode=s?t<=0?En.TrackBefore:En.TrackAfter:En.TrackDel}get type(){return this.startSide!=this.endSide?gi.WidgetRange:this.startSide<=0?gi.WidgetBefore:gi.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof Ls&&rC(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}Ls.prototype.point=!0;function s1(n,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=n;return t==null&&(t=n.inclusive),i==null&&(i=n.inclusive),{start:t??e,end:i??e}}function rC(n,e){return n==e||!!(n&&e&&n.compare(e))}function Zo(n,e,t,i=0){let s=t.length-1;s>=0&&t[s]+i>=n?t[s]=Math.max(t[s],e):t.push(n,e)}class sn extends Dt{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,s,r,a){if(i){if(!(i instanceof sn))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),e1(this,e,t,i?i.children.slice():[],r,a),!0}split(e){let t=new sn;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:s}=this.childPos(e);s&&(t.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)t.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){nl(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){n1(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=oh(t,this.attrs||{})),i&&(this.attrs=oh({class:i},this.attrs||{}))}domAtPos(e){return t1(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var i;this.dom?this.flags&4&&(X0(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(lh(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let s=this.dom.lastChild;for(;s&&Dt.get(s)instanceof ys;)s=s.lastChild;if(!s||!this.length||s.nodeName!="BR"&&((i=Dt.get(s))===null||i===void 0?void 0:i.isEditable)==!1&&(!Pe.ios||!this.children.some(r=>r instanceof _i))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let i of this.children){if(!(i instanceof _i)||/[^ -~]/.test(i.text))return null;let s=Ba(i.dom);if(s.length!=1)return null;e+=s[0].width,t=s[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let i=i1(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:s}=this.parent.view.viewState,r=i.bottom-i.top;if(Math.abs(r-s.lineHeight)<2&&s.textHeight<r){let a=(r-s.textHeight)/2;return{top:i.top+a,bottom:i.bottom-a,left:i.left,right:i.left}}}return i}become(e){return e instanceof sn&&this.children.length==0&&e.children.length==0&&nl(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,t){for(let i=0,s=0;i<e.children.length;i++){let r=e.children[i],a=s+r.length;if(a>=t){if(r instanceof sn)return r;if(a>t)break}s=a+r.breakAfter}return null}}class Os extends Dt{constructor(e,t,i){super(),this.widget=e,this.length=t,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,s,r,a){return i&&(!(i instanceof Os)||!this.widget.compare(i.widget)||e>0&&r<=0||t<this.length&&a<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?$n.before(this.dom):$n.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new Os(this.widget,t,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return pd}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):pt.empty}domBoundsAround(){return null}become(e){return e instanceof Os&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);return i||(this.widget instanceof uh?null:Rl(this.dom.getBoundingClientRect(),this.length?e==0:t<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:i}=this.deco;return t==i?!1:e<0?t<0:i>0}}class uh extends qr{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class xa{constructor(e,t,i,s){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof Os&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new sn),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(ho(new Rr(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof Os)&&this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:a,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=a,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e),r=Math.min(s,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(ho(new _i(this.text.slice(this.textOff,this.textOff+r)),t),i),this.atCursorPos=!0,this.textOff+=r,e-=r,i=s<=r?0:t.length}}span(e,t,i,s){this.buildText(t-e,i,s),this.pos=t,this.openStart<0&&(this.openStart=s)}point(e,t,i,s,r,a){if(this.disallowBlockEffectsFor[a]&&i instanceof Ls){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=t-e;if(i instanceof Ls)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Os(i.widget||Lr.block,o,i));else{let l=nr.create(i.widget||Lr.inline,o,o?0:i.startSide),c=this.atCursorPos&&!l.isEditable&&r<=s.length&&(e<t||i.startSide>0),u=!l.isEditable&&(e<t||r>s.length||i.startSide<=0),h=this.getLine();this.pendingBuffer==2&&!c&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(s),c&&(h.append(ho(new Rr(1),s),r),r=s.length+Math.max(0,r-s.length)),h.append(ho(l,s),r),this.atCursorPos=u,this.pendingBuffer=u?e<t||r>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=r)}static build(e,t,i,s,r){let a=new xa(e,t,i,r);return a.openEnd=vt.spans(s,t,i,a),a.openStart<0&&(a.openStart=a.openEnd),a.finish(a.openEnd),a}}function ho(n,e){for(let t of e)n=new ys(t,[n],n.length);return n}class Lr extends qr{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Lr.inline=new Lr("span");Lr.block=new Lr("div");var cn=(function(n){return n[n.LTR=0]="LTR",n[n.RTL=1]="RTL",n})(cn||(cn={}));const pr=cn.LTR,md=cn.RTL;function r1(n){let e=[];for(let t=0;t<n.length;t++)e.push(1<<+n[t]);return e}const aC=r1("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),oC=r1("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),ch=Object.create(null),ji=[];for(let n of["()","[]","{}"]){let e=n.charCodeAt(0),t=n.charCodeAt(1);ch[e]=t,ch[t]=-e}function a1(n){return n<=247?aC[n]:1424<=n&&n<=1524?2:1536<=n&&n<=1785?oC[n-1536]:1774<=n&&n<=2220?4:8192<=n&&n<=8204?256:64336<=n&&n<=65023?4:1}const lC=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class _s{get dir(){return this.level%2?md:pr}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,s){let r=-1;for(let a=0;a<e.length;a++){let o=e[a];if(o.from<=t&&o.to>=t){if(o.level==i)return a;(r<0||(s!=0?s<0?o.from<t:o.to>t:e[r].level>o.level))&&(r=a)}}if(r<0)throw new RangeError("Index out of range");return r}}function o1(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++){let i=n[t],s=e[t];if(i.from!=s.from||i.to!=s.to||i.direction!=s.direction||!o1(i.inner,s.inner))return!1}return!0}const Bt=[];function uC(n,e,t,i,s){for(let r=0;r<=i.length;r++){let a=r?i[r-1].to:e,o=r<i.length?i[r].from:t,l=r?256:s;for(let c=a,u=l,h=l;c<o;c++){let d=a1(n.charCodeAt(c));d==512?d=u:d==8&&h==4&&(d=16),Bt[c]=d==4?2:d,d&7&&(h=d),u=d}for(let c=a,u=l,h=l;c<o;c++){let d=Bt[c];if(d==128)c<o-1&&u==Bt[c+1]&&u&24?d=Bt[c]=u:Bt[c]=256;else if(d==64){let f=c+1;for(;f<o&&Bt[f]==64;)f++;let m=c&&u==8||f<t&&Bt[f]==8?h==1?1:8:256;for(let g=c;g<f;g++)Bt[g]=m;c=f-1}else d==8&&h==1&&(Bt[c]=1);u=d,d&7&&(h=d)}}}function cC(n,e,t,i,s){let r=s==1?2:1;for(let a=0,o=0,l=0;a<=i.length;a++){let c=a?i[a-1].to:e,u=a<i.length?i[a].from:t;for(let h=c,d,f,m;h<u;h++)if(f=ch[d=n.charCodeAt(h)])if(f<0){for(let g=o-3;g>=0;g-=3)if(ji[g+1]==-f){let y=ji[g+2],b=y&2?s:y&4?y&1?r:s:0;b&&(Bt[h]=Bt[ji[g]]=b),o=g;break}}else{if(ji.length==189)break;ji[o++]=h,ji[o++]=d,ji[o++]=l}else if((m=Bt[h])==2||m==1){let g=m==s;l=g?0:1;for(let y=o-3;y>=0;y-=3){let b=ji[y+2];if(b&2)break;if(g)ji[y+2]|=2;else{if(b&4)break;ji[y+2]|=4}}}}}function hC(n,e,t,i){for(let s=0,r=i;s<=t.length;s++){let a=s?t[s-1].to:n,o=s<t.length?t[s].from:e;for(let l=a;l<o;){let c=Bt[l];if(c==256){let u=l+1;for(;;)if(u==o){if(s==t.length)break;u=t[s++].to,o=s<t.length?t[s].from:e}else if(Bt[u]==256)u++;else break;let h=r==1,d=(u<e?Bt[u]:i)==1,f=h==d?h?1:2:i;for(let m=u,g=s,y=g?t[g-1].to:n;m>l;)m==y&&(m=t[--g].from,y=g?t[g-1].to:n),Bt[--m]=f;l=u}else r=c,l++}}}function hh(n,e,t,i,s,r,a){let o=i%2?2:1;if(i%2==s%2)for(let l=e,c=0;l<t;){let u=!0,h=!1;if(c==r.length||l<r[c].from){let g=Bt[l];g!=o&&(u=!1,h=g==16)}let d=!u&&o==1?[]:null,f=u?i:i+1,m=l;e:for(;;)if(c<r.length&&m==r[c].from){if(h)break e;let g=r[c];if(!u)for(let y=g.to,b=c+1;;){if(y==t)break e;if(b<r.length&&r[b].from==y)y=r[b++].to;else{if(Bt[y]==o)break e;break}}if(c++,d)d.push(g);else{g.from>l&&a.push(new _s(l,g.from,f));let y=g.direction==pr!=!(f%2);dh(n,y?i+1:i,s,g.inner,g.from,g.to,a),l=g.to}m=g.to}else{if(m==t||(u?Bt[m]!=o:Bt[m]==o))break;m++}d?hh(n,l,m,i+1,s,d,a):l<m&&a.push(new _s(l,m,f)),l=m}else for(let l=t,c=r.length;l>e;){let u=!0,h=!1;if(!c||l>r[c-1].to){let g=Bt[l-1];g!=o&&(u=!1,h=g==16)}let d=!u&&o==1?[]:null,f=u?i:i+1,m=l;e:for(;;)if(c&&m==r[c-1].to){if(h)break e;let g=r[--c];if(!u)for(let y=g.from,b=c;;){if(y==e)break e;if(b&&r[b-1].to==y)y=r[--b].from;else{if(Bt[y-1]==o)break e;break}}if(d)d.push(g);else{g.to<l&&a.push(new _s(g.to,l,f));let y=g.direction==pr!=!(f%2);dh(n,y?i+1:i,s,g.inner,g.from,g.to,a),l=g.from}m=g.from}else{if(m==e||(u?Bt[m-1]!=o:Bt[m-1]==o))break;m--}d?hh(n,m,l,i+1,s,d,a):m<l&&a.push(new _s(m,l,f)),l=m}}function dh(n,e,t,i,s,r,a){let o=e%2?2:1;uC(n,s,r,i,o),cC(n,s,r,i,o),hC(s,r,i,o),hh(n,s,r,e,t,i,a)}function dC(n,e,t){if(!n)return[new _s(0,0,e==md?1:0)];if(e==pr&&!t.length&&!lC.test(n))return l1(n.length);if(t.length)for(;n.length>Bt.length;)Bt[Bt.length]=256;let i=[],s=e==pr?0:1;return dh(n,s,s,t,0,n.length,i),i}function l1(n){return[new _s(0,n,0)]}let u1="";function fC(n,e,t,i,s){var r;let a=i.head-n.from,o=_s.find(e,a,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc),l=e[o],c=l.side(s,t);if(a==c){let d=o+=s?1:-1;if(d<0||d>=e.length)return null;l=e[o=d],a=l.side(!s,t),c=l.side(s,t)}let u=Nn(n.text,a,l.forward(s,t));(u<l.from||u>l.to)&&(u=c),u1=n.text.slice(Math.min(a,u),Math.max(a,u));let h=o==(s?e.length-1:0)?null:e[o+(s?1:-1)];return h&&u==c&&h.level+(s?0:1)<l.level?le.cursor(h.side(!s,t)+n.from,h.forward(s,t)?1:-1,h.level):le.cursor(u+n.from,l.forward(s,t)?-1:1,l.level)}function pC(n,e,t){for(let i=e;i<t;i++){let s=a1(n.charCodeAt(i));if(s==1)return pr;if(s==2||s==4)return md}return pr}const c1=Be.define(),h1=Be.define(),d1=Be.define(),f1=Be.define(),fh=Be.define(),p1=Be.define(),m1=Be.define(),gd=Be.define(),Od=Be.define(),g1=Be.define({combine:n=>n.some(e=>e)}),mC=Be.define({combine:n=>n.some(e=>e)}),O1=Be.define();class Fr{constructor(e,t="nearest",i="nearest",s=5,r=5,a=!1){this.range=e,this.y=t,this.x=i,this.yMargin=s,this.xMargin=r,this.isSnapshot=a}map(e){return e.empty?this:new Fr(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new Fr(le.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const fo=kt.define({map:(n,e)=>n.map(e)}),y1=kt.define();function Ki(n,e,t){let i=n.facet(f1);i.length?i[0](e):window.onerror&&window.onerror(String(e),t,void 0,void 0,e)||(t?console.error(t+":",e):console.error(e))}const ms=Be.define({combine:n=>n.length?n[0]:!0});let gC=0;const $r=Be.define({combine(n){return n.filter((e,t)=>{for(let i=0;i<t;i++)if(n[i].plugin==e.plugin)return!1;return!0})}});class ls{constructor(e,t,i,s,r){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=s,this.baseExtensions=r(this),this.extension=this.baseExtensions.concat($r.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat($r.of({plugin:this,arg:e}))}static define(e,t){const{eventHandlers:i,eventObservers:s,provide:r,decorations:a}=t||{};return new ls(gC++,e,i,s,o=>{let l=[];return a&&l.push(Na.of(c=>{let u=c.plugin(o);return u?a(u):nt.none})),r&&l.push(r(o)),l})}static fromClass(e,t){return ls.define((i,s)=>new e(i,s),t)}}class Au{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(Ki(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(t){Ki(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){Ki(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const b1=Be.define(),yd=Be.define(),Na=Be.define(),v1=Be.define(),Ua=Be.define(),S1=Be.define();function Jf(n,e){let t=n.state.facet(S1);if(!t.length)return t;let i=t.map(r=>r instanceof Function?r(n):r),s=[];return vt.spans(i,e.from,e.to,{point(){},span(r,a,o,l){let c=r-e.from,u=a-e.from,h=s;for(let d=o.length-1;d>=0;d--,l--){let f=o[d].spec.bidiIsolate,m;if(f==null&&(f=pC(e.text,c,u)),l>0&&h.length&&(m=h[h.length-1]).to==c&&m.direction==f)m.to=u,h=m.inner;else{let g={from:c,to:u,direction:f,inner:[]};h.push(g),h=g.inner}}}}),s}const w1=Be.define();function P1(n){let e=0,t=0,i=0,s=0;for(let r of n.state.facet(w1)){let a=r(n);a&&(a.left!=null&&(e=Math.max(e,a.left)),a.right!=null&&(t=Math.max(t,a.right)),a.top!=null&&(i=Math.max(i,a.top)),a.bottom!=null&&(s=Math.max(s,a.bottom)))}return{left:e,right:t,top:i,bottom:s}}const ga=Be.define();class Oi{constructor(e,t,i,s){this.fromA=e,this.toA=t,this.fromB=i,this.toB=s}join(e){return new Oi(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let s=e[t-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let s=0,r=0,a=0,o=0;;s++){let l=s==e.length?null:e[s],c=a-o,u=l?l.fromB:1e9;for(;r<t.length&&t[r]<u;){let h=t[r],d=t[r+1],f=Math.max(o,h),m=Math.min(u,d);if(f<=m&&new Oi(f+c,m+c,f,m).addToSet(i),d>u)break;r+=2}if(!l)return i;new Oi(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),a=l.toA,o=l.toB}}}class il{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=ln.empty(this.startState.doc.length);for(let r of i)this.changes=this.changes.compose(r.changes);let s=[];this.changes.iterChangedRanges((r,a,o,l)=>s.push(new Oi(r,a,o,l))),this.changedRanges=s}static create(e,t,i){return new il(e,t,i)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class ep extends Dt{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=nt.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new sn],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Oi(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:c,toA:u})=>u<this.minWidthFrom||c>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?s=this.domChanged.newSel.head:!PC(e.changes,this.hasComposition)&&!e.selectionSet&&(s=e.state.selection.main.head));let r=s>-1?yC(this.view,e.changes,s):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:c,to:u}=this.hasComposition;i=new Oi(c,u,e.changes.mapPos(c,-1),e.changes.mapPos(u,1)).addToSet(i.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(Pe.ie||Pe.chrome)&&!r&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let a=this.decorations,o=this.updateDeco(),l=SC(a,o,e.changes);return i=Oi.extendWithRanges(i,l),!(this.flags&7)&&i.length==0?!1:(this.updateInner(i,e.startState.doc.length,r),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,i);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let a=Pe.chrome||Pe.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,a),this.flags&=-8,a&&(a.written||s.selectionRange.focusNode!=a.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(a=>a.flags&=-9);let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let a of this.children)a instanceof Os&&a.widget instanceof uh&&r.push(a.dom);s.updateGaps(r)}updateChildren(e,t,i){let s=i?i.range.addToSet(e.slice()):e,r=this.childCursor(t);for(let a=s.length-1;;a--){let o=a>=0?s[a]:null;if(!o)break;let{fromA:l,toA:c,fromB:u,toB:h}=o,d,f,m,g;if(i&&i.range.fromB<h&&i.range.toB>u){let w=xa.build(this.view.state.doc,u,i.range.fromB,this.decorations,this.dynamicDecorationMap),C=xa.build(this.view.state.doc,i.range.toB,h,this.decorations,this.dynamicDecorationMap);f=w.breakAtStart,m=w.openStart,g=C.openEnd;let $=this.compositionView(i);C.breakAtStart?$.breakAfter=1:C.content.length&&$.merge($.length,$.length,C.content[0],!1,C.openStart,0)&&($.breakAfter=C.content[0].breakAfter,C.content.shift()),w.content.length&&$.merge(0,0,w.content[w.content.length-1],!0,0,w.openEnd)&&w.content.pop(),d=w.content.concat($).concat(C.content)}else({content:d,breakAtStart:f,openStart:m,openEnd:g}=xa.build(this.view.state.doc,u,h,this.decorations,this.dynamicDecorationMap));let{i:y,off:b}=r.findPos(c,1),{i:P,off:k}=r.findPos(l,-1);J0(this,P,k,y,b,d,f,m,g)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let t of e.transactions)for(let i of t.effects)i.is(y1)&&(this.editContextFormatting=i.value)}compositionView(e){let t=new _i(e.text.nodeValue);t.flags|=8;for(let{deco:s}of e.marks)t=new ys(s,[t],t.length);let i=new sn;return i.append(t,0),i}fixCompositionDOM(e){let t=(r,a)=>{a.flags|=8|(a.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(a);let o=Dt.get(r);o&&o!=a&&(o.dom=null),a.setDOM(r)},i=this.childPos(e.range.fromB,1),s=this.children[i.i];t(e.line,s);for(let r=e.marks.length-1;r>=-1;r--)i=s.childPos(i.off,1),s=s.children[i.i],t(r>=0?e.marks[r].node:e.text,s)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let i=this.view.root.activeElement,s=i==this.dom,r=!s&&!(this.view.state.facet(ms)||this.dom.tabIndex>-1)&&zo(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(s||t||r))return;let a=this.forceSelection;this.forceSelection=!1;let o=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(o.anchor)),c=o.empty?l:this.moveToLine(this.domAtPos(o.head));if(Pe.gecko&&o.empty&&!this.hasComposition&&OC(l)){let h=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(h,l.node.childNodes[l.offset]||null)),l=c=new $n(h,0),a=!0}let u=this.view.observer.selectionRange;(a||!u.focusNode||(!Pa(l.node,l.offset,u.anchorNode,u.anchorOffset)||!Pa(c.node,c.offset,u.focusNode,u.focusOffset))&&!this.suppressWidgetCursorChange(u,o))&&(this.view.observer.ignore(()=>{Pe.android&&Pe.chrome&&this.dom.contains(u.focusNode)&&wC(u.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let h=Fa(this.view.root);if(h)if(o.empty){if(Pe.gecko){let d=bC(l.node,l.offset);if(d&&d!=3){let f=(d==1?Y0:H0)(l.node,l.offset);f&&(l=new $n(f.node,f.offset))}}h.collapse(l.node,l.offset),o.bidiLevel!=null&&h.caretBidiLevel!==void 0&&(h.caretBidiLevel=o.bidiLevel)}else if(h.extend){h.collapse(l.node,l.offset);try{h.extend(c.node,c.offset)}catch{}}else{let d=document.createRange();o.anchor>o.head&&([l,c]=[c,l]),d.setEnd(c.node,c.offset),d.setStart(l.node,l.offset),h.removeAllRanges(),h.addRange(d)}r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(l,c)),this.impreciseAnchor=l.precise?null:new $n(u.anchorNode,u.anchorOffset),this.impreciseHead=c.precise?null:new $n(u.focusNode,u.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&Pa(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=Fa(e.root),{anchorNode:s,anchorOffset:r}=e.observer.selectionRange;if(!i||!t.empty||!t.assoc||!i.modify)return;let a=sn.find(this,t.head);if(!a)return;let o=a.posAtStart;if(t.head==o||t.head==o+a.length)return;let l=this.coordsAt(t.head,-1),c=this.coordsAt(t.head,1);if(!l||!c||l.bottom>c.top)return;let u=this.domAtPos(t.head+t.assoc);i.collapse(u.node,u.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let h=e.observer.selectionRange;e.docView.posFromDOM(h.anchorNode,h.anchorOffset)!=t.from&&i.collapse(s,r)}moveToLine(e){let t=this.dom,i;if(e.node!=t)return e;for(let s=e.offset;!i&&s<t.childNodes.length;s++){let r=Dt.get(t.childNodes[s]);r instanceof sn&&(i=r.domAtPos(0))}for(let s=e.offset-1;!i&&s>=0;s--){let r=Dt.get(t.childNodes[s]);r instanceof sn&&(i=r.domAtPos(r.length))}return i?new $n(i.node,i.offset,!0):e}nearest(e){for(let t=e;t;){let i=Dt.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let s=this.children[t];if(i<s.length||s instanceof sn)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){let i=null,s=0;for(let r=this.length,a=this.children.length-1;a>=0;a--){let o=this.children[a],l=r-o.breakAfter,c=l-o.length;if(l<e)break;if(c<=e&&(c<e||o.covers(-1))&&(l>e||o.covers(1))&&(!i||o instanceof sn&&!(i instanceof sn&&t>=0)))i=o,s=c;else if(i&&c==e&&l==e&&o instanceof Os&&Math.abs(t)<2){if(o.deco.startSide<0)break;a&&(i=null)}r=c}return i?i.coordsAt(e-s,t):null}coordsForChar(e){let{i:t,off:i}=this.childPos(e,1),s=this.children[t];if(!(s instanceof sn))return null;for(;s.children.length;){let{i:o,off:l}=s.childPos(i,1);for(;;o++){if(o==s.children.length)return null;if((s=s.children[o]).length)break}i=l}if(!(s instanceof _i))return null;let r=Nn(s.text,i);if(r==i)return null;let a=fr(s.dom,i,r).getClientRects();for(let o=0;o<a.length;o++){let l=a[o];if(o==a.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(e){let t=[],{from:i,to:s}=e,r=this.view.contentDOM.clientWidth,a=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,l=this.view.textDirection==cn.LTR;for(let c=0,u=0;u<this.children.length;u++){let h=this.children[u],d=c+h.length;if(d>s)break;if(c>=i){let f=h.dom.getBoundingClientRect();if(t.push(f.height),a){let m=h.dom.lastChild,g=m?Ba(m):[];if(g.length){let y=g[g.length-1],b=l?y.right-f.left:f.right-y.left;b>o&&(o=b,this.minWidth=r,this.minWidthFrom=c,this.minWidthTo=d)}}}c=d+h.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?cn.RTL:cn.LTR}measureTextSize(){for(let r of this.children)if(r instanceof sn){let a=r.measureTextSize();if(a)return a}let e=document.createElement("div"),t,i,s;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=Ba(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,s=r?r.height:t,e.remove()}),{lineHeight:t,charWidth:i,textHeight:s}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new K0(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,s=0;;s++){let r=s==t.viewports.length?null:t.viewports[s],a=r?r.from-1:this.length;if(a>i){let o=(t.lineBlockAt(a).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(nt.replace({widget:new uh(o),block:!0,inclusive:!0,isBlockGap:!0}).range(i,a))}if(!r)break;i=r.to+1}return nt.set(e)}updateDeco(){let e=1,t=this.view.state.facet(Na).map(r=>(this.dynamicDecorationMap[e++]=typeof r=="function")?r(this.view):r),i=!1,s=this.view.state.facet(v1).map((r,a)=>{let o=typeof r=="function";return o&&(i=!0),o?r(this.view):r});for(s.length&&(this.dynamicDecorationMap[e++]=i,t.push(vt.join(s))),this.decorations=[this.editContextFormatting,...t,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let c=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=c.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let c of this.view.state.facet(O1))try{if(c(this.view,e.range,e))return!0}catch(u){Ki(this.view.state,u,"scroll handler")}let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),s;if(!i)return;!t.empty&&(s=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,s.left),top:Math.min(i.top,s.top),right:Math.max(i.right,s.right),bottom:Math.max(i.bottom,s.bottom)});let r=P1(this.view),a={left:i.left-r.left,top:i.top-r.top,right:i.right+r.right,bottom:i.bottom+r.bottom},{offsetWidth:o,offsetHeight:l}=this.view.scrollDOM;Ux(this.view.scrollDOM,a,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,l),-l),this.view.textDirection==cn.LTR)}}function OC(n){return n.node.nodeType==1&&n.node.firstChild&&(n.offset==0||n.node.childNodes[n.offset-1].contentEditable=="false")&&(n.offset==n.node.childNodes.length||n.node.childNodes[n.offset].contentEditable=="false")}function x1(n,e){let t=n.observer.selectionRange;if(!t.focusNode)return null;let i=Y0(t.focusNode,t.focusOffset),s=H0(t.focusNode,t.focusOffset),r=i||s;if(s&&i&&s.node!=i.node){let o=Dt.get(s.node);if(!o||o instanceof _i&&o.text!=s.node.nodeValue)r=s;else if(n.docView.lastCompositionAfterCursor){let l=Dt.get(i.node);!l||l instanceof _i&&l.text!=i.node.nodeValue||(r=s)}}if(n.docView.lastCompositionAfterCursor=r!=i,!r)return null;let a=e-r.offset;return{from:a,to:a+r.node.nodeValue.length,node:r.node}}function yC(n,e,t){let i=x1(n,t);if(!i)return null;let{node:s,from:r,to:a}=i,o=s.nodeValue;if(/[\n\r]/.test(o)||n.state.doc.sliceString(i.from,i.to)!=o)return null;let l=e.invertedDesc,c=new Oi(l.mapPos(r),l.mapPos(a),r,a),u=[];for(let h=s.parentNode;;h=h.parentNode){let d=Dt.get(h);if(d instanceof ys)u.push({node:h,deco:d.mark});else{if(d instanceof sn||h.nodeName=="DIV"&&h.parentNode==n.contentDOM)return{range:c,text:s,marks:u,line:h};if(h!=n.contentDOM)u.push({node:h,deco:new Wa({inclusive:!0,attributes:sC(h),tagName:h.tagName.toLowerCase()})});else return null}}}function bC(n,e){return n.nodeType!=1?0:(e&&n.childNodes[e-1].contentEditable=="false"?1:0)|(e<n.childNodes.length&&n.childNodes[e].contentEditable=="false"?2:0)}let vC=class{constructor(){this.changes=[]}compareRange(e,t){Zo(e,t,this.changes)}comparePoint(e,t){Zo(e,t,this.changes)}boundChange(e){Zo(e,e,this.changes)}};function SC(n,e,t){let i=new vC;return vt.compare(n,e,t,i),i.changes}function wC(n,e){for(let t=n;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function PC(n,e){let t=!1;return e&&n.iterChangedRanges((i,s)=>{i<e.to&&s>e.from&&(t=!0)}),t}function xC(n,e,t=1){let i=n.charCategorizer(e),s=n.doc.lineAt(e),r=e-s.from;if(s.length==0)return le.cursor(e);r==0?t=1:r==s.length&&(t=-1);let a=r,o=r;t<0?a=Nn(s.text,r,!1):o=Nn(s.text,r);let l=i(s.text.slice(a,o));for(;a>0;){let c=Nn(s.text,a,!1);if(i(s.text.slice(c,a))!=l)break;a=c}for(;o<s.length;){let c=Nn(s.text,o);if(i(s.text.slice(o,c))!=l)break;o=c}return le.range(a+s.from,o+s.from)}function CC(n,e){return e.left>n?e.left-n:Math.max(0,n-e.right)}function AC(n,e){return e.top>n?e.top-n:Math.max(0,n-e.bottom)}function ku(n,e){return n.top<e.bottom-1&&n.bottom>e.top+1}function tp(n,e){return e<n.top?{top:e,left:n.left,right:n.right,bottom:n.bottom}:n}function np(n,e){return e>n.bottom?{top:n.top,left:n.left,right:n.right,bottom:e}:n}function ph(n,e,t){let i,s,r,a,o=!1,l,c,u,h;for(let m=n.firstChild;m;m=m.nextSibling){let g=Ba(m);for(let y=0;y<g.length;y++){let b=g[y];s&&ku(s,b)&&(b=tp(np(b,s.bottom),s.top));let P=CC(e,b),k=AC(t,b);if(P==0&&k==0)return m.nodeType==3?ip(m,e,t):ph(m,e,t);(!i||a>k||a==k&&r>P)&&(i=m,s=b,r=P,a=k,o=P?e<b.left?y>0:y<g.length-1:!0),P==0?t>b.bottom&&(!u||u.bottom<b.bottom)?(l=m,u=b):t<b.top&&(!h||h.top>b.top)&&(c=m,h=b):u&&ku(u,b)?u=np(u,b.bottom):h&&ku(h,b)&&(h=tp(h,b.top))}}if(u&&u.bottom>=t?(i=l,s=u):h&&h.top<=t&&(i=c,s=h),!i)return{node:n,offset:0};let d=Math.max(s.left,Math.min(s.right,e));if(i.nodeType==3)return ip(i,d,t);if(o&&i.contentEditable!="false")return ph(i,d,t);let f=Array.prototype.indexOf.call(n.childNodes,i)+(e>=(s.left+s.right)/2?1:0);return{node:n,offset:f}}function ip(n,e,t){let i=n.nodeValue.length,s=-1,r=1e9,a=0;for(let o=0;o<i;o++){let l=fr(n,o,o+1).getClientRects();for(let c=0;c<l.length;c++){let u=l[c];if(u.top==u.bottom)continue;a||(a=e-u.left);let h=(u.top>t?u.top-t:t-u.bottom)-1;if(u.left-1<=e&&u.right+1>=e&&h<r){let d=e>=(u.left+u.right)/2,f=d;if((Pe.chrome||Pe.gecko)&&fr(n,o).getBoundingClientRect().left==u.right&&(f=!d),h<=0)return{node:n,offset:o+(f?1:0)};s=o+(f?1:0),r=h}}}return{node:n,offset:s>-1?s:a>0?n.nodeValue.length:0}}function C1(n,e,t,i=-1){var s,r;let a=n.contentDOM.getBoundingClientRect(),o=a.top+n.viewState.paddingTop,l,{docHeight:c}=n.viewState,{x:u,y:h}=e,d=h-o;if(d<0)return 0;if(d>c)return n.state.doc.length;for(let w=n.viewState.heightOracle.textHeight/2,C=!1;l=n.elementAtHeight(d),l.type!=gi.Text;)for(;d=i>0?l.bottom+w:l.top-w,!(d>=0&&d<=c);){if(C)return t?null:0;C=!0,i=-i}h=o+d;let f=l.from;if(f<n.viewport.from)return n.viewport.from==0?0:t?null:sp(n,a,l,u,h);if(f>n.viewport.to)return n.viewport.to==n.state.doc.length?n.state.doc.length:t?null:sp(n,a,l,u,h);let m=n.dom.ownerDocument,g=n.root.elementFromPoint?n.root:m,y=g.elementFromPoint(u,h);y&&!n.contentDOM.contains(y)&&(y=null),y||(u=Math.max(a.left+1,Math.min(a.right-1,u)),y=g.elementFromPoint(u,h),y&&!n.contentDOM.contains(y)&&(y=null));let b,P=-1;if(y&&((s=n.docView.nearest(y))===null||s===void 0?void 0:s.isEditable)!=!1){if(m.caretPositionFromPoint){let w=m.caretPositionFromPoint(u,h);w&&({offsetNode:b,offset:P}=w)}else if(m.caretRangeFromPoint){let w=m.caretRangeFromPoint(u,h);w&&({startContainer:b,startOffset:P}=w)}b&&(!n.contentDOM.contains(b)||Pe.safari&&kC(b,P,u)||Pe.chrome&&EC(b,P,u))&&(b=void 0),b&&(P=Math.min(os(b),P))}if(!b||!n.docView.dom.contains(b)){let w=sn.find(n.docView,f);if(!w)return d>l.top+l.height/2?l.to:l.from;({node:b,offset:P}=ph(w.dom,u,h))}let k=n.docView.nearest(b);if(!k)return null;if(k.isWidget&&((r=k.dom)===null||r===void 0?void 0:r.nodeType)==1){let w=k.dom.getBoundingClientRect();return e.y<w.top||e.y<=w.bottom&&e.x<=(w.left+w.right)/2?k.posAtStart:k.posAtEnd}else return k.localPosFromDOM(b,P)+k.posAtStart}function sp(n,e,t,i,s){let r=Math.round((i-e.left)*n.defaultCharacterWidth);if(n.lineWrapping&&t.height>n.defaultLineHeight*1.5){let o=n.viewState.heightOracle.textHeight,l=Math.floor((s-t.top-(n.defaultLineHeight-o)*.5)/o);r+=l*n.viewState.heightOracle.lineLength}let a=n.state.sliceDoc(t.from,t.to);return t.from+zx(a,r,n.state.tabSize)}function A1(n,e,t){let i,s=n;if(n.nodeType!=3||e!=(i=n.nodeValue.length))return!1;for(;;){let r=s.nextSibling;if(r){if(r.nodeName=="BR")break;return!1}else{let a=s.parentNode;if(!a||a.nodeName=="DIV")break;s=a}}return fr(n,i-1,i).getBoundingClientRect().right>t}function kC(n,e,t){return A1(n,e,t)}function EC(n,e,t){if(e!=0)return A1(n,e,t);for(let s=n;;){let r=s.parentNode;if(!r||r.nodeType!=1||r.firstChild!=s)return!1;if(r.classList.contains("cm-line"))break;s=r}let i=n.nodeType==1?n.getBoundingClientRect():fr(n,0,Math.max(n.nodeValue.length,1)).getBoundingClientRect();return t-i.left>5}function $C(n,e,t){let i=n.lineBlockAt(e);if(Array.isArray(i.type)){let s;for(let r of i.type){if(r.from>e)break;if(!(r.to<e)){if(r.from<e&&r.to>e)return r;(!s||r.type==gi.Text&&(s.type!=r.type||(t<0?r.from<e:r.to>e)))&&(s=r)}}return s||i}return i}function DC(n,e,t,i){let s=$C(n,e.head,e.assoc||-1),r=!i||s.type!=gi.Text||!(n.lineWrapping||s.widgetLineBreaks)?null:n.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head);if(r){let a=n.dom.getBoundingClientRect(),o=n.textDirectionAt(s.from),l=n.posAtCoords({x:t==(o==cn.LTR)?a.right-1:a.left+1,y:(r.top+r.bottom)/2});if(l!=null)return le.cursor(l,t?-1:1)}return le.cursor(t?s.to:s.from,t?-1:1)}function rp(n,e,t,i){let s=n.state.doc.lineAt(e.head),r=n.bidiSpans(s),a=n.textDirectionAt(s.from);for(let o=e,l=null;;){let c=fC(s,r,a,o,t),u=u1;if(!c){if(s.number==(t?n.state.doc.lines:1))return o;u=`
`,s=n.state.doc.line(s.number+(t?1:-1)),r=n.bidiSpans(s),c=n.visualLineSide(s,!t)}if(l){if(!l(u))return o}else{if(!i)return c;l=i(u)}o=c}}function MC(n,e,t){let i=n.state.charCategorizer(e),s=i(t);return r=>{let a=i(r);return s==Dn.Space&&(s=a),s==a}}function TC(n,e,t,i){let s=e.head,r=t?1:-1;if(s==(t?n.state.doc.length:0))return le.cursor(s,e.assoc);let a=e.goalColumn,o,l=n.contentDOM.getBoundingClientRect(),c=n.coordsAtPos(s,e.assoc||-1),u=n.documentTop;if(c)a==null&&(a=c.left-l.left),o=r<0?c.top:c.bottom;else{let f=n.viewState.lineBlockAt(s);a==null&&(a=Math.min(l.right-l.left,n.defaultCharacterWidth*(s-f.from))),o=(r<0?f.top:f.bottom)+u}let h=l.left+a,d=i??n.viewState.heightOracle.textHeight>>1;for(let f=0;;f+=10){let m=o+(d+f)*r,g=C1(n,{x:h,y:m},!1,r);if(m<l.top||m>l.bottom||(r<0?g<s:g>s)){let y=n.docView.coordsForChar(g),b=!y||m<y.top?-1:1;return le.cursor(g,b,void 0,a)}}}function Ca(n,e,t){for(;;){let i=0;for(let s of n)s.between(e-1,e+1,(r,a,o)=>{if(e>r&&e<a){let l=i||t||(e-r<a-e?-1:1);e=l<0?r:a,i=l}});if(!i)return e}}function k1(n,e){let t=null;for(let i=0;i<e.ranges.length;i++){let s=e.ranges[i],r=null;if(s.empty){let a=Ca(n,s.from,0);a!=s.from&&(r=le.cursor(a,-1))}else{let a=Ca(n,s.from,-1),o=Ca(n,s.to,1);(a!=s.from||o!=s.to)&&(r=le.range(s.from==s.anchor?a:o,s.from==s.head?a:o))}r&&(t||(t=e.ranges.slice()),t[i]=r)}return t?le.create(t,e.mainIndex):e}function Eu(n,e,t){let i=Ca(n.state.facet(Ua).map(s=>s(n)),t.from,e.head>t.from?-1:1);return i==t.from?t:le.cursor(i,i<t.from?1:-1)}const Oa="￿";class _C{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(At.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Oa}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let s=e;;){this.findPointBefore(i,s);let r=this.text.length;this.readNode(s);let a=s.nextSibling;if(a==t)break;let o=Dt.get(s),l=Dt.get(a);(o&&l?o.breakAfter:(o?o.breakAfter:tl(s))||tl(a)&&(s.nodeName!="BR"||s.cmIgnore)&&this.text.length>r)&&!BC(a,t)&&this.lineBreak(),s=a}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,a=1,o;if(this.lineSeparator?(r=t.indexOf(this.lineSeparator,i),a=this.lineSeparator.length):(o=s.exec(t))&&(r=o.index,a=o[0].length),this.append(t.slice(i,r<0?t.length:r)),r<0)break;if(this.lineBreak(),a>1)for(let l of this.points)l.node==e&&l.pos>this.text.length&&(l.pos-=a-1);i=r+a}}readNode(e){if(e.cmIgnore)return;let t=Dt.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let s=i.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(FC(e,i.node,i.offset)?t:0))}}function FC(n,e,t){for(;;){if(!e||t<os(e))return!1;if(e==n)return!0;t=dr(e)+1,e=e.parentNode}}function BC(n,e){let t;for(;!(n==e||!n);n=n.nextSibling){let i=Dt.get(n);if(!(i!=null&&i.isWidget||n.cmIgnore))return!1;i&&(t||(t=[])).push(i)}if(t)for(let i of t){let s=i.overrideDOMText;if(s!=null&&s.length)return!1}return!0}class ap{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class NC{constructor(e,t,i,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=t>-1;let{impreciseHead:r,impreciseAnchor:a}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let o=r||a?[]:RC(e),l=new _C(o,e.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=LC(o,this.bounds.from)}else{let o=e.observer.selectionRange,l=r&&r.node==o.focusNode&&r.offset==o.focusOffset||!ah(e.contentDOM,o.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(o.focusNode,o.focusOffset),c=a&&a.node==o.anchorNode&&a.offset==o.anchorOffset||!ah(e.contentDOM,o.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(o.anchorNode,o.anchorOffset),u=e.viewport;if((Pe.ios||Pe.chrome)&&e.state.selection.main.empty&&l!=c&&(u.from>0||u.to<e.state.doc.length)){let h=Math.min(l,c),d=Math.max(l,c),f=u.from-h,m=u.to-d;(f==0||f==1||h==0)&&(m==0||m==-1||d==e.state.doc.length)&&(l=0,c=e.state.doc.length)}this.newSel=le.single(c,l)}}}function E1(n,e){let t,{newSel:i}=e,s=n.state.selection.main,r=n.inputState.lastKeyTime>Date.now()-100?n.inputState.lastKeyCode:-1;if(e.bounds){let{from:a,to:o}=e.bounds,l=s.from,c=null;(r===8||Pe.android&&e.text.length<o-a)&&(l=s.to,c="end");let u=$1(n.state.doc.sliceString(a,o,Oa),e.text,l-a,c);u&&(Pe.chrome&&r==13&&u.toB==u.from+2&&e.text.slice(u.from,u.toB)==Oa+Oa&&u.toB--,t={from:a+u.from,to:a+u.toA,insert:pt.of(e.text.slice(u.from,u.toB).split(Oa))})}else i&&(!n.hasFocus&&n.state.facet(ms)||i.main.eq(s))&&(i=null);if(!t&&!i)return!1;if(!t&&e.typeOver&&!s.empty&&i&&i.main.empty?t={from:s.from,to:s.to,insert:n.state.doc.slice(s.from,s.to)}:(Pe.mac||Pe.android)&&t&&t.from==t.to&&t.from==s.head-1&&/^\. ?$/.test(t.insert.toString())&&n.contentDOM.getAttribute("autocorrect")=="off"?(i&&t.insert.length==2&&(i=le.single(i.main.anchor-1,i.main.head-1)),t={from:t.from,to:t.to,insert:pt.of([t.insert.toString().replace("."," ")])}):t&&t.from>=s.from&&t.to<=s.to&&(t.from!=s.from||t.to!=s.to)&&s.to-s.from-(t.to-t.from)<=4?t={from:s.from,to:s.to,insert:n.state.doc.slice(s.from,t.from).append(t.insert).append(n.state.doc.slice(t.to,s.to))}:Pe.chrome&&t&&t.from==t.to&&t.from==s.head&&t.insert.toString()==`
 `&&n.lineWrapping&&(i&&(i=le.single(i.main.anchor-1,i.main.head-1)),t={from:s.from,to:s.to,insert:pt.of([" "])}),t)return bd(n,t,i,r);if(i&&!i.main.eq(s)){let a=!1,o="select";return n.inputState.lastSelectionTime>Date.now()-50&&(n.inputState.lastSelectionOrigin=="select"&&(a=!0),o=n.inputState.lastSelectionOrigin,o=="select.pointer"&&(i=k1(n.state.facet(Ua).map(l=>l(n)),i))),n.dispatch({selection:i,scrollIntoView:a,userEvent:o}),!0}else return!1}function bd(n,e,t,i=-1){if(Pe.ios&&n.inputState.flushIOSKey(e))return!0;let s=n.state.selection.main;if(Pe.android&&(e.to==s.to&&(e.from==s.from||e.from==s.from-1&&n.state.sliceDoc(e.from,s.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&_r(n.contentDOM,"Enter",13)||(e.from==s.from-1&&e.to==s.to&&e.insert.length==0||i==8&&e.insert.length<e.to-e.from&&e.to>s.head)&&_r(n.contentDOM,"Backspace",8)||e.from==s.from&&e.to==s.to+1&&e.insert.length==0&&_r(n.contentDOM,"Delete",46)))return!0;let r=e.insert.toString();n.inputState.composing>=0&&n.inputState.composing++;let a,o=()=>a||(a=QC(n,e,t));return n.state.facet(p1).some(l=>l(n,e.from,e.to,r,o))||n.dispatch(o()),!0}function QC(n,e,t){let i,s=n.state,r=s.selection.main,a=-1;if(e.from==e.to&&e.from<r.from||e.from>r.to){let l=e.from<r.from?-1:1,c=l<0?r.from:r.to,u=Ca(s.facet(Ua).map(h=>h(n)),c,l);e.from==u&&(a=u)}if(a>-1)i={changes:e,selection:le.cursor(e.from+e.insert.length,-1)};else if(e.from>=r.from&&e.to<=r.to&&e.to-e.from>=(r.to-r.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&n.inputState.composing<0){let l=r.from<e.from?s.sliceDoc(r.from,e.from):"",c=r.to>e.to?s.sliceDoc(e.to,r.to):"";i=s.replaceSelection(n.state.toText(l+e.insert.sliceString(0,void 0,n.state.lineBreak)+c))}else{let l=s.changes(e),c=t&&t.main.to<=l.newLength?t.main:void 0;if(s.selection.ranges.length>1&&n.inputState.composing>=0&&e.to<=r.to&&e.to>=r.to-10){let u=n.state.sliceDoc(e.from,e.to),h,d=t&&x1(n,t.main.head);if(d){let g=e.insert.length-(e.to-e.from);h={from:d.from,to:d.to-g}}else h=n.state.doc.lineAt(r.head);let f=r.to-e.to,m=r.to-r.from;i=s.changeByRange(g=>{if(g.from==r.from&&g.to==r.to)return{changes:l,range:c||g.map(l)};let y=g.to-f,b=y-u.length;if(g.to-g.from!=m||n.state.sliceDoc(b,y)!=u||g.to>=h.from&&g.from<=h.to)return{range:g};let P=s.changes({from:b,to:y,insert:e.insert}),k=g.to-r.to;return{changes:P,range:c?le.range(Math.max(0,c.anchor+k),Math.max(0,c.head+k)):g.map(P)}})}else i={changes:l,selection:c&&s.selection.replaceRange(c)}}let o="input.type";return(n.composing||n.inputState.compositionPendingChange&&n.inputState.compositionEndedAt>Date.now()-50)&&(n.inputState.compositionPendingChange=!1,o+=".compose",n.inputState.compositionFirstChange&&(o+=".start",n.inputState.compositionFirstChange=!1)),s.update(i,{userEvent:o,scrollIntoView:!0})}function $1(n,e,t,i){let s=Math.min(n.length,e.length),r=0;for(;r<s&&n.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==s&&n.length==e.length)return null;let a=n.length,o=e.length;for(;a>0&&o>0&&n.charCodeAt(a-1)==e.charCodeAt(o-1);)a--,o--;if(i=="end"){let l=Math.max(0,r-Math.min(a,o));t-=a+l-r}if(a<r&&n.length<e.length){let l=t<=r&&t>=a?r-t:0;r-=l,o=r+(o-a),a=r}else if(o<r){let l=t<=r&&t>=o?r-t:0;r-=l,a=r+(a-o),o=r}return{from:r,toA:a,toB:o}}function RC(n){let e=[];if(n.root.activeElement!=n.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:s,focusOffset:r}=n.observer.selectionRange;return t&&(e.push(new ap(t,i)),(s!=t||r!=i)&&e.push(new ap(s,r))),e}function LC(n,e){if(n.length==0)return null;let t=n[0].pos,i=n.length==2?n[1].pos:t;return t>-1&&i>-1?le.single(t+e,i+e):null}class IC{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,Pe.safari&&e.contentDOM.addEventListener("input",()=>null),Pe.gecko&&nA(e.contentDOM.ownerDocument)}handleEvent(e){!XC(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,t){let i=this.handlers[e];if(i){for(let s of i.observers)s(this.view,t);for(let s of i.handlers){if(t.defaultPrevented)break;if(s(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=VC(e),i=this.handlers,s=this.view.contentDOM;for(let r in t)if(r!="scroll"){let a=!t[r].handlers.length,o=i[r];o&&a!=!o.handlers.length&&(s.removeEventListener(r,this.handleEvent),o=null),o||s.addEventListener(r,this.handleEvent,{passive:a})}for(let r in i)r!="scroll"&&!t[r]&&s.removeEventListener(r,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&M1.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),Pe.android&&Pe.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return Pe.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=D1.find(i=>i.keyCode==e.keyCode))&&!e.ctrlKey||zC.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let t=this.pendingIOSKey;return!t||t.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,_r(this.view.contentDOM,t.key,t.keyCode,t instanceof KeyboardEvent?t:void 0))}ignoreDuringComposition(e){return!/^key/.test(e.type)||e.synthetic?!1:this.composing>0?!0:Pe.safari&&!Pe.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function op(n,e){return(t,i)=>{try{return e.call(n,i,t)}catch(s){Ki(t.state,s)}}}function VC(n){let e=Object.create(null);function t(i){return e[i]||(e[i]={observers:[],handlers:[]})}for(let i of n){let s=i.spec,r=s&&s.plugin.domEventHandlers,a=s&&s.plugin.domEventObservers;if(r)for(let o in r){let l=r[o];l&&t(o).handlers.push(op(i.value,l))}if(a)for(let o in a){let l=a[o];l&&t(o).observers.push(op(i.value,l))}}for(let i in Fi)t(i).handlers.push(Fi[i]);for(let i in yi)t(i).observers.push(yi[i]);return e}const D1=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],zC="dthko",M1=[16,17,18,20,91,92,224,225],po=6;function mo(n){return Math.max(0,n)*.7+8}function ZC(n,e){return Math.max(Math.abs(n.clientX-e.clientX),Math.abs(n.clientY-e.clientY))}class jC{constructor(e,t,i,s){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParents=Yx(e.contentDOM),this.atoms=e.state.facet(Ua).map(a=>a(e));let r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(At.allowMultipleSelections)&&qC(e,t),this.dragging=WC(e,t)&&F1(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&ZC(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let t=0,i=0,s=0,r=0,a=this.view.win.innerWidth,o=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:a}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:r,bottom:o}=this.scrollParents.y.getBoundingClientRect());let l=P1(this.view);e.clientX-l.left<=s+po?t=-mo(s-e.clientX):e.clientX+l.right>=a-po&&(t=mo(e.clientX-a)),e.clientY-l.top<=r+po?i=-mo(r-e.clientY):e.clientY+l.bottom>=o-po&&(i=mo(e.clientY-o)),this.setScrollSpeed(t,i)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:t}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),t&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=t,t=0),(e||t)&&this.view.win.scrollBy(e,t),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:t}=this,i=k1(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!i.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(t=>t.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function qC(n,e){let t=n.state.facet(c1);return t.length?t[0](e):Pe.mac?e.metaKey:e.ctrlKey}function GC(n,e){let t=n.state.facet(h1);return t.length?t[0](e):Pe.mac?!e.altKey:!e.ctrlKey}function WC(n,e){let{main:t}=n.state.selection;if(t.empty)return!1;let i=Fa(n.root);if(!i||i.rangeCount==0)return!0;let s=i.getRangeAt(0).getClientRects();for(let r=0;r<s.length;r++){let a=s[r];if(a.left<=e.clientX&&a.right>=e.clientX&&a.top<=e.clientY&&a.bottom>=e.clientY)return!0}return!1}function XC(n,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=n.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=Dt.get(t))&&i.ignoreEvent(e))return!1;return!0}const Fi=Object.create(null),yi=Object.create(null),T1=Pe.ie&&Pe.ie_version<15||Pe.ios&&Pe.webkit_version<604;function UC(n){let e=n.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{n.focus(),t.remove(),_1(n,t.value)},50)}function Ll(n,e,t){for(let i of n.facet(e))t=i(t,n);return t}function _1(n,e){e=Ll(n.state,gd,e);let{state:t}=n,i,s=1,r=t.toText(e),a=r.lines==t.selection.ranges.length;if(mh!=null&&t.selection.ranges.every(l=>l.empty)&&mh==r.toString()){let l=-1;i=t.changeByRange(c=>{let u=t.doc.lineAt(c.from);if(u.from==l)return{range:c};l=u.from;let h=t.toText((a?r.line(s++).text:e)+t.lineBreak);return{changes:{from:u.from,insert:h},range:le.cursor(c.from+h.length)}})}else a?i=t.changeByRange(l=>{let c=r.line(s++);return{changes:{from:l.from,to:l.to,insert:c.text},range:le.cursor(l.from+c.length)}}):i=t.replaceSelection(r);n.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}yi.scroll=n=>{n.inputState.lastScrollTop=n.scrollDOM.scrollTop,n.inputState.lastScrollLeft=n.scrollDOM.scrollLeft};Fi.keydown=(n,e)=>(n.inputState.setSelectionOrigin("select"),e.keyCode==27&&n.inputState.tabFocusMode!=0&&(n.inputState.tabFocusMode=Date.now()+2e3),!1);yi.touchstart=(n,e)=>{n.inputState.lastTouchTime=Date.now(),n.inputState.setSelectionOrigin("select.pointer")};yi.touchmove=n=>{n.inputState.setSelectionOrigin("select.pointer")};Fi.mousedown=(n,e)=>{if(n.observer.flush(),n.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let i of n.state.facet(d1))if(t=i(n,e),t)break;if(!t&&e.button==0&&(t=KC(n,e)),t){let i=!n.hasFocus;n.inputState.startMouseSelection(new jC(n,e,t,i)),i&&n.observer.ignore(()=>{W0(n.contentDOM);let r=n.root.activeElement;r&&!r.contains(n.contentDOM)&&r.blur()});let s=n.inputState.mouseSelection;if(s)return s.start(e),s.dragging===!1}else n.inputState.setSelectionOrigin("select.pointer");return!1};function lp(n,e,t,i){if(i==1)return le.cursor(e,t);if(i==2)return xC(n.state,e,t);{let s=sn.find(n.docView,e),r=n.state.doc.lineAt(s?s.posAtEnd:e),a=s?s.posAtStart:r.from,o=s?s.posAtEnd:r.to;return o<n.state.doc.length&&o==r.to&&o++,le.range(a,o)}}let up=(n,e,t)=>e>=t.top&&e<=t.bottom&&n>=t.left&&n<=t.right;function YC(n,e,t,i){let s=sn.find(n.docView,e);if(!s)return 1;let r=e-s.posAtStart;if(r==0)return 1;if(r==s.length)return-1;let a=s.coordsAt(r,-1);if(a&&up(t,i,a))return-1;let o=s.coordsAt(r,1);return o&&up(t,i,o)?1:a&&a.bottom>=i?-1:1}function cp(n,e){let t=n.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:YC(n,t,e.clientX,e.clientY)}}const HC=Pe.ie&&Pe.ie_version<=11;let hp=null,dp=0,fp=0;function F1(n){if(!HC)return n.detail;let e=hp,t=fp;return hp=n,fp=Date.now(),dp=!e||t>Date.now()-400&&Math.abs(e.clientX-n.clientX)<2&&Math.abs(e.clientY-n.clientY)<2?(dp+1)%3:1}function KC(n,e){let t=cp(n,e),i=F1(e),s=n.state.selection;return{update(r){r.docChanged&&(t.pos=r.changes.mapPos(t.pos),s=s.map(r.changes))},get(r,a,o){let l=cp(n,r),c,u=lp(n,l.pos,l.bias,i);if(t.pos!=l.pos&&!a){let h=lp(n,t.pos,t.bias,i),d=Math.min(h.from,u.from),f=Math.max(h.to,u.to);u=d<u.from?le.range(d,f):le.range(f,d)}return a?s.replaceRange(s.main.extend(u.from,u.to)):o&&i==1&&s.ranges.length>1&&(c=JC(s,l.pos))?c:o?s.addRange(u):le.create([u])}}}function JC(n,e){for(let t=0;t<n.ranges.length;t++){let{from:i,to:s}=n.ranges[t];if(i<=e&&s>=e)return le.create(n.ranges.slice(0,t).concat(n.ranges.slice(t+1)),n.mainIndex==t?0:n.mainIndex-(n.mainIndex>t?1:0))}return null}Fi.dragstart=(n,e)=>{let{selection:{main:t}}=n.state;if(e.target.draggable){let s=n.docView.nearest(e.target);if(s&&s.isWidget){let r=s.posAtStart,a=r+s.length;(r>=t.to||a<=t.from)&&(t=le.range(r,a))}}let{inputState:i}=n;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",Ll(n.state,Od,n.state.sliceDoc(t.from,t.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Fi.dragend=n=>(n.inputState.draggedContent=null,!1);function pp(n,e,t,i){if(t=Ll(n.state,gd,t),!t)return;let s=n.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:r}=n.inputState,a=i&&r&&GC(n,e)?{from:r.from,to:r.to}:null,o={from:s,insert:t},l=n.state.changes(a?[a,o]:o);n.focus(),n.dispatch({changes:l,selection:{anchor:l.mapPos(s,-1),head:l.mapPos(s,1)},userEvent:a?"move.drop":"input.drop"}),n.inputState.draggedContent=null}Fi.drop=(n,e)=>{if(!e.dataTransfer)return!1;if(n.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let i=Array(t.length),s=0,r=()=>{++s==t.length&&pp(n,e,i.filter(a=>a!=null).join(n.state.lineBreak),!1)};for(let a=0;a<t.length;a++){let o=new FileReader;o.onerror=r,o.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(o.result)||(i[a]=o.result),r()},o.readAsText(t[a])}return!0}else{let i=e.dataTransfer.getData("Text");if(i)return pp(n,e,i,!0),!0}return!1};Fi.paste=(n,e)=>{if(n.state.readOnly)return!0;n.observer.flush();let t=T1?null:e.clipboardData;return t?(_1(n,t.getData("text/plain")||t.getData("text/uri-list")),!0):(UC(n),!1)};function eA(n,e){let t=n.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),n.focus()},50)}function tA(n){let e=[],t=[],i=!1;for(let s of n.selection.ranges)s.empty||(e.push(n.sliceDoc(s.from,s.to)),t.push(s));if(!e.length){let s=-1;for(let{from:r}of n.selection.ranges){let a=n.doc.lineAt(r);a.number>s&&(e.push(a.text),t.push({from:a.from,to:Math.min(n.doc.length,a.to+1)})),s=a.number}i=!0}return{text:Ll(n,Od,e.join(n.lineBreak)),ranges:t,linewise:i}}let mh=null;Fi.copy=Fi.cut=(n,e)=>{let{text:t,ranges:i,linewise:s}=tA(n.state);if(!t&&!s)return!1;mh=s?t:null,e.type=="cut"&&!n.state.readOnly&&n.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let r=T1?null:e.clipboardData;return r?(r.clearData(),r.setData("text/plain",t),!0):(eA(n,t),!1)};const B1=Ss.define();function N1(n,e){let t=[];for(let i of n.facet(m1)){let s=i(n,e);s&&t.push(s)}return t.length?n.update({effects:t,annotations:B1.of(!0)}):null}function Q1(n){setTimeout(()=>{let e=n.hasFocus;if(e!=n.inputState.notifiedFocused){let t=N1(n.state,e);t?n.dispatch(t):n.update([])}},10)}yi.focus=n=>{n.inputState.lastFocusTime=Date.now(),!n.scrollDOM.scrollTop&&(n.inputState.lastScrollTop||n.inputState.lastScrollLeft)&&(n.scrollDOM.scrollTop=n.inputState.lastScrollTop,n.scrollDOM.scrollLeft=n.inputState.lastScrollLeft),Q1(n)};yi.blur=n=>{n.observer.clearSelectionRange(),Q1(n)};yi.compositionstart=yi.compositionupdate=n=>{n.observer.editContext||(n.inputState.compositionFirstChange==null&&(n.inputState.compositionFirstChange=!0),n.inputState.composing<0&&(n.inputState.composing=0))};yi.compositionend=n=>{n.observer.editContext||(n.inputState.composing=-1,n.inputState.compositionEndedAt=Date.now(),n.inputState.compositionPendingKey=!0,n.inputState.compositionPendingChange=n.observer.pendingRecords().length>0,n.inputState.compositionFirstChange=null,Pe.chrome&&Pe.android?n.observer.flushSoon():n.inputState.compositionPendingChange?Promise.resolve().then(()=>n.observer.flush()):setTimeout(()=>{n.inputState.composing<0&&n.docView.hasComposition&&n.update([])},50))};yi.contextmenu=n=>{n.inputState.lastContextMenu=Date.now()};Fi.beforeinput=(n,e)=>{var t,i;if(e.inputType=="insertReplacementText"&&n.observer.editContext){let r=(t=e.dataTransfer)===null||t===void 0?void 0:t.getData("text/plain"),a=e.getTargetRanges();if(r&&a.length){let o=a[0],l=n.posAtDOM(o.startContainer,o.startOffset),c=n.posAtDOM(o.endContainer,o.endOffset);return bd(n,{from:l,to:c,insert:n.state.toText(r)},null),!0}}let s;if(Pe.chrome&&Pe.android&&(s=D1.find(r=>r.inputType==e.inputType))&&(n.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let r=((i=window.visualViewport)===null||i===void 0?void 0:i.height)||0;setTimeout(()=>{var a;(((a=window.visualViewport)===null||a===void 0?void 0:a.height)||0)>r+10&&n.hasFocus&&(n.contentDOM.blur(),n.focus())},100)}return Pe.ios&&e.inputType=="deleteContentForward"&&n.observer.flushSoon(),Pe.safari&&e.inputType=="insertText"&&n.inputState.composing>=0&&setTimeout(()=>yi.compositionend(n,e),20),!1};const mp=new Set;function nA(n){mp.has(n)||(mp.add(n),n.addEventListener("copy",()=>{}),n.addEventListener("cut",()=>{}))}const gp=["pre-wrap","normal","pre-line","break-spaces"];let Ir=!1;function Op(){Ir=!1}class iA{constructor(e){this.lineWrapping=e,this.doc=pt.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return gp.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let s=e[i];s<0?i++:this.heightSamples[Math.floor(s*10)]||(t=!0,this.heightSamples[Math.floor(s*10)]=!0)}return t}refresh(e,t,i,s,r,a){let o=gp.indexOf(e)>-1,l=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=t,this.charWidth=i,this.textHeight=s,this.lineLength=r,l){this.heightSamples={};for(let c=0;c<a.length;c++){let u=a[c];u<0?c++:this.heightSamples[Math.floor(u*10)]=!0}}return l}}class sA{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class Hi{constructor(e,t,i,s,r){this.from=e,this.length=t,this.top=i,this.height=s,this._content=r}get type(){return typeof this._content=="number"?gi.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Ls?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new Hi(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var It=(function(n){return n[n.ByPos=0]="ByPos",n[n.ByHeight=1]="ByHeight",n[n.ByPosNoHeight=2]="ByPosNoHeight",n})(It||(It={}));const jo=.001;class Qn{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>jo&&(Ir=!0),this.height=e)}replace(e,t,i){return Qn.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,s){let r=this,a=i.doc;for(let o=s.length-1;o>=0;o--){let{fromA:l,toA:c,fromB:u,toB:h}=s[o],d=r.lineAt(l,It.ByPosNoHeight,i.setDoc(t),0,0),f=d.to>=c?d:r.lineAt(c,It.ByPosNoHeight,i,0,0);for(h+=f.to-c,c=f.to;o>0&&d.from<=s[o-1].toA;)l=s[o-1].fromA,u=s[o-1].fromB,o--,l<d.from&&(d=r.lineAt(l,It.ByPosNoHeight,i,0,0));u+=d.from-l,l=d.from;let m=vd.build(i.setDoc(a),e,u,h);r=sl(r,r.replace(l,c,m))}return r.updateHeight(i,0)}static empty(){return new ni(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,s=0,r=0;for(;;)if(t==i)if(s>r*2){let o=e[t-1];o.break?e.splice(--t,1,o.left,null,o.right):e.splice(--t,1,o.left,o.right),i+=1+o.break,s-=o.size}else if(r>s*2){let o=e[i];o.break?e.splice(i,1,o.left,null,o.right):e.splice(i,1,o.left,o.right),i+=2+o.break,r-=o.size}else break;else if(s<r){let o=e[t++];o&&(s+=o.size)}else{let o=e[--i];o&&(r+=o.size)}let a=0;return e[t-1]==null?(a=1,t--):e[t]==null&&(a=1,i++),new rA(Qn.of(e.slice(0,t)),a,Qn.of(e.slice(i)))}}function sl(n,e){return n==e?n:(n.constructor!=e.constructor&&(Ir=!0),e)}Qn.prototype.size=1;class R1 extends Qn{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,s){return new Hi(s,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,s,r){return this.blockAt(0,i,s,r)}forEachLine(e,t,i,s,r,a){e<=r+this.length&&t>=r&&a(this.blockAt(0,i,s,r))}updateHeight(e,t=0,i=!1,s){return s&&s.from<=t&&s.more&&this.setHeight(s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class ni extends R1{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,s){return new Hi(s,this.length,i,this.height,this.breaks)}replace(e,t,i){let s=i[0];return i.length==1&&(s instanceof ni||s instanceof vn&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof vn?s=new ni(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Qn.of(i)}updateHeight(e,t=0,i=!1,s){return s&&s.from<=t&&s.more?this.setHeight(s.heights[s.index++]):(i||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class vn extends Qn{constructor(e){super(e,0)}heightMetrics(e,t){let i=e.doc.lineAt(t).number,s=e.doc.lineAt(t+this.length).number,r=s-i+1,a,o=0;if(e.lineWrapping){let l=Math.min(this.height,e.lineHeight*r);a=l/r,this.length>r+1&&(o=(this.height-l)/(this.length-r-1))}else a=this.height/r;return{firstLine:i,lastLine:s,perLine:a,perChar:o}}blockAt(e,t,i,s){let{firstLine:r,lastLine:a,perLine:o,perChar:l}=this.heightMetrics(t,s);if(t.lineWrapping){let c=s+(e<t.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length)),u=t.doc.lineAt(c),h=o+u.length*l,d=Math.max(i,e-h/2);return new Hi(u.from,u.length,d,h,0)}else{let c=Math.max(0,Math.min(a-r,Math.floor((e-i)/o))),{from:u,length:h}=t.doc.line(r+c);return new Hi(u,h,i+o*c,o,0)}}lineAt(e,t,i,s,r){if(t==It.ByHeight)return this.blockAt(e,i,s,r);if(t==It.ByPosNoHeight){let{from:f,to:m}=i.doc.lineAt(e);return new Hi(f,m-f,0,0,0)}let{firstLine:a,perLine:o,perChar:l}=this.heightMetrics(i,r),c=i.doc.lineAt(e),u=o+c.length*l,h=c.number-a,d=s+o*h+l*(c.from-r-h);return new Hi(c.from,c.length,Math.max(s,Math.min(d,s+this.height-u)),u,0)}forEachLine(e,t,i,s,r,a){e=Math.max(e,r),t=Math.min(t,r+this.length);let{firstLine:o,perLine:l,perChar:c}=this.heightMetrics(i,r);for(let u=e,h=s;u<=t;){let d=i.doc.lineAt(u);if(u==e){let m=d.number-o;h+=l*m+c*(e-r-m)}let f=l+c*d.length;a(new Hi(d.from,d.length,h,f,0)),h+=f,u=d.to+1}}replace(e,t,i){let s=this.length-t;if(s>0){let r=i[i.length-1];r instanceof vn?i[i.length-1]=new vn(r.length+s):i.push(null,new vn(s-1))}if(e>0){let r=i[0];r instanceof vn?i[0]=new vn(e+r.length):i.unshift(new vn(e-1),null)}return Qn.of(i)}decomposeLeft(e,t){t.push(new vn(e-1),null)}decomposeRight(e,t){t.push(null,new vn(this.length-e-1))}updateHeight(e,t=0,i=!1,s){let r=t+this.length;if(s&&s.from<=t+this.length&&s.more){let a=[],o=Math.max(t,s.from),l=-1;for(s.from>t&&a.push(new vn(s.from-t-1).updateHeight(e,t));o<=r&&s.more;){let u=e.doc.lineAt(o).length;a.length&&a.push(null);let h=s.heights[s.index++];l==-1?l=h:Math.abs(h-l)>=jo&&(l=-2);let d=new ni(u,h);d.outdated=!1,a.push(d),o+=u+1}o<=r&&a.push(null,new vn(r-o).updateHeight(e,o));let c=Qn.of(a);return(l<0||Math.abs(c.height-this.height)>=jo||Math.abs(l-this.heightMetrics(e,t).perLine)>=jo)&&(Ir=!0),sl(this,c)}else(i||this.outdated)&&(this.setHeight(e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class rA extends Qn{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,s){let r=i+this.left.height;return e<r?this.left.blockAt(e,t,i,s):this.right.blockAt(e,t,r,s+this.left.length+this.break)}lineAt(e,t,i,s,r){let a=s+this.left.height,o=r+this.left.length+this.break,l=t==It.ByHeight?e<a:e<o,c=l?this.left.lineAt(e,t,i,s,r):this.right.lineAt(e,t,i,a,o);if(this.break||(l?c.to<o:c.from>o))return c;let u=t==It.ByPosNoHeight?It.ByPosNoHeight:It.ByPos;return l?c.join(this.right.lineAt(o,u,i,a,o)):this.left.lineAt(o,u,i,s,r).join(c)}forEachLine(e,t,i,s,r,a){let o=s+this.left.height,l=r+this.left.length+this.break;if(this.break)e<l&&this.left.forEachLine(e,t,i,s,r,a),t>=l&&this.right.forEachLine(e,t,i,o,l,a);else{let c=this.lineAt(l,It.ByPos,i,s,r);e<c.from&&this.left.forEachLine(e,c.from-1,i,s,r,a),c.to>=e&&c.from<=t&&a(c),t>c.to&&this.right.forEachLine(c.to+1,t,i,o,l,a)}}replace(e,t,i){let s=this.left.length+this.break;if(t<s)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,t-s,i));let r=[];e>0&&this.decomposeLeft(e,r);let a=r.length;for(let o of i)r.push(o);if(e>0&&yp(r,a-1),t<this.length){let o=r.length;this.decomposeRight(t,r),yp(r,o)}return Qn.of(r)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,s=i+this.break;if(e>=s)return this.right.decomposeRight(e-s,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<s&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?Qn.of(this.break?[e,null,t]:[e,t]):(this.left=sl(this.left,e),this.right=sl(this.right,t),this.setHeight(e.height+t.height),this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,s){let{left:r,right:a}=this,o=t+r.length+this.break,l=null;return s&&s.from<=t+r.length&&s.more?l=r=r.updateHeight(e,t,i,s):r.updateHeight(e,t,i),s&&s.from<=o+a.length&&s.more?l=a=a.updateHeight(e,o,i,s):a.updateHeight(e,o,i),l?this.balanced(r,a):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function yp(n,e){let t,i;n[e]==null&&(t=n[e-1])instanceof vn&&(i=n[e+1])instanceof vn&&n.splice(e-1,3,new vn(t.length+1+i.length))}const aA=5;class vd{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof ni?s.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new ni(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0,r=i.widget?i.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let a=t-e;i.block?this.addBlock(new R1(a,s,i)):(a||r||s>=aA)&&this.addLineDeco(s,r,a)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new ni(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new vn(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof ni)return e;let t=new ni(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let s=this.ensureLine();s.length+=i,s.collapsed+=i,s.widgetHeight=Math.max(s.widgetHeight,e),s.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof ni)&&!this.isCovered?this.nodes.push(new ni(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let s of this.nodes)s instanceof ni&&s.updateHeight(this.oracle,i),i+=s?s.length:1;return this.nodes}static build(e,t,i,s){let r=new vd(i,e);return vt.spans(t,i,s,r,0),r.finish(i)}}function oA(n,e,t){let i=new lA;return vt.compare(n,e,t,i,0),i.changes}class lA{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,s){(e<t||i&&i.heightRelevant||s&&s.heightRelevant)&&Zo(e,t,this.changes,5)}}function uA(n,e){let t=n.getBoundingClientRect(),i=n.ownerDocument,s=i.defaultView||window,r=Math.max(0,t.left),a=Math.min(s.innerWidth,t.right),o=Math.max(0,t.top),l=Math.min(s.innerHeight,t.bottom);for(let c=n.parentNode;c&&c!=i.body;)if(c.nodeType==1){let u=c,h=window.getComputedStyle(u);if((u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth)&&h.overflow!="visible"){let d=u.getBoundingClientRect();r=Math.max(r,d.left),a=Math.min(a,d.right),o=Math.max(o,d.top),l=Math.min(c==n.parentNode?s.innerHeight:l,d.bottom)}c=h.position=="absolute"||h.position=="fixed"?u.offsetParent:u.parentNode}else if(c.nodeType==11)c=c.host;else break;return{left:r-t.left,right:Math.max(r,a)-t.left,top:o-(t.top+e),bottom:Math.max(o,l)-(t.top+e)}}function cA(n){let e=n.getBoundingClientRect(),t=n.ownerDocument.defaultView||window;return e.left<t.innerWidth&&e.right>0&&e.top<t.innerHeight&&e.bottom>0}function hA(n,e){let t=n.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class $u{constructor(e,t,i,s){this.from=e,this.to=t,this.size=i,this.displaySize=s}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let s=e[i],r=t[i];if(s.from!=r.from||s.to!=r.to||s.size!=r.size)return!1}return!0}draw(e,t){return nt.replace({widget:new dA(this.displaySize*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class dA extends qr{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class bp{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=vp,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=cn.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(yd).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new iA(t),this.stateDeco=e.facet(Na).filter(i=>typeof i!="function"),this.heightMap=Qn.empty().applyChanges(this.stateDeco,pt.empty,this.heightOracle.setDoc(e.doc),[new Oi(0,0,0,e.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=nt.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let s=i?t.head:t.anchor;if(!e.some(({from:r,to:a})=>s>=r&&s<=a)){let{from:r,to:a}=this.lineBlockAt(s);e.push(new go(r,a))}}return this.viewports=e.sort((i,s)=>i.from-s.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?vp:new Sd(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(ya(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Na).filter(u=>typeof u!="function");let s=e.changedRanges,r=Oi.extendWithRanges(s,oA(i,this.stateDeco,e?e.changes:ln.empty(this.state.doc.length))),a=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);Op(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),r),(this.heightMap.height!=a||Ir)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=a);let l=r.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<l.from||t.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,t));let c=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,e.flags|=this.updateForViewport(),(c||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(mC)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),s=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?cn.RTL:cn.LTR;let a=this.heightOracle.mustRefreshForWrapping(r),o=t.getBoundingClientRect(),l=a||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let c=0,u=0;if(o.width&&o.height){let{scaleX:w,scaleY:C}=G0(t,o);(w>.005&&Math.abs(this.scaleX-w)>.005||C>.005&&Math.abs(this.scaleY-C)>.005)&&(this.scaleX=w,this.scaleY=C,c|=16,a=l=!0)}let h=(parseInt(i.paddingTop)||0)*this.scaleY,d=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=h||this.paddingBottom!=d)&&(this.paddingTop=h,this.paddingBottom=d,c|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(l=!0),this.editorWidth=e.scrollDOM.clientWidth,c|=16);let f=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=f&&(this.scrollAnchorHeight=-1,this.scrollTop=f),this.scrolledToBottom=U0(e.scrollDOM);let m=(this.printing?hA:uA)(t,this.paddingTop),g=m.top-this.pixelViewport.top,y=m.bottom-this.pixelViewport.bottom;this.pixelViewport=m;let b=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(b!=this.inView&&(this.inView=b,b&&(l=!0)),!this.inView&&!this.scrollTarget&&!cA(e.dom))return 0;let P=o.width;if((this.contentDOMWidth!=P||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,c|=16),l){let w=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(w)&&(a=!0),a||s.lineWrapping&&Math.abs(P-this.contentDOMWidth)>s.charWidth){let{lineHeight:C,charWidth:$,textHeight:A}=e.docView.measureTextSize();a=C>0&&s.refresh(r,C,$,A,Math.max(5,P/$),w),a&&(e.docView.minWidth=0,c|=16)}g>0&&y>0?u=Math.max(g,y):g<0&&y<0&&(u=Math.min(g,y)),Op();for(let C of this.viewports){let $=C.from==this.viewport.from?w:e.docView.measureVisibleLineHeights(C);this.heightMap=(a?Qn.empty().applyChanges(this.stateDeco,pt.empty,this.heightOracle,[new Oi(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,a,new sA(C.from,$))}Ir&&(c|=2)}let k=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return k&&(c&2&&(c|=this.updateScaler()),this.viewport=this.getViewport(u,this.scrollTarget),c|=this.updateForViewport()),(c&2||k)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(a?[]:this.lineGaps,e)),c|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),c}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,r=this.heightOracle,{visibleTop:a,visibleBottom:o}=this,l=new go(s.lineAt(a-i*1e3,It.ByHeight,r,0,0).from,s.lineAt(o+(1-i)*1e3,It.ByHeight,r,0,0).to);if(t){let{head:c}=t.range;if(c<l.from||c>l.to){let u=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),h=s.lineAt(c,It.ByPos,r,0,0),d;t.y=="center"?d=(h.top+h.bottom)/2-u/2:t.y=="start"||t.y=="nearest"&&c<l.from?d=h.top:d=h.bottom-u,l=new go(s.lineAt(d-1e3/2,It.ByHeight,r,0,0).from,s.lineAt(d+u+1e3/2,It.ByHeight,r,0,0).to)}}return l}mapViewport(e,t){let i=t.mapPos(e.from,-1),s=t.mapPos(e.to,1);return new go(this.heightMap.lineAt(i,It.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,It.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,It.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(t,It.ByPos,this.heightOracle,0,0),{visibleTop:a,visibleBottom:o}=this;return(e==0||s<=a-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||r>=o+Math.max(10,Math.min(i,250)))&&s>a-2*1e3&&r<o+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let s of e)t.touchesRange(s.from,s.to)||i.push(new $u(t.mapPos(s.from),t.mapPos(s.to),s.size,s.displaySize));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,s=i?1e4:2e3,r=s>>1,a=s<<1;if(this.defaultTextDirection!=cn.LTR&&!i)return[];let o=[],l=(u,h,d,f)=>{if(h-u<r)return;let m=this.state.selection.main,g=[m.from];m.empty||g.push(m.to);for(let b of g)if(b>u&&b<h){l(u,b-10,d,f),l(b+10,h,d,f);return}let y=pA(e,b=>b.from>=d.from&&b.to<=d.to&&Math.abs(b.from-u)<r&&Math.abs(b.to-h)<r&&!g.some(P=>b.from<P&&b.to>P));if(!y){if(h<d.to&&t&&i&&t.visibleRanges.some(k=>k.from<=h&&k.to>=h)){let k=t.moveToLineBoundary(le.cursor(h),!1,!0).head;k>u&&(h=k)}let b=this.gapSize(d,u,h,f),P=i||b<2e6?b:2e6;y=new $u(u,h,b,P)}o.push(y)},c=u=>{if(u.length<a||u.type!=gi.Text)return;let h=fA(u.from,u.to,this.stateDeco);if(h.total<a)return;let d=this.scrollTarget?this.scrollTarget.range.head:null,f,m;if(i){let g=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,y,b;if(d!=null){let P=yo(h,d),k=((this.visibleBottom-this.visibleTop)/2+g)/u.height;y=P-k,b=P+k}else y=(this.visibleTop-u.top-g)/u.height,b=(this.visibleBottom-u.top+g)/u.height;f=Oo(h,y),m=Oo(h,b)}else{let g=h.total*this.heightOracle.charWidth,y=s*this.heightOracle.charWidth,b=0;if(g>2e6)for(let $ of e)$.from>=u.from&&$.from<u.to&&$.size!=$.displaySize&&$.from*this.heightOracle.charWidth+b<this.pixelViewport.left&&(b=$.size-$.displaySize);let P=this.pixelViewport.left+b,k=this.pixelViewport.right+b,w,C;if(d!=null){let $=yo(h,d),A=((k-P)/2+y)/g;w=$-A,C=$+A}else w=(P-y)/g,C=(k+y)/g;f=Oo(h,w),m=Oo(h,C)}f>u.from&&l(u.from,f,u,h),m<u.to&&l(m,u.to,u,h)};for(let u of this.viewportLines)Array.isArray(u.type)?u.type.forEach(c):c(u);return o}gapSize(e,t,i,s){let r=yo(s,i)-yo(s,t);return this.heightOracle.lineWrapping?e.height*r:s.total*this.heightOracle.charWidth*r}updateLineGaps(e){$u.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=nt.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let i=[];vt.spans(t,this.viewport.from,this.viewport.to,{span(r,a){i.push({from:r,to:a})},point(){}},20);let s=0;if(i.length!=this.visibleRanges.length)s=12;else for(let r=0;r<i.length&&!(s&8);r++){let a=this.visibleRanges[r],o=i[r];(a.from!=o.from||a.to!=o.to)&&(s|=4,e&&e.mapPos(a.from,-1)==o.from&&e.mapPos(a.to,1)==o.to||(s|=8))}return this.visibleRanges=i,s}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||ya(this.heightMap.lineAt(e,It.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(t=>t.top<=e&&t.bottom>=e)||ya(this.heightMap.lineAt(this.scaler.fromDOM(e),It.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return ya(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class go{constructor(e,t){this.from=e,this.to=t}}function fA(n,e,t){let i=[],s=n,r=0;return vt.spans(t,n,e,{span(){},point(a,o){a>s&&(i.push({from:s,to:a}),r+=a-s),s=o}},20),s<e&&(i.push({from:s,to:e}),r+=e-s),{total:r,ranges:i}}function Oo({total:n,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(n*t);for(let s=0;;s++){let{from:r,to:a}=e[s],o=a-r;if(i<=o)return r+i;i-=o}}function yo(n,e){let t=0;for(let{from:i,to:s}of n.ranges){if(e<=s){t+=e-i;break}t+=s-i}return t/n.total}function pA(n,e){for(let t of n)if(e(t))return t}const vp={toDOM(n){return n},fromDOM(n){return n},scale:1,eq(n){return n==this}};class Sd{constructor(e,t,i){let s=0,r=0,a=0;this.viewports=i.map(({from:o,to:l})=>{let c=t.lineAt(o,It.ByPos,e,0,0).top,u=t.lineAt(l,It.ByPos,e,0,0).bottom;return s+=u-c,{from:o,to:l,top:c,bottom:u,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(t.height-s);for(let o of this.viewports)o.domTop=a+(o.top-r)*this.scale,a=o.domBottom=o.domTop+(o.bottom-o.top),r=o.bottom}toDOM(e){for(let t=0,i=0,s=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.top)return s+(e-i)*this.scale;if(e<=r.bottom)return r.domTop+(e-r.top);i=r.bottom,s=r.domBottom}}fromDOM(e){for(let t=0,i=0,s=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.domTop)return i+(e-s)/this.scale;if(e<=r.domBottom)return r.top+(e-r.domTop);i=r.bottom,s=r.domBottom}}eq(e){return e instanceof Sd?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((t,i)=>t.from==e.viewports[i].from&&t.to==e.viewports[i].to):!1}}function ya(n,e){if(e.scale==1)return n;let t=e.toDOM(n.top),i=e.toDOM(n.bottom);return new Hi(n.from,n.length,t,i-t,Array.isArray(n._content)?n._content.map(s=>ya(s,e)):n._content)}const bo=Be.define({combine:n=>n.join(" ")}),gh=Be.define({combine:n=>n.indexOf(!0)>-1}),Oh=Qs.newName(),L1=Qs.newName(),I1=Qs.newName(),V1={"&light":"."+L1,"&dark":"."+I1};function yh(n,e,t){return new Qs(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,s=>{if(s=="&")return n;if(!t||!t[s])throw new RangeError(`Unsupported selector: ${s}`);return t[s]}):n+" "+i}})}const mA=yh("."+Oh,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},V1),gA={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},Du=Pe.ie&&Pe.ie_version<=11;class OA{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new Hx,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let i of t)this.queue.push(i);(Pe.ie&&Pe.ie_version<=11||Pe.ios&&e.composing)&&t.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&Pe.android&&e.constructor.EDIT_CONTEXT!==!1&&!(Pe.chrome&&Pe.chrome_version<126)&&(this.editContext=new bA(e),e.state.facet(ms)&&(e.contentDOM.editContext=this.editContext.editContext)),Du&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,s=this.selectionRange;if(i.state.facet(ms)?i.root.activeElement!=this.dom:!zo(this.dom,s))return;let r=s.anchorNode&&i.docView.nearest(s.anchorNode);if(r&&r.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(Pe.ie&&Pe.ie_version<=11||Pe.android&&Pe.chrome)&&!i.state.selection.main.empty&&s.focusNode&&Pa(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=Fa(e.root);if(!t)return!1;let i=Pe.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&yA(this.view,t)||t;if(!i||this.selectionRange.eq(i))return!1;let s=zo(this.dom,i);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&Jx(this.dom,i)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(i),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,gA),Du&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),Du&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let s=()=>{let r=this.delayedAndroidKey;r&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=r.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&r.force&&_r(this.dom,r.key,r.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,s=!1;for(let r of e){let a=this.readMutation(r);a&&(a.typeOver&&(s=!0),t==-1?{from:t,to:i}=a:(t=Math.min(a.from,t),i=Math.max(a.to,i)))}return{from:t,to:i,typeOver:s}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),s=this.selectionChanged&&zo(this.dom,this.selectionRange);if(e<0&&!s)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new NC(this.view,e,t,i);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,s=E1(this.view,t);return this.view.state==i&&(t.domChanged||t.newSel&&!t.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),s}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let i=Sp(t,e.previousSibling||e.target.previousSibling,-1),s=Sp(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:s?t.posBefore(s):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(ms)!=e.state.facet(ms)&&(e.view.contentDOM.editContext=e.state.facet(ms)?this.editContext.editContext:null))}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function Sp(n,e,t){for(;e;){let i=Dt.get(e);if(i&&i.parent==n)return i;let s=e.parentNode;e=s!=n.dom?s:t>0?e.nextSibling:e.previousSibling}return null}function wp(n,e){let t=e.startContainer,i=e.startOffset,s=e.endContainer,r=e.endOffset,a=n.docView.domAtPos(n.state.selection.main.anchor);return Pa(a.node,a.offset,s,r)&&([t,i,s,r]=[s,r,t,i]),{anchorNode:t,anchorOffset:i,focusNode:s,focusOffset:r}}function yA(n,e){if(e.getComposedRanges){let s=e.getComposedRanges(n.root)[0];if(s)return wp(n,s)}let t=null;function i(s){s.preventDefault(),s.stopImmediatePropagation(),t=s.getTargetRanges()[0]}return n.contentDOM.addEventListener("beforeinput",i,!0),n.dom.ownerDocument.execCommand("indent"),n.contentDOM.removeEventListener("beforeinput",i,!0),t?wp(n,t):null}class bA{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let t=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=i=>{let s=e.state.selection.main,{anchor:r,head:a}=s,o=this.toEditorPos(i.updateRangeStart),l=this.toEditorPos(i.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:i.updateRangeStart,editorBase:o,drifted:!1});let c=l-o>i.text.length;o==this.from&&r<this.from?o=r:l==this.to&&r>this.to&&(l=r);let u=$1(e.state.sliceDoc(o,l),i.text,(c?s.from:s.to)-o,c?"end":null);if(!u){let d=le.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd));d.main.eq(s)||e.dispatch({selection:d,userEvent:"select"});return}let h={from:u.from+o,to:u.toA+o,insert:pt.of(i.text.slice(u.from,u.toB).split(`
`))};if((Pe.mac||Pe.android)&&h.from==a-1&&/^\. ?$/.test(i.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(h={from:o,to:l,insert:pt.of([i.text.replace("."," ")])}),this.pendingContextChange=h,!e.state.readOnly){let d=this.to-this.from+(h.to-h.from+h.insert.length);bd(e,h,le.single(this.toEditorPos(i.selectionStart,d),this.toEditorPos(i.selectionEnd,d)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state)),h.from<h.to&&!h.insert.length&&e.inputState.composing>=0&&!/[\\p{Alphabetic}\\p{Number}_]/.test(t.text.slice(Math.max(0,i.updateRangeStart-1),Math.min(t.text.length,i.updateRangeStart+1)))&&this.handlers.compositionend(i)},this.handlers.characterboundsupdate=i=>{let s=[],r=null;for(let a=this.toEditorPos(i.rangeStart),o=this.toEditorPos(i.rangeEnd);a<o;a++){let l=e.coordsForChar(a);r=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||r||new DOMRect,s.push(r)}t.updateCharacterBounds(i.rangeStart,s)},this.handlers.textformatupdate=i=>{let s=[];for(let r of i.getTextFormats()){let a=r.underlineStyle,o=r.underlineThickness;if(!/none/i.test(a)&&!/none/i.test(o)){let l=this.toEditorPos(r.rangeStart),c=this.toEditorPos(r.rangeEnd);if(l<c){let u=`text-decoration: underline ${/^[a-z]/.test(a)?a+" ":a=="Dashed"?"dashed ":a=="Squiggle"?"wavy ":""}${/thin/i.test(o)?1:2}px`;s.push(nt.mark({attributes:{style:u}}).range(l,c))}}}e.dispatch({effects:y1.of(nt.set(s))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:i}=this.composing;this.composing=null,i&&this.reset(e.state)}};for(let i in this.handlers)t.addEventListener(i,this.handlers[i]);this.measureReq={read:i=>{this.editContext.updateControlBounds(i.contentDOM.getBoundingClientRect());let s=Fa(i.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let t=0,i=!1,s=this.pendingContextChange;return e.changes.iterChanges((r,a,o,l,c)=>{if(i)return;let u=c.length-(a-r);if(s&&a>=s.to)if(s.from==r&&s.to==a&&s.insert.eq(c)){s=this.pendingContextChange=null,t+=u,this.to+=u;return}else s=null,this.revertPending(e.state);if(r+=t,a+=t,a<=this.from)this.from+=u,this.to+=u;else if(r<this.to){if(r<this.from||a>this.to||this.to-this.from+c.length>3e4){i=!0;return}this.editContext.updateText(this.toContextPos(r),this.toContextPos(a),c.toString()),this.to+=u}t+=u}),s&&!i&&this.revertPending(e.state),!i}update(e){let t=this.pendingContextChange,i=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(i.from,i.to)&&e.transactions.some(s=>!s.isUserEvent("input.type")&&s.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||t)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:t}=e.selection.main;this.from=Math.max(0,t-1e4),this.to=Math.min(e.doc.length,t+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let t=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(t.from),this.toContextPos(t.from+t.insert.length),e.doc.sliceString(t.from,t.to))}setSelection(e){let{main:t}=e.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,t.anchor))),s=this.toContextPos(t.head);(this.editContext.selectionStart!=i||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(i,s)}rangeIsValid(e){let{head:t}=e.selection.main;return!(this.from>0&&t-this.from<500||this.to<e.doc.length&&this.to-t<500||this.to-this.from>1e4*3)}toEditorPos(e,t=this.to-this.from){e=Math.min(e,t);let i=this.composing;return i&&i.drifted?i.editorBase+(e-i.contextBase):e+this.from}toContextPos(e){let t=this.composing;return t&&t.drifted?t.contextBase+(e-t.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class Fe{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var t;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:i}=e;this.dispatchTransactions=e.dispatchTransactions||i&&(s=>s.forEach(r=>i(r,this)))||(s=>this.update(s)),this.dispatch=this.dispatch.bind(this),this._root=e.root||Kx(e.parent)||document,this.viewState=new bp(e.state||At.create(e)),e.scrollTo&&e.scrollTo.is(fo)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet($r).map(s=>new Au(s));for(let s of this.plugins)s.update(this);this.observer=new OA(this),this.inputState=new IC(this),this.inputState.ensureHandlers(this.plugins),this.docView=new ep(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((t=document.fonts)===null||t===void 0)&&t.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let t=e.length==1&&e[0]instanceof rn?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i=!1,s,r=this.state;for(let d of e){if(d.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=d.state}if(this.destroyed){this.viewState.state=r;return}let a=this.hasFocus,o=0,l=null;e.some(d=>d.annotation(B1))?(this.inputState.notifiedFocused=a,o=1):a!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=a,l=N1(r,a),l||(o=1));let c=this.observer.delayedAndroidKey,u=null;if(c?(this.observer.clearDelayedAndroidKey(),u=this.observer.readChange(),(u&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(u=null)):this.observer.clear(),r.facet(At.phrases)!=this.state.facet(At.phrases))return this.setState(r);s=il.create(this,r,e),s.flags|=o;let h=this.viewState.scrollTarget;try{this.updateState=2;for(let d of e){if(h&&(h=h.map(d.changes)),d.scrollIntoView){let{main:f}=d.state.selection;h=new Fr(f.empty?f:le.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of d.effects)f.is(fo)&&(h=f.value.clip(this.state))}this.viewState.update(s,h),this.bidiCache=rl.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),t=this.docView.update(s),this.state.facet(ga)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(d=>d.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(bo)!=s.state.facet(bo)&&(this.viewState.mustMeasureContent=!0),(t||i||h||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),t&&this.docViewUpdate(),!s.empty)for(let d of this.state.facet(fh))try{d(s)}catch(f){Ki(this.state,f,"update listener")}(l||u)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),u&&!E1(this,u)&&c.force&&_r(this.contentDOM,c.key,c.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new bp(e),this.plugins=e.facet($r).map(i=>new Au(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new ep(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet($r),i=e.state.facet($r);if(t!=i){let s=[];for(let r of i){let a=t.indexOf(r);if(a<0)s.push(new Au(r));else{let o=this.plugins[a];o.mustUpdate=e,s.push(o)}}for(let r of this.plugins)r.mustUpdate!=e&&r.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let t=e.value;if(t&&t.docViewUpdate)try{t.docViewUpdate(this)}catch(i){Ki(this.state,i,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,s=i.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:a}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(a=-1),this.viewState.scrollAnchorHeight=-1;try{for(let o=0;;o++){if(a<0)if(U0(i))r=-1,a=this.viewState.heightMap.height;else{let f=this.viewState.scrollAnchorAt(s);r=f.from,a=f.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(o>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let c=[];l&4||([this.measureRequests,c]=[c,this.measureRequests]);let u=c.map(f=>{try{return f.read(this)}catch(m){return Ki(this.state,m),Pp}}),h=il.create(this,this.state,[]),d=!1;h.flags|=l,t?t.flags|=l:t=h,this.updateState=2,h.empty||(this.updatePlugins(h),this.inputState.update(h),this.updateAttrs(),d=this.docView.update(h),d&&this.docViewUpdate());for(let f=0;f<c.length;f++)if(u[f]!=Pp)try{let m=c[f];m.write&&m.write(u[f],this)}catch(m){Ki(this.state,m)}if(d&&this.docView.updateSelection(!0),!h.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,a=-1;continue}else{let m=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-a;if(m>1||m<-1){s=s+m,i.scrollTop=s/this.scaleY,a=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let o of this.state.facet(fh))o(t)}get themeClasses(){return Oh+" "+(this.state.facet(gh)?I1:L1)+" "+this.state.facet(bo)}updateAttrs(){let e=xp(this,b1,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(ms)?"true":"false",class:"cm-content",style:`${Pe.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),xp(this,yd,t);let i=this.observer.ignore(()=>{let s=lh(this.contentDOM,this.contentAttrs,t),r=lh(this.dom,this.editorAttrs,e);return s||r});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let s of i.effects)if(s.is(Fe.announce)){t&&(this.announceDOM.textContent=""),t=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(ga);let e=this.state.facet(Fe.cspNonce);Qs.mount(this.root,this.styleModules.concat(mA).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.plugin!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.plugin==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return Eu(this,e,rp(this,e,t,i))}moveByGroup(e,t){return Eu(this,e,rp(this,e,t,i=>MC(this,e.head,i)))}visualLineSide(e,t){let i=this.bidiSpans(e),s=this.textDirectionAt(e.from),r=i[t?i.length-1:0];return le.cursor(r.side(t,s)+e.from,r.forward(!t,s)?1:-1)}moveToLineBoundary(e,t,i=!0){return DC(this,e,t,i)}moveVertically(e,t,i){return Eu(this,e,TC(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),C1(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(e),r=this.bidiSpans(s),a=r[_s.find(r,e-s.from,-1,t)];return Rl(i,a.dir==cn.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(g1)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>vA)return l1(e.length);let t=this.textDirectionAt(e.from),i;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t&&(r.fresh||o1(r.isolates,i=Jf(this,e))))return r.order;i||(i=Jf(this,e));let s=dC(e.text,t,i);return this.bidiCache.push(new rl(e.from,e.to,t,i,!0,s)),s}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||Pe.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{W0(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return fo.of(new Fr(typeof e=="number"?le.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return fo.of(new Fr(le.cursor(i.from),"start","start",i.top-e,t,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return ls.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return ls.define(()=>({}),{eventObservers:e})}static theme(e,t){let i=Qs.newName(),s=[bo.of(i),ga.of(yh(`.${i}`,e))];return t&&t.dark&&s.push(gh.of(!0)),s}static baseTheme(e){return Fl.lowest(ga.of(yh("."+Oh,e,V1)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),s=i&&Dt.get(i)||Dt.get(e);return((t=s==null?void 0:s.rootView)===null||t===void 0?void 0:t.view)||null}}Fe.styleModule=ga;Fe.inputHandler=p1;Fe.clipboardInputFilter=gd;Fe.clipboardOutputFilter=Od;Fe.scrollHandler=O1;Fe.focusChangeEffect=m1;Fe.perLineTextDirection=g1;Fe.exceptionSink=f1;Fe.updateListener=fh;Fe.editable=ms;Fe.mouseSelectionStyle=d1;Fe.dragMovesSelection=h1;Fe.clickAddsSelectionRange=c1;Fe.decorations=Na;Fe.outerDecorations=v1;Fe.atomicRanges=Ua;Fe.bidiIsolatedRanges=S1;Fe.scrollMargins=w1;Fe.darkTheme=gh;Fe.cspNonce=Be.define({combine:n=>n.length?n[0]:""});Fe.contentAttributes=yd;Fe.editorAttributes=b1;Fe.lineWrapping=Fe.contentAttributes.of({class:"cm-lineWrapping"});Fe.announce=kt.define();const vA=4096,Pp={};class rl{constructor(e,t,i,s,r,a){this.from=e,this.to=t,this.dir=i,this.isolates=s,this.fresh=r,this.order=a}static update(e,t){if(t.empty&&!e.some(r=>r.fresh))return e;let i=[],s=e.length?e[e.length-1].dir:cn.LTR;for(let r=Math.max(0,e.length-10);r<e.length;r++){let a=e[r];a.dir==s&&!t.touchesRange(a.from,a.to)&&i.push(new rl(t.mapPos(a.from,1),t.mapPos(a.to,-1),a.dir,a.isolates,!1,a.order))}return i}}function xp(n,e,t){for(let i=n.state.facet(e),s=i.length-1;s>=0;s--){let r=i[s],a=typeof r=="function"?r(n):r;a&&oh(a,t)}return t}const SA=Pe.mac?"mac":Pe.windows?"win":Pe.linux?"linux":"key";function wA(n,e){const t=n.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let s,r,a,o;for(let l=0;l<t.length-1;++l){const c=t[l];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))s=!0;else if(/^(c|ctrl|control)$/i.test(c))r=!0;else if(/^s(hift)?$/i.test(c))a=!0;else if(/^mod$/i.test(c))e=="mac"?o=!0:r=!0;else throw new Error("Unrecognized modifier name: "+c)}return s&&(i="Alt-"+i),r&&(i="Ctrl-"+i),o&&(i="Meta-"+i),a&&(i="Shift-"+i),i}function vo(n,e,t){return e.altKey&&(n="Alt-"+n),e.ctrlKey&&(n="Ctrl-"+n),e.metaKey&&(n="Meta-"+n),t!==!1&&e.shiftKey&&(n="Shift-"+n),n}const PA=Fl.default(Fe.domEventHandlers({keydown(n,e){return kA(xA(e.state),n,e,"editor")}})),wd=Be.define({enables:PA}),Cp=new WeakMap;function xA(n){let e=n.facet(wd),t=Cp.get(e);return t||Cp.set(e,t=AA(e.reduce((i,s)=>i.concat(s),[]))),t}let Ms=null;const CA=4e3;function AA(n,e=SA){let t=Object.create(null),i=Object.create(null),s=(a,o)=>{let l=i[a];if(l==null)i[a]=o;else if(l!=o)throw new Error("Key binding "+a+" is used both as a regular binding and as a multi-stroke prefix")},r=(a,o,l,c,u)=>{var h,d;let f=t[a]||(t[a]=Object.create(null)),m=o.split(/ (?!$)/).map(b=>wA(b,e));for(let b=1;b<m.length;b++){let P=m.slice(0,b).join(" ");s(P,!0),f[P]||(f[P]={preventDefault:!0,stopPropagation:!1,run:[k=>{let w=Ms={view:k,prefix:P,scope:a};return setTimeout(()=>{Ms==w&&(Ms=null)},CA),!0}]})}let g=m.join(" ");s(g,!1);let y=f[g]||(f[g]={preventDefault:!1,stopPropagation:!1,run:((d=(h=f._any)===null||h===void 0?void 0:h.run)===null||d===void 0?void 0:d.slice())||[]});l&&y.run.push(l),c&&(y.preventDefault=!0),u&&(y.stopPropagation=!0)};for(let a of n){let o=a.scope?a.scope.split(" "):["editor"];if(a.any)for(let c of o){let u=t[c]||(t[c]=Object.create(null));u._any||(u._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:h}=a;for(let d in u)u[d].run.push(f=>h(f,bh))}let l=a[e]||a.key;if(l)for(let c of o)r(c,l,a.run,a.preventDefault,a.stopPropagation),a.shift&&r(c,"Shift-"+l,a.shift,a.preventDefault,a.stopPropagation)}return t}let bh=null;function kA(n,e,t,i){bh=e;let s=Gx(e),r=Or(s,0),a=qa(r)==s.length&&s!=" ",o="",l=!1,c=!1,u=!1;Ms&&Ms.view==t&&Ms.scope==i&&(o=Ms.prefix+" ",M1.indexOf(e.keyCode)<0&&(c=!0,Ms=null));let h=new Set,d=y=>{if(y){for(let b of y.run)if(!h.has(b)&&(h.add(b),b(t)))return y.stopPropagation&&(u=!0),!0;y.preventDefault&&(y.stopPropagation&&(u=!0),c=!0)}return!1},f=n[i],m,g;return f&&(d(f[o+vo(s,e,!a)])?l=!0:a&&(e.altKey||e.metaKey||e.ctrlKey)&&!(Pe.windows&&e.ctrlKey&&e.altKey)&&!(Pe.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(m=Rs[e.keyCode])&&m!=s?(d(f[o+vo(m,e,!0)])||e.shiftKey&&(g=_a[e.keyCode])!=s&&g!=m&&d(f[o+vo(g,e,!1)]))&&(l=!0):a&&e.shiftKey&&d(f[o+vo(s,e,!0)])&&(l=!0),!l&&d(f._any)&&(l=!0)),c&&(l=!0),l&&u&&e.stopPropagation(),bh=null,l}class Is extends hr{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Is.prototype.elementClass="";Is.prototype.toDOM=void 0;Is.prototype.mapMode=En.TrackBefore;Is.prototype.startSide=Is.prototype.endSide=-1;Is.prototype.point=!0;const Mu=Be.define(),EA=Be.define(),$A={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>vt.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{},side:"before"},Aa=Be.define();function DA(n){return[z1(),Aa.of({...$A,...n})]}const Ap=Be.define({combine:n=>n.some(e=>e)});function z1(n){return[MA]}const MA=ls.fromClass(class{constructor(n){this.view=n,this.domAfter=null,this.prevViewport=n.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=n.state.facet(Aa).map(e=>new Ep(n,e)),this.fixed=!n.state.facet(Ap);for(let e of this.gutters)e.config.side=="after"?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),n.scrollDOM.insertBefore(this.dom,n.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(n){if(this.updateGutters(n)){let e=this.prevViewport,t=n.view.viewport,i=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(i<(t.to-t.from)*.8)}if(n.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(Ap)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=n.view.viewport}syncGutters(n){let e=this.dom.nextSibling;n&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let t=vt.iter(this.view.state.facet(Mu),this.view.viewport.from),i=[],s=this.gutters.map(r=>new TA(r,this.view.viewport,-this.view.documentPadding.top));for(let r of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(r.type)){let a=!0;for(let o of r.type)if(o.type==gi.Text&&a){vh(t,i,o.from);for(let l of s)l.line(this.view,o,i);a=!1}else if(o.widget)for(let l of s)l.widget(this.view,o)}else if(r.type==gi.Text){vh(t,i,r.from);for(let a of s)a.line(this.view,r,i)}else if(r.widget)for(let a of s)a.widget(this.view,r);for(let r of s)r.finish();n&&(this.view.scrollDOM.insertBefore(this.dom,e),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(n){let e=n.startState.facet(Aa),t=n.state.facet(Aa),i=n.docChanged||n.heightChanged||n.viewportChanged||!vt.eq(n.startState.facet(Mu),n.state.facet(Mu),n.view.viewport.from,n.view.viewport.to);if(e==t)for(let s of this.gutters)s.update(n)&&(i=!0);else{i=!0;let s=[];for(let r of t){let a=e.indexOf(r);a<0?s.push(new Ep(this.view,r)):(this.gutters[a].update(n),s.push(this.gutters[a]))}for(let r of this.gutters)r.dom.remove(),s.indexOf(r)<0&&r.destroy();for(let r of s)r.config.side=="after"?this.getDOMAfter().appendChild(r.dom):this.dom.appendChild(r.dom);this.gutters=s}return i}destroy(){for(let n of this.gutters)n.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:n=>Fe.scrollMargins.of(e=>{let t=e.plugin(n);if(!t||t.gutters.length==0||!t.fixed)return null;let i=t.dom.offsetWidth*e.scaleX,s=t.domAfter?t.domAfter.offsetWidth*e.scaleX:0;return e.textDirection==cn.LTR?{left:i,right:s}:{right:i,left:s}})});function kp(n){return Array.isArray(n)?n:[n]}function vh(n,e,t){for(;n.value&&n.from<=t;)n.from==t&&e.push(n.value),n.next()}class TA{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=vt.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:s}=this,r=(t.top-this.height)/e.scaleY,a=t.height/e.scaleY;if(this.i==s.elements.length){let o=new Z1(e,a,r,i);s.elements.push(o),s.dom.appendChild(o.dom)}else s.elements[this.i].update(e,a,r,i);this.height=t.bottom,this.i++}line(e,t,i){let s=[];vh(this.cursor,s,t.from),i.length&&(s=s.concat(i));let r=this.gutter.config.lineMarker(e,t,s);r&&s.unshift(r);let a=this.gutter;s.length==0&&!a.config.renderEmptyElements||this.addElement(e,t,s)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t),s=i?[i]:null;for(let r of e.state.facet(EA)){let a=r(e,t.widget,t);a&&(s||(s=[])).push(a)}s&&this.addElement(e,t,s)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Ep{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,s=>{let r=s.target,a;if(r!=this.dom&&this.dom.contains(r)){for(;r.parentNode!=this.dom;)r=r.parentNode;let l=r.getBoundingClientRect();a=(l.top+l.bottom)/2}else a=s.clientY;let o=e.lineBlockAtHeight(a-e.documentTop);t.domEventHandlers[i](e,o,s)&&s.preventDefault()});this.markers=kp(t.markers(e)),t.initialSpacer&&(this.spacer=new Z1(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=kp(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],e);s!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[s])}let i=e.view.viewport;return!vt.eq(this.markers,t,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class Z1{constructor(e,t,i,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,s)}update(e,t,i,s){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),_A(this.markers,s)||this.setMarkers(e,s)}setMarkers(e,t){let i="cm-gutterElement",s=this.dom.firstChild;for(let r=0,a=0;;){let o=a,l=r<t.length?t[r++]:null,c=!1;if(l){let u=l.elementClass;u&&(i+=" "+u);for(let h=a;h<this.markers.length;h++)if(this.markers[h].compare(l)){o=h,c=!0;break}}else o=this.markers.length;for(;a<o;){let u=this.markers[a++];if(u.toDOM){u.destroy(s);let h=s.nextSibling;s.remove(),s=h}}if(!l)break;l.toDOM&&(c?s=s.nextSibling:this.dom.insertBefore(l.toDOM(e),s)),c&&a++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}function _A(n,e){if(n.length!=e.length)return!1;for(let t=0;t<n.length;t++)if(!n[t].compare(e[t]))return!1;return!0}const FA=Be.define(),BA=Be.define(),Dr=Be.define({combine(n){return Ga(n,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let s in t){let r=i[s],a=t[s];i[s]=r?(o,l,c)=>r(o,l,c)||a(o,l,c):a}return i}})}});class Tu extends Is{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function _u(n,e){return n.state.facet(Dr).formatNumber(e,n.state)}const NA=Aa.compute([Dr],n=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(FA)},lineMarker(e,t,i){return i.some(s=>s.toDOM)?null:new Tu(_u(e,e.state.doc.lineAt(t.from).number))},widgetMarker:(e,t,i)=>{for(let s of e.state.facet(BA)){let r=s(e,t,i);if(r)return r}return null},lineMarkerChange:e=>e.startState.facet(Dr)!=e.state.facet(Dr),initialSpacer(e){return new Tu(_u(e,Dp(e.state.doc.lines)))},updateSpacer(e,t){let i=_u(t.view,Dp(t.view.state.doc.lines));return i==e.number?e:new Tu(i)},domEventHandlers:n.facet(Dr).domEventHandlers,side:"before"}));function $p(n={}){return[Dr.of(n),z1(),NA]}function Dp(n){let e=9;for(;e<n;)e=e*10+9;return e}const j1=1024;let QA=0;class Fu{constructor(e,t){this.from=e,this.to=t}}class at{constructor(e={}){this.id=QA++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")}),this.combine=e.combine||null}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Hn.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}at.closedBy=new at({deserialize:n=>n.split(" ")});at.openedBy=new at({deserialize:n=>n.split(" ")});at.group=new at({deserialize:n=>n.split(" ")});at.isolate=new at({deserialize:n=>{if(n&&n!="rtl"&&n!="ltr"&&n!="auto")throw new RangeError("Invalid value for isolate: "+n);return n||"auto"}});at.contextHash=new at({perNode:!0});at.lookAhead=new at({perNode:!0});at.mounted=new at({perNode:!0});class al{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[at.mounted.id]}}const RA=Object.create(null);class Hn{constructor(e,t,i,s=0){this.name=e,this.props=t,this.id=i,this.flags=s}static define(e){let t=e.props&&e.props.length?Object.create(null):RA,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),s=new Hn(e.name||"",t,e.id,i);if(e.props){for(let r of e.props)if(Array.isArray(r)||(r=r(s)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}}return s}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(at.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let s of i.split(" "))t[s]=e[i];return i=>{for(let s=i.prop(at.group),r=-1;r<(s?s.length:0);r++){let a=t[r<0?i.name:s[r]];if(a)return a}}}}Hn.none=new Hn("",Object.create(null),0,8);class Pd{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let s=null;for(let r of e){let a=r(i);if(a){s||(s=Object.assign({},i.props));let o=a[1],l=a[0];l.combine&&l.id in s&&(o=l.combine(s[l.id],o)),s[l.id]=o}}t.push(s?new Hn(i.name,s,i.id,i.flags):i)}return new Pd(t)}}const So=new WeakMap,Mp=new WeakMap;var un;(function(n){n[n.ExcludeBuffers=1]="ExcludeBuffers",n[n.IncludeAnonymous=2]="IncludeAnonymous",n[n.IgnoreMounts=4]="IgnoreMounts",n[n.IgnoreOverlays=8]="IgnoreOverlays"})(un||(un={}));class an{constructor(e,t,i,s,r){if(this.type=e,this.children=t,this.positions=i,this.length=s,this.props=null,r&&r.length){this.props=Object.create(null);for(let[a,o]of r)this.props[typeof a=="number"?a:a.id]=o}}toString(){let e=al.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let s=i.toString();s&&(t&&(t+=","),t+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new wh(this.topNode,e)}cursorAt(e,t=0,i=0){let s=So.get(this)||this.topNode,r=new wh(s);return r.moveTo(e,t),So.set(this,r._tree),r}get topNode(){return new Yn(this,0,0,null)}resolve(e,t=0){let i=Qa(So.get(this)||this.topNode,e,t,!1);return So.set(this,i),i}resolveInner(e,t=0){let i=Qa(Mp.get(this)||this.topNode,e,t,!0);return Mp.set(this,i),i}resolveStack(e,t=0){return VA(this,e,t)}iterate(e){let{enter:t,leave:i,from:s=0,to:r=this.length}=e,a=e.mode||0,o=(a&un.IncludeAnonymous)>0;for(let l=this.cursor(a|un.IncludeAnonymous);;){let c=!1;if(l.from<=r&&l.to>=s&&(!o&&l.type.isAnonymous||t(l)!==!1)){if(l.firstChild())continue;c=!0}for(;c&&i&&(o||!l.type.isAnonymous)&&i(l),!l.nextSibling();){if(!l.parent())return;c=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Ad(Hn.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,s)=>new an(this.type,t,i,s,this.propValues),e.makeTree||((t,i,s)=>new an(Hn.none,t,i,s)))}static build(e){return zA(e)}}an.empty=new an(Hn.none,[],[],0);class xd{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new xd(this.buffer,this.index)}}class Vs{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return Hn.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],s=this.set.types[t],r=s.name;if(/\W/.test(r)&&!s.isError&&(r=JSON.stringify(r)),e+=4,i==e)return r;let a=[];for(;e<i;)a.push(this.childString(e)),e=this.buffer[e+3];return r+"("+a.join(",")+")"}findChild(e,t,i,s,r){let{buffer:a}=this,o=-1;for(let l=e;l!=t&&!(q1(r,s,a[l+1],a[l+2])&&(o=l,i>0));l=a[l+3]);return o}slice(e,t,i){let s=this.buffer,r=new Uint16Array(t-e),a=0;for(let o=e,l=0;o<t;){r[l++]=s[o++],r[l++]=s[o++]-i;let c=r[l++]=s[o++]-i;r[l++]=s[o++]-e,a=Math.max(a,c)}return new Vs(r,a,this.set)}}function q1(n,e,t,i){switch(n){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function Qa(n,e,t,i){for(var s;n.from==n.to||(t<1?n.from>=e:n.from>e)||(t>-1?n.to<=e:n.to<e);){let a=!i&&n instanceof Yn&&n.index<0?null:n.parent;if(!a)return n;n=a}let r=i?0:un.IgnoreOverlays;if(i)for(let a=n,o=a.parent;o;a=o,o=a.parent)a instanceof Yn&&a.index<0&&((s=o.enter(e,t,r))===null||s===void 0?void 0:s.from)!=a.from&&(n=o);for(;;){let a=n.enter(e,t,r);if(!a)return n;n=a}}class G1{cursor(e=0){return new wh(this,e)}getChild(e,t=null,i=null){let s=Tp(this,e,t,i);return s.length?s[0]:null}getChildren(e,t=null,i=null){return Tp(this,e,t,i)}resolve(e,t=0){return Qa(this,e,t,!1)}resolveInner(e,t=0){return Qa(this,e,t,!0)}matchContext(e){return Sh(this.parent,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let s=t.lastChild;if(!s||s.to!=t.to)break;s.type.isError&&s.from==s.to?(i=t,t=s.prevSibling):t=s}return i}get node(){return this}get next(){return this.parent}}class Yn extends G1{constructor(e,t,i,s){super(),this._tree=e,this.from=t,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,s,r=0){for(let a=this;;){for(let{children:o,positions:l}=a._tree,c=t>0?o.length:-1;e!=c;e+=t){let u=o[e],h=l[e]+a.from;if(q1(s,i,h,h+u.length)){if(u instanceof Vs){if(r&un.ExcludeBuffers)continue;let d=u.findChild(0,u.buffer.length,t,i-h,s);if(d>-1)return new Ji(new LA(a,u,e,h),null,d)}else if(r&un.IncludeAnonymous||!u.type.isAnonymous||Cd(u)){let d;if(!(r&un.IgnoreMounts)&&(d=al.get(u))&&!d.overlay)return new Yn(d.tree,h,e,a);let f=new Yn(u,h,e,a);return r&un.IncludeAnonymous||!f.type.isAnonymous?f:f.nextChild(t<0?u.children.length-1:0,t,i,s)}}}if(r&un.IncludeAnonymous||!a.type.isAnonymous||(a.index>=0?e=a.index+t:e=t<0?-1:a._parent._tree.children.length,a=a._parent,!a))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let s;if(!(i&un.IgnoreOverlays)&&(s=al.get(this._tree))&&s.overlay){let r=e-this.from;for(let{from:a,to:o}of s.overlay)if((t>0?a<=r:a<r)&&(t<0?o>=r:o>r))return new Yn(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Tp(n,e,t,i){let s=n.cursor(),r=[];if(!s.firstChild())return r;if(t!=null){for(let a=!1;!a;)if(a=s.type.is(t),!s.nextSibling())return r}for(;;){if(i!=null&&s.type.is(i))return r;if(s.type.is(e)&&r.push(s.node),!s.nextSibling())return i==null?r:[]}}function Sh(n,e,t=e.length-1){for(let i=n;t>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(e[t]&&e[t]!=i.name)return!1;t--}}return!0}class LA{constructor(e,t,i,s){this.parent=e,this.buffer=t,this.index=i,this.start=s}}class Ji extends G1{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:s}=this.context,r=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.context.start,i);return r<0?null:new Ji(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&un.ExcludeBuffers)return null;let{buffer:s}=this.context,r=s.findChild(this.index+4,s.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new Ji(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new Ji(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new Ji(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,s=this.index+4,r=i.buffer[this.index+3];if(r>s){let a=i.buffer[this.index+1];e.push(i.slice(s,r,a)),t.push(0)}return new an(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function W1(n){if(!n.length)return null;let e=0,t=n[0];for(let r=1;r<n.length;r++){let a=n[r];(a.from>t.from||a.to<t.to)&&(t=a,e=r)}let i=t instanceof Yn&&t.index<0?null:t.parent,s=n.slice();return i?s[e]=i:s.splice(e,1),new IA(s,t)}class IA{constructor(e,t){this.heads=e,this.node=t}get next(){return W1(this.heads)}}function VA(n,e,t){let i=n.resolveInner(e,t),s=null;for(let r=i instanceof Yn?i:i.context.parent;r;r=r.parent)if(r.index<0){let a=r.parent;(s||(s=[i])).push(a.resolve(e,t)),r=a}else{let a=al.get(r.tree);if(a&&a.overlay&&a.overlay[0].from<=e&&a.overlay[a.overlay.length-1].to>=e){let o=new Yn(a.tree,a.overlay[0].from+r.from,-1,r);(s||(s=[i])).push(Qa(o,e,t,!1))}}return s?W1(s):i}class wh{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Yn)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:s}=this.buffer;return this.type=t||s.set.types[s.buffer[e]],this.from=i+s.buffer[e+1],this.to=i+s.buffer[e+2],!0}yield(e){return e?e instanceof Yn?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:s}=this.buffer,r=s.findChild(this.index+4,s.buffer[this.index+3],e,t-this.buffer.start,i);return r<0?!1:(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?i&un.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&un.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&un.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let s=i<0?0:this.stack[i]+4;if(this.index!=s)return this.yieldBuf(t.findChild(s,this.index,-1,0,4))}else{let s=t.buffer[this.index+3];if(s<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(s)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let r=0;r<this.index;r++)if(s.buffer.buffer[r+3]<this.index)return!1;({index:t,parent:i}=s)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let r=t+e,a=e<0?-1:i._tree.children.length;r!=a;r+=e){let o=i._tree.children[r];if(this.mode&un.IncludeAnonymous||o instanceof Vs||!o.type.isAnonymous||Cd(o))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let s=this.index,r=this.stack.length;r>=0;){for(let a=e;a;a=a._parent)if(a.index==s){if(s==this.index)return a;t=a,i=r+1;break e}s=this.stack[--r]}for(let s=i;s<this.stack.length;s++)t=new Ji(this.buffer,t,this.stack[s]);return this.bufferNode=new Ji(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let s=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;;){if(s&&t&&t(this),s=this.type.isAnonymous,!i)return;if(this.nextSibling())break;this.parent(),i--,s=!0}}}matchContext(e){if(!this.buffer)return Sh(this.node.parent,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let s=e.length-1,r=this.stack.length-1;s>=0;r--){if(r<0)return Sh(this._tree,e,s);let a=i[t.buffer[this.stack[r]]];if(!a.isAnonymous){if(e[s]&&e[s]!=a.name)return!1;s--}}return!0}}function Cd(n){return n.children.some(e=>e instanceof Vs||!e.type.isAnonymous||Cd(e))}function zA(n){var e;let{buffer:t,nodeSet:i,maxBufferLength:s=j1,reused:r=[],minRepeatType:a=i.types.length}=n,o=Array.isArray(t)?new xd(t,t.length):t,l=i.types,c=0,u=0;function h(C,$,A,Q,q,W){let{id:U,start:Z,end:Y,size:ne}=o,re=u,ve=c;if(ne<0)if(o.next(),ne==-1){let yt=r[U];A.push(yt),Q.push(Z-C);return}else if(ne==-3){c=U;return}else if(ne==-4){u=U;return}else throw new RangeError(`Unrecognized record size: ${ne}`);let Ce=l[U],De,Ue,Pt=Z-C;if(Y-Z<=s&&(Ue=y(o.pos-$,q))){let yt=new Uint16Array(Ue.size-Ue.skip),ue=o.pos-Ue.size,Je=yt.length;for(;o.pos>ue;)Je=b(Ue.start,yt,Je);De=new Vs(yt,Y-Ue.start,i),Pt=Ue.start-C}else{let yt=o.pos-ne;o.next();let ue=[],Je=[],he=U>=a?U:-1,Et=0,Ze=Y;for(;o.pos>yt;)he>=0&&o.id==he&&o.size>=0?(o.end<=Ze-s&&(m(ue,Je,Z,Et,o.end,Ze,he,re,ve),Et=ue.length,Ze=o.end),o.next()):W>2500?d(Z,yt,ue,Je):h(Z,yt,ue,Je,he,W+1);if(he>=0&&Et>0&&Et<ue.length&&m(ue,Je,Z,Et,Z,Ze,he,re,ve),ue.reverse(),Je.reverse(),he>-1&&Et>0){let me=f(Ce,ve);De=Ad(Ce,ue,Je,0,ue.length,0,Y-Z,me,me)}else De=g(Ce,ue,Je,Y-Z,re-Y,ve)}A.push(De),Q.push(Pt)}function d(C,$,A,Q){let q=[],W=0,U=-1;for(;o.pos>$;){let{id:Z,start:Y,end:ne,size:re}=o;if(re>4)o.next();else{if(U>-1&&Y<U)break;U<0&&(U=ne-s),q.push(Z,Y,ne),W++,o.next()}}if(W){let Z=new Uint16Array(W*4),Y=q[q.length-2];for(let ne=q.length-3,re=0;ne>=0;ne-=3)Z[re++]=q[ne],Z[re++]=q[ne+1]-Y,Z[re++]=q[ne+2]-Y,Z[re++]=re;A.push(new Vs(Z,q[2]-Y,i)),Q.push(Y-C)}}function f(C,$){return(A,Q,q)=>{let W=0,U=A.length-1,Z,Y;if(U>=0&&(Z=A[U])instanceof an){if(!U&&Z.type==C&&Z.length==q)return Z;(Y=Z.prop(at.lookAhead))&&(W=Q[U]+Z.length+Y)}return g(C,A,Q,q,W,$)}}function m(C,$,A,Q,q,W,U,Z,Y){let ne=[],re=[];for(;C.length>Q;)ne.push(C.pop()),re.push($.pop()+A-q);C.push(g(i.types[U],ne,re,W-q,Z-W,Y)),$.push(q-A)}function g(C,$,A,Q,q,W,U){if(W){let Z=[at.contextHash,W];U=U?[Z].concat(U):[Z]}if(q>25){let Z=[at.lookAhead,q];U=U?[Z].concat(U):[Z]}return new an(C,$,A,Q,U)}function y(C,$){let A=o.fork(),Q=0,q=0,W=0,U=A.end-s,Z={size:0,start:0,skip:0};e:for(let Y=A.pos-C;A.pos>Y;){let ne=A.size;if(A.id==$&&ne>=0){Z.size=Q,Z.start=q,Z.skip=W,W+=4,Q+=4,A.next();continue}let re=A.pos-ne;if(ne<0||re<Y||A.start<U)break;let ve=A.id>=a?4:0,Ce=A.start;for(A.next();A.pos>re;){if(A.size<0)if(A.size==-3)ve+=4;else break e;else A.id>=a&&(ve+=4);A.next()}q=Ce,Q+=ne,W+=ve}return($<0||Q==C)&&(Z.size=Q,Z.start=q,Z.skip=W),Z.size>4?Z:void 0}function b(C,$,A){let{id:Q,start:q,end:W,size:U}=o;if(o.next(),U>=0&&Q<a){let Z=A;if(U>4){let Y=o.pos-(U-4);for(;o.pos>Y;)A=b(C,$,A)}$[--A]=Z,$[--A]=W-C,$[--A]=q-C,$[--A]=Q}else U==-3?c=Q:U==-4&&(u=Q);return A}let P=[],k=[];for(;o.pos>0;)h(n.start||0,n.bufferStart||0,P,k,-1,0);let w=(e=n.length)!==null&&e!==void 0?e:P.length?k[0]+P[0].length:0;return new an(l[n.topID],P.reverse(),k.reverse(),w)}const _p=new WeakMap;function qo(n,e){if(!n.isAnonymous||e instanceof Vs||e.type!=n)return 1;let t=_p.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=n||!(i instanceof an)){t=1;break}t+=qo(n,i)}_p.set(e,t)}return t}function Ad(n,e,t,i,s,r,a,o,l){let c=0;for(let m=i;m<s;m++)c+=qo(n,e[m]);let u=Math.ceil(c*1.5/8),h=[],d=[];function f(m,g,y,b,P){for(let k=y;k<b;){let w=k,C=g[k],$=qo(n,m[k]);for(k++;k<b;k++){let A=qo(n,m[k]);if($+A>=u)break;$+=A}if(k==w+1){if($>u){let A=m[w];f(A.children,A.positions,0,A.children.length,g[w]+P);continue}h.push(m[w])}else{let A=g[k-1]+m[k-1].length-C;h.push(Ad(n,m,g,w,k,C,A,null,l))}d.push(C+P-r)}}return f(e,t,i,s,0),(o||l)(h,d,a)}class ZA{constructor(){this.map=new WeakMap}setBuffer(e,t,i){let s=this.map.get(e);s||this.map.set(e,s=new Map),s.set(t,i)}getBuffer(e,t){let i=this.map.get(e);return i&&i.get(t)}set(e,t){e instanceof Ji?this.setBuffer(e.context.buffer,e.index,t):e instanceof Yn&&this.map.set(e.tree,t)}get(e){return e instanceof Ji?this.getBuffer(e.context.buffer,e.index):e instanceof Yn?this.map.get(e.tree):void 0}cursorSet(e,t){e.buffer?this.setBuffer(e.buffer.buffer,e.index,t):this.map.set(e.tree,t)}cursorGet(e){return e.buffer?this.getBuffer(e.buffer.buffer,e.index):this.map.get(e.tree)}}class or{constructor(e,t,i,s,r=!1,a=!1){this.from=e,this.to=t,this.tree=i,this.offset=s,this.open=(r?1:0)|(a?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let s=[new or(0,e.length,e,0,!1,i)];for(let r of t)r.to>e.length&&s.push(r);return s}static applyChanges(e,t,i=128){if(!t.length)return e;let s=[],r=1,a=e.length?e[0]:null;for(let o=0,l=0,c=0;;o++){let u=o<t.length?t[o]:null,h=u?u.fromA:1e9;if(h-l>=i)for(;a&&a.from<h;){let d=a;if(l>=d.from||h<=d.to||c){let f=Math.max(d.from,l)-c,m=Math.min(d.to,h)-c;d=f>=m?null:new or(f,m,d.tree,d.offset+c,o>0,!!u)}if(d&&s.push(d),a.to>h)break;a=r<e.length?e[r++]:null}if(!u)break;l=u.toA,c=u.toA-u.toB}return s}}let X1=class{startParse(e,t,i){return typeof e=="string"&&(e=new jA(e)),i=i?i.length?i.map(s=>new Fu(s.from,s.to)):[new Fu(0,0)]:[new Fu(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let s=this.startParse(e,t,i);for(;;){let r=s.advance();if(r)return r}}};class jA{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new at({perNode:!0});var Fp={};class ol{constructor(e,t,i,s,r,a,o,l,c,u=0,h){this.p=e,this.stack=t,this.state=i,this.reducePos=s,this.pos=r,this.score=a,this.buffer=o,this.bufferBase=l,this.curContext=c,this.lookAhead=u,this.parent=h}toString(){return`[${this.stack.filter((e,t)=>t%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,i=0){let s=e.parser.context;return new ol(e,[],t,i,i,0,[],0,s?new Bp(s,s.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let i=e>>19,s=e&65535,{parser:r}=this.p,a=this.reducePos<this.pos-25;a&&this.setLookAhead(this.pos);let o=r.dynamicPrecedence(s);if(o&&(this.score+=o),i==0){this.pushState(r.getGoto(this.state,s,!0),this.reducePos),s<r.minRepeatTerm&&this.storeNode(s,this.reducePos,this.reducePos,a?8:4,!0),this.reduceContext(s,this.reducePos);return}let l=this.stack.length-(i-1)*3-(e&262144?6:0),c=l?this.stack[l-2]:this.p.ranges[0].from,u=this.reducePos-c;u>=2e3&&!(!((t=this.p.parser.nodeSet.types[s])===null||t===void 0)&&t.isAnonymous)&&(c==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=u):this.p.lastBigReductionSize<u&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=c,this.p.lastBigReductionSize=u));let h=l?this.stack[l-1]:0,d=this.bufferBase+this.buffer.length-h;if(s<r.minRepeatTerm||e&131072){let f=r.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(s,c,f,d+4,!0)}if(e&262144)this.state=this.stack[l];else{let f=this.stack[l-3];this.state=r.getGoto(f,s,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(s,c)}storeNode(e,t,i,s=4,r=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let a=this,o=this.buffer.length;if(o==0&&a.parent&&(o=a.bufferBase-a.parent.bufferBase,a=a.parent),o>0&&a.buffer[o-4]==0&&a.buffer[o-1]>-1){if(t==i)return;if(a.buffer[o-2]>=t){a.buffer[o-2]=i;return}}}if(!r||this.pos==i)this.buffer.push(e,t,i,s);else{let a=this.buffer.length;if(a>0&&(this.buffer[a-4]!=0||this.buffer[a-1]<0)){let o=!1;for(let l=a;l>0&&this.buffer[l-2]>i;l-=4)if(this.buffer[l-1]>=0){o=!0;break}if(o)for(;a>0&&this.buffer[a-2]>i;)this.buffer[a]=this.buffer[a-4],this.buffer[a+1]=this.buffer[a-3],this.buffer[a+2]=this.buffer[a-2],this.buffer[a+3]=this.buffer[a-1],a-=4,s>4&&(s-=4)}this.buffer[a]=e,this.buffer[a+1]=t,this.buffer[a+2]=i,this.buffer[a+3]=s}}shift(e,t,i,s){if(e&131072)this.pushState(e&65535,this.pos);else if((e&262144)==0){let r=e,{parser:a}=this.p;(s>this.pos||t<=a.maxNode)&&(this.pos=s,a.stateFlag(r,1)||(this.reducePos=s)),this.pushState(r,i),this.shiftContext(t,i),t<=a.maxNode&&this.buffer.push(t,i,s,4)}else this.pos=s,this.shiftContext(t,i),t<=this.p.parser.maxNode&&this.buffer.push(t,i,s,4)}apply(e,t,i,s){e&65536?this.reduce(e):this.shift(e,t,i,s)}useNode(e,t){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=e)&&(this.p.reused.push(e),i++);let s=this.pos;this.reducePos=this.pos=s+e.length,this.pushState(t,s),this.buffer.push(i,s,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let i=e.buffer.slice(t),s=e.bufferBase+t;for(;e&&s==e.bufferBase;)e=e.parent;return new ol(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,s,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let i=e<=this.p.parser.maxNode;i&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,i?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new qA(this);;){let i=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(i==0)return!1;if((i&65536)==0)return!0;t.reduce(i)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let s=[];for(let r=0,a;r<t.length;r+=2)(a=t[r+1])!=this.state&&this.p.parser.hasAction(a,e)&&s.push(t[r],a);if(this.stack.length<120)for(let r=0;s.length<8&&r<t.length;r+=2){let a=t[r+1];s.some((o,l)=>l&1&&o==a)||s.push(t[r],a)}t=s}let i=[];for(let s=0;s<t.length&&i.length<4;s+=2){let r=t[s+1];if(r==this.state)continue;let a=this.split();a.pushState(r,this.pos),a.storeNode(0,a.pos,a.pos,4,!0),a.shiftContext(t[s],this.pos),a.reducePos=this.pos,a.score-=200,i.push(a)}return i}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if((t&65536)==0)return!1;if(!e.validAction(this.state,t)){let i=t>>19,s=t&65535,r=this.stack.length-i*3;if(r<0||e.getGoto(this.stack[r],s,!1)<0){let a=this.findForcedReduction();if(a==null)return!1;t=a}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],i=(s,r)=>{if(!t.includes(s))return t.push(s),e.allActions(s,a=>{if(!(a&393216))if(a&65536){let o=(a>>19)-r;if(o>1){let l=a&65535,c=this.stack.length-o*3;if(c>=0&&e.getGoto(this.stack[c],l,!1)>=0)return o<<19|65536|l}}else{let o=i(a,r+1);if(o!=null)return o}})};return i(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new Bp(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class Bp{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class qA{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=e&65535,i=e>>19;i==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(i-1)*3;let s=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=s}}class ll{constructor(e,t,i){this.stack=e,this.pos=t,this.index=i,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new ll(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new ll(this.stack,this.pos,this.index)}}function ba(n,e=Uint16Array){if(typeof n!="string")return n;let t=null;for(let i=0,s=0;i<n.length;){let r=0;for(;;){let a=n.charCodeAt(i++),o=!1;if(a==126){r=65535;break}a>=92&&a--,a>=34&&a--;let l=a-32;if(l>=46&&(l-=46,o=!0),r+=l,o)break;r*=46}t?t[s++]=r:t=new e(r)}return t}class Go{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const Np=new Go;class GA{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=Np,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let i=this.range,s=this.rangeIndex,r=this.pos+e;for(;r<i.from;){if(!s)return null;let a=this.ranges[--s];r-=i.from-a.to,i=a}for(;t<0?r>i.to:r>=i.to;){if(s==this.ranges.length-1)return null;let a=this.ranges[++s];r+=a.from-i.to,i=a}return r}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t=this.chunkOff+e,i,s;if(t>=0&&t<this.chunk.length)i=this.pos+e,s=this.chunk.charCodeAt(t);else{let r=this.resolveOffset(e,1);if(r==null)return-1;if(i=r,i>=this.chunk2Pos&&i<this.chunk2Pos+this.chunk2.length)s=this.chunk2.charCodeAt(i-this.chunk2Pos);else{let a=this.rangeIndex,o=this.range;for(;o.to<=i;)o=this.ranges[++a];this.chunk2=this.input.chunk(this.chunk2Pos=i),i+this.chunk2.length>o.to&&(this.chunk2=this.chunk2.slice(0,o.to-i)),s=this.chunk2.charCodeAt(0)}}return i>=this.token.lookAhead&&(this.token.lookAhead=i+1),s}acceptToken(e,t=0){let i=t?this.resolveOffset(t,-1):this.pos;if(i==null||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=i}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=Np,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let i="";for(let s of this.ranges){if(s.from>=t)break;s.to>e&&(i+=this.input.read(Math.max(s.from,e),Math.min(s.to,t)))}return i}}class Br{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:i}=t.p;U1(this.data,e,t,this.id,i.data,i.tokenPrecTable)}}Br.prototype.contextual=Br.prototype.fallback=Br.prototype.extend=!1;class Ph{constructor(e,t,i){this.precTable=t,this.elseToken=i,this.data=typeof e=="string"?ba(e):e}token(e,t){let i=e.pos,s=0;for(;;){let r=e.next<0,a=e.resolveOffset(1,1);if(U1(this.data,e,t,0,this.data,this.precTable),e.token.value>-1)break;if(this.elseToken==null)return;if(r||s++,a==null)break;e.reset(a,e.token)}s&&(e.reset(i,e.token),e.acceptToken(this.elseToken,s))}}Ph.prototype.contextual=Br.prototype.fallback=Br.prototype.extend=!1;class Ya{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function U1(n,e,t,i,s,r){let a=0,o=1<<i,{dialect:l}=t.p.parser;e:for(;(o&n[a])!=0;){let c=n[a+1];for(let f=a+3;f<c;f+=2)if((n[f+1]&o)>0){let m=n[f];if(l.allows(m)&&(e.token.value==-1||e.token.value==m||WA(m,e.token.value,s,r))){e.acceptToken(m);break}}let u=e.next,h=0,d=n[a+2];if(e.next<0&&d>h&&n[c+d*3-3]==65535){a=n[c+d*3-1];continue e}for(;h<d;){let f=h+d>>1,m=c+f+(f<<1),g=n[m],y=n[m+1]||65536;if(u<g)d=f;else if(u>=y)h=f+1;else{a=n[m+2],e.advance();continue e}}break}}function Qp(n,e,t){for(let i=e,s;(s=n[i])!=65535;i++)if(s==t)return i-e;return-1}function WA(n,e,t,i){let s=Qp(t,i,e);return s<0||Qp(t,i,n)<s}const ti=typeof process<"u"&&Fp&&/\bparse\b/.test(Fp.LOG);let Bu=null;function Rp(n,e,t){let i=n.cursor(un.IncludeAnonymous);for(i.moveTo(e);;)if(!(t<0?i.childBefore(e):i.childAfter(e)))for(;;){if((t<0?i.to<e:i.from>e)&&!i.type.isError)return t<0?Math.max(0,Math.min(i.to-1,e-25)):Math.min(n.length,Math.max(i.from+1,e+25));if(t<0?i.prevSibling():i.nextSibling())break;if(!i.parent())return t<0?0:n.length}}class XA{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?Rp(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?Rp(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let i=this.trees[t],s=this.index[t];if(s==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let r=i.children[s],a=this.start[t]+i.positions[s];if(a>e)return this.nextStart=a,null;if(r instanceof an){if(a==e){if(a<this.safeFrom)return null;let o=a+r.length;if(o<=this.safeTo){let l=r.prop(at.lookAhead);if(!l||o+l<this.fragment.to)return r}}this.index[t]++,a+r.length>=Math.max(this.safeFrom,e)&&(this.trees.push(r),this.start.push(a),this.index.push(0))}else this.index[t]++,this.nextStart=a+r.length}}}class UA{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(i=>new Go)}getActions(e){let t=0,i=null,{parser:s}=e.p,{tokenizers:r}=s,a=s.stateSlot(e.state,3),o=e.curContext?e.curContext.hash:0,l=0;for(let c=0;c<r.length;c++){if((1<<c&a)==0)continue;let u=r[c],h=this.tokens[c];if(!(i&&!u.fallback)&&((u.contextual||h.start!=e.pos||h.mask!=a||h.context!=o)&&(this.updateCachedToken(h,u,e),h.mask=a,h.context=o),h.lookAhead>h.end+25&&(l=Math.max(h.lookAhead,l)),h.value!=0)){let d=t;if(h.extended>-1&&(t=this.addActions(e,h.extended,h.end,t)),t=this.addActions(e,h.value,h.end,t),!u.extend&&(i=h,t>d))break}}for(;this.actions.length>t;)this.actions.pop();return l&&e.setLookAhead(l),!i&&e.pos==this.stream.end&&(i=new Go,i.value=e.p.parser.eofTerm,i.start=i.end=e.pos,t=this.addActions(e,i.value,i.end,t)),this.mainToken=i,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new Go,{pos:i,p:s}=e;return t.start=i,t.end=Math.min(i+1,s.stream.end),t.value=i==s.stream.end?s.parser.eofTerm:0,t}updateCachedToken(e,t,i){let s=this.stream.clipPos(i.pos);if(t.token(this.stream.reset(s,e),i),e.value>-1){let{parser:r}=i.p;for(let a=0;a<r.specialized.length;a++)if(r.specialized[a]==e.value){let o=r.specializers[a](this.stream.read(e.start,e.end),i);if(o>=0&&i.p.parser.dialect.allows(o>>1)){(o&1)==0?e.value=o>>1:e.extended=o>>1;break}}}else e.value=0,e.end=this.stream.clipPos(s+1)}putAction(e,t,i,s){for(let r=0;r<s;r+=3)if(this.actions[r]==e)return s;return this.actions[s++]=e,this.actions[s++]=t,this.actions[s++]=i,s}addActions(e,t,i,s){let{state:r}=e,{parser:a}=e.p,{data:o}=a;for(let l=0;l<2;l++)for(let c=a.stateSlot(r,l?2:1);;c+=3){if(o[c]==65535)if(o[c+1]==1)c=ps(o,c+2);else{s==0&&o[c+1]==2&&(s=this.putAction(ps(o,c+2),t,i,s));break}o[c]==t&&(s=this.putAction(ps(o,c+1),t,i,s))}return s}}class YA{constructor(e,t,i,s){this.parser=e,this.input=t,this.ranges=s,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new GA(t,s),this.tokens=new UA(e,this.stream),this.topTerm=e.top[1];let{from:r}=s[0];this.stacks=[ol.start(this,e.top[0],r)],this.fragments=i.length&&this.stream.end-r>e.bufferLength*4?new XA(i,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,t=this.minStackPos,i=this.stacks=[],s,r;if(this.bigReductionCount>300&&e.length==1){let[a]=e;for(;a.forceReduce()&&a.stack.length&&a.stack[a.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let a=0;a<e.length;a++){let o=e[a];for(;;){if(this.tokens.mainToken=null,o.pos>t)i.push(o);else{if(this.advanceStack(o,i,e))continue;{s||(s=[],r=[]),s.push(o);let l=this.tokens.getMainToken(o);r.push(l.value,l.end)}}break}}if(!i.length){let a=s&&JA(s);if(a)return ti&&console.log("Finish with "+this.stackID(a)),this.stackToTree(a);if(this.parser.strict)throw ti&&s&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+t);this.recovering||(this.recovering=5)}if(this.recovering&&s){let a=this.stoppedAt!=null&&s[0].pos>this.stoppedAt?s[0]:this.runRecovery(s,r,i);if(a)return ti&&console.log("Force-finish "+this.stackID(a)),this.stackToTree(a.forceAll())}if(this.recovering){let a=this.recovering==1?1:this.recovering*3;if(i.length>a)for(i.sort((o,l)=>l.score-o.score);i.length>a;)i.pop();i.some(o=>o.reducePos>t)&&this.recovering--}else if(i.length>1){e:for(let a=0;a<i.length-1;a++){let o=i[a];for(let l=a+1;l<i.length;l++){let c=i[l];if(o.sameState(c)||o.buffer.length>500&&c.buffer.length>500)if((o.score-c.score||o.buffer.length-c.buffer.length)>0)i.splice(l--,1);else{i.splice(a--,1);continue e}}}i.length>12&&i.splice(12,i.length-12)}this.minStackPos=i[0].pos;for(let a=1;a<i.length;a++)i[a].pos<this.minStackPos&&(this.minStackPos=i[a].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,i){let s=e.pos,{parser:r}=this,a=ti?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&s>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let c=e.curContext&&e.curContext.tracker.strict,u=c?e.curContext.hash:0;for(let h=this.fragments.nodeAt(s);h;){let d=this.parser.nodeSet.types[h.type.id]==h.type?r.getGoto(e.state,h.type.id):-1;if(d>-1&&h.length&&(!c||(h.prop(at.contextHash)||0)==u))return e.useNode(h,d),ti&&console.log(a+this.stackID(e)+` (via reuse of ${r.getName(h.type.id)})`),!0;if(!(h instanceof an)||h.children.length==0||h.positions[0]>0)break;let f=h.children[0];if(f instanceof an&&h.positions[0]==0)h=f;else break}}let o=r.stateSlot(e.state,4);if(o>0)return e.reduce(o),ti&&console.log(a+this.stackID(e)+` (via always-reduce ${r.getName(o&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let l=this.tokens.getActions(e);for(let c=0;c<l.length;){let u=l[c++],h=l[c++],d=l[c++],f=c==l.length||!i,m=f?e:e.split(),g=this.tokens.mainToken;if(m.apply(u,h,g?g.start:m.pos,d),ti&&console.log(a+this.stackID(m)+` (via ${(u&65536)==0?"shift":`reduce of ${r.getName(u&65535)}`} for ${r.getName(h)} @ ${s}${m==e?"":", split"})`),f)return!0;m.pos>s?t.push(m):i.push(m)}return!1}advanceFully(e,t){let i=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>i)return Lp(e,t),!0}}runRecovery(e,t,i){let s=null,r=!1;for(let a=0;a<e.length;a++){let o=e[a],l=t[a<<1],c=t[(a<<1)+1],u=ti?this.stackID(o)+" -> ":"";if(o.deadEnd&&(r||(r=!0,o.restart(),ti&&console.log(u+this.stackID(o)+" (restarted)"),this.advanceFully(o,i))))continue;let h=o.split(),d=u;for(let f=0;f<10&&h.forceReduce()&&(ti&&console.log(d+this.stackID(h)+" (via force-reduce)"),!this.advanceFully(h,i));f++)ti&&(d=this.stackID(h)+" -> ");for(let f of o.recoverByInsert(l))ti&&console.log(u+this.stackID(f)+" (via recover-insert)"),this.advanceFully(f,i);this.stream.end>o.pos?(c==o.pos&&(c++,l=0),o.recoverByDelete(l,c),ti&&console.log(u+this.stackID(o)+` (via recover-delete ${this.parser.getName(l)})`),Lp(o,i)):(!s||s.score<o.score)&&(s=o)}return s}stackToTree(e){return e.close(),an.build({buffer:ll.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(Bu||(Bu=new WeakMap)).get(e);return t||Bu.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function Lp(n,e){for(let t=0;t<e.length;t++){let i=e[t];if(i.pos==n.pos&&i.sameState(n)){e[t].score<n.score&&(e[t]=n);return}}e.push(n)}class HA{constructor(e,t,i){this.source=e,this.flags=t,this.disabled=i}allows(e){return!this.disabled||this.disabled[e]==0}}const Nu=n=>n;class KA{constructor(e){this.start=e.start,this.shift=e.shift||Nu,this.reduce=e.reduce||Nu,this.reuse=e.reuse||Nu,this.hash=e.hash||(()=>0),this.strict=e.strict!==!1}}class ul extends X1{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let o=0;o<e.repeatNodeCount;o++)t.push("");let i=Object.keys(e.topRules).map(o=>e.topRules[o][1]),s=[];for(let o=0;o<t.length;o++)s.push([]);function r(o,l,c){s[o].push([l,l.deserialize(String(c))])}if(e.nodeProps)for(let o of e.nodeProps){let l=o[0];typeof l=="string"&&(l=at[l]);for(let c=1;c<o.length;){let u=o[c++];if(u>=0)r(u,l,o[c++]);else{let h=o[c+-u];for(let d=-u;d>0;d--)r(o[c++],l,h);c++}}}this.nodeSet=new Pd(t.map((o,l)=>Hn.define({name:l>=this.minRepeatTerm?void 0:o,id:l,props:s[l],top:i.indexOf(l)>-1,error:l==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(l)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=j1;let a=ba(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let o=0;o<this.specializerSpecs.length;o++)this.specialized[o]=this.specializerSpecs[o].term;this.specializers=this.specializerSpecs.map(Ip),this.states=ba(e.states,Uint32Array),this.data=ba(e.stateData),this.goto=ba(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(o=>typeof o=="number"?new Br(a,o):o),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,i){let s=new YA(this,e,t,i);for(let r of this.wrappers)s=r(s,e,t,i);return s}getGoto(e,t,i=!1){let s=this.goto;if(t>=s[0])return-1;for(let r=s[t+1];;){let a=s[r++],o=a&1,l=s[r++];if(o&&i)return l;for(let c=r+(a>>1);r<c;r++)if(s[r]==e)return l;if(o)return-1}}hasAction(e,t){let i=this.data;for(let s=0;s<2;s++)for(let r=this.stateSlot(e,s?2:1),a;;r+=3){if((a=i[r])==65535)if(i[r+1]==1)a=i[r=ps(i,r+2)];else{if(i[r+1]==2)return ps(i,r+2);break}if(a==t||a==0)return ps(i,r+1)}return 0}stateSlot(e,t){return this.states[e*6+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,i=>i==t?!0:null)}allActions(e,t){let i=this.stateSlot(e,4),s=i?t(i):void 0;for(let r=this.stateSlot(e,1);s==null;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=ps(this.data,r+2);else break;s=t(ps(this.data,r+1))}return s}nextStates(e){let t=[];for(let i=this.stateSlot(e,1);;i+=3){if(this.data[i]==65535)if(this.data[i+1]==1)i=ps(this.data,i+2);else break;if((this.data[i+2]&1)==0){let s=this.data[i+1];t.some((r,a)=>a&1&&r==s)||t.push(this.data[i],s)}}return t}configure(e){let t=Object.assign(Object.create(ul.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let i=this.topRules[e.top];if(!i)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=i}return e.tokenizers&&(t.tokenizers=this.tokenizers.map(i=>{let s=e.tokenizers.find(r=>r.from==i);return s?s.to:i})),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map((i,s)=>{let r=e.specializers.find(o=>o.from==i.external);if(!r)return i;let a=Object.assign(Object.assign({},i),{external:r.to});return t.specializers[s]=Ip(a),a})),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),e.bufferLength!=null&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return t==null?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),i=t.map(()=>!1);if(e)for(let r of e.split(" ")){let a=t.indexOf(r);a>=0&&(i[a]=!0)}let s=null;for(let r=0;r<t.length;r++)if(!i[r])for(let a=this.dialects[t[r]],o;(o=this.data[a++])!=65535;)(s||(s=new Uint8Array(this.maxTerm+1)))[o]=1;return new HA(e,i,s)}static deserialize(e){return new ul(e)}}function ps(n,e){return n[e]|n[e+1]<<16}function JA(n){let e=null;for(let t of n){let i=t.p.stoppedAt;(t.pos==t.p.stream.end||i!=null&&t.pos>i)&&t.p.parser.stateFlag(t.state,2)&&(!e||e.score<t.score)&&(e=t)}return e}function Ip(n){if(n.external){let e=n.extend?1:0;return(t,i)=>n.external(t,i)<<1|e}return n.get}let ek=0;class fi{constructor(e,t,i,s){this.name=e,this.set=t,this.base=i,this.modified=s,this.id=ek++}toString(){let{name:e}=this;for(let t of this.modified)t.name&&(e=`${t.name}(${e})`);return e}static define(e,t){let i=typeof e=="string"?e:"?";if(e instanceof fi&&(t=e),t!=null&&t.base)throw new Error("Can not derive from a modified tag");let s=new fi(i,[],null,[]);if(s.set.push(s),t)for(let r of t.set)s.set.push(r);return s}static defineModifier(e){let t=new cl(e);return i=>i.modified.indexOf(t)>-1?i:cl.get(i.base||i,i.modified.concat(t).sort((s,r)=>s.id-r.id))}}let tk=0;class cl{constructor(e){this.name=e,this.instances=[],this.id=tk++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(o=>o.base==e&&nk(t,o.modified));if(i)return i;let s=[],r=new fi(e.name,s,e,t);for(let o of t)o.instances.push(r);let a=ik(t);for(let o of e.set)if(!o.modified.length)for(let l of a)s.push(cl.get(o,l));return r}}function nk(n,e){return n.length==e.length&&n.every((t,i)=>t==e[i])}function ik(n){let e=[[]];for(let t=0;t<n.length;t++)for(let i=0,s=e.length;i<s;i++)e.push(e[i].concat(n[t]));return e.sort((t,i)=>i.length-t.length)}function Y1(n){let e=Object.create(null);for(let t in n){let i=n[t];Array.isArray(i)||(i=[i]);for(let s of t.split(" "))if(s){let r=[],a=2,o=s;for(let h=0;;){if(o=="..."&&h>0&&h+3==s.length){a=1;break}let d=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!d)throw new RangeError("Invalid path: "+s);if(r.push(d[0]=="*"?"":d[0][0]=='"'?JSON.parse(d[0]):d[0]),h+=d[0].length,h==s.length)break;let f=s[h++];if(h==s.length&&f=="!"){a=0;break}if(f!="/")throw new RangeError("Invalid path: "+s);o=s.slice(h)}let l=r.length-1,c=r[l];if(!c)throw new RangeError("Invalid path: "+s);let u=new Ra(i,a,l>0?r.slice(0,l):null);e[c]=u.sort(e[c])}}return H1.add(e)}const H1=new at({combine(n,e){let t,i,s;for(;n||e;){if(!n||e&&n.depth>=e.depth?(s=e,e=e.next):(s=n,n=n.next),t&&t.mode==s.mode&&!s.context&&!t.context)continue;let r=new Ra(s.tags,s.mode,s.context);t?t.next=r:i=r,t=r}return i}});class Ra{constructor(e,t,i,s){this.tags=e,this.mode=t,this.context=i,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}Ra.empty=new Ra([],2,null);function K1(n,e){let t=Object.create(null);for(let r of n)if(!Array.isArray(r.tag))t[r.tag.id]=r.class;else for(let a of r.tag)t[a.id]=r.class;let{scope:i,all:s=null}=e||{};return{style:r=>{let a=s;for(let o of r)for(let l of o.set){let c=t[l.id];if(c){a=a?a+" "+c:c;break}}return a},scope:i}}function sk(n,e){let t=null;for(let i of n){let s=i.style(e);s&&(t=t?t+" "+s:s)}return t}function rk(n,e,t,i=0,s=n.length){let r=new ak(i,Array.isArray(e)?e:[e],t);r.highlightRange(n.cursor(),i,s,"",r.highlighters),r.flush(s)}class ak{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,s,r){let{type:a,from:o,to:l}=e;if(o>=i||l<=t)return;a.isTop&&(r=this.highlighters.filter(f=>!f.scope||f.scope(a)));let c=s,u=ok(e)||Ra.empty,h=sk(r,u.tags);if(h&&(c&&(c+=" "),c+=h,u.mode==1&&(s+=(s?" ":"")+h)),this.startSpan(Math.max(t,o),c),u.opaque)return;let d=e.tree&&e.tree.prop(at.mounted);if(d&&d.overlay){let f=e.node.enter(d.overlay[0].from+o,1),m=this.highlighters.filter(y=>!y.scope||y.scope(d.tree.type)),g=e.firstChild();for(let y=0,b=o;;y++){let P=y<d.overlay.length?d.overlay[y]:null,k=P?P.from+o:l,w=Math.max(t,b),C=Math.min(i,k);if(w<C&&g)for(;e.from<C&&(this.highlightRange(e,w,C,s,r),this.startSpan(Math.min(C,e.to),c),!(e.to>=k||!e.nextSibling())););if(!P||k>i)break;b=P.to+o,b>t&&(this.highlightRange(f.cursor(),Math.max(t,P.from+o),Math.min(i,b),"",m),this.startSpan(Math.min(i,b),c))}g&&e.parent()}else if(e.firstChild()){d&&(s="");do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,s,r),this.startSpan(Math.min(i,e.to),c)}while(e.nextSibling());e.parent()}}}function ok(n){let e=n.type.prop(H1);for(;e&&e.context&&!n.matchContext(e.context);)e=e.next;return e||null}const Oe=fi.define,wo=Oe(),$s=Oe(),Vp=Oe($s),zp=Oe($s),Ds=Oe(),Po=Oe(Ds),Qu=Oe(Ds),Wi=Oe(),Us=Oe(Wi),qi=Oe(),Gi=Oe(),xh=Oe(),sa=Oe(xh),xo=Oe(),j={comment:wo,lineComment:Oe(wo),blockComment:Oe(wo),docComment:Oe(wo),name:$s,variableName:Oe($s),typeName:Vp,tagName:Oe(Vp),propertyName:zp,attributeName:Oe(zp),className:Oe($s),labelName:Oe($s),namespace:Oe($s),macroName:Oe($s),literal:Ds,string:Po,docString:Oe(Po),character:Oe(Po),attributeValue:Oe(Po),number:Qu,integer:Oe(Qu),float:Oe(Qu),bool:Oe(Ds),regexp:Oe(Ds),escape:Oe(Ds),color:Oe(Ds),url:Oe(Ds),keyword:qi,self:Oe(qi),null:Oe(qi),atom:Oe(qi),unit:Oe(qi),modifier:Oe(qi),operatorKeyword:Oe(qi),controlKeyword:Oe(qi),definitionKeyword:Oe(qi),moduleKeyword:Oe(qi),operator:Gi,derefOperator:Oe(Gi),arithmeticOperator:Oe(Gi),logicOperator:Oe(Gi),bitwiseOperator:Oe(Gi),compareOperator:Oe(Gi),updateOperator:Oe(Gi),definitionOperator:Oe(Gi),typeOperator:Oe(Gi),controlOperator:Oe(Gi),punctuation:xh,separator:Oe(xh),bracket:sa,angleBracket:Oe(sa),squareBracket:Oe(sa),paren:Oe(sa),brace:Oe(sa),content:Wi,heading:Us,heading1:Oe(Us),heading2:Oe(Us),heading3:Oe(Us),heading4:Oe(Us),heading5:Oe(Us),heading6:Oe(Us),contentSeparator:Oe(Wi),list:Oe(Wi),quote:Oe(Wi),emphasis:Oe(Wi),strong:Oe(Wi),link:Oe(Wi),monospace:Oe(Wi),strikethrough:Oe(Wi),inserted:Oe(),deleted:Oe(),changed:Oe(),invalid:Oe(),meta:xo,documentMeta:Oe(xo),annotation:Oe(xo),processingInstruction:Oe(xo),definition:fi.defineModifier("definition"),constant:fi.defineModifier("constant"),function:fi.defineModifier("function"),standard:fi.defineModifier("standard"),local:fi.defineModifier("local"),special:fi.defineModifier("special")};for(let n in j){let e=j[n];e instanceof fi&&(e.name=n)}K1([{tag:j.link,class:"tok-link"},{tag:j.heading,class:"tok-heading"},{tag:j.emphasis,class:"tok-emphasis"},{tag:j.strong,class:"tok-strong"},{tag:j.keyword,class:"tok-keyword"},{tag:j.atom,class:"tok-atom"},{tag:j.bool,class:"tok-bool"},{tag:j.url,class:"tok-url"},{tag:j.labelName,class:"tok-labelName"},{tag:j.inserted,class:"tok-inserted"},{tag:j.deleted,class:"tok-deleted"},{tag:j.literal,class:"tok-literal"},{tag:j.string,class:"tok-string"},{tag:j.number,class:"tok-number"},{tag:[j.regexp,j.escape,j.special(j.string)],class:"tok-string2"},{tag:j.variableName,class:"tok-variableName"},{tag:j.local(j.variableName),class:"tok-variableName tok-local"},{tag:j.definition(j.variableName),class:"tok-variableName tok-definition"},{tag:j.special(j.variableName),class:"tok-variableName2"},{tag:j.definition(j.propertyName),class:"tok-propertyName tok-definition"},{tag:j.typeName,class:"tok-typeName"},{tag:j.namespace,class:"tok-namespace"},{tag:j.className,class:"tok-className"},{tag:j.macroName,class:"tok-macroName"},{tag:j.propertyName,class:"tok-propertyName"},{tag:j.operator,class:"tok-operator"},{tag:j.comment,class:"tok-comment"},{tag:j.meta,class:"tok-meta"},{tag:j.invalid,class:"tok-invalid"},{tag:j.punctuation,class:"tok-punctuation"}]);const lk=316,uk=317,Zp=1,ck=2,hk=3,dk=4,fk=318,pk=320,mk=321,gk=5,Ok=6,yk=0,Ch=[9,10,11,12,13,32,133,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288],J1=125,bk=59,Ah=47,vk=42,Sk=43,wk=45,Pk=60,xk=44,Ck=63,Ak=46,kk=91,Ek=new KA({start:!1,shift(n,e){return e==gk||e==Ok||e==pk?n:e==mk},strict:!1}),$k=new Ya((n,e)=>{let{next:t}=n;(t==J1||t==-1||e.context)&&n.acceptToken(fk)},{contextual:!0,fallback:!0}),Dk=new Ya((n,e)=>{let{next:t}=n,i;Ch.indexOf(t)>-1||t==Ah&&((i=n.peek(1))==Ah||i==vk)||t!=J1&&t!=bk&&t!=-1&&!e.context&&n.acceptToken(lk)},{contextual:!0}),Mk=new Ya((n,e)=>{n.next==kk&&!e.context&&n.acceptToken(uk)},{contextual:!0}),Tk=new Ya((n,e)=>{let{next:t}=n;if(t==Sk||t==wk){if(n.advance(),t==n.next){n.advance();let i=!e.context&&e.canShift(Zp);n.acceptToken(i?Zp:ck)}}else t==Ck&&n.peek(1)==Ak&&(n.advance(),n.advance(),(n.next<48||n.next>57)&&n.acceptToken(hk))},{contextual:!0});function Ru(n,e){return n>=65&&n<=90||n>=97&&n<=122||n==95||n>=192||!e&&n>=48&&n<=57}const _k=new Ya((n,e)=>{if(n.next!=Pk||!e.dialectEnabled(yk)||(n.advance(),n.next==Ah))return;let t=0;for(;Ch.indexOf(n.next)>-1;)n.advance(),t++;if(Ru(n.next,!0)){for(n.advance(),t++;Ru(n.next,!1);)n.advance(),t++;for(;Ch.indexOf(n.next)>-1;)n.advance(),t++;if(n.next==xk)return;for(let i=0;;i++){if(i==7){if(!Ru(n.next,!0))return;break}if(n.next!="extends".charCodeAt(i))break;n.advance(),t++}}n.acceptToken(dk,-t)}),Fk=Y1({"get set async static":j.modifier,"for while do if else switch try catch finally return throw break continue default case defer":j.controlKeyword,"in of await yield void typeof delete instanceof as satisfies":j.operatorKeyword,"let var const using function class extends":j.definitionKeyword,"import export from":j.moduleKeyword,"with debugger new":j.keyword,TemplateString:j.special(j.string),super:j.atom,BooleanLiteral:j.bool,this:j.self,null:j.null,Star:j.modifier,VariableName:j.variableName,"CallExpression/VariableName TaggedTemplateExpression/VariableName":j.function(j.variableName),VariableDefinition:j.definition(j.variableName),Label:j.labelName,PropertyName:j.propertyName,PrivatePropertyName:j.special(j.propertyName),"CallExpression/MemberExpression/PropertyName":j.function(j.propertyName),"FunctionDeclaration/VariableDefinition":j.function(j.definition(j.variableName)),"ClassDeclaration/VariableDefinition":j.definition(j.className),"NewExpression/VariableName":j.className,PropertyDefinition:j.definition(j.propertyName),PrivatePropertyDefinition:j.definition(j.special(j.propertyName)),UpdateOp:j.updateOperator,"LineComment Hashbang":j.lineComment,BlockComment:j.blockComment,Number:j.number,String:j.string,Escape:j.escape,ArithOp:j.arithmeticOperator,LogicOp:j.logicOperator,BitOp:j.bitwiseOperator,CompareOp:j.compareOperator,RegExp:j.regexp,Equals:j.definitionOperator,Arrow:j.function(j.punctuation),": Spread":j.punctuation,"( )":j.paren,"[ ]":j.squareBracket,"{ }":j.brace,"InterpolationStart InterpolationEnd":j.special(j.brace),".":j.derefOperator,", ;":j.separator,"@":j.meta,TypeName:j.typeName,TypeDefinition:j.definition(j.typeName),"type enum interface implements namespace module declare":j.definitionKeyword,"abstract global Privacy readonly override":j.modifier,"is keyof unique infer asserts":j.operatorKeyword,JSXAttributeValue:j.attributeValue,JSXText:j.content,"JSXStartTag JSXStartCloseTag JSXSelfCloseEndTag JSXEndTag":j.angleBracket,"JSXIdentifier JSXNameSpacedName":j.tagName,"JSXAttribute/JSXIdentifier JSXAttribute/JSXNameSpacedName":j.attributeName,"JSXBuiltin/JSXIdentifier":j.standard(j.tagName)}),Bk={__proto__:null,export:20,as:25,from:33,default:36,async:41,function:42,in:52,out:55,const:56,extends:60,this:64,true:72,false:72,null:84,void:88,typeof:92,super:108,new:142,delete:154,yield:163,await:167,class:172,public:235,private:235,protected:235,readonly:237,instanceof:256,satisfies:259,import:292,keyof:349,unique:353,infer:359,asserts:395,is:397,abstract:417,implements:419,type:421,let:424,var:426,using:429,interface:435,enum:439,namespace:445,module:447,declare:451,global:455,defer:471,for:476,of:485,while:488,with:492,do:496,if:500,else:502,switch:506,case:512,try:518,catch:522,finally:526,return:530,throw:534,break:538,continue:542,debugger:546},Nk={__proto__:null,async:129,get:131,set:133,declare:195,public:197,private:197,protected:197,static:199,abstract:201,override:203,readonly:209,accessor:211,new:401},Qk={__proto__:null,"<":193},Rk=ul.deserialize({version:14,states:"$F|Q%TQlOOO%[QlOOO'_QpOOP(lO`OOO*zQ!0MxO'#CiO+RO#tO'#CjO+aO&jO'#CjO+oO#@ItO'#DaO.QQlO'#DgO.bQlO'#DrO%[QlO'#DzO0fQlO'#ESOOQ!0Lf'#E['#E[O1PQ`O'#EXOOQO'#Ep'#EpOOQO'#Il'#IlO1XQ`O'#GsO1dQ`O'#EoO1iQ`O'#EoO3hQ!0MxO'#JrO6[Q!0MxO'#JsO6uQ`O'#F]O6zQ,UO'#FtOOQ!0Lf'#Ff'#FfO7VO7dO'#FfO9XQMhO'#F|O9`Q`O'#F{OOQ!0Lf'#Js'#JsOOQ!0Lb'#Jr'#JrO9eQ`O'#GwOOQ['#K_'#K_O9pQ`O'#IYO9uQ!0LrO'#IZOOQ['#J`'#J`OOQ['#I_'#I_Q`QlOOQ`QlOOO9}Q!L^O'#DvO:UQlO'#EOO:]QlO'#EQO9kQ`O'#GsO:dQMhO'#CoO:rQ`O'#EnO:}Q`O'#EyO;hQMhO'#FeO;xQ`O'#GsOOQO'#K`'#K`O;}Q`O'#K`O<]Q`O'#G{O<]Q`O'#G|O<]Q`O'#HOO9kQ`O'#HRO=SQ`O'#HUO>kQ`O'#CeO>{Q`O'#HcO?TQ`O'#HiO?TQ`O'#HkO`QlO'#HmO?TQ`O'#HoO?TQ`O'#HrO?YQ`O'#HxO?_Q!0LsO'#IOO%[QlO'#IQO?jQ!0LsO'#ISO?uQ!0LsO'#IUO9uQ!0LrO'#IWO@QQ!0MxO'#CiOASQpO'#DlQOQ`OOO%[QlO'#EQOAjQ`O'#ETO:dQMhO'#EnOAuQ`O'#EnOBQQ!bO'#FeOOQ['#Cg'#CgOOQ!0Lb'#Dq'#DqOOQ!0Lb'#Jv'#JvO%[QlO'#JvOOQO'#Jy'#JyOOQO'#Ih'#IhOCQQpO'#EgOOQ!0Lb'#Ef'#EfOOQ!0Lb'#J}'#J}OC|Q!0MSO'#EgODWQpO'#EWOOQO'#Jx'#JxODlQpO'#JyOEyQpO'#EWODWQpO'#EgPFWO&2DjO'#CbPOOO)CD})CD}OOOO'#I`'#I`OFcO#tO,59UOOQ!0Lh,59U,59UOOOO'#Ia'#IaOFqO&jO,59UOGPQ!L^O'#DcOOOO'#Ic'#IcOGWO#@ItO,59{OOQ!0Lf,59{,59{OGfQlO'#IdOGyQ`O'#JtOIxQ!fO'#JtO+}QlO'#JtOJPQ`O,5:ROJgQ`O'#EpOJtQ`O'#KTOKPQ`O'#KSOKPQ`O'#KSOKXQ`O,5;^OK^Q`O'#KROOQ!0Ln,5:^,5:^OKeQlO,5:^OMcQ!0MxO,5:fONSQ`O,5:nONmQ!0LrO'#KQONtQ`O'#KPO9eQ`O'#KPO! YQ`O'#KPO! bQ`O,5;]O! gQ`O'#KPO!#lQ!fO'#JsOOQ!0Lh'#Ci'#CiO%[QlO'#ESO!$[Q!fO,5:sOOQS'#Jz'#JzOOQO-E<j-E<jO9kQ`O,5=_O!$rQ`O,5=_O!$wQlO,5;ZO!&zQMhO'#EkO!(eQ`O,5;ZO!(jQlO'#DyO!(tQpO,5;dO!(|QpO,5;dO%[QlO,5;dOOQ['#FT'#FTOOQ['#FV'#FVO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eO%[QlO,5;eOOQ['#FZ'#FZO!)[QlO,5;tOOQ!0Lf,5;y,5;yOOQ!0Lf,5;z,5;zOOQ!0Lf,5;|,5;|O%[QlO'#IpO!+_Q!0LrO,5<iO%[QlO,5;eO!&zQMhO,5;eO!+|QMhO,5;eO!-nQMhO'#E^O%[QlO,5;wOOQ!0Lf,5;{,5;{O!-uQ,UO'#FjO!.rQ,UO'#KXO!.^Q,UO'#KXO!.yQ,UO'#KXOOQO'#KX'#KXO!/_Q,UO,5<SOOOW,5<`,5<`O!/pQlO'#FvOOOW'#Io'#IoO7VO7dO,5<QO!/wQ,UO'#FxOOQ!0Lf,5<Q,5<QO!0hQ$IUO'#CyOOQ!0Lh'#C}'#C}O!0{O#@ItO'#DRO!1iQMjO,5<eO!1pQ`O,5<hO!3YQ(CWO'#GXO!3jQ`O'#GYO!3oQ`O'#GYO!5_Q(CWO'#G^O!6dQpO'#GbOOQO'#Gn'#GnO!,TQMhO'#GmOOQO'#Gp'#GpO!,TQMhO'#GoO!7VQ$IUO'#JlOOQ!0Lh'#Jl'#JlO!7aQ`O'#JkO!7oQ`O'#JjO!7wQ`O'#CuOOQ!0Lh'#C{'#C{O!8YQ`O'#C}OOQ!0Lh'#DV'#DVOOQ!0Lh'#DX'#DXO!8_Q`O,5<eO1SQ`O'#DZO!,TQMhO'#GPO!,TQMhO'#GRO!8gQ`O'#GTO!8lQ`O'#GUO!3oQ`O'#G[O!,TQMhO'#GaO<]Q`O'#JkO!8qQ`O'#EqO!9`Q`O,5<gOOQ!0Lb'#Cr'#CrO!9hQ`O'#ErO!:bQpO'#EsOOQ!0Lb'#KR'#KRO!:iQ!0LrO'#KaO9uQ!0LrO,5=cO`QlO,5>tOOQ['#Jh'#JhOOQ[,5>u,5>uOOQ[-E<]-E<]O!<hQ!0MxO,5:bO!:]QpO,5:`O!?RQ!0MxO,5:jO%[QlO,5:jO!AiQ!0MxO,5:lOOQO,5@z,5@zO!BYQMhO,5=_O!BhQ!0LrO'#JiO9`Q`O'#JiO!ByQ!0LrO,59ZO!CUQpO,59ZO!C^QMhO,59ZO:dQMhO,59ZO!CiQ`O,5;ZO!CqQ`O'#HbO!DVQ`O'#KdO%[QlO,5;}O!:]QpO,5<PO!D_Q`O,5=zO!DdQ`O,5=zO!DiQ`O,5=zO!DwQ`O,5=zO9uQ!0LrO,5=zO<]Q`O,5=jOOQO'#Cy'#CyO!EOQpO,5=gO!EWQMhO,5=hO!EcQ`O,5=jO!EhQ!bO,5=mO!EpQ`O'#K`O?YQ`O'#HWO9kQ`O'#HYO!EuQ`O'#HYO:dQMhO'#H[O!EzQ`O'#H[OOQ[,5=p,5=pO!FPQ`O'#H]O!FbQ`O'#CoO!FgQ`O,59PO!FqQ`O,59PO!HvQlO,59POOQ[,59P,59PO!IWQ!0LrO,59PO%[QlO,59PO!KcQlO'#HeOOQ['#Hf'#HfOOQ['#Hg'#HgO`QlO,5=}O!KyQ`O,5=}O`QlO,5>TO`QlO,5>VO!LOQ`O,5>XO`QlO,5>ZO!LTQ`O,5>^O!LYQlO,5>dOOQ[,5>j,5>jO%[QlO,5>jO9uQ!0LrO,5>lOOQ[,5>n,5>nO#!dQ`O,5>nOOQ[,5>p,5>pO#!dQ`O,5>pOOQ[,5>r,5>rO##QQpO'#D_O%[QlO'#JvO##sQpO'#JvO##}QpO'#DmO#$`QpO'#DmO#&qQlO'#DmO#&xQ`O'#JuO#'QQ`O,5:WO#'VQ`O'#EtO#'eQ`O'#KUO#'mQ`O,5;_O#'rQpO'#DmO#(PQpO'#EVOOQ!0Lf,5:o,5:oO%[QlO,5:oO#(WQ`O,5:oO?YQ`O,5;YO!CUQpO,5;YO!C^QMhO,5;YO:dQMhO,5;YO#(`Q`O,5@bO#(eQ07dO,5:sOOQO-E<f-E<fO#)kQ!0MSO,5;RODWQpO,5:rO#)uQpO,5:rODWQpO,5;RO!ByQ!0LrO,5:rOOQ!0Lb'#Ej'#EjOOQO,5;R,5;RO%[QlO,5;RO#*SQ!0LrO,5;RO#*_Q!0LrO,5;RO!CUQpO,5:rOOQO,5;X,5;XO#*mQ!0LrO,5;RPOOO'#I^'#I^P#+RO&2DjO,58|POOO,58|,58|OOOO-E<^-E<^OOQ!0Lh1G.p1G.pOOOO-E<_-E<_OOOO,59},59}O#+^Q!bO,59}OOOO-E<a-E<aOOQ!0Lf1G/g1G/gO#+cQ!fO,5?OO+}QlO,5?OOOQO,5?U,5?UO#+mQlO'#IdOOQO-E<b-E<bO#+zQ`O,5@`O#,SQ!fO,5@`O#,ZQ`O,5@nOOQ!0Lf1G/m1G/mO%[QlO,5@oO#,cQ`O'#IjOOQO-E<h-E<hO#,ZQ`O,5@nOOQ!0Lb1G0x1G0xOOQ!0Ln1G/x1G/xOOQ!0Ln1G0Y1G0YO%[QlO,5@lO#,wQ!0LrO,5@lO#-YQ!0LrO,5@lO#-aQ`O,5@kO9eQ`O,5@kO#-iQ`O,5@kO#-wQ`O'#ImO#-aQ`O,5@kOOQ!0Lb1G0w1G0wO!(tQpO,5:uO!)PQpO,5:uOOQS,5:w,5:wO#.iQdO,5:wO#.qQMhO1G2yO9kQ`O1G2yOOQ!0Lf1G0u1G0uO#/PQ!0MxO1G0uO#0UQ!0MvO,5;VOOQ!0Lh'#GW'#GWO#0rQ!0MzO'#JlO!$wQlO1G0uO#2}Q!fO'#JwO%[QlO'#JwO#3XQ`O,5:eOOQ!0Lh'#D_'#D_OOQ!0Lf1G1O1G1OO%[QlO1G1OOOQ!0Lf1G1f1G1fO#3^Q`O1G1OO#5rQ!0MxO1G1PO#5yQ!0MxO1G1PO#8aQ!0MxO1G1PO#8hQ!0MxO1G1PO#;OQ!0MxO1G1PO#=fQ!0MxO1G1PO#=mQ!0MxO1G1PO#=tQ!0MxO1G1PO#@[Q!0MxO1G1PO#@cQ!0MxO1G1PO#BpQ?MtO'#CiO#DkQ?MtO1G1`O#DrQ?MtO'#JsO#EVQ!0MxO,5?[OOQ!0Lb-E<n-E<nO#GdQ!0MxO1G1PO#HaQ!0MzO1G1POOQ!0Lf1G1P1G1PO#IdQMjO'#J|O#InQ`O,5:xO#IsQ!0MxO1G1cO#JgQ,UO,5<WO#JoQ,UO,5<XO#JwQ,UO'#FoO#K`Q`O'#FnOOQO'#KY'#KYOOQO'#In'#InO#KeQ,UO1G1nOOQ!0Lf1G1n1G1nOOOW1G1y1G1yO#KvQ?MtO'#JrO#LQQ`O,5<bO!)[QlO,5<bOOOW-E<m-E<mOOQ!0Lf1G1l1G1lO#LVQpO'#KXOOQ!0Lf,5<d,5<dO#L_QpO,5<dO#LdQMhO'#DTOOOO'#Ib'#IbO#LkO#@ItO,59mOOQ!0Lh,59m,59mO%[QlO1G2PO!8lQ`O'#IrO#LvQ`O,5<zOOQ!0Lh,5<w,5<wO!,TQMhO'#IuO#MdQMjO,5=XO!,TQMhO'#IwO#NVQMjO,5=ZO!&zQMhO,5=]OOQO1G2S1G2SO#NaQ!dO'#CrO#NtQ(CWO'#ErO$ |QpO'#GbO$!dQ!dO,5<sO$!kQ`O'#K[O9eQ`O'#K[O$!yQ`O,5<uO$#aQ!dO'#C{O!,TQMhO,5<tO$#kQ`O'#GZO$$PQ`O,5<tO$$UQ!dO'#GWO$$cQ!dO'#K]O$$mQ`O'#K]O!&zQMhO'#K]O$$rQ`O,5<xO$$wQlO'#JvO$%RQpO'#GcO#$`QpO'#GcO$%dQ`O'#GgO!3oQ`O'#GkO$%iQ!0LrO'#ItO$%tQpO,5<|OOQ!0Lp,5<|,5<|O$%{QpO'#GcO$&YQpO'#GdO$&kQpO'#GdO$&pQMjO,5=XO$'QQMjO,5=ZOOQ!0Lh,5=^,5=^O!,TQMhO,5@VO!,TQMhO,5@VO$'bQ`O'#IyO$'vQ`O,5@UO$(OQ`O,59aOOQ!0Lh,59i,59iO$(TQ`O,5@VO$)TQ$IYO,59uOOQ!0Lh'#Jp'#JpO$)vQMjO,5<kO$*iQMjO,5<mO@zQ`O,5<oOOQ!0Lh,5<p,5<pO$*sQ`O,5<vO$*xQMjO,5<{O$+YQ`O'#KPO!$wQlO1G2RO$+_Q`O1G2RO9eQ`O'#KSO9eQ`O'#EtO%[QlO'#EtO9eQ`O'#I{O$+dQ!0LrO,5@{OOQ[1G2}1G2}OOQ[1G4`1G4`OOQ!0Lf1G/|1G/|OOQ!0Lf1G/z1G/zO$-fQ!0MxO1G0UOOQ[1G2y1G2yO!&zQMhO1G2yO%[QlO1G2yO#.tQ`O1G2yO$/jQMhO'#EkOOQ!0Lb,5@T,5@TO$/wQ!0LrO,5@TOOQ[1G.u1G.uO!ByQ!0LrO1G.uO!CUQpO1G.uO!C^QMhO1G.uO$0YQ`O1G0uO$0_Q`O'#CiO$0jQ`O'#KeO$0rQ`O,5=|O$0wQ`O'#KeO$0|Q`O'#KeO$1[Q`O'#JRO$1jQ`O,5AOO$1rQ!fO1G1iOOQ!0Lf1G1k1G1kO9kQ`O1G3fO@zQ`O1G3fO$1yQ`O1G3fO$2OQ`O1G3fO!DiQ`O1G3fO9uQ!0LrO1G3fOOQ[1G3f1G3fO!EcQ`O1G3UO!&zQMhO1G3RO$2TQ`O1G3ROOQ[1G3S1G3SO!&zQMhO1G3SO$2YQ`O1G3SO$2bQpO'#HQOOQ[1G3U1G3UO!6_QpO'#I}O!EhQ!bO1G3XOOQ[1G3X1G3XOOQ[,5=r,5=rO$2jQMhO,5=tO9kQ`O,5=tO$%dQ`O,5=vO9`Q`O,5=vO!CUQpO,5=vO!C^QMhO,5=vO:dQMhO,5=vO$2xQ`O'#KcO$3TQ`O,5=wOOQ[1G.k1G.kO$3YQ!0LrO1G.kO@zQ`O1G.kO$3eQ`O1G.kO9uQ!0LrO1G.kO$5mQ!fO,5AQO$5zQ`O,5AQO9eQ`O,5AQO$6VQlO,5>PO$6^Q`O,5>POOQ[1G3i1G3iO`QlO1G3iOOQ[1G3o1G3oOOQ[1G3q1G3qO?TQ`O1G3sO$6cQlO1G3uO$:gQlO'#HtOOQ[1G3x1G3xO$:tQ`O'#HzO?YQ`O'#H|OOQ[1G4O1G4OO$:|QlO1G4OO9uQ!0LrO1G4UOOQ[1G4W1G4WOOQ!0Lb'#G_'#G_O9uQ!0LrO1G4YO9uQ!0LrO1G4[O$?TQ`O,5@bO!)[QlO,5;`O9eQ`O,5;`O?YQ`O,5:XO!)[QlO,5:XO!CUQpO,5:XO$?YQ?MtO,5:XOOQO,5;`,5;`O$?dQpO'#IeO$?zQ`O,5@aOOQ!0Lf1G/r1G/rO$@SQpO'#IkO$@^Q`O,5@pOOQ!0Lb1G0y1G0yO#$`QpO,5:XOOQO'#Ig'#IgO$@fQpO,5:qOOQ!0Ln,5:q,5:qO#(ZQ`O1G0ZOOQ!0Lf1G0Z1G0ZO%[QlO1G0ZOOQ!0Lf1G0t1G0tO?YQ`O1G0tO!CUQpO1G0tO!C^QMhO1G0tOOQ!0Lb1G5|1G5|O!ByQ!0LrO1G0^OOQO1G0m1G0mO%[QlO1G0mO$@mQ!0LrO1G0mO$@xQ!0LrO1G0mO!CUQpO1G0^ODWQpO1G0^O$AWQ!0LrO1G0mOOQO1G0^1G0^O$AlQ!0MxO1G0mPOOO-E<[-E<[POOO1G.h1G.hOOOO1G/i1G/iO$AvQ!bO,5<iO$BOQ!fO1G4jOOQO1G4p1G4pO%[QlO,5?OO$BYQ`O1G5zO$BbQ`O1G6YO$BjQ!fO1G6ZO9eQ`O,5?UO$BtQ!0MxO1G6WO%[QlO1G6WO$CUQ!0LrO1G6WO$CgQ`O1G6VO$CgQ`O1G6VO9eQ`O1G6VO$CoQ`O,5?XO9eQ`O,5?XOOQO,5?X,5?XO$DTQ`O,5?XO$+YQ`O,5?XOOQO-E<k-E<kOOQS1G0a1G0aOOQS1G0c1G0cO#.lQ`O1G0cOOQ[7+(e7+(eO!&zQMhO7+(eO%[QlO7+(eO$DcQ`O7+(eO$DnQMhO7+(eO$D|Q!0MzO,5=XO$GXQ!0MzO,5=ZO$IdQ!0MzO,5=XO$KuQ!0MzO,5=ZO$NWQ!0MzO,59uO%!]Q!0MzO,5<kO%$hQ!0MzO,5<mO%&sQ!0MzO,5<{OOQ!0Lf7+&a7+&aO%)UQ!0MxO7+&aO%)xQlO'#IfO%*VQ`O,5@cO%*_Q!fO,5@cOOQ!0Lf1G0P1G0PO%*iQ`O7+&jOOQ!0Lf7+&j7+&jO%*nQ?MtO,5:fO%[QlO7+&zO%*xQ?MtO,5:bO%+VQ?MtO,5:jO%+aQ?MtO,5:lO%+kQMhO'#IiO%+uQ`O,5@hOOQ!0Lh1G0d1G0dOOQO1G1r1G1rOOQO1G1s1G1sO%+}Q!jO,5<ZO!)[QlO,5<YOOQO-E<l-E<lOOQ!0Lf7+'Y7+'YOOOW7+'e7+'eOOOW1G1|1G1|O%,YQ`O1G1|OOQ!0Lf1G2O1G2OOOOO,59o,59oO%,_Q!dO,59oOOOO-E<`-E<`OOQ!0Lh1G/X1G/XO%,fQ!0MxO7+'kOOQ!0Lh,5?^,5?^O%-YQMhO1G2fP%-aQ`O'#IrPOQ!0Lh-E<p-E<pO%-}QMjO,5?aOOQ!0Lh-E<s-E<sO%.pQMjO,5?cOOQ!0Lh-E<u-E<uO%.zQ!dO1G2wO%/RQ!dO'#CrO%/iQMhO'#KSO$$wQlO'#JvOOQ!0Lh1G2_1G2_O%/sQ`O'#IqO%0[Q`O,5@vO%0[Q`O,5@vO%0dQ`O,5@vO%0oQ`O,5@vOOQO1G2a1G2aO%0}QMjO1G2`O$+YQ`O'#K[O!,TQMhO1G2`O%1_Q(CWO'#IsO%1lQ`O,5@wO!&zQMhO,5@wO%1tQ!dO,5@wOOQ!0Lh1G2d1G2dO%4UQ!fO'#CiO%4`Q`O,5=POOQ!0Lb,5<},5<}O%4hQpO,5<}OOQ!0Lb,5=O,5=OOCwQ`O,5<}O%4sQpO,5<}OOQ!0Lb,5=R,5=RO$+YQ`O,5=VOOQO,5?`,5?`OOQO-E<r-E<rOOQ!0Lp1G2h1G2hO#$`QpO,5<}O$$wQlO,5=PO%5RQ`O,5=OO%5^QpO,5=OO!,TQMhO'#IuO%6WQMjO1G2sO!,TQMhO'#IwO%6yQMjO1G2uO%7TQMjO1G5qO%7_QMjO1G5qOOQO,5?e,5?eOOQO-E<w-E<wOOQO1G.{1G.{O!,TQMhO1G5qO!,TQMhO1G5qO!:]QpO,59wO%[QlO,59wOOQ!0Lh,5<j,5<jO%7lQ`O1G2ZO!,TQMhO1G2bO%7qQ!0MxO7+'mOOQ!0Lf7+'m7+'mO!$wQlO7+'mO%8eQ`O,5;`OOQ!0Lb,5?g,5?gOOQ!0Lb-E<y-E<yO%8jQ!dO'#K^O#(ZQ`O7+(eO4UQ!fO7+(eO$DfQ`O7+(eO%8tQ!0MvO'#CiO%9XQ!0MvO,5=SO%9lQ`O,5=SO%9tQ`O,5=SOOQ!0Lb1G5o1G5oOOQ[7+$a7+$aO!ByQ!0LrO7+$aO!CUQpO7+$aO!$wQlO7+&aO%9yQ`O'#JQO%:bQ`O,5APOOQO1G3h1G3hO9kQ`O,5APO%:bQ`O,5APO%:jQ`O,5APOOQO,5?m,5?mOOQO-E=P-E=POOQ!0Lf7+'T7+'TO%:oQ`O7+)QO9uQ!0LrO7+)QO9kQ`O7+)QO@zQ`O7+)QO%:tQ`O7+)QOOQ[7+)Q7+)QOOQ[7+(p7+(pO%:yQ!0MvO7+(mO!&zQMhO7+(mO!E^Q`O7+(nOOQ[7+(n7+(nO!&zQMhO7+(nO%;TQ`O'#KbO%;`Q`O,5=lOOQO,5?i,5?iOOQO-E<{-E<{OOQ[7+(s7+(sO%<rQpO'#HZOOQ[1G3`1G3`O!&zQMhO1G3`O%[QlO1G3`O%<yQ`O1G3`O%=UQMhO1G3`O9uQ!0LrO1G3bO$%dQ`O1G3bO9`Q`O1G3bO!CUQpO1G3bO!C^QMhO1G3bO%=dQ`O'#JPO%=xQ`O,5@}O%>QQpO,5@}OOQ!0Lb1G3c1G3cOOQ[7+$V7+$VO@zQ`O7+$VO9uQ!0LrO7+$VO%>]Q`O7+$VO%[QlO1G6lO%[QlO1G6mO%>bQ!0LrO1G6lO%>lQlO1G3kO%>sQ`O1G3kO%>xQlO1G3kOOQ[7+)T7+)TO9uQ!0LrO7+)_O`QlO7+)aOOQ['#Kh'#KhOOQ['#JS'#JSO%?PQlO,5>`OOQ[,5>`,5>`O%[QlO'#HuO%?^Q`O'#HwOOQ[,5>f,5>fO9eQ`O,5>fOOQ[,5>h,5>hOOQ[7+)j7+)jOOQ[7+)p7+)pOOQ[7+)t7+)tOOQ[7+)v7+)vO%?cQpO1G5|O%?}Q?MtO1G0zO%@XQ`O1G0zOOQO1G/s1G/sO%@dQ?MtO1G/sO?YQ`O1G/sO!)[QlO'#DmOOQO,5?P,5?POOQO-E<c-E<cOOQO,5?V,5?VOOQO-E<i-E<iO!CUQpO1G/sOOQO-E<e-E<eOOQ!0Ln1G0]1G0]OOQ!0Lf7+%u7+%uO#(ZQ`O7+%uOOQ!0Lf7+&`7+&`O?YQ`O7+&`O!CUQpO7+&`OOQO7+%x7+%xO$AlQ!0MxO7+&XOOQO7+&X7+&XO%[QlO7+&XO%@nQ!0LrO7+&XO!ByQ!0LrO7+%xO!CUQpO7+%xO%@yQ!0LrO7+&XO%AXQ!0MxO7++rO%[QlO7++rO%AiQ`O7++qO%AiQ`O7++qOOQO1G4s1G4sO9eQ`O1G4sO%AqQ`O1G4sOOQS7+%}7+%}O#(ZQ`O<<LPO4UQ!fO<<LPO%BPQ`O<<LPOOQ[<<LP<<LPO!&zQMhO<<LPO%[QlO<<LPO%BXQ`O<<LPO%BdQ!0MzO,5?aO%DoQ!0MzO,5?cO%FzQ!0MzO1G2`O%I]Q!0MzO1G2sO%KhQ!0MzO1G2uO%MsQ!fO,5?QO%[QlO,5?QOOQO-E<d-E<dO%M}Q`O1G5}OOQ!0Lf<<JU<<JUO%NVQ?MtO1G0uO&!^Q?MtO1G1PO&!eQ?MtO1G1PO&$fQ?MtO1G1PO&$mQ?MtO1G1PO&&nQ?MtO1G1PO&(oQ?MtO1G1PO&(vQ?MtO1G1PO&(}Q?MtO1G1PO&+OQ?MtO1G1PO&+VQ?MtO1G1PO&+^Q!0MxO<<JfO&-UQ?MtO1G1PO&.RQ?MvO1G1PO&/UQ?MvO'#JlO&1[Q?MtO1G1cO&1iQ?MtO1G0UO&1sQMjO,5?TOOQO-E<g-E<gO!)[QlO'#FqOOQO'#KZ'#KZOOQO1G1u1G1uO&1}Q`O1G1tO&2SQ?MtO,5?[OOOW7+'h7+'hOOOO1G/Z1G/ZO&2^Q!dO1G4xOOQ!0Lh7+(Q7+(QP!&zQMhO,5?^O!,TQMhO7+(cO&2eQ`O,5?]O9eQ`O,5?]O$+YQ`O,5?]OOQO-E<o-E<oO&2sQ`O1G6bO&2sQ`O1G6bO&2{Q`O1G6bO&3WQMjO7+'zO&3hQ!dO,5?_O&3rQ`O,5?_O!&zQMhO,5?_OOQO-E<q-E<qO&3wQ!dO1G6cO&4RQ`O1G6cO&4ZQ`O1G2kO!&zQMhO1G2kOOQ!0Lb1G2i1G2iOOQ!0Lb1G2j1G2jO%4hQpO1G2iO!CUQpO1G2iOCwQ`O1G2iOOQ!0Lb1G2q1G2qO&4`QpO1G2iO&4nQ`O1G2kO$+YQ`O1G2jOCwQ`O1G2jO$$wQlO1G2kO&4vQ`O1G2jO&5jQMjO,5?aOOQ!0Lh-E<t-E<tO&6]QMjO,5?cOOQ!0Lh-E<v-E<vO!,TQMhO7++]O&6gQMjO7++]O&6qQMjO7++]OOQ!0Lh1G/c1G/cO&7OQ`O1G/cOOQ!0Lh7+'u7+'uO&7TQMjO7+'|O&7eQ!0MxO<<KXOOQ!0Lf<<KX<<KXO&8XQ`O1G0zO!&zQMhO'#IzO&8^Q`O,5@xO&:`Q!fO<<LPO!&zQMhO1G2nO&:gQ!0LrO1G2nOOQ[<<G{<<G{O!ByQ!0LrO<<G{O&:xQ!0MxO<<I{OOQ!0Lf<<I{<<I{OOQO,5?l,5?lO&;lQ`O,5?lO&;qQ`O,5?lOOQO-E=O-E=OO&<PQ`O1G6kO&<PQ`O1G6kO9kQ`O1G6kO@zQ`O<<LlOOQ[<<Ll<<LlO&<XQ`O<<LlO9uQ!0LrO<<LlO9kQ`O<<LlOOQ[<<LX<<LXO%:yQ!0MvO<<LXOOQ[<<LY<<LYO!E^Q`O<<LYO&<^QpO'#I|O&<iQ`O,5@|O!)[QlO,5@|OOQ[1G3W1G3WOOQO'#JO'#JOO9uQ!0LrO'#JOO&<qQpO,5=uOOQ[,5=u,5=uO&<xQpO'#EgO&=PQpO'#GeO&=UQ`O7+(zO&=ZQ`O7+(zOOQ[7+(z7+(zO!&zQMhO7+(zO%[QlO7+(zO&=cQ`O7+(zOOQ[7+(|7+(|O9uQ!0LrO7+(|O$%dQ`O7+(|O9`Q`O7+(|O!CUQpO7+(|O&=nQ`O,5?kOOQO-E<}-E<}OOQO'#H^'#H^O&=yQ`O1G6iO9uQ!0LrO<<GqOOQ[<<Gq<<GqO@zQ`O<<GqO&>RQ`O7+,WO&>WQ`O7+,XO%[QlO7+,WO%[QlO7+,XOOQ[7+)V7+)VO&>]Q`O7+)VO&>bQlO7+)VO&>iQ`O7+)VOOQ[<<Ly<<LyOOQ[<<L{<<L{OOQ[-E=Q-E=QOOQ[1G3z1G3zO&>nQ`O,5>aOOQ[,5>c,5>cO&>sQ`O1G4QO9eQ`O7+&fO!)[QlO7+&fOOQO7+%_7+%_O&>xQ?MtO1G6ZO?YQ`O7+%_OOQ!0Lf<<Ia<<IaOOQ!0Lf<<Iz<<IzO?YQ`O<<IzOOQO<<Is<<IsO$AlQ!0MxO<<IsO%[QlO<<IsOOQO<<Id<<IdO!ByQ!0LrO<<IdO&?SQ!0LrO<<IsO&?_Q!0MxO<= ^O&?oQ`O<= ]OOQO7+*_7+*_O9eQ`O7+*_OOQ[ANAkANAkO&?wQ!fOANAkO!&zQMhOANAkO#(ZQ`OANAkO4UQ!fOANAkO&@OQ`OANAkO%[QlOANAkO&@WQ!0MzO7+'zO&BiQ!0MzO,5?aO&DtQ!0MzO,5?cO&GPQ!0MzO7+'|O&IbQ!fO1G4lO&IlQ?MtO7+&aO&KpQ?MvO,5=XO&MwQ?MvO,5=ZO&NXQ?MvO,5=XO&NiQ?MvO,5=ZO&NyQ?MvO,59uO'#PQ?MvO,5<kO'%SQ?MvO,5<mO''hQ?MvO,5<{O')^Q?MtO7+'kO')kQ?MtO7+'mO')xQ`O,5<]OOQO7+'`7+'`OOQ!0Lh7+*d7+*dO')}QMjO<<K}OOQO1G4w1G4wO'*UQ`O1G4wO'*aQ`O1G4wO'*oQ`O7++|O'*oQ`O7++|O!&zQMhO1G4yO'*wQ!dO1G4yO'+RQ`O7++}O'+ZQ`O7+(VO'+fQ!dO7+(VOOQ!0Lb7+(T7+(TOOQ!0Lb7+(U7+(UO!CUQpO7+(TOCwQ`O7+(TO'+pQ`O7+(VO!&zQMhO7+(VO$+YQ`O7+(UO'+uQ`O7+(VOCwQ`O7+(UO'+}QMjO<<NwO!,TQMhO<<NwOOQ!0Lh7+$}7+$}O',XQ!dO,5?fOOQO-E<x-E<xO',cQ!0MvO7+(YO!&zQMhO7+(YOOQ[AN=gAN=gO9kQ`O1G5WOOQO1G5W1G5WO',sQ`O1G5WO',xQ`O7+,VO',xQ`O7+,VO9uQ!0LrOANBWO@zQ`OANBWOOQ[ANBWANBWO'-QQ`OANBWOOQ[ANAsANAsOOQ[ANAtANAtO'-VQ`O,5?hOOQO-E<z-E<zO'-bQ?MtO1G6hOOQO,5?j,5?jOOQO-E<|-E<|OOQ[1G3a1G3aO'-lQ`O,5=POOQ[<<Lf<<LfO!&zQMhO<<LfO&=UQ`O<<LfO'-qQ`O<<LfO%[QlO<<LfOOQ[<<Lh<<LhO9uQ!0LrO<<LhO$%dQ`O<<LhO9`Q`O<<LhO'-yQpO1G5VO'.UQ`O7+,TOOQ[AN=]AN=]O9uQ!0LrOAN=]OOQ[<= r<= rOOQ[<= s<= sO'.^Q`O<= rO'.cQ`O<= sOOQ[<<Lq<<LqO'.hQ`O<<LqO'.mQlO<<LqOOQ[1G3{1G3{O?YQ`O7+)lO'.tQ`O<<JQO'/PQ?MtO<<JQOOQO<<Hy<<HyOOQ!0LfAN?fAN?fOOQOAN?_AN?_O$AlQ!0MxOAN?_OOQOAN?OAN?OO%[QlOAN?_OOQO<<My<<MyOOQ[G27VG27VO!&zQMhOG27VO#(ZQ`OG27VO'/ZQ!fOG27VO4UQ!fOG27VO'/bQ`OG27VO'/jQ?MtO<<JfO'/wQ?MvO1G2`O'1mQ?MvO,5?aO'3pQ?MvO,5?cO'5sQ?MvO1G2sO'7vQ?MvO1G2uO'9yQ?MtO<<KXO':WQ?MtO<<I{OOQO1G1w1G1wO!,TQMhOANAiOOQO7+*c7+*cO':eQ`O7+*cO':pQ`O<= hO':xQ!dO7+*eOOQ!0Lb<<Kq<<KqO$+YQ`O<<KqOCwQ`O<<KqO';SQ`O<<KqO!&zQMhO<<KqOOQ!0Lb<<Ko<<KoO!CUQpO<<KoO';_Q!dO<<KqOOQ!0Lb<<Kp<<KpO';iQ`O<<KqO!&zQMhO<<KqO$+YQ`O<<KpO';nQMjOANDcO';xQ!0MvO<<KtOOQO7+*r7+*rO9kQ`O7+*rO'<YQ`O<= qOOQ[G27rG27rO9uQ!0LrOG27rO@zQ`OG27rO!)[QlO1G5SO'<bQ`O7+,SO'<jQ`O1G2kO&=UQ`OANBQOOQ[ANBQANBQO!&zQMhOANBQO'<oQ`OANBQOOQ[ANBSANBSO9uQ!0LrOANBSO$%dQ`OANBSOOQO'#H_'#H_OOQO7+*q7+*qOOQ[G22wG22wOOQ[ANE^ANE^OOQ[ANE_ANE_OOQ[ANB]ANB]O'<wQ`OANB]OOQ[<<MW<<MWO!)[QlOAN?lOOQOG24yG24yO$AlQ!0MxOG24yO#(ZQ`OLD,qOOQ[LD,qLD,qO!&zQMhOLD,qO'<|Q!fOLD,qO'=TQ?MvO7+'zO'>yQ?MvO,5?aO'@|Q?MvO,5?cO'CPQ?MvO7+'|O'DuQMjOG27TOOQO<<M}<<M}OOQ!0LbANA]ANA]O$+YQ`OANA]OCwQ`OANA]O'EVQ!dOANA]OOQ!0LbANAZANAZO'E^Q`OANA]O!&zQMhOANA]O'EiQ!dOANA]OOQ!0LbANA[ANA[OOQO<<N^<<N^OOQ[LD-^LD-^O9uQ!0LrOLD-^O'EsQ?MtO7+*nOOQO'#Gf'#GfOOQ[G27lG27lO&=UQ`OG27lO!&zQMhOG27lOOQ[G27nG27nO9uQ!0LrOG27nOOQ[G27wG27wO'E}Q?MtOG25WOOQOLD*eLD*eOOQ[!$(!]!$(!]O#(ZQ`O!$(!]O!&zQMhO!$(!]O'FXQ!0MzOG27TOOQ!0LbG26wG26wO$+YQ`OG26wO'HjQ`OG26wOCwQ`OG26wO'HuQ!dOG26wO!&zQMhOG26wOOQ[!$(!x!$(!xOOQ[LD-WLD-WO&=UQ`OLD-WOOQ[LD-YLD-YOOQ[!)9Ew!)9EwO#(ZQ`O!)9EwOOQ!0LbLD,cLD,cO$+YQ`OLD,cOCwQ`OLD,cO'H|Q`OLD,cO'IXQ!dOLD,cOOQ[!$(!r!$(!rOOQ[!.K;c!.K;cO'I`Q?MvOG27TOOQ!0Lb!$( }!$( }O$+YQ`O!$( }OCwQ`O!$( }O'KUQ`O!$( }OOQ!0Lb!)9Ei!)9EiO$+YQ`O!)9EiOCwQ`O!)9EiOOQ!0Lb!.K;T!.K;TO$+YQ`O!.K;TOOQ!0Lb!4/0o!4/0oO!)[QlO'#DzO1PQ`O'#EXO'KaQ!fO'#JrO'KhQ!L^O'#DvO'KoQlO'#EOO'KvQ!fO'#CiO'N^Q!fO'#CiO!)[QlO'#EQO'NnQlO,5;ZO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO,5;eO!)[QlO'#IpO(!qQ`O,5<iO!)[QlO,5;eO(!yQMhO,5;eO($dQMhO,5;eO!)[QlO,5;wO!&zQMhO'#GmO(!yQMhO'#GmO!&zQMhO'#GoO(!yQMhO'#GoO1SQ`O'#DZO1SQ`O'#DZO!&zQMhO'#GPO(!yQMhO'#GPO!&zQMhO'#GRO(!yQMhO'#GRO!&zQMhO'#GaO(!yQMhO'#GaO!)[QlO,5:jO($kQpO'#D_O($uQpO'#JvO!)[QlO,5@oO'NnQlO1G0uO(%PQ?MtO'#CiO!)[QlO1G2PO!&zQMhO'#IuO(!yQMhO'#IuO!&zQMhO'#IwO(!yQMhO'#IwO(%ZQ!dO'#CrO!&zQMhO,5<tO(!yQMhO,5<tO'NnQlO1G2RO!)[QlO7+&zO!&zQMhO1G2`O(!yQMhO1G2`O!&zQMhO'#IuO(!yQMhO'#IuO!&zQMhO'#IwO(!yQMhO'#IwO!&zQMhO1G2bO(!yQMhO1G2bO'NnQlO7+'mO'NnQlO7+&aO!&zQMhOANAiO(!yQMhOANAiO(%nQ`O'#EoO(%sQ`O'#EoO(%{Q`O'#F]O(&QQ`O'#EyO(&VQ`O'#KTO(&bQ`O'#KRO(&mQ`O,5;ZO(&rQMjO,5<eO(&yQ`O'#GYO('OQ`O'#GYO('TQ`O,5<eO(']Q`O,5<gO('eQ`O,5;ZO('mQ?MtO1G1`O('tQ`O,5<tO('yQ`O,5<tO((OQ`O,5<vO((TQ`O,5<vO((YQ`O1G2RO((_Q`O1G0uO((dQMjO<<K}O((kQMjO<<K}O((rQMhO'#F|O9`Q`O'#F{OAuQ`O'#EnO!)[QlO,5;tO!3oQ`O'#GYO!3oQ`O'#GYO!3oQ`O'#G[O!3oQ`O'#G[O!,TQMhO7+(cO!,TQMhO7+(cO%.zQ!dO1G2wO%.zQ!dO1G2wO!&zQMhO,5=]O!&zQMhO,5=]",stateData:"()x~O'|OS'}OSTOS(ORQ~OPYOQYOSfOY!VOaqOdzOeyOl!POpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_XO!iuO!lZO!oYO!pYO!qYO!svO!uwO!xxO!|]O$W|O$niO%h}O%j!QO%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO%y!UO&W!WO&^!XO&`!YO&b!ZO&d![O&g!]O&m!^O&s!_O&u!`O&w!aO&y!bO&{!cO(TSO(VTO(YUO(aVO(o[O~OWtO~P`OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oa!wOs!nO!S!oO!b!yO!c!vO!d!vO!|<VO#T!pO#U!pO#V!xO#W!pO#X!pO#[!zO#]!zO(U!lO(VTO(YUO(e!mO(o!sO~O(O!{O~OP]XR]X[]Xa]Xj]Xr]X!Q]X!S]X!]]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X'z]X(a]X(r]X(y]X(z]X~O!g%RX~P(qO_!}O(V#PO(W!}O(X#PO~O_#QO(X#PO(Y#PO(Z#QO~Ox#SO!U#TO(b#TO(c#VO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T<ZO(VTO(YUO(aVO(o[O~O![#ZO!]#WO!Y(hP!Y(vP~P+}O!^#cO~P`OPYOQYOSfOd!jOe!iOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(VTO(YUO(aVO(o[O~Op#mO![#iO!|]O#i#lO#j#iO(T<[O!k(sP~P.iO!l#oO(T#nO~O!x#sO!|]O%h#tO~O#k#uO~O!g#vO#k#uO~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!]$_O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~Oa(fX'z(fX'w(fX!k(fX!Y(fX!_(fX%i(fX!g(fX~P1qO#S$dO#`$eO$Q$eOP(gXR(gX[(gXj(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX!_(gX%i(gX~Oa(gX'z(gX'w(gX!Y(gX!k(gXv(gX!g(gX~P4UO#`$eO~O$]$hO$_$gO$f$mO~OSfO!_$nO$i$oO$k$qO~Oh%VOj%dOk%dOp%WOr%XOs$tOt$tOz%YO|%ZO!O%]O!S${O!_$|O!i%bO!l$xO#j%cO$W%`O$t%^O$v%_O$y%aO(T$sO(VTO(YUO(a$uO(y$}O(z%POg(^P~Ol%[O~P7eO!l%eO~O!S%hO!_%iO(T%gO~O!g%mO~Oa%nO'z%nO~O!Q%rO~P%[O(U!lO~P%[O%n%vO~P%[Oh%VO!l%eO(T%gO(U!lO~Oe%}O!l%eO(T%gO~Oj$RO~O!_&PO(T%gO(U!lO(VTO(YUO`)WP~O!Q&SO!l&RO%j&VO&T&WO~P;SO!x#sO~O%s&YO!S)SX!_)SX(T)SX~O(T&ZO~Ol!PO!u&`O%j!QO%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO~Od&eOe&dO!x&bO%h&cO%{&aO~P<bOd&hOeyOl!PO!_&gO!u&`O!xxO!|]O%h}O%l!OO%m!OO%n!OO%q!RO%s!SO%v!TO%w!TO%y!UO~Ob&kO#`&nO%j&iO(U!lO~P=gO!l&oO!u&sO~O!l#oO~O!_XO~Oa%nO'x&{O'z%nO~Oa%nO'x'OO'z%nO~Oa%nO'x'QO'z%nO~O'w]X!Y]Xv]X!k]X&[]X!_]X%i]X!g]X~P(qO!b'_O!c'WO!d'WO(U!lO(VTO(YUO~Os'UO!S'TO!['XO(e'SO!^(iP!^(xP~P@nOn'bO!_'`O(T%gO~Oe'gO!l%eO(T%gO~O!Q&SO!l&RO~Os!nO!S!oO!|<VO#T!pO#U!pO#W!pO#X!pO(U!lO(VTO(YUO(e!mO(o!sO~O!b'mO!c'lO!d'lO#V!pO#['nO#]'nO~PBYOa%nOh%VO!g#vO!l%eO'z%nO(r'pO~O!p'tO#`'rO~PChOs!nO!S!oO(VTO(YUO(e!mO(o!sO~O!_XOs(mX!S(mX!b(mX!c(mX!d(mX!|(mX#T(mX#U(mX#V(mX#W(mX#X(mX#[(mX#](mX(U(mX(V(mX(Y(mX(e(mX(o(mX~O!c'lO!d'lO(U!lO~PDWO(P'xO(Q'xO(R'zO~O_!}O(V'|O(W!}O(X'|O~O_#QO(X'|O(Y'|O(Z#QO~Ov(OO~P%[Ox#SO!U#TO(b#TO(c(RO~O![(TO!Y'WX!Y'^X!]'WX!]'^X~P+}O!](VO!Y(hX~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!](VO!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~O!Y(hX~PHRO!Y([O~O!Y(uX!](uX!g(uX!k(uX(r(uX~O#`(uX#k#dX!^(uX~PJUO#`(]O!Y(wX!](wX~O!](^O!Y(vX~O!Y(aO~O#`$eO~PJUO!^(bO~P`OR#zO!Q#yO!S#{O!l#xO(aVOP!na[!naj!nar!na!]!na!p!na#R!na#n!na#o!na#p!na#q!na#r!na#s!na#t!na#u!na#v!na#x!na#z!na#{!na(r!na(y!na(z!na~Oa!na'z!na'w!na!Y!na!k!nav!na!_!na%i!na!g!na~PKlO!k(cO~O!g#vO#`(dO(r'pO!](tXa(tX'z(tX~O!k(tX~PNXO!S%hO!_%iO!|]O#i(iO#j(hO(T%gO~O!](jO!k(sX~O!k(lO~O!S%hO!_%iO#j(hO(T%gO~OP(gXR(gX[(gXj(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX~O!g#vO!k(gX~P! uOR(nO!Q(mO!l#xO#S$dO!|!{a!S!{a~O!x!{a%h!{a!_!{a#i!{a#j!{a(T!{a~P!#vO!x(rO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_XO!iuO!lZO!oYO!pYO!qYO!svO!u!gO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~O#k(xO~O![(zO!k(kP~P%[O(e(|O(o[O~O!S)OO!l#xO(e(|O(o[O~OP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_!eO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(T)]O(VTO(YUO(aVO(o[O~O!]$_Oa$qa'z$qa'w$qa!k$qa!Y$qa!_$qa%i$qa!g$qa~Ol)dO~P!&zOh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O%]O!S${O!_$|O!i%bO!l$xO#j%cO$W%`O$t%^O$v%_O$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~Og(pP~P!,TO!Q)iO!g)hO!_$^X$Z$^X$]$^X$_$^X$f$^X~O!g)hO!_({X$Z({X$]({X$_({X$f({X~O!Q)iO~P!.^O!Q)iO!_({X$Z({X$]({X$_({X$f({X~O!_)kO$Z)oO$])jO$_)jO$f)pO~O![)sO~P!)[O$]$hO$_$gO$f)wO~On$zX!Q$zX#S$zX'y$zX(y$zX(z$zX~OgmXg$zXnmX!]mX#`mX~P!0SOx)yO(b)zO(c)|O~On*VO!Q*OO'y*PO(y$}O(z%PO~Og)}O~P!1WOg*WO~Oh%VOr%XOs$tOt$tOz%YO|%ZO!O<sO!S*YO!_*ZO!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(VTO(YUO(a$uO(y$}O(z%PO~Op*`O![*^O(T*XO!k)OP~P!1uO#k*aO~O!l*bO~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(T*dO(VTO(YUO(a$uO(y$}O(z%PO~O![*gO!Y)PP~P!3tOr*sOs!nO!S*iO!b*qO!c*kO!d*kO!l*bO#[*rO%`*mO(U!lO(VTO(YUO(e!mO~O!^*pO~P!5iO#S$dOn(`X!Q(`X'y(`X(y(`X(z(`X!](`X#`(`X~Og(`X$O(`X~P!6kOn*xO#`*wOg(_X!](_X~O!]*yOg(^X~Oj%dOk%dOl%dO(T&ZOg(^P~Os*|O~Og)}O(T&ZO~O!l+SO~O(T(vO~Op+WO!S%hO![#iO!_%iO!|]O#i#lO#j#iO(T%gO!k(sP~O!g#vO#k+XO~O!S%hO![+ZO!](^O!_%iO(T%gO!Y(vP~Os'[O!S+]O![+[O(VTO(YUO(e(|O~O!^(xP~P!9|O!]+^Oa)TX'z)TX~OP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO#z$WO#{$XO(aVO(r$YO(y#|O(z#}O~Oa!ja!]!ja'z!ja'w!ja!Y!ja!k!jav!ja!_!ja%i!ja!g!ja~P!:tOR#zO!Q#yO!S#{O!l#xO(aVOP!ra[!raj!rar!ra!]!ra!p!ra#R!ra#n!ra#o!ra#p!ra#q!ra#r!ra#s!ra#t!ra#u!ra#v!ra#x!ra#z!ra#{!ra(r!ra(y!ra(z!ra~Oa!ra'z!ra'w!ra!Y!ra!k!rav!ra!_!ra%i!ra!g!ra~P!=[OR#zO!Q#yO!S#{O!l#xO(aVOP!ta[!taj!tar!ta!]!ta!p!ta#R!ta#n!ta#o!ta#p!ta#q!ta#r!ta#s!ta#t!ta#u!ta#v!ta#x!ta#z!ta#{!ta(r!ta(y!ta(z!ta~Oa!ta'z!ta'w!ta!Y!ta!k!tav!ta!_!ta%i!ta!g!ta~P!?rOh%VOn+gO!_'`O%i+fO~O!g+iOa(]X!_(]X'z(]X!](]X~Oa%nO!_XO'z%nO~Oh%VO!l%eO~Oh%VO!l%eO(T%gO~O!g#vO#k(xO~Ob+tO%j+uO(T+qO(VTO(YUO!^)XP~O!]+vO`)WX~O[+zO~O`+{O~O!_&PO(T%gO(U!lO`)WP~O%j,OO~P;SOh%VO#`,SO~Oh%VOn,VO!_$|O~O!_,XO~O!Q,ZO!_XO~O%n%vO~O!x,`O~Oe,eO~Ob,fO(T#nO(VTO(YUO!^)VP~Oe%}O~O%j!QO(T&ZO~P=gO[,kO`,jO~OPYOQYOSfOdzOeyOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!iuO!lZO!oYO!pYO!qYO!svO!xxO!|]O$niO%h}O(VTO(YUO(aVO(o[O~O!_!eO!u!gO$W!kO(T!dO~P!FyO`,jOa%nO'z%nO~OPYOQYOSfOd!jOe!iOpkOrYOskOtkOzkO|YO!OYO!SWO!WkO!XkO!_!eO!iuO!lZO!oYO!pYO!qYO!svO!x!hO$W!kO$niO(T!dO(VTO(YUO(aVO(o[O~Oa,pOl!OO!uwO%l!OO%m!OO%n!OO~P!IcO!l&oO~O&^,vO~O!_,xO~O&o,zO&q,{OP&laQ&laS&laY&laa&lad&lae&lal&lap&lar&las&lat&laz&la|&la!O&la!S&la!W&la!X&la!_&la!i&la!l&la!o&la!p&la!q&la!s&la!u&la!x&la!|&la$W&la$n&la%h&la%j&la%l&la%m&la%n&la%q&la%s&la%v&la%w&la%y&la&W&la&^&la&`&la&b&la&d&la&g&la&m&la&s&la&u&la&w&la&y&la&{&la'w&la(T&la(V&la(Y&la(a&la(o&la!^&la&e&lab&la&j&la~O(T-QO~Oh!eX!]!RX!^!RX!g!RX!g!eX!l!eX#`!RX~O!]!eX!^!eX~P#!iO!g-VO#`-UOh(jX!]#hX!^#hX!g(jX!l(jX~O!](jX!^(jX~P##[Oh%VO!g-XO!l%eO!]!aX!^!aX~Os!nO!S!oO(VTO(YUO(e!mO~OP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_!eO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(VTO(YUO(aVO(o[O~O(T=QO~P#$qO!]-]O!^(iX~O!^-_O~O!g-VO#`-UO!]#hX!^#hX~O!]-`O!^(xX~O!^-bO~O!c-cO!d-cO(U!lO~P#$`O!^-fO~P'_On-iO!_'`O~O!Y-nO~Os!{a!b!{a!c!{a!d!{a#T!{a#U!{a#V!{a#W!{a#X!{a#[!{a#]!{a(U!{a(V!{a(Y!{a(e!{a(o!{a~P!#vO!p-sO#`-qO~PChO!c-uO!d-uO(U!lO~PDWOa%nO#`-qO'z%nO~Oa%nO!g#vO#`-qO'z%nO~Oa%nO!g#vO!p-sO#`-qO'z%nO(r'pO~O(P'xO(Q'xO(R-zO~Ov-{O~O!Y'Wa!]'Wa~P!:tO![.PO!Y'WX!]'WX~P%[O!](VO!Y(ha~O!Y(ha~PHRO!](^O!Y(va~O!S%hO![.TO!_%iO(T%gO!Y'^X!]'^X~O#`.VO!](ta!k(taa(ta'z(ta~O!g#vO~P#,wO!](jO!k(sa~O!S%hO!_%iO#j.ZO(T%gO~Op.`O!S%hO![.]O!_%iO!|]O#i._O#j.]O(T%gO!]'aX!k'aX~OR.dO!l#xO~Oh%VOn.gO!_'`O%i.fO~Oa#ci!]#ci'z#ci'w#ci!Y#ci!k#civ#ci!_#ci%i#ci!g#ci~P!:tOn>]O!Q*OO'y*PO(y$}O(z%PO~O#k#_aa#_a#`#_a'z#_a!]#_a!k#_a!_#_a!Y#_a~P#/sO#k(`XP(`XR(`X[(`Xa(`Xj(`Xr(`X!S(`X!l(`X!p(`X#R(`X#n(`X#o(`X#p(`X#q(`X#r(`X#s(`X#t(`X#u(`X#v(`X#x(`X#z(`X#{(`X'z(`X(a(`X(r(`X!k(`X!Y(`X'w(`Xv(`X!_(`X%i(`X!g(`X~P!6kO!].tO!k(kX~P!:tO!k.wO~O!Y.yO~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O(aVO[#mia#mij#mir#mi!]#mi#R#mi#o#mi#p#mi#q#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#n#mi~P#3cO#n$OO~P#3cOP$[OR#zOr$aO!Q#yO!S#{O!l#xO!p$[O#n$OO#o$PO#p$PO#q$PO(aVO[#mia#mij#mi!]#mi#R#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#r#mi~P#6QO#r$QO~P#6QOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO(aVOa#mi!]#mi#x#mi#z#mi#{#mi'z#mi(r#mi(y#mi(z#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#v#mi~P#8oOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO(aVO(z#}Oa#mi!]#mi#z#mi#{#mi'z#mi(r#mi(y#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#x$UO~P#;VO#x#mi~P#;VO#v$SO~P#8oOP$[OR#zO[$cOj$ROr$aO!Q#yO!S#{O!l#xO!p$[O#R$RO#n$OO#o$PO#p$PO#q$PO#r$QO#s$RO#t$RO#u$bO#v$SO#x$UO(aVO(y#|O(z#}Oa#mi!]#mi#{#mi'z#mi(r#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~O#z#mi~P#={O#z$WO~P#={OP]XR]X[]Xj]Xr]X!Q]X!S]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X!]]X!^]X~O$O]X~P#@jOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO#x<eO#z<gO#{<hO(aVO(r$YO(y#|O(z#}O~O$O.{O~P#BwO#S$dO#`<nO$Q<nO$O(gX!^(gX~P! uOa'da!]'da'z'da'w'da!k'da!Y'dav'da!_'da%i'da!g'da~P!:tO[#mia#mij#mir#mi!]#mi#R#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi'z#mi(r#mi'w#mi!Y#mi!k#miv#mi!_#mi%i#mi!g#mi~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O#n$OO#o$PO#p$PO#q$PO(aVO(y#mi(z#mi~P#EyOn>]O!Q*OO'y*PO(y$}O(z%POP#miR#mi!S#mi!l#mi!p#mi#n#mi#o#mi#p#mi#q#mi(a#mi~P#EyO!]/POg(pX~P!1WOg/RO~Oa$Pi!]$Pi'z$Pi'w$Pi!Y$Pi!k$Piv$Pi!_$Pi%i$Pi!g$Pi~P!:tO$]/SO$_/SO~O$]/TO$_/TO~O!g)hO#`/UO!_$cX$Z$cX$]$cX$_$cX$f$cX~O![/VO~O!_)kO$Z/XO$])jO$_)jO$f/YO~O!]<iO!^(fX~P#BwO!^/ZO~O!g)hO$f({X~O$f/]O~Ov/^O~P!&zOx)yO(b)zO(c/aO~O!S/dO~O(y$}On%aa!Q%aa'y%aa(z%aa!]%aa#`%aa~Og%aa$O%aa~P#L{O(z%POn%ca!Q%ca'y%ca(y%ca!]%ca#`%ca~Og%ca$O%ca~P#MnO!]fX!gfX!kfX!k$zX(rfX~P!0SOp%WO![/mO!](^O(T/lO!Y(vP!Y)PP~P!1uOr*sO!b*qO!c*kO!d*kO!l*bO#[*rO%`*mO(U!lO(VTO(YUO~Os<}O!S/nO![+[O!^*pO(e<|O!^(xP~P$ [O!k/oO~P#/sO!]/pO!g#vO(r'pO!k)OX~O!k/uO~OnoX!QoX'yoX(yoX(zoX~O!g#vO!koX~P$#OOp/wO!S%hO![*^O!_%iO(T%gO!k)OP~O#k/xO~O!Y$zX!]$zX!g%RX~P!0SO!]/yO!Y)PX~P#/sO!g/{O~O!Y/}O~OpkO(T0OO~P.iOh%VOr0TO!g#vO!l%eO(r'pO~O!g+iO~Oa%nO!]0XO'z%nO~O!^0ZO~P!5iO!c0[O!d0[O(U!lO~P#$`Os!nO!S0]O(VTO(YUO(e!mO~O#[0_O~Og%aa!]%aa#`%aa$O%aa~P!1WOg%ca!]%ca#`%ca$O%ca~P!1WOj%dOk%dOl%dO(T&ZOg'mX!]'mX~O!]*yOg(^a~Og0hO~On0jO#`0iOg(_a!](_a~OR0kO!Q0kO!S0lO#S$dOn}a'y}a(y}a(z}a!]}a#`}a~Og}a$O}a~P$(cO!Q*OO'y*POn$sa(y$sa(z$sa!]$sa#`$sa~Og$sa$O$sa~P$)_O!Q*OO'y*POn$ua(y$ua(z$ua!]$ua#`$ua~Og$ua$O$ua~P$*QO#k0oO~Og%Ta!]%Ta#`%Ta$O%Ta~P!1WO!g#vO~O#k0rO~O!]+^Oa)Ta'z)Ta~OR#zO!Q#yO!S#{O!l#xO(aVOP!ri[!rij!rir!ri!]!ri!p!ri#R!ri#n!ri#o!ri#p!ri#q!ri#r!ri#s!ri#t!ri#u!ri#v!ri#x!ri#z!ri#{!ri(r!ri(y!ri(z!ri~Oa!ri'z!ri'w!ri!Y!ri!k!riv!ri!_!ri%i!ri!g!ri~P$+oOh%VOr%XOs$tOt$tOz%YO|%ZO!O<sO!S${O!_$|O!i>VO!l$xO#j<yO$W%`O$t<uO$v<wO$y%aO(VTO(YUO(a$uO(y$}O(z%PO~Op0{O%]0|O(T0zO~P$.VO!g+iOa(]a!_(]a'z(]a!](]a~O#k1SO~O[]X!]fX!^fX~O!]1TO!^)XX~O!^1VO~O[1WO~Ob1YO(T+qO(VTO(YUO~O!_&PO(T%gO`'uX!]'uX~O!]+vO`)Wa~O!k1]O~P!:tO[1`O~O`1aO~O#`1fO~On1iO!_$|O~O(e(|O!^)UP~Oh%VOn1rO!_1oO%i1qO~O[1|O!]1zO!^)VX~O!^1}O~O`2POa%nO'z%nO~O(T#nO(VTO(YUO~O#S$dO#`$eO$Q$eOP(gXR(gX[(gXr(gX!Q(gX!S(gX!](gX!l(gX!p(gX#R(gX#n(gX#o(gX#p(gX#q(gX#r(gX#s(gX#t(gX#u(gX#v(gX#x(gX#z(gX#{(gX(a(gX(r(gX(y(gX(z(gX~Oj2SO&[2TOa(gX~P$3pOj2SO#`$eO&[2TO~Oa2VO~P%[Oa2XO~O&e2[OP&ciQ&ciS&ciY&cia&cid&cie&cil&cip&cir&cis&cit&ciz&ci|&ci!O&ci!S&ci!W&ci!X&ci!_&ci!i&ci!l&ci!o&ci!p&ci!q&ci!s&ci!u&ci!x&ci!|&ci$W&ci$n&ci%h&ci%j&ci%l&ci%m&ci%n&ci%q&ci%s&ci%v&ci%w&ci%y&ci&W&ci&^&ci&`&ci&b&ci&d&ci&g&ci&m&ci&s&ci&u&ci&w&ci&y&ci&{&ci'w&ci(T&ci(V&ci(Y&ci(a&ci(o&ci!^&cib&ci&j&ci~Ob2bO!^2`O&j2aO~P`O!_XO!l2dO~O&q,{OP&liQ&liS&liY&lia&lid&lie&lil&lip&lir&lis&lit&liz&li|&li!O&li!S&li!W&li!X&li!_&li!i&li!l&li!o&li!p&li!q&li!s&li!u&li!x&li!|&li$W&li$n&li%h&li%j&li%l&li%m&li%n&li%q&li%s&li%v&li%w&li%y&li&W&li&^&li&`&li&b&li&d&li&g&li&m&li&s&li&u&li&w&li&y&li&{&li'w&li(T&li(V&li(Y&li(a&li(o&li!^&li&e&lib&li&j&li~O!Y2jO~O!]!aa!^!aa~P#BwOs!nO!S!oO![2pO(e!mO!]'XX!^'XX~P@nO!]-]O!^(ia~O!]'_X!^'_X~P!9|O!]-`O!^(xa~O!^2wO~P'_Oa%nO#`3QO'z%nO~Oa%nO!g#vO#`3QO'z%nO~Oa%nO!g#vO!p3UO#`3QO'z%nO(r'pO~Oa%nO'z%nO~P!:tO!]$_Ov$qa~O!Y'Wi!]'Wi~P!:tO!](VO!Y(hi~O!](^O!Y(vi~O!Y(wi!](wi~P!:tO!](ti!k(tia(ti'z(ti~P!:tO#`3WO!](ti!k(tia(ti'z(ti~O!](jO!k(si~O!S%hO!_%iO!|]O#i3]O#j3[O(T%gO~O!S%hO!_%iO#j3[O(T%gO~On3dO!_'`O%i3cO~Oh%VOn3dO!_'`O%i3cO~O#k%aaP%aaR%aa[%aaa%aaj%aar%aa!S%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa'z%aa(a%aa(r%aa!k%aa!Y%aa'w%aav%aa!_%aa%i%aa!g%aa~P#L{O#k%caP%caR%ca[%caa%caj%car%ca!S%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca'z%ca(a%ca(r%ca!k%ca!Y%ca'w%cav%ca!_%ca%i%ca!g%ca~P#MnO#k%aaP%aaR%aa[%aaa%aaj%aar%aa!S%aa!]%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa'z%aa(a%aa(r%aa!k%aa!Y%aa'w%aa#`%aav%aa!_%aa%i%aa!g%aa~P#/sO#k%caP%caR%ca[%caa%caj%car%ca!S%ca!]%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca'z%ca(a%ca(r%ca!k%ca!Y%ca'w%ca#`%cav%ca!_%ca%i%ca!g%ca~P#/sO#k}aP}a[}aa}aj}ar}a!l}a!p}a#R}a#n}a#o}a#p}a#q}a#r}a#s}a#t}a#u}a#v}a#x}a#z}a#{}a'z}a(a}a(r}a!k}a!Y}a'w}av}a!_}a%i}a!g}a~P$(cO#k$saP$saR$sa[$saa$saj$sar$sa!S$sa!l$sa!p$sa#R$sa#n$sa#o$sa#p$sa#q$sa#r$sa#s$sa#t$sa#u$sa#v$sa#x$sa#z$sa#{$sa'z$sa(a$sa(r$sa!k$sa!Y$sa'w$sav$sa!_$sa%i$sa!g$sa~P$)_O#k$uaP$uaR$ua[$uaa$uaj$uar$ua!S$ua!l$ua!p$ua#R$ua#n$ua#o$ua#p$ua#q$ua#r$ua#s$ua#t$ua#u$ua#v$ua#x$ua#z$ua#{$ua'z$ua(a$ua(r$ua!k$ua!Y$ua'w$uav$ua!_$ua%i$ua!g$ua~P$*QO#k%TaP%TaR%Ta[%Taa%Taj%Tar%Ta!S%Ta!]%Ta!l%Ta!p%Ta#R%Ta#n%Ta#o%Ta#p%Ta#q%Ta#r%Ta#s%Ta#t%Ta#u%Ta#v%Ta#x%Ta#z%Ta#{%Ta'z%Ta(a%Ta(r%Ta!k%Ta!Y%Ta'w%Ta#`%Tav%Ta!_%Ta%i%Ta!g%Ta~P#/sOa#cq!]#cq'z#cq'w#cq!Y#cq!k#cqv#cq!_#cq%i#cq!g#cq~P!:tO![3lO!]'YX!k'YX~P%[O!].tO!k(ka~O!].tO!k(ka~P!:tO!Y3oO~O$O!na!^!na~PKlO$O!ja!]!ja!^!ja~P#BwO$O!ra!^!ra~P!=[O$O!ta!^!ta~P!?rOg']X!]']X~P!,TO!]/POg(pa~OSfO!_4TO$d4UO~O!^4YO~Ov4ZO~P#/sOa$mq!]$mq'z$mq'w$mq!Y$mq!k$mqv$mq!_$mq%i$mq!g$mq~P!:tO!Y4]O~P!&zO!S4^O~O!Q*OO'y*PO(z%POn'ia(y'ia!]'ia#`'ia~Og'ia$O'ia~P%-fO!Q*OO'y*POn'ka(y'ka(z'ka!]'ka#`'ka~Og'ka$O'ka~P%.XO(r$YO~P#/sO!YfX!Y$zX!]fX!]$zX!g%RX#`fX~P!0SOp%WO(T=WO~P!1uOp4bO!S%hO![4aO!_%iO(T%gO!]'eX!k'eX~O!]/pO!k)Oa~O!]/pO!g#vO!k)Oa~O!]/pO!g#vO(r'pO!k)Oa~Og$|i!]$|i#`$|i$O$|i~P!1WO![4jO!Y'gX!]'gX~P!3tO!]/yO!Y)Pa~O!]/yO!Y)Pa~P#/sOP]XR]X[]Xj]Xr]X!Q]X!S]X!Y]X!]]X!l]X!p]X#R]X#S]X#`]X#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X~Oj%YX!g%YX~P%2OOj4oO!g#vO~Oh%VO!g#vO!l%eO~Oh%VOr4tO!l%eO(r'pO~Or4yO!g#vO(r'pO~Os!nO!S4zO(VTO(YUO(e!mO~O(y$}On%ai!Q%ai'y%ai(z%ai!]%ai#`%ai~Og%ai$O%ai~P%5oO(z%POn%ci!Q%ci'y%ci(y%ci!]%ci#`%ci~Og%ci$O%ci~P%6bOg(_i!](_i~P!1WO#`5QOg(_i!](_i~P!1WO!k5VO~Oa$oq!]$oq'z$oq'w$oq!Y$oq!k$oqv$oq!_$oq%i$oq!g$oq~P!:tO!Y5ZO~O!]5[O!_)QX~P#/sOa$zX!_$zX%^]X'z$zX!]$zX~P!0SO%^5_OaoX!_oX'zoX!]oX~P$#OOp5`O(T#nO~O%^5_O~Ob5fO%j5gO(T+qO(VTO(YUO!]'tX!^'tX~O!]1TO!^)Xa~O[5kO~O`5lO~O[5pO~Oa%nO'z%nO~P#/sO!]5uO#`5wO!^)UX~O!^5xO~Or6OOs!nO!S*iO!b!yO!c!vO!d!vO!|<VO#T!pO#U!pO#V!pO#W!pO#X!pO#[5}O#]!zO(U!lO(VTO(YUO(e!mO(o!sO~O!^5|O~P%;eOn6TO!_1oO%i6SO~Oh%VOn6TO!_1oO%i6SO~Ob6[O(T#nO(VTO(YUO!]'sX!^'sX~O!]1zO!^)Va~O(VTO(YUO(e6^O~O`6bO~Oj6eO&[6fO~PNXO!k6gO~P%[Oa6iO~Oa6iO~P%[Ob2bO!^6nO&j2aO~P`O!g6pO~O!g6rOh(ji!](ji!^(ji!g(ji!l(jir(ji(r(ji~O!]#hi!^#hi~P#BwO#`6sO!]#hi!^#hi~O!]!ai!^!ai~P#BwOa%nO#`6|O'z%nO~Oa%nO!g#vO#`6|O'z%nO~O!](tq!k(tqa(tq'z(tq~P!:tO!](jO!k(sq~O!S%hO!_%iO#j7TO(T%gO~O!_'`O%i7WO~On7[O!_'`O%i7WO~O#k'iaP'iaR'ia['iaa'iaj'iar'ia!S'ia!l'ia!p'ia#R'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#v'ia#x'ia#z'ia#{'ia'z'ia(a'ia(r'ia!k'ia!Y'ia'w'iav'ia!_'ia%i'ia!g'ia~P%-fO#k'kaP'kaR'ka['kaa'kaj'kar'ka!S'ka!l'ka!p'ka#R'ka#n'ka#o'ka#p'ka#q'ka#r'ka#s'ka#t'ka#u'ka#v'ka#x'ka#z'ka#{'ka'z'ka(a'ka(r'ka!k'ka!Y'ka'w'kav'ka!_'ka%i'ka!g'ka~P%.XO#k$|iP$|iR$|i[$|ia$|ij$|ir$|i!S$|i!]$|i!l$|i!p$|i#R$|i#n$|i#o$|i#p$|i#q$|i#r$|i#s$|i#t$|i#u$|i#v$|i#x$|i#z$|i#{$|i'z$|i(a$|i(r$|i!k$|i!Y$|i'w$|i#`$|iv$|i!_$|i%i$|i!g$|i~P#/sO#k%aiP%aiR%ai[%aia%aij%air%ai!S%ai!l%ai!p%ai#R%ai#n%ai#o%ai#p%ai#q%ai#r%ai#s%ai#t%ai#u%ai#v%ai#x%ai#z%ai#{%ai'z%ai(a%ai(r%ai!k%ai!Y%ai'w%aiv%ai!_%ai%i%ai!g%ai~P%5oO#k%ciP%ciR%ci[%cia%cij%cir%ci!S%ci!l%ci!p%ci#R%ci#n%ci#o%ci#p%ci#q%ci#r%ci#s%ci#t%ci#u%ci#v%ci#x%ci#z%ci#{%ci'z%ci(a%ci(r%ci!k%ci!Y%ci'w%civ%ci!_%ci%i%ci!g%ci~P%6bO!]'Ya!k'Ya~P!:tO!].tO!k(ki~O$O#ci!]#ci!^#ci~P#BwOP$[OR#zO!Q#yO!S#{O!l#xO!p$[O(aVO[#mij#mir#mi#R#mi#o#mi#p#mi#q#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#n#mi~P%NdO#n<_O~P%NdOP$[OR#zOr<kO!Q#yO!S#{O!l#xO!p$[O#n<_O#o<`O#p<`O#q<`O(aVO[#mij#mi#R#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#r#mi~P&!lO#r<aO~P&!lOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO(aVO#x#mi#z#mi#{#mi$O#mi(r#mi(y#mi(z#mi!]#mi!^#mi~O#v#mi~P&$tOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO(aVO(z#}O#z#mi#{#mi$O#mi(r#mi(y#mi!]#mi!^#mi~O#x<eO~P&&uO#x#mi~P&&uO#v<cO~P&$tOP$[OR#zO[<mOj<bOr<kO!Q#yO!S#{O!l#xO!p$[O#R<bO#n<_O#o<`O#p<`O#q<`O#r<aO#s<bO#t<bO#u<lO#v<cO#x<eO(aVO(y#|O(z#}O#{#mi$O#mi(r#mi!]#mi!^#mi~O#z#mi~P&)UO#z<gO~P&)UOa#|y!]#|y'z#|y'w#|y!Y#|y!k#|yv#|y!_#|y%i#|y!g#|y~P!:tO[#mij#mir#mi#R#mi#r#mi#s#mi#t#mi#u#mi#v#mi#x#mi#z#mi#{#mi$O#mi(r#mi!]#mi!^#mi~OP$[OR#zO!Q#yO!S#{O!l#xO!p$[O#n<_O#o<`O#p<`O#q<`O(aVO(y#mi(z#mi~P&,QOn>^O!Q*OO'y*PO(y$}O(z%POP#miR#mi!S#mi!l#mi!p#mi#n#mi#o#mi#p#mi#q#mi(a#mi~P&,QO#S$dOP(`XR(`X[(`Xj(`Xn(`Xr(`X!Q(`X!S(`X!l(`X!p(`X#R(`X#n(`X#o(`X#p(`X#q(`X#r(`X#s(`X#t(`X#u(`X#v(`X#x(`X#z(`X#{(`X$O(`X'y(`X(a(`X(r(`X(y(`X(z(`X!](`X!^(`X~O$O$Pi!]$Pi!^$Pi~P#BwO$O!ri!^!ri~P$+oOg']a!]']a~P!1WO!^7nO~O!]'da!^'da~P#BwO!Y7oO~P#/sO!g#vO(r'pO!]'ea!k'ea~O!]/pO!k)Oi~O!]/pO!g#vO!k)Oi~Og$|q!]$|q#`$|q$O$|q~P!1WO!Y'ga!]'ga~P#/sO!g7vO~O!]/yO!Y)Pi~P#/sO!]/yO!Y)Pi~O!Y7yO~Oh%VOr8OO!l%eO(r'pO~Oj8QO!g#vO~Or8TO!g#vO(r'pO~O!Q*OO'y*PO(z%POn'ja(y'ja!]'ja#`'ja~Og'ja$O'ja~P&5RO!Q*OO'y*POn'la(y'la(z'la!]'la#`'la~Og'la$O'la~P&5tOg(_q!](_q~P!1WO#`8VOg(_q!](_q~P!1WO!Y8WO~Og%Oq!]%Oq#`%Oq$O%Oq~P!1WOa$oy!]$oy'z$oy'w$oy!Y$oy!k$oyv$oy!_$oy%i$oy!g$oy~P!:tO!g6rO~O!]5[O!_)Qa~O!_'`OP$TaR$Ta[$Taj$Tar$Ta!Q$Ta!S$Ta!]$Ta!l$Ta!p$Ta#R$Ta#n$Ta#o$Ta#p$Ta#q$Ta#r$Ta#s$Ta#t$Ta#u$Ta#v$Ta#x$Ta#z$Ta#{$Ta(a$Ta(r$Ta(y$Ta(z$Ta~O%i7WO~P&8fO%^8[Oa%[i!_%[i'z%[i!]%[i~Oa#cy!]#cy'z#cy'w#cy!Y#cy!k#cyv#cy!_#cy%i#cy!g#cy~P!:tO[8^O~Ob8`O(T+qO(VTO(YUO~O!]1TO!^)Xi~O`8dO~O(e(|O!]'pX!^'pX~O!]5uO!^)Ua~O!^8nO~P%;eO(o!sO~P$&YO#[8oO~O!_1oO~O!_1oO%i8qO~On8tO!_1oO%i8qO~O[8yO!]'sa!^'sa~O!]1zO!^)Vi~O!k8}O~O!k9OO~O!k9RO~O!k9RO~P%[Oa9TO~O!g9UO~O!k9VO~O!](wi!^(wi~P#BwOa%nO#`9_O'z%nO~O!](ty!k(tya(ty'z(ty~P!:tO!](jO!k(sy~O%i9bO~P&8fO!_'`O%i9bO~O#k$|qP$|qR$|q[$|qa$|qj$|qr$|q!S$|q!]$|q!l$|q!p$|q#R$|q#n$|q#o$|q#p$|q#q$|q#r$|q#s$|q#t$|q#u$|q#v$|q#x$|q#z$|q#{$|q'z$|q(a$|q(r$|q!k$|q!Y$|q'w$|q#`$|qv$|q!_$|q%i$|q!g$|q~P#/sO#k'jaP'jaR'ja['jaa'jaj'jar'ja!S'ja!l'ja!p'ja#R'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#v'ja#x'ja#z'ja#{'ja'z'ja(a'ja(r'ja!k'ja!Y'ja'w'jav'ja!_'ja%i'ja!g'ja~P&5RO#k'laP'laR'la['laa'laj'lar'la!S'la!l'la!p'la#R'la#n'la#o'la#p'la#q'la#r'la#s'la#t'la#u'la#v'la#x'la#z'la#{'la'z'la(a'la(r'la!k'la!Y'la'w'lav'la!_'la%i'la!g'la~P&5tO#k%OqP%OqR%Oq[%Oqa%Oqj%Oqr%Oq!S%Oq!]%Oq!l%Oq!p%Oq#R%Oq#n%Oq#o%Oq#p%Oq#q%Oq#r%Oq#s%Oq#t%Oq#u%Oq#v%Oq#x%Oq#z%Oq#{%Oq'z%Oq(a%Oq(r%Oq!k%Oq!Y%Oq'w%Oq#`%Oqv%Oq!_%Oq%i%Oq!g%Oq~P#/sO!]'Yi!k'Yi~P!:tO$O#cq!]#cq!^#cq~P#BwO(y$}OP%aaR%aa[%aaj%aar%aa!S%aa!l%aa!p%aa#R%aa#n%aa#o%aa#p%aa#q%aa#r%aa#s%aa#t%aa#u%aa#v%aa#x%aa#z%aa#{%aa$O%aa(a%aa(r%aa!]%aa!^%aa~On%aa!Q%aa'y%aa(z%aa~P&IyO(z%POP%caR%ca[%caj%car%ca!S%ca!l%ca!p%ca#R%ca#n%ca#o%ca#p%ca#q%ca#r%ca#s%ca#t%ca#u%ca#v%ca#x%ca#z%ca#{%ca$O%ca(a%ca(r%ca!]%ca!^%ca~On%ca!Q%ca'y%ca(y%ca~P&LQOn>^O!Q*OO'y*PO(z%PO~P&IyOn>^O!Q*OO'y*PO(y$}O~P&LQOR0kO!Q0kO!S0lO#S$dOP}a[}aj}an}ar}a!l}a!p}a#R}a#n}a#o}a#p}a#q}a#r}a#s}a#t}a#u}a#v}a#x}a#z}a#{}a$O}a'y}a(a}a(r}a(y}a(z}a!]}a!^}a~O!Q*OO'y*POP$saR$sa[$saj$san$sar$sa!S$sa!l$sa!p$sa#R$sa#n$sa#o$sa#p$sa#q$sa#r$sa#s$sa#t$sa#u$sa#v$sa#x$sa#z$sa#{$sa$O$sa(a$sa(r$sa(y$sa(z$sa!]$sa!^$sa~O!Q*OO'y*POP$uaR$ua[$uaj$uan$uar$ua!S$ua!l$ua!p$ua#R$ua#n$ua#o$ua#p$ua#q$ua#r$ua#s$ua#t$ua#u$ua#v$ua#x$ua#z$ua#{$ua$O$ua(a$ua(r$ua(y$ua(z$ua!]$ua!^$ua~On>^O!Q*OO'y*PO(y$}O(z%PO~OP%TaR%Ta[%Taj%Tar%Ta!S%Ta!l%Ta!p%Ta#R%Ta#n%Ta#o%Ta#p%Ta#q%Ta#r%Ta#s%Ta#t%Ta#u%Ta#v%Ta#x%Ta#z%Ta#{%Ta$O%Ta(a%Ta(r%Ta!]%Ta!^%Ta~P''VO$O$mq!]$mq!^$mq~P#BwO$O$oq!]$oq!^$oq~P#BwO!^9oO~O$O9pO~P!1WO!g#vO!]'ei!k'ei~O!g#vO(r'pO!]'ei!k'ei~O!]/pO!k)Oq~O!Y'gi!]'gi~P#/sO!]/yO!Y)Pq~Or9wO!g#vO(r'pO~O[9yO!Y9xO~P#/sO!Y9xO~Oj:PO!g#vO~Og(_y!](_y~P!1WO!]'na!_'na~P#/sOa%[q!_%[q'z%[q!]%[q~P#/sO[:UO~O!]1TO!^)Xq~O`:YO~O#`:ZO!]'pa!^'pa~O!]5uO!^)Ui~P#BwO!S:]O~O!_1oO%i:`O~O(VTO(YUO(e:eO~O!]1zO!^)Vq~O!k:hO~O!k:iO~O!k:jO~O!k:jO~P%[O#`:mO!]#hy!^#hy~O!]#hy!^#hy~P#BwO%i:rO~P&8fO!_'`O%i:rO~O$O#|y!]#|y!^#|y~P#BwOP$|iR$|i[$|ij$|ir$|i!S$|i!l$|i!p$|i#R$|i#n$|i#o$|i#p$|i#q$|i#r$|i#s$|i#t$|i#u$|i#v$|i#x$|i#z$|i#{$|i$O$|i(a$|i(r$|i!]$|i!^$|i~P''VO!Q*OO'y*PO(z%POP'iaR'ia['iaj'ian'iar'ia!S'ia!l'ia!p'ia#R'ia#n'ia#o'ia#p'ia#q'ia#r'ia#s'ia#t'ia#u'ia#v'ia#x'ia#z'ia#{'ia$O'ia(a'ia(r'ia(y'ia!]'ia!^'ia~O!Q*OO'y*POP'kaR'ka['kaj'kan'kar'ka!S'ka!l'ka!p'ka#R'ka#n'ka#o'ka#p'ka#q'ka#r'ka#s'ka#t'ka#u'ka#v'ka#x'ka#z'ka#{'ka$O'ka(a'ka(r'ka(y'ka(z'ka!]'ka!^'ka~O(y$}OP%aiR%ai[%aij%ain%air%ai!Q%ai!S%ai!l%ai!p%ai#R%ai#n%ai#o%ai#p%ai#q%ai#r%ai#s%ai#t%ai#u%ai#v%ai#x%ai#z%ai#{%ai$O%ai'y%ai(a%ai(r%ai(z%ai!]%ai!^%ai~O(z%POP%ciR%ci[%cij%cin%cir%ci!Q%ci!S%ci!l%ci!p%ci#R%ci#n%ci#o%ci#p%ci#q%ci#r%ci#s%ci#t%ci#u%ci#v%ci#x%ci#z%ci#{%ci$O%ci'y%ci(a%ci(r%ci(y%ci!]%ci!^%ci~O$O$oy!]$oy!^$oy~P#BwO$O#cy!]#cy!^#cy~P#BwO!g#vO!]'eq!k'eq~O!]/pO!k)Oy~O!Y'gq!]'gq~P#/sOr:|O!g#vO(r'pO~O[;QO!Y;PO~P#/sO!Y;PO~Og(_!R!](_!R~P!1WOa%[y!_%[y'z%[y!]%[y~P#/sO!]1TO!^)Xy~O!]5uO!^)Uq~O(T;XO~O!_1oO%i;[O~O!k;_O~O%i;dO~P&8fOP$|qR$|q[$|qj$|qr$|q!S$|q!l$|q!p$|q#R$|q#n$|q#o$|q#p$|q#q$|q#r$|q#s$|q#t$|q#u$|q#v$|q#x$|q#z$|q#{$|q$O$|q(a$|q(r$|q!]$|q!^$|q~P''VO!Q*OO'y*PO(z%POP'jaR'ja['jaj'jan'jar'ja!S'ja!l'ja!p'ja#R'ja#n'ja#o'ja#p'ja#q'ja#r'ja#s'ja#t'ja#u'ja#v'ja#x'ja#z'ja#{'ja$O'ja(a'ja(r'ja(y'ja!]'ja!^'ja~O!Q*OO'y*POP'laR'la['laj'lan'lar'la!S'la!l'la!p'la#R'la#n'la#o'la#p'la#q'la#r'la#s'la#t'la#u'la#v'la#x'la#z'la#{'la$O'la(a'la(r'la(y'la(z'la!]'la!^'la~OP%OqR%Oq[%Oqj%Oqr%Oq!S%Oq!l%Oq!p%Oq#R%Oq#n%Oq#o%Oq#p%Oq#q%Oq#r%Oq#s%Oq#t%Oq#u%Oq#v%Oq#x%Oq#z%Oq#{%Oq$O%Oq(a%Oq(r%Oq!]%Oq!^%Oq~P''VOg%e!Z!]%e!Z#`%e!Z$O%e!Z~P!1WO!Y;hO~P#/sOr;iO!g#vO(r'pO~O[;kO!Y;hO~P#/sO!]'pq!^'pq~P#BwO!]#h!Z!^#h!Z~P#BwO#k%e!ZP%e!ZR%e!Z[%e!Za%e!Zj%e!Zr%e!Z!S%e!Z!]%e!Z!l%e!Z!p%e!Z#R%e!Z#n%e!Z#o%e!Z#p%e!Z#q%e!Z#r%e!Z#s%e!Z#t%e!Z#u%e!Z#v%e!Z#x%e!Z#z%e!Z#{%e!Z'z%e!Z(a%e!Z(r%e!Z!k%e!Z!Y%e!Z'w%e!Z#`%e!Zv%e!Z!_%e!Z%i%e!Z!g%e!Z~P#/sOr;tO!g#vO(r'pO~O!Y;uO~P#/sOr;|O!g#vO(r'pO~O!Y;}O~P#/sOP%e!ZR%e!Z[%e!Zj%e!Zr%e!Z!S%e!Z!l%e!Z!p%e!Z#R%e!Z#n%e!Z#o%e!Z#p%e!Z#q%e!Z#r%e!Z#s%e!Z#t%e!Z#u%e!Z#v%e!Z#x%e!Z#z%e!Z#{%e!Z$O%e!Z(a%e!Z(r%e!Z!]%e!Z!^%e!Z~P''VOr<QO!g#vO(r'pO~Ov(fX~P1qO!Q%rO~P!)[O(U!lO~P!)[O!YfX!]fX#`fX~P%2OOP]XR]X[]Xj]Xr]X!Q]X!S]X!]]X!]fX!l]X!p]X#R]X#S]X#`]X#`fX#kfX#n]X#o]X#p]X#q]X#r]X#s]X#t]X#u]X#v]X#x]X#z]X#{]X$Q]X(a]X(r]X(y]X(z]X~O!gfX!k]X!kfX(rfX~P'LTOP<UOQ<UOSfOd>ROe!iOpkOr<UOskOtkOzkO|<UO!O<UO!SWO!WkO!XkO!_XO!i<XO!lZO!o<UO!p<UO!q<UO!s<YO!u<]O!x!hO$W!kO$n>PO(T)]O(VTO(YUO(aVO(o[O~O!]<iO!^$qa~Oh%VOp%WOr%XOs$tOt$tOz%YO|%ZO!O<tO!S${O!_$|O!i>WO!l$xO#j<zO$W%`O$t<vO$v<xO$y%aO(T(vO(VTO(YUO(a$uO(y$}O(z%PO~Ol)dO~P(!yOr!eX(r!eX~P#!iOr(jX(r(jX~P##[O!^]X!^fX~P'LTO!YfX!Y$zX!]fX!]$zX#`fX~P!0SO#k<^O~O!g#vO#k<^O~O#`<nO~Oj<bO~O#`=OO!](wX!^(wX~O#`<nO!](uX!^(uX~O#k=PO~Og=RO~P!1WO#k=XO~O#k=YO~Og=RO(T&ZO~O!g#vO#k=ZO~O!g#vO#k=PO~O$O=[O~P#BwO#k=]O~O#k=^O~O#k=cO~O#k=dO~O#k=eO~O#k=fO~O$O=gO~P!1WO$O=hO~P!1WOl=sO~P7eOk#S#T#U#W#X#[#i#j#u$n$t$v$y%]%^%h%i%j%q%s%v%w%y%{~(OT#o!X'|(U#ps#n#qr!Q'}$]'}(T$_(e~",goto:"$9Y)]PPPPPP)^PP)aP)rP+W/]PPPP6mPP7TPP=QPPP@tPA^PA^PPPA^PCfPA^PA^PA^PCjPCoPD^PIWPPPI[PPPPI[L_PPPLeMVPI[PI[PP! eI[PPPI[PI[P!#lI[P!'S!(X!(bP!)U!)Y!)U!,gPPPPPPP!-W!(XPP!-h!/YP!2iI[I[!2n!5z!:h!:h!>gPPP!>oI[PPPPPPPPP!BOP!C]PPI[!DnPI[PI[I[I[I[I[PI[!FQP!I[P!LbP!Lf!Lp!Lt!LtP!IXP!Lx!LxP#!OP#!SI[PI[#!Y#%_CjA^PA^PA^A^P#&lA^A^#)OA^#+vA^#.SA^A^#.r#1W#1W#1]#1f#1W#1qPP#1WPA^#2ZA^#6YA^A^6mPPP#:_PPP#:x#:xP#:xP#;`#:xPP#;fP#;]P#;]#;y#;]#<e#<k#<n)aP#<q)aP#<z#<z#<zP)aP)aP)aP)aPP)aP#=Q#=TP#=T)aP#=XP#=[P)aP)aP)aP)aP)aP)a)aPP#=b#=h#=s#=y#>P#>V#>]#>k#>q#>{#?R#?]#?c#?s#?y#@k#@}#AT#AZ#Ai#BO#Cs#DR#DY#Et#FS#Gt#HS#HY#H`#Hf#Hp#Hv#H|#IW#Ij#IpPPPPPPPPPPP#IvPPPPPPP#Jk#Mx$ b$ i$ qPPP$']P$'f$*_$0x$0{$1O$1}$2Q$2X$2aP$2g$2jP$3W$3[$4S$5b$5g$5}PP$6S$6Y$6^$6a$6e$6i$7e$7|$8e$8i$8l$8o$8y$8|$9Q$9UR!|RoqOXst!Z#d%m&r&t&u&w,s,x2[2_Y!vQ'`-e1o5{Q%tvQ%|yQ&T|Q&j!VS'W!e-]Q'f!iS'l!r!yU*k$|*Z*oQ+o%}S+|&V&WQ,d&dQ-c'_Q-m'gQ-u'mQ0[*qQ1b,OQ1y,eR<{<Y%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+],p,s,x-i-q.P.V.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3l4z6T6e6f6i6|8t9T9_S#q]<V!r)_$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SU+P%]<s<tQ+t&PQ,f&gQ,m&oQ0x+gQ0}+iQ1Y+uQ2R,kQ3`.gQ5`0|Q5f1TQ6[1zQ7Y3dQ8`5gR9e7['QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S!S!nQ!r!v!y!z$|'W'_'`'l'm'n*k*o*q*r-]-c-e-u0[0_1o5{5}%[$ti#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^Q&X|Q'U!eS'[%i-`Q+t&PQ,P&WQ,f&gQ0n+SQ1Y+uQ1_+{Q2Q,jQ2R,kQ5f1TQ5o1aQ6[1zQ6_1|Q6`2PQ8`5gQ8c5lQ8|6bQ:X8dQ:f8yQ;V:YR<}*ZrnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_R,h&k&z^OPXYstuvwz!Z!`!g!j!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'b'r(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>R>S[#]WZ#W#Z'X(T!b%jm#h#i#l$x%e%h(^(h(i(j*Y*^*b+Z+[+^,o-V.T.Z.[.]._/m/p2d3[3]4a6r7TQ%wxQ%{yW&Q|&V&W,OQ&_!TQ'c!hQ'e!iQ(q#sS+n%|%}Q+r&PQ,_&bQ,c&dS-l'f'gQ.i(rQ1R+oQ1X+uQ1Z+vQ1^+zQ1t,`S1x,d,eQ2|-mQ5e1TQ5i1WQ5n1`Q6Z1yQ8_5gQ8b5kQ8f5pQ:T8^R;T:U!U$zi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y!^%yy!i!u%{%|%}'V'e'f'g'k'u*j+n+o-Y-l-m-t0R0U1R2u2|3T4r4s4v7}9{Q+h%wQ,T&[Q,W&]Q,b&dQ.h(qQ1s,_U1w,c,d,eQ3e.iQ6U1tS6Y1x1yQ8x6Z#f>T#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^o>U<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hW%Ti%V*y>PS&[!Q&iQ&]!RQ&^!SU*}%[%d=sR,R&Y%]%Si#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^T)z$u){V+P%]<s<tW'[!e%i*Z-`S(}#y#zQ+c%rQ+y&SS.b(m(nQ1j,XQ5T0kR8i5u'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S$i$^c#Y#e%q%s%u(S(Y(t(y)R)S)T)U)V)W)X)Y)Z)[)^)`)b)g)q+d+x-Z-x-}.S.U.s.v.z.|.}/O/b0p2k2n3O3V3k3p3q3r3s3t3u3v3w3x3y3z3{3|4P4Q4X5X5c6u6{7Q7a7b7k7l8k9X9]9g9m9n:o;W;`<W=vT#TV#U'RkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ'Y!eR2q-]!W!nQ!e!r!v!y!z$|'W'_'`'l'm'n*Z*k*o*q*r-]-c-e-u0[0_1o5{5}R1l,ZnqOXst!Z#d%m&r&t&u&w,s,x2[2_Q&y!^Q'v!xS(s#u<^Q+l%zQ,]&_Q,^&aQ-j'dQ-w'oS.r(x=PS0q+X=ZQ1P+mQ1n,[Q2c,zQ2e,{Q2m-WQ2z-kQ2}-oS5Y0r=eQ5a1QS5d1S=fQ6t2oQ6x2{Q6}3SQ8]5bQ9Y6vQ9Z6yQ9^7OR:l9V$d$]c#Y#e%s%u(S(Y(t(y)R)S)T)U)V)W)X)Y)Z)[)^)`)b)g)q+d+x-Z-x-}.S.U.s.v.z.}/O/b0p2k2n3O3V3k3p3q3r3s3t3u3v3w3x3y3z3{3|4P4Q4X5X5c6u6{7Q7a7b7k7l8k9X9]9g9m9n:o;W;`<W=vS(o#p'iQ)P#zS+b%q.|S.c(n(pR3^.d'QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SS#q]<VQ&t!XQ&u!YQ&w![Q&x!]R2Z,vQ'a!hQ+e%wQ-h'cS.e(q+hQ2x-gW3b.h.i0w0yQ6w2yW7U3_3a3e5^U9a7V7X7ZU:q9c9d9fS;b:p:sQ;p;cR;x;qU!wQ'`-eT5y1o5{!Q_OXZ`st!V!Z#d#h%e%m&i&k&r&t&u&w(j,s,x.[2[2_]!pQ!r'`-e1o5{T#q]<V%^{OPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_S(}#y#zS.b(m(n!s=l$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SU$fd)_,mS(p#p'iU*v%R(w4OU0m+O.n7gQ5^0xQ7V3`Q9d7YR:s9em!tQ!r!v!y!z'`'l'm'n-e-u1o5{5}Q't!uS(f#g2US-s'k'wQ/s*]Q0R*jQ3U-vQ4f/tQ4r0TQ4s0UQ4x0^Q7r4`S7}4t4vS8R4y4{Q9r7sQ9v7yQ9{8OQ:Q8TS:{9w9xS;g:|;PS;s;h;iS;{;t;uS<P;|;}R<S<QQ#wbQ's!uS(e#g2US(g#m+WQ+Y%fQ+j%xQ+p&OU-r'k't'wQ.W(fU/r*]*`/wQ0S*jQ0V*lQ1O+kQ1u,aS3R-s-vQ3Z.`S4e/s/tQ4n0PS4q0R0^Q4u0WQ6W1vQ7P3US7q4`4bQ7u4fU7|4r4x4{Q8P4wQ8v6XS9q7r7sQ9u7yQ9}8RQ:O8SQ:c8wQ:y9rS:z9v9xQ;S:QQ;^:dS;f:{;PS;r;g;hS;z;s;uS<O;{;}Q<R<PQ<T<SQ=o=jQ={=tR=|=uV!wQ'`-e%^aOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_S#wz!j!r=i$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SR=o>R%^bOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_Q%fj!^%xy!i!u%{%|%}'V'e'f'g'k'u*j+n+o-Y-l-m-t0R0U1R2u2|3T4r4s4v7}9{S&Oz!jQ+k%yQ,a&dW1v,b,c,d,eU6X1w1x1yS8w6Y6ZQ:d8x!r=j$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ=t>QR=u>R%QeOPXYstuvw!Z!`!g!o#S#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_Y#bWZ#W#Z(T!b%jm#h#i#l$x%e%h(^(h(i(j*Y*^*b+Z+[+^,o-V.T.Z.[.]._/m/p2d3[3]4a6r7TQ,n&o!p=k$Z$n)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SR=n'XU']!e%i*ZR2s-`%SdOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+],p,s,x-i-q.P.V.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3l4z6T6e6f6i6|8t9T9_!r)_$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SQ,m&oQ0x+gQ3`.gQ7Y3dR9e7[!b$Tc#Y%q(S(Y(t(y)Z)[)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<W!P<d)^)q-Z.|2k2n3p3y3z4P4X6u7b7k7l8k9X9g9m9n;W;`=v!f$Vc#Y%q(S(Y(t(y)W)X)Z)[)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<W!T<f)^)q-Z.|2k2n3p3v3w3y3z4P4X6u7b7k7l8k9X9g9m9n;W;`=v!^$Zc#Y%q(S(Y(t(y)`)g+x-x-}.S.U.s.v/b0p3O3V3k3{5X5c6{7Q7a9]:o<WQ4_/kz>S)^)q-Z.|2k2n3p4P4X6u7b7k7l8k9X9g9m9n;W;`=vQ>X>ZR>Y>['QkOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>SS$oh$pR4U/U'XgOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/U/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>ST$kf$qQ$ifS)j$l)nR)v$qT$jf$qT)l$l)n'XhOPWXYZhstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$Z$_$a$e$n$p%m%t&R&k&n&o&r&t&u&w&{'T'X'b'r(T(V(](d(x(z)O)s)}*i+X+]+g,p,s,x-U-X-i-q.P.V.g.t.{/U/V/n0]0l0r1S1r2S2T2V2X2[2_2a2p3Q3W3d3l4T4z5w6T6e6f6i6s6|7[8t9T9_:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>ST$oh$pQ$rhR)u$p%^jOPWXYZstuvw!Z!`!g!o#S#W#Z#d#o#u#x#{$O$P$Q$R$S$T$U$V$W$X$_$a$e%m%t&R&k&n&o&r&t&u&w&{'T'b'r(T(V(](d(x(z)O)}*i+X+]+g,p,s,x-i-q.P.V.g.t.{/n0]0l0r1S1r2S2T2V2X2[2_2a3Q3W3d3l4z6T6e6f6i6|7[8t9T9_!s>Q$Z$n'X)s-U-X/V2p4T5w6s:Z:m<U<X<Y<]<^<_<`<a<b<c<d<e<f<g<h<i<k<n<{=O=P=R=Z=[=e=f>S#glOPXZst!Z!`!o#S#d#o#{$n%m&k&n&o&r&t&u&w&{'T'b)O)s*i+]+g,p,s,x-i.g/V/n0]0l1r2S2T2V2X2[2_2a3d4T4z6T6e6f6i7[8t9T!U%Ri$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y#f(w#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^Q+T%aQ/c*Oo4O<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!U$yi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>YQ*c$zU*l$|*Z*oQ+U%bQ0W*m#f=q#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n=r<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hQ=w>TQ=x>UQ=y>VR=z>W!U%Ri$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y#f(w#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^o4O<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=hnoOXst!Z#d%m&r&t&u&w,s,x2[2_S*f${*YQ-R'OQ-S'QR4i/y%[%Si#v$b$c$d$x${%O%Q%^%_%c)y*R*T*V*Y*a*g*w*x+f+i,S,V.f/P/d/m/x/y/{0`0b0i0j0o1f1i1q3c4^4_4j4o5Q5[5_6S7W7v8Q8V8[8q9b9p9y:P:`:r;Q;[;d;k<l<m<o<p<q<r<u<v<w<x<y<z=S=T=U=V=X=Y=]=^=_=`=a=b=c=d=g=h>P>X>Y>]>^Q,U&]Q1h,WQ5s1gR8h5tV*n$|*Z*oU*n$|*Z*oT5z1o5{S0P*i/nQ4w0]T8S4z:]Q+j%xQ0V*lQ1O+kQ1u,aQ6W1vQ8v6XQ:c8wR;^:d!U%Oi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Yx*R$v)e*S*u+V/v0d0e4R4g5R5S5W7p8U:R:x=p=}>OS0`*t0a#f<o#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n<p<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!d=S(u)c*[*e.j.m.q/_/k/|0v1e3h4[4h4l5r7]7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[`=T3}7c7f7j9h:t:w;yS=_.l3iT=`7e9k!U%Qi$d%O%Q%^%_%c*R*T*a*w*x/P/x0`0b0i0j0o4_5Q8V9p>P>X>Y|*T$v)e*U*t+V/g/v0d0e4R4g4|5R5S5W7p8U:R:x=p=}>OS0b*u0c#f<q#v$b$c$x${)y*V*Y*g+f+i,S,V.f/d/m/y/{1f1i1q3c4^4j4o5[5_6S7W7v8Q8[8q9b9y:P:`:r;Q;[;d;k<o<q<u<w<y=S=U=X=]=_=a=c=g>]>^n<r<l<m<p<r<v<x<z=T=V=Y=^=`=b=d=h!h=U(u)c*[*e.k.l.q/_/k/|0v1e3f3h4[4h4l5r7]7^7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[d=V3}7d7e7j9h9i:t:u:w;yS=a.m3jT=b7f9lrnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_Q&f!UR,p&ornOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_R&f!UQ,Y&^R1d,RsnOXst!V!Z#d%m&i&r&t&u&w,s,x2[2_Q1p,_S6R1s1tU8p6P6Q6US:_8r8sS;Y:^:aQ;m;ZR;w;nQ&m!VR,i&iR6_1|R:f8yW&Q|&V&W,OR1Z+vQ&r!WR,s&sR,y&xT2],x2_R,}&yQ,|&yR2f,}Q'y!{R-y'ySsOtQ#dXT%ps#dQ#OTR'{#OQ#RUR'}#RQ){$uR/`){Q#UVR(Q#UQ#XWU(W#X(X.QQ(X#YR.Q(YQ-^'YR2r-^Q.u(yS3m.u3nR3n.vQ-e'`R2v-eY!rQ'`-e1o5{R'j!rQ/Q)eR4S/QU#_W%h*YU(_#_(`.RQ(`#`R.R(ZQ-a']R2t-at`OXst!V!Z#d%m&i&k&r&t&u&w,s,x2[2_S#hZ%eU#r`#h.[R.[(jQ(k#jQ.X(gW.a(k.X3X7RQ3X.YR7R3YQ)n$lR/W)nQ$phR)t$pQ$`cU)a$`-|<jQ-|<WR<j)qQ/q*]W4c/q4d7t9sU4d/r/s/tS7t4e4fR9s7u$e*Q$v(u)c)e*[*e*t*u+Q+R+V.l.m.o.p.q/_/g/i/k/v/|0d0e0v1e3f3g3h3}4R4[4g4h4l4|5O5R5S5W5r7]7^7_7`7e7f7h7i7j7p7w7z8U8X8Z9h9i9j9t9|:R:S:t:u:v:w:x:};R;e;j;v;y=p=}>O>Z>[Q/z*eU4k/z4m7xQ4m/|R7x4lS*o$|*ZR0Y*ox*S$v)e*t*u+V/v0d0e4R4g5R5S5W7p8U:R:x=p=}>O!d.j(u)c*[*e.l.m.q/_/k/|0v1e3h4[4h4l5r7]7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[U/h*S.j7ca7c3}7e7f7j9h:t:w;yQ0a*tQ3i.lU4}0a3i9kR9k7e|*U$v)e*t*u+V/g/v0d0e4R4g4|5R5S5W7p8U:R:x=p=}>O!h.k(u)c*[*e.l.m.q/_/k/|0v1e3f3h4[4h4l5r7]7^7`7w7z8X8Z9t9|:S:};R;e;j;v>Z>[U/j*U.k7de7d3}7e7f7j9h9i:t:u:w;yQ0c*uQ3j.mU5P0c3j9lR9l7fQ*z%UR0g*zQ5]0vR8Y5]Q+_%kR0u+_Q5v1jS8j5v:[R:[8kQ,[&_R1m,[Q5{1oR8m5{Q1{,fS6]1{8zR8z6_Q1U+rW5h1U5j8a:VQ5j1XQ8a5iR:V8bQ+w&QR1[+wQ2_,xR6m2_YrOXst#dQ&v!ZQ+a%mQ,r&rQ,t&tQ,u&uQ,w&wQ2Y,sS2],x2_R6l2[Q%opQ&z!_Q&}!aQ'P!bQ'R!cQ'q!uQ+`%lQ+l%zQ,Q&XQ,h&mQ-P&|W-p'k's't'wQ-w'oQ0X*nQ1P+mQ1c,PS2O,i,lQ2g-OQ2h-RQ2i-SQ2}-oW3P-r-s-v-xQ5a1QQ5m1_Q5q1eQ6V1uQ6a2QQ6k2ZU6z3O3R3UQ6}3SQ8]5bQ8e5oQ8g5rQ8l5zQ8u6WQ8{6`S9[6{7PQ9^7OQ:W8cQ:b8vQ:g8|Q:n9]Q;U:XQ;]:cQ;a:oQ;l;VR;o;^Q%zyQ'd!iQ'o!uU+m%{%|%}Q-W'VU-k'e'f'gS-o'k'uQ0Q*jS1Q+n+oQ2o-YS2{-l-mQ3S-tS4p0R0UQ5b1RQ6v2uQ6y2|Q7O3TU7{4r4s4vQ9z7}R;O9{S$wi>PR*{%VU%Ui%V>PR0f*yQ$viS(u#v+iS)c$b$cQ)e$dQ*[$xS*e${*YQ*t%OQ*u%QQ+Q%^Q+R%_Q+V%cQ.l<oQ.m<qQ.o<uQ.p<wQ.q<yQ/_)yQ/g*RQ/i*TQ/k*VQ/v*aS/|*g/mQ0d*wQ0e*xl0v+f,V.f1i1q3c6S7W8q9b:`:r;[;dQ1e,SQ3f=SQ3g=UQ3h=XS3}<l<mQ4R/PS4[/d4^Q4g/xQ4h/yQ4l/{Q4|0`Q5O0bQ5R0iQ5S0jQ5W0oQ5r1fQ7]=]Q7^=_Q7_=aQ7`=cQ7e<pQ7f<rQ7h<vQ7i<xQ7j<zQ7p4_Q7w4jQ7z4oQ8U5QQ8X5[Q8Z5_Q9h=YQ9i=TQ9j=VQ9t7vQ9|8QQ:R8VQ:S8[Q:t=^Q:u=`Q:v=bQ:w=dQ:x9pQ:}9yQ;R:PQ;e=gQ;j;QQ;v;kQ;y=hQ=p>PQ=}>XQ>O>YQ>Z>]R>[>^Q+O%]Q.n<sR7g<tnpOXst!Z#d%m&r&t&u&w,s,x2[2_Q!fPS#fZ#oQ&|!`W'h!o*i0]4zQ(P#SQ)Q#{Q)r$nS,l&k&nQ,q&oQ-O&{S-T'T/nQ-g'bQ.x)OQ/[)sQ0s+]Q0y+gQ2W,pQ2y-iQ3a.gQ4W/VQ5U0lQ6Q1rQ6c2SQ6d2TQ6h2VQ6j2XQ6o2aQ7Z3dQ7m4TQ8s6TQ9P6eQ9Q6fQ9S6iQ9f7[Q:a8tR:k9T#[cOPXZst!Z!`!o#d#o#{%m&k&n&o&r&t&u&w&{'T'b)O*i+]+g,p,s,x-i.g/n0]0l1r2S2T2V2X2[2_2a3d4z6T6e6f6i7[8t9TQ#YWQ#eYQ%quQ%svS%uw!gS(S#W(VQ(Y#ZQ(t#uQ(y#xQ)R$OQ)S$PQ)T$QQ)U$RQ)V$SQ)W$TQ)X$UQ)Y$VQ)Z$WQ)[$XQ)^$ZQ)`$_Q)b$aQ)g$eW)q$n)s/V4TQ+d%tQ+x&RS-Z'X2pQ-x'rS-}(T.PQ.S(]Q.U(dQ.s(xQ.v(zQ.z<UQ.|<XQ.}<YQ/O<]Q/b)}Q0p+XQ2k-UQ2n-XQ3O-qQ3V.VQ3k.tQ3p<^Q3q<_Q3r<`Q3s<aQ3t<bQ3u<cQ3v<dQ3w<eQ3x<fQ3y<gQ3z<hQ3{.{Q3|<kQ4P<nQ4Q<{Q4X<iQ5X0rQ5c1SQ6u=OQ6{3QQ7Q3WQ7a3lQ7b=PQ7k=RQ7l=ZQ8k5wQ9X6sQ9]6|Q9g=[Q9m=eQ9n=fQ:o9_Q;W:ZQ;`:mQ<W#SR=v>SR#[WR'Z!el!tQ!r!v!y!z'`'l'm'n-e-u1o5{5}S'V!e-]U*j$|*Z*oS-Y'W'_S0U*k*qQ0^*rQ2u-cQ4v0[R4{0_R({#xQ!fQT-d'`-e]!qQ!r'`-e1o5{Q#p]R'i<VR)f$dY!uQ'`-e1o5{Q'k!rS'u!v!yS'w!z5}S-t'l'mQ-v'nR3T-uT#kZ%eS#jZ%eS%km,oU(g#h#i#lS.Y(h(iQ.^(jQ0t+^Q3Y.ZU3Z.[.]._S7S3[3]R9`7Td#^W#W#Z%h(T(^*Y+Z.T/mr#gZm#h#i#l%e(h(i(j+^.Z.[.]._3[3]7TS*]$x*bQ/t*^Q2U,oQ2l-VQ4`/pQ6q2dQ7s4aQ9W6rT=m'X+[V#aW%h*YU#`W%h*YS(U#W(^U(Z#Z+Z/mS-['X+[T.O(T.TV'^!e%i*ZQ$lfR)x$qT)m$l)nR4V/UT*_$x*bT*h${*YQ0w+fQ1g,VQ3_.fQ5t1iQ6P1qQ7X3cQ8r6SQ9c7WQ:^8qQ:p9bQ;Z:`Q;c:rQ;n;[R;q;dnqOXst!Z#d%m&r&t&u&w,s,x2[2_Q&l!VR,h&itmOXst!U!V!Z#d%m&i&r&t&u&w,s,x2[2_R,o&oT%lm,oR1k,XR,g&gQ&U|S+}&V&WR1^,OR+s&PT&p!W&sT&q!W&sT2^,x2_",nodeNames:"⚠ ArithOp ArithOp ?. JSXStartTag LineComment BlockComment Script Hashbang ExportDeclaration export Star as VariableName String Escape from ; default FunctionDeclaration async function VariableDefinition > < TypeParamList in out const TypeDefinition extends ThisType this LiteralType ArithOp Number BooleanLiteral TemplateType InterpolationEnd Interpolation InterpolationStart NullType null VoidType void TypeofType typeof MemberExpression . PropertyName [ TemplateString Escape Interpolation super RegExp ] ArrayExpression Spread , } { ObjectExpression Property async get set PropertyDefinition Block : NewTarget new NewExpression ) ( ArgList UnaryExpression delete LogicOp BitOp YieldExpression yield AwaitExpression await ParenthesizedExpression ClassExpression class ClassBody MethodDeclaration Decorator @ MemberExpression PrivatePropertyName CallExpression TypeArgList CompareOp < declare Privacy static abstract override PrivatePropertyDefinition PropertyDeclaration readonly accessor Optional TypeAnnotation Equals StaticBlock FunctionExpression ArrowFunction ParamList ParamList ArrayPattern ObjectPattern PatternProperty Privacy readonly Arrow MemberExpression BinaryExpression ArithOp ArithOp ArithOp ArithOp BitOp CompareOp instanceof satisfies CompareOp BitOp BitOp BitOp LogicOp LogicOp ConditionalExpression LogicOp LogicOp AssignmentExpression UpdateOp PostfixExpression CallExpression InstantiationExpression TaggedTemplateExpression DynamicImport import ImportMeta JSXElement JSXSelfCloseEndTag JSXSelfClosingTag JSXIdentifier JSXBuiltin JSXIdentifier JSXNamespacedName JSXMemberExpression JSXSpreadAttribute JSXAttribute JSXAttributeValue JSXEscape JSXEndTag JSXOpenTag JSXFragmentTag JSXText JSXEscape JSXStartCloseTag JSXCloseTag PrefixCast < ArrowFunction TypeParamList SequenceExpression InstantiationExpression KeyofType keyof UniqueType unique ImportType InferredType infer TypeName ParenthesizedType FunctionSignature ParamList NewSignature IndexedType TupleType Label ArrayType ReadonlyType ObjectType MethodType PropertyType IndexSignature PropertyDefinition CallSignature TypePredicate asserts is NewSignature new UnionType LogicOp IntersectionType LogicOp ConditionalType ParameterizedType ClassDeclaration abstract implements type VariableDeclaration let var using TypeAliasDeclaration InterfaceDeclaration interface EnumDeclaration enum EnumBody NamespaceDeclaration namespace module AmbientDeclaration declare GlobalDeclaration global ClassDeclaration ClassBody AmbientFunctionDeclaration ExportGroup VariableName VariableName ImportDeclaration defer ImportGroup ForStatement for ForSpec ForInSpec ForOfSpec of WhileStatement while WithStatement with DoStatement do IfStatement if else SwitchStatement switch SwitchBody CaseLabel case DefaultLabel TryStatement try CatchClause catch FinallyClause finally ReturnStatement return ThrowStatement throw BreakStatement break ContinueStatement continue DebuggerStatement debugger LabeledStatement ExpressionStatement SingleExpression SingleClassItem",maxTerm:380,context:Ek,nodeProps:[["isolate",-8,5,6,14,37,39,51,53,55,""],["group",-26,9,17,19,68,207,211,215,216,218,221,224,234,237,243,245,247,249,252,258,264,266,268,270,272,274,275,"Statement",-34,13,14,32,35,36,42,51,54,55,57,62,70,72,76,80,82,84,85,110,111,120,121,136,139,141,142,143,144,145,147,148,167,169,171,"Expression",-23,31,33,37,41,43,45,173,175,177,178,180,181,182,184,185,186,188,189,190,201,203,205,206,"Type",-3,88,103,109,"ClassItem"],["openedBy",23,"<",38,"InterpolationStart",56,"[",60,"{",73,"(",160,"JSXStartCloseTag"],["closedBy",-2,24,168,">",40,"InterpolationEnd",50,"]",61,"}",74,")",165,"JSXEndTag"]],propSources:[Fk],skippedNodes:[0,5,6,278],repeatNodeCount:37,tokenData:"$Fq07[R!bOX%ZXY+gYZ-yZ[+g[]%Z]^.c^p%Zpq+gqr/mrs3cst:_tuEruvJSvwLkwx! Yxy!'iyz!(sz{!)}{|!,q|}!.O}!O!,q!O!P!/Y!P!Q!9j!Q!R#:O!R![#<_![!]#I_!]!^#Jk!^!_#Ku!_!`$![!`!a$$v!a!b$*T!b!c$,r!c!}Er!}#O$-|#O#P$/W#P#Q$4o#Q#R$5y#R#SEr#S#T$7W#T#o$8b#o#p$<r#p#q$=h#q#r$>x#r#s$@U#s$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$I|Er$I|$I}$Dk$I}$JO$Dk$JO$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr(n%d_$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z&j&hT$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c&j&zP;=`<%l&c'|'U]$i&j(Z!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!b(SU(Z!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!b(iP;=`<%l'}'|(oP;=`<%l&}'[(y]$i&j(WpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(rp)wU(WpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)rp*^P;=`<%l)r'[*dP;=`<%l(r#S*nX(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g#S+^P;=`<%l*g(n+dP;=`<%l%Z07[+rq$i&j(Wp(Z!b'|0/lOX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p$f%Z$f$g+g$g#BY%Z#BY#BZ+g#BZ$IS%Z$IS$I_+g$I_$JT%Z$JT$JU+g$JU$KV%Z$KV$KW+g$KW&FU%Z&FU&FV+g&FV;'S%Z;'S;=`+a<%l?HT%Z?HT?HU+g?HUO%Z07[.ST(X#S$i&j'}0/lO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c07[.n_$i&j(Wp(Z!b'}0/lOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)3p/x`$i&j!p),Q(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW1V`#v(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`2X!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW2d_#v(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At3l_(V':f$i&j(Z!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k(^4r_$i&j(Z!bOY4kYZ5qZr4krs7nsw4kwx5qx!^4k!^!_8p!_#O4k#O#P5q#P#o4k#o#p8p#p;'S4k;'S;=`:X<%lO4k&z5vX$i&jOr5qrs6cs!^5q!^!_6y!_#o5q#o#p6y#p;'S5q;'S;=`7h<%lO5q&z6jT$d`$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c`6|TOr6yrs7]s;'S6y;'S;=`7b<%lO6y`7bO$d``7eP;=`<%l6y&z7kP;=`<%l5q(^7w]$d`$i&j(Z!bOY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}!r8uZ(Z!bOY8pYZ6yZr8prs9hsw8pwx6yx#O8p#O#P6y#P;'S8p;'S;=`:R<%lO8p!r9oU$d`(Z!bOY'}Zw'}x#O'}#P;'S'};'S;=`(f<%lO'}!r:UP;=`<%l8p(^:[P;=`<%l4k%9[:hh$i&j(Wp(Z!bOY%ZYZ&cZq%Zqr<Srs&}st%ZtuCruw%Zwx(rx!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr(r<__WS$i&j(Wp(Z!bOY<SYZ&cZr<Srs=^sw<Swx@nx!^<S!^!_Bm!_#O<S#O#P>`#P#o<S#o#pBm#p;'S<S;'S;=`Cl<%lO<S(Q=g]WS$i&j(Z!bOY=^YZ&cZw=^wx>`x!^=^!^!_?q!_#O=^#O#P>`#P#o=^#o#p?q#p;'S=^;'S;=`@h<%lO=^&n>gXWS$i&jOY>`YZ&cZ!^>`!^!_?S!_#o>`#o#p?S#p;'S>`;'S;=`?k<%lO>`S?XSWSOY?SZ;'S?S;'S;=`?e<%lO?SS?hP;=`<%l?S&n?nP;=`<%l>`!f?xWWS(Z!bOY?qZw?qwx?Sx#O?q#O#P?S#P;'S?q;'S;=`@b<%lO?q!f@eP;=`<%l?q(Q@kP;=`<%l=^'`@w]WS$i&j(WpOY@nYZ&cZr@nrs>`s!^@n!^!_Ap!_#O@n#O#P>`#P#o@n#o#pAp#p;'S@n;'S;=`Bg<%lO@ntAwWWS(WpOYApZrAprs?Ss#OAp#O#P?S#P;'SAp;'S;=`Ba<%lOAptBdP;=`<%lAp'`BjP;=`<%l@n#WBvYWS(Wp(Z!bOYBmZrBmrs?qswBmwxApx#OBm#O#P?S#P;'SBm;'S;=`Cf<%lOBm#WCiP;=`<%lBm(rCoP;=`<%l<S%9[C}i$i&j(o%1l(Wp(Z!bOY%ZYZ&cZr%Zrs&}st%ZtuCruw%Zwx(rx!Q%Z!Q![Cr![!^%Z!^!_*g!_!c%Z!c!}Cr!}#O%Z#O#P&c#P#R%Z#R#SCr#S#T%Z#T#oCr#o#p*g#p$g%Z$g;'SCr;'S;=`El<%lOCr%9[EoP;=`<%lCr07[FRk$i&j(Wp(Z!b$]#t(T,2j(e$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr+dHRk$i&j(Wp(Z!b$]#tOY%ZYZ&cZr%Zrs&}st%ZtuGvuw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Gv![!^%Z!^!_*g!_!c%Z!c!}Gv!}#O%Z#O#P&c#P#R%Z#R#SGv#S#T%Z#T#oGv#o#p*g#p$g%Z$g;'SGv;'S;=`Iv<%lOGv+dIyP;=`<%lGv07[JPP;=`<%lEr(KWJ_`$i&j(Wp(Z!b#p(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWKl_$i&j$Q(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,#xLva(z+JY$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sv%ZvwM{wx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KWNW`$i&j#z(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'At! c_(Y';W$i&j(WpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b'l!!i_$i&j(WpOY!!bYZ!#hZr!!brs!#hsw!!bwx!$xx!^!!b!^!_!%z!_#O!!b#O#P!#h#P#o!!b#o#p!%z#p;'S!!b;'S;=`!'c<%lO!!b&z!#mX$i&jOw!#hwx6cx!^!#h!^!_!$Y!_#o!#h#o#p!$Y#p;'S!#h;'S;=`!$r<%lO!#h`!$]TOw!$Ywx7]x;'S!$Y;'S;=`!$l<%lO!$Y`!$oP;=`<%l!$Y&z!$uP;=`<%l!#h'l!%R]$d`$i&j(WpOY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r!Q!&PZ(WpOY!%zYZ!$YZr!%zrs!$Ysw!%zwx!&rx#O!%z#O#P!$Y#P;'S!%z;'S;=`!']<%lO!%z!Q!&yU$d`(WpOY)rZr)rs#O)r#P;'S)r;'S;=`*Z<%lO)r!Q!'`P;=`<%l!%z'l!'fP;=`<%l!!b/5|!'t_!l/.^$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#&U!)O_!k!Lf$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z-!n!*[b$i&j(Wp(Z!b(U%&f#q(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rxz%Zz{!+d{!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW!+o`$i&j(Wp(Z!b#n(ChOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;x!,|`$i&j(Wp(Z!br+4YOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z,$U!.Z_!]+Jf$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!/ec$i&j(Wp(Z!b!Q.2^OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!0p!P!Q%Z!Q![!3Y![!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!0ya$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!2O!P!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z#%|!2Z_![!L^$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!3eg$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!3Y![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S!3Y#S#X%Z#X#Y!4|#Y#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!5Vg$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx{%Z{|!6n|}%Z}!O!6n!O!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!6wc$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad!8_c$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![!8S![!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S!8S#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[!9uf$i&j(Wp(Z!b#o(ChOY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcxz!;Zz{#-}{!P!;Z!P!Q#/d!Q!^!;Z!^!_#(i!_!`#7S!`!a#8i!a!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z?O!;fb$i&j(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z>^!<w`$i&j(Z!b!X7`OY!<nYZ&cZw!<nwx!=yx!P!<n!P!Q!Eq!Q!^!<n!^!_!Gr!_!}!<n!}#O!KS#O#P!Dy#P#o!<n#o#p!Gr#p;'S!<n;'S;=`!L]<%lO!<n<z!>Q^$i&j!X7`OY!=yYZ&cZ!P!=y!P!Q!>|!Q!^!=y!^!_!@c!_!}!=y!}#O!CW#O#P!Dy#P#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!?Td$i&j!X7`O!^&c!_#W&c#W#X!>|#X#Z&c#Z#[!>|#[#]&c#]#^!>|#^#a&c#a#b!>|#b#g&c#g#h!>|#h#i&c#i#j!>|#j#k!>|#k#m&c#m#n!>|#n#o&c#p;'S&c;'S;=`&w<%lO&c7`!@hX!X7`OY!@cZ!P!@c!P!Q!AT!Q!}!@c!}#O!Ar#O#P!Bq#P;'S!@c;'S;=`!CQ<%lO!@c7`!AYW!X7`#W#X!AT#Z#[!AT#]#^!AT#a#b!AT#g#h!AT#i#j!AT#j#k!AT#m#n!AT7`!AuVOY!ArZ#O!Ar#O#P!B[#P#Q!@c#Q;'S!Ar;'S;=`!Bk<%lO!Ar7`!B_SOY!ArZ;'S!Ar;'S;=`!Bk<%lO!Ar7`!BnP;=`<%l!Ar7`!BtSOY!@cZ;'S!@c;'S;=`!CQ<%lO!@c7`!CTP;=`<%l!@c<z!C][$i&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#O!CW#O#P!DR#P#Q!=y#Q#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DWX$i&jOY!CWYZ&cZ!^!CW!^!_!Ar!_#o!CW#o#p!Ar#p;'S!CW;'S;=`!Ds<%lO!CW<z!DvP;=`<%l!CW<z!EOX$i&jOY!=yYZ&cZ!^!=y!^!_!@c!_#o!=y#o#p!@c#p;'S!=y;'S;=`!Ek<%lO!=y<z!EnP;=`<%l!=y>^!Ezl$i&j(Z!b!X7`OY&}YZ&cZw&}wx&cx!^&}!^!_'}!_#O&}#O#P&c#P#W&}#W#X!Eq#X#Z&}#Z#[!Eq#[#]&}#]#^!Eq#^#a&}#a#b!Eq#b#g&}#g#h!Eq#h#i&}#i#j!Eq#j#k!Eq#k#m&}#m#n!Eq#n#o&}#o#p'}#p;'S&};'S;=`(l<%lO&}8r!GyZ(Z!b!X7`OY!GrZw!Grwx!@cx!P!Gr!P!Q!Hl!Q!}!Gr!}#O!JU#O#P!Bq#P;'S!Gr;'S;=`!J|<%lO!Gr8r!Hse(Z!b!X7`OY'}Zw'}x#O'}#P#W'}#W#X!Hl#X#Z'}#Z#[!Hl#[#]'}#]#^!Hl#^#a'}#a#b!Hl#b#g'}#g#h!Hl#h#i'}#i#j!Hl#j#k!Hl#k#m'}#m#n!Hl#n;'S'};'S;=`(f<%lO'}8r!JZX(Z!bOY!JUZw!JUwx!Arx#O!JU#O#P!B[#P#Q!Gr#Q;'S!JU;'S;=`!Jv<%lO!JU8r!JyP;=`<%l!JU8r!KPP;=`<%l!Gr>^!KZ^$i&j(Z!bOY!KSYZ&cZw!KSwx!CWx!^!KS!^!_!JU!_#O!KS#O#P!DR#P#Q!<n#Q#o!KS#o#p!JU#p;'S!KS;'S;=`!LV<%lO!KS>^!LYP;=`<%l!KS>^!L`P;=`<%l!<n=l!Ll`$i&j(Wp!X7`OY!LcYZ&cZr!Lcrs!=ys!P!Lc!P!Q!Mn!Q!^!Lc!^!_# o!_!}!Lc!}#O#%P#O#P!Dy#P#o!Lc#o#p# o#p;'S!Lc;'S;=`#&Y<%lO!Lc=l!Mwl$i&j(Wp!X7`OY(rYZ&cZr(rrs&cs!^(r!^!_)r!_#O(r#O#P&c#P#W(r#W#X!Mn#X#Z(r#Z#[!Mn#[#](r#]#^!Mn#^#a(r#a#b!Mn#b#g(r#g#h!Mn#h#i(r#i#j!Mn#j#k!Mn#k#m(r#m#n!Mn#n#o(r#o#p)r#p;'S(r;'S;=`*a<%lO(r8Q# vZ(Wp!X7`OY# oZr# ors!@cs!P# o!P!Q#!i!Q!}# o!}#O#$R#O#P!Bq#P;'S# o;'S;=`#$y<%lO# o8Q#!pe(Wp!X7`OY)rZr)rs#O)r#P#W)r#W#X#!i#X#Z)r#Z#[#!i#[#])r#]#^#!i#^#a)r#a#b#!i#b#g)r#g#h#!i#h#i)r#i#j#!i#j#k#!i#k#m)r#m#n#!i#n;'S)r;'S;=`*Z<%lO)r8Q#$WX(WpOY#$RZr#$Rrs!Ars#O#$R#O#P!B[#P#Q# o#Q;'S#$R;'S;=`#$s<%lO#$R8Q#$vP;=`<%l#$R8Q#$|P;=`<%l# o=l#%W^$i&j(WpOY#%PYZ&cZr#%Prs!CWs!^#%P!^!_#$R!_#O#%P#O#P!DR#P#Q!Lc#Q#o#%P#o#p#$R#p;'S#%P;'S;=`#&S<%lO#%P=l#&VP;=`<%l#%P=l#&]P;=`<%l!Lc?O#&kn$i&j(Wp(Z!b!X7`OY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#W%Z#W#X#&`#X#Z%Z#Z#[#&`#[#]%Z#]#^#&`#^#a%Z#a#b#&`#b#g%Z#g#h#&`#h#i%Z#i#j#&`#j#k#&`#k#m%Z#m#n#&`#n#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z9d#(r](Wp(Z!b!X7`OY#(iZr#(irs!Grsw#(iwx# ox!P#(i!P!Q#)k!Q!}#(i!}#O#+`#O#P!Bq#P;'S#(i;'S;=`#,`<%lO#(i9d#)th(Wp(Z!b!X7`OY*gZr*grs'}sw*gwx)rx#O*g#P#W*g#W#X#)k#X#Z*g#Z#[#)k#[#]*g#]#^#)k#^#a*g#a#b#)k#b#g*g#g#h#)k#h#i*g#i#j#)k#j#k#)k#k#m*g#m#n#)k#n;'S*g;'S;=`+Z<%lO*g9d#+gZ(Wp(Z!bOY#+`Zr#+`rs!JUsw#+`wx#$Rx#O#+`#O#P!B[#P#Q#(i#Q;'S#+`;'S;=`#,Y<%lO#+`9d#,]P;=`<%l#+`9d#,cP;=`<%l#(i?O#,o`$i&j(Wp(Z!bOY#,fYZ&cZr#,frs!KSsw#,fwx#%Px!^#,f!^!_#+`!_#O#,f#O#P!DR#P#Q!;Z#Q#o#,f#o#p#+`#p;'S#,f;'S;=`#-q<%lO#,f?O#-tP;=`<%l#,f?O#-zP;=`<%l!;Z07[#.[b$i&j(Wp(Z!b(O0/l!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z07[#/o_$i&j(Wp(Z!bT0/lOY#/dYZ&cZr#/drs#0nsw#/dwx#4Ox!^#/d!^!_#5}!_#O#/d#O#P#1p#P#o#/d#o#p#5}#p;'S#/d;'S;=`#6|<%lO#/d06j#0w]$i&j(Z!bT0/lOY#0nYZ&cZw#0nwx#1px!^#0n!^!_#3R!_#O#0n#O#P#1p#P#o#0n#o#p#3R#p;'S#0n;'S;=`#3x<%lO#0n05W#1wX$i&jT0/lOY#1pYZ&cZ!^#1p!^!_#2d!_#o#1p#o#p#2d#p;'S#1p;'S;=`#2{<%lO#1p0/l#2iST0/lOY#2dZ;'S#2d;'S;=`#2u<%lO#2d0/l#2xP;=`<%l#2d05W#3OP;=`<%l#1p01O#3YW(Z!bT0/lOY#3RZw#3Rwx#2dx#O#3R#O#P#2d#P;'S#3R;'S;=`#3r<%lO#3R01O#3uP;=`<%l#3R06j#3{P;=`<%l#0n05x#4X]$i&j(WpT0/lOY#4OYZ&cZr#4Ors#1ps!^#4O!^!_#5Q!_#O#4O#O#P#1p#P#o#4O#o#p#5Q#p;'S#4O;'S;=`#5w<%lO#4O00^#5XW(WpT0/lOY#5QZr#5Qrs#2ds#O#5Q#O#P#2d#P;'S#5Q;'S;=`#5q<%lO#5Q00^#5tP;=`<%l#5Q05x#5zP;=`<%l#4O01p#6WY(Wp(Z!bT0/lOY#5}Zr#5}rs#3Rsw#5}wx#5Qx#O#5}#O#P#2d#P;'S#5};'S;=`#6v<%lO#5}01p#6yP;=`<%l#5}07[#7PP;=`<%l#/d)3h#7ab$i&j$Q(Ch(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;ZAt#8vb$Z#t$i&j(Wp(Z!b!X7`OY!;ZYZ&cZr!;Zrs!<nsw!;Zwx!Lcx!P!;Z!P!Q#&`!Q!^!;Z!^!_#(i!_!}!;Z!}#O#,f#O#P!Dy#P#o!;Z#o#p#(i#p;'S!;Z;'S;=`#-w<%lO!;Z'Ad#:Zp$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#U%Z#U#V#?i#V#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#d#Bq#d#l%Z#l#m#Es#m#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#<jk$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!O%Z!O!P!3Y!P!Q%Z!Q![#<_![!^%Z!^!_*g!_!g%Z!g!h!4|!h#O%Z#O#P&c#P#R%Z#R#S#<_#S#X%Z#X#Y!4|#Y#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#>j_$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#?rd$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#A]f$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!R#AQ!R!S#AQ!S!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#AQ#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Bzc$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Dbe$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q!Y#DV!Y!^%Z!^!_*g!_#O%Z#O#P&c#P#R%Z#R#S#DV#S#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#E|g$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z'Ad#Gpi$i&j(Wp(Z!bs'9tOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!Q%Z!Q![#Ge![!^%Z!^!_*g!_!c%Z!c!i#Ge!i#O%Z#O#P&c#P#R%Z#R#S#Ge#S#T%Z#T#Z#Ge#Z#b%Z#b#c#>_#c#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x#Il_!g$b$i&j$O)Lv(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z)[#Jv_al$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f#LS^h#)`#R-<U(Wp(Z!b$n7`OY*gZr*grs'}sw*gwx)rx!P*g!P!Q#MO!Q!^*g!^!_#Mt!_!`$ f!`#O*g#P;'S*g;'S;=`+Z<%lO*g(n#MXX$k&j(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El#M}Z#r(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx!_*g!_!`#Np!`#O*g#P;'S*g;'S;=`+Z<%lO*g(El#NyX$Q(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g(El$ oX#s(Ch(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g*)x$!ga#`*!Y$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`0z!`!a$#l!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(K[$#w_#k(Cl$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z*)x$%Vag!*r#s(Ch$f#|$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`$&[!`!a$'f!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$&g_#s(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$'qa#r(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`!a$(v!a#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$)R`#r(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(Kd$*`a(r(Ct$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!a%Z!a!b$+e!b#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$+p`$i&j#{(Ch(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z%#`$,}_!|$Ip$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z04f$.X_!S0,v$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(n$/]Z$i&jO!^$0O!^!_$0f!_#i$0O#i#j$0k#j#l$0O#l#m$2^#m#o$0O#o#p$0f#p;'S$0O;'S;=`$4i<%lO$0O(n$0VT_#S$i&jO!^&c!_#o&c#p;'S&c;'S;=`&w<%lO&c#S$0kO_#S(n$0p[$i&jO!Q&c!Q![$1f![!^&c!_!c&c!c!i$1f!i#T&c#T#Z$1f#Z#o&c#o#p$3|#p;'S&c;'S;=`&w<%lO&c(n$1kZ$i&jO!Q&c!Q![$2^![!^&c!_!c&c!c!i$2^!i#T&c#T#Z$2^#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$2cZ$i&jO!Q&c!Q![$3U![!^&c!_!c&c!c!i$3U!i#T&c#T#Z$3U#Z#o&c#p;'S&c;'S;=`&w<%lO&c(n$3ZZ$i&jO!Q&c!Q![$0O![!^&c!_!c&c!c!i$0O!i#T&c#T#Z$0O#Z#o&c#p;'S&c;'S;=`&w<%lO&c#S$4PR!Q![$4Y!c!i$4Y#T#Z$4Y#S$4]S!Q![$4Y!c!i$4Y#T#Z$4Y#q#r$0f(n$4lP;=`<%l$0O#1[$4z_!Y#)l$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z(KW$6U`#x(Ch$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z+;p$7c_$i&j(Wp(Z!b(a+4QOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$8qk$i&j(Wp(Z!b(T,2j$_#t(e$I[OY%ZYZ&cZr%Zrs&}st%Ztu$8buw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$8b![!^%Z!^!_*g!_!c%Z!c!}$8b!}#O%Z#O#P&c#P#R%Z#R#S$8b#S#T%Z#T#o$8b#o#p*g#p$g%Z$g;'S$8b;'S;=`$<l<%lO$8b+d$:qk$i&j(Wp(Z!b$_#tOY%ZYZ&cZr%Zrs&}st%Ztu$:fuw%Zwx(rx}%Z}!O$:f!O!Q%Z!Q![$:f![!^%Z!^!_*g!_!c%Z!c!}$:f!}#O%Z#O#P&c#P#R%Z#R#S$:f#S#T%Z#T#o$:f#o#p*g#p$g%Z$g;'S$:f;'S;=`$<f<%lO$:f+d$<iP;=`<%l$:f07[$<oP;=`<%l$8b#Jf$<{X!_#Hb(Wp(Z!bOY*gZr*grs'}sw*gwx)rx#O*g#P;'S*g;'S;=`+Z<%lO*g,#x$=sa(y+JY$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_!`Ka!`#O%Z#O#P&c#P#o%Z#o#p*g#p#q$+e#q;'S%Z;'S;=`+a<%lO%Z)>v$?V_!^(CdvBr$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z?O$@a_!q7`$i&j(Wp(Z!bOY%ZYZ&cZr%Zrs&}sw%Zwx(rx!^%Z!^!_*g!_#O%Z#O#P&c#P#o%Z#o#p*g#p;'S%Z;'S;=`+a<%lO%Z07[$Aq|$i&j(Wp(Z!b'|0/l$]#t(T,2j(e$I[OX%ZXY+gYZ&cZ[+g[p%Zpq+gqr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$f%Z$f$g+g$g#BYEr#BY#BZ$A`#BZ$ISEr$IS$I_$A`$I_$JTEr$JT$JU$A`$JU$KVEr$KV$KW$A`$KW&FUEr&FU&FV$A`&FV;'SEr;'S;=`I|<%l?HTEr?HT?HU$A`?HUOEr07[$D|k$i&j(Wp(Z!b'}0/l$]#t(T,2j(e$I[OY%ZYZ&cZr%Zrs&}st%ZtuEruw%Zwx(rx}%Z}!OGv!O!Q%Z!Q![Er![!^%Z!^!_*g!_!c%Z!c!}Er!}#O%Z#O#P&c#P#R%Z#R#SEr#S#T%Z#T#oEr#o#p*g#p$g%Z$g;'SEr;'S;=`I|<%lOEr",tokenizers:[Dk,Mk,Tk,_k,2,3,4,5,6,7,8,9,10,11,12,13,14,$k,new Ph("$S~RRtu[#O#Pg#S#T#|~_P#o#pb~gOx~~jVO#i!P#i#j!U#j#l!P#l#m!q#m;'S!P;'S;=`#v<%lO!P~!UO!U~~!XS!Q![!e!c!i!e#T#Z!e#o#p#Z~!hR!Q![!q!c!i!q#T#Z!q~!tR!Q![!}!c!i!}#T#Z!}~#QR!Q![!P!c!i!P#T#Z!P~#^R!Q![#g!c!i#g#T#Z#g~#jS!Q![#g!c!i#g#T#Z#g#q#r!P~#yP;=`<%l!P~$RO(c~~",141,340),new Ph("j~RQYZXz{^~^O(Q~~aP!P!Qd~iO(R~~",25,323)],topRules:{Script:[0,7],SingleExpression:[1,276],SingleClassItem:[2,277]},dialects:{jsx:0,ts:15175},dynamicPrecedences:{80:1,82:1,94:1,169:1,199:1},specialized:[{term:327,get:n=>Bk[n]||-1},{term:343,get:n=>Nk[n]||-1},{term:95,get:n=>Qk[n]||-1}],tokenPrec:15201});var Lu;const Mr=new at;function eO(n){return Be.define({combine:n?e=>e.concat(n):void 0})}const kd=new at;class Di{constructor(e,t,i=[],s=""){this.data=e,this.name=s,At.prototype.hasOwnProperty("tree")||Object.defineProperty(At.prototype,"tree",{get(){return pn(this)}}),this.parser=t,this.extension=[zs.of(this),At.languageData.of((r,a,o)=>{let l=jp(r,a,o),c=l.type.prop(Mr);if(!c)return[];let u=r.facet(c),h=l.type.prop(kd);if(h){let d=l.resolve(a-l.from,o);for(let f of h)if(f.test(d,r)){let m=r.facet(f.facet);return f.type=="replace"?m:m.concat(u)}}return u})].concat(i)}isActiveAt(e,t,i=-1){return jp(e,t,i).type.prop(Mr)==this.data}findRegions(e){let t=e.facet(zs);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],s=(r,a)=>{if(r.prop(Mr)==this.data){i.push({from:a,to:a+r.length});return}let o=r.prop(at.mounted);if(o){if(o.tree.prop(Mr)==this.data){if(o.overlay)for(let l of o.overlay)i.push({from:l.from+a,to:l.to+a});else i.push({from:a,to:a+r.length});return}else if(o.overlay){let l=i.length;if(s(o.tree,o.overlay[0].from+a),i.length>l)return}}for(let l=0;l<r.children.length;l++){let c=r.children[l];c instanceof an&&s(c,r.positions[l]+a)}};return s(pn(e),0),i}get allowsNesting(){return!0}}Di.setState=kt.define();function jp(n,e,t){let i=n.facet(zs),s=pn(n).topNode;if(!i||i.allowsNesting)for(let r=s;r;r=r.enter(e,t,un.ExcludeBuffers))r.type.isTop&&(s=r);return s}class hl extends Di{constructor(e,t,i){super(e,t,[],i),this.parser=t}static define(e){let t=eO(e.languageData);return new hl(t,e.parser.configure({props:[Mr.add(i=>i.isTop?t:void 0)]}),e.name)}configure(e,t){return new hl(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function pn(n){let e=n.field(Di.state,!1);return e?e.tree:an.empty}class Lk{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let ra=null;class dl{constructor(e,t,i=[],s,r,a,o,l){this.parser=e,this.state=t,this.fragments=i,this.tree=s,this.treeLen=r,this.viewport=a,this.skipped=o,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new dl(e,t,[],an.empty,0,i,[],null)}startParse(){return this.parser.startParse(new Lk(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=an.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let s=Date.now()+e;e=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(or.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(or.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=ra;ra=this;try{return e()}finally{ra=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=qp(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:s,treeLen:r,viewport:a,skipped:o}=this;if(this.takeTree(),!e.empty){let l=[];if(e.iterChangedRanges((c,u,h,d)=>l.push({fromA:c,toA:u,fromB:h,toB:d})),i=or.applyChanges(i,l),s=an.empty,r=0,a={from:e.mapPos(a.from,-1),to:e.mapPos(a.to,1)},this.skipped.length){o=[];for(let c of this.skipped){let u=e.mapPos(c.from,1),h=e.mapPos(c.to,-1);u<h&&o.push({from:u,to:h})}}}return new dl(this.parser,t,i,s,r,a,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:s,to:r}=this.skipped[i];s<e.to&&r>e.from&&(this.fragments=qp(this.fragments,s,r),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends X1{createParse(t,i,s){let r=s[0].from,a=s[s.length-1].to;return{parsedPos:r,advance(){let l=ra;if(l){for(let c of s)l.tempSkipped.push(c);e&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,e]):e)}return this.parsedPos=a,new an(Hn.none,[],[],a-r)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return ra}}function qp(n,e,t){return or.applyChanges(n,[{fromA:e,toA:t,fromB:e,toB:t}])}class Vr{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Vr(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=dl.create(e.facet(zs).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new Vr(i)}}Di.state=ri.define({create:Vr.init,update(n,e){for(let t of e.effects)if(t.is(Di.setState))return t.value;return e.startState.facet(zs)!=e.state.facet(zs)?Vr.init(e.state):n.apply(e)}});let tO=n=>{let e=setTimeout(()=>n(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(tO=n=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(n,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const Iu=typeof navigator<"u"&&(!((Lu=navigator.scheduling)===null||Lu===void 0)&&Lu.isInputPending)?()=>navigator.scheduling.isInputPending():null,Ik=ls.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(Di.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(Di.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=tO(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,r=i.field(Di.state);if(r.tree==r.context.tree&&r.context.isDone(s+1e5))return;let a=Date.now()+Math.min(this.chunkBudget,100,e&&!Iu?Math.max(25,e.timeRemaining()-5):1e9),o=r.context.treeLen<s&&i.doc.length>s+1e3,l=r.context.work(()=>Iu&&Iu()||Date.now()>a,s+(o?0:1e5));this.chunkBudget-=Date.now()-t,(l||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:Di.setState.of(new Vr(r.context))})),this.chunkBudget>0&&!(l&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Ki(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),zs=Be.define({combine(n){return n.length?n[0]:null},enables:n=>[Di.state,Ik,Fe.contentAttributes.compute([n],e=>{let t=e.facet(n);return t&&t.name?{"data-language":t.name}:{}})]});class Vk{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const zk=Be.define(),Il=Be.define({combine:n=>{if(!n.length)return"  ";let e=n[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(n[0]));return e}});function fl(n){let e=n.facet(Il);return e.charCodeAt(0)==9?n.tabSize*e.length:e.length}function pl(n,e){let t="",i=n.tabSize,s=n.facet(Il)[0];if(s=="	"){for(;e>=i;)t+="	",e-=i;s=" "}for(let r=0;r<e;r++)t+=s;return t}function nO(n,e){n instanceof At&&(n=new Vl(n));for(let i of n.state.facet(zk)){let s=i(n,e);if(s!==void 0)return s}let t=pn(n.state);return t.length>=e?Zk(n,t,e):null}class Vl{constructor(e,t={}){this.state=e,this.options=t,this.unit=fl(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:s,simulateDoubleBreak:r}=this.options;return s!=null&&s>=i.from&&s<=i.to?r&&s==e?{text:"",from:e}:(t<0?s<e:s<=e)?{text:i.text.slice(s-i.from),from:s}:{text:i.text.slice(0,s-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:s}=this.lineAt(e,t);return i.slice(e-s,Math.min(i.length,e+100-s))}column(e,t=1){let{text:i,from:s}=this.lineAt(e,t),r=this.countColumn(i,e-s),a=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return a>-1&&(r+=a-this.countColumn(i,i.search(/\S|$/))),r}countColumn(e,t=e.length){return Nl(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:s}=this.lineAt(e,t),r=this.options.overrideIndentation;if(r){let a=r(s);if(a>-1)return a}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const iO=new at;function Zk(n,e,t){let i=e.resolveStack(t),s=e.resolveInner(t,-1).resolve(t,0).enterUnfinishedNodesBefore(t);if(s!=i.node){let r=[];for(let a=s;a&&!(a.from<i.node.from||a.to>i.node.to||a.from==i.node.from&&a.type==i.node.type);a=a.parent)r.push(a);for(let a=r.length-1;a>=0;a--)i={node:r[a],next:i}}return sO(i,n,t)}function sO(n,e,t){for(let i=n;i;i=i.next){let s=qk(i.node);if(s)return s(Ed.create(e,t,i))}return 0}function jk(n){return n.pos==n.options.simulateBreak&&n.options.simulateDoubleBreak}function qk(n){let e=n.type.prop(iO);if(e)return e;let t=n.firstChild,i;if(t&&(i=t.type.prop(at.closedBy))){let s=n.lastChild,r=s&&i.indexOf(s.name)>-1;return a=>rO(a,!0,1,void 0,r&&!jk(a)?s.from:void 0)}return n.parent==null?Gk:null}function Gk(){return 0}class Ed extends Vl{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.context=i}get node(){return this.context.node}static create(e,t,i){return new Ed(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(Wk(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){return sO(this.context.next,this.base,this.pos)}}function Wk(n,e){for(let t=e;t;t=t.parent)if(n==t)return!0;return!1}function Xk(n){let e=n.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let s=n.options.simulateBreak,r=n.state.doc.lineAt(t.from),a=s==null||s<=r.from?r.to:Math.min(r.to,s);for(let o=t.to;;){let l=e.childAfter(o);if(!l||l==i)return null;if(!l.type.isSkipped){if(l.from>=a)return null;let c=/^ */.exec(r.text.slice(t.to-r.from))[0].length;return{from:t.from,to:t.to+c}}o=l.to}}function Uk({closing:n,align:e=!0,units:t=1}){return i=>rO(i,e,t,n)}function rO(n,e,t,i,s){let r=n.textAfter,a=r.match(/^\s*/)[0].length,o=i&&r.slice(a,a+i.length)==i||s==n.pos+a,l=e?Xk(n):null;return l?o?n.column(l.from):n.column(l.to):n.baseIndent+(o?0:n.unit*t)}const Yk=n=>n.baseIndent;function Vu({except:n,units:e=1}={}){return t=>{let i=n&&n.test(t.textAfter);return t.baseIndent+(i?0:e*t.unit)}}const Hk=Be.define(),aO=new at;function Kk(n){let e=n.firstChild,t=n.lastChild;return e&&e.to<t.from?{from:e.to,to:t.type.isError?n.to:t.from}:null}function Jk(n,e,t){let i=pn(n);if(i.length<t)return null;let s=i.resolveStack(t,1),r=null;for(let a=s;a;a=a.next){let o=a.node;if(o.to<=t||o.from>t)continue;if(r&&o.from<e)break;let l=o.type.prop(aO);if(l&&(o.to<i.length-50||i.length==n.doc.length||!eE(o))){let c=l(o,n);c&&c.from<=t&&c.from>=e&&c.to>t&&(r=c)}}return r}function eE(n){let e=n.lastChild;return e&&e.to==n.to&&e.type.isError}function ml(n,e,t){for(let i of n.facet(Hk)){let s=i(n,e,t);if(s)return s}return Jk(n,e,t)}function oO(n,e){let t=e.mapPos(n.from,1),i=e.mapPos(n.to,-1);return t>=i?void 0:{from:t,to:i}}const zl=kt.define({map:oO}),Ha=kt.define({map:oO});function lO(n){let e=[];for(let{head:t}of n.state.selection.ranges)e.some(i=>i.from<=t&&i.to>=t)||e.push(n.lineBlockAt(t));return e}const mr=ri.define({create(){return nt.none},update(n,e){e.isUserEvent("delete")&&e.changes.iterChangedRanges((t,i)=>n=Gp(n,t,i)),n=n.map(e.changes);for(let t of e.effects)if(t.is(zl)&&!tE(n,t.value.from,t.value.to)){let{preparePlaceholder:i}=e.state.facet(hO),s=i?nt.replace({widget:new lE(i(e.state,t.value))}):Wp;n=n.update({add:[s.range(t.value.from,t.value.to)]})}else t.is(Ha)&&(n=n.update({filter:(i,s)=>t.value.from!=i||t.value.to!=s,filterFrom:t.value.from,filterTo:t.value.to}));return e.selection&&(n=Gp(n,e.selection.main.head)),n},provide:n=>Fe.decorations.from(n),toJSON(n,e){let t=[];return n.between(0,e.doc.length,(i,s)=>{t.push(i,s)}),t},fromJSON(n){if(!Array.isArray(n)||n.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<n.length;){let i=n[t++],s=n[t++];if(typeof i!="number"||typeof s!="number")throw new RangeError("Invalid JSON for fold state");e.push(Wp.range(i,s))}return nt.set(e,!0)}});function Gp(n,e,t=e){let i=!1;return n.between(e,t,(s,r)=>{s<t&&r>e&&(i=!0)}),i?n.update({filterFrom:e,filterTo:t,filter:(s,r)=>s>=t||r<=e}):n}function gl(n,e,t){var i;let s=null;return(i=n.field(mr,!1))===null||i===void 0||i.between(e,t,(r,a)=>{(!s||s.from>r)&&(s={from:r,to:a})}),s}function tE(n,e,t){let i=!1;return n.between(e,e,(s,r)=>{s==e&&r==t&&(i=!0)}),i}function uO(n,e){return n.field(mr,!1)?e:e.concat(kt.appendConfig.of(dO()))}const nE=n=>{for(let e of lO(n)){let t=ml(n.state,e.from,e.to);if(t)return n.dispatch({effects:uO(n.state,[zl.of(t),cO(n,t)])}),!0}return!1},iE=n=>{if(!n.state.field(mr,!1))return!1;let e=[];for(let t of lO(n)){let i=gl(n.state,t.from,t.to);i&&e.push(Ha.of(i),cO(n,i,!1))}return e.length&&n.dispatch({effects:e}),e.length>0};function cO(n,e,t=!0){let i=n.state.doc.lineAt(e.from).number,s=n.state.doc.lineAt(e.to).number;return Fe.announce.of(`${n.state.phrase(t?"Folded lines":"Unfolded lines")} ${i} ${n.state.phrase("to")} ${s}.`)}const sE=n=>{let{state:e}=n,t=[];for(let i=0;i<e.doc.length;){let s=n.lineBlockAt(i),r=ml(e,s.from,s.to);r&&t.push(zl.of(r)),i=(r?n.lineBlockAt(r.to):s).to+1}return t.length&&n.dispatch({effects:uO(n.state,t)}),!!t.length},rE=n=>{let e=n.state.field(mr,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,n.state.doc.length,(i,s)=>{t.push(Ha.of({from:i,to:s}))}),n.dispatch({effects:t}),!0},aE=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:nE},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:iE},{key:"Ctrl-Alt-[",run:sE},{key:"Ctrl-Alt-]",run:rE}],oE={placeholderDOM:null,preparePlaceholder:null,placeholderText:"…"},hO=Be.define({combine(n){return Ga(n,oE)}});function dO(n){return[mr,hE]}function fO(n,e){let{state:t}=n,i=t.facet(hO),s=a=>{let o=n.lineBlockAt(n.posAtDOM(a.target)),l=gl(n.state,o.from,o.to);l&&n.dispatch({effects:Ha.of(l)}),a.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(n,s,e);let r=document.createElement("span");return r.textContent=i.placeholderText,r.setAttribute("aria-label",t.phrase("folded code")),r.title=t.phrase("unfold"),r.className="cm-foldPlaceholder",r.onclick=s,r}const Wp=nt.replace({widget:new class extends qr{toDOM(n){return fO(n,null)}}});class lE extends qr{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return fO(e,this.value)}}const uE={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class zu extends Is{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function cE(n={}){let e={...uE,...n},t=new zu(e,!0),i=new zu(e,!1),s=ls.fromClass(class{constructor(a){this.from=a.viewport.from,this.markers=this.buildMarkers(a)}update(a){(a.docChanged||a.viewportChanged||a.startState.facet(zs)!=a.state.facet(zs)||a.startState.field(mr,!1)!=a.state.field(mr,!1)||pn(a.startState)!=pn(a.state)||e.foldingChanged(a))&&(this.markers=this.buildMarkers(a.view))}buildMarkers(a){let o=new Qr;for(let l of a.viewportLineBlocks){let c=gl(a.state,l.from,l.to)?i:ml(a.state,l.from,l.to)?t:null;c&&o.add(l.from,l.from,c)}return o.finish()}}),{domEventHandlers:r}=e;return[s,DA({class:"cm-foldGutter",markers(a){var o;return((o=a.plugin(s))===null||o===void 0?void 0:o.markers)||vt.empty},initialSpacer(){return new zu(e,!1)},domEventHandlers:{...r,click:(a,o,l)=>{if(r.click&&r.click(a,o,l))return!0;let c=gl(a.state,o.from,o.to);if(c)return a.dispatch({effects:Ha.of(c)}),!0;let u=ml(a.state,o.from,o.to);return u?(a.dispatch({effects:zl.of(u)}),!0):!1}}}),dO()]}const hE=Fe.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class Zl{constructor(e,t){this.specs=e;let i;function s(o){let l=Qs.newName();return(i||(i=Object.create(null)))["."+l]=o,l}const r=typeof t.all=="string"?t.all:t.all?s(t.all):void 0,a=t.scope;this.scope=a instanceof Di?o=>o.prop(Mr)==a.data:a?o=>o==a:void 0,this.style=K1(e.map(o=>({tag:o.tag,class:o.class||s(Object.assign({},o,{tag:null}))})),{all:r}).style,this.module=i?new Qs(i):null,this.themeType=t.themeType}static define(e,t){return new Zl(e,t||{})}}const kh=Be.define(),dE=Be.define({combine(n){return n.length?[n[0]]:null}});function Zu(n){let e=n.facet(kh);return e.length?e:n.facet(dE)}function fE(n,e){let t=[mE],i;return n instanceof Zl&&(n.module&&t.push(Fe.styleModule.of(n.module)),i=n.themeType),i?t.push(kh.computeN([Fe.darkTheme],s=>s.facet(Fe.darkTheme)==(i=="dark")?[n]:[])):t.push(kh.of(n)),t}class pE{constructor(e){this.markCache=Object.create(null),this.tree=pn(e.state),this.decorations=this.buildDeco(e,Zu(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=pn(e.state),i=Zu(e.state),s=i!=Zu(e.startState),{viewport:r}=e.view,a=e.changes.mapPos(this.decoratedTo,1);t.length<r.to&&!s&&t.type==this.tree.type&&a>=r.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=a):(t!=this.tree||e.viewportChanged||s)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=r.to)}buildDeco(e,t){if(!t||!this.tree.length)return nt.none;let i=new Qr;for(let{from:s,to:r}of e.visibleRanges)rk(this.tree,t,(a,o,l)=>{i.add(a,o,this.markCache[l]||(this.markCache[l]=nt.mark({class:l})))},s,r);return i.finish()}}const mE=Fl.high(ls.fromClass(pE,{decorations:n=>n.decorations})),gE=Fe.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),pO=1e4,mO="()[]{}",gO=Be.define({combine(n){return Ga(n,{afterCursor:!0,brackets:mO,maxScanDistance:pO,renderMatch:bE})}}),OE=nt.mark({class:"cm-matchingBracket"}),yE=nt.mark({class:"cm-nonmatchingBracket"});function bE(n){let e=[],t=n.matched?OE:yE;return e.push(t.range(n.start.from,n.start.to)),n.end&&e.push(t.range(n.end.from,n.end.to)),e}const vE=ri.define({create(){return nt.none},update(n,e){if(!e.docChanged&&!e.selection)return n;let t=[],i=e.state.facet(gO);for(let s of e.state.selection.ranges){if(!s.empty)continue;let r=es(e.state,s.head,-1,i)||s.head>0&&es(e.state,s.head-1,1,i)||i.afterCursor&&(es(e.state,s.head,1,i)||s.head<e.state.doc.length&&es(e.state,s.head+1,-1,i));r&&(t=t.concat(i.renderMatch(r,e.state)))}return nt.set(t,!0)},provide:n=>Fe.decorations.from(n)}),SE=[vE,gE];function wE(n={}){return[gO.of(n),SE]}const PE=new at;function Eh(n,e,t){let i=n.prop(e<0?at.openedBy:at.closedBy);if(i)return i;if(n.name.length==1){let s=t.indexOf(n.name);if(s>-1&&s%2==(e<0?1:0))return[t[s+e]]}return null}function $h(n){let e=n.type.prop(PE);return e?e(n.node):n}function es(n,e,t,i={}){let s=i.maxScanDistance||pO,r=i.brackets||mO,a=pn(n),o=a.resolveInner(e,t);for(let l=o;l;l=l.parent){let c=Eh(l.type,t,r);if(c&&l.from<l.to){let u=$h(l);if(u&&(t>0?e>=u.from&&e<u.to:e>u.from&&e<=u.to))return xE(n,e,t,l,u,c,r)}}return CE(n,e,t,a,o.type,s,r)}function xE(n,e,t,i,s,r,a){let o=i.parent,l={from:s.from,to:s.to},c=0,u=o==null?void 0:o.cursor();if(u&&(t<0?u.childBefore(i.from):u.childAfter(i.to)))do if(t<0?u.to<=i.from:u.from>=i.to){if(c==0&&r.indexOf(u.type.name)>-1&&u.from<u.to){let h=$h(u);return{start:l,end:h?{from:h.from,to:h.to}:void 0,matched:!0}}else if(Eh(u.type,t,a))c++;else if(Eh(u.type,-t,a)){if(c==0){let h=$h(u);return{start:l,end:h&&h.from<h.to?{from:h.from,to:h.to}:void 0,matched:!1}}c--}}while(t<0?u.prevSibling():u.nextSibling());return{start:l,matched:!1}}function CE(n,e,t,i,s,r,a){let o=t<0?n.sliceDoc(e-1,e):n.sliceDoc(e,e+1),l=a.indexOf(o);if(l<0||l%2==0!=t>0)return null;let c={from:t<0?e-1:e,to:t>0?e+1:e},u=n.doc.iterRange(e,t>0?n.doc.length:0),h=0;for(let d=0;!u.next().done&&d<=r;){let f=u.value;t<0&&(d+=f.length);let m=e+d*t;for(let g=t>0?0:f.length-1,y=t>0?f.length:-1;g!=y;g+=t){let b=a.indexOf(f[g]);if(!(b<0||i.resolveInner(m+g,1).type!=s))if(b%2==0==t>0)h++;else{if(h==1)return{start:c,end:{from:m+g,to:m+g+1},matched:b>>1==l>>1};h--}}t>0&&(d+=f.length)}return u.done?{start:c,matched:!1}:null}const AE=Object.create(null),Xp=[Hn.none],Up=[],Yp=Object.create(null),kE=Object.create(null);for(let[n,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])kE[n]=EE(AE,e);function ju(n,e){Up.indexOf(n)>-1||(Up.push(n),console.warn(e))}function EE(n,e){let t=[];for(let o of e.split(" ")){let l=[];for(let c of o.split(".")){let u=n[c]||j[c];u?typeof u=="function"?l.length?l=l.map(u):ju(c,`Modifier ${c} used at start of tag`):l.length?ju(c,`Tag ${c} used as modifier`):l=Array.isArray(u)?u:[u]:ju(c,`Unknown highlighting tag ${c}`)}for(let c of l)t.push(c)}if(!t.length)return 0;let i=e.replace(/ /g,"_"),s=i+" "+t.map(o=>o.id),r=Yp[s];if(r)return r.id;let a=Yp[s]=Hn.define({id:Xp.length,name:i,props:[Y1({[i]:t})]});return Xp.push(a),a.id}cn.RTL,cn.LTR;function Hp(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function $E(n){let e=Object.create(null),t=Object.create(null);for(let{label:s}of n){e[s[0]]=!0;for(let r=1;r<s.length;r++)t[s[r]]=!0}let i=Hp(e)+Hp(t)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function DE(n){let e=n.map(s=>typeof s=="string"?{label:s}:s),[t,i]=e.every(s=>/^\w+$/.test(s.label))?[/\w*$/,/\w+$/]:$E(e);return s=>{let r=s.matchBefore(i);return r||s.explicit?{from:r?r.from:s.pos,options:e,validFor:t}:null}}function ME(n,e){return t=>{for(let i=pn(t.state).resolveInner(t.pos,-1);i;i=i.parent){if(n.indexOf(i.name)>-1)return null;if(i.type.isTop)break}return e(t)}}const TE=Ss.define(),_E=Fe.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box",whiteSpace:"pre-line"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});class FE{constructor(e,t,i,s){this.field=e,this.line=t,this.from=i,this.to=s}}class $d{constructor(e,t,i){this.field=e,this.from=t,this.to=i}map(e){let t=e.mapPos(this.from,-1,En.TrackDel),i=e.mapPos(this.to,1,En.TrackDel);return t==null||i==null?null:new $d(this.field,t,i)}}class Dd{constructor(e,t){this.lines=e,this.fieldPositions=t}instantiate(e,t){let i=[],s=[t],r=e.doc.lineAt(t),a=/^\s*/.exec(r.text)[0];for(let l of this.lines){if(i.length){let c=a,u=/^\t*/.exec(l)[0].length;for(let h=0;h<u;h++)c+=e.facet(Il);s.push(t+c.length-u),l=c+l.slice(u)}i.push(l),t+=l.length+1}let o=this.fieldPositions.map(l=>new $d(l.field,s[l.line]+l.from,s[l.line]+l.to));return{text:i,ranges:o}}static parse(e){let t=[],i=[],s=[],r;for(let a of e.split(/\r\n?|\n/)){for(;r=/[#$]\{(?:(\d+)(?::([^{}]*))?|((?:\\[{}]|[^{}])*))\}/.exec(a);){let o=r[1]?+r[1]:null,l=r[2]||r[3]||"",c=-1,u=l.replace(/\\[{}]/g,h=>h[1]);for(let h=0;h<t.length;h++)(o!=null?t[h].seq==o:u&&t[h].name==u)&&(c=h);if(c<0){let h=0;for(;h<t.length&&(o==null||t[h].seq!=null&&t[h].seq<o);)h++;t.splice(h,0,{seq:o,name:u}),c=h;for(let d of s)d.field>=c&&d.field++}for(let h of s)if(h.line==i.length&&h.from>r.index){let d=r[2]?3+(r[1]||"").length:2;h.from-=d,h.to-=d}s.push(new FE(c,i.length,r.index,r.index+u.length)),a=a.slice(0,r.index)+l+a.slice(r.index+r[0].length)}a=a.replace(/\\([{}])/g,(o,l,c)=>{for(let u of s)u.line==i.length&&u.from>c&&(u.from--,u.to--);return l}),i.push(a)}return new Dd(i,s)}}let BE=nt.widget({widget:new class extends qr{toDOM(){let n=document.createElement("span");return n.className="cm-snippetFieldPosition",n}ignoreEvent(){return!1}}}),NE=nt.mark({class:"cm-snippetField"});class Gr{constructor(e,t){this.ranges=e,this.active=t,this.deco=nt.set(e.map(i=>(i.from==i.to?BE:NE).range(i.from,i.to)),!0)}map(e){let t=[];for(let i of this.ranges){let s=i.map(e);if(!s)return null;t.push(s)}return new Gr(t,this.active)}selectionInsideField(e){return e.ranges.every(t=>this.ranges.some(i=>i.field==this.active&&i.from<=t.from&&i.to>=t.to))}}const Ka=kt.define({map(n,e){return n&&n.map(e)}}),QE=kt.define(),La=ri.define({create(){return null},update(n,e){for(let t of e.effects){if(t.is(Ka))return t.value;if(t.is(QE)&&n)return new Gr(n.ranges,t.value)}return n&&e.docChanged&&(n=n.map(e.changes)),n&&e.selection&&!n.selectionInsideField(e.selection)&&(n=null),n},provide:n=>Fe.decorations.from(n,e=>e?e.deco:nt.none)});function Md(n,e){return le.create(n.filter(t=>t.field==e).map(t=>le.range(t.from,t.to)))}function RE(n){let e=Dd.parse(n);return(t,i,s,r)=>{let{text:a,ranges:o}=e.instantiate(t.state,s),{main:l}=t.state.selection,c={changes:{from:s,to:r==l.from?l.to:r,insert:pt.of(a)},scrollIntoView:!0,annotations:i?[TE.of(i),rn.userEvent.of("input.complete")]:void 0};if(o.length&&(c.selection=Md(o,0)),o.some(u=>u.field>0)){let u=new Gr(o,0),h=c.effects=[Ka.of(u)];t.state.field(La,!1)===void 0&&h.push(kt.appendConfig.of([La,ZE,jE,_E]))}t.dispatch(t.state.update(c))}}function OO(n){return({state:e,dispatch:t})=>{let i=e.field(La,!1);if(!i||n<0&&i.active==0)return!1;let s=i.active+n,r=n>0&&!i.ranges.some(a=>a.field==s+n);return t(e.update({selection:Md(i.ranges,s),effects:Ka.of(r?null:new Gr(i.ranges,s)),scrollIntoView:!0})),!0}}const LE=({state:n,dispatch:e})=>n.field(La,!1)?(e(n.update({effects:Ka.of(null)})),!0):!1,IE=OO(1),VE=OO(-1),zE=[{key:"Tab",run:IE,shift:VE},{key:"Escape",run:LE}],Kp=Be.define({combine(n){return n.length?n[0]:zE}}),ZE=Fl.highest(wd.compute([Kp],n=>n.facet(Kp)));function qn(n,e){return{...e,apply:RE(n)}}const jE=Fe.domEventHandlers({mousedown(n,e){let t=e.state.field(La,!1),i;if(!t||(i=e.posAtCoords({x:n.clientX,y:n.clientY}))==null)return!1;let s=t.ranges.find(r=>r.from<=i&&r.to>=i);return!s||s.field==t.active?!1:(e.dispatch({selection:Md(t.ranges,s.field),effects:Ka.of(t.ranges.some(r=>r.field>s.field)?new Gr(t.ranges,s.field):null),scrollIntoView:!0}),!0)}}),Ia={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},ir=kt.define({map(n,e){let t=e.mapPos(n,-1,En.TrackAfter);return t??void 0}}),Td=new class extends hr{};Td.startSide=1;Td.endSide=-1;const yO=ri.define({create(){return vt.empty},update(n,e){if(n=n.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);n=n.update({filter:i=>i>=t.from&&i<=t.to})}for(let t of e.effects)t.is(ir)&&(n=n.update({add:[Td.range(t.value,t.value+1)]}));return n}});function qE(){return[WE,yO]}const qu="()[]{}<>«»»«［］｛｝";function bO(n){for(let e=0;e<qu.length;e+=2)if(qu.charCodeAt(e)==n)return qu.charAt(e+1);return M0(n<128?n:n+1)}function vO(n,e){return n.languageDataAt("closeBrackets",e)[0]||Ia}const GE=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),WE=Fe.inputHandler.of((n,e,t,i)=>{if((GE?n.composing:n.compositionStarted)||n.state.readOnly)return!1;let s=n.state.selection.main;if(i.length>2||i.length==2&&qa(Or(i,0))==1||e!=s.from||t!=s.to)return!1;let r=YE(n.state,i);return r?(n.dispatch(r),!0):!1}),XE=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let i=vO(n,n.selection.main.head).brackets||Ia.brackets,s=null,r=n.changeByRange(a=>{if(a.empty){let o=HE(n.doc,a.head);for(let l of i)if(l==o&&jl(n.doc,a.head)==bO(Or(l,0)))return{changes:{from:a.head-l.length,to:a.head+l.length},range:le.cursor(a.head-l.length)}}return{range:s=a}});return s||e(n.update(r,{scrollIntoView:!0,userEvent:"delete.backward"})),!s},UE=[{key:"Backspace",run:XE}];function YE(n,e){let t=vO(n,n.selection.main.head),i=t.brackets||Ia.brackets;for(let s of i){let r=bO(Or(s,0));if(e==s)return r==s?e2(n,s,i.indexOf(s+s+s)>-1,t):KE(n,s,r,t.before||Ia.before);if(e==r&&SO(n,n.selection.main.from))return JE(n,s,r)}return null}function SO(n,e){let t=!1;return n.field(yO).between(0,n.doc.length,i=>{i==e&&(t=!0)}),t}function jl(n,e){let t=n.sliceString(e,e+2);return t.slice(0,qa(Or(t,0)))}function HE(n,e){let t=n.sliceString(e-2,e);return qa(Or(t,0))==t.length?t:t.slice(1)}function KE(n,e,t,i){let s=null,r=n.changeByRange(a=>{if(!a.empty)return{changes:[{insert:e,from:a.from},{insert:t,from:a.to}],effects:ir.of(a.to+e.length),range:le.range(a.anchor+e.length,a.head+e.length)};let o=jl(n.doc,a.head);return!o||/\s/.test(o)||i.indexOf(o)>-1?{changes:{insert:e+t,from:a.head},effects:ir.of(a.head+e.length),range:le.cursor(a.head+e.length)}:{range:s=a}});return s?null:n.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function JE(n,e,t){let i=null,s=n.changeByRange(r=>r.empty&&jl(n.doc,r.head)==t?{changes:{from:r.head,to:r.head+t.length,insert:t},range:le.cursor(r.head+t.length)}:i={range:r});return i?null:n.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function e2(n,e,t,i){let s=i.stringPrefixes||Ia.stringPrefixes,r=null,a=n.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:e,from:o.to}],effects:ir.of(o.to+e.length),range:le.range(o.anchor+e.length,o.head+e.length)};let l=o.head,c=jl(n.doc,l),u;if(c==e){if(Jp(n,l))return{changes:{insert:e+e,from:l},effects:ir.of(l+e.length),range:le.cursor(l+e.length)};if(SO(n,l)){let d=t&&n.sliceDoc(l,l+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:l,to:l+d.length,insert:d},range:le.cursor(l+d.length)}}}else{if(t&&n.sliceDoc(l-2*e.length,l)==e+e&&(u=em(n,l-2*e.length,s))>-1&&Jp(n,u))return{changes:{insert:e+e+e+e,from:l},effects:ir.of(l+e.length),range:le.cursor(l+e.length)};if(n.charCategorizer(l)(c)!=Dn.Word&&em(n,l,s)>-1&&!t2(n,l,e,s))return{changes:{insert:e+e,from:l},effects:ir.of(l+e.length),range:le.cursor(l+e.length)}}return{range:r=o}});return r?null:n.update(a,{scrollIntoView:!0,userEvent:"input.type"})}function Jp(n,e){let t=pn(n).resolveInner(e+1);return t.parent&&t.from==e}function t2(n,e,t,i){let s=pn(n).resolveInner(e,-1),r=i.reduce((a,o)=>Math.max(a,o.length),0);for(let a=0;a<5;a++){let o=n.sliceDoc(s.from,Math.min(s.to,s.from+t.length+r)),l=o.indexOf(t);if(!l||l>-1&&i.indexOf(o.slice(0,l))>-1){let u=s.firstChild;for(;u&&u.from==s.from&&u.to-u.from>t.length+l;){if(n.sliceDoc(u.to-t.length,u.to)==t)return!1;u=u.firstChild}return!0}let c=s.to==e&&s.parent;if(!c)break;s=c}return!1}function em(n,e,t){let i=n.charCategorizer(e);if(i(n.sliceDoc(e-1,e))!=Dn.Word)return e;for(let s of t){let r=e-s.length;if(n.sliceDoc(r,e)==s&&i(n.sliceDoc(r-1,r))!=Dn.Word)return r}return-1}const wO=[qn("function ${name}(${params}) {\n	${}\n}",{label:"function",detail:"definition",type:"keyword"}),qn("for (let ${index} = 0; ${index} < ${bound}; ${index}++) {\n	${}\n}",{label:"for",detail:"loop",type:"keyword"}),qn("for (let ${name} of ${collection}) {\n	${}\n}",{label:"for",detail:"of loop",type:"keyword"}),qn("do {\n	${}\n} while (${})",{label:"do",detail:"loop",type:"keyword"}),qn("while (${}) {\n	${}\n}",{label:"while",detail:"loop",type:"keyword"}),qn(`try {
	\${}
} catch (\${error}) {
	\${}
}`,{label:"try",detail:"/ catch block",type:"keyword"}),qn("if (${}) {\n	${}\n}",{label:"if",detail:"block",type:"keyword"}),qn(`if (\${}) {
	\${}
} else {
	\${}
}`,{label:"if",detail:"/ else block",type:"keyword"}),qn(`class \${name} {
	constructor(\${params}) {
		\${}
	}
}`,{label:"class",detail:"definition",type:"keyword"}),qn('import {${names}} from "${module}"\n${}',{label:"import",detail:"named",type:"keyword"}),qn('import ${name} from "${module}"\n${}',{label:"import",detail:"default",type:"keyword"})],n2=wO.concat([qn("interface ${name} {\n	${}\n}",{label:"interface",detail:"definition",type:"keyword"}),qn("type ${name} = ${type}",{label:"type",detail:"definition",type:"keyword"}),qn("enum ${name} {\n	${}\n}",{label:"enum",detail:"definition",type:"keyword"})]),tm=new ZA,PO=new Set(["Script","Block","FunctionExpression","FunctionDeclaration","ArrowFunction","MethodDeclaration","ForStatement"]);function aa(n){return(e,t)=>{let i=e.node.getChild("VariableDefinition");return i&&t(i,n),!0}}const i2=["FunctionDeclaration"],s2={FunctionDeclaration:aa("function"),ClassDeclaration:aa("class"),ClassExpression:()=>!0,EnumDeclaration:aa("constant"),TypeAliasDeclaration:aa("type"),NamespaceDeclaration:aa("namespace"),VariableDefinition(n,e){n.matchContext(i2)||e(n,"variable")},TypeDefinition(n,e){e(n,"type")},__proto__:null};function xO(n,e){let t=tm.get(e);if(t)return t;let i=[],s=!0;function r(a,o){let l=n.sliceString(a.from,a.to);i.push({label:l,type:o})}return e.cursor(un.IncludeAnonymous).iterate(a=>{if(s)s=!1;else if(a.name){let o=s2[a.name];if(o&&o(a,r)||PO.has(a.name))return!1}else if(a.to-a.from>8192){for(let o of xO(n,a.node))i.push(o);return!1}}),tm.set(e,i),i}const nm=/^[\w$\xa1-\uffff][\w$\d\xa1-\uffff]*$/,CO=["TemplateString","String","RegExp","LineComment","BlockComment","VariableDefinition","TypeDefinition","Label","PropertyDefinition","PropertyName","PrivatePropertyDefinition","PrivatePropertyName","JSXText","JSXAttributeValue","JSXOpenTag","JSXCloseTag","JSXSelfClosingTag",".","?."];function r2(n){let e=pn(n.state).resolveInner(n.pos,-1);if(CO.indexOf(e.name)>-1)return null;let t=e.name=="VariableName"||e.to-e.from<20&&nm.test(n.state.sliceDoc(e.from,e.to));if(!t&&!n.explicit)return null;let i=[];for(let s=e;s;s=s.parent)PO.has(s.name)&&(i=i.concat(xO(n.state.doc,s)));return{options:i,from:t?e.from:n.pos,validFor:nm}}const lr=hl.define({name:"javascript",parser:Rk.configure({props:[iO.add({IfStatement:Vu({except:/^\s*({|else\b)/}),TryStatement:Vu({except:/^\s*({|catch\b|finally\b)/}),LabeledStatement:Yk,SwitchBody:n=>{let e=n.textAfter,t=/^\s*\}/.test(e),i=/^\s*(case|default)\b/.test(e);return n.baseIndent+(t?0:i?1:2)*n.unit},Block:Uk({closing:"}"}),ArrowFunction:n=>n.baseIndent+n.unit,"TemplateString BlockComment":()=>null,"Statement Property":Vu({except:/^\s*{/}),JSXElement(n){let e=/^\s*<\//.test(n.textAfter);return n.lineIndent(n.node.from)+(e?0:n.unit)},JSXEscape(n){let e=/\s*\}/.test(n.textAfter);return n.lineIndent(n.node.from)+(e?0:n.unit)},"JSXOpenTag JSXSelfClosingTag"(n){return n.column(n.node.from)+n.unit}}),aO.add({"Block ClassBody SwitchBody EnumBody ObjectExpression ArrayExpression ObjectType":Kk,BlockComment(n){return{from:n.from+2,to:n.to-2}}})]}),languageData:{closeBrackets:{brackets:["(","[","{","'",'"',"`"]},commentTokens:{line:"//",block:{open:"/*",close:"*/"}},indentOnInput:/^\s*(?:case |default:|\{|\}|<\/)$/,wordChars:"$"}}),AO={test:n=>/^JSX/.test(n.name),facet:eO({commentTokens:{block:{open:"{/*",close:"*/}"}}})},a2=lr.configure({dialect:"ts"},"typescript"),o2=lr.configure({dialect:"jsx",props:[kd.add(n=>n.isTop?[AO]:void 0)]}),l2=lr.configure({dialect:"jsx ts",props:[kd.add(n=>n.isTop?[AO]:void 0)]},"typescript");let kO=n=>({label:n,type:"keyword"});const EO="break case const continue default delete export extends false finally in instanceof let new return static super switch this throw true typeof var yield".split(" ").map(kO),u2=EO.concat(["declare","implements","private","protected","public"].map(kO));function c2(n={}){let e=n.jsx?n.typescript?l2:o2:n.typescript?a2:lr,t=n.typescript?n2.concat(u2):wO.concat(EO);return new Vk(e,[lr.data.of({autocomplete:ME(CO,DE(t))}),lr.data.of({autocomplete:r2}),n.jsx?f2:[]])}function h2(n){for(;;){if(n.name=="JSXOpenTag"||n.name=="JSXSelfClosingTag"||n.name=="JSXFragmentTag")return n;if(n.name=="JSXEscape"||!n.parent)return null;n=n.parent}}function im(n,e,t=n.length){for(let i=e==null?void 0:e.firstChild;i;i=i.nextSibling)if(i.name=="JSXIdentifier"||i.name=="JSXBuiltin"||i.name=="JSXNamespacedName"||i.name=="JSXMemberExpression")return n.sliceString(i.from,Math.min(i.to,t));return""}const d2=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),f2=Fe.inputHandler.of((n,e,t,i,s)=>{if((d2?n.composing:n.compositionStarted)||n.state.readOnly||e!=t||i!=">"&&i!="/"||!lr.isActiveAt(n.state,e,-1))return!1;let r=s(),{state:a}=r,o=a.changeByRange(l=>{var c;let{head:u}=l,h=pn(a).resolveInner(u-1,-1),d;if(h.name=="JSXStartTag"&&(h=h.parent),!(a.doc.sliceString(u-1,u)!=i||h.name=="JSXAttributeValue"&&h.to>u)){if(i==">"&&h.name=="JSXFragmentTag")return{range:l,changes:{from:u,insert:"</>"}};if(i=="/"&&h.name=="JSXStartCloseTag"){let f=h.parent,m=f.parent;if(m&&f.from==u-2&&((d=im(a.doc,m.firstChild,u))||((c=m.firstChild)===null||c===void 0?void 0:c.name)=="JSXFragmentTag")){let g=`${d}>`;return{range:le.cursor(u+g.length,-1),changes:{from:u,insert:g}}}}else if(i==">"){let f=h2(h);if(f&&f.name=="JSXOpenTag"&&!/^\/?>|^<\//.test(a.doc.sliceString(u,u+2))&&(d=im(a.doc,f,u)))return{range:l,changes:{from:u,insert:`</${d}>`}}}}return{range:l}});return o.changes.empty?!1:(n.dispatch([r,a.update(o,{userEvent:"input.complete",scrollIntoView:!0})]),!0)}),p2="#e5c07b",sm="#e06c75",m2="#56b6c2",g2="#ffffff",Wo="#abb2bf",Dh="#7d8799",O2="#61afef",y2="#98c379",rm="#d19a66",b2="#c678dd",v2="#21252b",am="#2c313a",om="#282c34",Gu="#353a42",S2="#3E4451",lm="#528bff",w2=Fe.theme({"&":{color:Wo,backgroundColor:om},".cm-content":{caretColor:lm},".cm-cursor, .cm-dropCursor":{borderLeftColor:lm},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:S2},".cm-panels":{backgroundColor:v2,color:Wo},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:om,color:Dh,border:"none"},".cm-activeLineGutter":{backgroundColor:am},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:Gu},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Gu,borderBottomColor:Gu},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:am,color:Wo}}},{dark:!0}),P2=Zl.define([{tag:j.keyword,color:b2},{tag:[j.name,j.deleted,j.character,j.propertyName,j.macroName],color:sm},{tag:[j.function(j.variableName),j.labelName],color:O2},{tag:[j.color,j.constant(j.name),j.standard(j.name)],color:rm},{tag:[j.definition(j.name),j.separator],color:Wo},{tag:[j.typeName,j.className,j.number,j.changed,j.annotation,j.modifier,j.self,j.namespace],color:p2},{tag:[j.operator,j.operatorKeyword,j.url,j.escape,j.regexp,j.link,j.special(j.string)],color:m2},{tag:[j.meta,j.comment],color:Dh},{tag:j.strong,fontWeight:"bold"},{tag:j.emphasis,fontStyle:"italic"},{tag:j.strikethrough,textDecoration:"line-through"},{tag:j.link,color:Dh,textDecoration:"underline"},{tag:j.heading,fontWeight:"bold",color:sm},{tag:[j.atom,j.bool,j.special(j.variableName)],color:rm},{tag:[j.processingInstruction,j.string,j.inserted],color:y2},{tag:j.invalid,color:g2}]),x2=[w2,fE(P2)],C2=n=>{let{state:e}=n,t=e.doc.lineAt(e.selection.main.from),i=Fd(n.state,t.from);return i.line?A2(n):i.block?E2(n):!1};function _d(n,e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let s=n(e,t);return s?(i(t.update(s)),!0):!1}}const A2=_d(M2,0),k2=_d($O,0),E2=_d((n,e)=>$O(n,e,D2(e)),0);function Fd(n,e){let t=n.languageDataAt("commentTokens",e,1);return t.length?t[0]:{}}const oa=50;function $2(n,{open:e,close:t},i,s){let r=n.sliceDoc(i-oa,i),a=n.sliceDoc(s,s+oa),o=/\s*$/.exec(r)[0].length,l=/^\s*/.exec(a)[0].length,c=r.length-o;if(r.slice(c-e.length,c)==e&&a.slice(l,l+t.length)==t)return{open:{pos:i-o,margin:o&&1},close:{pos:s+l,margin:l&&1}};let u,h;s-i<=2*oa?u=h=n.sliceDoc(i,s):(u=n.sliceDoc(i,i+oa),h=n.sliceDoc(s-oa,s));let d=/^\s*/.exec(u)[0].length,f=/\s*$/.exec(h)[0].length,m=h.length-f-t.length;return u.slice(d,d+e.length)==e&&h.slice(m,m+t.length)==t?{open:{pos:i+d+e.length,margin:/\s/.test(u.charAt(d+e.length))?1:0},close:{pos:s-f-t.length,margin:/\s/.test(h.charAt(m-1))?1:0}}:null}function D2(n){let e=[];for(let t of n.selection.ranges){let i=n.doc.lineAt(t.from),s=t.to<=i.to?i:n.doc.lineAt(t.to);s.from>i.from&&s.from==t.to&&(s=t.to==i.to+1?i:n.doc.lineAt(t.to-1));let r=e.length-1;r>=0&&e[r].to>i.from?e[r].to=s.to:e.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:s.to})}return e}function $O(n,e,t=e.selection.ranges){let i=t.map(r=>Fd(e,r.from).block);if(!i.every(r=>r))return null;let s=t.map((r,a)=>$2(e,i[a],r.from,r.to));if(n!=2&&!s.every(r=>r))return{changes:e.changes(t.map((r,a)=>s[a]?[]:[{from:r.from,insert:i[a].open+" "},{from:r.to,insert:" "+i[a].close}]))};if(n!=1&&s.some(r=>r)){let r=[];for(let a=0,o;a<s.length;a++)if(o=s[a]){let l=i[a],{open:c,close:u}=o;r.push({from:c.pos-l.open.length,to:c.pos+c.margin},{from:u.pos-u.margin,to:u.pos+l.close.length})}return{changes:r}}return null}function M2(n,e,t=e.selection.ranges){let i=[],s=-1;for(let{from:r,to:a}of t){let o=i.length,l=1e9,c=Fd(e,r).line;if(c){for(let u=r;u<=a;){let h=e.doc.lineAt(u);if(h.from>s&&(r==a||a>h.from)){s=h.from;let d=/^\s*/.exec(h.text)[0].length,f=d==h.length,m=h.text.slice(d,d+c.length)==c?d:-1;d<h.text.length&&d<l&&(l=d),i.push({line:h,comment:m,token:c,indent:d,empty:f,single:!1})}u=h.to+1}if(l<1e9)for(let u=o;u<i.length;u++)i[u].indent<i[u].line.text.length&&(i[u].indent=l);i.length==o+1&&(i[o].single=!0)}}if(n!=2&&i.some(r=>r.comment<0&&(!r.empty||r.single))){let r=[];for(let{line:o,token:l,indent:c,empty:u,single:h}of i)(h||!u)&&r.push({from:o.from+c,insert:l+" "});let a=e.changes(r);return{changes:a,selection:e.selection.map(a,1)}}else if(n!=1&&i.some(r=>r.comment>=0)){let r=[];for(let{line:a,comment:o,token:l}of i)if(o>=0){let c=a.from+o,u=c+l.length;a.text[u-a.from]==" "&&u++,r.push({from:c,to:u})}return{changes:r}}return null}const Mh=Ss.define(),T2=Ss.define(),_2=Be.define(),DO=Be.define({combine(n){return Ga(n,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,s)=>e(i,s)||t(i,s)})}}),MO=ri.define({create(){return ts.empty},update(n,e){let t=e.state.facet(DO),i=e.annotation(Mh);if(i){let l=Un.fromTransaction(e,i.selection),c=i.side,u=c==0?n.undone:n.done;return l?u=Ol(u,u.length,t.minDepth,l):u=FO(u,e.startState.selection),new ts(c==0?i.rest:u,c==0?u:i.rest)}let s=e.annotation(T2);if((s=="full"||s=="before")&&(n=n.isolate()),e.annotation(rn.addToHistory)===!1)return e.changes.empty?n:n.addMapping(e.changes.desc);let r=Un.fromTransaction(e),a=e.annotation(rn.time),o=e.annotation(rn.userEvent);return r?n=n.addChanges(r,a,o,t,e):e.selection&&(n=n.addSelection(e.startState.selection,a,o,t.newGroupDelay)),(s=="full"||s=="after")&&(n=n.isolate()),n},toJSON(n){return{done:n.done.map(e=>e.toJSON()),undone:n.undone.map(e=>e.toJSON())}},fromJSON(n){return new ts(n.done.map(Un.fromJSON),n.undone.map(Un.fromJSON))}});function F2(n={}){return[MO,DO.of(n),Fe.domEventHandlers({beforeinput(e,t){let i=e.inputType=="historyUndo"?TO:e.inputType=="historyRedo"?Th:null;return i?(e.preventDefault(),i(t)):!1}})]}function ql(n,e){return function({state:t,dispatch:i}){if(!e&&t.readOnly)return!1;let s=t.field(MO,!1);if(!s)return!1;let r=s.pop(n,t,e);return r?(i(r),!0):!1}}const TO=ql(0,!1),Th=ql(1,!1),B2=ql(0,!0),N2=ql(1,!0);class Un{constructor(e,t,i,s,r){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=s,this.selectionsAfter=r}setSelAfter(e){return new Un(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(s=>s.toJSON())}}static fromJSON(e){return new Un(e.changes&&ln.fromJSON(e.changes),[],e.mapped&&is.fromJSON(e.mapped),e.startSelection&&le.fromJSON(e.startSelection),e.selectionsAfter.map(le.fromJSON))}static fromTransaction(e,t){let i=mi;for(let s of e.startState.facet(_2)){let r=s(e);r.length&&(i=i.concat(r))}return!i.length&&e.changes.empty?null:new Un(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,mi)}static selection(e){return new Un(void 0,mi,void 0,void 0,e)}}function Ol(n,e,t,i){let s=e+1>t+20?e-t-1:0,r=n.slice(s,e);return r.push(i),r}function Q2(n,e){let t=[],i=!1;return n.iterChangedRanges((s,r)=>t.push(s,r)),e.iterChangedRanges((s,r,a,o)=>{for(let l=0;l<t.length;){let c=t[l++],u=t[l++];o>=c&&a<=u&&(i=!0)}}),i}function R2(n,e){return n.ranges.length==e.ranges.length&&n.ranges.filter((t,i)=>t.empty!=e.ranges[i].empty).length===0}function _O(n,e){return n.length?e.length?n.concat(e):n:e}const mi=[],L2=200;function FO(n,e){if(n.length){let t=n[n.length-1],i=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-L2));return i.length&&i[i.length-1].eq(e)?n:(i.push(e),Ol(n,n.length-1,1e9,t.setSelAfter(i)))}else return[Un.selection([e])]}function I2(n){let e=n[n.length-1],t=n.slice();return t[n.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Wu(n,e){if(!n.length)return n;let t=n.length,i=mi;for(;t;){let s=V2(n[t-1],e,i);if(s.changes&&!s.changes.empty||s.effects.length){let r=n.slice(0,t);return r[t-1]=s,r}else e=s.mapped,t--,i=s.selectionsAfter}return i.length?[Un.selection(i)]:mi}function V2(n,e,t){let i=_O(n.selectionsAfter.length?n.selectionsAfter.map(o=>o.map(e)):mi,t);if(!n.changes)return Un.selection(i);let s=n.changes.map(e),r=e.mapDesc(n.changes,!0),a=n.mapped?n.mapped.composeDesc(r):r;return new Un(s,kt.mapEffects(n.effects,e),a,n.startSelection.map(r),i)}const z2=/^(input\.type|delete)($|\.)/;class ts{constructor(e,t,i=0,s=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=s}isolate(){return this.prevTime?new ts(this.done,this.undone):this}addChanges(e,t,i,s,r){let a=this.done,o=a[a.length-1];return o&&o.changes&&!o.changes.empty&&e.changes&&(!i||z2.test(i))&&(!o.selectionsAfter.length&&t-this.prevTime<s.newGroupDelay&&s.joinToEvent(r,Q2(o.changes,e.changes))||i=="input.type.compose")?a=Ol(a,a.length-1,s.minDepth,new Un(e.changes.compose(o.changes),_O(kt.mapEffects(e.effects,o.changes),o.effects),o.mapped,o.startSelection,mi)):a=Ol(a,a.length,s.minDepth,e),new ts(a,mi,t,i)}addSelection(e,t,i,s){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:mi;return r.length>0&&t-this.prevTime<s&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&R2(r[r.length-1],e)?this:new ts(FO(this.done,e),this.undone,t,i)}addMapping(e){return new ts(Wu(this.done,e),Wu(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let s=e==0?this.done:this.undone;if(s.length==0)return null;let r=s[s.length-1],a=r.selectionsAfter[0]||t.selection;if(i&&r.selectionsAfter.length)return t.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:Mh.of({side:e,rest:I2(s),selection:a}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let o=s.length==1?mi:s.slice(0,s.length-1);return r.mapped&&(o=Wu(o,r.mapped)),t.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:Mh.of({side:e,rest:o,selection:a}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}ts.empty=new ts(mi,mi);const Z2=[{key:"Mod-z",run:TO,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Th,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Th,preventDefault:!0},{key:"Mod-u",run:B2,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:N2,preventDefault:!0}];function Wr(n,e){return le.create(n.ranges.map(e),n.mainIndex)}function Bi(n,e){return n.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Ni({state:n,dispatch:e},t){let i=Wr(n.selection,t);return i.eq(n.selection,!0)?!1:(e(Bi(n,i)),!0)}function Gl(n,e){return le.cursor(e?n.to:n.from)}function BO(n,e){return Ni(n,t=>t.empty?n.moveByChar(t,e):Gl(t,e))}function Mn(n){return n.textDirectionAt(n.state.selection.main.head)==cn.LTR}const NO=n=>BO(n,!Mn(n)),QO=n=>BO(n,Mn(n));function RO(n,e){return Ni(n,t=>t.empty?n.moveByGroup(t,e):Gl(t,e))}const j2=n=>RO(n,!Mn(n)),q2=n=>RO(n,Mn(n));function G2(n,e,t){if(e.type.prop(t))return!0;let i=e.to-e.from;return i&&(i>2||/[^\s,.;:]/.test(n.sliceDoc(e.from,e.to)))||e.firstChild}function Wl(n,e,t){let i=pn(n).resolveInner(e.head),s=t?at.closedBy:at.openedBy;for(let l=e.head;;){let c=t?i.childAfter(l):i.childBefore(l);if(!c)break;G2(n,c,s)?i=c:l=t?c.to:c.from}let r=i.type.prop(s),a,o;return r&&(a=t?es(n,i.from,1):es(n,i.to,-1))&&a.matched?o=t?a.end.to:a.end.from:o=t?i.to:i.from,le.cursor(o,t?-1:1)}const W2=n=>Ni(n,e=>Wl(n.state,e,!Mn(n))),X2=n=>Ni(n,e=>Wl(n.state,e,Mn(n)));function LO(n,e){return Ni(n,t=>{if(!t.empty)return Gl(t,e);let i=n.moveVertically(t,e);return i.head!=t.head?i:n.moveToLineBoundary(t,e)})}const IO=n=>LO(n,!1),VO=n=>LO(n,!0);function zO(n){let e=n.scrollDOM.clientHeight<n.scrollDOM.scrollHeight-2,t=0,i=0,s;if(e){for(let r of n.state.facet(Fe.scrollMargins)){let a=r(n);a!=null&&a.top&&(t=Math.max(a==null?void 0:a.top,t)),a!=null&&a.bottom&&(i=Math.max(a==null?void 0:a.bottom,i))}s=n.scrollDOM.clientHeight-t-i}else s=(n.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:i,selfScroll:e,height:Math.max(n.defaultLineHeight,s-5)}}function ZO(n,e){let t=zO(n),{state:i}=n,s=Wr(i.selection,a=>a.empty?n.moveVertically(a,e,t.height):Gl(a,e));if(s.eq(i.selection))return!1;let r;if(t.selfScroll){let a=n.coordsAtPos(i.selection.main.head),o=n.scrollDOM.getBoundingClientRect(),l=o.top+t.marginTop,c=o.bottom-t.marginBottom;a&&a.top>l&&a.bottom<c&&(r=Fe.scrollIntoView(s.main.head,{y:"start",yMargin:a.top-l}))}return n.dispatch(Bi(i,s),{effects:r}),!0}const um=n=>ZO(n,!1),_h=n=>ZO(n,!0);function js(n,e,t){let i=n.lineBlockAt(e.head),s=n.moveToLineBoundary(e,t);if(s.head==e.head&&s.head!=(t?i.to:i.from)&&(s=n.moveToLineBoundary(e,t,!1)),!t&&s.head==i.from&&i.length){let r=/^\s*/.exec(n.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;r&&e.head!=i.from+r&&(s=le.cursor(i.from+r))}return s}const U2=n=>Ni(n,e=>js(n,e,!0)),Y2=n=>Ni(n,e=>js(n,e,!1)),H2=n=>Ni(n,e=>js(n,e,!Mn(n))),K2=n=>Ni(n,e=>js(n,e,Mn(n))),J2=n=>Ni(n,e=>le.cursor(n.lineBlockAt(e.head).from,1)),e$=n=>Ni(n,e=>le.cursor(n.lineBlockAt(e.head).to,-1));function t$(n,e,t){let i=!1,s=Wr(n.selection,r=>{let a=es(n,r.head,-1)||es(n,r.head,1)||r.head>0&&es(n,r.head-1,1)||r.head<n.doc.length&&es(n,r.head+1,-1);if(!a||!a.end)return r;i=!0;let o=a.start.from==r.head?a.end.to:a.end.from;return le.cursor(o)});return i?(e(Bi(n,s)),!0):!1}const n$=({state:n,dispatch:e})=>t$(n,e);function bi(n,e){let t=Wr(n.state.selection,i=>{let s=e(i);return le.range(i.anchor,s.head,s.goalColumn,s.bidiLevel||void 0)});return t.eq(n.state.selection)?!1:(n.dispatch(Bi(n.state,t)),!0)}function jO(n,e){return bi(n,t=>n.moveByChar(t,e))}const qO=n=>jO(n,!Mn(n)),GO=n=>jO(n,Mn(n));function WO(n,e){return bi(n,t=>n.moveByGroup(t,e))}const i$=n=>WO(n,!Mn(n)),s$=n=>WO(n,Mn(n)),r$=n=>bi(n,e=>Wl(n.state,e,!Mn(n))),a$=n=>bi(n,e=>Wl(n.state,e,Mn(n)));function XO(n,e){return bi(n,t=>n.moveVertically(t,e))}const UO=n=>XO(n,!1),YO=n=>XO(n,!0);function HO(n,e){return bi(n,t=>n.moveVertically(t,e,zO(n).height))}const cm=n=>HO(n,!1),hm=n=>HO(n,!0),o$=n=>bi(n,e=>js(n,e,!0)),l$=n=>bi(n,e=>js(n,e,!1)),u$=n=>bi(n,e=>js(n,e,!Mn(n))),c$=n=>bi(n,e=>js(n,e,Mn(n))),h$=n=>bi(n,e=>le.cursor(n.lineBlockAt(e.head).from)),d$=n=>bi(n,e=>le.cursor(n.lineBlockAt(e.head).to)),dm=({state:n,dispatch:e})=>(e(Bi(n,{anchor:0})),!0),fm=({state:n,dispatch:e})=>(e(Bi(n,{anchor:n.doc.length})),!0),pm=({state:n,dispatch:e})=>(e(Bi(n,{anchor:n.selection.main.anchor,head:0})),!0),mm=({state:n,dispatch:e})=>(e(Bi(n,{anchor:n.selection.main.anchor,head:n.doc.length})),!0),f$=({state:n,dispatch:e})=>(e(n.update({selection:{anchor:0,head:n.doc.length},userEvent:"select"})),!0),p$=({state:n,dispatch:e})=>{let t=Xl(n).map(({from:i,to:s})=>le.range(i,Math.min(s+1,n.doc.length)));return e(n.update({selection:le.create(t),userEvent:"select"})),!0},m$=({state:n,dispatch:e})=>{let t=Wr(n.selection,i=>{let s=pn(n),r=s.resolveStack(i.from,1);if(i.empty){let a=s.resolveStack(i.from,-1);a.node.from>=r.node.from&&a.node.to<=r.node.to&&(r=a)}for(let a=r;a;a=a.next){let{node:o}=a;if((o.from<i.from&&o.to>=i.to||o.to>i.to&&o.from<=i.from)&&a.next)return le.range(o.to,o.from)}return i});return t.eq(n.selection)?!1:(e(Bi(n,t)),!0)};function KO(n,e){let{state:t}=n,i=t.selection,s=t.selection.ranges.slice();for(let r of t.selection.ranges){let a=t.doc.lineAt(r.head);if(e?a.to<n.state.doc.length:a.from>0)for(let o=r;;){let l=n.moveVertically(o,e);if(l.head<a.from||l.head>a.to){s.some(c=>c.head==l.head)||s.push(l);break}else{if(l.head==o.head)break;o=l}}}return s.length==i.ranges.length?!1:(n.dispatch(Bi(t,le.create(s,s.length-1))),!0)}const g$=n=>KO(n,!1),O$=n=>KO(n,!0),y$=({state:n,dispatch:e})=>{let t=n.selection,i=null;return t.ranges.length>1?i=le.create([t.main]):t.main.empty||(i=le.create([le.cursor(t.main.head)])),i?(e(Bi(n,i)),!0):!1};function Ja(n,e){if(n.state.readOnly)return!1;let t="delete.selection",{state:i}=n,s=i.changeByRange(r=>{let{from:a,to:o}=r;if(a==o){let l=e(r);l<a?(t="delete.backward",l=Co(n,l,!1)):l>a&&(t="delete.forward",l=Co(n,l,!0)),a=Math.min(a,l),o=Math.max(o,l)}else a=Co(n,a,!1),o=Co(n,o,!0);return a==o?{range:r}:{changes:{from:a,to:o},range:le.cursor(a,a<r.head?-1:1)}});return s.changes.empty?!1:(n.dispatch(i.update(s,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?Fe.announce.of(i.phrase("Selection deleted")):void 0})),!0)}function Co(n,e,t){if(n instanceof Fe)for(let i of n.state.facet(Fe.atomicRanges).map(s=>s(n)))i.between(e,e,(s,r)=>{s<e&&r>e&&(e=t?r:s)});return e}const JO=(n,e,t)=>Ja(n,i=>{let s=i.from,{state:r}=n,a=r.doc.lineAt(s),o,l;if(t&&!e&&s>a.from&&s<a.from+200&&!/[^ \t]/.test(o=a.text.slice(0,s-a.from))){if(o[o.length-1]=="	")return s-1;let c=Nl(o,r.tabSize),u=c%fl(r)||fl(r);for(let h=0;h<u&&o[o.length-1-h]==" ";h++)s--;l=s}else l=Nn(a.text,s-a.from,e,e)+a.from,l==s&&a.number!=(e?r.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(a.text.slice(l-a.from,s-a.from))&&(l=Nn(a.text,l-a.from,!1,!1)+a.from);return l}),Fh=n=>JO(n,!1,!0),ey=n=>JO(n,!0,!1),ty=(n,e)=>Ja(n,t=>{let i=t.head,{state:s}=n,r=s.doc.lineAt(i),a=s.charCategorizer(i);for(let o=null;;){if(i==(e?r.to:r.from)){i==t.head&&r.number!=(e?s.doc.lines:1)&&(i+=e?1:-1);break}let l=Nn(r.text,i-r.from,e)+r.from,c=r.text.slice(Math.min(i,l)-r.from,Math.max(i,l)-r.from),u=a(c);if(o!=null&&u!=o)break;(c!=" "||i!=t.head)&&(o=u),i=l}return i}),ny=n=>ty(n,!1),b$=n=>ty(n,!0),v$=n=>Ja(n,e=>{let t=n.lineBlockAt(e.head).to;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),S$=n=>Ja(n,e=>{let t=n.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),w$=n=>Ja(n,e=>{let t=n.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(n.state.doc.length,e.head+1)}),P$=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:pt.of(["",""])},range:le.cursor(i.from)}));return e(n.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},x$=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=n.changeByRange(i=>{if(!i.empty||i.from==0||i.from==n.doc.length)return{range:i};let s=i.from,r=n.doc.lineAt(s),a=s==r.from?s-1:Nn(r.text,s-r.from,!1)+r.from,o=s==r.to?s+1:Nn(r.text,s-r.from,!0)+r.from;return{changes:{from:a,to:o,insert:n.doc.slice(s,o).append(n.doc.slice(a,s))},range:le.cursor(o)}});return t.changes.empty?!1:(e(n.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Xl(n){let e=[],t=-1;for(let i of n.selection.ranges){let s=n.doc.lineAt(i.from),r=n.doc.lineAt(i.to);if(!i.empty&&i.to==r.from&&(r=n.doc.lineAt(i.to-1)),t>=s.number){let a=e[e.length-1];a.to=r.to,a.ranges.push(i)}else e.push({from:s.from,to:r.to,ranges:[i]});t=r.number+1}return e}function iy(n,e,t){if(n.readOnly)return!1;let i=[],s=[];for(let r of Xl(n)){if(t?r.to==n.doc.length:r.from==0)continue;let a=n.doc.lineAt(t?r.to+1:r.from-1),o=a.length+1;if(t){i.push({from:r.to,to:a.to},{from:r.from,insert:a.text+n.lineBreak});for(let l of r.ranges)s.push(le.range(Math.min(n.doc.length,l.anchor+o),Math.min(n.doc.length,l.head+o)))}else{i.push({from:a.from,to:r.from},{from:r.to,insert:n.lineBreak+a.text});for(let l of r.ranges)s.push(le.range(l.anchor-o,l.head-o))}}return i.length?(e(n.update({changes:i,scrollIntoView:!0,selection:le.create(s,n.selection.mainIndex),userEvent:"move.line"})),!0):!1}const C$=({state:n,dispatch:e})=>iy(n,e,!1),A$=({state:n,dispatch:e})=>iy(n,e,!0);function sy(n,e,t){if(n.readOnly)return!1;let i=[];for(let s of Xl(n))t?i.push({from:s.from,insert:n.doc.slice(s.from,s.to)+n.lineBreak}):i.push({from:s.to,insert:n.lineBreak+n.doc.slice(s.from,s.to)});return e(n.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const k$=({state:n,dispatch:e})=>sy(n,e,!1),E$=({state:n,dispatch:e})=>sy(n,e,!0),$$=n=>{if(n.state.readOnly)return!1;let{state:e}=n,t=e.changes(Xl(e).map(({from:s,to:r})=>(s>0?s--:r<e.doc.length&&r++,{from:s,to:r}))),i=Wr(e.selection,s=>{let r;if(n.lineWrapping){let a=n.lineBlockAt(s.head),o=n.coordsAtPos(s.head,s.assoc||1);o&&(r=a.bottom+n.documentTop-o.bottom+n.defaultLineHeight/2)}return n.moveVertically(s,!0,r)}).map(t);return n.dispatch({changes:t,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function D$(n,e){if(/\(\)|\[\]|\{\}/.test(n.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=pn(n).resolveInner(e),i=t.childBefore(e),s=t.childAfter(e),r;return i&&s&&i.to<=e&&s.from>=e&&(r=i.type.prop(at.closedBy))&&r.indexOf(s.name)>-1&&n.doc.lineAt(i.to).from==n.doc.lineAt(s.from).from&&!/\S/.test(n.sliceDoc(i.to,s.from))?{from:i.to,to:s.from}:null}const gm=ry(!1),M$=ry(!0);function ry(n){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(s=>{let{from:r,to:a}=s,o=e.doc.lineAt(r),l=!n&&r==a&&D$(e,r);n&&(r=a=(a<=o.to?o:e.doc.lineAt(a)).to);let c=new Vl(e,{simulateBreak:r,simulateDoubleBreak:!!l}),u=nO(c,r);for(u==null&&(u=Nl(/^\s*/.exec(e.doc.lineAt(r).text)[0],e.tabSize));a<o.to&&/\s/.test(o.text[a-o.from]);)a++;l?{from:r,to:a}=l:r>o.from&&r<o.from+100&&!/\S/.test(o.text.slice(0,r))&&(r=o.from);let h=["",pl(e,u)];return l&&h.push(pl(e,c.lineIndent(o.from,-1))),{changes:{from:r,to:a,insert:pt.of(h)},range:le.cursor(r+1+h[1].length)}});return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function Bd(n,e){let t=-1;return n.changeByRange(i=>{let s=[];for(let a=i.from;a<=i.to;){let o=n.doc.lineAt(a);o.number>t&&(i.empty||i.to>o.from)&&(e(o,s,i),t=o.number),a=o.to+1}let r=n.changes(s);return{changes:s,range:le.range(r.mapPos(i.anchor,1),r.mapPos(i.head,1))}})}const T$=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let t=Object.create(null),i=new Vl(n,{overrideIndentation:r=>{let a=t[r];return a??-1}}),s=Bd(n,(r,a,o)=>{let l=nO(i,r.from);if(l==null)return;/\S/.test(r.text)||(l=0);let c=/^\s*/.exec(r.text)[0],u=pl(n,l);(c!=u||o.from<r.from+c.length)&&(t[r.from]=l,a.push({from:r.from,to:r.from+c.length,insert:u}))});return s.changes.empty||e(n.update(s,{userEvent:"indent"})),!0},_$=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(Bd(n,(t,i)=>{i.push({from:t.from,insert:n.facet(Il)})}),{userEvent:"input.indent"})),!0),F$=({state:n,dispatch:e})=>n.readOnly?!1:(e(n.update(Bd(n,(t,i)=>{let s=/^\s*/.exec(t.text)[0];if(!s)return;let r=Nl(s,n.tabSize),a=0,o=pl(n,Math.max(0,r-fl(n)));for(;a<s.length&&a<o.length&&s.charCodeAt(a)==o.charCodeAt(a);)a++;i.push({from:t.from+a,to:t.from+s.length,insert:o.slice(a)})}),{userEvent:"delete.dedent"})),!0),B$=n=>(n.setTabFocusMode(),!0),N$=[{key:"Ctrl-b",run:NO,shift:qO,preventDefault:!0},{key:"Ctrl-f",run:QO,shift:GO},{key:"Ctrl-p",run:IO,shift:UO},{key:"Ctrl-n",run:VO,shift:YO},{key:"Ctrl-a",run:J2,shift:h$},{key:"Ctrl-e",run:e$,shift:d$},{key:"Ctrl-d",run:ey},{key:"Ctrl-h",run:Fh},{key:"Ctrl-k",run:v$},{key:"Ctrl-Alt-h",run:ny},{key:"Ctrl-o",run:P$},{key:"Ctrl-t",run:x$},{key:"Ctrl-v",run:_h}],Q$=[{key:"ArrowLeft",run:NO,shift:qO,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:j2,shift:i$,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:H2,shift:u$,preventDefault:!0},{key:"ArrowRight",run:QO,shift:GO,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:q2,shift:s$,preventDefault:!0},{mac:"Cmd-ArrowRight",run:K2,shift:c$,preventDefault:!0},{key:"ArrowUp",run:IO,shift:UO,preventDefault:!0},{mac:"Cmd-ArrowUp",run:dm,shift:pm},{mac:"Ctrl-ArrowUp",run:um,shift:cm},{key:"ArrowDown",run:VO,shift:YO,preventDefault:!0},{mac:"Cmd-ArrowDown",run:fm,shift:mm},{mac:"Ctrl-ArrowDown",run:_h,shift:hm},{key:"PageUp",run:um,shift:cm},{key:"PageDown",run:_h,shift:hm},{key:"Home",run:Y2,shift:l$,preventDefault:!0},{key:"Mod-Home",run:dm,shift:pm},{key:"End",run:U2,shift:o$,preventDefault:!0},{key:"Mod-End",run:fm,shift:mm},{key:"Enter",run:gm,shift:gm},{key:"Mod-a",run:f$},{key:"Backspace",run:Fh,shift:Fh,preventDefault:!0},{key:"Delete",run:ey,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:ny,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:b$,preventDefault:!0},{mac:"Mod-Backspace",run:S$,preventDefault:!0},{mac:"Mod-Delete",run:w$,preventDefault:!0}].concat(N$.map(n=>({mac:n.key,run:n.run,shift:n.shift}))),R$=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:W2,shift:r$},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:X2,shift:a$},{key:"Alt-ArrowUp",run:C$},{key:"Shift-Alt-ArrowUp",run:k$},{key:"Alt-ArrowDown",run:A$},{key:"Shift-Alt-ArrowDown",run:E$},{key:"Mod-Alt-ArrowUp",run:g$},{key:"Mod-Alt-ArrowDown",run:O$},{key:"Escape",run:y$},{key:"Mod-Enter",run:M$},{key:"Alt-l",mac:"Ctrl-l",run:p$},{key:"Mod-i",run:m$,preventDefault:!0},{key:"Mod-[",run:F$},{key:"Mod-]",run:_$},{key:"Mod-Alt-\\",run:T$},{key:"Shift-Mod-k",run:$$},{key:"Shift-Mod-\\",run:n$},{key:"Mod-/",run:C2},{key:"Alt-A",run:k2},{key:"Ctrl-m",mac:"Shift-Alt-m",run:B$}].concat(Q$),Om=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class ay{constructor(e,t,i=0,s=e.length,r,a){this.test=a,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,s),this.bufferStart=i,this.normalize=r?o=>r(Om(o)):Om,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Or(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=M0(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=qa(e);let s=this.normalize(t);if(s.length)for(let r=0,a=i;;r++){let o=s.charCodeAt(r),l=this.match(o,a,this.bufferPos+this.bufferStart);if(r==s.length-1){if(l)return this.value=l,this;break}a==i&&r<t.length&&t.charCodeAt(r)==o&&a++}}}match(e,t,i){let s=null;for(let r=0;r<this.matches.length;r+=2){let a=this.matches[r],o=!1;this.query.charCodeAt(a)==e&&(a==this.query.length-1?s={from:this.matches[r+1],to:i}:(this.matches[r]++,o=!0)),o||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?s={from:t,to:i}:this.matches.push(1,t)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferStart)&&(s=null),s}}typeof Symbol<"u"&&(ay.prototype[Symbol.iterator]=function(){return this});const L$={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},I$=Be.define({combine(n){return Ga(n,L$,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function V$(n){return[G$,q$]}const z$=nt.mark({class:"cm-selectionMatch"}),Z$=nt.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function ym(n,e,t,i){return(t==0||n(e.sliceDoc(t-1,t))!=Dn.Word)&&(i==e.doc.length||n(e.sliceDoc(i,i+1))!=Dn.Word)}function j$(n,e,t,i){return n(e.sliceDoc(t,t+1))==Dn.Word&&n(e.sliceDoc(i-1,i))==Dn.Word}const q$=ls.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.selectionSet||n.docChanged||n.viewportChanged)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=n.state.facet(I$),{state:t}=n,i=t.selection;if(i.ranges.length>1)return nt.none;let s=i.main,r,a=null;if(s.empty){if(!e.highlightWordAroundCursor)return nt.none;let l=t.wordAt(s.head);if(!l)return nt.none;a=t.charCategorizer(s.head),r=t.sliceDoc(l.from,l.to)}else{let l=s.to-s.from;if(l<e.minSelectionLength||l>200)return nt.none;if(e.wholeWords){if(r=t.sliceDoc(s.from,s.to),a=t.charCategorizer(s.head),!(ym(a,t,s.from,s.to)&&j$(a,t,s.from,s.to)))return nt.none}else if(r=t.sliceDoc(s.from,s.to),!r)return nt.none}let o=[];for(let l of n.visibleRanges){let c=new ay(t.doc,r,l.from,l.to);for(;!c.next().done;){let{from:u,to:h}=c.value;if((!a||ym(a,t,u,h))&&(s.empty&&u<=s.from&&h>=s.to?o.push(Z$.range(u,h)):(u>=s.to||h<=s.from)&&o.push(z$.range(u,h)),o.length>e.maxMatches))return nt.none}}return nt.set(o)}},{decorations:n=>n.decorations}),G$=Fe.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),W$=new Map,X$=kt.define(),U$=ri.define({create(){return nt.none},update(n,e){e.docChanged&&(n=n.map(e.changes));for(const t of e.effects)if(t.is(X$))return t.value;return n},provide:n=>Fe.decorations.from(n)});nt.mark({class:"cm-master-highlight"});function Y$(n,e={}){const{theme:t="light",placeholder:i="",lineNumbers:s=!0,autofocus:r=!1,onUpdate:a=null}=e,o=n.value||"",l=[s?$p():[],F2(),cE(),wE(),qE(),V$(),wd.of([...UE,...R$,...Z2,...aE]),c2(),Fe.lineWrapping,Fe.updateListener.of(u=>{if(u.docChanged&&a){const h=u.state.doc.toString();a(h)}if(u.docChanged){const h=u.state.doc.toString();n.value=h;const d=new Event("input",{bubbles:!0});n.dispatchEvent(d)}}),Fe.contentAttributes.of({"data-placeholder":i}),Fe.baseTheme({"&.cm-editor":{outline:"none",position:"relative",boxSizing:"border-box"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:"1.4",height:"100%",overflowX:"auto",position:"relative",zIndex:"0"},".cm-content":{margin:"0",flexGrow:"2",flexShrink:"0",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none",minHeight:"120px"},".cm-lineWrapping":{whiteSpace:"pre-wrap",overflowWrap:"anywhere"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-gutters":{flexShrink:"0",display:"flex",height:"100%",boxSizing:"border-box",left:"0",zIndex:"200"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:"0",boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",color:"#999",whiteSpace:"nowrap"}}),Fe.theme({"&.cm-editor":{fontSize:"14px",fontFamily:"'Courier New', Courier, monospace",border:"1px solid rgba(102, 126, 234, 0.25)",borderRadius:"12px",backgroundColor:"rgba(255, 255, 255, 0.9)",boxShadow:"inset 0 0 0 1px rgba(255, 255, 255, 0.5)",overflow:"hidden"},".cm-content":{minHeight:"120px",padding:"8px",caretColor:"#000"},".cm-focused":{outline:"none"},".cm-editor.cm-focused":{borderColor:"#667eea",backgroundColor:"#fff",boxShadow:"inset 0 0 0 1px rgba(255, 255, 255, 0.5), 0 0 0 2px rgba(102, 126, 234, 0.2)"},".cm-placeholder":{color:"#999",fontStyle:"italic"},".cm-gutters":{backgroundColor:"rgba(245, 245, 245, 0.5)",color:"#999",border:"none",borderRight:"1px solid rgba(102, 126, 234, 0.15)"}})];l.push(U$),t==="dark"&&l.push(x2),$p||l.push(Fe.lineWrapping);let c;try{c=new Fe({doc:o,extensions:l}),n.style.display="none",n.parentNode.insertBefore(c.dom,n),console.log(`   Editor DOM created and inserted for ${n.id||"textarea"}`)}catch(u){return console.error("❌ Error creating Strudel REPL editor:",u),console.error("   Error details:",u.message,u.stack),null}return c&&(c.getTextarea=()=>n,c.getValue=()=>c.state.doc.toString(),c.setValue=u=>{if(c.state.doc.toString()!==u){c.dispatch({changes:{from:0,to:c.state.doc.length,insert:u||""}}),n.value=u||"";const d=new Event("input",{bubbles:!0});n.dispatchEvent(d)}}),r&&c.focus(),c}function H$(){try{console.log("🎨 Initializing Strudel REPL editors...");const n=document.querySelectorAll("textarea[data-strudel-repl], #modal-pattern, #master-pattern");console.log(`   Found ${n.length} textareas to initialize:`,Array.from(n).map(e=>e.id||"unnamed")),n.forEach(e=>{if(e.tagName==="TEXTAREA"&&!e.dataset.strudelReplInitialized){const t=e.id==="modal-pattern",i=e.id==="master-pattern";console.log(`   Initializing editor for: ${e.id||"unnamed textarea"}`);const s=e.placeholder||"";try{const r=Y$(e,{theme:"light",placeholder:s,lineNumbers:!0,autofocus:!1,onUpdate:a=>{e.value=a}});r?(e.dataset.strudelReplInitialized="true",e._strudelEditor=r,W$.set(e.id,r),console.log(`   ✅ Successfully created editor for ${e.id||"textarea"}`)):console.warn(`   ⚠️ Editor creation returned null for ${e.id||"textarea"}`)}catch(r){console.error(`   ❌ Error creating editor for ${e.id||"textarea"}:`,r)}}else e.dataset.strudelReplInitialized&&console.log(`   ⏭️ Skipping ${e.id||"unnamed"} - already initialized`)}),console.log("✅ Strudel REPL editors initialization complete")}catch(n){console.error("❌ Error initializing Strudel REPL editors:",n)}}function Ul(n){const e=typeof n=="string"?document.getElementById(n):n;return e&&e._strudelEditor||null}function dt(n){const e=Ul(n);if(e&&e.getValue)return e.getValue();const t=typeof n=="string"?document.getElementById(n):n;return t?t.value:""}function $t(n,e){const t=Ul(n);if(t&&t.setValue){t.setValue(e);return}const i=typeof n=="string"?document.getElementById(n):n;if(i){i.value=e;const s=new Event("input",{bubbles:!0});i.dispatchEvent(s)}}function K$(n,e){const t=Ul(n),i=document.getElementById(n);t&&t.contentDOM&&(t.contentDOM.setAttribute("contenteditable",e?"true":"false"),t.dom.classList.toggle("cm-readonly",!e)),i&&(i.readOnly=!e,i.classList.toggle("pattern-editor-readonly",!e))}function bm(n,e,t={}){if(!e||typeof e!="string")return;const i=typeof t.cursorOffset=="number"?t.cursorOffset:null,s=Ul(n);if(s){const f=s,{state:m}=f,g=m.selection.main,y=g.from,b=g.to,P=vm(e,()=>{let w=y;for(;w>0;){const C=m.doc.sliceString(w-1,w);if(w-=1,!/\s/.test(C))return C}return""}),k=i!==null?i:P.endsWith("()")||P.endsWith("{}")?1:0;f.dispatch({changes:{from:y,to:b,insert:P},selection:le.cursor(Math.max(y+P.length-k,0)),scrollIntoView:!0}),f.focus();return}const r=document.getElementById(n);if(!r)return;const a=typeof r.selectionStart=="number"?r.selectionStart:r.value.length,o=typeof r.selectionEnd=="number"?r.selectionEnd:r.value.length,l=r.value.slice(0,a),c=r.value.slice(o),u=vm(e,()=>{let f=a;for(;f>0;){const m=r.value.charAt(f-1);if(f-=1,!/\s/.test(m))return m}return""});r.value=`${l}${u}${c}`;const h=i!==null?i:u.endsWith("()")||u.endsWith("{}")?1:0,d=Math.max(a+u.length-h,0);typeof r.setSelectionRange=="function"&&r.setSelectionRange(d,d),r.dispatchEvent(new Event("input",{bubbles:!0})),r.focus()}function vm(n,e){if(!n||n.trimStart().startsWith(".")||/^\s/.test(n))return n;const i=typeof e=="function"?e():"";return!i||i==="."||/\s/.test(i)||/[\(\[\{,]/.test(i)?n:`.${n}`}function J$(n,e){function t(){this.constructor=n}t.prototype=e.prototype,n.prototype=new t}function zr(n,e,t,i){var s=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(s,zr.prototype),s.expected=e,s.found=t,s.location=i,s.name="SyntaxError",s}J$(zr,Error);function Xu(n,e,t){return t=t||" ",n.length>e?n:(e-=n.length,t+=t.repeat(e),n+t.slice(0,e))}zr.prototype.format=function(n){var e="Error: "+this.message;if(this.location){var t=null,i;for(i=0;i<n.length;i++)if(n[i].source===this.location.source){t=n[i].text.split(/\r\n|\n|\r/g);break}var s=this.location.start,r=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(s):s,a=this.location.source+":"+r.line+":"+r.column;if(t){var o=this.location.end,l=Xu("",r.line.toString().length," "),c=t[s.line-1],u=s.line===o.line?o.column:c.length+1,h=u-s.column||1;e+=`
 --> `+a+`
`+l+` |
`+r.line+" | "+c+`
`+l+" | "+Xu("",s.column-1," ")+Xu("",h,"^")}else e+=`
 at `+a}return e};zr.buildMessage=function(n,e){var t={literal:function(c){return'"'+s(c.text)+'"'},class:function(c){var u=c.parts.map(function(h){return Array.isArray(h)?r(h[0])+"-"+r(h[1]):r(h)});return"["+(c.inverted?"^":"")+u.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(c){return c.description}};function i(c){return c.charCodeAt(0).toString(16).toUpperCase()}function s(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function r(c){return c.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(u){return"\\x0"+i(u)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(u){return"\\x"+i(u)})}function a(c){return t[c.type](c)}function o(c){var u=c.map(a),h,d;if(u.sort(),u.length>0){for(h=1,d=1;h<u.length;h++)u[h-1]!==u[h]&&(u[d]=u[h],d++);u.length=d}switch(u.length){case 1:return u[0];case 2:return u[0]+" or "+u[1];default:return u.slice(0,-1).join(", ")+", or "+u[u.length-1]}}function l(c){return c?'"'+s(c)+'"':"end of input"}return"Expected "+o(n)+" but "+l(e)+" found."};function eD(n,e){e=e!==void 0?e:{};var t={},i=e.grammarSource,s={start:tn},r=tn,a=".",o="-",l="0",c=",",u="|",h="[",d="]",f="{",m="}",g="%",y="<",b=">",P="!",k="(",w=")",C="/",$="*",A="?",Q=":",q="..",W="^",U="struct",Z="target",Y="euclid",ne="slow",re="rotL",ve="rotR",Ce="fast",De="scale",Ue="//",Pt="cat",yt="$",ue="setcps",Je="setbpm",he="hush",Et=/^[1-9]/,Ze=/^[eE]/,me=/^[+\-]/,Ye=/^[0-9]/,xt=/^[ \n\r\t\xA0]/,ai=/^["']/,Tn=/^[#\--.0-9A-Z\^-_a-z~\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376-\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06E5-\u06E6\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4-\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u09FC\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E46\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A-\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7B9\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD-\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,Nt=/^[@_]/,mn=/^[^\n]/,ot=Rt("number"),en=ze(".",!1),Jn=ht([["1","9"]],!1,!1),Qi=ht(["e","E"],!1,!1),ds=ht(["+","-"],!1,!1),Ri=ze("-",!1),Ps=ze("0",!1),Li=ht([["0","9"]],!1,!1),Ii=Rt("whitespace"),oi=ht([" ",`
`,"\r","	"," "],!1,!1),In=ze(",",!1),Se=ze("|",!1),Zt=ht(['"',"'"],!1,!1),Ne=Rt('a letter, a number, "-", "#", ".", "^", "_"'),bt=ht(["#",["-","."],["0","9"],["A","Z"],["^","_"],["a","z"],"~","ª","µ","º",["À","Ö"],["Ø","ö"],["ø","ˁ"],["ˆ","ˑ"],["ˠ","ˤ"],"ˬ","ˮ",["Ͱ","ʹ"],["Ͷ","ͷ"],["ͺ","ͽ"],"Ϳ","Ά",["Έ","Ί"],"Ό",["Ύ","Ρ"],["Σ","ϵ"],["Ϸ","ҁ"],["Ҋ","ԯ"],["Ա","Ֆ"],"ՙ",["ՠ","ֈ"],["א","ת"],["ׯ","ײ"],["ؠ","ي"],["ٮ","ٯ"],["ٱ","ۓ"],"ە",["ۥ","ۦ"],["ۮ","ۯ"],["ۺ","ۼ"],"ۿ","ܐ",["ܒ","ܯ"],["ݍ","ޥ"],"ޱ",["ߊ","ߪ"],["ߴ","ߵ"],"ߺ",["ࠀ","ࠕ"],"ࠚ","ࠤ","ࠨ",["ࡀ","ࡘ"],["ࡠ","ࡪ"],["ࢠ","ࢴ"],["ࢶ","ࢽ"],["ऄ","ह"],"ऽ","ॐ",["क़","ॡ"],["ॱ","ঀ"],["অ","ঌ"],["এ","ঐ"],["ও","ন"],["প","র"],"ল",["শ","হ"],"ঽ","ৎ",["ড়","ঢ়"],["য়","ৡ"],["ৰ","ৱ"],"ৼ",["ਅ","ਊ"],["ਏ","ਐ"],["ਓ","ਨ"],["ਪ","ਰ"],["ਲ","ਲ਼"],["ਵ","ਸ਼"],["ਸ","ਹ"],["ਖ਼","ੜ"],"ਫ਼",["ੲ","ੴ"],["અ","ઍ"],["એ","ઑ"],["ઓ","ન"],["પ","ર"],["લ","ળ"],["વ","હ"],"ઽ","ૐ",["ૠ","ૡ"],"ૹ",["ଅ","ଌ"],["ଏ","ଐ"],["ଓ","ନ"],["ପ","ର"],["ଲ","ଳ"],["ଵ","ହ"],"ଽ",["ଡ଼","ଢ଼"],["ୟ","ୡ"],"ୱ","ஃ",["அ","ஊ"],["எ","ஐ"],["ஒ","க"],["ங","ச"],"ஜ",["ஞ","ட"],["ண","த"],["ந","ப"],["ம","ஹ"],"ௐ",["అ","ఌ"],["ఎ","ఐ"],["ఒ","న"],["ప","హ"],"ఽ",["ౘ","ౚ"],["ౠ","ౡ"],"ಀ",["ಅ","ಌ"],["ಎ","ಐ"],["ಒ","ನ"],["ಪ","ಳ"],["ವ","ಹ"],"ಽ","ೞ",["ೠ","ೡ"],["ೱ","ೲ"],["അ","ഌ"],["എ","ഐ"],["ഒ","ഺ"],"ഽ","ൎ",["ൔ","ൖ"],["ൟ","ൡ"],["ൺ","ൿ"],["අ","ඖ"],["ක","න"],["ඳ","ර"],"ල",["ව","ෆ"],["ก","ะ"],["า","ำ"],["เ","ๆ"],["ກ","ຂ"],"ຄ",["ງ","ຈ"],"ຊ","ຍ",["ດ","ທ"],["ນ","ຟ"],["ມ","ຣ"],"ລ","ວ",["ສ","ຫ"],["ອ","ະ"],["າ","ຳ"],"ຽ",["ເ","ໄ"],"ໆ",["ໜ","ໟ"],"ༀ",["ཀ","ཇ"],["ཉ","ཬ"],["ྈ","ྌ"],["က","ဪ"],"ဿ",["ၐ","ၕ"],["ၚ","ၝ"],"ၡ",["ၥ","ၦ"],["ၮ","ၰ"],["ၵ","ႁ"],"ႎ",["Ⴀ","Ⴥ"],"Ⴧ","Ⴭ",["ა","ჺ"],["ჼ","ቈ"],["ቊ","ቍ"],["ቐ","ቖ"],"ቘ",["ቚ","ቝ"],["በ","ኈ"],["ኊ","ኍ"],["ነ","ኰ"],["ኲ","ኵ"],["ኸ","ኾ"],"ዀ",["ዂ","ዅ"],["ወ","ዖ"],["ዘ","ጐ"],["ጒ","ጕ"],["ጘ","ፚ"],["ᎀ","ᎏ"],["Ꭰ","Ᏽ"],["ᏸ","ᏽ"],["ᐁ","ᙬ"],["ᙯ","ᙿ"],["ᚁ","ᚚ"],["ᚠ","ᛪ"],["ᛮ","ᛸ"],["ᜀ","ᜌ"],["ᜎ","ᜑ"],["ᜠ","ᜱ"],["ᝀ","ᝑ"],["ᝠ","ᝬ"],["ᝮ","ᝰ"],["ក","ឳ"],"ៗ","ៜ",["ᠠ","ᡸ"],["ᢀ","ᢄ"],["ᢇ","ᢨ"],"ᢪ",["ᢰ","ᣵ"],["ᤀ","ᤞ"],["ᥐ","ᥭ"],["ᥰ","ᥴ"],["ᦀ","ᦫ"],["ᦰ","ᧉ"],["ᨀ","ᨖ"],["ᨠ","ᩔ"],"ᪧ",["ᬅ","ᬳ"],["ᭅ","ᭋ"],["ᮃ","ᮠ"],["ᮮ","ᮯ"],["ᮺ","ᯥ"],["ᰀ","ᰣ"],["ᱍ","ᱏ"],["ᱚ","ᱽ"],["ᲀ","ᲈ"],["Ა","Ჺ"],["Ჽ","Ჿ"],["ᳩ","ᳬ"],["ᳮ","ᳱ"],["ᳵ","ᳶ"],["ᴀ","ᶿ"],["Ḁ","ἕ"],["Ἐ","Ἕ"],["ἠ","ὅ"],["Ὀ","Ὅ"],["ὐ","ὗ"],"Ὑ","Ὓ","Ὕ",["Ὗ","ώ"],["ᾀ","ᾴ"],["ᾶ","ᾼ"],"ι",["ῂ","ῄ"],["ῆ","ῌ"],["ῐ","ΐ"],["ῖ","Ί"],["ῠ","Ῥ"],["ῲ","ῴ"],["ῶ","ῼ"],"ⁱ","ⁿ",["ₐ","ₜ"],"ℂ","ℇ",["ℊ","ℓ"],"ℕ",["ℙ","ℝ"],"ℤ","Ω","ℨ",["K","ℭ"],["ℯ","ℹ"],["ℼ","ℿ"],["ⅅ","ⅉ"],"ⅎ",["Ⅰ","ↈ"],["Ⰰ","Ⱞ"],["ⰰ","ⱞ"],["Ⱡ","ⳤ"],["Ⳬ","ⳮ"],["Ⳳ","ⳳ"],["ⴀ","ⴥ"],"ⴧ","ⴭ",["ⴰ","ⵧ"],"ⵯ",["ⶀ","ⶖ"],["ⶠ","ⶦ"],["ⶨ","ⶮ"],["ⶰ","ⶶ"],["ⶸ","ⶾ"],["ⷀ","ⷆ"],["ⷈ","ⷎ"],["ⷐ","ⷖ"],["ⷘ","ⷞ"],"ⸯ",["々","〇"],["〡","〩"],["〱","〵"],["〸","〼"],["ぁ","ゖ"],["ゝ","ゟ"],["ァ","ヺ"],["ー","ヿ"],["ㄅ","ㄯ"],["ㄱ","ㆎ"],["ㆠ","ㆺ"],["ㇰ","ㇿ"],["㐀","䶵"],["一","鿯"],["ꀀ","ꒌ"],["ꓐ","ꓽ"],["ꔀ","ꘌ"],["ꘐ","ꘟ"],["ꘪ","ꘫ"],["Ꙁ","ꙮ"],["ꙿ","ꚝ"],["ꚠ","ꛯ"],["ꜗ","ꜟ"],["Ꜣ","ꞈ"],["Ꞌ","ꞹ"],["ꟷ","ꠁ"],["ꠃ","ꠅ"],["ꠇ","ꠊ"],["ꠌ","ꠢ"],["ꡀ","ꡳ"],["ꢂ","ꢳ"],["ꣲ","ꣷ"],"ꣻ",["ꣽ","ꣾ"],["ꤊ","ꤥ"],["ꤰ","ꥆ"],["ꥠ","ꥼ"],["ꦄ","ꦲ"],"ꧏ",["ꧠ","ꧤ"],["ꧦ","ꧯ"],["ꧺ","ꧾ"],["ꨀ","ꨨ"],["ꩀ","ꩂ"],["ꩄ","ꩋ"],["ꩠ","ꩶ"],"ꩺ",["ꩾ","ꪯ"],"ꪱ",["ꪵ","ꪶ"],["ꪹ","ꪽ"],"ꫀ","ꫂ",["ꫛ","ꫝ"],["ꫠ","ꫪ"],["ꫲ","ꫴ"],["ꬁ","ꬆ"],["ꬉ","ꬎ"],["ꬑ","ꬖ"],["ꬠ","ꬦ"],["ꬨ","ꬮ"],["ꬰ","ꭚ"],["ꭜ","ꭥ"],["ꭰ","ꯢ"],["가","힣"],["ힰ","ퟆ"],["ퟋ","ퟻ"],["豈","舘"],["並","龎"],["ﬀ","ﬆ"],["ﬓ","ﬗ"],"יִ",["ײַ","ﬨ"],["שׁ","זּ"],["טּ","לּ"],"מּ",["נּ","סּ"],["ףּ","פּ"],["צּ","ﮱ"],["ﯓ","ﴽ"],["ﵐ","ﶏ"],["ﶒ","ﷇ"],["ﷰ","ﷻ"],["ﹰ","ﹴ"],["ﹶ","ﻼ"],["Ａ","Ｚ"],["ａ","ｚ"],["ｦ","ﾾ"],["ￂ","ￇ"],["ￊ","ￏ"],["ￒ","ￗ"],["ￚ","ￜ"]],!1,!1),et=ze("[",!1),ei=ze("]",!1),xs=ze("{",!1),gn=ze("}",!1),li=ze("%",!1),Vn=ze("<",!1),Mt=ze(">",!1),Vi=ht(["@","_"],!1,!1),Cs=ze("!",!1),St=ze("(",!1),mt=ze(")",!1),Ht=ze("/",!1),K=ze("*",!1),te=ze("?",!1),H=ze(":",!1),ce=ze("..",!1),p=ze("^",!1),S=ze("struct",!1),v=ze("target",!1),x=ze("euclid",!1),F=ze("slow",!1),X=ze("rotL",!1),J=ze("rotR",!1),ie=ze("fast",!1),be=ze("scale",!1),Ie=ze("//",!1),Ct=ht([`
`],!0,!1),_n=ze("cat",!1),Fn=ze("$",!1),Si=ze("setcps",!1),wi=ze("setbpm",!1),zn=ze("hush",!1),zi=function(){return parseFloat(ct())},Gs=function(O){const D=O.join("");return D==="."||D==="_"},Kr=function(O){return new Bb(O.join(""))},iu=function(O){return O},Ws=function(O,D){return O.arguments_.stepsPerCycle=D,O},br=function(O){return O},su=function(O){return O.arguments_.alignment="polymeter_slowcat",O},ru=function(O){return D=>D.options_.weight=(D.options_.weight??1)+(O??2)-1},io=function(O){return D=>{const R=(D.options_.reps??1)+(O??2)-1;D.options_.reps=R,D.options_.ops=D.options_.ops.filter(ee=>ee.type_!=="replicate"),D.options_.ops.push({type_:"replicate",arguments_:{amount:R}}),D.options_.weight=R}},so=function(O,D,R){return ee=>ee.options_.ops.push({type_:"bjorklund",arguments_:{pulse:O,step:D,rotation:R}})},M=function(O){return D=>D.options_.ops.push({type_:"stretch",arguments_:{amount:O,type:"slow"}})},_=function(O){return D=>D.options_.ops.push({type_:"stretch",arguments_:{amount:O,type:"fast"}})},T=function(O){return D=>D.options_.ops.push({type_:"degradeBy",arguments_:{amount:O,seed:lu++}})},N=function(O){return D=>D.options_.ops.push({type_:"tail",arguments_:{element:O}})},L=function(O){return D=>D.options_.ops.push({type_:"range",arguments_:{element:O}})},z=function(O,D){const R=new Qb(O,{ops:[],weight:1,reps:1});for(const ee of D)ee(R);return R},V=function(O,D){return new ao(D,"fastcat",void 0,!!O)},G=function(O){return{alignment:"stack",list:O}},ae=function(O){return{alignment:"rand",list:O,seed:lu++}},pe=function(O){return{alignment:"feet",list:O,seed:lu++}},se=function(O,D){return D&&D.list.length>0?new ao([O,...D.list],D.alignment,D.seed):O},de=function(O,D){return new ao(D?[O,...D.list]:[O],"polymeter")},He=function(O){return O},We=function(O){return{name:"struct",args:{mini:O}}},Ge=function(O){return{name:"target",args:{name:O}}},Ae=function(O,D,R){return{name:"bjorklund",args:{pulse:O,step:parseInt(D)}}},fe=function(O){return{name:"stretch",args:{amount:O}}},oe=function(O){return{name:"shift",args:{amount:"-"+O}}},Ve=function(O){return{name:"shift",args:{amount:O}}},je=function(O){return{name:"stretch",args:{amount:"1/"+O}}},gt=function(O){return{name:"scale",args:{scale:O.join("")}}},st=function(O,D){return D},it=function(O,D){return D.unshift(O),new ao(D,"slowcat")},Tt=function(O){return O},Me=function(O,D){return new Nb(O.name,O.args,D)},Qt=function(O){return O},_t=function(O){return O},we=function(O){return new ou("setcps",{value:O})},Ft=function(O){return new ou("setcps",{value:O/120/2})},Zi=function(){return new ou("hush")},B=e.peg$currPos|0,_e=B,Wt=[{line:1,column:1}],Ke=B,Te=e.peg$maxFailExpected||[],ge=e.peg$silentFails|0,Le;if(e.startRule){if(!(e.startRule in s))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');r=s[e.startRule]}function ct(){return n.substring(_e,B)}function lt(){return rt(_e,B)}function ze(O,D){return{type:"literal",text:O,ignoreCase:D}}function ht(O,D,R){return{type:"class",parts:O,inverted:D,ignoreCase:R}}function On(){return{type:"end"}}function Rt(O){return{type:"other",description:O}}function qe(O){var D=Wt[O],R;if(D)return D;if(O>=Wt.length)R=Wt.length-1;else for(R=O;!Wt[--R];);for(D=Wt[R],D={line:D.line,column:D.column};R<O;)n.charCodeAt(R)===10?(D.line++,D.column=1):D.column++,R++;return Wt[O]=D,D}function rt(O,D,R){var ee=qe(O),Qe=qe(D),jt={source:i,start:{offset:O,line:ee.line,column:ee.column},end:{offset:D,line:Qe.line,column:Qe.column}};return jt}function ke(O){B<Ke||(B>Ke&&(Ke=B,Te=[]),Te.push(O))}function wt(O,D,R){return new zr(zr.buildMessage(O,D),O,D,R)}function tn(){var O;return O=Fb(),O}function wn(){var O,D;return ge++,O=B,ui(),D=Yt(),D!==t?(Pn(),Pi(),_e=O,O=zi()):(B=O,O=t),ge--,O===t&&ge===0&&ke(ot),O}function vr(){var O;return n.charCodeAt(B)===46?(O=a,B++):(O=t,ge===0&&ke(en)),O}function Xt(){var O;return O=n.charAt(B),Et.test(O)?B++:(O=t,ge===0&&ke(Jn)),O}function Xs(){var O;return O=n.charAt(B),Ze.test(O)?B++:(O=t,ge===0&&ke(Qi)),O}function Pi(){var O,D,R,ee,Qe;if(O=B,D=Xs(),D!==t){if(R=n.charAt(B),me.test(R)?B++:(R=t,ge===0&&ke(ds)),R===t&&(R=null),ee=[],Qe=nn(),Qe!==t)for(;Qe!==t;)ee.push(Qe),Qe=nn();else ee=t;ee!==t?(D=[D,R,ee],O=D):(B=O,O=t)}else B=O,O=t;return O}function Pn(){var O,D,R,ee;if(O=B,D=vr(),D!==t){if(R=[],ee=nn(),ee!==t)for(;ee!==t;)R.push(ee),ee=nn();else R=t;R!==t?(D=[D,R],O=D):(B=O,O=t)}else B=O,O=t;return O}function Yt(){var O,D,R,ee;if(O=xn(),O===t)if(O=B,D=Xt(),D!==t){for(R=[],ee=nn();ee!==t;)R.push(ee),ee=nn();D=[D,R],O=D}else B=O,O=t;return O}function ui(){var O;return n.charCodeAt(B)===45?(O=o,B++):(O=t,ge===0&&ke(Ri)),O}function xn(){var O;return n.charCodeAt(B)===48?(O=l,B++):(O=t,ge===0&&ke(Ps)),O}function nn(){var O;return O=n.charAt(B),Ye.test(O)?B++:(O=t,ge===0&&ke(Li)),O}function xe(){var O,D;for(ge++,O=[],D=n.charAt(B),xt.test(D)?B++:(D=t,ge===0&&ke(oi));D!==t;)O.push(D),D=n.charAt(B),xt.test(D)?B++:(D=t,ge===0&&ke(oi));return ge--,D=t,ge===0&&ke(Ii),O}function on(){var O,D,R,ee;return O=B,D=xe(),n.charCodeAt(B)===44?(R=c,B++):(R=t,ge===0&&ke(In)),R!==t?(ee=xe(),D=[D,R,ee],O=D):(B=O,O=t),O}function As(){var O,D,R,ee;return O=B,D=xe(),n.charCodeAt(B)===124?(R=u,B++):(R=t,ge===0&&ke(Se)),R!==t?(ee=xe(),D=[D,R,ee],O=D):(B=O,O=t),O}function Gd(){var O,D,R,ee;return O=B,D=xe(),n.charCodeAt(B)===46?(R=a,B++):(R=t,ge===0&&ke(en)),R!==t?(ee=xe(),D=[D,R,ee],O=D):(B=O,O=t),O}function Sr(){var O;return O=n.charAt(B),ai.test(O)?B++:(O=t,ge===0&&ke(Zt)),O}function ro(){var O;return ge++,O=n.charAt(B),Tn.test(O)?B++:(O=t,ge===0&&ke(bt)),ge--,O===t&&ge===0&&ke(Ne),O}function Wd(){var O,D,R,ee;if(O=B,xe(),D=[],R=ro(),R!==t)for(;R!==t;)D.push(R),R=ro();else D=t;return D!==t?(R=xe(),_e=B,ee=Gs(D),ee?ee=t:ee=void 0,ee!==t?(_e=O,O=Kr(D)):(B=O,O=t)):(B=O,O=t),O}function nb(){var O,D,R,ee;return O=B,xe(),n.charCodeAt(B)===91?(D=h,B++):(D=t,ge===0&&ke(et)),D!==t?(xe(),R=Yd(),R!==t?(xe(),n.charCodeAt(B)===93?(ee=d,B++):(ee=t,ge===0&&ke(ei)),ee!==t?(xe(),_e=O,O=iu(R)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t),O}function ib(){var O,D,R,ee,Qe;return O=B,xe(),n.charCodeAt(B)===123?(D=f,B++):(D=t,ge===0&&ke(xs)),D!==t?(xe(),R=Hd(),R!==t?(xe(),n.charCodeAt(B)===125?(ee=m,B++):(ee=t,ge===0&&ke(gn)),ee!==t?(Qe=sb(),Qe===t&&(Qe=null),xe(),_e=O,O=Ws(R,Qe)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t),O}function sb(){var O,D,R;return O=B,n.charCodeAt(B)===37?(D=g,B++):(D=t,ge===0&&ke(li)),D!==t?(R=wr(),R!==t?(_e=O,O=br(R)):(B=O,O=t)):(B=O,O=t),O}function rb(){var O,D,R,ee;return O=B,xe(),n.charCodeAt(B)===60?(D=y,B++):(D=t,ge===0&&ke(Vn)),D!==t?(xe(),R=Hd(),R!==t?(xe(),n.charCodeAt(B)===62?(ee=b,B++):(ee=t,ge===0&&ke(Mt)),ee!==t?(xe(),_e=O,O=su(R)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t),O}function wr(){var O;return O=Wd(),O===t&&(O=nb(),O===t&&(O=ib(),O===t&&(O=rb()))),O}function Xd(){var O;return O=ab(),O===t&&(O=lb(),O===t&&(O=ub(),O===t&&(O=cb(),O===t&&(O=ob(),O===t&&(O=hb(),O===t&&(O=db(),O===t&&(O=fb()))))))),O}function ab(){var O,D,R;return O=B,xe(),D=n.charAt(B),Nt.test(D)?B++:(D=t,ge===0&&ke(Vi)),D!==t?(R=wn(),R===t&&(R=null),_e=O,O=ru(R)):(B=O,O=t),O}function ob(){var O,D,R;return O=B,xe(),n.charCodeAt(B)===33?(D=P,B++):(D=t,ge===0&&ke(Cs)),D!==t?(R=wn(),R===t&&(R=null),_e=O,O=io(R)):(B=O,O=t),O}function lb(){var O,D,R,ee,Qe,jt,xi;return O=B,n.charCodeAt(B)===40?(D=k,B++):(D=t,ge===0&&ke(St)),D!==t?(xe(),R=Jr(),R!==t?(xe(),ee=on(),ee!==t?(xe(),Qe=Jr(),Qe!==t?(xe(),on(),xe(),jt=Jr(),jt===t&&(jt=null),xe(),n.charCodeAt(B)===41?(xi=w,B++):(xi=t,ge===0&&ke(mt)),xi!==t?(_e=O,O=so(R,Qe,jt)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t),O}function ub(){var O,D,R;return O=B,n.charCodeAt(B)===47?(D=C,B++):(D=t,ge===0&&ke(Ht)),D!==t?(R=wr(),R!==t?(_e=O,O=M(R)):(B=O,O=t)):(B=O,O=t),O}function cb(){var O,D,R;return O=B,n.charCodeAt(B)===42?(D=$,B++):(D=t,ge===0&&ke(K)),D!==t?(R=wr(),R!==t?(_e=O,O=_(R)):(B=O,O=t)):(B=O,O=t),O}function hb(){var O,D,R;return O=B,n.charCodeAt(B)===63?(D=A,B++):(D=t,ge===0&&ke(te)),D!==t?(R=wn(),R===t&&(R=null),_e=O,O=T(R)):(B=O,O=t),O}function db(){var O,D,R;return O=B,n.charCodeAt(B)===58?(D=Q,B++):(D=t,ge===0&&ke(H)),D!==t?(R=wr(),R!==t?(_e=O,O=N(R)):(B=O,O=t)):(B=O,O=t),O}function fb(){var O,D,R;return O=B,n.substr(B,2)===q?(D=q,B+=2):(D=t,ge===0&&ke(ce)),D!==t?(R=wr(),R!==t?(_e=O,O=L(R)):(B=O,O=t)):(B=O,O=t),O}function Jr(){var O,D,R,ee;if(O=B,D=wr(),D!==t){for(R=[],ee=Xd();ee!==t;)R.push(ee),ee=Xd();_e=O,O=z(D,R)}else B=O,O=t;return O}function ks(){var O,D,R,ee;if(O=B,n.charCodeAt(B)===94?(D=W,B++):(D=t,ge===0&&ke(p)),D===t&&(D=null),R=[],ee=Jr(),ee!==t)for(;ee!==t;)R.push(ee),ee=Jr();else R=t;return R!==t?(_e=O,O=V(D,R)):(B=O,O=t),O}function Ud(){var O,D,R,ee,Qe;if(O=B,D=[],R=B,ee=on(),ee!==t?(Qe=ks(),Qe!==t?R=Qe:(B=R,R=t)):(B=R,R=t),R!==t)for(;R!==t;)D.push(R),R=B,ee=on(),ee!==t?(Qe=ks(),Qe!==t?R=Qe:(B=R,R=t)):(B=R,R=t);else D=t;return D!==t&&(_e=O,D=G(D)),O=D,O}function pb(){var O,D,R,ee,Qe;if(O=B,D=[],R=B,ee=As(),ee!==t?(Qe=ks(),Qe!==t?R=Qe:(B=R,R=t)):(B=R,R=t),R!==t)for(;R!==t;)D.push(R),R=B,ee=As(),ee!==t?(Qe=ks(),Qe!==t?R=Qe:(B=R,R=t)):(B=R,R=t);else D=t;return D!==t&&(_e=O,D=ae(D)),O=D,O}function mb(){var O,D,R,ee,Qe;if(O=B,D=[],R=B,ee=Gd(),ee!==t?(Qe=ks(),Qe!==t?R=Qe:(B=R,R=t)):(B=R,R=t),R!==t)for(;R!==t;)D.push(R),R=B,ee=Gd(),ee!==t?(Qe=ks(),Qe!==t?R=Qe:(B=R,R=t)):(B=R,R=t);else D=t;return D!==t&&(_e=O,D=pe(D)),O=D,O}function Yd(){var O,D,R;return O=B,D=ks(),D!==t?(R=Ud(),R===t&&(R=pb(),R===t&&(R=mb())),R===t&&(R=null),_e=O,O=se(D,R)):(B=O,O=t),O}function Hd(){var O,D,R;return O=B,D=ks(),D!==t?(R=Ud(),R===t&&(R=null),_e=O,O=de(D,R)):(B=O,O=t),O}function gb(){var O,D,R,ee;return O=B,xe(),D=Sr(),D!==t?(xe(),R=Yd(),R!==t?(xe(),ee=Sr(),ee!==t?(_e=O,O=He(R)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t),O}function Ob(){var O;return O=Cb(),O===t&&(O=Sb(),O===t&&(O=xb(),O===t&&(O=bb(),O===t&&(O=vb(),O===t&&(O=yb(),O===t&&(O=Pb(),O===t&&(O=wb()))))))),O}function yb(){var O,D,R;return O=B,n.substr(B,6)===U?(D=U,B+=6):(D=t,ge===0&&ke(S)),D!==t?(xe(),R=Pr(),R!==t?(_e=O,O=We(R)):(B=O,O=t)):(B=O,O=t),O}function bb(){var O,D,R,ee,Qe;return O=B,n.substr(B,6)===Z?(D=Z,B+=6):(D=t,ge===0&&ke(v)),D!==t?(xe(),R=Sr(),R!==t?(ee=Wd(),ee!==t?(Qe=Sr(),Qe!==t?(_e=O,O=Ge(ee)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t),O}function vb(){var O,D,R,ee;return O=B,n.substr(B,6)===Y?(D=Y,B+=6):(D=t,ge===0&&ke(x)),D!==t?(xe(),R=Yt(),R!==t?(xe(),ee=Yt(),ee!==t?(xe(),Yt(),_e=O,O=Ae(R,ee)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t),O}function Sb(){var O,D,R;return O=B,n.substr(B,4)===ne?(D=ne,B+=4):(D=t,ge===0&&ke(F)),D!==t?(xe(),R=wn(),R!==t?(_e=O,O=fe(R)):(B=O,O=t)):(B=O,O=t),O}function wb(){var O,D,R;return O=B,n.substr(B,4)===re?(D=re,B+=4):(D=t,ge===0&&ke(X)),D!==t?(xe(),R=wn(),R!==t?(_e=O,O=oe(R)):(B=O,O=t)):(B=O,O=t),O}function Pb(){var O,D,R;return O=B,n.substr(B,4)===ve?(D=ve,B+=4):(D=t,ge===0&&ke(J)),D!==t?(xe(),R=wn(),R!==t?(_e=O,O=Ve(R)):(B=O,O=t)):(B=O,O=t),O}function xb(){var O,D,R;return O=B,n.substr(B,4)===Ce?(D=Ce,B+=4):(D=t,ge===0&&ke(ie)),D!==t?(xe(),R=wn(),R!==t?(_e=O,O=je(R)):(B=O,O=t)):(B=O,O=t),O}function Cb(){var O,D,R,ee,Qe;if(O=B,n.substr(B,5)===De?(D=De,B+=5):(D=t,ge===0&&ke(be)),D!==t)if(xe(),R=Sr(),R!==t){if(ee=[],Qe=ro(),Qe!==t)for(;Qe!==t;)ee.push(Qe),Qe=ro();else ee=t;ee!==t?(Qe=Sr(),Qe!==t?(_e=O,O=gt(ee)):(B=O,O=t)):(B=O,O=t)}else B=O,O=t;else B=O,O=t;return O}function au(){var O,D,R,ee;if(O=B,n.substr(B,2)===Ue?(D=Ue,B+=2):(D=t,ge===0&&ke(Ie)),D!==t){for(R=[],ee=n.charAt(B),mn.test(ee)?B++:(ee=t,ge===0&&ke(Ct));ee!==t;)R.push(ee),ee=n.charAt(B),mn.test(ee)?B++:(ee=t,ge===0&&ke(Ct));D=[D,R],O=D}else B=O,O=t;return O}function Ab(){var O,D,R,ee,Qe,jt,xi,xr;if(O=B,n.substr(B,3)===Pt?(D=Pt,B+=3):(D=t,ge===0&&ke(_n)),D!==t)if(xe(),n.charCodeAt(B)===91?(R=h,B++):(R=t,ge===0&&ke(et)),R!==t)if(xe(),ee=Pr(),ee!==t){for(Qe=[],jt=B,xi=on(),xi!==t?(xr=Pr(),xr!==t?(_e=jt,jt=st(ee,xr)):(B=jt,jt=t)):(B=jt,jt=t);jt!==t;)Qe.push(jt),jt=B,xi=on(),xi!==t?(xr=Pr(),xr!==t?(_e=jt,jt=st(ee,xr)):(B=jt,jt=t)):(B=jt,jt=t);jt=xe(),n.charCodeAt(B)===93?(xi=d,B++):(xi=t,ge===0&&ke(ei)),xi!==t?(_e=O,O=it(ee,Qe)):(B=O,O=t)}else B=O,O=t;else B=O,O=t;else B=O,O=t;return O}function kb(){var O;return O=Ab(),O===t&&(O=gb()),O}function Pr(){var O,D,R,ee,Qe;if(O=B,D=kb(),D!==t){for(xe(),R=[],ee=au();ee!==t;)R.push(ee),ee=au();_e=O,O=Tt(D)}else B=O,O=t;return O===t&&(O=B,D=Ob(),D!==t?(xe(),n.charCodeAt(B)===36?(R=yt,B++):(R=t,ge===0&&ke(Fn)),R!==t?(ee=xe(),Qe=Pr(),Qe!==t?(_e=O,O=Me(D,Qe)):(B=O,O=t)):(B=O,O=t)):(B=O,O=t)),O}function Eb(){var O,D;return O=B,D=Pr(),D!==t&&(_e=O,D=Qt(D)),O=D,O===t&&(O=au()),O}function $b(){var O;return O=Eb(),O}function Db(){var O,D;return O=B,xe(),D=Mb(),D===t&&(D=Tb(),D===t&&(D=_b())),D!==t?(xe(),_e=O,O=_t(D)):(B=O,O=t),O}function Mb(){var O,D,R;return O=B,n.substr(B,6)===ue?(D=ue,B+=6):(D=t,ge===0&&ke(Si)),D!==t?(xe(),R=wn(),R!==t?(_e=O,O=we(R)):(B=O,O=t)):(B=O,O=t),O}function Tb(){var O,D,R;return O=B,n.substr(B,6)===Je?(D=Je,B+=6):(D=t,ge===0&&ke(wi)),D!==t?(xe(),R=wn(),R!==t?(_e=O,O=Ft(R)):(B=O,O=t)):(B=O,O=t),O}function _b(){var O,D;return O=B,n.substr(B,4)===he?(D=he,B+=4):(D=t,ge===0&&ke(zn)),D!==t&&(_e=O,D=Zi()),O=D,O}function Fb(){var O;return O=$b(),O===t&&(O=Db()),O}var Bb=function(O){this.type_="atom",this.source_=O,this.location_=lt()},ao=function(O,D,R,ee){this.type_="pattern",this.arguments_={alignment:D,_steps:ee},R!==void 0&&(this.arguments_.seed=R),this.source_=O},Nb=function(O,D,R){this.type_=O,this.arguments_=D,this.source_=R},Qb=function(O,D){this.type_="element",this.source_=O,this.options_=D,this.location_=lt()},ou=function(O,D){this.type_="command",this.name_=O,this.options_=D},lu=0;if(Le=r(),e.peg$library)return{peg$result:Le,peg$currPos:B,peg$FAILED:t,peg$maxFailExpected:Te,peg$maxFailPos:Ke};if(Le!==t&&B===n.length)return Le;throw Le!==t&&B<n.length&&ke(On()),wt(Te,Ke<n.length?n.charAt(Ke):null,Ke<n.length?rt(Ke,Ke+1):rt(Ke,Ke))}typeof BigInt>"u"&&(BigInt=function(n){if(isNaN(n))throw new Error("");return n});const Re=BigInt(0),tt=BigInt(1),Va=BigInt(2),Bh=BigInt(5),Xn=BigInt(10),tD=2e3,ye={s:tt,n:Re,d:tt};function fs(n,e){try{n=BigInt(n)}catch{throw Es()}return n*e}function Ci(n){return typeof n=="bigint"?n:Math.floor(n)}function qt(n,e){if(e===Re)throw Nd();const t=Object.create(zt.prototype);t.s=n<Re?-tt:tt,n=n<Re?-n:n;const i=Js(n,e);return t.n=n/i,t.d=e/i,t}function Cr(n){const e={};let t=n,i=Va,s=Bh-tt;for(;s<=t;){for(;t%i===Re;)t/=i,e[i]=(e[i]||Re)+tt;s+=tt+Va*i++}return t!==n?t>1&&(e[t]=(e[t]||Re)+tt):e[n]=(e[n]||Re)+tt,e}const fn=function(n,e){let t=Re,i=tt,s=tt;if(n!=null)if(e!==void 0){if(typeof n=="bigint")t=n;else{if(isNaN(n))throw Es();if(n%1!==0)throw Sm();t=BigInt(n)}if(typeof e=="bigint")i=e;else{if(isNaN(e))throw Es();if(e%1!==0)throw Sm();i=BigInt(e)}s=t*i}else if(typeof n=="object"){if("d"in n&&"n"in n)t=BigInt(n.n),i=BigInt(n.d),"s"in n&&(t*=BigInt(n.s));else if(0 in n)t=BigInt(n[0]),1 in n&&(i=BigInt(n[1]));else if(typeof n=="bigint")t=n;else throw Es();s=t*i}else if(typeof n=="number"){if(isNaN(n))throw Es();if(n<0&&(s=-tt,n=-n),n%1===0)t=BigInt(n);else if(n>0){let r=1,a=0,o=1,l=1,c=1,u=1e7;for(n>=1&&(r=10**Math.floor(1+Math.log10(n)),n/=r);o<=u&&c<=u;){let h=(a+l)/(o+c);if(n===h){o+c<=u?(t=a+l,i=o+c):c>o?(t=l,i=c):(t=a,i=o);break}else n>h?(a+=l,o+=c):(l+=a,c+=o),o>u?(t=l,i=c):(t=a,i=o)}t=BigInt(t)*BigInt(r),i=BigInt(i)}}else if(typeof n=="string"){let r=0,a=Re,o=Re,l=Re,c=tt,u=tt,h=n.replace(/_/g,"").match(/\d+|./g);if(h===null)throw Es();if(h[r]==="-"?(s=-tt,r++):h[r]==="+"&&r++,h.length===r+1?o=fs(h[r++],s):h[r+1]==="."||h[r]==="."?(h[r]!=="."&&(a=fs(h[r++],s)),r++,(r+1===h.length||h[r+1]==="("&&h[r+3]===")"||h[r+1]==="'"&&h[r+3]==="'")&&(o=fs(h[r],s),c=Xn**BigInt(h[r].length),r++),(h[r]==="("&&h[r+2]===")"||h[r]==="'"&&h[r+2]==="'")&&(l=fs(h[r+1],s),u=Xn**BigInt(h[r+1].length)-tt,r+=3)):h[r+1]==="/"||h[r+1]===":"?(o=fs(h[r],s),c=fs(h[r+2],tt),r+=3):h[r+3]==="/"&&h[r+1]===" "&&(a=fs(h[r],s),o=fs(h[r+2],s),c=fs(h[r+4],tt),r+=5),h.length<=r)i=c*u,s=t=l+i*a+u*o;else throw Es()}else if(typeof n=="bigint")t=n,s=n,i=tt;else throw Es();if(i===Re)throw Nd();ye.s=s<Re?-tt:tt,ye.n=t<Re?-t:t,ye.d=i<Re?-i:i};function nD(n,e,t){let i=tt;for(;e>Re;n=n*n%t,e>>=tt)e&tt&&(i=i*n%t);return i}function iD(n,e){for(;e%Va===Re;e/=Va);for(;e%Bh===Re;e/=Bh);if(e===tt)return Re;let t=Xn%e,i=1;for(;t!==tt;i++)if(t=t*Xn%e,i>tD)return Re;return BigInt(i)}function sD(n,e,t){let i=tt,s=nD(Xn,t,e);for(let r=0;r<300;r++){if(i===s)return BigInt(r);i=i*Xn%e,s=s*Xn%e}return 0}function Js(n,e){if(!n)return e;if(!e)return n;for(;;){if(n%=e,!n)return e;if(e%=n,!e)return n}}function zt(n,e){if(fn(n,e),this instanceof zt)n=Js(ye.d,ye.n),this.s=ye.s,this.n=ye.n/n,this.d=ye.d/n;else return qt(ye.s*ye.n,ye.d)}var Nd=function(){return new Error("Division by Zero")},Es=function(){return new Error("Invalid argument")},Sm=function(){return new Error("Parameters must be integer")};zt.prototype={s:tt,n:Re,d:tt,abs:function(){return qt(this.n,this.d)},neg:function(){return qt(-this.s*this.n,this.d)},add:function(n,e){return fn(n,e),qt(this.s*this.n*ye.d+ye.s*this.d*ye.n,this.d*ye.d)},sub:function(n,e){return fn(n,e),qt(this.s*this.n*ye.d-ye.s*this.d*ye.n,this.d*ye.d)},mul:function(n,e){return fn(n,e),qt(this.s*ye.s*this.n*ye.n,this.d*ye.d)},div:function(n,e){return fn(n,e),qt(this.s*ye.s*this.n*ye.d,this.d*ye.n)},clone:function(){return qt(this.s*this.n,this.d)},mod:function(n,e){if(n===void 0)return qt(this.s*this.n%this.d,tt);if(fn(n,e),Re===ye.n*this.d)throw Nd();return qt(this.s*(ye.d*this.n)%(ye.n*this.d),ye.d*this.d)},gcd:function(n,e){return fn(n,e),qt(Js(ye.n,this.n)*Js(ye.d,this.d),ye.d*this.d)},lcm:function(n,e){return fn(n,e),ye.n===Re&&this.n===Re?qt(Re,tt):qt(ye.n*this.n,Js(ye.n,this.n)*Js(ye.d,this.d))},inverse:function(){return qt(this.s*this.d,this.n)},pow:function(n,e){if(fn(n,e),ye.d===tt)return ye.s<Re?qt((this.s*this.d)**ye.n,this.n**ye.n):qt((this.s*this.n)**ye.n,this.d**ye.n);if(this.s<Re)return null;let t=Cr(this.n),i=Cr(this.d),s=tt,r=tt;for(let a in t)if(a!=="1"){if(a==="0"){s=Re;break}if(t[a]*=ye.n,t[a]%ye.d===Re)t[a]/=ye.d;else return null;s*=BigInt(a)**t[a]}for(let a in i)if(a!=="1"){if(i[a]*=ye.n,i[a]%ye.d===Re)i[a]/=ye.d;else return null;r*=BigInt(a)**i[a]}return ye.s<Re?qt(r,s):qt(s,r)},log:function(n,e){if(fn(n,e),this.s<=Re||ye.s<=Re)return null;const t={},i=Cr(ye.n),s=Cr(ye.d),r=Cr(this.n),a=Cr(this.d);for(const c in s)i[c]=(i[c]||Re)-s[c];for(const c in a)r[c]=(r[c]||Re)-a[c];for(const c in i)c!=="1"&&(t[c]=!0);for(const c in r)c!=="1"&&(t[c]=!0);let o=null,l=null;for(const c in t){const u=i[c]||Re,h=r[c]||Re;if(u===Re){if(h!==Re)return null;continue}let d=h,f=u;const m=Js(d,f);if(d/=m,f/=m,o===null&&l===null)o=d,l=f;else if(d*l!==o*f)return null}return o!==null&&l!==null?qt(o,l):null},equals:function(n,e){return fn(n,e),this.s*this.n*ye.d===ye.s*ye.n*this.d},lt:function(n,e){return fn(n,e),this.s*this.n*ye.d<ye.s*ye.n*this.d},lte:function(n,e){return fn(n,e),this.s*this.n*ye.d<=ye.s*ye.n*this.d},gt:function(n,e){return fn(n,e),this.s*this.n*ye.d>ye.s*ye.n*this.d},gte:function(n,e){return fn(n,e),this.s*this.n*ye.d>=ye.s*ye.n*this.d},compare:function(n,e){fn(n,e);let t=this.s*this.n*ye.d-ye.s*ye.n*this.d;return(Re<t)-(t<Re)},ceil:function(n){return n=Xn**BigInt(n||0),qt(Ci(this.s*n*this.n/this.d)+(n*this.n%this.d>Re&&this.s>=Re?tt:Re),n)},floor:function(n){return n=Xn**BigInt(n||0),qt(Ci(this.s*n*this.n/this.d)-(n*this.n%this.d>Re&&this.s<Re?tt:Re),n)},round:function(n){return n=Xn**BigInt(n||0),qt(Ci(this.s*n*this.n/this.d)+this.s*((this.s>=Re?tt:Re)+Va*(n*this.n%this.d)>this.d?tt:Re),n)},roundTo:function(n,e){fn(n,e);const t=this.n*ye.d,i=this.d*ye.n,s=t%i;let r=Ci(t/i);return s+s>=i&&r++,qt(this.s*r*ye.n,ye.d)},divisible:function(n,e){return fn(n,e),!(!(ye.n*this.d)||this.n*ye.d%(ye.n*this.d))},valueOf:function(){return Number(this.s*this.n)/Number(this.d)},toString:function(n){let e=this.n,t=this.d;n=n||15;let i=iD(e,t),s=sD(e,t,i),r=this.s<Re?"-":"";if(r+=Ci(e/t),e%=t,e*=Xn,e&&(r+="."),i){for(let a=s;a--;)r+=Ci(e/t),e%=t,e*=Xn;r+="(";for(let a=i;a--;)r+=Ci(e/t),e%=t,e*=Xn;r+=")"}else for(let a=n;e&&a--;)r+=Ci(e/t),e%=t,e*=Xn;return r},toFraction:function(n){let e=this.n,t=this.d,i=this.s<Re?"-":"";if(t===tt)i+=e;else{let s=Ci(e/t);n&&s>Re&&(i+=s,i+=" ",e%=t),i+=e,i+="/",i+=t}return i},toLatex:function(n){let e=this.n,t=this.d,i=this.s<Re?"-":"";if(t===tt)i+=e;else{let s=Ci(e/t);n&&s>Re&&(i+=s,e%=t),i+="\\frac{",i+=e,i+="}{",i+=t,i+="}"}return i},toContinued:function(){let n=this.n,e=this.d,t=[];do{t.push(Ci(n/e));let i=n%e;n=e,e=i}while(n!==tt);return t},simplify:function(n){const e=BigInt(1/(n||.001)|0),t=this.abs(),i=t.toContinued();for(let s=1;s<i.length;s++){let r=qt(i[s-1],tt);for(let o=s-2;o>=0;o--)r=r.inverse().add(i[o]);let a=r.sub(t);if(a.n*e<a.d)return r.mul(this.s)}return this}};class Ui{constructor(e,t){this.begin=Fs(e),this.end=Fs(t)}get spanCycles(){const e=[];var t=this.begin;const i=this.end,s=i.sam();if(t.equals(i))return[new Ui(t,i)];for(;i.gt(t);){if(t.sam().equals(s)){e.push(new Ui(t,this.end));break}const r=t.nextSam();e.push(new Ui(t,r)),t=r}return e}get duration(){return this.end.sub(this.begin)}cycleArc(){const e=this.begin.cyclePos(),t=e.add(this.duration);return new Ui(e,t)}withTime(e){return new Ui(e(this.begin),e(this.end))}withEnd(e){return new Ui(this.begin,e(this.end))}withCycle(e){const t=this.begin.sam(),i=t.add(e(this.begin.sub(t))),s=t.add(e(this.end.sub(t)));return new Ui(i,s)}intersection(e){const t=this.begin.max(e.begin),i=this.end.min(e.end);if(!t.gt(i)&&!(t.equals(i)&&(t.equals(this.end)&&this.begin.lt(this.end)||t.equals(e.end)&&e.begin.lt(e.end))))return new Ui(t,i)}intersection_e(e){const t=this.intersection(e);if(t==null)throw"TimeSpans do not intersect";return t}midpoint(){return this.begin.add(this.duration.div(Fs(2)))}equals(e){return this.begin.equals(e.begin)&&this.end.equals(e.end)}show(){return this.begin.show()+" → "+this.end.show()}}const rD=n=>n.filter(e=>e!=null);zt.prototype.sam=function(){return this.floor()};zt.prototype.nextSam=function(){return this.sam().add(1)};zt.prototype.wholeCycle=function(){return new Ui(this.sam(),this.nextSam())};zt.prototype.cyclePos=function(){return this.sub(this.sam())};zt.prototype.lt=function(n){return this.compare(n)<0};zt.prototype.gt=function(n){return this.compare(n)>0};zt.prototype.lte=function(n){return this.compare(n)<=0};zt.prototype.gte=function(n){return this.compare(n)>=0};zt.prototype.eq=function(n){return this.compare(n)==0};zt.prototype.ne=function(n){return this.compare(n)!=0};zt.prototype.max=function(n){return this.gt(n)?this:n};zt.prototype.maximum=function(...n){return n=n.map(e=>new zt(e)),n.reduce((e,t)=>t.max(e),this)};zt.prototype.min=function(n){return this.lt(n)?this:n};zt.prototype.mulmaybe=function(n){return n!==void 0?this.mul(n):void 0};zt.prototype.divmaybe=function(n){return n!==void 0?this.div(n):void 0};zt.prototype.addmaybe=function(n){return n!==void 0?this.add(n):void 0};zt.prototype.submaybe=function(n){return n!==void 0?this.sub(n):void 0};zt.prototype.show=function(){return this.s*this.n+"/"+this.d};zt.prototype.or=function(n){return this.eq(0)?n:this};const Fs=n=>zt(n),Ao=(...n)=>{if(n=rD(n),n.length===0)return;const e=n.pop();return n.reduce((t,i)=>t===void 0||i===void 0?void 0:t.lcm(i),e)};Fs._original=zt;const oy=3e-4,aD=(n,e)=>(t,i)=>{var a;const s=(a=n.source_[i].options_)==null?void 0:a.ops,r=t.__steps_source;if(s)for(const o of s)switch(o.type_){case"stretch":{const l=["fast","slow"],{type:c,amount:u}=o.arguments_;if(!l.includes(c))throw new Error(`mini: stretch: type must be one of ${l.join("|")} but got ${c}`);t=oo(t)[c](e(u));break}case"replicate":{const{amount:l}=o.arguments_;t=oo(t),t=t._repeatCycles(l)._fast(l);break}case"bjorklund":{o.arguments_.rotation?t=t.euclidRot(e(o.arguments_.pulse),e(o.arguments_.step),e(o.arguments_.rotation)):t=t.euclid(e(o.arguments_.pulse),e(o.arguments_.step));break}case"degradeBy":{t=oo(t)._degradeByWith(fg.early(oy*o.arguments_.seed),o.arguments_.amount??.5);break}case"tail":{const l=e(o.arguments_.element);t=t.fmap(c=>u=>Array.isArray(c)?[...c,u]:[c,u]).appLeft(l);break}case"range":{const l=e(o.arguments_.element);t=oo(t);const c=(u,h,d=1)=>Array.from({length:Math.abs(h-u)/d+1},(f,m)=>u<h?u+m*d:u-m*d);t=((u,h)=>u.squeezeBind(d=>h.bind(f=>dg(...c(d,f)))))(t,l);break}default:console.warn(`operator "${o.type_}" not implemented`)}return t.__steps_source=t.__steps_source||r,t};function ly(n,e,t,i=0){t==null||t(n);const s=r=>ly(r,e,t,i);switch(n.type_){case"pattern":{const r=n.source_.map(c=>s(c)).map(aD(n,s)),a=n.arguments_.alignment,o=r.filter(c=>c.__steps_source);let l;switch(a){case"stack":{l=hu(...r),o.length&&(l._steps=Ao(...o.map(c=>Fs(c._steps))));break}case"polymeter_slowcat":{l=hu(...r.map(c=>c._slow(c.__weight))),o.length&&(l._steps=Ao(...o.map(c=>Fs(c._steps))));break}case"polymeter":{const c=n.arguments_.stepsPerCycle?s(n.arguments_.stepsPerCycle).fmap(h=>ea(h)):cu(ea(r.length>0?r[0].__weight:1)),u=r.map(h=>h.fast(c.fmap(d=>d.div(h.__weight))));l=hu(...u);break}case"rand":{l=Ib(fg.early(oy*n.arguments_.seed).segment(1),r),o.length&&(l._steps=Ao(...o.map(c=>Fs(c._steps))));break}case"feet":{l=dg(...r);break}default:{if(n.source_.some(c=>{var u;return!!((u=c.options_)!=null&&u.weight)})){const c=n.source_.reduce((u,h)=>{var d;return u.add(((d=h.options_)==null?void 0:d.weight)||ea(1))},ea(0));l=Rb(...n.source_.map((u,h)=>{var d;return[((d=u.options_)==null?void 0:d.weight)||ea(1),r[h]]})),l.__weight=c,l._steps=c,o.length&&(l._steps=l._steps.mul(Ao(...o.map(u=>Fs(u._steps)))))}else l=Lb(...r),l._steps=r.length;n.arguments_._steps&&(l.__steps_source=!0)}}return o.length&&(l.__steps_source=!0),l}case"element":return s(n.source_);case"atom":{if(n.source_==="~"||n.source_==="-")return Kd;if(!n.location_)return console.warn("no location for",n),n.source_;const r=isNaN(Number(n.source_))?n.source_:Number(n.source_);if(i===-1)return cu(r);const[a,o]=uy(e,n,i);return cu(r).withLoc(a,o)}case"stretch":return s(n.source_).slow(s(n.arguments_.amount));default:return console.warn(`node type "${n.type_}" not implemented -> returning silence`),Kd}}const uy=(n,e,t=0)=>{const{start:i,end:s}=e.location_,r=n==null?void 0:n.split("").slice(i.offset,s.offset).join(""),[a=0,o=0]=r?r.split(e.source_).map(l=>l.split("").filter(c=>c===" ").length):[];return[i.offset+a+t,s.offset-o+t]},oD=(n,e=0,t=n)=>{try{return eD(n)}catch(i){const s=[i.location.start.offset+e,i.location.end.offset+e],r=t.slice(0,s[0]).split(`
`).length;throw new Error(`[mini] parse error at line ${r}: ${i.message}`)}},lD=(n,e,t)=>{const i=oD(n,e,t);let s=[];return ly(i,n,r=>{r.type_==="atom"&&s.push(r)},-1),s},cy=(n,e=0,t)=>lD(n,e,t).map(i=>uy(n,i,e));var uD=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,7,9,32,4,318,1,80,3,71,10,50,3,123,2,54,14,32,10,3,1,11,3,46,10,8,0,46,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,3,0,158,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,68,8,2,0,3,0,2,3,2,4,2,0,15,1,83,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,7,19,58,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,343,9,54,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,10,1,2,0,49,6,4,4,14,10,5350,0,7,14,11465,27,2343,9,87,9,39,4,60,6,26,9,535,9,470,0,2,54,8,3,82,0,12,1,19628,1,4178,9,519,45,3,22,543,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,101,0,161,6,10,9,357,0,62,13,499,13,245,1,2,9,726,6,110,6,6,9,4759,9,787719,239],hy=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,13,10,2,14,2,6,2,1,2,10,2,14,2,6,2,1,4,51,13,310,10,21,11,7,25,5,2,41,2,8,70,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,39,27,10,22,251,41,7,1,17,2,60,28,11,0,9,21,43,17,47,20,28,22,13,52,58,1,3,0,14,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,20,1,64,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,31,9,2,0,3,0,2,37,2,0,26,0,2,0,45,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,38,6,186,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,19,72,200,32,32,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,16,0,2,12,2,33,125,0,80,921,103,110,18,195,2637,96,16,1071,18,5,26,3994,6,582,6842,29,1763,568,8,30,18,78,18,29,19,47,17,3,32,20,6,18,433,44,212,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,42,9,8936,3,2,6,2,1,2,290,16,0,30,2,3,0,15,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,1845,30,7,5,262,61,147,44,11,6,17,0,322,29,19,43,485,27,229,29,3,0,496,6,2,3,2,1,2,14,2,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42719,33,4153,7,221,3,5761,15,7472,16,621,2467,541,1507,4938,6,4191],cD="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛ࢗ-࢟࣊-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄ఼ా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ೳഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-໎໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜕ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠏-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿ-ᫎᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷿‌‍‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯・꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿･",dy="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࡰ-ࢇࢉ-ࢎࢠ-ࣉऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౝౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೝೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜑᜟ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭌᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲊᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꟍꟐꟑꟓꟕ-Ƛꟲ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",Uu={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},Yu="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",hD={5:Yu,"5module":Yu+" export import",6:Yu+" const class extends export import super"},dD=/^in(stanceof)?$/,fD=new RegExp("["+dy+"]"),pD=new RegExp("["+dy+cD+"]");function Nh(n,e){for(var t=65536,i=0;i<e.length;i+=2){if(t+=e[i],t>n)return!1;if(t+=e[i+1],t>=n)return!0}return!1}function us(n,e){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&fD.test(String.fromCharCode(n)):e===!1?!1:Nh(n,hy)}function Zs(n,e){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n<=65535?n>=170&&pD.test(String.fromCharCode(n)):e===!1?!1:Nh(n,hy)||Nh(n,uD)}var Ot=function(e,t){t===void 0&&(t={}),this.label=e,this.keyword=t.keyword,this.beforeExpr=!!t.beforeExpr,this.startsExpr=!!t.startsExpr,this.isLoop=!!t.isLoop,this.isAssign=!!t.isAssign,this.prefix=!!t.prefix,this.postfix=!!t.postfix,this.binop=t.binop||null,this.updateContext=null};function ci(n,e){return new Ot(n,{beforeExpr:!0,binop:e})}var hi={beforeExpr:!0},Zn={startsExpr:!0},Qd={};function ft(n,e){return e===void 0&&(e={}),e.keyword=n,Qd[n]=new Ot(n,e)}var E={num:new Ot("num",Zn),regexp:new Ot("regexp",Zn),string:new Ot("string",Zn),name:new Ot("name",Zn),privateId:new Ot("privateId",Zn),eof:new Ot("eof"),bracketL:new Ot("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Ot("]"),braceL:new Ot("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Ot("}"),parenL:new Ot("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Ot(")"),comma:new Ot(",",hi),semi:new Ot(";",hi),colon:new Ot(":",hi),dot:new Ot("."),question:new Ot("?",hi),questionDot:new Ot("?."),arrow:new Ot("=>",hi),template:new Ot("template"),invalidTemplate:new Ot("invalidTemplate"),ellipsis:new Ot("...",hi),backQuote:new Ot("`",Zn),dollarBraceL:new Ot("${",{beforeExpr:!0,startsExpr:!0}),eq:new Ot("=",{beforeExpr:!0,isAssign:!0}),assign:new Ot("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Ot("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Ot("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:ci("||",1),logicalAND:ci("&&",2),bitwiseOR:ci("|",3),bitwiseXOR:ci("^",4),bitwiseAND:ci("&",5),equality:ci("==/!=/===/!==",6),relational:ci("</>/<=/>=",7),bitShift:ci("<</>>/>>>",8),plusMin:new Ot("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:ci("%",10),star:ci("*",10),slash:ci("/",10),starstar:new Ot("**",{beforeExpr:!0}),coalesce:ci("??",1),_break:ft("break"),_case:ft("case",hi),_catch:ft("catch"),_continue:ft("continue"),_debugger:ft("debugger"),_default:ft("default",hi),_do:ft("do",{isLoop:!0,beforeExpr:!0}),_else:ft("else",hi),_finally:ft("finally"),_for:ft("for",{isLoop:!0}),_function:ft("function",Zn),_if:ft("if"),_return:ft("return",hi),_switch:ft("switch"),_throw:ft("throw",hi),_try:ft("try"),_var:ft("var"),_const:ft("const"),_while:ft("while",{isLoop:!0}),_with:ft("with"),_new:ft("new",{beforeExpr:!0,startsExpr:!0}),_this:ft("this",Zn),_super:ft("super",Zn),_class:ft("class",Zn),_extends:ft("extends",hi),_export:ft("export"),_import:ft("import",Zn),_null:ft("null",Zn),_true:ft("true",Zn),_false:ft("false",Zn),_in:ft("in",{beforeExpr:!0,binop:7}),_instanceof:ft("instanceof",{beforeExpr:!0,binop:7}),_typeof:ft("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:ft("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:ft("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Kn=/\r\n?|\n|\u2028|\u2029/,mD=new RegExp(Kn.source,"g");function Xr(n){return n===10||n===13||n===8232||n===8233}function fy(n,e,t){t===void 0&&(t=n.length);for(var i=e;i<t;i++){var s=n.charCodeAt(i);if(Xr(s))return i<t-1&&s===13&&n.charCodeAt(i+1)===10?i+2:i+1}return-1}var py=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,kn=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,my=Object.prototype,gD=my.hasOwnProperty,OD=my.toString,Ur=Object.hasOwn||(function(n,e){return gD.call(n,e)}),wm=Array.isArray||(function(n){return OD.call(n)==="[object Array]"}),Pm=Object.create(null);function Bs(n){return Pm[n]||(Pm[n]=new RegExp("^(?:"+n.replace(/ /g,"|")+")$"))}function bs(n){return n<=65535?String.fromCharCode(n):(n-=65536,String.fromCharCode((n>>10)+55296,(n&1023)+56320))}var yD=/(?:[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/,za=function(e,t){this.line=e,this.column=t};za.prototype.offset=function(e){return new za(this.line,this.column+e)};var Yl=function(e,t,i){this.start=t,this.end=i,e.sourceFile!==null&&(this.source=e.sourceFile)};function gy(n,e){for(var t=1,i=0;;){var s=fy(n,i,e);if(s<0)return new za(t,e-i);++t,i=s}}var Qh={ecmaVersion:null,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:null,allowSuperOutsideMethod:null,allowHashBang:!1,checkPrivateFields:!0,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1},xm=!1;function bD(n){var e={};for(var t in Qh)e[t]=n&&Ur(n,t)?n[t]:Qh[t];if(e.ecmaVersion==="latest"?e.ecmaVersion=1e8:e.ecmaVersion==null?(!xm&&typeof console=="object"&&console.warn&&(xm=!0,console.warn(`Since Acorn 8.0.0, options.ecmaVersion is required.
Defaulting to 2020, but this will stop working in the future.`)),e.ecmaVersion=11):e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),e.allowReserved==null&&(e.allowReserved=e.ecmaVersion<5),(!n||n.allowHashBang==null)&&(e.allowHashBang=e.ecmaVersion>=14),wm(e.onToken)){var i=e.onToken;e.onToken=function(s){return i.push(s)}}return wm(e.onComment)&&(e.onComment=vD(e,e.onComment)),e}function vD(n,e){return function(t,i,s,r,a,o){var l={type:t?"Block":"Line",value:i,start:s,end:r};n.locations&&(l.loc=new Yl(this,a,o)),n.ranges&&(l.range=[s,r]),e.push(l)}}var Za=1,Yr=2,Rd=4,Oy=8,Ld=16,yy=32,Hl=64,by=128,yr=256,eo=512,Kl=Za|Yr|yr;function Id(n,e){return Yr|(n?Rd:0)|(e?Oy:0)}var yl=0,Vd=1,ws=2,vy=3,Sy=4,wy=5,dn=function(e,t,i){this.options=e=bD(e),this.sourceFile=e.sourceFile,this.keywords=Bs(hD[e.ecmaVersion>=6?6:e.sourceType==="module"?"5module":5]);var s="";e.allowReserved!==!0&&(s=Uu[e.ecmaVersion>=6?6:e.ecmaVersion===5?5:3],e.sourceType==="module"&&(s+=" await")),this.reservedWords=Bs(s);var r=(s?s+" ":"")+Uu.strict;this.reservedWordsStrict=Bs(r),this.reservedWordsStrictBind=Bs(r+" "+Uu.strictBind),this.input=String(t),this.containsEsc=!1,i?(this.pos=i,this.lineStart=this.input.lastIndexOf(`
`,i-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Kn).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=E.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=e.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.potentialArrowInForAwait=!1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports=Object.create(null),this.pos===0&&e.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Za),this.regexpState=null,this.privateNameStack=[]},cs={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},canAwait:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0},allowNewDotTarget:{configurable:!0},inClassStaticBlock:{configurable:!0}};dn.prototype.parse=function(){var e=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(e)};cs.inFunction.get=function(){return(this.currentVarScope().flags&Yr)>0};cs.inGenerator.get=function(){return(this.currentVarScope().flags&Oy)>0};cs.inAsync.get=function(){return(this.currentVarScope().flags&Rd)>0};cs.canAwait.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var e=this.scopeStack[n],t=e.flags;if(t&(yr|eo))return!1;if(t&Yr)return(t&Rd)>0}return this.inModule&&this.options.ecmaVersion>=13||this.options.allowAwaitOutsideFunction};cs.allowSuper.get=function(){var n=this.currentThisScope(),e=n.flags;return(e&Hl)>0||this.options.allowSuperOutsideMethod};cs.allowDirectSuper.get=function(){return(this.currentThisScope().flags&by)>0};cs.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())};cs.allowNewDotTarget.get=function(){for(var n=this.scopeStack.length-1;n>=0;n--){var e=this.scopeStack[n],t=e.flags;if(t&(yr|eo)||t&Yr&&!(t&Ld))return!0}return!1};cs.inClassStaticBlock.get=function(){return(this.currentVarScope().flags&yr)>0};dn.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];for(var i=this,s=0;s<e.length;s++)i=e[s](i);return i};dn.parse=function(e,t){return new this(t,e).parse()};dn.parseExpressionAt=function(e,t,i){var s=new this(i,e,t);return s.nextToken(),s.parseExpression()};dn.tokenizer=function(e,t){return new this(t,e)};Object.defineProperties(dn.prototype,cs);var Ln=dn.prototype,SD=/^(?:'((?:\\[^]|[^'\\])*?)'|"((?:\\[^]|[^"\\])*?)")/;Ln.strictDirective=function(n){if(this.options.ecmaVersion<5)return!1;for(;;){kn.lastIndex=n,n+=kn.exec(this.input)[0].length;var e=SD.exec(this.input.slice(n));if(!e)return!1;if((e[1]||e[2])==="use strict"){kn.lastIndex=n+e[0].length;var t=kn.exec(this.input),i=t.index+t[0].length,s=this.input.charAt(i);return s===";"||s==="}"||Kn.test(t[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(s)||s==="!"&&this.input.charAt(i+1)==="=")}n+=e[0].length,kn.lastIndex=n,n+=kn.exec(this.input)[0].length,this.input[n]===";"&&n++}};Ln.eat=function(n){return this.type===n?(this.next(),!0):!1};Ln.isContextual=function(n){return this.type===E.name&&this.value===n&&!this.containsEsc};Ln.eatContextual=function(n){return this.isContextual(n)?(this.next(),!0):!1};Ln.expectContextual=function(n){this.eatContextual(n)||this.unexpected()};Ln.canInsertSemicolon=function(){return this.type===E.eof||this.type===E.braceR||Kn.test(this.input.slice(this.lastTokEnd,this.start))};Ln.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0};Ln.semicolon=function(){!this.eat(E.semi)&&!this.insertSemicolon()&&this.unexpected()};Ln.afterTrailingComma=function(n,e){if(this.type===n)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0};Ln.expect=function(n){this.eat(n)||this.unexpected()};Ln.unexpected=function(n){this.raise(n??this.start,"Unexpected token")};var Jl=function(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1};Ln.checkPatternErrors=function(n,e){if(n){n.trailingComma>-1&&this.raiseRecoverable(n.trailingComma,"Comma is not permitted after the rest element");var t=e?n.parenthesizedAssign:n.parenthesizedBind;t>-1&&this.raiseRecoverable(t,e?"Assigning to rvalue":"Parenthesized pattern")}};Ln.checkExpressionErrors=function(n,e){if(!n)return!1;var t=n.shorthandAssign,i=n.doubleProto;if(!e)return t>=0||i>=0;t>=0&&this.raise(t,"Shorthand property assignments are valid only in destructuring patterns"),i>=0&&this.raiseRecoverable(i,"Redefinition of __proto__ property")};Ln.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")};Ln.isSimpleAssignTarget=function(n){return n.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(n.expression):n.type==="Identifier"||n.type==="MemberExpression"};var $e=dn.prototype;$e.parseTopLevel=function(n){var e=Object.create(null);for(n.body||(n.body=[]);this.type!==E.eof;){var t=this.parseStatement(null,!0,e);n.body.push(t)}if(this.inModule)for(var i=0,s=Object.keys(this.undefinedExports);i<s.length;i+=1){var r=s[i];this.raiseRecoverable(this.undefinedExports[r].start,"Export '"+r+"' is not defined")}return this.adaptDirectivePrologue(n.body),this.next(),n.sourceType=this.options.sourceType,this.finishNode(n,"Program")};var zd={kind:"loop"},wD={kind:"switch"};$e.isLet=function(n){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;kn.lastIndex=this.pos;var e=kn.exec(this.input),t=this.pos+e[0].length,i=this.input.charCodeAt(t);if(i===91||i===92)return!0;if(n)return!1;if(i===123||i>55295&&i<56320)return!0;if(us(i,!0)){for(var s=t+1;Zs(i=this.input.charCodeAt(s),!0);)++s;if(i===92||i>55295&&i<56320)return!0;var r=this.input.slice(t,s);if(!dD.test(r))return!0}return!1};$e.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;kn.lastIndex=this.pos;var n=kn.exec(this.input),e=this.pos+n[0].length,t;return!Kn.test(this.input.slice(this.pos,e))&&this.input.slice(e,e+8)==="function"&&(e+8===this.input.length||!(Zs(t=this.input.charCodeAt(e+8))||t>55295&&t<56320))};$e.isUsingKeyword=function(n,e){if(this.options.ecmaVersion<17||!this.isContextual(n?"await":"using"))return!1;kn.lastIndex=this.pos;var t=kn.exec(this.input),i=this.pos+t[0].length;if(Kn.test(this.input.slice(this.pos,i)))return!1;if(n){var s=i+5,r;if(this.input.slice(i,s)!=="using"||s===this.input.length||Zs(r=this.input.charCodeAt(s))||r>55295&&r<56320)return!1;kn.lastIndex=s;var a=kn.exec(this.input);if(a&&Kn.test(this.input.slice(s,s+a[0].length)))return!1}if(e){var o=i+2,l;if(this.input.slice(i,o)==="of"&&(o===this.input.length||!Zs(l=this.input.charCodeAt(o))&&!(l>55295&&l<56320)))return!1}var c=this.input.charCodeAt(i);return us(c,!0)||c===92};$e.isAwaitUsing=function(n){return this.isUsingKeyword(!0,n)};$e.isUsing=function(n){return this.isUsingKeyword(!1,n)};$e.parseStatement=function(n,e,t){var i=this.type,s=this.startNode(),r;switch(this.isLet(n)&&(i=E._var,r="let"),i){case E._break:case E._continue:return this.parseBreakContinueStatement(s,i.keyword);case E._debugger:return this.parseDebuggerStatement(s);case E._do:return this.parseDoStatement(s);case E._for:return this.parseForStatement(s);case E._function:return n&&(this.strict||n!=="if"&&n!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(s,!1,!n);case E._class:return n&&this.unexpected(),this.parseClass(s,!0);case E._if:return this.parseIfStatement(s);case E._return:return this.parseReturnStatement(s);case E._switch:return this.parseSwitchStatement(s);case E._throw:return this.parseThrowStatement(s);case E._try:return this.parseTryStatement(s);case E._const:case E._var:return r=r||this.value,n&&r!=="var"&&this.unexpected(),this.parseVarStatement(s,r);case E._while:return this.parseWhileStatement(s);case E._with:return this.parseWithStatement(s);case E.braceL:return this.parseBlock(!0,s);case E.semi:return this.parseEmptyStatement(s);case E._export:case E._import:if(this.options.ecmaVersion>10&&i===E._import){kn.lastIndex=this.pos;var a=kn.exec(this.input),o=this.pos+a[0].length,l=this.input.charCodeAt(o);if(l===40||l===46)return this.parseExpressionStatement(s,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===E._import?this.parseImport(s):this.parseExport(s,t);default:if(this.isAsyncFunction())return n&&this.unexpected(),this.next(),this.parseFunctionStatement(s,!0,!n);var c=this.isAwaitUsing(!1)?"await using":this.isUsing(!1)?"using":null;if(c)return e&&this.options.sourceType==="script"&&this.raise(this.start,"Using declaration cannot appear in the top level when source type is `script`"),c==="await using"&&(this.canAwait||this.raise(this.start,"Await using cannot appear outside of async function"),this.next()),this.next(),this.parseVar(s,!1,c),this.semicolon(),this.finishNode(s,"VariableDeclaration");var u=this.value,h=this.parseExpression();return i===E.name&&h.type==="Identifier"&&this.eat(E.colon)?this.parseLabeledStatement(s,u,h,n):this.parseExpressionStatement(s,h)}};$e.parseBreakContinueStatement=function(n,e){var t=e==="break";this.next(),this.eat(E.semi)||this.insertSemicolon()?n.label=null:this.type!==E.name?this.unexpected():(n.label=this.parseIdent(),this.semicolon());for(var i=0;i<this.labels.length;++i){var s=this.labels[i];if((n.label==null||s.name===n.label.name)&&(s.kind!=null&&(t||s.kind==="loop")||n.label&&t))break}return i===this.labels.length&&this.raise(n.start,"Unsyntactic "+e),this.finishNode(n,t?"BreakStatement":"ContinueStatement")};$e.parseDebuggerStatement=function(n){return this.next(),this.semicolon(),this.finishNode(n,"DebuggerStatement")};$e.parseDoStatement=function(n){return this.next(),this.labels.push(zd),n.body=this.parseStatement("do"),this.labels.pop(),this.expect(E._while),n.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(E.semi):this.semicolon(),this.finishNode(n,"DoWhileStatement")};$e.parseForStatement=function(n){this.next();var e=this.options.ecmaVersion>=9&&this.canAwait&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(zd),this.enterScope(0),this.expect(E.parenL),this.type===E.semi)return e>-1&&this.unexpected(e),this.parseFor(n,null);var t=this.isLet();if(this.type===E._var||this.type===E._const||t){var i=this.startNode(),s=t?"let":this.value;return this.next(),this.parseVar(i,!0,s),this.finishNode(i,"VariableDeclaration"),this.parseForAfterInit(n,i,e)}var r=this.isContextual("let"),a=!1,o=this.isUsing(!0)?"using":this.isAwaitUsing(!0)?"await using":null;if(o){var l=this.startNode();return this.next(),o==="await using"&&this.next(),this.parseVar(l,!0,o),this.finishNode(l,"VariableDeclaration"),this.parseForAfterInit(n,l,e)}var c=this.containsEsc,u=new Jl,h=this.start,d=e>-1?this.parseExprSubscripts(u,"await"):this.parseExpression(!0,u);return this.type===E._in||(a=this.options.ecmaVersion>=6&&this.isContextual("of"))?(e>-1?(this.type===E._in&&this.unexpected(e),n.await=!0):a&&this.options.ecmaVersion>=8&&(d.start===h&&!c&&d.type==="Identifier"&&d.name==="async"?this.unexpected():this.options.ecmaVersion>=9&&(n.await=!1)),r&&a&&this.raise(d.start,"The left-hand side of a for-of loop may not start with 'let'."),this.toAssignable(d,!1,u),this.checkLValPattern(d),this.parseForIn(n,d)):(this.checkExpressionErrors(u,!0),e>-1&&this.unexpected(e),this.parseFor(n,d))};$e.parseForAfterInit=function(n,e,t){return(this.type===E._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&e.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===E._in?t>-1&&this.unexpected(t):n.await=t>-1),this.parseForIn(n,e)):(t>-1&&this.unexpected(t),this.parseFor(n,e))};$e.parseFunctionStatement=function(n,e,t){return this.next(),this.parseFunction(n,ka|(t?0:Rh),!1,e)};$e.parseIfStatement=function(n){return this.next(),n.test=this.parseParenExpression(),n.consequent=this.parseStatement("if"),n.alternate=this.eat(E._else)?this.parseStatement("if"):null,this.finishNode(n,"IfStatement")};$e.parseReturnStatement=function(n){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(E.semi)||this.insertSemicolon()?n.argument=null:(n.argument=this.parseExpression(),this.semicolon()),this.finishNode(n,"ReturnStatement")};$e.parseSwitchStatement=function(n){this.next(),n.discriminant=this.parseParenExpression(),n.cases=[],this.expect(E.braceL),this.labels.push(wD),this.enterScope(0);for(var e,t=!1;this.type!==E.braceR;)if(this.type===E._case||this.type===E._default){var i=this.type===E._case;e&&this.finishNode(e,"SwitchCase"),n.cases.push(e=this.startNode()),e.consequent=[],this.next(),i?e.test=this.parseExpression():(t&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),t=!0,e.test=null),this.expect(E.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(n,"SwitchStatement")};$e.parseThrowStatement=function(n){return this.next(),Kn.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),n.argument=this.parseExpression(),this.semicolon(),this.finishNode(n,"ThrowStatement")};var PD=[];$e.parseCatchClauseParam=function(){var n=this.parseBindingAtom(),e=n.type==="Identifier";return this.enterScope(e?yy:0),this.checkLValPattern(n,e?Sy:ws),this.expect(E.parenR),n};$e.parseTryStatement=function(n){if(this.next(),n.block=this.parseBlock(),n.handler=null,this.type===E._catch){var e=this.startNode();this.next(),this.eat(E.parenL)?e.param=this.parseCatchClauseParam():(this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0)),e.body=this.parseBlock(!1),this.exitScope(),n.handler=this.finishNode(e,"CatchClause")}return n.finalizer=this.eat(E._finally)?this.parseBlock():null,!n.handler&&!n.finalizer&&this.raise(n.start,"Missing catch or finally clause"),this.finishNode(n,"TryStatement")};$e.parseVarStatement=function(n,e,t){return this.next(),this.parseVar(n,!1,e,t),this.semicolon(),this.finishNode(n,"VariableDeclaration")};$e.parseWhileStatement=function(n){return this.next(),n.test=this.parseParenExpression(),this.labels.push(zd),n.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(n,"WhileStatement")};$e.parseWithStatement=function(n){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),n.object=this.parseParenExpression(),n.body=this.parseStatement("with"),this.finishNode(n,"WithStatement")};$e.parseEmptyStatement=function(n){return this.next(),this.finishNode(n,"EmptyStatement")};$e.parseLabeledStatement=function(n,e,t,i){for(var s=0,r=this.labels;s<r.length;s+=1){var a=r[s];a.name===e&&this.raise(t.start,"Label '"+e+"' is already declared")}for(var o=this.type.isLoop?"loop":this.type===E._switch?"switch":null,l=this.labels.length-1;l>=0;l--){var c=this.labels[l];if(c.statementStart===n.start)c.statementStart=this.start,c.kind=o;else break}return this.labels.push({name:e,kind:o,statementStart:this.start}),n.body=this.parseStatement(i?i.indexOf("label")===-1?i+"label":i:"label"),this.labels.pop(),n.label=t,this.finishNode(n,"LabeledStatement")};$e.parseExpressionStatement=function(n,e){return n.expression=e,this.semicolon(),this.finishNode(n,"ExpressionStatement")};$e.parseBlock=function(n,e,t){for(n===void 0&&(n=!0),e===void 0&&(e=this.startNode()),e.body=[],this.expect(E.braceL),n&&this.enterScope(0);this.type!==E.braceR;){var i=this.parseStatement(null);e.body.push(i)}return t&&(this.strict=!1),this.next(),n&&this.exitScope(),this.finishNode(e,"BlockStatement")};$e.parseFor=function(n,e){return n.init=e,this.expect(E.semi),n.test=this.type===E.semi?null:this.parseExpression(),this.expect(E.semi),n.update=this.type===E.parenR?null:this.parseExpression(),this.expect(E.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,"ForStatement")};$e.parseForIn=function(n,e){var t=this.type===E._in;return this.next(),e.type==="VariableDeclaration"&&e.declarations[0].init!=null&&(!t||this.options.ecmaVersion<8||this.strict||e.kind!=="var"||e.declarations[0].id.type!=="Identifier")&&this.raise(e.start,(t?"for-in":"for-of")+" loop variable declaration may not have an initializer"),n.left=e,n.right=t?this.parseExpression():this.parseMaybeAssign(),this.expect(E.parenR),n.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(n,t?"ForInStatement":"ForOfStatement")};$e.parseVar=function(n,e,t,i){for(n.declarations=[],n.kind=t;;){var s=this.startNode();if(this.parseVarId(s,t),this.eat(E.eq)?s.init=this.parseMaybeAssign(e):!i&&t==="const"&&!(this.type===E._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():!i&&(t==="using"||t==="await using")&&this.options.ecmaVersion>=17&&this.type!==E._in&&!this.isContextual("of")?this.raise(this.lastTokEnd,"Missing initializer in "+t+" declaration"):!i&&s.id.type!=="Identifier"&&!(e&&(this.type===E._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):s.init=null,n.declarations.push(this.finishNode(s,"VariableDeclarator")),!this.eat(E.comma))break}return n};$e.parseVarId=function(n,e){n.id=e==="using"||e==="await using"?this.parseIdent():this.parseBindingAtom(),this.checkLValPattern(n.id,e==="var"?Vd:ws,!1)};var ka=1,Rh=2,Py=4;$e.parseFunction=function(n,e,t,i,s){this.initFunction(n),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!i)&&(this.type===E.star&&e&Rh&&this.unexpected(),n.generator=this.eat(E.star)),this.options.ecmaVersion>=8&&(n.async=!!i),e&ka&&(n.id=e&Py&&this.type!==E.name?null:this.parseIdent(),n.id&&!(e&Rh)&&this.checkLValSimple(n.id,this.strict||n.generator||n.async?this.treatFunctionsAsVar?Vd:ws:vy));var r=this.yieldPos,a=this.awaitPos,o=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Id(n.async,n.generator)),e&ka||(n.id=this.type===E.name?this.parseIdent():null),this.parseFunctionParams(n),this.parseFunctionBody(n,t,!1,s),this.yieldPos=r,this.awaitPos=a,this.awaitIdentPos=o,this.finishNode(n,e&ka?"FunctionDeclaration":"FunctionExpression")};$e.parseFunctionParams=function(n){this.expect(E.parenL),n.params=this.parseBindingList(E.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()};$e.parseClass=function(n,e){this.next();var t=this.strict;this.strict=!0,this.parseClassId(n,e),this.parseClassSuper(n);var i=this.enterClassBody(),s=this.startNode(),r=!1;for(s.body=[],this.expect(E.braceL);this.type!==E.braceR;){var a=this.parseClassElement(n.superClass!==null);a&&(s.body.push(a),a.type==="MethodDefinition"&&a.kind==="constructor"?(r&&this.raiseRecoverable(a.start,"Duplicate constructor in the same class"),r=!0):a.key&&a.key.type==="PrivateIdentifier"&&xD(i,a)&&this.raiseRecoverable(a.key.start,"Identifier '#"+a.key.name+"' has already been declared"))}return this.strict=t,this.next(),n.body=this.finishNode(s,"ClassBody"),this.exitClassBody(),this.finishNode(n,e?"ClassDeclaration":"ClassExpression")};$e.parseClassElement=function(n){if(this.eat(E.semi))return null;var e=this.options.ecmaVersion,t=this.startNode(),i="",s=!1,r=!1,a="method",o=!1;if(this.eatContextual("static")){if(e>=13&&this.eat(E.braceL))return this.parseClassStaticBlock(t),t;this.isClassElementNameStart()||this.type===E.star?o=!0:i="static"}if(t.static=o,!i&&e>=8&&this.eatContextual("async")&&((this.isClassElementNameStart()||this.type===E.star)&&!this.canInsertSemicolon()?r=!0:i="async"),!i&&(e>=9||!r)&&this.eat(E.star)&&(s=!0),!i&&!r&&!s){var l=this.value;(this.eatContextual("get")||this.eatContextual("set"))&&(this.isClassElementNameStart()?a=l:i=l)}if(i?(t.computed=!1,t.key=this.startNodeAt(this.lastTokStart,this.lastTokStartLoc),t.key.name=i,this.finishNode(t.key,"Identifier")):this.parseClassElementName(t),e<13||this.type===E.parenL||a!=="method"||s||r){var c=!t.static&&bl(t,"constructor"),u=c&&n;c&&a!=="method"&&this.raise(t.key.start,"Constructor can't have get/set modifier"),t.kind=c?"constructor":a,this.parseClassMethod(t,s,r,u)}else this.parseClassField(t);return t};$e.isClassElementNameStart=function(){return this.type===E.name||this.type===E.privateId||this.type===E.num||this.type===E.string||this.type===E.bracketL||this.type.keyword};$e.parseClassElementName=function(n){this.type===E.privateId?(this.value==="constructor"&&this.raise(this.start,"Classes can't have an element named '#constructor'"),n.computed=!1,n.key=this.parsePrivateIdent()):this.parsePropertyName(n)};$e.parseClassMethod=function(n,e,t,i){var s=n.key;n.kind==="constructor"?(e&&this.raise(s.start,"Constructor can't be a generator"),t&&this.raise(s.start,"Constructor can't be an async method")):n.static&&bl(n,"prototype")&&this.raise(s.start,"Classes may not have a static property named prototype");var r=n.value=this.parseMethod(e,t,i);return n.kind==="get"&&r.params.length!==0&&this.raiseRecoverable(r.start,"getter should have no params"),n.kind==="set"&&r.params.length!==1&&this.raiseRecoverable(r.start,"setter should have exactly one param"),n.kind==="set"&&r.params[0].type==="RestElement"&&this.raiseRecoverable(r.params[0].start,"Setter cannot use rest params"),this.finishNode(n,"MethodDefinition")};$e.parseClassField=function(n){return bl(n,"constructor")?this.raise(n.key.start,"Classes can't have a field named 'constructor'"):n.static&&bl(n,"prototype")&&this.raise(n.key.start,"Classes can't have a static field named 'prototype'"),this.eat(E.eq)?(this.enterScope(eo|Hl),n.value=this.parseMaybeAssign(),this.exitScope()):n.value=null,this.semicolon(),this.finishNode(n,"PropertyDefinition")};$e.parseClassStaticBlock=function(n){n.body=[];var e=this.labels;for(this.labels=[],this.enterScope(yr|Hl);this.type!==E.braceR;){var t=this.parseStatement(null);n.body.push(t)}return this.next(),this.exitScope(),this.labels=e,this.finishNode(n,"StaticBlock")};$e.parseClassId=function(n,e){this.type===E.name?(n.id=this.parseIdent(),e&&this.checkLValSimple(n.id,ws,!1)):(e===!0&&this.unexpected(),n.id=null)};$e.parseClassSuper=function(n){n.superClass=this.eat(E._extends)?this.parseExprSubscripts(null,!1):null};$e.enterClassBody=function(){var n={declared:Object.create(null),used:[]};return this.privateNameStack.push(n),n.declared};$e.exitClassBody=function(){var n=this.privateNameStack.pop(),e=n.declared,t=n.used;if(this.options.checkPrivateFields)for(var i=this.privateNameStack.length,s=i===0?null:this.privateNameStack[i-1],r=0;r<t.length;++r){var a=t[r];Ur(e,a.name)||(s?s.used.push(a):this.raiseRecoverable(a.start,"Private field '#"+a.name+"' must be declared in an enclosing class"))}};function xD(n,e){var t=e.key.name,i=n[t],s="true";return e.type==="MethodDefinition"&&(e.kind==="get"||e.kind==="set")&&(s=(e.static?"s":"i")+e.kind),i==="iget"&&s==="iset"||i==="iset"&&s==="iget"||i==="sget"&&s==="sset"||i==="sset"&&s==="sget"?(n[t]="true",!1):i?!0:(n[t]=s,!1)}function bl(n,e){var t=n.computed,i=n.key;return!t&&(i.type==="Identifier"&&i.name===e||i.type==="Literal"&&i.value===e)}$e.parseExportAllDeclaration=function(n,e){return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(n.exported=this.parseModuleExportName(),this.checkExport(e,n.exported,this.lastTokStart)):n.exported=null),this.expectContextual("from"),this.type!==E.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ExportAllDeclaration")};$e.parseExport=function(n,e){if(this.next(),this.eat(E.star))return this.parseExportAllDeclaration(n,e);if(this.eat(E._default))return this.checkExport(e,"default",this.lastTokStart),n.declaration=this.parseExportDefaultDeclaration(),this.finishNode(n,"ExportDefaultDeclaration");if(this.shouldParseExportStatement())n.declaration=this.parseExportDeclaration(n),n.declaration.type==="VariableDeclaration"?this.checkVariableExport(e,n.declaration.declarations):this.checkExport(e,n.declaration.id,n.declaration.id.start),n.specifiers=[],n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[]);else{if(n.declaration=null,n.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==E.string&&this.unexpected(),n.source=this.parseExprAtom(),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause());else{for(var t=0,i=n.specifiers;t<i.length;t+=1){var s=i[t];this.checkUnreserved(s.local),this.checkLocalExport(s.local),s.local.type==="Literal"&&this.raise(s.local.start,"A string literal cannot be used as an exported binding without `from`.")}n.source=null,this.options.ecmaVersion>=16&&(n.attributes=[])}this.semicolon()}return this.finishNode(n,"ExportNamedDeclaration")};$e.parseExportDeclaration=function(n){return this.parseStatement(null)};$e.parseExportDefaultDeclaration=function(){var n;if(this.type===E._function||(n=this.isAsyncFunction())){var e=this.startNode();return this.next(),n&&this.next(),this.parseFunction(e,ka|Py,!1,n)}else if(this.type===E._class){var t=this.startNode();return this.parseClass(t,"nullableID")}else{var i=this.parseMaybeAssign();return this.semicolon(),i}};$e.checkExport=function(n,e,t){n&&(typeof e!="string"&&(e=e.type==="Identifier"?e.name:e.value),Ur(n,e)&&this.raiseRecoverable(t,"Duplicate export '"+e+"'"),n[e]=!0)};$e.checkPatternExport=function(n,e){var t=e.type;if(t==="Identifier")this.checkExport(n,e,e.start);else if(t==="ObjectPattern")for(var i=0,s=e.properties;i<s.length;i+=1){var r=s[i];this.checkPatternExport(n,r)}else if(t==="ArrayPattern")for(var a=0,o=e.elements;a<o.length;a+=1){var l=o[a];l&&this.checkPatternExport(n,l)}else t==="Property"?this.checkPatternExport(n,e.value):t==="AssignmentPattern"?this.checkPatternExport(n,e.left):t==="RestElement"&&this.checkPatternExport(n,e.argument)};$e.checkVariableExport=function(n,e){if(n)for(var t=0,i=e;t<i.length;t+=1){var s=i[t];this.checkPatternExport(n,s.id)}};$e.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()};$e.parseExportSpecifier=function(n){var e=this.startNode();return e.local=this.parseModuleExportName(),e.exported=this.eatContextual("as")?this.parseModuleExportName():e.local,this.checkExport(n,e.exported,e.exported.start),this.finishNode(e,"ExportSpecifier")};$e.parseExportSpecifiers=function(n){var e=[],t=!0;for(this.expect(E.braceL);!this.eat(E.braceR);){if(t)t=!1;else if(this.expect(E.comma),this.afterTrailingComma(E.braceR))break;e.push(this.parseExportSpecifier(n))}return e};$e.parseImport=function(n){return this.next(),this.type===E.string?(n.specifiers=PD,n.source=this.parseExprAtom()):(n.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),n.source=this.type===E.string?this.parseExprAtom():this.unexpected()),this.options.ecmaVersion>=16&&(n.attributes=this.parseWithClause()),this.semicolon(),this.finishNode(n,"ImportDeclaration")};$e.parseImportSpecifier=function(){var n=this.startNode();return n.imported=this.parseModuleExportName(),this.eatContextual("as")?n.local=this.parseIdent():(this.checkUnreserved(n.imported),n.local=n.imported),this.checkLValSimple(n.local,ws),this.finishNode(n,"ImportSpecifier")};$e.parseImportDefaultSpecifier=function(){var n=this.startNode();return n.local=this.parseIdent(),this.checkLValSimple(n.local,ws),this.finishNode(n,"ImportDefaultSpecifier")};$e.parseImportNamespaceSpecifier=function(){var n=this.startNode();return this.next(),this.expectContextual("as"),n.local=this.parseIdent(),this.checkLValSimple(n.local,ws),this.finishNode(n,"ImportNamespaceSpecifier")};$e.parseImportSpecifiers=function(){var n=[],e=!0;if(this.type===E.name&&(n.push(this.parseImportDefaultSpecifier()),!this.eat(E.comma)))return n;if(this.type===E.star)return n.push(this.parseImportNamespaceSpecifier()),n;for(this.expect(E.braceL);!this.eat(E.braceR);){if(e)e=!1;else if(this.expect(E.comma),this.afterTrailingComma(E.braceR))break;n.push(this.parseImportSpecifier())}return n};$e.parseWithClause=function(){var n=[];if(!this.eat(E._with))return n;this.expect(E.braceL);for(var e={},t=!0;!this.eat(E.braceR);){if(t)t=!1;else if(this.expect(E.comma),this.afterTrailingComma(E.braceR))break;var i=this.parseImportAttribute(),s=i.key.type==="Identifier"?i.key.name:i.key.value;Ur(e,s)&&this.raiseRecoverable(i.key.start,"Duplicate attribute key '"+s+"'"),e[s]=!0,n.push(i)}return n};$e.parseImportAttribute=function(){var n=this.startNode();return n.key=this.type===E.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never"),this.expect(E.colon),this.type!==E.string&&this.unexpected(),n.value=this.parseExprAtom(),this.finishNode(n,"ImportAttribute")};$e.parseModuleExportName=function(){if(this.options.ecmaVersion>=13&&this.type===E.string){var n=this.parseLiteral(this.value);return yD.test(n.value)&&this.raise(n.start,"An export name cannot include a lone surrogate."),n}return this.parseIdent(!0)};$e.adaptDirectivePrologue=function(n){for(var e=0;e<n.length&&this.isDirectiveCandidate(n[e]);++e)n[e].directive=n[e].expression.raw.slice(1,-1)};$e.isDirectiveCandidate=function(n){return this.options.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&typeof n.expression.value=="string"&&(this.input[n.start]==='"'||this.input[n.start]==="'")};var vi=dn.prototype;vi.toAssignable=function(n,e,t){if(this.options.ecmaVersion>=6&&n)switch(n.type){case"Identifier":this.inAsync&&n.name==="await"&&this.raise(n.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"AssignmentPattern":case"RestElement":break;case"ObjectExpression":n.type="ObjectPattern",t&&this.checkPatternErrors(t,!0);for(var i=0,s=n.properties;i<s.length;i+=1){var r=s[i];this.toAssignable(r,e),r.type==="RestElement"&&(r.argument.type==="ArrayPattern"||r.argument.type==="ObjectPattern")&&this.raise(r.argument.start,"Unexpected token")}break;case"Property":n.kind!=="init"&&this.raise(n.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(n.value,e);break;case"ArrayExpression":n.type="ArrayPattern",t&&this.checkPatternErrors(t,!0),this.toAssignableList(n.elements,e);break;case"SpreadElement":n.type="RestElement",this.toAssignable(n.argument,e),n.argument.type==="AssignmentPattern"&&this.raise(n.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":n.operator!=="="&&this.raise(n.left.end,"Only '=' operator can be used for specifying default value."),n.type="AssignmentPattern",delete n.operator,this.toAssignable(n.left,e);break;case"ParenthesizedExpression":this.toAssignable(n.expression,e,t);break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(n.start,"Assigning to rvalue")}else t&&this.checkPatternErrors(t,!0);return n};vi.toAssignableList=function(n,e){for(var t=n.length,i=0;i<t;i++){var s=n[i];s&&this.toAssignable(s,e)}if(t){var r=n[t-1];this.options.ecmaVersion===6&&e&&r&&r.type==="RestElement"&&r.argument.type!=="Identifier"&&this.unexpected(r.argument.start)}return n};vi.parseSpread=function(n){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,n),this.finishNode(e,"SpreadElement")};vi.parseRestBinding=function(){var n=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==E.name&&this.unexpected(),n.argument=this.parseBindingAtom(),this.finishNode(n,"RestElement")};vi.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case E.bracketL:var n=this.startNode();return this.next(),n.elements=this.parseBindingList(E.bracketR,!0,!0),this.finishNode(n,"ArrayPattern");case E.braceL:return this.parseObj(!0)}return this.parseIdent()};vi.parseBindingList=function(n,e,t,i){for(var s=[],r=!0;!this.eat(n);)if(r?r=!1:this.expect(E.comma),e&&this.type===E.comma)s.push(null);else{if(t&&this.afterTrailingComma(n))break;if(this.type===E.ellipsis){var a=this.parseRestBinding();this.parseBindingListItem(a),s.push(a),this.type===E.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.expect(n);break}else s.push(this.parseAssignableListItem(i))}return s};vi.parseAssignableListItem=function(n){var e=this.parseMaybeDefault(this.start,this.startLoc);return this.parseBindingListItem(e),e};vi.parseBindingListItem=function(n){return n};vi.parseMaybeDefault=function(n,e,t){if(t=t||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(E.eq))return t;var i=this.startNodeAt(n,e);return i.left=t,i.right=this.parseMaybeAssign(),this.finishNode(i,"AssignmentPattern")};vi.checkLValSimple=function(n,e,t){e===void 0&&(e=yl);var i=e!==yl;switch(n.type){case"Identifier":this.strict&&this.reservedWordsStrictBind.test(n.name)&&this.raiseRecoverable(n.start,(i?"Binding ":"Assigning to ")+n.name+" in strict mode"),i&&(e===ws&&n.name==="let"&&this.raiseRecoverable(n.start,"let is disallowed as a lexically bound name"),t&&(Ur(t,n.name)&&this.raiseRecoverable(n.start,"Argument name clash"),t[n.name]=!0),e!==wy&&this.declareName(n.name,e,n.start));break;case"ChainExpression":this.raiseRecoverable(n.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":i&&this.raiseRecoverable(n.start,"Binding member expression");break;case"ParenthesizedExpression":return i&&this.raiseRecoverable(n.start,"Binding parenthesized expression"),this.checkLValSimple(n.expression,e,t);default:this.raise(n.start,(i?"Binding":"Assigning to")+" rvalue")}};vi.checkLValPattern=function(n,e,t){switch(e===void 0&&(e=yl),n.type){case"ObjectPattern":for(var i=0,s=n.properties;i<s.length;i+=1){var r=s[i];this.checkLValInnerPattern(r,e,t)}break;case"ArrayPattern":for(var a=0,o=n.elements;a<o.length;a+=1){var l=o[a];l&&this.checkLValInnerPattern(l,e,t)}break;default:this.checkLValSimple(n,e,t)}};vi.checkLValInnerPattern=function(n,e,t){switch(e===void 0&&(e=yl),n.type){case"Property":this.checkLValInnerPattern(n.value,e,t);break;case"AssignmentPattern":this.checkLValPattern(n.left,e,t);break;case"RestElement":this.checkLValPattern(n.argument,e,t);break;default:this.checkLValPattern(n,e,t)}};var Ei=function(e,t,i,s,r){this.token=e,this.isExpr=!!t,this.preserveSpace=!!i,this.override=s,this.generator=!!r},Gt={b_stat:new Ei("{",!1),b_expr:new Ei("{",!0),b_tmpl:new Ei("${",!1),p_stat:new Ei("(",!1),p_expr:new Ei("(",!0),q_tmpl:new Ei("`",!0,!0,function(n){return n.tryReadTemplateToken()}),f_stat:new Ei("function",!1),f_expr:new Ei("function",!0),f_expr_gen:new Ei("function",!0,!1,null,!0),f_gen:new Ei("function",!1,!1,null,!0)},Hr=dn.prototype;Hr.initialContext=function(){return[Gt.b_stat]};Hr.curContext=function(){return this.context[this.context.length-1]};Hr.braceIsBlock=function(n){var e=this.curContext();return e===Gt.f_expr||e===Gt.f_stat?!0:n===E.colon&&(e===Gt.b_stat||e===Gt.b_expr)?!e.isExpr:n===E._return||n===E.name&&this.exprAllowed?Kn.test(this.input.slice(this.lastTokEnd,this.start)):n===E._else||n===E.semi||n===E.eof||n===E.parenR||n===E.arrow?!0:n===E.braceL?e===Gt.b_stat:n===E._var||n===E._const||n===E.name?!1:!this.exprAllowed};Hr.inGeneratorContext=function(){for(var n=this.context.length-1;n>=1;n--){var e=this.context[n];if(e.token==="function")return e.generator}return!1};Hr.updateContext=function(n){var e,t=this.type;t.keyword&&n===E.dot?this.exprAllowed=!1:(e=t.updateContext)?e.call(this,n):this.exprAllowed=t.beforeExpr};Hr.overrideContext=function(n){this.curContext()!==n&&(this.context[this.context.length-1]=n)};E.parenR.updateContext=E.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var n=this.context.pop();n===Gt.b_stat&&this.curContext().token==="function"&&(n=this.context.pop()),this.exprAllowed=!n.isExpr};E.braceL.updateContext=function(n){this.context.push(this.braceIsBlock(n)?Gt.b_stat:Gt.b_expr),this.exprAllowed=!0};E.dollarBraceL.updateContext=function(){this.context.push(Gt.b_tmpl),this.exprAllowed=!0};E.parenL.updateContext=function(n){var e=n===E._if||n===E._for||n===E._with||n===E._while;this.context.push(e?Gt.p_stat:Gt.p_expr),this.exprAllowed=!0};E.incDec.updateContext=function(){};E._function.updateContext=E._class.updateContext=function(n){n.beforeExpr&&n!==E._else&&!(n===E.semi&&this.curContext()!==Gt.p_stat)&&!(n===E._return&&Kn.test(this.input.slice(this.lastTokEnd,this.start)))&&!((n===E.colon||n===E.braceL)&&this.curContext()===Gt.b_stat)?this.context.push(Gt.f_expr):this.context.push(Gt.f_stat),this.exprAllowed=!1};E.colon.updateContext=function(){this.curContext().token==="function"&&this.context.pop(),this.exprAllowed=!0};E.backQuote.updateContext=function(){this.curContext()===Gt.q_tmpl?this.context.pop():this.context.push(Gt.q_tmpl),this.exprAllowed=!1};E.star.updateContext=function(n){if(n===E._function){var e=this.context.length-1;this.context[e]===Gt.f_expr?this.context[e]=Gt.f_expr_gen:this.context[e]=Gt.f_gen}this.exprAllowed=!0};E.name.updateContext=function(n){var e=!1;this.options.ecmaVersion>=6&&n!==E.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var Xe=dn.prototype;Xe.checkPropClash=function(n,e,t){if(!(this.options.ecmaVersion>=9&&n.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(n.computed||n.method||n.shorthand))){var i=n.key,s;switch(i.type){case"Identifier":s=i.name;break;case"Literal":s=String(i.value);break;default:return}var r=n.kind;if(this.options.ecmaVersion>=6){s==="__proto__"&&r==="init"&&(e.proto&&(t?t.doubleProto<0&&(t.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);return}s="$"+s;var a=e[s];if(a){var o;r==="init"?o=this.strict&&a.init||a.get||a.set:o=a.init||a[r],o&&this.raiseRecoverable(i.start,"Redefinition of property")}else a=e[s]={init:!1,get:!1,set:!1};a[r]=!0}};Xe.parseExpression=function(n,e){var t=this.start,i=this.startLoc,s=this.parseMaybeAssign(n,e);if(this.type===E.comma){var r=this.startNodeAt(t,i);for(r.expressions=[s];this.eat(E.comma);)r.expressions.push(this.parseMaybeAssign(n,e));return this.finishNode(r,"SequenceExpression")}return s};Xe.parseMaybeAssign=function(n,e,t){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(n);this.exprAllowed=!1}var i=!1,s=-1,r=-1,a=-1;e?(s=e.parenthesizedAssign,r=e.trailingComma,a=e.doubleProto,e.parenthesizedAssign=e.trailingComma=-1):(e=new Jl,i=!0);var o=this.start,l=this.startLoc;(this.type===E.parenL||this.type===E.name)&&(this.potentialArrowAt=this.start,this.potentialArrowInForAwait=n==="await");var c=this.parseMaybeConditional(n,e);if(t&&(c=t.call(this,c,o,l)),this.type.isAssign){var u=this.startNodeAt(o,l);return u.operator=this.value,this.type===E.eq&&(c=this.toAssignable(c,!1,e)),i||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=c.start&&(e.shorthandAssign=-1),this.type===E.eq?this.checkLValPattern(c):this.checkLValSimple(c),u.left=c,this.next(),u.right=this.parseMaybeAssign(n),a>-1&&(e.doubleProto=a),this.finishNode(u,"AssignmentExpression")}else i&&this.checkExpressionErrors(e,!0);return s>-1&&(e.parenthesizedAssign=s),r>-1&&(e.trailingComma=r),c};Xe.parseMaybeConditional=function(n,e){var t=this.start,i=this.startLoc,s=this.parseExprOps(n,e);if(this.checkExpressionErrors(e))return s;if(this.eat(E.question)){var r=this.startNodeAt(t,i);return r.test=s,r.consequent=this.parseMaybeAssign(),this.expect(E.colon),r.alternate=this.parseMaybeAssign(n),this.finishNode(r,"ConditionalExpression")}return s};Xe.parseExprOps=function(n,e){var t=this.start,i=this.startLoc,s=this.parseMaybeUnary(e,!1,!1,n);return this.checkExpressionErrors(e)||s.start===t&&s.type==="ArrowFunctionExpression"?s:this.parseExprOp(s,t,i,-1,n)};Xe.parseExprOp=function(n,e,t,i,s){var r=this.type.binop;if(r!=null&&(!s||this.type!==E._in)&&r>i){var a=this.type===E.logicalOR||this.type===E.logicalAND,o=this.type===E.coalesce;o&&(r=E.logicalAND.binop);var l=this.value;this.next();var c=this.start,u=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1,!1,s),c,u,r,s),d=this.buildBinary(e,t,n,h,l,a||o);return(a&&this.type===E.coalesce||o&&(this.type===E.logicalOR||this.type===E.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(d,e,t,i,s)}return n};Xe.buildBinary=function(n,e,t,i,s,r){i.type==="PrivateIdentifier"&&this.raise(i.start,"Private identifier can only be left side of binary expression");var a=this.startNodeAt(n,e);return a.left=t,a.operator=s,a.right=i,this.finishNode(a,r?"LogicalExpression":"BinaryExpression")};Xe.parseMaybeUnary=function(n,e,t,i){var s=this.start,r=this.startLoc,a;if(this.isContextual("await")&&this.canAwait)a=this.parseAwait(i),e=!0;else if(this.type.prefix){var o=this.startNode(),l=this.type===E.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0,l,i),this.checkExpressionErrors(n,!0),l?this.checkLValSimple(o.argument):this.strict&&o.operator==="delete"&&xy(o.argument)?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):o.operator==="delete"&&Lh(o.argument)?this.raiseRecoverable(o.start,"Private fields can not be deleted"):e=!0,a=this.finishNode(o,l?"UpdateExpression":"UnaryExpression")}else if(!e&&this.type===E.privateId)(i||this.privateNameStack.length===0)&&this.options.checkPrivateFields&&this.unexpected(),a=this.parsePrivateIdent(),this.type!==E._in&&this.unexpected();else{if(a=this.parseExprSubscripts(n,i),this.checkExpressionErrors(n))return a;for(;this.type.postfix&&!this.canInsertSemicolon();){var c=this.startNodeAt(s,r);c.operator=this.value,c.prefix=!1,c.argument=a,this.checkLValSimple(a),this.next(),a=this.finishNode(c,"UpdateExpression")}}if(!t&&this.eat(E.starstar))if(e)this.unexpected(this.lastTokStart);else return this.buildBinary(s,r,a,this.parseMaybeUnary(null,!1,!1,i),"**",!1);else return a};function xy(n){return n.type==="Identifier"||n.type==="ParenthesizedExpression"&&xy(n.expression)}function Lh(n){return n.type==="MemberExpression"&&n.property.type==="PrivateIdentifier"||n.type==="ChainExpression"&&Lh(n.expression)||n.type==="ParenthesizedExpression"&&Lh(n.expression)}Xe.parseExprSubscripts=function(n,e){var t=this.start,i=this.startLoc,s=this.parseExprAtom(n,e);if(s.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return s;var r=this.parseSubscripts(s,t,i,!1,e);return n&&r.type==="MemberExpression"&&(n.parenthesizedAssign>=r.start&&(n.parenthesizedAssign=-1),n.parenthesizedBind>=r.start&&(n.parenthesizedBind=-1),n.trailingComma>=r.start&&(n.trailingComma=-1)),r};Xe.parseSubscripts=function(n,e,t,i,s){for(var r=this.options.ecmaVersion>=8&&n.type==="Identifier"&&n.name==="async"&&this.lastTokEnd===n.end&&!this.canInsertSemicolon()&&n.end-n.start===5&&this.potentialArrowAt===n.start,a=!1;;){var o=this.parseSubscript(n,e,t,i,r,a,s);if(o.optional&&(a=!0),o===n||o.type==="ArrowFunctionExpression"){if(a){var l=this.startNodeAt(e,t);l.expression=o,o=this.finishNode(l,"ChainExpression")}return o}n=o}};Xe.shouldParseAsyncArrow=function(){return!this.canInsertSemicolon()&&this.eat(E.arrow)};Xe.parseSubscriptAsyncArrow=function(n,e,t,i){return this.parseArrowExpression(this.startNodeAt(n,e),t,!0,i)};Xe.parseSubscript=function(n,e,t,i,s,r,a){var o=this.options.ecmaVersion>=11,l=o&&this.eat(E.questionDot);i&&l&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var c=this.eat(E.bracketL);if(c||l&&this.type!==E.parenL&&this.type!==E.backQuote||this.eat(E.dot)){var u=this.startNodeAt(e,t);u.object=n,c?(u.property=this.parseExpression(),this.expect(E.bracketR)):this.type===E.privateId&&n.type!=="Super"?u.property=this.parsePrivateIdent():u.property=this.parseIdent(this.options.allowReserved!=="never"),u.computed=!!c,o&&(u.optional=l),n=this.finishNode(u,"MemberExpression")}else if(!i&&this.eat(E.parenL)){var h=new Jl,d=this.yieldPos,f=this.awaitPos,m=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var g=this.parseExprList(E.parenR,this.options.ecmaVersion>=8,!1,h);if(s&&!l&&this.shouldParseAsyncArrow())return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=d,this.awaitPos=f,this.awaitIdentPos=m,this.parseSubscriptAsyncArrow(e,t,g,a);this.checkExpressionErrors(h,!0),this.yieldPos=d||this.yieldPos,this.awaitPos=f||this.awaitPos,this.awaitIdentPos=m||this.awaitIdentPos;var y=this.startNodeAt(e,t);y.callee=n,y.arguments=g,o&&(y.optional=l),n=this.finishNode(y,"CallExpression")}else if(this.type===E.backQuote){(l||r)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var b=this.startNodeAt(e,t);b.tag=n,b.quasi=this.parseTemplate({isTagged:!0}),n=this.finishNode(b,"TaggedTemplateExpression")}return n};Xe.parseExprAtom=function(n,e,t){this.type===E.slash&&this.readRegexp();var i,s=this.potentialArrowAt===this.start;switch(this.type){case E._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),i=this.startNode(),this.next(),this.type===E.parenL&&!this.allowDirectSuper&&this.raise(i.start,"super() call outside constructor of a subclass"),this.type!==E.dot&&this.type!==E.bracketL&&this.type!==E.parenL&&this.unexpected(),this.finishNode(i,"Super");case E._this:return i=this.startNode(),this.next(),this.finishNode(i,"ThisExpression");case E.name:var r=this.start,a=this.startLoc,o=this.containsEsc,l=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&l.name==="async"&&!this.canInsertSemicolon()&&this.eat(E._function))return this.overrideContext(Gt.f_expr),this.parseFunction(this.startNodeAt(r,a),0,!1,!0,e);if(s&&!this.canInsertSemicolon()){if(this.eat(E.arrow))return this.parseArrowExpression(this.startNodeAt(r,a),[l],!1,e);if(this.options.ecmaVersion>=8&&l.name==="async"&&this.type===E.name&&!o&&(!this.potentialArrowInForAwait||this.value!=="of"||this.containsEsc))return l=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(E.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,a),[l],!0,e)}return l;case E.regexp:var c=this.value;return i=this.parseLiteral(c.value),i.regex={pattern:c.pattern,flags:c.flags},i;case E.num:case E.string:return this.parseLiteral(this.value);case E._null:case E._true:case E._false:return i=this.startNode(),i.value=this.type===E._null?null:this.type===E._true,i.raw=this.type.keyword,this.next(),this.finishNode(i,"Literal");case E.parenL:var u=this.start,h=this.parseParenAndDistinguishExpression(s,e);return n&&(n.parenthesizedAssign<0&&!this.isSimpleAssignTarget(h)&&(n.parenthesizedAssign=u),n.parenthesizedBind<0&&(n.parenthesizedBind=u)),h;case E.bracketL:return i=this.startNode(),this.next(),i.elements=this.parseExprList(E.bracketR,!0,!0,n),this.finishNode(i,"ArrayExpression");case E.braceL:return this.overrideContext(Gt.b_expr),this.parseObj(!1,n);case E._function:return i=this.startNode(),this.next(),this.parseFunction(i,0);case E._class:return this.parseClass(this.startNode(),!1);case E._new:return this.parseNew();case E.backQuote:return this.parseTemplate();case E._import:return this.options.ecmaVersion>=11?this.parseExprImport(t):this.unexpected();default:return this.parseExprAtomDefault()}};Xe.parseExprAtomDefault=function(){this.unexpected()};Xe.parseExprImport=function(n){var e=this.startNode();if(this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import"),this.next(),this.type===E.parenL&&!n)return this.parseDynamicImport(e);if(this.type===E.dot){var t=this.startNodeAt(e.start,e.loc&&e.loc.start);return t.name="import",e.meta=this.finishNode(t,"Identifier"),this.parseImportMeta(e)}else this.unexpected()};Xe.parseDynamicImport=function(n){if(this.next(),n.source=this.parseMaybeAssign(),this.options.ecmaVersion>=16)this.eat(E.parenR)?n.options=null:(this.expect(E.comma),this.afterTrailingComma(E.parenR)?n.options=null:(n.options=this.parseMaybeAssign(),this.eat(E.parenR)||(this.expect(E.comma),this.afterTrailingComma(E.parenR)||this.unexpected())));else if(!this.eat(E.parenR)){var e=this.start;this.eat(E.comma)&&this.eat(E.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(n,"ImportExpression")};Xe.parseImportMeta=function(n){this.next();var e=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="meta"&&this.raiseRecoverable(n.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(n.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&!this.options.allowImportExportEverywhere&&this.raiseRecoverable(n.start,"Cannot use 'import.meta' outside a module"),this.finishNode(n,"MetaProperty")};Xe.parseLiteral=function(n){var e=this.startNode();return e.value=n,e.raw=this.input.slice(this.start,this.end),e.raw.charCodeAt(e.raw.length-1)===110&&(e.bigint=e.value!=null?e.value.toString():e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")};Xe.parseParenExpression=function(){this.expect(E.parenL);var n=this.parseExpression();return this.expect(E.parenR),n};Xe.shouldParseArrow=function(n){return!this.canInsertSemicolon()};Xe.parseParenAndDistinguishExpression=function(n,e){var t=this.start,i=this.startLoc,s,r=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var a=this.start,o=this.startLoc,l=[],c=!0,u=!1,h=new Jl,d=this.yieldPos,f=this.awaitPos,m;for(this.yieldPos=0,this.awaitPos=0;this.type!==E.parenR;)if(c?c=!1:this.expect(E.comma),r&&this.afterTrailingComma(E.parenR,!0)){u=!0;break}else if(this.type===E.ellipsis){m=this.start,l.push(this.parseParenItem(this.parseRestBinding())),this.type===E.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element");break}else l.push(this.parseMaybeAssign(!1,h,this.parseParenItem));var g=this.lastTokEnd,y=this.lastTokEndLoc;if(this.expect(E.parenR),n&&this.shouldParseArrow(l)&&this.eat(E.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=d,this.awaitPos=f,this.parseParenArrowList(t,i,l,e);(!l.length||u)&&this.unexpected(this.lastTokStart),m&&this.unexpected(m),this.checkExpressionErrors(h,!0),this.yieldPos=d||this.yieldPos,this.awaitPos=f||this.awaitPos,l.length>1?(s=this.startNodeAt(a,o),s.expressions=l,this.finishNodeAt(s,"SequenceExpression",g,y)):s=l[0]}else s=this.parseParenExpression();if(this.options.preserveParens){var b=this.startNodeAt(t,i);return b.expression=s,this.finishNode(b,"ParenthesizedExpression")}else return s};Xe.parseParenItem=function(n){return n};Xe.parseParenArrowList=function(n,e,t,i){return this.parseArrowExpression(this.startNodeAt(n,e),t,!1,i)};var CD=[];Xe.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var n=this.startNode();if(this.next(),this.options.ecmaVersion>=6&&this.type===E.dot){var e=this.startNodeAt(n.start,n.loc&&n.loc.start);e.name="new",n.meta=this.finishNode(e,"Identifier"),this.next();var t=this.containsEsc;return n.property=this.parseIdent(!0),n.property.name!=="target"&&this.raiseRecoverable(n.property.start,"The only valid meta property for new is 'new.target'"),t&&this.raiseRecoverable(n.start,"'new.target' must not contain escaped characters"),this.allowNewDotTarget||this.raiseRecoverable(n.start,"'new.target' can only be used in functions and class static block"),this.finishNode(n,"MetaProperty")}var i=this.start,s=this.startLoc;return n.callee=this.parseSubscripts(this.parseExprAtom(null,!1,!0),i,s,!0,!1),this.eat(E.parenL)?n.arguments=this.parseExprList(E.parenR,this.options.ecmaVersion>=8,!1):n.arguments=CD,this.finishNode(n,"NewExpression")};Xe.parseTemplateElement=function(n){var e=n.isTagged,t=this.startNode();return this.type===E.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),t.value={raw:this.value.replace(/\r\n?/g,`
`),cooked:null}):t.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),t.tail=this.type===E.backQuote,this.finishNode(t,"TemplateElement")};Xe.parseTemplate=function(n){n===void 0&&(n={});var e=n.isTagged;e===void 0&&(e=!1);var t=this.startNode();this.next(),t.expressions=[];var i=this.parseTemplateElement({isTagged:e});for(t.quasis=[i];!i.tail;)this.type===E.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(E.dollarBraceL),t.expressions.push(this.parseExpression()),this.expect(E.braceR),t.quasis.push(i=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(t,"TemplateLiteral")};Xe.isAsyncProp=function(n){return!n.computed&&n.key.type==="Identifier"&&n.key.name==="async"&&(this.type===E.name||this.type===E.num||this.type===E.string||this.type===E.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===E.star)&&!Kn.test(this.input.slice(this.lastTokEnd,this.start))};Xe.parseObj=function(n,e){var t=this.startNode(),i=!0,s={};for(t.properties=[],this.next();!this.eat(E.braceR);){if(i)i=!1;else if(this.expect(E.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(E.braceR))break;var r=this.parseProperty(n,e);n||this.checkPropClash(r,s,e),t.properties.push(r)}return this.finishNode(t,n?"ObjectPattern":"ObjectExpression")};Xe.parseProperty=function(n,e){var t=this.startNode(),i,s,r,a;if(this.options.ecmaVersion>=9&&this.eat(E.ellipsis))return n?(t.argument=this.parseIdent(!1),this.type===E.comma&&this.raiseRecoverable(this.start,"Comma is not permitted after the rest element"),this.finishNode(t,"RestElement")):(t.argument=this.parseMaybeAssign(!1,e),this.type===E.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(t,"SpreadElement"));this.options.ecmaVersion>=6&&(t.method=!1,t.shorthand=!1,(n||e)&&(r=this.start,a=this.startLoc),n||(i=this.eat(E.star)));var o=this.containsEsc;return this.parsePropertyName(t),!n&&!o&&this.options.ecmaVersion>=8&&!i&&this.isAsyncProp(t)?(s=!0,i=this.options.ecmaVersion>=9&&this.eat(E.star),this.parsePropertyName(t)):s=!1,this.parsePropertyValue(t,n,i,s,r,a,e,o),this.finishNode(t,"Property")};Xe.parseGetterSetter=function(n){var e=n.key.name;this.parsePropertyName(n),n.value=this.parseMethod(!1),n.kind=e;var t=n.kind==="get"?0:1;if(n.value.params.length!==t){var i=n.value.start;n.kind==="get"?this.raiseRecoverable(i,"getter should have no params"):this.raiseRecoverable(i,"setter should have exactly one param")}else n.kind==="set"&&n.value.params[0].type==="RestElement"&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params")};Xe.parsePropertyValue=function(n,e,t,i,s,r,a,o){(t||i)&&this.type===E.colon&&this.unexpected(),this.eat(E.colon)?(n.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),n.kind="init"):this.options.ecmaVersion>=6&&this.type===E.parenL?(e&&this.unexpected(),n.method=!0,n.value=this.parseMethod(t,i),n.kind="init"):!e&&!o&&this.options.ecmaVersion>=5&&!n.computed&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")&&this.type!==E.comma&&this.type!==E.braceR&&this.type!==E.eq?((t||i)&&this.unexpected(),this.parseGetterSetter(n)):this.options.ecmaVersion>=6&&!n.computed&&n.key.type==="Identifier"?((t||i)&&this.unexpected(),this.checkUnreserved(n.key),n.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=s),e?n.value=this.parseMaybeDefault(s,r,this.copyNode(n.key)):this.type===E.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),n.value=this.parseMaybeDefault(s,r,this.copyNode(n.key))):n.value=this.copyNode(n.key),n.kind="init",n.shorthand=!0):this.unexpected()};Xe.parsePropertyName=function(n){if(this.options.ecmaVersion>=6){if(this.eat(E.bracketL))return n.computed=!0,n.key=this.parseMaybeAssign(),this.expect(E.bracketR),n.key;n.computed=!1}return n.key=this.type===E.num||this.type===E.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")};Xe.initFunction=function(n){n.id=null,this.options.ecmaVersion>=6&&(n.generator=n.expression=!1),this.options.ecmaVersion>=8&&(n.async=!1)};Xe.parseMethod=function(n,e,t){var i=this.startNode(),s=this.yieldPos,r=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(i),this.options.ecmaVersion>=6&&(i.generator=n),this.options.ecmaVersion>=8&&(i.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Id(e,i.generator)|Hl|(t?by:0)),this.expect(E.parenL),i.params=this.parseBindingList(E.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(i,!1,!0,!1),this.yieldPos=s,this.awaitPos=r,this.awaitIdentPos=a,this.finishNode(i,"FunctionExpression")};Xe.parseArrowExpression=function(n,e,t,i){var s=this.yieldPos,r=this.awaitPos,a=this.awaitIdentPos;return this.enterScope(Id(t,!1)|Ld),this.initFunction(n),this.options.ecmaVersion>=8&&(n.async=!!t),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,n.params=this.toAssignableList(e,!0),this.parseFunctionBody(n,!0,!1,i),this.yieldPos=s,this.awaitPos=r,this.awaitIdentPos=a,this.finishNode(n,"ArrowFunctionExpression")};Xe.parseFunctionBody=function(n,e,t,i){var s=e&&this.type!==E.braceL,r=this.strict,a=!1;if(s)n.body=this.parseMaybeAssign(i),n.expression=!0,this.checkParams(n,!1);else{var o=this.options.ecmaVersion>=7&&!this.isSimpleParamList(n.params);(!r||o)&&(a=this.strictDirective(this.end),a&&o&&this.raiseRecoverable(n.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var l=this.labels;this.labels=[],a&&(this.strict=!0),this.checkParams(n,!r&&!a&&!e&&!t&&this.isSimpleParamList(n.params)),this.strict&&n.id&&this.checkLValSimple(n.id,wy),n.body=this.parseBlock(!1,void 0,a&&!r),n.expression=!1,this.adaptDirectivePrologue(n.body.body),this.labels=l}this.exitScope()};Xe.isSimpleParamList=function(n){for(var e=0,t=n;e<t.length;e+=1){var i=t[e];if(i.type!=="Identifier")return!1}return!0};Xe.checkParams=function(n,e){for(var t=Object.create(null),i=0,s=n.params;i<s.length;i+=1){var r=s[i];this.checkLValInnerPattern(r,Vd,e?null:t)}};Xe.parseExprList=function(n,e,t,i){for(var s=[],r=!0;!this.eat(n);){if(r)r=!1;else if(this.expect(E.comma),e&&this.afterTrailingComma(n))break;var a=void 0;t&&this.type===E.comma?a=null:this.type===E.ellipsis?(a=this.parseSpread(i),i&&this.type===E.comma&&i.trailingComma<0&&(i.trailingComma=this.start)):a=this.parseMaybeAssign(!1,i),s.push(a)}return s};Xe.checkUnreserved=function(n){var e=n.start,t=n.end,i=n.name;if(this.inGenerator&&i==="yield"&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),!(this.currentThisScope().flags&Kl)&&i==="arguments"&&this.raiseRecoverable(e,"Cannot use 'arguments' in class field initializer"),this.inClassStaticBlock&&(i==="arguments"||i==="await")&&this.raise(e,"Cannot use "+i+" in class static initialization block"),this.keywords.test(i)&&this.raise(e,"Unexpected keyword '"+i+"'"),!(this.options.ecmaVersion<6&&this.input.slice(e,t).indexOf("\\")!==-1)){var s=this.strict?this.reservedWordsStrict:this.reservedWords;s.test(i)&&(!this.inAsync&&i==="await"&&this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+i+"' is reserved"))}};Xe.parseIdent=function(n){var e=this.parseIdentNode();return this.next(!!n),this.finishNode(e,"Identifier"),n||(this.checkUnreserved(e),e.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=e.start)),e};Xe.parseIdentNode=function(){var n=this.startNode();return this.type===E.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,(n.name==="class"||n.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop(),this.type=E.name):this.unexpected(),n};Xe.parsePrivateIdent=function(){var n=this.startNode();return this.type===E.privateId?n.name=this.value:this.unexpected(),this.next(),this.finishNode(n,"PrivateIdentifier"),this.options.checkPrivateFields&&(this.privateNameStack.length===0?this.raise(n.start,"Private field '#"+n.name+"' must be declared in an enclosing class"):this.privateNameStack[this.privateNameStack.length-1].used.push(n)),n};Xe.parseYield=function(n){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===E.semi||this.canInsertSemicolon()||this.type!==E.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(E.star),e.argument=this.parseMaybeAssign(n)),this.finishNode(e,"YieldExpression")};Xe.parseAwait=function(n){this.awaitPos||(this.awaitPos=this.start);var e=this.startNode();return this.next(),e.argument=this.parseMaybeUnary(null,!0,!1,n),this.finishNode(e,"AwaitExpression")};var vl=dn.prototype;vl.raise=function(n,e){var t=gy(this.input,n);e+=" ("+t.line+":"+t.column+")",this.sourceFile&&(e+=" in "+this.sourceFile);var i=new SyntaxError(e);throw i.pos=n,i.loc=t,i.raisedAt=this.pos,i};vl.raiseRecoverable=vl.raise;vl.curPosition=function(){if(this.options.locations)return new za(this.curLine,this.pos-this.lineStart)};var qs=dn.prototype,AD=function(e){this.flags=e,this.var=[],this.lexical=[],this.functions=[]};qs.enterScope=function(n){this.scopeStack.push(new AD(n))};qs.exitScope=function(){this.scopeStack.pop()};qs.treatFunctionsAsVarInScope=function(n){return n.flags&Yr||!this.inModule&&n.flags&Za};qs.declareName=function(n,e,t){var i=!1;if(e===ws){var s=this.currentScope();i=s.lexical.indexOf(n)>-1||s.functions.indexOf(n)>-1||s.var.indexOf(n)>-1,s.lexical.push(n),this.inModule&&s.flags&Za&&delete this.undefinedExports[n]}else if(e===Sy){var r=this.currentScope();r.lexical.push(n)}else if(e===vy){var a=this.currentScope();this.treatFunctionsAsVar?i=a.lexical.indexOf(n)>-1:i=a.lexical.indexOf(n)>-1||a.var.indexOf(n)>-1,a.functions.push(n)}else for(var o=this.scopeStack.length-1;o>=0;--o){var l=this.scopeStack[o];if(l.lexical.indexOf(n)>-1&&!(l.flags&yy&&l.lexical[0]===n)||!this.treatFunctionsAsVarInScope(l)&&l.functions.indexOf(n)>-1){i=!0;break}if(l.var.push(n),this.inModule&&l.flags&Za&&delete this.undefinedExports[n],l.flags&Kl)break}i&&this.raiseRecoverable(t,"Identifier '"+n+"' has already been declared")};qs.checkLocalExport=function(n){this.scopeStack[0].lexical.indexOf(n.name)===-1&&this.scopeStack[0].var.indexOf(n.name)===-1&&(this.undefinedExports[n.name]=n)};qs.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]};qs.currentVarScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&(Kl|eo|yr))return e}};qs.currentThisScope=function(){for(var n=this.scopeStack.length-1;;n--){var e=this.scopeStack[n];if(e.flags&(Kl|eo|yr)&&!(e.flags&Ld))return e}};var eu=function(e,t,i){this.type="",this.start=t,this.end=0,e.options.locations&&(this.loc=new Yl(e,i)),e.options.directSourceFile&&(this.sourceFile=e.options.directSourceFile),e.options.ranges&&(this.range=[t,0])},to=dn.prototype;to.startNode=function(){return new eu(this,this.start,this.startLoc)};to.startNodeAt=function(n,e){return new eu(this,n,e)};function Cy(n,e,t,i){return n.type=e,n.end=t,this.options.locations&&(n.loc.end=i),this.options.ranges&&(n.range[1]=t),n}to.finishNode=function(n,e){return Cy.call(this,n,e,this.lastTokEnd,this.lastTokEndLoc)};to.finishNodeAt=function(n,e,t,i){return Cy.call(this,n,e,t,i)};to.copyNode=function(n){var e=new eu(this,n.start,this.startLoc);for(var t in n)e[t]=n[t];return e};var kD="Gara Garay Gukh Gurung_Khema Hrkt Katakana_Or_Hiragana Kawi Kirat_Rai Krai Nag_Mundari Nagm Ol_Onal Onao Sunu Sunuwar Todhri Todr Tulu_Tigalari Tutg Unknown Zzzz",Ay="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ky=Ay+" Extended_Pictographic",Ey=ky,$y=Ey+" EBase EComp EMod EPres ExtPict",Dy=$y,ED=Dy,$D={9:Ay,10:ky,11:Ey,12:$y,13:Dy,14:ED},DD="Basic_Emoji Emoji_Keycap_Sequence RGI_Emoji_Modifier_Sequence RGI_Emoji_Flag_Sequence RGI_Emoji_Tag_Sequence RGI_Emoji_ZWJ_Sequence RGI_Emoji",MD={9:"",10:"",11:"",12:"",13:"",14:DD},Cm="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",My="Adlam Adlm Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ty=My+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",_y=Ty+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Fy=_y+" Chorasmian Chrs Diak Dives_Akuru Khitan_Small_Script Kits Yezi Yezidi",By=Fy+" Cypro_Minoan Cpmn Old_Uyghur Ougr Tangsa Tnsa Toto Vithkuqi Vith",TD=By+" "+kD,_D={9:My,10:Ty,11:_y,12:Fy,13:By,14:TD},Ny={};function FD(n){var e=Ny[n]={binary:Bs($D[n]+" "+Cm),binaryOfStrings:Bs(MD[n]),nonBinary:{General_Category:Bs(Cm),Script:Bs(_D[n])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}for(var Hu=0,Am=[9,10,11,12,13,14];Hu<Am.length;Hu+=1){var BD=Am[Hu];FD(BD)}var Ee=dn.prototype,Sl=function(e,t){this.parent=e,this.base=t||this};Sl.prototype.separatedFrom=function(e){for(var t=this;t;t=t.parent)for(var i=e;i;i=i.parent)if(t.base===i.base&&t!==i)return!0;return!1};Sl.prototype.sibling=function(){return new Sl(this.parent,this.base)};var hs=function(e){this.parser=e,this.validFlags="gim"+(e.options.ecmaVersion>=6?"uy":"")+(e.options.ecmaVersion>=9?"s":"")+(e.options.ecmaVersion>=13?"d":"")+(e.options.ecmaVersion>=15?"v":""),this.unicodeProperties=Ny[e.options.ecmaVersion>=14?14:e.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchV=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=Object.create(null),this.backReferenceNames=[],this.branchID=null};hs.prototype.reset=function(e,t,i){var s=i.indexOf("v")!==-1,r=i.indexOf("u")!==-1;this.start=e|0,this.source=t+"",this.flags=i,s&&this.parser.options.ecmaVersion>=15?(this.switchU=!0,this.switchV=!0,this.switchN=!0):(this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchV=!1,this.switchN=r&&this.parser.options.ecmaVersion>=9)};hs.prototype.raise=function(e){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+e)};hs.prototype.at=function(e,t){t===void 0&&(t=!1);var i=this.source,s=i.length;if(e>=s)return-1;var r=i.charCodeAt(e);if(!(t||this.switchU)||r<=55295||r>=57344||e+1>=s)return r;var a=i.charCodeAt(e+1);return a>=56320&&a<=57343?(r<<10)+a-56613888:r};hs.prototype.nextIndex=function(e,t){t===void 0&&(t=!1);var i=this.source,s=i.length;if(e>=s)return s;var r=i.charCodeAt(e),a;return!(t||this.switchU)||r<=55295||r>=57344||e+1>=s||(a=i.charCodeAt(e+1))<56320||a>57343?e+1:e+2};hs.prototype.current=function(e){return e===void 0&&(e=!1),this.at(this.pos,e)};hs.prototype.lookahead=function(e){return e===void 0&&(e=!1),this.at(this.nextIndex(this.pos,e),e)};hs.prototype.advance=function(e){e===void 0&&(e=!1),this.pos=this.nextIndex(this.pos,e)};hs.prototype.eat=function(e,t){return t===void 0&&(t=!1),this.current(t)===e?(this.advance(t),!0):!1};hs.prototype.eatChars=function(e,t){t===void 0&&(t=!1);for(var i=this.pos,s=0,r=e;s<r.length;s+=1){var a=r[s],o=this.at(i,t);if(o===-1||o!==a)return!1;i=this.nextIndex(i,t)}return this.pos=i,!0};Ee.validateRegExpFlags=function(n){for(var e=n.validFlags,t=n.flags,i=!1,s=!1,r=0;r<t.length;r++){var a=t.charAt(r);e.indexOf(a)===-1&&this.raise(n.start,"Invalid regular expression flag"),t.indexOf(a,r+1)>-1&&this.raise(n.start,"Duplicate regular expression flag"),a==="u"&&(i=!0),a==="v"&&(s=!0)}this.options.ecmaVersion>=15&&i&&s&&this.raise(n.start,"Invalid regular expression flag")};function ND(n){for(var e in n)return!0;return!1}Ee.validateRegExpPattern=function(n){this.regexp_pattern(n),!n.switchN&&this.options.ecmaVersion>=9&&ND(n.groupNames)&&(n.switchN=!0,this.regexp_pattern(n))};Ee.regexp_pattern=function(n){n.pos=0,n.lastIntValue=0,n.lastStringValue="",n.lastAssertionIsQuantifiable=!1,n.numCapturingParens=0,n.maxBackReference=0,n.groupNames=Object.create(null),n.backReferenceNames.length=0,n.branchID=null,this.regexp_disjunction(n),n.pos!==n.source.length&&(n.eat(41)&&n.raise("Unmatched ')'"),(n.eat(93)||n.eat(125))&&n.raise("Lone quantifier brackets")),n.maxBackReference>n.numCapturingParens&&n.raise("Invalid escape");for(var e=0,t=n.backReferenceNames;e<t.length;e+=1){var i=t[e];n.groupNames[i]||n.raise("Invalid named capture referenced")}};Ee.regexp_disjunction=function(n){var e=this.options.ecmaVersion>=16;for(e&&(n.branchID=new Sl(n.branchID,null)),this.regexp_alternative(n);n.eat(124);)e&&(n.branchID=n.branchID.sibling()),this.regexp_alternative(n);e&&(n.branchID=n.branchID.parent),this.regexp_eatQuantifier(n,!0)&&n.raise("Nothing to repeat"),n.eat(123)&&n.raise("Lone quantifier brackets")};Ee.regexp_alternative=function(n){for(;n.pos<n.source.length&&this.regexp_eatTerm(n););};Ee.regexp_eatTerm=function(n){return this.regexp_eatAssertion(n)?(n.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(n)&&n.switchU&&n.raise("Invalid quantifier"),!0):(n.switchU?this.regexp_eatAtom(n):this.regexp_eatExtendedAtom(n))?(this.regexp_eatQuantifier(n),!0):!1};Ee.regexp_eatAssertion=function(n){var e=n.pos;if(n.lastAssertionIsQuantifiable=!1,n.eat(94)||n.eat(36))return!0;if(n.eat(92)){if(n.eat(66)||n.eat(98))return!0;n.pos=e}if(n.eat(40)&&n.eat(63)){var t=!1;if(this.options.ecmaVersion>=9&&(t=n.eat(60)),n.eat(61)||n.eat(33))return this.regexp_disjunction(n),n.eat(41)||n.raise("Unterminated group"),n.lastAssertionIsQuantifiable=!t,!0}return n.pos=e,!1};Ee.regexp_eatQuantifier=function(n,e){return e===void 0&&(e=!1),this.regexp_eatQuantifierPrefix(n,e)?(n.eat(63),!0):!1};Ee.regexp_eatQuantifierPrefix=function(n,e){return n.eat(42)||n.eat(43)||n.eat(63)||this.regexp_eatBracedQuantifier(n,e)};Ee.regexp_eatBracedQuantifier=function(n,e){var t=n.pos;if(n.eat(123)){var i=0,s=-1;if(this.regexp_eatDecimalDigits(n)&&(i=n.lastIntValue,n.eat(44)&&this.regexp_eatDecimalDigits(n)&&(s=n.lastIntValue),n.eat(125)))return s!==-1&&s<i&&!e&&n.raise("numbers out of order in {} quantifier"),!0;n.switchU&&!e&&n.raise("Incomplete quantifier"),n.pos=t}return!1};Ee.regexp_eatAtom=function(n){return this.regexp_eatPatternCharacters(n)||n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)};Ee.regexp_eatReverseSolidusAtomEscape=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatAtomEscape(n))return!0;n.pos=e}return!1};Ee.regexp_eatUncapturingGroup=function(n){var e=n.pos;if(n.eat(40)){if(n.eat(63)){if(this.options.ecmaVersion>=16){var t=this.regexp_eatModifiers(n),i=n.eat(45);if(t||i){for(var s=0;s<t.length;s++){var r=t.charAt(s);t.indexOf(r,s+1)>-1&&n.raise("Duplicate regular expression modifiers")}if(i){var a=this.regexp_eatModifiers(n);!t&&!a&&n.current()===58&&n.raise("Invalid regular expression modifiers");for(var o=0;o<a.length;o++){var l=a.charAt(o);(a.indexOf(l,o+1)>-1||t.indexOf(l)>-1)&&n.raise("Duplicate regular expression modifiers")}}}}if(n.eat(58)){if(this.regexp_disjunction(n),n.eat(41))return!0;n.raise("Unterminated group")}}n.pos=e}return!1};Ee.regexp_eatCapturingGroup=function(n){if(n.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(n):n.current()===63&&n.raise("Invalid group"),this.regexp_disjunction(n),n.eat(41))return n.numCapturingParens+=1,!0;n.raise("Unterminated group")}return!1};Ee.regexp_eatModifiers=function(n){for(var e="",t=0;(t=n.current())!==-1&&QD(t);)e+=bs(t),n.advance();return e};function QD(n){return n===105||n===109||n===115}Ee.regexp_eatExtendedAtom=function(n){return n.eat(46)||this.regexp_eatReverseSolidusAtomEscape(n)||this.regexp_eatCharacterClass(n)||this.regexp_eatUncapturingGroup(n)||this.regexp_eatCapturingGroup(n)||this.regexp_eatInvalidBracedQuantifier(n)||this.regexp_eatExtendedPatternCharacter(n)};Ee.regexp_eatInvalidBracedQuantifier=function(n){return this.regexp_eatBracedQuantifier(n,!0)&&n.raise("Nothing to repeat"),!1};Ee.regexp_eatSyntaxCharacter=function(n){var e=n.current();return Qy(e)?(n.lastIntValue=e,n.advance(),!0):!1};function Qy(n){return n===36||n>=40&&n<=43||n===46||n===63||n>=91&&n<=94||n>=123&&n<=125}Ee.regexp_eatPatternCharacters=function(n){for(var e=n.pos,t=0;(t=n.current())!==-1&&!Qy(t);)n.advance();return n.pos!==e};Ee.regexp_eatExtendedPatternCharacter=function(n){var e=n.current();return e!==-1&&e!==36&&!(e>=40&&e<=43)&&e!==46&&e!==63&&e!==91&&e!==94&&e!==124?(n.advance(),!0):!1};Ee.regexp_groupSpecifier=function(n){if(n.eat(63)){this.regexp_eatGroupName(n)||n.raise("Invalid group");var e=this.options.ecmaVersion>=16,t=n.groupNames[n.lastStringValue];if(t)if(e)for(var i=0,s=t;i<s.length;i+=1){var r=s[i];r.separatedFrom(n.branchID)||n.raise("Duplicate capture group name")}else n.raise("Duplicate capture group name");e?(t||(n.groupNames[n.lastStringValue]=[])).push(n.branchID):n.groupNames[n.lastStringValue]=!0}};Ee.regexp_eatGroupName=function(n){if(n.lastStringValue="",n.eat(60)){if(this.regexp_eatRegExpIdentifierName(n)&&n.eat(62))return!0;n.raise("Invalid capture group name")}return!1};Ee.regexp_eatRegExpIdentifierName=function(n){if(n.lastStringValue="",this.regexp_eatRegExpIdentifierStart(n)){for(n.lastStringValue+=bs(n.lastIntValue);this.regexp_eatRegExpIdentifierPart(n);)n.lastStringValue+=bs(n.lastIntValue);return!0}return!1};Ee.regexp_eatRegExpIdentifierStart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),RD(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function RD(n){return us(n,!0)||n===36||n===95}Ee.regexp_eatRegExpIdentifierPart=function(n){var e=n.pos,t=this.options.ecmaVersion>=11,i=n.current(t);return n.advance(t),i===92&&this.regexp_eatRegExpUnicodeEscapeSequence(n,t)&&(i=n.lastIntValue),LD(i)?(n.lastIntValue=i,!0):(n.pos=e,!1)};function LD(n){return Zs(n,!0)||n===36||n===95||n===8204||n===8205}Ee.regexp_eatAtomEscape=function(n){return this.regexp_eatBackReference(n)||this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)||n.switchN&&this.regexp_eatKGroupName(n)?!0:(n.switchU&&(n.current()===99&&n.raise("Invalid unicode escape"),n.raise("Invalid escape")),!1)};Ee.regexp_eatBackReference=function(n){var e=n.pos;if(this.regexp_eatDecimalEscape(n)){var t=n.lastIntValue;if(n.switchU)return t>n.maxBackReference&&(n.maxBackReference=t),!0;if(t<=n.numCapturingParens)return!0;n.pos=e}return!1};Ee.regexp_eatKGroupName=function(n){if(n.eat(107)){if(this.regexp_eatGroupName(n))return n.backReferenceNames.push(n.lastStringValue),!0;n.raise("Invalid named reference")}return!1};Ee.regexp_eatCharacterEscape=function(n){return this.regexp_eatControlEscape(n)||this.regexp_eatCControlLetter(n)||this.regexp_eatZero(n)||this.regexp_eatHexEscapeSequence(n)||this.regexp_eatRegExpUnicodeEscapeSequence(n,!1)||!n.switchU&&this.regexp_eatLegacyOctalEscapeSequence(n)||this.regexp_eatIdentityEscape(n)};Ee.regexp_eatCControlLetter=function(n){var e=n.pos;if(n.eat(99)){if(this.regexp_eatControlLetter(n))return!0;n.pos=e}return!1};Ee.regexp_eatZero=function(n){return n.current()===48&&!tu(n.lookahead())?(n.lastIntValue=0,n.advance(),!0):!1};Ee.regexp_eatControlEscape=function(n){var e=n.current();return e===116?(n.lastIntValue=9,n.advance(),!0):e===110?(n.lastIntValue=10,n.advance(),!0):e===118?(n.lastIntValue=11,n.advance(),!0):e===102?(n.lastIntValue=12,n.advance(),!0):e===114?(n.lastIntValue=13,n.advance(),!0):!1};Ee.regexp_eatControlLetter=function(n){var e=n.current();return Ry(e)?(n.lastIntValue=e%32,n.advance(),!0):!1};function Ry(n){return n>=65&&n<=90||n>=97&&n<=122}Ee.regexp_eatRegExpUnicodeEscapeSequence=function(n,e){e===void 0&&(e=!1);var t=n.pos,i=e||n.switchU;if(n.eat(117)){if(this.regexp_eatFixedHexDigits(n,4)){var s=n.lastIntValue;if(i&&s>=55296&&s<=56319){var r=n.pos;if(n.eat(92)&&n.eat(117)&&this.regexp_eatFixedHexDigits(n,4)){var a=n.lastIntValue;if(a>=56320&&a<=57343)return n.lastIntValue=(s-55296)*1024+(a-56320)+65536,!0}n.pos=r,n.lastIntValue=s}return!0}if(i&&n.eat(123)&&this.regexp_eatHexDigits(n)&&n.eat(125)&&ID(n.lastIntValue))return!0;i&&n.raise("Invalid unicode escape"),n.pos=t}return!1};function ID(n){return n>=0&&n<=1114111}Ee.regexp_eatIdentityEscape=function(n){if(n.switchU)return this.regexp_eatSyntaxCharacter(n)?!0:n.eat(47)?(n.lastIntValue=47,!0):!1;var e=n.current();return e!==99&&(!n.switchN||e!==107)?(n.lastIntValue=e,n.advance(),!0):!1};Ee.regexp_eatDecimalEscape=function(n){n.lastIntValue=0;var e=n.current();if(e>=49&&e<=57){do n.lastIntValue=10*n.lastIntValue+(e-48),n.advance();while((e=n.current())>=48&&e<=57);return!0}return!1};var Ly=0,vs=1,pi=2;Ee.regexp_eatCharacterClassEscape=function(n){var e=n.current();if(VD(e))return n.lastIntValue=-1,n.advance(),vs;var t=!1;if(n.switchU&&this.options.ecmaVersion>=9&&((t=e===80)||e===112)){n.lastIntValue=-1,n.advance();var i;if(n.eat(123)&&(i=this.regexp_eatUnicodePropertyValueExpression(n))&&n.eat(125))return t&&i===pi&&n.raise("Invalid property name"),i;n.raise("Invalid property name")}return Ly};function VD(n){return n===100||n===68||n===115||n===83||n===119||n===87}Ee.regexp_eatUnicodePropertyValueExpression=function(n){var e=n.pos;if(this.regexp_eatUnicodePropertyName(n)&&n.eat(61)){var t=n.lastStringValue;if(this.regexp_eatUnicodePropertyValue(n)){var i=n.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(n,t,i),vs}}if(n.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(n)){var s=n.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(n,s)}return Ly};Ee.regexp_validateUnicodePropertyNameAndValue=function(n,e,t){Ur(n.unicodeProperties.nonBinary,e)||n.raise("Invalid property name"),n.unicodeProperties.nonBinary[e].test(t)||n.raise("Invalid property value")};Ee.regexp_validateUnicodePropertyNameOrValue=function(n,e){if(n.unicodeProperties.binary.test(e))return vs;if(n.switchV&&n.unicodeProperties.binaryOfStrings.test(e))return pi;n.raise("Invalid property name")};Ee.regexp_eatUnicodePropertyName=function(n){var e=0;for(n.lastStringValue="";Iy(e=n.current());)n.lastStringValue+=bs(e),n.advance();return n.lastStringValue!==""};function Iy(n){return Ry(n)||n===95}Ee.regexp_eatUnicodePropertyValue=function(n){var e=0;for(n.lastStringValue="";zD(e=n.current());)n.lastStringValue+=bs(e),n.advance();return n.lastStringValue!==""};function zD(n){return Iy(n)||tu(n)}Ee.regexp_eatLoneUnicodePropertyNameOrValue=function(n){return this.regexp_eatUnicodePropertyValue(n)};Ee.regexp_eatCharacterClass=function(n){if(n.eat(91)){var e=n.eat(94),t=this.regexp_classContents(n);return n.eat(93)||n.raise("Unterminated character class"),e&&t===pi&&n.raise("Negated character class may contain strings"),!0}return!1};Ee.regexp_classContents=function(n){return n.current()===93?vs:n.switchV?this.regexp_classSetExpression(n):(this.regexp_nonEmptyClassRanges(n),vs)};Ee.regexp_nonEmptyClassRanges=function(n){for(;this.regexp_eatClassAtom(n);){var e=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassAtom(n)){var t=n.lastIntValue;n.switchU&&(e===-1||t===-1)&&n.raise("Invalid character class"),e!==-1&&t!==-1&&e>t&&n.raise("Range out of order in character class")}}};Ee.regexp_eatClassAtom=function(n){var e=n.pos;if(n.eat(92)){if(this.regexp_eatClassEscape(n))return!0;if(n.switchU){var t=n.current();(t===99||Zy(t))&&n.raise("Invalid class escape"),n.raise("Invalid escape")}n.pos=e}var i=n.current();return i!==93?(n.lastIntValue=i,n.advance(),!0):!1};Ee.regexp_eatClassEscape=function(n){var e=n.pos;if(n.eat(98))return n.lastIntValue=8,!0;if(n.switchU&&n.eat(45))return n.lastIntValue=45,!0;if(!n.switchU&&n.eat(99)){if(this.regexp_eatClassControlLetter(n))return!0;n.pos=e}return this.regexp_eatCharacterClassEscape(n)||this.regexp_eatCharacterEscape(n)};Ee.regexp_classSetExpression=function(n){var e=vs,t;if(!this.regexp_eatClassSetRange(n))if(t=this.regexp_eatClassSetOperand(n)){t===pi&&(e=pi);for(var i=n.pos;n.eatChars([38,38]);){if(n.current()!==38&&(t=this.regexp_eatClassSetOperand(n))){t!==pi&&(e=vs);continue}n.raise("Invalid character in character class")}if(i!==n.pos)return e;for(;n.eatChars([45,45]);)this.regexp_eatClassSetOperand(n)||n.raise("Invalid character in character class");if(i!==n.pos)return e}else n.raise("Invalid character in character class");for(;;)if(!this.regexp_eatClassSetRange(n)){if(t=this.regexp_eatClassSetOperand(n),!t)return e;t===pi&&(e=pi)}};Ee.regexp_eatClassSetRange=function(n){var e=n.pos;if(this.regexp_eatClassSetCharacter(n)){var t=n.lastIntValue;if(n.eat(45)&&this.regexp_eatClassSetCharacter(n)){var i=n.lastIntValue;return t!==-1&&i!==-1&&t>i&&n.raise("Range out of order in character class"),!0}n.pos=e}return!1};Ee.regexp_eatClassSetOperand=function(n){return this.regexp_eatClassSetCharacter(n)?vs:this.regexp_eatClassStringDisjunction(n)||this.regexp_eatNestedClass(n)};Ee.regexp_eatNestedClass=function(n){var e=n.pos;if(n.eat(91)){var t=n.eat(94),i=this.regexp_classContents(n);if(n.eat(93))return t&&i===pi&&n.raise("Negated character class may contain strings"),i;n.pos=e}if(n.eat(92)){var s=this.regexp_eatCharacterClassEscape(n);if(s)return s;n.pos=e}return null};Ee.regexp_eatClassStringDisjunction=function(n){var e=n.pos;if(n.eatChars([92,113])){if(n.eat(123)){var t=this.regexp_classStringDisjunctionContents(n);if(n.eat(125))return t}else n.raise("Invalid escape");n.pos=e}return null};Ee.regexp_classStringDisjunctionContents=function(n){for(var e=this.regexp_classString(n);n.eat(124);)this.regexp_classString(n)===pi&&(e=pi);return e};Ee.regexp_classString=function(n){for(var e=0;this.regexp_eatClassSetCharacter(n);)e++;return e===1?vs:pi};Ee.regexp_eatClassSetCharacter=function(n){var e=n.pos;if(n.eat(92))return this.regexp_eatCharacterEscape(n)||this.regexp_eatClassSetReservedPunctuator(n)?!0:n.eat(98)?(n.lastIntValue=8,!0):(n.pos=e,!1);var t=n.current();return t<0||t===n.lookahead()&&ZD(t)||jD(t)?!1:(n.advance(),n.lastIntValue=t,!0)};function ZD(n){return n===33||n>=35&&n<=38||n>=42&&n<=44||n===46||n>=58&&n<=64||n===94||n===96||n===126}function jD(n){return n===40||n===41||n===45||n===47||n>=91&&n<=93||n>=123&&n<=125}Ee.regexp_eatClassSetReservedPunctuator=function(n){var e=n.current();return qD(e)?(n.lastIntValue=e,n.advance(),!0):!1};function qD(n){return n===33||n===35||n===37||n===38||n===44||n===45||n>=58&&n<=62||n===64||n===96||n===126}Ee.regexp_eatClassControlLetter=function(n){var e=n.current();return tu(e)||e===95?(n.lastIntValue=e%32,n.advance(),!0):!1};Ee.regexp_eatHexEscapeSequence=function(n){var e=n.pos;if(n.eat(120)){if(this.regexp_eatFixedHexDigits(n,2))return!0;n.switchU&&n.raise("Invalid escape"),n.pos=e}return!1};Ee.regexp_eatDecimalDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;tu(t=n.current());)n.lastIntValue=10*n.lastIntValue+(t-48),n.advance();return n.pos!==e};function tu(n){return n>=48&&n<=57}Ee.regexp_eatHexDigits=function(n){var e=n.pos,t=0;for(n.lastIntValue=0;Vy(t=n.current());)n.lastIntValue=16*n.lastIntValue+zy(t),n.advance();return n.pos!==e};function Vy(n){return n>=48&&n<=57||n>=65&&n<=70||n>=97&&n<=102}function zy(n){return n>=65&&n<=70?10+(n-65):n>=97&&n<=102?10+(n-97):n-48}Ee.regexp_eatLegacyOctalEscapeSequence=function(n){if(this.regexp_eatOctalDigit(n)){var e=n.lastIntValue;if(this.regexp_eatOctalDigit(n)){var t=n.lastIntValue;e<=3&&this.regexp_eatOctalDigit(n)?n.lastIntValue=e*64+t*8+n.lastIntValue:n.lastIntValue=e*8+t}else n.lastIntValue=e;return!0}return!1};Ee.regexp_eatOctalDigit=function(n){var e=n.current();return Zy(e)?(n.lastIntValue=e-48,n.advance(),!0):(n.lastIntValue=0,!1)};function Zy(n){return n>=48&&n<=55}Ee.regexp_eatFixedHexDigits=function(n,e){var t=n.pos;n.lastIntValue=0;for(var i=0;i<e;++i){var s=n.current();if(!Vy(s))return n.pos=t,!1;n.lastIntValue=16*n.lastIntValue+zy(s),n.advance()}return!0};var Zd=function(e){this.type=e.type,this.value=e.value,this.start=e.start,this.end=e.end,e.options.locations&&(this.loc=new Yl(e,e.startLoc,e.endLoc)),e.options.ranges&&(this.range=[e.start,e.end])},ut=dn.prototype;ut.next=function(n){!n&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Zd(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()};ut.getToken=function(){return this.next(),new Zd(this)};typeof Symbol<"u"&&(ut[Symbol.iterator]=function(){var n=this;return{next:function(){var e=n.getToken();return{done:e.type===E.eof,value:e}}}});ut.nextToken=function(){var n=this.curContext();if((!n||!n.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(E.eof);if(n.override)return n.override(this);this.readToken(this.fullCharCodeAtPos())};ut.readToken=function(n){return us(n,this.options.ecmaVersion>=6)||n===92?this.readWord():this.getTokenFromCode(n)};ut.fullCharCodeAtPos=function(){var n=this.input.charCodeAt(this.pos);if(n<=55295||n>=56320)return n;var e=this.input.charCodeAt(this.pos+1);return e<=56319||e>=57344?n:(n<<10)+e-56613888};ut.skipBlockComment=function(){var n=this.options.onComment&&this.curPosition(),e=this.pos,t=this.input.indexOf("*/",this.pos+=2);if(t===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=t+2,this.options.locations)for(var i=void 0,s=e;(i=fy(this.input,s,this.pos))>-1;)++this.curLine,s=this.lineStart=i;this.options.onComment&&this.options.onComment(!0,this.input.slice(e+2,t),e,this.pos,n,this.curPosition())};ut.skipLineComment=function(n){for(var e=this.pos,t=this.options.onComment&&this.curPosition(),i=this.input.charCodeAt(this.pos+=n);this.pos<this.input.length&&!Xr(i);)i=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+n,this.pos),e,this.pos,t,this.curPosition())};ut.skipSpace=function(){e:for(;this.pos<this.input.length;){var n=this.input.charCodeAt(this.pos);switch(n){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(n>8&&n<14||n>=5760&&py.test(String.fromCharCode(n)))++this.pos;else break e}}};ut.finishToken=function(n,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var t=this.type;this.type=n,this.value=e,this.updateContext(t)};ut.readToken_dot=function(){var n=this.input.charCodeAt(this.pos+1);if(n>=48&&n<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&n===46&&e===46?(this.pos+=3,this.finishToken(E.ellipsis)):(++this.pos,this.finishToken(E.dot))};ut.readToken_slash=function(){var n=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):n===61?this.finishOp(E.assign,2):this.finishOp(E.slash,1)};ut.readToken_mult_modulo_exp=function(n){var e=this.input.charCodeAt(this.pos+1),t=1,i=n===42?E.star:E.modulo;return this.options.ecmaVersion>=7&&n===42&&e===42&&(++t,i=E.starstar,e=this.input.charCodeAt(this.pos+2)),e===61?this.finishOp(E.assign,t+1):this.finishOp(i,t)};ut.readToken_pipe_amp=function(n){var e=this.input.charCodeAt(this.pos+1);if(e===n){if(this.options.ecmaVersion>=12){var t=this.input.charCodeAt(this.pos+2);if(t===61)return this.finishOp(E.assign,3)}return this.finishOp(n===124?E.logicalOR:E.logicalAND,2)}return e===61?this.finishOp(E.assign,2):this.finishOp(n===124?E.bitwiseOR:E.bitwiseAND,1)};ut.readToken_caret=function(){var n=this.input.charCodeAt(this.pos+1);return n===61?this.finishOp(E.assign,2):this.finishOp(E.bitwiseXOR,1)};ut.readToken_plus_min=function(n){var e=this.input.charCodeAt(this.pos+1);return e===n?e===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Kn.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(E.incDec,2):e===61?this.finishOp(E.assign,2):this.finishOp(E.plusMin,1)};ut.readToken_lt_gt=function(n){var e=this.input.charCodeAt(this.pos+1),t=1;return e===n?(t=n===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+t)===61?this.finishOp(E.assign,t+1):this.finishOp(E.bitShift,t)):e===33&&n===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(e===61&&(t=2),this.finishOp(E.relational,t))};ut.readToken_eq_excl=function(n){var e=this.input.charCodeAt(this.pos+1);return e===61?this.finishOp(E.equality,this.input.charCodeAt(this.pos+2)===61?3:2):n===61&&e===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(E.arrow)):this.finishOp(n===61?E.eq:E.prefix,1)};ut.readToken_question=function(){var n=this.options.ecmaVersion;if(n>=11){var e=this.input.charCodeAt(this.pos+1);if(e===46){var t=this.input.charCodeAt(this.pos+2);if(t<48||t>57)return this.finishOp(E.questionDot,2)}if(e===63){if(n>=12){var i=this.input.charCodeAt(this.pos+2);if(i===61)return this.finishOp(E.assign,3)}return this.finishOp(E.coalesce,2)}}return this.finishOp(E.question,1)};ut.readToken_numberSign=function(){var n=this.options.ecmaVersion,e=35;if(n>=13&&(++this.pos,e=this.fullCharCodeAtPos(),us(e,!0)||e===92))return this.finishToken(E.privateId,this.readWord1());this.raise(this.pos,"Unexpected character '"+bs(e)+"'")};ut.getTokenFromCode=function(n){switch(n){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(E.parenL);case 41:return++this.pos,this.finishToken(E.parenR);case 59:return++this.pos,this.finishToken(E.semi);case 44:return++this.pos,this.finishToken(E.comma);case 91:return++this.pos,this.finishToken(E.bracketL);case 93:return++this.pos,this.finishToken(E.bracketR);case 123:return++this.pos,this.finishToken(E.braceL);case 125:return++this.pos,this.finishToken(E.braceR);case 58:return++this.pos,this.finishToken(E.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(E.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(e===120||e===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(e===111||e===79)return this.readRadixNumber(8);if(e===98||e===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(n);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(n);case 124:case 38:return this.readToken_pipe_amp(n);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(n);case 60:case 62:return this.readToken_lt_gt(n);case 61:case 33:return this.readToken_eq_excl(n);case 63:return this.readToken_question();case 126:return this.finishOp(E.prefix,1);case 35:return this.readToken_numberSign()}this.raise(this.pos,"Unexpected character '"+bs(n)+"'")};ut.finishOp=function(n,e){var t=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(n,t)};ut.readRegexp=function(){for(var n,e,t=this.pos;;){this.pos>=this.input.length&&this.raise(t,"Unterminated regular expression");var i=this.input.charAt(this.pos);if(Kn.test(i)&&this.raise(t,"Unterminated regular expression"),n)n=!1;else{if(i==="[")e=!0;else if(i==="]"&&e)e=!1;else if(i==="/"&&!e)break;n=i==="\\"}++this.pos}var s=this.input.slice(t,this.pos);++this.pos;var r=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(r);var o=this.regexpState||(this.regexpState=new hs(this));o.reset(t,s,a),this.validateRegExpFlags(o),this.validateRegExpPattern(o);var l=null;try{l=new RegExp(s,a)}catch{}return this.finishToken(E.regexp,{pattern:s,flags:a,value:l})};ut.readInt=function(n,e,t){for(var i=this.options.ecmaVersion>=12&&e===void 0,s=t&&this.input.charCodeAt(this.pos)===48,r=this.pos,a=0,o=0,l=0,c=e??1/0;l<c;++l,++this.pos){var u=this.input.charCodeAt(this.pos),h=void 0;if(i&&u===95){s&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),o===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),l===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),o=u;continue}if(u>=97?h=u-97+10:u>=65?h=u-65+10:u>=48&&u<=57?h=u-48:h=1/0,h>=n)break;o=u,a=a*n+h}return i&&o===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===r||e!=null&&this.pos-r!==e?null:a};function GD(n,e){return e?parseInt(n,8):parseFloat(n.replace(/_/g,""))}function jy(n){return typeof BigInt!="function"?null:BigInt(n.replace(/_/g,""))}ut.readRadixNumber=function(n){var e=this.pos;this.pos+=2;var t=this.readInt(n);return t==null&&this.raise(this.start+2,"Expected number in radix "+n),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(t=jy(this.input.slice(e,this.pos)),++this.pos):us(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(E.num,t)};ut.readNumber=function(n){var e=this.pos;!n&&this.readInt(10,void 0,!0)===null&&this.raise(e,"Invalid number");var t=this.pos-e>=2&&this.input.charCodeAt(e)===48;t&&this.strict&&this.raise(e,"Invalid number");var i=this.input.charCodeAt(this.pos);if(!t&&!n&&this.options.ecmaVersion>=11&&i===110){var s=jy(this.input.slice(e,this.pos));return++this.pos,us(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(E.num,s)}t&&/[89]/.test(this.input.slice(e,this.pos))&&(t=!1),i===46&&!t&&(++this.pos,this.readInt(10),i=this.input.charCodeAt(this.pos)),(i===69||i===101)&&!t&&(i=this.input.charCodeAt(++this.pos),(i===43||i===45)&&++this.pos,this.readInt(10)===null&&this.raise(e,"Invalid number")),us(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var r=GD(this.input.slice(e,this.pos),t);return this.finishToken(E.num,r)};ut.readCodePoint=function(){var n=this.input.charCodeAt(this.pos),e;if(n===123){this.options.ecmaVersion<6&&this.unexpected();var t=++this.pos;e=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,e>1114111&&this.invalidStringToken(t,"Code point out of bounds")}else e=this.readHexChar(4);return e};ut.readString=function(n){for(var e="",t=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var i=this.input.charCodeAt(this.pos);if(i===n)break;i===92?(e+=this.input.slice(t,this.pos),e+=this.readEscapedChar(!1),t=this.pos):i===8232||i===8233?(this.options.ecmaVersion<10&&this.raise(this.start,"Unterminated string constant"),++this.pos,this.options.locations&&(this.curLine++,this.lineStart=this.pos)):(Xr(i)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(t,this.pos++),this.finishToken(E.string,e)};var qy={};ut.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(n){if(n===qy)this.readInvalidTemplateToken();else throw n}this.inTemplateElement=!1};ut.invalidStringToken=function(n,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw qy;this.raise(n,e)};ut.readTmplToken=function(){for(var n="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var t=this.input.charCodeAt(this.pos);if(t===96||t===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===E.template||this.type===E.invalidTemplate)?t===36?(this.pos+=2,this.finishToken(E.dollarBraceL)):(++this.pos,this.finishToken(E.backQuote)):(n+=this.input.slice(e,this.pos),this.finishToken(E.template,n));if(t===92)n+=this.input.slice(e,this.pos),n+=this.readEscapedChar(!0),e=this.pos;else if(Xr(t)){switch(n+=this.input.slice(e,this.pos),++this.pos,t){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:n+=`
`;break;default:n+=String.fromCharCode(t);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}};ut.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(E.invalidTemplate,this.input.slice(this.start,this.pos));case"\r":this.input[this.pos+1]===`
`&&++this.pos;case`
`:case"\u2028":case"\u2029":++this.curLine,this.lineStart=this.pos+1;break}this.raise(this.start,"Unterminated template")};ut.readEscapedChar=function(n){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return bs(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(this.strict&&this.invalidStringToken(this.pos-1,"Invalid escape sequence"),n){var t=this.pos-1;this.invalidStringToken(t,"Invalid escape sequence in template string")}default:if(e>=48&&e<=55){var i=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],s=parseInt(i,8);return s>255&&(i=i.slice(0,-1),s=parseInt(i,8)),this.pos+=i.length-1,e=this.input.charCodeAt(this.pos),(i!=="0"||e===56||e===57)&&(this.strict||n)&&this.invalidStringToken(this.pos-1-i.length,n?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(s)}return Xr(e)?(this.options.locations&&(this.lineStart=this.pos,++this.curLine),""):String.fromCharCode(e)}};ut.readHexChar=function(n){var e=this.pos,t=this.readInt(16,n);return t===null&&this.invalidStringToken(e,"Bad character escape sequence"),t};ut.readWord1=function(){this.containsEsc=!1;for(var n="",e=!0,t=this.pos,i=this.options.ecmaVersion>=6;this.pos<this.input.length;){var s=this.fullCharCodeAtPos();if(Zs(s,i))this.pos+=s<=65535?1:2;else if(s===92){this.containsEsc=!0,n+=this.input.slice(t,this.pos);var r=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?us:Zs)(a,i)||this.invalidStringToken(r,"Invalid Unicode escape"),n+=bs(a),t=this.pos}else break;e=!1}return n+this.input.slice(t,this.pos)};ut.readWord=function(){var n=this.readWord1(),e=E.name;return this.keywords.test(n)&&(e=Qd[n]),this.finishToken(e,n)};var WD="8.15.0";dn.acorn={Parser:dn,version:WD,defaultOptions:Qh,Position:za,SourceLocation:Yl,getLineInfo:gy,Node:eu,TokenType:Ot,tokTypes:E,keywordTypes:Qd,TokContext:Ei,tokContexts:Gt,isIdentifierChar:Zs,isIdentifierStart:us,Token:Zd,isNewLine:Xr,lineBreak:Kn,lineBreakG:mD,nonASCIIwhitespace:py};function XD(n,e){return dn.parse(n,e)}var UD=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function A3(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(i){var s=Object.getOwnPropertyDescriptor(n,i);Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:function(){return n[i]}})}),t}var Ku={},Ju={},km;function YD(){return km||(km=1,(function(n){(function e(t){var i,s,r,a,o,l;function c(C){var $={},A,Q;for(A in C)C.hasOwnProperty(A)&&(Q=C[A],typeof Q=="object"&&Q!==null?$[A]=c(Q):$[A]=Q);return $}function u(C,$){var A,Q,q,W;for(Q=C.length,q=0;Q;)A=Q>>>1,W=q+A,$(C[W])?Q=A:(q=W+1,Q-=A+1);return q}i={AssignmentExpression:"AssignmentExpression",AssignmentPattern:"AssignmentPattern",ArrayExpression:"ArrayExpression",ArrayPattern:"ArrayPattern",ArrowFunctionExpression:"ArrowFunctionExpression",AwaitExpression:"AwaitExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ChainExpression:"ChainExpression",ClassBody:"ClassBody",ClassDeclaration:"ClassDeclaration",ClassExpression:"ClassExpression",ComprehensionBlock:"ComprehensionBlock",ComprehensionExpression:"ComprehensionExpression",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DebuggerStatement:"DebuggerStatement",DirectiveStatement:"DirectiveStatement",DoWhileStatement:"DoWhileStatement",EmptyStatement:"EmptyStatement",ExportAllDeclaration:"ExportAllDeclaration",ExportDefaultDeclaration:"ExportDefaultDeclaration",ExportNamedDeclaration:"ExportNamedDeclaration",ExportSpecifier:"ExportSpecifier",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",ForOfStatement:"ForOfStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",GeneratorExpression:"GeneratorExpression",Identifier:"Identifier",IfStatement:"IfStatement",ImportExpression:"ImportExpression",ImportDeclaration:"ImportDeclaration",ImportDefaultSpecifier:"ImportDefaultSpecifier",ImportNamespaceSpecifier:"ImportNamespaceSpecifier",ImportSpecifier:"ImportSpecifier",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",MetaProperty:"MetaProperty",MethodDefinition:"MethodDefinition",ModuleSpecifier:"ModuleSpecifier",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",ObjectPattern:"ObjectPattern",PrivateIdentifier:"PrivateIdentifier",Program:"Program",Property:"Property",PropertyDefinition:"PropertyDefinition",RestElement:"RestElement",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SpreadElement:"SpreadElement",Super:"Super",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",TaggedTemplateExpression:"TaggedTemplateExpression",TemplateElement:"TemplateElement",TemplateLiteral:"TemplateLiteral",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement",YieldExpression:"YieldExpression"},r={AssignmentExpression:["left","right"],AssignmentPattern:["left","right"],ArrayExpression:["elements"],ArrayPattern:["elements"],ArrowFunctionExpression:["params","body"],AwaitExpression:["argument"],BlockStatement:["body"],BinaryExpression:["left","right"],BreakStatement:["label"],CallExpression:["callee","arguments"],CatchClause:["param","body"],ChainExpression:["expression"],ClassBody:["body"],ClassDeclaration:["id","superClass","body"],ClassExpression:["id","superClass","body"],ComprehensionBlock:["left","right"],ComprehensionExpression:["blocks","filter","body"],ConditionalExpression:["test","consequent","alternate"],ContinueStatement:["label"],DebuggerStatement:[],DirectiveStatement:[],DoWhileStatement:["body","test"],EmptyStatement:[],ExportAllDeclaration:["source"],ExportDefaultDeclaration:["declaration"],ExportNamedDeclaration:["declaration","specifiers","source"],ExportSpecifier:["exported","local"],ExpressionStatement:["expression"],ForStatement:["init","test","update","body"],ForInStatement:["left","right","body"],ForOfStatement:["left","right","body"],FunctionDeclaration:["id","params","body"],FunctionExpression:["id","params","body"],GeneratorExpression:["blocks","filter","body"],Identifier:[],IfStatement:["test","consequent","alternate"],ImportExpression:["source"],ImportDeclaration:["specifiers","source"],ImportDefaultSpecifier:["local"],ImportNamespaceSpecifier:["local"],ImportSpecifier:["imported","local"],Literal:[],LabeledStatement:["label","body"],LogicalExpression:["left","right"],MemberExpression:["object","property"],MetaProperty:["meta","property"],MethodDefinition:["key","value"],ModuleSpecifier:[],NewExpression:["callee","arguments"],ObjectExpression:["properties"],ObjectPattern:["properties"],PrivateIdentifier:[],Program:["body"],Property:["key","value"],PropertyDefinition:["key","value"],RestElement:["argument"],ReturnStatement:["argument"],SequenceExpression:["expressions"],SpreadElement:["argument"],Super:[],SwitchStatement:["discriminant","cases"],SwitchCase:["test","consequent"],TaggedTemplateExpression:["tag","quasi"],TemplateElement:[],TemplateLiteral:["quasis","expressions"],ThisExpression:[],ThrowStatement:["argument"],TryStatement:["block","handler","finalizer"],UnaryExpression:["argument"],UpdateExpression:["argument"],VariableDeclaration:["declarations"],VariableDeclarator:["id","init"],WhileStatement:["test","body"],WithStatement:["object","body"],YieldExpression:["argument"]},a={},o={},l={},s={Break:a,Skip:o,Remove:l};function h(C,$){this.parent=C,this.key=$}h.prototype.replace=function($){this.parent[this.key]=$},h.prototype.remove=function(){return Array.isArray(this.parent)?(this.parent.splice(this.key,1),!0):(this.replace(null),!1)};function d(C,$,A,Q){this.node=C,this.path=$,this.wrap=A,this.ref=Q}function f(){}f.prototype.path=function(){var $,A,Q,q,W,U;function Z(Y,ne){if(Array.isArray(ne))for(Q=0,q=ne.length;Q<q;++Q)Y.push(ne[Q]);else Y.push(ne)}if(!this.__current.path)return null;for(W=[],$=2,A=this.__leavelist.length;$<A;++$)U=this.__leavelist[$],Z(W,U.path);return Z(W,this.__current.path),W},f.prototype.type=function(){var C=this.current();return C.type||this.__current.wrap},f.prototype.parents=function(){var $,A,Q;for(Q=[],$=1,A=this.__leavelist.length;$<A;++$)Q.push(this.__leavelist[$].node);return Q},f.prototype.current=function(){return this.__current.node},f.prototype.__execute=function($,A){var Q,q;return q=void 0,Q=this.__current,this.__current=A,this.__state=null,$&&(q=$.call(this,A.node,this.__leavelist[this.__leavelist.length-1].node)),this.__current=Q,q},f.prototype.notify=function($){this.__state=$},f.prototype.skip=function(){this.notify(o)},f.prototype.break=function(){this.notify(a)},f.prototype.remove=function(){this.notify(l)},f.prototype.__initialize=function(C,$){this.visitor=$,this.root=C,this.__worklist=[],this.__leavelist=[],this.__current=null,this.__state=null,this.__fallback=null,$.fallback==="iteration"?this.__fallback=Object.keys:typeof $.fallback=="function"&&(this.__fallback=$.fallback),this.__keys=r,$.keys&&(this.__keys=Object.assign(Object.create(this.__keys),$.keys))};function m(C){return C==null?!1:typeof C=="object"&&typeof C.type=="string"}function g(C,$){return(C===i.ObjectExpression||C===i.ObjectPattern)&&$==="properties"}function y(C,$){for(var A=C.length-1;A>=0;--A)if(C[A].node===$)return!0;return!1}f.prototype.traverse=function($,A){var Q,q,W,U,Z,Y,ne,re,ve,Ce,De,Ue;for(this.__initialize($,A),Ue={},Q=this.__worklist,q=this.__leavelist,Q.push(new d($,null,null,null)),q.push(new d(null,null,null,null));Q.length;){if(W=Q.pop(),W===Ue){if(W=q.pop(),Y=this.__execute(A.leave,W),this.__state===a||Y===a)return;continue}if(W.node){if(Y=this.__execute(A.enter,W),this.__state===a||Y===a)return;if(Q.push(Ue),q.push(W),this.__state===o||Y===o)continue;if(U=W.node,Z=U.type||W.wrap,Ce=this.__keys[Z],!Ce)if(this.__fallback)Ce=this.__fallback(U);else throw new Error("Unknown node type "+Z+".");for(re=Ce.length;(re-=1)>=0;)if(ne=Ce[re],De=U[ne],!!De){if(Array.isArray(De)){for(ve=De.length;(ve-=1)>=0;)if(De[ve]&&!y(q,De[ve])){if(g(Z,Ce[re]))W=new d(De[ve],[ne,ve],"Property",null);else if(m(De[ve]))W=new d(De[ve],[ne,ve],null,null);else continue;Q.push(W)}}else if(m(De)){if(y(q,De))continue;Q.push(new d(De,ne,null,null))}}}}},f.prototype.replace=function($,A){var Q,q,W,U,Z,Y,ne,re,ve,Ce,De,Ue,Pt;function yt(ue){var Je,he,Et,Ze;if(ue.ref.remove()){for(he=ue.ref.key,Ze=ue.ref.parent,Je=Q.length;Je--;)if(Et=Q[Je],Et.ref&&Et.ref.parent===Ze){if(Et.ref.key<he)break;--Et.ref.key}}}for(this.__initialize($,A),De={},Q=this.__worklist,q=this.__leavelist,Ue={root:$},Y=new d($,null,null,new h(Ue,"root")),Q.push(Y),q.push(Y);Q.length;){if(Y=Q.pop(),Y===De){if(Y=q.pop(),Z=this.__execute(A.leave,Y),Z!==void 0&&Z!==a&&Z!==o&&Z!==l&&Y.ref.replace(Z),(this.__state===l||Z===l)&&yt(Y),this.__state===a||Z===a)return Ue.root;continue}if(Z=this.__execute(A.enter,Y),Z!==void 0&&Z!==a&&Z!==o&&Z!==l&&(Y.ref.replace(Z),Y.node=Z),(this.__state===l||Z===l)&&(yt(Y),Y.node=null),this.__state===a||Z===a)return Ue.root;if(W=Y.node,!!W&&(Q.push(De),q.push(Y),!(this.__state===o||Z===o))){if(U=W.type||Y.wrap,ve=this.__keys[U],!ve)if(this.__fallback)ve=this.__fallback(W);else throw new Error("Unknown node type "+U+".");for(ne=ve.length;(ne-=1)>=0;)if(Pt=ve[ne],Ce=W[Pt],!!Ce)if(Array.isArray(Ce)){for(re=Ce.length;(re-=1)>=0;)if(Ce[re]){if(g(U,ve[ne]))Y=new d(Ce[re],[Pt,re],"Property",new h(Ce,re));else if(m(Ce[re]))Y=new d(Ce[re],[Pt,re],null,new h(Ce,re));else continue;Q.push(Y)}}else m(Ce)&&Q.push(new d(Ce,Pt,null,new h(W,Pt)))}}return Ue.root};function b(C,$){var A=new f;return A.traverse(C,$)}function P(C,$){var A=new f;return A.replace(C,$)}function k(C,$){var A;return A=u($,function(q){return q.range[0]>C.range[0]}),C.extendedRange=[C.range[0],C.range[1]],A!==$.length&&(C.extendedRange[1]=$[A].range[0]),A-=1,A>=0&&(C.extendedRange[0]=$[A].range[1]),C}function w(C,$,A){var Q=[],q,W,U,Z;if(!C.range)throw new Error("attachComments needs range information");if(!A.length){if($.length){for(U=0,W=$.length;U<W;U+=1)q=c($[U]),q.extendedRange=[0,C.range[0]],Q.push(q);C.leadingComments=Q}return C}for(U=0,W=$.length;U<W;U+=1)Q.push(k(c($[U]),A));return Z=0,b(C,{enter:function(Y){for(var ne;Z<Q.length&&(ne=Q[Z],!(ne.extendedRange[1]>Y.range[0]));)ne.extendedRange[1]===Y.range[0]?(Y.leadingComments||(Y.leadingComments=[]),Y.leadingComments.push(ne),Q.splice(Z,1)):Z+=1;if(Z===Q.length)return s.Break;if(Q[Z].extendedRange[0]>Y.range[1])return s.Skip}}),Z=0,b(C,{leave:function(Y){for(var ne;Z<Q.length&&(ne=Q[Z],!(Y.range[1]<ne.extendedRange[0]));)Y.range[1]===ne.extendedRange[0]?(Y.trailingComments||(Y.trailingComments=[]),Y.trailingComments.push(ne),Q.splice(Z,1)):Z+=1;if(Z===Q.length)return s.Break;if(Q[Z].extendedRange[0]>Y.range[1])return s.Skip}}),C}return t.Syntax=i,t.traverse=b,t.replace=P,t.attachComments=w,t.VisitorKeys=r,t.VisitorOption=s,t.Controller=f,t.cloneEnvironment=function(){return e({})},t})(n)})(Ju)),Ju}var la={},ec={exports:{}},Em;function HD(){return Em||(Em=1,(function(){function n(a){if(a==null)return!1;switch(a.type){case"ArrayExpression":case"AssignmentExpression":case"BinaryExpression":case"CallExpression":case"ConditionalExpression":case"FunctionExpression":case"Identifier":case"Literal":case"LogicalExpression":case"MemberExpression":case"NewExpression":case"ObjectExpression":case"SequenceExpression":case"ThisExpression":case"UnaryExpression":case"UpdateExpression":return!0}return!1}function e(a){if(a==null)return!1;switch(a.type){case"DoWhileStatement":case"ForInStatement":case"ForStatement":case"WhileStatement":return!0}return!1}function t(a){if(a==null)return!1;switch(a.type){case"BlockStatement":case"BreakStatement":case"ContinueStatement":case"DebuggerStatement":case"DoWhileStatement":case"EmptyStatement":case"ExpressionStatement":case"ForInStatement":case"ForStatement":case"IfStatement":case"LabeledStatement":case"ReturnStatement":case"SwitchStatement":case"ThrowStatement":case"TryStatement":case"VariableDeclaration":case"WhileStatement":case"WithStatement":return!0}return!1}function i(a){return t(a)||a!=null&&a.type==="FunctionDeclaration"}function s(a){switch(a.type){case"IfStatement":return a.alternate!=null?a.alternate:a.consequent;case"LabeledStatement":case"ForStatement":case"ForInStatement":case"WhileStatement":case"WithStatement":return a.body}return null}function r(a){var o;if(a.type!=="IfStatement"||a.alternate==null)return!1;o=a.consequent;do{if(o.type==="IfStatement"&&o.alternate==null)return!0;o=s(o)}while(o);return!1}ec.exports={isExpression:n,isStatement:t,isIterationStatement:e,isSourceElement:i,isProblematicIfStatement:r,trailingStatement:s}})()),ec.exports}var tc={exports:{}},$m;function Gy(){return $m||($m=1,(function(){var n,e,t,i,s,r;e={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,NonAsciiIdentifierPart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19D9\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u2E2F\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099\u309A\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/},n={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDF00-\uDF19]|\uD806[\uDCA0-\uDCDF\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50\uDF93-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05F0-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u0800-\u082D\u0840-\u085B\u08A0-\u08B4\u08B6-\u08BD\u08D4-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C03\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D01-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB9\u0EBB-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1877\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1CD0-\u1CD2\u1CD4-\u1CF6\u1CF8\u1CF9\u1D00-\u1DF5\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7AE\uA7B0-\uA7B7\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD\uA900-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB65\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF30-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE33\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDCA-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3C-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB7\uDEC0-\uDEC9\uDF00-\uDF19\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDCA0-\uDCE9\uDCFF\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDF00-\uDF44\uDF50-\uDF7E\uDF8F-\uDF9F\uDFE0]|\uD821[\uDC00-\uDFEC]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00\uDC01]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4A\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/};function a(y){return 48<=y&&y<=57}function o(y){return 48<=y&&y<=57||97<=y&&y<=102||65<=y&&y<=70}function l(y){return y>=48&&y<=55}t=[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];function c(y){return y===32||y===9||y===11||y===12||y===160||y>=5760&&t.indexOf(y)>=0}function u(y){return y===10||y===13||y===8232||y===8233}function h(y){if(y<=65535)return String.fromCharCode(y);var b=String.fromCharCode(Math.floor((y-65536)/1024)+55296),P=String.fromCharCode((y-65536)%1024+56320);return b+P}for(i=new Array(128),r=0;r<128;++r)i[r]=r>=97&&r<=122||r>=65&&r<=90||r===36||r===95;for(s=new Array(128),r=0;r<128;++r)s[r]=r>=97&&r<=122||r>=65&&r<=90||r>=48&&r<=57||r===36||r===95;function d(y){return y<128?i[y]:e.NonAsciiIdentifierStart.test(h(y))}function f(y){return y<128?s[y]:e.NonAsciiIdentifierPart.test(h(y))}function m(y){return y<128?i[y]:n.NonAsciiIdentifierStart.test(h(y))}function g(y){return y<128?s[y]:n.NonAsciiIdentifierPart.test(h(y))}tc.exports={isDecimalDigit:a,isHexDigit:o,isOctalDigit:l,isWhiteSpace:c,isLineTerminator:u,isIdentifierStartES5:d,isIdentifierPartES5:f,isIdentifierStartES6:m,isIdentifierPartES6:g}})()),tc.exports}var nc={exports:{}},Dm;function KD(){return Dm||(Dm=1,(function(){var n=Gy();function e(d){switch(d){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"let":return!0;default:return!1}}function t(d,f){return!f&&d==="yield"?!1:i(d,f)}function i(d,f){if(f&&e(d))return!0;switch(d.length){case 2:return d==="if"||d==="in"||d==="do";case 3:return d==="var"||d==="for"||d==="new"||d==="try";case 4:return d==="this"||d==="else"||d==="case"||d==="void"||d==="with"||d==="enum";case 5:return d==="while"||d==="break"||d==="catch"||d==="throw"||d==="const"||d==="yield"||d==="class"||d==="super";case 6:return d==="return"||d==="typeof"||d==="delete"||d==="switch"||d==="export"||d==="import";case 7:return d==="default"||d==="finally"||d==="extends";case 8:return d==="function"||d==="continue"||d==="debugger";case 10:return d==="instanceof";default:return!1}}function s(d,f){return d==="null"||d==="true"||d==="false"||t(d,f)}function r(d,f){return d==="null"||d==="true"||d==="false"||i(d,f)}function a(d){return d==="eval"||d==="arguments"}function o(d){var f,m,g;if(d.length===0||(g=d.charCodeAt(0),!n.isIdentifierStartES5(g)))return!1;for(f=1,m=d.length;f<m;++f)if(g=d.charCodeAt(f),!n.isIdentifierPartES5(g))return!1;return!0}function l(d,f){return(d-55296)*1024+(f-56320)+65536}function c(d){var f,m,g,y,b;if(d.length===0)return!1;for(b=n.isIdentifierStartES6,f=0,m=d.length;f<m;++f){if(g=d.charCodeAt(f),55296<=g&&g<=56319){if(++f,f>=m||(y=d.charCodeAt(f),!(56320<=y&&y<=57343)))return!1;g=l(g,y)}if(!b(g))return!1;b=n.isIdentifierPartES6}return!0}function u(d,f){return o(d)&&!s(d,f)}function h(d,f){return c(d)&&!r(d,f)}nc.exports={isKeywordES5:t,isKeywordES6:i,isReservedWordES5:s,isReservedWordES6:r,isRestrictedWord:a,isIdentifierNameES5:o,isIdentifierNameES6:c,isIdentifierES5:u,isIdentifierES6:h}})()),nc.exports}var Mm;function JD(){return Mm||(Mm=1,(function(){la.ast=HD(),la.code=Gy(),la.keyword=KD()})()),la}var ua={},ic={},ko={},Eo={},Tm;function eM(){if(Tm)return Eo;Tm=1;var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return Eo.encode=function(e){if(0<=e&&e<n.length)return n[e];throw new TypeError("Must be between 0 and 63: "+e)},Eo.decode=function(e){var t=65,i=90,s=97,r=122,a=48,o=57,l=43,c=47,u=26,h=52;return t<=e&&e<=i?e-t:s<=e&&e<=r?e-s+u:a<=e&&e<=o?e-a+h:e==l?62:e==c?63:-1},Eo}var _m;function Wy(){if(_m)return ko;_m=1;var n=eM(),e=5,t=1<<e,i=t-1,s=t;function r(o){return o<0?(-o<<1)+1:(o<<1)+0}function a(o){var l=(o&1)===1,c=o>>1;return l?-c:c}return ko.encode=function(l){var c="",u,h=r(l);do u=h&i,h>>>=e,h>0&&(u|=s),c+=n.encode(u);while(h>0);return c},ko.decode=function(l,c,u){var h=l.length,d=0,f=0,m,g;do{if(c>=h)throw new Error("Expected more digits in base 64 VLQ value.");if(g=n.decode(l.charCodeAt(c++)),g===-1)throw new Error("Invalid base64 digit: "+l.charAt(c-1));m=!!(g&s),g&=i,d=d+(g<<f),f+=e}while(m);u.value=a(d),u.rest=c},ko}var sc={},Fm;function no(){return Fm||(Fm=1,(function(n){function e(w,C,$){if(C in w)return w[C];if(arguments.length===3)return $;throw new Error('"'+C+'" is a required argument.')}n.getArg=e;var t=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.-]*)(?::(\d+))?(.*)$/,i=/^data:.+\,.+$/;function s(w){var C=w.match(t);return C?{scheme:C[1],auth:C[2],host:C[3],port:C[4],path:C[5]}:null}n.urlParse=s;function r(w){var C="";return w.scheme&&(C+=w.scheme+":"),C+="//",w.auth&&(C+=w.auth+"@"),w.host&&(C+=w.host),w.port&&(C+=":"+w.port),w.path&&(C+=w.path),C}n.urlGenerate=r;function a(w){var C=w,$=s(w);if($){if(!$.path)return w;C=$.path}for(var A=n.isAbsolute(C),Q=C.split(/\/+/),q,W=0,U=Q.length-1;U>=0;U--)q=Q[U],q==="."?Q.splice(U,1):q===".."?W++:W>0&&(q===""?(Q.splice(U+1,W),W=0):(Q.splice(U,2),W--));return C=Q.join("/"),C===""&&(C=A?"/":"."),$?($.path=C,r($)):C}n.normalize=a;function o(w,C){w===""&&(w="."),C===""&&(C=".");var $=s(C),A=s(w);if(A&&(w=A.path||"/"),$&&!$.scheme)return A&&($.scheme=A.scheme),r($);if($||C.match(i))return C;if(A&&!A.host&&!A.path)return A.host=C,r(A);var Q=C.charAt(0)==="/"?C:a(w.replace(/\/+$/,"")+"/"+C);return A?(A.path=Q,r(A)):Q}n.join=o,n.isAbsolute=function(w){return w.charAt(0)==="/"||t.test(w)};function l(w,C){w===""&&(w="."),w=w.replace(/\/$/,"");for(var $=0;C.indexOf(w+"/")!==0;){var A=w.lastIndexOf("/");if(A<0||(w=w.slice(0,A),w.match(/^([^\/]+:\/)?\/*$/)))return C;++$}return Array($+1).join("../")+C.substr(w.length+1)}n.relative=l;var c=(function(){var w=Object.create(null);return!("__proto__"in w)})();function u(w){return w}function h(w){return f(w)?"$"+w:w}n.toSetString=c?u:h;function d(w){return f(w)?w.slice(1):w}n.fromSetString=c?u:d;function f(w){if(!w)return!1;var C=w.length;if(C<9||w.charCodeAt(C-1)!==95||w.charCodeAt(C-2)!==95||w.charCodeAt(C-3)!==111||w.charCodeAt(C-4)!==116||w.charCodeAt(C-5)!==111||w.charCodeAt(C-6)!==114||w.charCodeAt(C-7)!==112||w.charCodeAt(C-8)!==95||w.charCodeAt(C-9)!==95)return!1;for(var $=C-10;$>=0;$--)if(w.charCodeAt($)!==36)return!1;return!0}function m(w,C,$){var A=y(w.source,C.source);return A!==0||(A=w.originalLine-C.originalLine,A!==0)||(A=w.originalColumn-C.originalColumn,A!==0||$)||(A=w.generatedColumn-C.generatedColumn,A!==0)||(A=w.generatedLine-C.generatedLine,A!==0)?A:y(w.name,C.name)}n.compareByOriginalPositions=m;function g(w,C,$){var A=w.generatedLine-C.generatedLine;return A!==0||(A=w.generatedColumn-C.generatedColumn,A!==0||$)||(A=y(w.source,C.source),A!==0)||(A=w.originalLine-C.originalLine,A!==0)||(A=w.originalColumn-C.originalColumn,A!==0)?A:y(w.name,C.name)}n.compareByGeneratedPositionsDeflated=g;function y(w,C){return w===C?0:w===null?1:C===null?-1:w>C?1:-1}function b(w,C){var $=w.generatedLine-C.generatedLine;return $!==0||($=w.generatedColumn-C.generatedColumn,$!==0)||($=y(w.source,C.source),$!==0)||($=w.originalLine-C.originalLine,$!==0)||($=w.originalColumn-C.originalColumn,$!==0)?$:y(w.name,C.name)}n.compareByGeneratedPositionsInflated=b;function P(w){return JSON.parse(w.replace(/^\)]}'[^\n]*\n/,""))}n.parseSourceMapInput=P;function k(w,C,$){if(C=C||"",w&&(w[w.length-1]!=="/"&&C[0]!=="/"&&(w+="/"),C=w+C),$){var A=s($);if(!A)throw new Error("sourceMapURL could not be parsed");if(A.path){var Q=A.path.lastIndexOf("/");Q>=0&&(A.path=A.path.substring(0,Q+1))}C=o(r(A),C)}return a(C)}n.computeSourceURL=k})(sc)),sc}var rc={},Bm;function Xy(){if(Bm)return rc;Bm=1;var n=no(),e=Object.prototype.hasOwnProperty,t=typeof Map<"u";function i(){this._array=[],this._set=t?new Map:Object.create(null)}return i.fromArray=function(r,a){for(var o=new i,l=0,c=r.length;l<c;l++)o.add(r[l],a);return o},i.prototype.size=function(){return t?this._set.size:Object.getOwnPropertyNames(this._set).length},i.prototype.add=function(r,a){var o=t?r:n.toSetString(r),l=t?this.has(r):e.call(this._set,o),c=this._array.length;(!l||a)&&this._array.push(r),l||(t?this._set.set(r,c):this._set[o]=c)},i.prototype.has=function(r){if(t)return this._set.has(r);var a=n.toSetString(r);return e.call(this._set,a)},i.prototype.indexOf=function(r){if(t){var a=this._set.get(r);if(a>=0)return a}else{var o=n.toSetString(r);if(e.call(this._set,o))return this._set[o]}throw new Error('"'+r+'" is not in the set.')},i.prototype.at=function(r){if(r>=0&&r<this._array.length)return this._array[r];throw new Error("No element indexed by "+r)},i.prototype.toArray=function(){return this._array.slice()},rc.ArraySet=i,rc}var ac={},Nm;function tM(){if(Nm)return ac;Nm=1;var n=no();function e(i,s){var r=i.generatedLine,a=s.generatedLine,o=i.generatedColumn,l=s.generatedColumn;return a>r||a==r&&l>=o||n.compareByGeneratedPositionsInflated(i,s)<=0}function t(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}return t.prototype.unsortedForEach=function(s,r){this._array.forEach(s,r)},t.prototype.add=function(s){e(this._last,s)?(this._last=s,this._array.push(s)):(this._sorted=!1,this._array.push(s))},t.prototype.toArray=function(){return this._sorted||(this._array.sort(n.compareByGeneratedPositionsInflated),this._sorted=!0),this._array},ac.MappingList=t,ac}var Qm;function Uy(){if(Qm)return ic;Qm=1;var n=Wy(),e=no(),t=Xy().ArraySet,i=tM().MappingList;function s(r){r||(r={}),this._file=e.getArg(r,"file",null),this._sourceRoot=e.getArg(r,"sourceRoot",null),this._skipValidation=e.getArg(r,"skipValidation",!1),this._sources=new t,this._names=new t,this._mappings=new i,this._sourcesContents=null}return s.prototype._version=3,s.fromSourceMap=function(a){var o=a.sourceRoot,l=new s({file:a.file,sourceRoot:o});return a.eachMapping(function(c){var u={generated:{line:c.generatedLine,column:c.generatedColumn}};c.source!=null&&(u.source=c.source,o!=null&&(u.source=e.relative(o,u.source)),u.original={line:c.originalLine,column:c.originalColumn},c.name!=null&&(u.name=c.name)),l.addMapping(u)}),a.sources.forEach(function(c){var u=c;o!==null&&(u=e.relative(o,c)),l._sources.has(u)||l._sources.add(u);var h=a.sourceContentFor(c);h!=null&&l.setSourceContent(c,h)}),l},s.prototype.addMapping=function(a){var o=e.getArg(a,"generated"),l=e.getArg(a,"original",null),c=e.getArg(a,"source",null),u=e.getArg(a,"name",null);this._skipValidation||this._validateMapping(o,l,c,u),c!=null&&(c=String(c),this._sources.has(c)||this._sources.add(c)),u!=null&&(u=String(u),this._names.has(u)||this._names.add(u)),this._mappings.add({generatedLine:o.line,generatedColumn:o.column,originalLine:l!=null&&l.line,originalColumn:l!=null&&l.column,source:c,name:u})},s.prototype.setSourceContent=function(a,o){var l=a;this._sourceRoot!=null&&(l=e.relative(this._sourceRoot,l)),o!=null?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[e.toSetString(l)]=o):this._sourcesContents&&(delete this._sourcesContents[e.toSetString(l)],Object.keys(this._sourcesContents).length===0&&(this._sourcesContents=null))},s.prototype.applySourceMap=function(a,o,l){var c=o;if(o==null){if(a.file==null)throw new Error(`SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map's "file" property. Both were omitted.`);c=a.file}var u=this._sourceRoot;u!=null&&(c=e.relative(u,c));var h=new t,d=new t;this._mappings.unsortedForEach(function(f){if(f.source===c&&f.originalLine!=null){var m=a.originalPositionFor({line:f.originalLine,column:f.originalColumn});m.source!=null&&(f.source=m.source,l!=null&&(f.source=e.join(l,f.source)),u!=null&&(f.source=e.relative(u,f.source)),f.originalLine=m.line,f.originalColumn=m.column,m.name!=null&&(f.name=m.name))}var g=f.source;g!=null&&!h.has(g)&&h.add(g);var y=f.name;y!=null&&!d.has(y)&&d.add(y)},this),this._sources=h,this._names=d,a.sources.forEach(function(f){var m=a.sourceContentFor(f);m!=null&&(l!=null&&(f=e.join(l,f)),u!=null&&(f=e.relative(u,f)),this.setSourceContent(f,m))},this)},s.prototype._validateMapping=function(a,o,l,c){if(o&&typeof o.line!="number"&&typeof o.column!="number")throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(!(a&&"line"in a&&"column"in a&&a.line>0&&a.column>=0&&!o&&!l&&!c)){if(a&&"line"in a&&"column"in a&&o&&"line"in o&&"column"in o&&a.line>0&&a.column>=0&&o.line>0&&o.column>=0&&l)return;throw new Error("Invalid mapping: "+JSON.stringify({generated:a,source:l,original:o,name:c}))}},s.prototype._serializeMappings=function(){for(var a=0,o=1,l=0,c=0,u=0,h=0,d="",f,m,g,y,b=this._mappings.toArray(),P=0,k=b.length;P<k;P++){if(m=b[P],f="",m.generatedLine!==o)for(a=0;m.generatedLine!==o;)f+=";",o++;else if(P>0){if(!e.compareByGeneratedPositionsInflated(m,b[P-1]))continue;f+=","}f+=n.encode(m.generatedColumn-a),a=m.generatedColumn,m.source!=null&&(y=this._sources.indexOf(m.source),f+=n.encode(y-h),h=y,f+=n.encode(m.originalLine-1-c),c=m.originalLine-1,f+=n.encode(m.originalColumn-l),l=m.originalColumn,m.name!=null&&(g=this._names.indexOf(m.name),f+=n.encode(g-u),u=g)),d+=f}return d},s.prototype._generateSourcesContent=function(a,o){return a.map(function(l){if(!this._sourcesContents)return null;o!=null&&(l=e.relative(o,l));var c=e.toSetString(l);return Object.prototype.hasOwnProperty.call(this._sourcesContents,c)?this._sourcesContents[c]:null},this)},s.prototype.toJSON=function(){var a={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return this._file!=null&&(a.file=this._file),this._sourceRoot!=null&&(a.sourceRoot=this._sourceRoot),this._sourcesContents&&(a.sourcesContent=this._generateSourcesContent(a.sources,a.sourceRoot)),a},s.prototype.toString=function(){return JSON.stringify(this.toJSON())},ic.SourceMapGenerator=s,ic}var ca={},oc={},Rm;function nM(){return Rm||(Rm=1,(function(n){n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2;function e(t,i,s,r,a,o){var l=Math.floor((i-t)/2)+t,c=a(s,r[l],!0);return c===0?l:c>0?i-l>1?e(l,i,s,r,a,o):o==n.LEAST_UPPER_BOUND?i<r.length?i:-1:l:l-t>1?e(t,l,s,r,a,o):o==n.LEAST_UPPER_BOUND?l:t<0?-1:t}n.search=function(i,s,r,a){if(s.length===0)return-1;var o=e(-1,s.length,i,s,r,a||n.GREATEST_LOWER_BOUND);if(o<0)return-1;for(;o-1>=0&&r(s[o],s[o-1],!0)===0;)--o;return o}})(oc)),oc}var lc={},Lm;function iM(){if(Lm)return lc;Lm=1;function n(i,s,r){var a=i[s];i[s]=i[r],i[r]=a}function e(i,s){return Math.round(i+Math.random()*(s-i))}function t(i,s,r,a){if(r<a){var o=e(r,a),l=r-1;n(i,o,a);for(var c=i[a],u=r;u<a;u++)s(i[u],c)<=0&&(l+=1,n(i,l,u));n(i,l+1,u);var h=l+1;t(i,s,r,h-1),t(i,s,h+1,a)}}return lc.quickSort=function(i,s){t(i,s,0,i.length-1)},lc}var Im;function sM(){if(Im)return ca;Im=1;var n=no(),e=nM(),t=Xy().ArraySet,i=Wy(),s=iM().quickSort;function r(c,u){var h=c;return typeof c=="string"&&(h=n.parseSourceMapInput(c)),h.sections!=null?new l(h,u):new a(h,u)}r.fromSourceMap=function(c,u){return a.fromSourceMap(c,u)},r.prototype._version=3,r.prototype.__generatedMappings=null,Object.defineProperty(r.prototype,"_generatedMappings",{configurable:!0,enumerable:!0,get:function(){return this.__generatedMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__generatedMappings}}),r.prototype.__originalMappings=null,Object.defineProperty(r.prototype,"_originalMappings",{configurable:!0,enumerable:!0,get:function(){return this.__originalMappings||this._parseMappings(this._mappings,this.sourceRoot),this.__originalMappings}}),r.prototype._charIsMappingSeparator=function(u,h){var d=u.charAt(h);return d===";"||d===","},r.prototype._parseMappings=function(u,h){throw new Error("Subclasses must implement _parseMappings")},r.GENERATED_ORDER=1,r.ORIGINAL_ORDER=2,r.GREATEST_LOWER_BOUND=1,r.LEAST_UPPER_BOUND=2,r.prototype.eachMapping=function(u,h,d){var f=h||null,m=d||r.GENERATED_ORDER,g;switch(m){case r.GENERATED_ORDER:g=this._generatedMappings;break;case r.ORIGINAL_ORDER:g=this._originalMappings;break;default:throw new Error("Unknown order of iteration.")}var y=this.sourceRoot;g.map(function(b){var P=b.source===null?null:this._sources.at(b.source);return P=n.computeSourceURL(y,P,this._sourceMapURL),{source:P,generatedLine:b.generatedLine,generatedColumn:b.generatedColumn,originalLine:b.originalLine,originalColumn:b.originalColumn,name:b.name===null?null:this._names.at(b.name)}},this).forEach(u,f)},r.prototype.allGeneratedPositionsFor=function(u){var h=n.getArg(u,"line"),d={source:n.getArg(u,"source"),originalLine:h,originalColumn:n.getArg(u,"column",0)};if(d.source=this._findSourceIndex(d.source),d.source<0)return[];var f=[],m=this._findMapping(d,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,e.LEAST_UPPER_BOUND);if(m>=0){var g=this._originalMappings[m];if(u.column===void 0)for(var y=g.originalLine;g&&g.originalLine===y;)f.push({line:n.getArg(g,"generatedLine",null),column:n.getArg(g,"generatedColumn",null),lastColumn:n.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++m];else for(var b=g.originalColumn;g&&g.originalLine===h&&g.originalColumn==b;)f.push({line:n.getArg(g,"generatedLine",null),column:n.getArg(g,"generatedColumn",null),lastColumn:n.getArg(g,"lastGeneratedColumn",null)}),g=this._originalMappings[++m]}return f},ca.SourceMapConsumer=r;function a(c,u){var h=c;typeof c=="string"&&(h=n.parseSourceMapInput(c));var d=n.getArg(h,"version"),f=n.getArg(h,"sources"),m=n.getArg(h,"names",[]),g=n.getArg(h,"sourceRoot",null),y=n.getArg(h,"sourcesContent",null),b=n.getArg(h,"mappings"),P=n.getArg(h,"file",null);if(d!=this._version)throw new Error("Unsupported version: "+d);g&&(g=n.normalize(g)),f=f.map(String).map(n.normalize).map(function(k){return g&&n.isAbsolute(g)&&n.isAbsolute(k)?n.relative(g,k):k}),this._names=t.fromArray(m.map(String),!0),this._sources=t.fromArray(f,!0),this._absoluteSources=this._sources.toArray().map(function(k){return n.computeSourceURL(g,k,u)}),this.sourceRoot=g,this.sourcesContent=y,this._mappings=b,this._sourceMapURL=u,this.file=P}a.prototype=Object.create(r.prototype),a.prototype.consumer=r,a.prototype._findSourceIndex=function(c){var u=c;if(this.sourceRoot!=null&&(u=n.relative(this.sourceRoot,u)),this._sources.has(u))return this._sources.indexOf(u);var h;for(h=0;h<this._absoluteSources.length;++h)if(this._absoluteSources[h]==c)return h;return-1},a.fromSourceMap=function(u,h){var d=Object.create(a.prototype),f=d._names=t.fromArray(u._names.toArray(),!0),m=d._sources=t.fromArray(u._sources.toArray(),!0);d.sourceRoot=u._sourceRoot,d.sourcesContent=u._generateSourcesContent(d._sources.toArray(),d.sourceRoot),d.file=u._file,d._sourceMapURL=h,d._absoluteSources=d._sources.toArray().map(function($){return n.computeSourceURL(d.sourceRoot,$,h)});for(var g=u._mappings.toArray().slice(),y=d.__generatedMappings=[],b=d.__originalMappings=[],P=0,k=g.length;P<k;P++){var w=g[P],C=new o;C.generatedLine=w.generatedLine,C.generatedColumn=w.generatedColumn,w.source&&(C.source=m.indexOf(w.source),C.originalLine=w.originalLine,C.originalColumn=w.originalColumn,w.name&&(C.name=f.indexOf(w.name)),b.push(C)),y.push(C)}return s(d.__originalMappings,n.compareByOriginalPositions),d},a.prototype._version=3,Object.defineProperty(a.prototype,"sources",{get:function(){return this._absoluteSources.slice()}});function o(){this.generatedLine=0,this.generatedColumn=0,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}a.prototype._parseMappings=function(u,h){for(var d=1,f=0,m=0,g=0,y=0,b=0,P=u.length,k=0,w={},C={},$=[],A=[],Q,q,W,U,Z;k<P;)if(u.charAt(k)===";")d++,k++,f=0;else if(u.charAt(k)===",")k++;else{for(Q=new o,Q.generatedLine=d,U=k;U<P&&!this._charIsMappingSeparator(u,U);U++);if(q=u.slice(k,U),W=w[q],W)k+=q.length;else{for(W=[];k<U;)i.decode(u,k,C),Z=C.value,k=C.rest,W.push(Z);if(W.length===2)throw new Error("Found a source, but no line and column");if(W.length===3)throw new Error("Found a source and line, but no column");w[q]=W}Q.generatedColumn=f+W[0],f=Q.generatedColumn,W.length>1&&(Q.source=y+W[1],y+=W[1],Q.originalLine=m+W[2],m=Q.originalLine,Q.originalLine+=1,Q.originalColumn=g+W[3],g=Q.originalColumn,W.length>4&&(Q.name=b+W[4],b+=W[4])),A.push(Q),typeof Q.originalLine=="number"&&$.push(Q)}s(A,n.compareByGeneratedPositionsDeflated),this.__generatedMappings=A,s($,n.compareByOriginalPositions),this.__originalMappings=$},a.prototype._findMapping=function(u,h,d,f,m,g){if(u[d]<=0)throw new TypeError("Line must be greater than or equal to 1, got "+u[d]);if(u[f]<0)throw new TypeError("Column must be greater than or equal to 0, got "+u[f]);return e.search(u,h,m,g)},a.prototype.computeColumnSpans=function(){for(var u=0;u<this._generatedMappings.length;++u){var h=this._generatedMappings[u];if(u+1<this._generatedMappings.length){var d=this._generatedMappings[u+1];if(h.generatedLine===d.generatedLine){h.lastGeneratedColumn=d.generatedColumn-1;continue}}h.lastGeneratedColumn=1/0}},a.prototype.originalPositionFor=function(u){var h={generatedLine:n.getArg(u,"line"),generatedColumn:n.getArg(u,"column")},d=this._findMapping(h,this._generatedMappings,"generatedLine","generatedColumn",n.compareByGeneratedPositionsDeflated,n.getArg(u,"bias",r.GREATEST_LOWER_BOUND));if(d>=0){var f=this._generatedMappings[d];if(f.generatedLine===h.generatedLine){var m=n.getArg(f,"source",null);m!==null&&(m=this._sources.at(m),m=n.computeSourceURL(this.sourceRoot,m,this._sourceMapURL));var g=n.getArg(f,"name",null);return g!==null&&(g=this._names.at(g)),{source:m,line:n.getArg(f,"originalLine",null),column:n.getArg(f,"originalColumn",null),name:g}}}return{source:null,line:null,column:null,name:null}},a.prototype.hasContentsOfAllSources=function(){return this.sourcesContent?this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(u){return u==null}):!1},a.prototype.sourceContentFor=function(u,h){if(!this.sourcesContent)return null;var d=this._findSourceIndex(u);if(d>=0)return this.sourcesContent[d];var f=u;this.sourceRoot!=null&&(f=n.relative(this.sourceRoot,f));var m;if(this.sourceRoot!=null&&(m=n.urlParse(this.sourceRoot))){var g=f.replace(/^file:\/\//,"");if(m.scheme=="file"&&this._sources.has(g))return this.sourcesContent[this._sources.indexOf(g)];if((!m.path||m.path=="/")&&this._sources.has("/"+f))return this.sourcesContent[this._sources.indexOf("/"+f)]}if(h)return null;throw new Error('"'+f+'" is not in the SourceMap.')},a.prototype.generatedPositionFor=function(u){var h=n.getArg(u,"source");if(h=this._findSourceIndex(h),h<0)return{line:null,column:null,lastColumn:null};var d={source:h,originalLine:n.getArg(u,"line"),originalColumn:n.getArg(u,"column")},f=this._findMapping(d,this._originalMappings,"originalLine","originalColumn",n.compareByOriginalPositions,n.getArg(u,"bias",r.GREATEST_LOWER_BOUND));if(f>=0){var m=this._originalMappings[f];if(m.source===d.source)return{line:n.getArg(m,"generatedLine",null),column:n.getArg(m,"generatedColumn",null),lastColumn:n.getArg(m,"lastGeneratedColumn",null)}}return{line:null,column:null,lastColumn:null}},ca.BasicSourceMapConsumer=a;function l(c,u){var h=c;typeof c=="string"&&(h=n.parseSourceMapInput(c));var d=n.getArg(h,"version"),f=n.getArg(h,"sections");if(d!=this._version)throw new Error("Unsupported version: "+d);this._sources=new t,this._names=new t;var m={line:-1,column:0};this._sections=f.map(function(g){if(g.url)throw new Error("Support for url field in sections not implemented.");var y=n.getArg(g,"offset"),b=n.getArg(y,"line"),P=n.getArg(y,"column");if(b<m.line||b===m.line&&P<m.column)throw new Error("Section offsets must be ordered and non-overlapping.");return m=y,{generatedOffset:{generatedLine:b+1,generatedColumn:P+1},consumer:new r(n.getArg(g,"map"),u)}})}return l.prototype=Object.create(r.prototype),l.prototype.constructor=r,l.prototype._version=3,Object.defineProperty(l.prototype,"sources",{get:function(){for(var c=[],u=0;u<this._sections.length;u++)for(var h=0;h<this._sections[u].consumer.sources.length;h++)c.push(this._sections[u].consumer.sources[h]);return c}}),l.prototype.originalPositionFor=function(u){var h={generatedLine:n.getArg(u,"line"),generatedColumn:n.getArg(u,"column")},d=e.search(h,this._sections,function(m,g){var y=m.generatedLine-g.generatedOffset.generatedLine;return y||m.generatedColumn-g.generatedOffset.generatedColumn}),f=this._sections[d];return f?f.consumer.originalPositionFor({line:h.generatedLine-(f.generatedOffset.generatedLine-1),column:h.generatedColumn-(f.generatedOffset.generatedLine===h.generatedLine?f.generatedOffset.generatedColumn-1:0),bias:u.bias}):{source:null,line:null,column:null,name:null}},l.prototype.hasContentsOfAllSources=function(){return this._sections.every(function(u){return u.consumer.hasContentsOfAllSources()})},l.prototype.sourceContentFor=function(u,h){for(var d=0;d<this._sections.length;d++){var f=this._sections[d],m=f.consumer.sourceContentFor(u,!0);if(m)return m}if(h)return null;throw new Error('"'+u+'" is not in the SourceMap.')},l.prototype.generatedPositionFor=function(u){for(var h=0;h<this._sections.length;h++){var d=this._sections[h];if(d.consumer._findSourceIndex(n.getArg(u,"source"))!==-1){var f=d.consumer.generatedPositionFor(u);if(f){var m={line:f.line+(d.generatedOffset.generatedLine-1),column:f.column+(d.generatedOffset.generatedLine===f.line?d.generatedOffset.generatedColumn-1:0)};return m}}}return{line:null,column:null}},l.prototype._parseMappings=function(u,h){this.__generatedMappings=[],this.__originalMappings=[];for(var d=0;d<this._sections.length;d++)for(var f=this._sections[d],m=f.consumer._generatedMappings,g=0;g<m.length;g++){var y=m[g],b=f.consumer._sources.at(y.source);b=n.computeSourceURL(f.consumer.sourceRoot,b,this._sourceMapURL),this._sources.add(b),b=this._sources.indexOf(b);var P=null;y.name&&(P=f.consumer._names.at(y.name),this._names.add(P),P=this._names.indexOf(P));var k={source:b,generatedLine:y.generatedLine+(f.generatedOffset.generatedLine-1),generatedColumn:y.generatedColumn+(f.generatedOffset.generatedLine===y.generatedLine?f.generatedOffset.generatedColumn-1:0),originalLine:y.originalLine,originalColumn:y.originalColumn,name:P};this.__generatedMappings.push(k),typeof k.originalLine=="number"&&this.__originalMappings.push(k)}s(this.__generatedMappings,n.compareByGeneratedPositionsDeflated),s(this.__originalMappings,n.compareByOriginalPositions)},ca.IndexedSourceMapConsumer=l,ca}var uc={},Vm;function rM(){if(Vm)return uc;Vm=1;var n=Uy().SourceMapGenerator,e=no(),t=/(\r?\n)/,i=10,s="$$$isSourceNode$$$";function r(a,o,l,c,u){this.children=[],this.sourceContents={},this.line=a??null,this.column=o??null,this.source=l??null,this.name=u??null,this[s]=!0,c!=null&&this.add(c)}return r.fromStringWithSourceMap=function(o,l,c){var u=new r,h=o.split(t),d=0,f=function(){var P=w(),k=w()||"";return P+k;function w(){return d<h.length?h[d++]:void 0}},m=1,g=0,y=null;return l.eachMapping(function(P){if(y!==null)if(m<P.generatedLine)b(y,f()),m++,g=0;else{var k=h[d]||"",w=k.substr(0,P.generatedColumn-g);h[d]=k.substr(P.generatedColumn-g),g=P.generatedColumn,b(y,w),y=P;return}for(;m<P.generatedLine;)u.add(f()),m++;if(g<P.generatedColumn){var k=h[d]||"";u.add(k.substr(0,P.generatedColumn)),h[d]=k.substr(P.generatedColumn),g=P.generatedColumn}y=P},this),d<h.length&&(y&&b(y,f()),u.add(h.splice(d).join(""))),l.sources.forEach(function(P){var k=l.sourceContentFor(P);k!=null&&(c!=null&&(P=e.join(c,P)),u.setSourceContent(P,k))}),u;function b(P,k){if(P===null||P.source===void 0)u.add(k);else{var w=c?e.join(c,P.source):P.source;u.add(new r(P.originalLine,P.originalColumn,w,k,P.name))}}},r.prototype.add=function(o){if(Array.isArray(o))o.forEach(function(l){this.add(l)},this);else if(o[s]||typeof o=="string")o&&this.children.push(o);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+o);return this},r.prototype.prepend=function(o){if(Array.isArray(o))for(var l=o.length-1;l>=0;l--)this.prepend(o[l]);else if(o[s]||typeof o=="string")this.children.unshift(o);else throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+o);return this},r.prototype.walk=function(o){for(var l,c=0,u=this.children.length;c<u;c++)l=this.children[c],l[s]?l.walk(o):l!==""&&o(l,{source:this.source,line:this.line,column:this.column,name:this.name})},r.prototype.join=function(o){var l,c,u=this.children.length;if(u>0){for(l=[],c=0;c<u-1;c++)l.push(this.children[c]),l.push(o);l.push(this.children[c]),this.children=l}return this},r.prototype.replaceRight=function(o,l){var c=this.children[this.children.length-1];return c[s]?c.replaceRight(o,l):typeof c=="string"?this.children[this.children.length-1]=c.replace(o,l):this.children.push("".replace(o,l)),this},r.prototype.setSourceContent=function(o,l){this.sourceContents[e.toSetString(o)]=l},r.prototype.walkSourceContents=function(o){for(var l=0,c=this.children.length;l<c;l++)this.children[l][s]&&this.children[l].walkSourceContents(o);for(var u=Object.keys(this.sourceContents),l=0,c=u.length;l<c;l++)o(e.fromSetString(u[l]),this.sourceContents[u[l]])},r.prototype.toString=function(){var o="";return this.walk(function(l){o+=l}),o},r.prototype.toStringWithSourceMap=function(o){var l={code:"",line:1,column:0},c=new n(o),u=!1,h=null,d=null,f=null,m=null;return this.walk(function(g,y){l.code+=g,y.source!==null&&y.line!==null&&y.column!==null?((h!==y.source||d!==y.line||f!==y.column||m!==y.name)&&c.addMapping({source:y.source,original:{line:y.line,column:y.column},generated:{line:l.line,column:l.column},name:y.name}),h=y.source,d=y.line,f=y.column,m=y.name,u=!0):u&&(c.addMapping({generated:{line:l.line,column:l.column}}),h=null,u=!1);for(var b=0,P=g.length;b<P;b++)g.charCodeAt(b)===i?(l.line++,l.column=0,b+1===P?(h=null,u=!1):u&&c.addMapping({source:y.source,original:{line:y.line,column:y.column},generated:{line:l.line,column:l.column},name:y.name})):l.column++}),this.walkSourceContents(function(g,y){c.setSourceContent(g,y)}),{code:l.code,map:c}},uc.SourceNode=r,uc}var zm;function aM(){return zm||(zm=1,ua.SourceMapGenerator=Uy().SourceMapGenerator,ua.SourceMapConsumer=sM().SourceMapConsumer,ua.SourceNode=rM().SourceNode),ua}const oM="2.1.0",lM={version:oM};var Zm;function uM(){return Zm||(Zm=1,(function(n){(function(){var e,t,i,s,r,a,o,l,c,u,h,d,f,m,g,y,b,P,k,w,C,$,A,Q,q,W;r=YD(),a=JD(),e=r.Syntax;function U(p){return St.Expression.hasOwnProperty(p.type)}function Z(p){return St.Statement.hasOwnProperty(p.type)}t={Sequence:0,Yield:1,Assignment:1,Conditional:2,ArrowFunction:2,Coalesce:3,LogicalOR:4,LogicalAND:5,BitwiseOR:6,BitwiseXOR:7,BitwiseAND:8,Equality:9,Relational:10,BitwiseSHIFT:11,Additive:12,Multiplicative:13,Exponentiation:14,Await:15,Unary:15,Postfix:16,OptionalChaining:17,Call:18,New:19,TaggedTemplate:20,Member:21,Primary:22},i={"??":t.Coalesce,"||":t.LogicalOR,"&&":t.LogicalAND,"|":t.BitwiseOR,"^":t.BitwiseXOR,"&":t.BitwiseAND,"==":t.Equality,"!=":t.Equality,"===":t.Equality,"!==":t.Equality,is:t.Equality,isnt:t.Equality,"<":t.Relational,">":t.Relational,"<=":t.Relational,">=":t.Relational,in:t.Relational,instanceof:t.Relational,"<<":t.BitwiseSHIFT,">>":t.BitwiseSHIFT,">>>":t.BitwiseSHIFT,"+":t.Additive,"-":t.Additive,"*":t.Multiplicative,"%":t.Multiplicative,"/":t.Multiplicative,"**":t.Exponentiation};var Y=1,ne=2,re=4,ve=8,Ce=16,De=32,Ue=64,Pt=ne|re,yt=Y|ne,ue=Y|ne|re,Je=Y,he=re,Et=Y|re,Ze=Y,me=Y|De,Ye=0,xt=Y|Ce,ai=Y|ve;function Tn(){return{indent:null,base:null,parse:null,comment:!1,format:{indent:{style:"    ",base:0,adjustMultilineComment:!1},newline:`
`,space:" ",json:!1,renumber:!1,hexadecimal:!1,quotes:"single",escapeless:!1,compact:!1,parentheses:!0,semicolons:!0,safeConcatenation:!1,preserveBlankLines:!1},moz:{comprehensionExpressionStartsWithAssignment:!1,starlessGenerator:!1},sourceMap:null,sourceMapRoot:null,sourceMapWithCode:!1,directive:!1,raw:!0,verbatim:null,sourceCode:null}}function Nt(p,S){var v="";for(S|=0;S>0;S>>>=1,p+=p)S&1&&(v+=p);return v}function mn(p){return/[\r\n]/g.test(p)}function ot(p){var S=p.length;return S&&a.code.isLineTerminator(p.charCodeAt(S-1))}function en(p,S){var v;for(v in S)S.hasOwnProperty(v)&&(p[v]=S[v]);return p}function Jn(p,S){var v,x;function F(X){return typeof X=="object"&&X instanceof Object&&!(X instanceof RegExp)}for(v in S)S.hasOwnProperty(v)&&(x=S[v],F(x)?F(p[v])?Jn(p[v],x):p[v]=Jn({},x):p[v]=x);return p}function Qi(p){var S,v,x,F,X;if(p!==p)throw new Error("Numeric literal whose value is NaN");if(p<0||p===0&&1/p<0)throw new Error("Numeric literal whose value is negative");if(p===1/0)return c?"null":u?"1e400":"1e+400";if(S=""+p,!u||S.length<3)return S;for(v=S.indexOf("."),!c&&S.charCodeAt(0)===48&&v===1&&(v=0,S=S.slice(1)),x=S,S=S.replace("e+","e"),F=0,(X=x.indexOf("e"))>0&&(F=+x.slice(X+1),x=x.slice(0,X)),v>=0&&(F-=x.length-v-1,x=+(x.slice(0,v)+x.slice(v+1))+""),X=0;x.charCodeAt(x.length+X-1)===48;)--X;return X!==0&&(F-=X,x=x.slice(0,X)),F!==0&&(x+="e"+F),(x.length<S.length||h&&p>1e12&&Math.floor(p)===p&&(x="0x"+p.toString(16)).length<S.length)&&+x===p&&(S=x),S}function ds(p,S){return(p&-2)===8232?(S?"u":"\\u")+(p===8232?"2028":"2029"):p===10||p===13?(S?"":"\\")+(p===10?"n":"r"):String.fromCharCode(p)}function Ri(p){var S,v,x,F,X,J,ie,be;if(v=p.toString(),p.source){if(S=v.match(/\/([^/]*)$/),!S)return v;for(x=S[1],v="",ie=!1,be=!1,F=0,X=p.source.length;F<X;++F)J=p.source.charCodeAt(F),be?(v+=ds(J,be),be=!1):(ie?J===93&&(ie=!1):J===47?v+="\\":J===91&&(ie=!0),v+=ds(J,be),be=J===92);return"/"+v+"/"+x}return v}function Ps(p,S){var v;return p===8?"\\b":p===12?"\\f":p===9?"\\t":(v=p.toString(16).toUpperCase(),c||p>255?"\\u"+"0000".slice(v.length)+v:p===0&&!a.code.isDecimalDigit(S)?"\\0":p===11?"\\x0B":"\\x"+"00".slice(v.length)+v)}function Li(p){if(p===92)return"\\\\";if(p===10)return"\\n";if(p===13)return"\\r";if(p===8232)return"\\u2028";if(p===8233)return"\\u2029";throw new Error("Incorrectly classified character")}function Ii(p){var S,v,x,F;for(F=d==="double"?'"':"'",S=0,v=p.length;S<v;++S)if(x=p.charCodeAt(S),x===39){F='"';break}else if(x===34){F="'";break}else x===92&&++S;return F+p+F}function oi(p){var S="",v,x,F,X=0,J=0,ie,be;for(v=0,x=p.length;v<x;++v){if(F=p.charCodeAt(v),F===39)++X;else if(F===34)++J;else if(F===47&&c)S+="\\";else if(a.code.isLineTerminator(F)||F===92){S+=Li(F);continue}else if(!a.code.isIdentifierPartES5(F)&&(c&&F<32||!c&&!f&&(F<32||F>126))){S+=Ps(F,p.charCodeAt(v+1));continue}S+=String.fromCharCode(F)}if(ie=!(d==="double"||d==="auto"&&J<X),be=ie?"'":'"',!(ie?X:J))return be+S+be;for(p=S,S=be,v=0,x=p.length;v<x;++v)F=p.charCodeAt(v),(F===39&&ie||F===34&&!ie)&&(S+="\\"),S+=String.fromCharCode(F);return S+be}function In(p){var S,v,x,F="";for(S=0,v=p.length;S<v;++S)x=p[S],F+=Array.isArray(x)?In(x):x;return F}function Se(p,S){if(!$)return Array.isArray(p)?In(p):p;if(S==null){if(p instanceof s)return p;S={}}return S.loc==null?new s(null,null,$,p,S.name||null):new s(S.loc.start.line,S.loc.start.column,$===!0?S.loc.source||null:$,p,S.name||null)}function Zt(){return g||" "}function Ne(p,S){var v,x,F,X;return v=Se(p).toString(),v.length===0?[S]:(x=Se(S).toString(),x.length===0?[p]:(F=v.charCodeAt(v.length-1),X=x.charCodeAt(0),(F===43||F===45)&&F===X||a.code.isIdentifierPartES5(F)&&a.code.isIdentifierPartES5(X)||F===47&&X===105?[p,Zt(),S]:a.code.isWhiteSpace(F)||a.code.isLineTerminator(F)||a.code.isWhiteSpace(X)||a.code.isLineTerminator(X)?[p,S]:[p,g,S]))}function bt(p){return[o,p]}function et(p){var S;S=o,o+=l,p(o),o=S}function ei(p){var S;for(S=p.length-1;S>=0&&!a.code.isLineTerminator(p.charCodeAt(S));--S);return p.length-1-S}function xs(p,S){var v,x,F,X,J,ie,be,Ie;for(v=p.split(/\r\n|[\r\n]/),ie=Number.MAX_VALUE,x=1,F=v.length;x<F;++x){for(X=v[x],J=0;J<X.length&&a.code.isWhiteSpace(X.charCodeAt(J));)++J;ie>J&&(ie=J)}for(typeof S<"u"?(be=o,v[1][ie]==="*"&&(S+=" "),o=S):(ie&1&&--ie,be=o),x=1,F=v.length;x<F;++x)Ie=Se(bt(v[x].slice(ie))),v[x]=$?Ie.join(""):Ie;return o=be,v.join(`
`)}function gn(p,S){if(p.type==="Line"){if(ot(p.value))return"//"+p.value;var v="//"+p.value;return Q||(v+=`
`),v}return w.format.indent.adjustMultilineComment&&/[\n\r]/.test(p.value)?xs("/*"+p.value+"*/",S):"/*"+p.value+"*/"}function li(p,S){var v,x,F,X,J,ie,be,Ie,Ct,_n,Fn,Si,wi,zn;if(p.leadingComments&&p.leadingComments.length>0){if(X=S,Q){for(F=p.leadingComments[0],S=[],Ie=F.extendedRange,Ct=F.range,Fn=A.substring(Ie[0],Ct[0]),zn=(Fn.match(/\n/g)||[]).length,zn>0?(S.push(Nt(`
`,zn)),S.push(bt(gn(F)))):(S.push(Fn),S.push(gn(F))),_n=Ct,v=1,x=p.leadingComments.length;v<x;v++)F=p.leadingComments[v],Ct=F.range,Si=A.substring(_n[1],Ct[0]),zn=(Si.match(/\n/g)||[]).length,S.push(Nt(`
`,zn)),S.push(bt(gn(F))),_n=Ct;wi=A.substring(Ct[1],Ie[1]),zn=(wi.match(/\n/g)||[]).length,S.push(Nt(`
`,zn))}else for(F=p.leadingComments[0],S=[],P&&p.type===e.Program&&p.body.length===0&&S.push(`
`),S.push(gn(F)),ot(Se(S).toString())||S.push(`
`),v=1,x=p.leadingComments.length;v<x;++v)F=p.leadingComments[v],be=[gn(F)],ot(Se(be).toString())||be.push(`
`),S.push(bt(be));S.push(bt(X))}if(p.trailingComments)if(Q)F=p.trailingComments[0],Ie=F.extendedRange,Ct=F.range,Fn=A.substring(Ie[0],Ct[0]),zn=(Fn.match(/\n/g)||[]).length,zn>0?(S.push(Nt(`
`,zn)),S.push(bt(gn(F)))):(S.push(Fn),S.push(gn(F)));else for(J=!ot(Se(S).toString()),ie=Nt(" ",ei(Se([o,S,l]).toString())),v=0,x=p.trailingComments.length;v<x;++v)F=p.trailingComments[v],J?(v===0?S=[S,l]:S=[S,ie],S.push(gn(F,ie))):S=[S,bt(gn(F))],v!==x-1&&!ot(Se(S).toString())&&(S=[S,`
`]);return S}function Vn(p,S,v){var x,F=0;for(x=p;x<S;x++)A[x]===`
`&&F++;for(x=1;x<F;x++)v.push(m)}function Mt(p,S,v){return S<v?["(",p,")"]:p}function Vi(p){var S,v,x;for(x=p.split(/\r\n|\n/),S=1,v=x.length;S<v;S++)x[S]=m+o+x[S];return x}function Cs(p,S){var v,x,F;return v=p[w.verbatim],typeof v=="string"?x=Mt(Vi(v),t.Sequence,S):(x=Vi(v.content),F=v.precedence!=null?v.precedence:t.Sequence,x=Mt(x,F,S)),Se(x,p)}function St(){}St.prototype.maybeBlock=function(p,S){var v,x,F=this;return x=!w.comment||!p.leadingComments,p.type===e.BlockStatement&&x?[g,this.generateStatement(p,S)]:p.type===e.EmptyStatement&&x?";":(et(function(){v=[m,bt(F.generateStatement(p,S))]}),v)},St.prototype.maybeBlockSuffix=function(p,S){var v=ot(Se(S).toString());return p.type===e.BlockStatement&&(!w.comment||!p.leadingComments)&&!v?[S,g]:v?[S,o]:[S,m,o]};function mt(p){return Se(p.name,p)}function Ht(p,S){return p.async?"async"+(S?Zt():g):""}function K(p){var S=p.generator&&!w.moz.starlessGenerator;return S?"*"+g:""}function te(p){var S=p.value,v="";return S.async&&(v+=Ht(S,!p.computed)),S.generator&&(v+=K(S)?"*":""),v}St.prototype.generatePattern=function(p,S,v){return p.type===e.Identifier?mt(p):this.generateExpression(p,S,v)},St.prototype.generateFunctionParams=function(p){var S,v,x,F;if(F=!1,p.type===e.ArrowFunctionExpression&&!p.rest&&(!p.defaults||p.defaults.length===0)&&p.params.length===1&&p.params[0].type===e.Identifier)x=[Ht(p,!0),mt(p.params[0])];else{for(x=p.type===e.ArrowFunctionExpression?[Ht(p,!1)]:[],x.push("("),p.defaults&&(F=!0),S=0,v=p.params.length;S<v;++S)F&&p.defaults[S]?x.push(this.generateAssignment(p.params[S],p.defaults[S],"=",t.Assignment,ue)):x.push(this.generatePattern(p.params[S],t.Assignment,ue)),S+1<v&&x.push(","+g);p.rest&&(p.params.length&&x.push(","+g),x.push("..."),x.push(mt(p.rest))),x.push(")")}return x},St.prototype.generateFunctionBody=function(p){var S,v;return S=this.generateFunctionParams(p),p.type===e.ArrowFunctionExpression&&(S.push(g),S.push("=>")),p.expression?(S.push(g),v=this.generateExpression(p.body,t.Assignment,ue),v.toString().charAt(0)==="{"&&(v=["(",v,")"]),S.push(v)):S.push(this.maybeBlock(p.body,ai)),S},St.prototype.generateIterationForStatement=function(p,S,v){var x=["for"+(S.await?Zt()+"await":"")+g+"("],F=this;return et(function(){S.left.type===e.VariableDeclaration?et(function(){x.push(S.left.kind+Zt()),x.push(F.generateStatement(S.left.declarations[0],Ye))}):x.push(F.generateExpression(S.left,t.Call,ue)),x=Ne(x,p),x=[Ne(x,F.generateExpression(S.right,t.Assignment,ue)),")"]}),x.push(this.maybeBlock(S.body,v)),x},St.prototype.generatePropertyKey=function(p,S){var v=[];return S&&v.push("["),v.push(this.generateExpression(p,t.Assignment,ue)),S&&v.push("]"),v},St.prototype.generateAssignment=function(p,S,v,x,F){return t.Assignment<x&&(F|=Y),Mt([this.generateExpression(p,t.Call,F),g+v+g,this.generateExpression(S,t.Assignment,F)],t.Assignment,x)},St.prototype.semicolon=function(p){return!b&&p&De?"":";"},St.Statement={BlockStatement:function(p,S){var v,x,F=["{",m],X=this;return et(function(){p.body.length===0&&Q&&(v=p.range,v[1]-v[0]>2&&(x=A.substring(v[0]+1,v[1]-1),x[0]===`
`&&(F=["{"]),F.push(x)));var J,ie,be,Ie;for(Ie=Ze,S&ve&&(Ie|=Ce),J=0,ie=p.body.length;J<ie;++J)Q&&(J===0&&(p.body[0].leadingComments&&(v=p.body[0].leadingComments[0].extendedRange,x=A.substring(v[0],v[1]),x[0]===`
`&&(F=["{"])),p.body[0].leadingComments||Vn(p.range[0],p.body[0].range[0],F)),J>0&&!p.body[J-1].trailingComments&&!p.body[J].leadingComments&&Vn(p.body[J-1].range[1],p.body[J].range[0],F)),J===ie-1&&(Ie|=De),p.body[J].leadingComments&&Q?be=X.generateStatement(p.body[J],Ie):be=bt(X.generateStatement(p.body[J],Ie)),F.push(be),ot(Se(be).toString())||Q&&J<ie-1&&p.body[J+1].leadingComments||F.push(m),Q&&J===ie-1&&(p.body[J].trailingComments||Vn(p.body[J].range[1],p.range[1],F))}),F.push(bt("}")),F},BreakStatement:function(p,S){return p.label?"break "+p.label.name+this.semicolon(S):"break"+this.semicolon(S)},ContinueStatement:function(p,S){return p.label?"continue "+p.label.name+this.semicolon(S):"continue"+this.semicolon(S)},ClassBody:function(p,S){var v=["{",m],x=this;return et(function(F){var X,J;for(X=0,J=p.body.length;X<J;++X)v.push(F),v.push(x.generateExpression(p.body[X],t.Sequence,ue)),X+1<J&&v.push(m)}),ot(Se(v).toString())||v.push(m),v.push(o),v.push("}"),v},ClassDeclaration:function(p,S){var v,x;return v=["class"],p.id&&(v=Ne(v,this.generateExpression(p.id,t.Sequence,ue))),p.superClass&&(x=Ne("extends",this.generateExpression(p.superClass,t.Unary,ue)),v=Ne(v,x)),v.push(g),v.push(this.generateStatement(p.body,me)),v},DirectiveStatement:function(p,S){return w.raw&&p.raw?p.raw+this.semicolon(S):Ii(p.directive)+this.semicolon(S)},DoWhileStatement:function(p,S){var v=Ne("do",this.maybeBlock(p.body,Ze));return v=this.maybeBlockSuffix(p.body,v),Ne(v,["while"+g+"(",this.generateExpression(p.test,t.Sequence,ue),")"+this.semicolon(S)])},CatchClause:function(p,S){var v,x=this;return et(function(){var F;p.param?(v=["catch"+g+"(",x.generateExpression(p.param,t.Sequence,ue),")"],p.guard&&(F=x.generateExpression(p.guard,t.Sequence,ue),v.splice(2,0," if ",F))):v=["catch"]}),v.push(this.maybeBlock(p.body,Ze)),v},DebuggerStatement:function(p,S){return"debugger"+this.semicolon(S)},EmptyStatement:function(p,S){return";"},ExportDefaultDeclaration:function(p,S){var v=["export"],x;return x=S&De?me:Ze,v=Ne(v,"default"),Z(p.declaration)?v=Ne(v,this.generateStatement(p.declaration,x)):v=Ne(v,this.generateExpression(p.declaration,t.Assignment,ue)+this.semicolon(S)),v},ExportNamedDeclaration:function(p,S){var v=["export"],x,F=this;return x=S&De?me:Ze,p.declaration?Ne(v,this.generateStatement(p.declaration,x)):(p.specifiers&&(p.specifiers.length===0?v=Ne(v,"{"+g+"}"):p.specifiers[0].type===e.ExportBatchSpecifier?v=Ne(v,this.generateExpression(p.specifiers[0],t.Sequence,ue)):(v=Ne(v,"{"),et(function(X){var J,ie;for(v.push(m),J=0,ie=p.specifiers.length;J<ie;++J)v.push(X),v.push(F.generateExpression(p.specifiers[J],t.Sequence,ue)),J+1<ie&&v.push(","+m)}),ot(Se(v).toString())||v.push(m),v.push(o+"}")),p.source?v=Ne(v,["from"+g,this.generateExpression(p.source,t.Sequence,ue),this.semicolon(S)]):v.push(this.semicolon(S))),v)},ExportAllDeclaration:function(p,S){return["export"+g,"*"+g,"from"+g,this.generateExpression(p.source,t.Sequence,ue),this.semicolon(S)]},ExpressionStatement:function(p,S){var v,x;function F(ie){var be;return ie.slice(0,5)!=="class"?!1:(be=ie.charCodeAt(5),be===123||a.code.isWhiteSpace(be)||a.code.isLineTerminator(be))}function X(ie){var be;return ie.slice(0,8)!=="function"?!1:(be=ie.charCodeAt(8),be===40||a.code.isWhiteSpace(be)||be===42||a.code.isLineTerminator(be))}function J(ie){var be,Ie,Ct;if(ie.slice(0,5)!=="async"||!a.code.isWhiteSpace(ie.charCodeAt(5)))return!1;for(Ie=6,Ct=ie.length;Ie<Ct&&a.code.isWhiteSpace(ie.charCodeAt(Ie));++Ie);return Ie===Ct||ie.slice(Ie,Ie+8)!=="function"?!1:(be=ie.charCodeAt(Ie+8),be===40||a.code.isWhiteSpace(be)||be===42||a.code.isLineTerminator(be))}return v=[this.generateExpression(p.expression,t.Sequence,ue)],x=Se(v).toString(),x.charCodeAt(0)===123||F(x)||X(x)||J(x)||k&&S&Ce&&p.expression.type===e.Literal&&typeof p.expression.value=="string"?v=["(",v,")"+this.semicolon(S)]:v.push(this.semicolon(S)),v},ImportDeclaration:function(p,S){var v,x,F=this;return p.specifiers.length===0?["import",g,this.generateExpression(p.source,t.Sequence,ue),this.semicolon(S)]:(v=["import"],x=0,p.specifiers[x].type===e.ImportDefaultSpecifier&&(v=Ne(v,[this.generateExpression(p.specifiers[x],t.Sequence,ue)]),++x),p.specifiers[x]&&(x!==0&&v.push(","),p.specifiers[x].type===e.ImportNamespaceSpecifier?v=Ne(v,[g,this.generateExpression(p.specifiers[x],t.Sequence,ue)]):(v.push(g+"{"),p.specifiers.length-x===1?(v.push(g),v.push(this.generateExpression(p.specifiers[x],t.Sequence,ue)),v.push(g+"}"+g)):(et(function(X){var J,ie;for(v.push(m),J=x,ie=p.specifiers.length;J<ie;++J)v.push(X),v.push(F.generateExpression(p.specifiers[J],t.Sequence,ue)),J+1<ie&&v.push(","+m)}),ot(Se(v).toString())||v.push(m),v.push(o+"}"+g)))),v=Ne(v,["from"+g,this.generateExpression(p.source,t.Sequence,ue),this.semicolon(S)]),v)},VariableDeclarator:function(p,S){var v=S&Y?ue:Pt;return p.init?[this.generateExpression(p.id,t.Assignment,v),g,"=",g,this.generateExpression(p.init,t.Assignment,v)]:this.generatePattern(p.id,t.Assignment,v)},VariableDeclaration:function(p,S){var v,x,F,X,J,ie=this;v=[p.kind],J=S&Y?Ze:Ye;function be(){for(X=p.declarations[0],w.comment&&X.leadingComments?(v.push(`
`),v.push(bt(ie.generateStatement(X,J)))):(v.push(Zt()),v.push(ie.generateStatement(X,J))),x=1,F=p.declarations.length;x<F;++x)X=p.declarations[x],w.comment&&X.leadingComments?(v.push(","+m),v.push(bt(ie.generateStatement(X,J)))):(v.push(","+g),v.push(ie.generateStatement(X,J)))}return p.declarations.length>1?et(be):be(),v.push(this.semicolon(S)),v},ThrowStatement:function(p,S){return[Ne("throw",this.generateExpression(p.argument,t.Sequence,ue)),this.semicolon(S)]},TryStatement:function(p,S){var v,x,F,X;if(v=["try",this.maybeBlock(p.block,Ze)],v=this.maybeBlockSuffix(p.block,v),p.handlers)for(x=0,F=p.handlers.length;x<F;++x)v=Ne(v,this.generateStatement(p.handlers[x],Ze)),(p.finalizer||x+1!==F)&&(v=this.maybeBlockSuffix(p.handlers[x].body,v));else{for(X=p.guardedHandlers||[],x=0,F=X.length;x<F;++x)v=Ne(v,this.generateStatement(X[x],Ze)),(p.finalizer||x+1!==F)&&(v=this.maybeBlockSuffix(X[x].body,v));if(p.handler)if(Array.isArray(p.handler))for(x=0,F=p.handler.length;x<F;++x)v=Ne(v,this.generateStatement(p.handler[x],Ze)),(p.finalizer||x+1!==F)&&(v=this.maybeBlockSuffix(p.handler[x].body,v));else v=Ne(v,this.generateStatement(p.handler,Ze)),p.finalizer&&(v=this.maybeBlockSuffix(p.handler.body,v))}return p.finalizer&&(v=Ne(v,["finally",this.maybeBlock(p.finalizer,Ze)])),v},SwitchStatement:function(p,S){var v,x,F,X,J,ie=this;if(et(function(){v=["switch"+g+"(",ie.generateExpression(p.discriminant,t.Sequence,ue),")"+g+"{"+m]}),p.cases)for(J=Ze,F=0,X=p.cases.length;F<X;++F)F===X-1&&(J|=De),x=bt(this.generateStatement(p.cases[F],J)),v.push(x),ot(Se(x).toString())||v.push(m);return v.push(bt("}")),v},SwitchCase:function(p,S){var v,x,F,X,J,ie=this;return et(function(){for(p.test?v=[Ne("case",ie.generateExpression(p.test,t.Sequence,ue)),":"]:v=["default:"],F=0,X=p.consequent.length,X&&p.consequent[0].type===e.BlockStatement&&(x=ie.maybeBlock(p.consequent[0],Ze),v.push(x),F=1),F!==X&&!ot(Se(v).toString())&&v.push(m),J=Ze;F<X;++F)F===X-1&&S&De&&(J|=De),x=bt(ie.generateStatement(p.consequent[F],J)),v.push(x),F+1!==X&&!ot(Se(x).toString())&&v.push(m)}),v},IfStatement:function(p,S){var v,x,F,X=this;return et(function(){v=["if"+g+"(",X.generateExpression(p.test,t.Sequence,ue),")"]}),F=S&De,x=Ze,F&&(x|=De),p.alternate?(v.push(this.maybeBlock(p.consequent,Ze)),v=this.maybeBlockSuffix(p.consequent,v),p.alternate.type===e.IfStatement?v=Ne(v,["else ",this.generateStatement(p.alternate,x)]):v=Ne(v,Ne("else",this.maybeBlock(p.alternate,x)))):v.push(this.maybeBlock(p.consequent,x)),v},ForStatement:function(p,S){var v,x=this;return et(function(){v=["for"+g+"("],p.init?p.init.type===e.VariableDeclaration?v.push(x.generateStatement(p.init,Ye)):(v.push(x.generateExpression(p.init,t.Sequence,Pt)),v.push(";")):v.push(";"),p.test&&(v.push(g),v.push(x.generateExpression(p.test,t.Sequence,ue))),v.push(";"),p.update&&(v.push(g),v.push(x.generateExpression(p.update,t.Sequence,ue))),v.push(")")}),v.push(this.maybeBlock(p.body,S&De?me:Ze)),v},ForInStatement:function(p,S){return this.generateIterationForStatement("in",p,S&De?me:Ze)},ForOfStatement:function(p,S){return this.generateIterationForStatement("of",p,S&De?me:Ze)},LabeledStatement:function(p,S){return[p.label.name+":",this.maybeBlock(p.body,S&De?me:Ze)]},Program:function(p,S){var v,x,F,X,J;for(X=p.body.length,v=[P&&X>0?`
`:""],J=xt,F=0;F<X;++F)!P&&F===X-1&&(J|=De),Q&&(F===0&&(p.body[0].leadingComments||Vn(p.range[0],p.body[F].range[0],v)),F>0&&!p.body[F-1].trailingComments&&!p.body[F].leadingComments&&Vn(p.body[F-1].range[1],p.body[F].range[0],v)),x=bt(this.generateStatement(p.body[F],J)),v.push(x),F+1<X&&!ot(Se(x).toString())&&(Q&&p.body[F+1].leadingComments||v.push(m)),Q&&F===X-1&&(p.body[F].trailingComments||Vn(p.body[F].range[1],p.range[1],v));return v},FunctionDeclaration:function(p,S){return[Ht(p,!0),"function",K(p)||Zt(),p.id?mt(p.id):"",this.generateFunctionBody(p)]},ReturnStatement:function(p,S){return p.argument?[Ne("return",this.generateExpression(p.argument,t.Sequence,ue)),this.semicolon(S)]:["return"+this.semicolon(S)]},WhileStatement:function(p,S){var v,x=this;return et(function(){v=["while"+g+"(",x.generateExpression(p.test,t.Sequence,ue),")"]}),v.push(this.maybeBlock(p.body,S&De?me:Ze)),v},WithStatement:function(p,S){var v,x=this;return et(function(){v=["with"+g+"(",x.generateExpression(p.object,t.Sequence,ue),")"]}),v.push(this.maybeBlock(p.body,S&De?me:Ze)),v}},en(St.prototype,St.Statement),St.Expression={SequenceExpression:function(p,S,v){var x,F,X;for(t.Sequence<S&&(v|=Y),x=[],F=0,X=p.expressions.length;F<X;++F)x.push(this.generateExpression(p.expressions[F],t.Assignment,v)),F+1<X&&x.push(","+g);return Mt(x,t.Sequence,S)},AssignmentExpression:function(p,S,v){return this.generateAssignment(p.left,p.right,p.operator,S,v)},ArrowFunctionExpression:function(p,S,v){return Mt(this.generateFunctionBody(p),t.ArrowFunction,S)},ConditionalExpression:function(p,S,v){return t.Conditional<S&&(v|=Y),Mt([this.generateExpression(p.test,t.Coalesce,v),g+"?"+g,this.generateExpression(p.consequent,t.Assignment,v),g+":"+g,this.generateExpression(p.alternate,t.Assignment,v)],t.Conditional,S)},LogicalExpression:function(p,S,v){return p.operator==="??"&&(v|=Ue),this.BinaryExpression(p,S,v)},BinaryExpression:function(p,S,v){var x,F,X,J,ie,be;return J=i[p.operator],F=p.operator==="**"?t.Postfix:J,X=p.operator==="**"?J:J+1,J<S&&(v|=Y),ie=this.generateExpression(p.left,F,v),be=ie.toString(),be.charCodeAt(be.length-1)===47&&a.code.isIdentifierPartES5(p.operator.charCodeAt(0))?x=[ie,Zt(),p.operator]:x=Ne(ie,p.operator),ie=this.generateExpression(p.right,X,v),p.operator==="/"&&ie.toString().charAt(0)==="/"||p.operator.slice(-1)==="<"&&ie.toString().slice(0,3)==="!--"?(x.push(Zt()),x.push(ie)):x=Ne(x,ie),p.operator==="in"&&!(v&Y)?["(",x,")"]:(p.operator==="||"||p.operator==="&&")&&v&Ue?["(",x,")"]:Mt(x,J,S)},CallExpression:function(p,S,v){var x,F,X;for(x=[this.generateExpression(p.callee,t.Call,yt)],p.optional&&x.push("?."),x.push("("),F=0,X=p.arguments.length;F<X;++F)x.push(this.generateExpression(p.arguments[F],t.Assignment,ue)),F+1<X&&x.push(","+g);return x.push(")"),v&ne?Mt(x,t.Call,S):["(",x,")"]},ChainExpression:function(p,S,v){t.OptionalChaining<S&&(v|=ne);var x=this.generateExpression(p.expression,t.OptionalChaining,v);return Mt(x,t.OptionalChaining,S)},NewExpression:function(p,S,v){var x,F,X,J,ie;if(F=p.arguments.length,ie=v&re&&!y&&F===0?Et:Je,x=Ne("new",this.generateExpression(p.callee,t.New,ie)),!(v&re)||y||F>0){for(x.push("("),X=0,J=F;X<J;++X)x.push(this.generateExpression(p.arguments[X],t.Assignment,ue)),X+1<J&&x.push(","+g);x.push(")")}return Mt(x,t.New,S)},MemberExpression:function(p,S,v){var x,F;return x=[this.generateExpression(p.object,t.Call,v&ne?yt:Je)],p.computed?(p.optional&&x.push("?."),x.push("["),x.push(this.generateExpression(p.property,t.Sequence,v&ne?ue:Et)),x.push("]")):(!p.optional&&p.object.type===e.Literal&&typeof p.object.value=="number"&&(F=Se(x).toString(),F.indexOf(".")<0&&!/[eExX]/.test(F)&&a.code.isDecimalDigit(F.charCodeAt(F.length-1))&&!(F.length>=2&&F.charCodeAt(0)===48)&&x.push(" ")),x.push(p.optional?"?.":"."),x.push(mt(p.property))),Mt(x,t.Member,S)},MetaProperty:function(p,S,v){var x;return x=[],x.push(typeof p.meta=="string"?p.meta:mt(p.meta)),x.push("."),x.push(typeof p.property=="string"?p.property:mt(p.property)),Mt(x,t.Member,S)},UnaryExpression:function(p,S,v){var x,F,X,J,ie;return F=this.generateExpression(p.argument,t.Unary,ue),g===""?x=Ne(p.operator,F):(x=[p.operator],p.operator.length>2?x=Ne(x,F):(J=Se(x).toString(),ie=J.charCodeAt(J.length-1),X=F.toString().charCodeAt(0),((ie===43||ie===45)&&ie===X||a.code.isIdentifierPartES5(ie)&&a.code.isIdentifierPartES5(X))&&x.push(Zt()),x.push(F))),Mt(x,t.Unary,S)},YieldExpression:function(p,S,v){var x;return p.delegate?x="yield*":x="yield",p.argument&&(x=Ne(x,this.generateExpression(p.argument,t.Yield,ue))),Mt(x,t.Yield,S)},AwaitExpression:function(p,S,v){var x=Ne(p.all?"await*":"await",this.generateExpression(p.argument,t.Await,ue));return Mt(x,t.Await,S)},UpdateExpression:function(p,S,v){return p.prefix?Mt([p.operator,this.generateExpression(p.argument,t.Unary,ue)],t.Unary,S):Mt([this.generateExpression(p.argument,t.Postfix,ue),p.operator],t.Postfix,S)},FunctionExpression:function(p,S,v){var x=[Ht(p,!0),"function"];return p.id?(x.push(K(p)||Zt()),x.push(mt(p.id))):x.push(K(p)||g),x.push(this.generateFunctionBody(p)),x},ArrayPattern:function(p,S,v){return this.ArrayExpression(p,S,v,!0)},ArrayExpression:function(p,S,v,x){var F,X,J=this;return p.elements.length?(X=x?!1:p.elements.length>1,F=["[",X?m:""],et(function(ie){var be,Ie;for(be=0,Ie=p.elements.length;be<Ie;++be)p.elements[be]?(F.push(X?ie:""),F.push(J.generateExpression(p.elements[be],t.Assignment,ue))):(X&&F.push(ie),be+1===Ie&&F.push(",")),be+1<Ie&&F.push(","+(X?m:g))}),X&&!ot(Se(F).toString())&&F.push(m),F.push(X?o:""),F.push("]"),F):"[]"},RestElement:function(p,S,v){return"..."+this.generatePattern(p.argument)},ClassExpression:function(p,S,v){var x,F;return x=["class"],p.id&&(x=Ne(x,this.generateExpression(p.id,t.Sequence,ue))),p.superClass&&(F=Ne("extends",this.generateExpression(p.superClass,t.Unary,ue)),x=Ne(x,F)),x.push(g),x.push(this.generateStatement(p.body,me)),x},MethodDefinition:function(p,S,v){var x,F;return p.static?x=["static"+g]:x=[],p.kind==="get"||p.kind==="set"?F=[Ne(p.kind,this.generatePropertyKey(p.key,p.computed)),this.generateFunctionBody(p.value)]:F=[te(p),this.generatePropertyKey(p.key,p.computed),this.generateFunctionBody(p.value)],Ne(x,F)},Property:function(p,S,v){return p.kind==="get"||p.kind==="set"?[p.kind,Zt(),this.generatePropertyKey(p.key,p.computed),this.generateFunctionBody(p.value)]:p.shorthand?p.value.type==="AssignmentPattern"?this.AssignmentPattern(p.value,t.Sequence,ue):this.generatePropertyKey(p.key,p.computed):p.method?[te(p),this.generatePropertyKey(p.key,p.computed),this.generateFunctionBody(p.value)]:[this.generatePropertyKey(p.key,p.computed),":"+g,this.generateExpression(p.value,t.Assignment,ue)]},ObjectExpression:function(p,S,v){var x,F,X,J=this;return p.properties.length?(x=p.properties.length>1,et(function(){X=J.generateExpression(p.properties[0],t.Sequence,ue)}),!x&&!mn(Se(X).toString())?["{",g,X,g,"}"]:(et(function(ie){var be,Ie;if(F=["{",m,ie,X],x)for(F.push(","+m),be=1,Ie=p.properties.length;be<Ie;++be)F.push(ie),F.push(J.generateExpression(p.properties[be],t.Sequence,ue)),be+1<Ie&&F.push(","+m)}),ot(Se(F).toString())||F.push(m),F.push(o),F.push("}"),F)):"{}"},AssignmentPattern:function(p,S,v){return this.generateAssignment(p.left,p.right,"=",S,v)},ObjectPattern:function(p,S,v){var x,F,X,J,ie,be=this;if(!p.properties.length)return"{}";if(J=!1,p.properties.length===1)ie=p.properties[0],ie.type===e.Property&&ie.value.type!==e.Identifier&&(J=!0);else for(F=0,X=p.properties.length;F<X;++F)if(ie=p.properties[F],ie.type===e.Property&&!ie.shorthand){J=!0;break}return x=["{",J?m:""],et(function(Ie){var Ct,_n;for(Ct=0,_n=p.properties.length;Ct<_n;++Ct)x.push(J?Ie:""),x.push(be.generateExpression(p.properties[Ct],t.Sequence,ue)),Ct+1<_n&&x.push(","+(J?m:g))}),J&&!ot(Se(x).toString())&&x.push(m),x.push(J?o:""),x.push("}"),x},ThisExpression:function(p,S,v){return"this"},Super:function(p,S,v){return"super"},Identifier:function(p,S,v){return mt(p)},ImportDefaultSpecifier:function(p,S,v){return mt(p.id||p.local)},ImportNamespaceSpecifier:function(p,S,v){var x=["*"],F=p.id||p.local;return F&&x.push(g+"as"+Zt()+mt(F)),x},ImportSpecifier:function(p,S,v){var x=p.imported,F=[x.name],X=p.local;return X&&X.name!==x.name&&F.push(Zt()+"as"+Zt()+mt(X)),F},ExportSpecifier:function(p,S,v){var x=p.local,F=[x.name],X=p.exported;return X&&X.name!==x.name&&F.push(Zt()+"as"+Zt()+mt(X)),F},Literal:function(p,S,v){var x;if(p.hasOwnProperty("raw")&&C&&w.raw)try{if(x=C(p.raw).body[0].expression,x.type===e.Literal&&x.value===p.value)return p.raw}catch{}return p.regex?"/"+p.regex.pattern+"/"+p.regex.flags:typeof p.value=="bigint"?p.value.toString()+"n":p.bigint?p.bigint+"n":p.value===null?"null":typeof p.value=="string"?oi(p.value):typeof p.value=="number"?Qi(p.value):typeof p.value=="boolean"?p.value?"true":"false":Ri(p.value)},GeneratorExpression:function(p,S,v){return this.ComprehensionExpression(p,S,v)},ComprehensionExpression:function(p,S,v){var x,F,X,J,ie=this;return x=p.type===e.GeneratorExpression?["("]:["["],w.moz.comprehensionExpressionStartsWithAssignment&&(J=this.generateExpression(p.body,t.Assignment,ue),x.push(J)),p.blocks&&et(function(){for(F=0,X=p.blocks.length;F<X;++F)J=ie.generateExpression(p.blocks[F],t.Sequence,ue),F>0||w.moz.comprehensionExpressionStartsWithAssignment?x=Ne(x,J):x.push(J)}),p.filter&&(x=Ne(x,"if"+g),J=this.generateExpression(p.filter,t.Sequence,ue),x=Ne(x,["(",J,")"])),w.moz.comprehensionExpressionStartsWithAssignment||(J=this.generateExpression(p.body,t.Assignment,ue),x=Ne(x,J)),x.push(p.type===e.GeneratorExpression?")":"]"),x},ComprehensionBlock:function(p,S,v){var x;return p.left.type===e.VariableDeclaration?x=[p.left.kind,Zt(),this.generateStatement(p.left.declarations[0],Ye)]:x=this.generateExpression(p.left,t.Call,ue),x=Ne(x,p.of?"of":"in"),x=Ne(x,this.generateExpression(p.right,t.Sequence,ue)),["for"+g+"(",x,")"]},SpreadElement:function(p,S,v){return["...",this.generateExpression(p.argument,t.Assignment,ue)]},TaggedTemplateExpression:function(p,S,v){var x=yt;v&ne||(x=Je);var F=[this.generateExpression(p.tag,t.Call,x),this.generateExpression(p.quasi,t.Primary,he)];return Mt(F,t.TaggedTemplate,S)},TemplateElement:function(p,S,v){return p.value.raw},TemplateLiteral:function(p,S,v){var x,F,X;for(x=["`"],F=0,X=p.quasis.length;F<X;++F)x.push(this.generateExpression(p.quasis[F],t.Primary,ue)),F+1<X&&(x.push("${"+g),x.push(this.generateExpression(p.expressions[F],t.Sequence,ue)),x.push(g+"}"));return x.push("`"),x},ModuleSpecifier:function(p,S,v){return this.Literal(p,S,v)},ImportExpression:function(p,S,v){return Mt(["import(",this.generateExpression(p.source,t.Assignment,ue),")"],t.Call,S)}},en(St.prototype,St.Expression),St.prototype.generateExpression=function(p,S,v){var x,F;return F=p.type||e.Property,w.verbatim&&p.hasOwnProperty(w.verbatim)?Cs(p,S):(x=this[F](p,S,v),w.comment&&(x=li(p,x)),Se(x,p))},St.prototype.generateStatement=function(p,S){var v,x;return v=this[p.type](p,S),w.comment&&(v=li(p,v)),x=Se(v).toString(),p.type===e.Program&&!P&&m===""&&x.charAt(x.length-1)===`
`&&(v=$?Se(v).replaceRight(/\s+$/,""):x.replace(/\s+$/,"")),Se(v,p)};function H(p){var S;if(S=new St,Z(p))return S.generateStatement(p,Ze);if(U(p))return S.generateExpression(p,t.Sequence,ue);throw new Error("Unknown node type: "+p.type)}function ce(p,S){var v=Tn(),x,F;return S!=null?(typeof S.indent=="string"&&(v.format.indent.style=S.indent),typeof S.base=="number"&&(v.format.indent.base=S.base),S=Jn(v,S),l=S.format.indent.style,typeof S.base=="string"?o=S.base:o=Nt(l,S.format.indent.base)):(S=v,l=S.format.indent.style,o=Nt(l,S.format.indent.base)),c=S.format.json,u=S.format.renumber,h=c?!1:S.format.hexadecimal,d=c?"double":S.format.quotes,f=S.format.escapeless,m=S.format.newline,g=S.format.space,S.format.compact&&(m=g=l=o=""),y=S.format.parentheses,b=S.format.semicolons,P=S.format.safeConcatenation,k=S.directive,C=c?null:S.parse,$=S.sourceMap,A=S.sourceCode,Q=S.format.preserveBlankLines&&A!==null,w=S,$&&(n.browser?s=UD.sourceMap.SourceNode:s=aM().SourceNode),x=H(p),$?(F=x.toStringWithSourceMap({file:S.file,sourceRoot:S.sourceMapRoot}),S.sourceContent&&F.map.setSourceContent(S.sourceMap,S.sourceContent),S.sourceMapWithCode?F:F.map.toString()):(F={code:x.toString(),map:null},S.sourceMapWithCode?F:F.code)}q={indent:{style:"",base:0},renumber:!0,hexadecimal:!0,quotes:"auto",escapeless:!0,compact:!0,parentheses:!1,semicolons:!1},W=Tn().format,n.version=lM.version,n.generate=ce,n.attachComments=r.attachComments,n.Precedence=Jn({},t),n.browser=!1,n.FORMAT_MINIFY=q,n.FORMAT_DEFAULTS=W})()})(Ku)),Ku}var cM=uM();class hM{constructor(){this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.context={skip:()=>this.should_skip=!0,remove:()=>this.should_remove=!0,replace:e=>this.replacement=e}}replace(e,t,i,s){e&&t&&(i!=null?e[t][i]=s:e[t]=s)}remove(e,t,i){e&&t&&(i!=null?e[t].splice(i,1):delete e[t])}}class dM extends hM{constructor(e,t){super(),this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.context={skip:()=>this.should_skip=!0,remove:()=>this.should_remove=!0,replace:i=>this.replacement=i},this.enter=e,this.leave=t}visit(e,t,i,s){if(e){if(this.enter){const a=this.should_skip,o=this.should_remove,l=this.replacement;this.should_skip=!1,this.should_remove=!1,this.replacement=null,this.enter.call(this.context,e,t,i,s),this.replacement&&(e=this.replacement,this.replace(t,i,s,e)),this.should_remove&&this.remove(t,i,s);const c=this.should_skip,u=this.should_remove;if(this.should_skip=a,this.should_remove=o,this.replacement=l,c)return e;if(u)return null}let r;for(r in e){const a=e[r];if(a&&typeof a=="object")if(Array.isArray(a)){const o=a;for(let l=0;l<o.length;l+=1){const c=o[l];jm(c)&&(this.visit(c,e,r,l)||l--)}}else jm(a)&&this.visit(a,e,r,null)}if(this.leave){const a=this.replacement,o=this.should_remove;this.replacement=null,this.should_remove=!1,this.leave.call(this.context,e,t,i,s),this.replacement&&(e=this.replacement,this.replace(t,i,s,e)),this.should_remove&&this.remove(t,i,s);const l=this.should_remove;if(this.replacement=a,this.should_remove=o,l)return null}}return e}}function jm(n){return n!==null&&typeof n=="object"&&"type"in n&&typeof n.type=="string"}function fM(n,{enter:e,leave:t}){return new dM(e,t).visit(n,null)}let pM=[],wl=new Map;function mM(n,e={}){var d;const{wrapAsync:t=!1,addReturn:i=!0,emitMiniLocations:s=!0,emitWidgets:r=!0}=e;let a=XD(n,{ecmaVersion:2022,allowAwaitOutsideFunction:!0,locations:!0}),o=[];const l=(f,m)=>{const g=wl.get("minilang");if(g){const y=`[${f}]`,b=g.getLocations(y,m.start);o=o.concat(b)}else{const y=cy(`"${f}"`,m.start,n);o=o.concat(y)}};let c=[];fM(a,{enter(f,m){var g,y,b;if(kM(f)){const{name:P}=f.tag,k=wl.get(P),w=f.quasi.quasis[0].value.raw,C=f.quasi.start+1;if(s){const $=k.getLocations(w,C);o=o.concat($)}return this.skip(),this.replace(MM(P,w,C))}if(EM(f,"tidal")){const P=f.quasi.quasis[0].value.raw,k=f.quasi.start+1;if(s){const w=$M(P,k);o=o.concat(w)}return this.skip(),this.replace(DM(P,k))}if(OM(f,m)){const{quasis:P}=f,{raw:k}=P[0].value;return this.skip(),s&&l(k,f),this.replace(qm(k,f))}if(gM(f)){const{value:P}=f;return this.skip(),s&&l(P,f),this.replace(qm(P,f))}if(yM(f))return r&&c.push({from:f.arguments[0].start,to:f.arguments[0].end,value:f.arguments[0].raw,min:((g=f.arguments[1])==null?void 0:g.value)??0,max:((y=f.arguments[2])==null?void 0:y.value)??1,step:(b=f.arguments[3])==null?void 0:b.value,type:"slider"}),this.replace(vM(f));if(bM(f)){const P=f.callee.property.name,k=c.filter(C=>C.type===P).length,w={to:f.end,index:k,type:P,id:e.id};return r&&c.push(w),this.replace(wM(f,w))}if(PM(f,m))return this.replace(xM(f));if(CM(f))return this.replace(AM(f))},leave(f,m,g,y){}});let{body:u}=a;if(!u.length)console.warn("empty body -> fallback to silence"),u.push({type:"ExpressionStatement",expression:{type:"Identifier",name:"silence"}});else if(!((d=u==null?void 0:u[u.length-1])!=null&&d.expression))throw new Error("unexpected ast format without body expression");if(i){const{expression:f}=u[u.length-1];u[u.length-1]={type:"ReturnStatement",argument:f}}let h=cM.generate(a);return t&&(h=`(async ()=>{${h}})()`),s?{output:h,miniLocations:o,widgets:c}:{output:h}}function gM(n,e,t){return n.type!=="Literal"?!1:n.raw[0]==='"'}function OM(n,e){return n.type==="TemplateLiteral"&&e.type!=="TaggedTemplateExpression"}function qm(n,e){const{start:t}=e,i=wl.get("minilang");let s="m";return i&&i.name&&(s=i.name),{type:"CallExpression",callee:{type:"Identifier",name:s},arguments:[{type:"Literal",value:n},{type:"Literal",value:t}],optional:!1}}function yM(n){return n.type==="CallExpression"&&n.callee.name==="slider"}function bM(n){var e;return n.type==="CallExpression"&&pM.includes((e=n.callee.property)==null?void 0:e.name)}function vM(n){const e="slider_"+n.arguments[0].start;return n.arguments.unshift({type:"Literal",value:e,raw:e}),n.callee.name="sliderWithID",n}function SM(n){return`${n.id||""}_widget_${n.type}_${n.index}`}function wM(n,e){const t=SM(e);return n.arguments.unshift({type:"Literal",value:t,raw:t}),n}function PM(n,e){return n.type==="CallExpression"&&n.callee.name==="samples"&&e.type!=="AwaitExpression"}function xM(n){return{type:"AwaitExpression",argument:n}}function CM(n){return n.type==="LabeledStatement"}function AM(n){return{type:"ExpressionStatement",expression:{type:"CallExpression",callee:{type:"MemberExpression",object:n.body.expression,property:{type:"Identifier",name:"p"}},arguments:[{type:"Literal",value:n.label.name,raw:`'${n.label.name}'`}]}}}function kM(n){return n.type==="TaggedTemplateExpression"&&wl.has(n.tag.name)}function EM(n,e){return n.type==="TaggedTemplateExpression"&&n.tag.name===e}function $M(n,e){return n.split("").reduce((t,i,s)=>(i!=='"'||(!t.length||t[t.length-1].length>1?t.push([s+1]):t[t.length-1].push(s)),t),[]).map(([t,i])=>{const s=n.slice(t,i);return cy(`"${s}"`,e+t-1)}).flat()}function DM(n,e){return{type:"CallExpression",callee:{type:"Identifier",name:"tidal"},arguments:[{type:"Literal",value:n},{type:"Literal",value:e}],optional:!1}}function MM(n,e,t){return{type:"CallExpression",callee:{type:"Identifier",name:n},arguments:[{type:"Literal",value:e},{type:"Literal",value:t}],optional:!1}}class TM{constructor(){this.modal=null,this.onLoginSuccess=null}init(){this.createModal(),this.attachEventListeners(),this.checkAuthStatus()}createModal(){document.body.insertAdjacentHTML("beforeend",`
      <div class="login-modal-overlay" id="login-modal-overlay" style="display: none;">
        <div class="login-modal">
          <div class="login-modal-header">
            <h2>Login to Strudesk 4000</h2>
            <button class="login-modal-close" id="login-modal-close" aria-label="Close">&times;</button>
          </div>
          <div class="login-modal-body">
            <p>Sign in to save and share your patterns</p>
            <div class="login-buttons">
              <button class="login-button login-button-google" id="login-google">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                  <path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z" fill="#4285F4"/>
                  <path d="M9 18c2.43 0 4.467-.806 5.965-2.18l-2.908-2.258c-.806.54-1.837.86-3.057.86-2.35 0-4.34-1.587-5.053-3.72H.957v2.332C2.438 15.983 5.482 18 9 18z" fill="#34A853"/>
                  <path d="M3.947 10.712c-.18-.54-.282-1.117-.282-1.712s.102-1.172.282-1.712V4.956H.957C.348 6.174 0 7.55 0 9s.348 2.826.957 4.044l2.99-2.332z" fill="#FBBC05"/>
                  <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.956L3.947 7.288C4.66 5.153 6.65 3.58 9 3.58z" fill="#EA4335"/>
                </svg>
                Continue with Google
              </button>
              <button class="login-button login-button-github" id="login-github">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
                Continue with GitHub
              </button>
            </div>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("login-modal-overlay")}attachEventListeners(){const e=document.getElementById("login-modal-close");e&&e.addEventListener("click",()=>this.hide()),this.modal&&this.modal.addEventListener("click",r=>{r.target===this.modal&&this.hide()});const t=document.getElementById("login-google");t&&t.addEventListener("click",async()=>{const{authAPI:r}=await Jt(async()=>{const{authAPI:a}=await Promise.resolve().then(()=>ns);return{authAPI:a}},void 0);window.location.href=r.getGoogleLoginUrl()});const i=document.getElementById("login-github");i&&i.addEventListener("click",async()=>{const{authAPI:r}=await Jt(async()=>{const{authAPI:a}=await Promise.resolve().then(()=>ns);return{authAPI:a}},void 0);window.location.href=r.getGithubLoginUrl()}),new URLSearchParams(window.location.search).get("auth")==="success"&&(this.checkAuthStatus(),window.history.replaceState({},document.title,window.location.pathname))}async checkAuthStatus(){try{const{getCurrentUser:e}=await Jt(async()=>{const{getCurrentUser:i}=await Promise.resolve().then(()=>ns);return{getCurrentUser:i}},void 0),t=await e();t&&this.onLoginSuccess&&this.onLoginSuccess(t)}catch{}}show(){this.modal&&(this.modal.style.display="flex",document.body.style.overflow="hidden")}hide(){this.modal&&(this.modal.style.display="none",document.body.style.overflow="")}setOnLoginSuccess(e){this.onLoginSuccess=e}}const Ih="/api";class cc extends Error{constructor(e,t,i){super(e),this.status=t,this.data=i}}async function si(n,e={}){const t=`${Ih}${n}`,i={...e,credentials:"include",headers:{"Content-Type":"application/json",...e.headers}};try{const s=await fetch(t,i),r=await s.json().catch(()=>({}));if(!s.ok)throw new cc(r.error||"Request failed",s.status,r);return r}catch(s){throw s instanceof cc?s:new cc(s.message||"Network error",0,null)}}const jd={async getCurrentUser(){return si("/auth/me")},async logout(){return si("/auth/logout",{method:"POST"})},getGoogleLoginUrl(){return`${Ih}/auth/google`},getGithubLoginUrl(){return`${Ih}/auth/github`}},Pl={async listUsers(n="",e=50){const t=new URLSearchParams;return n&&t.append("search",n),t.append("limit",e),si(`/users?${t.toString()}`)},async getUser(n){return si(`/users/${n}`)},async updateUser(n,e){return si(`/users/${n}`,{method:"PUT",body:JSON.stringify(e)})},async searchUsers(n){return si(`/users/search/${encodeURIComponent(n)}`)}},Vh={async createPattern(n){return si("/patterns",{method:"POST",body:JSON.stringify(n)})},async getPatterns(n={}){const e=new URLSearchParams;n.type&&e.append("type",n.type),n.isPublic!==void 0&&e.append("isPublic",n.isPublic),n.shared!==void 0&&e.append("shared",n.shared);const t=e.toString();return si(`/patterns${t?`?${t}`:""}`)},async getPattern(n){return si(`/patterns/${n}`)},async updatePattern(n,e){return si(`/patterns/${n}`,{method:"PUT",body:JSON.stringify(e)})},async deletePattern(n){return si(`/patterns/${n}`,{method:"DELETE"})},async sharePattern(n,e){return si(`/patterns/${n}/share`,{method:"POST",body:JSON.stringify({userIds:e})})},async getPatternUsers(n){return si(`/patterns/${n}/users`)}};async function nu(){try{return await jd.getCurrentUser()}catch{return null}}const ns=Object.freeze(Object.defineProperty({__proto__:null,authAPI:jd,getCurrentUser:nu,patternsAPI:Vh,usersAPI:Pl},Symbol.toStringTag,{value:"Module"}));class _M{constructor(){this.modal=null,this.user=null,this.onUpdate=null}init(){this.createModal(),this.attachEventListeners()}createModal(){document.body.insertAdjacentHTML("beforeend",`
      <div class="user-profile-modal-overlay" id="user-profile-modal-overlay" style="display: none;">
        <div class="user-profile-modal">
          <div class="user-profile-modal-header">
            <h2>Edit Profile</h2>
            <button class="user-profile-modal-close" id="user-profile-modal-close" aria-label="Close">&times;</button>
          </div>
          <div class="user-profile-modal-body">
            <form id="user-profile-form">
              <div class="form-group">
                <label for="profile-avatar-url">Profile Image</label>
                <div class="avatar-preview-container">
                  <img id="profile-avatar-preview" src="" alt="Avatar preview" style="display: none; width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; border: 2px solid #ddd;" />
                  <input type="url" id="profile-avatar-url" placeholder="https://example.com/your-image.jpg" />
                  <small>Enter a URL to your profile image</small>
                </div>
              </div>

              <div class="form-group">
                <label for="profile-artist-name">Artist Name (Pseudonym)</label>
                <input type="text" id="profile-artist-name" placeholder="Your artist name or pseudonym" />
                <small>This will be used as the default copyright holder for your patterns</small>
              </div>

              <div class="form-group">
                <label>Social Media Links</label>
                <div class="social-links-grid">
                  <div class="social-link-item">
                    <label for="social-twitter">Twitter/X</label>
                    <input type="url" id="social-twitter" placeholder="https://twitter.com/username" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-instagram">Instagram</label>
                    <input type="url" id="social-instagram" placeholder="https://instagram.com/username" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-soundcloud">SoundCloud</label>
                    <input type="url" id="social-soundcloud" placeholder="https://soundcloud.com/username" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-bandcamp">Bandcamp</label>
                    <input type="url" id="social-bandcamp" placeholder="https://username.bandcamp.com" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-youtube">YouTube</label>
                    <input type="url" id="social-youtube" placeholder="https://youtube.com/@username" />
                  </div>
                  <div class="social-link-item">
                    <label for="social-spotify">Spotify</label>
                    <input type="url" id="social-spotify" placeholder="https://open.spotify.com/artist/..." />
                  </div>
                  <div class="social-link-item">
                    <label for="social-website">Website</label>
                    <input type="url" id="social-website" placeholder="https://yourwebsite.com" />
                  </div>
                </div>
              </div>

              <div class="form-group">
                <div class="user-profile-info">
                  <p><strong>Name:</strong> <span id="profile-display-name"></span></p>
                  <p><strong>Email:</strong> <span id="profile-display-email"></span></p>
                </div>
              </div>

              <div class="user-profile-modal-footer">
                <button type="button" class="btn-cancel" id="profile-cancel-btn">Cancel</button>
                <button type="submit" class="btn-save" id="profile-save-btn">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("user-profile-modal-overlay")}attachEventListeners(){const e=document.getElementById("user-profile-modal-close");e&&e.addEventListener("click",()=>this.hide());const t=document.getElementById("profile-cancel-btn");t&&t.addEventListener("click",()=>this.hide()),this.modal&&this.modal.addEventListener("click",s=>{s.target===this.modal&&this.hide()});const i=document.getElementById("user-profile-form");i&&i.addEventListener("submit",async s=>{s.preventDefault(),await this.saveProfile()})}async loadUserData(){try{const e=await nu();if(!e)throw new Error("Not authenticated");this.user=e;const t=await Pl.getUser(e.id);this.user=t;const i=document.getElementById("profile-avatar-url"),s=document.getElementById("profile-avatar-preview");i&&(i.value=t.avatarUrl||"",i.addEventListener("input",u=>{const h=u.target.value.trim();s&&(h?(s.src=h,s.style.display="block",s.onerror=()=>{s.style.display="none"}):s.style.display="none")}),t.avatarUrl&&s&&(s.src=t.avatarUrl,s.style.display="block",s.onerror=()=>{s.style.display="none"}));const r=document.getElementById("profile-artist-name");r&&(r.value=t.artistName||"");const a=document.getElementById("profile-display-name");a&&(a.textContent=t.name);const o=document.getElementById("profile-display-email");o&&(o.textContent=t.email);const l=t.socialLinks||{};return["twitter","instagram","soundcloud","bandcamp","youtube","spotify","website"].forEach(u=>{const h=document.getElementById(`social-${u}`);h&&(h.value=l[u]||"")}),t}catch(e){return console.error("Error loading user data:",e),alert("Failed to load profile data"),null}}async saveProfile(){var e,t;if(!this.user){alert("User not loaded");return}try{const i=((e=document.getElementById("profile-avatar-url"))==null?void 0:e.value.trim())||null,s=((t=document.getElementById("profile-artist-name"))==null?void 0:t.value.trim())||null,r={};["twitter","instagram","soundcloud","bandcamp","youtube","spotify","website"].forEach(l=>{const c=document.getElementById(`social-${l}`);c&&c.value.trim()&&(r[l]=c.value.trim())});const o=await Pl.updateUser(this.user.id,{avatarUrl:i,artistName:s,socialLinks:r});this.user=o,this.onUpdate&&this.onUpdate(o),this.hide(),alert("Profile updated successfully!")}catch(i){console.error("Error saving profile:",i),alert("Failed to save profile: "+(i.message||"Unknown error"))}}async show(){this.modal&&(await this.loadUserData(),this.modal.style.display="flex",document.body.style.overflow="hidden")}hide(){this.modal&&(this.modal.style.display="none",document.body.style.overflow="")}setOnUpdate(e){this.onUpdate=e}}class FM{constructor(){this.modal=null,this.users=[],this.searchTimeout=null}init(){this.createModal(),this.attachEventListeners()}createModal(){document.body.insertAdjacentHTML("beforeend",`
      <div class="user-profiles-modal-overlay" id="user-profiles-modal-overlay" style="display: none;">
        <div class="user-profiles-modal">
          <div class="user-profiles-modal-header">
            <h2>User Profiles</h2>
            <button class="user-profiles-modal-close" id="user-profiles-modal-close" aria-label="Close">&times;</button>
          </div>
          <div class="user-profiles-modal-body">
            <div class="profiles-search-container">
              <input 
                type="text" 
                id="profiles-search-input" 
                placeholder="Search users by name, email, or artist name..." 
                class="profiles-search-input"
              />
            </div>
            <div class="profiles-list" id="profiles-list">
              <div class="profiles-loading">Loading profiles...</div>
            </div>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("user-profiles-modal-overlay")}attachEventListeners(){const e=document.getElementById("user-profiles-modal-close");e&&e.addEventListener("click",()=>this.hide()),this.modal&&this.modal.addEventListener("click",i=>{i.target===this.modal&&this.hide()});const t=document.getElementById("profiles-search-input");t&&t.addEventListener("input",i=>{const s=i.target.value.trim();clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.loadUsers(s)},300)})}async loadUsers(e=""){const t=document.getElementById("profiles-list");if(t)try{t.innerHTML='<div class="profiles-loading">Loading profiles...</div>';const i=await Pl.listUsers(e,100);if(this.users=i,i.length===0){t.innerHTML='<div class="profiles-empty">No users found.</div>';return}t.innerHTML=i.map(s=>this.renderUserCard(s)).join("")}catch(i){console.error("Error loading users:",i),t.innerHTML='<div class="profiles-error">Failed to load profiles. Please try again.</div>'}}renderUserCard(e){var o;const t=e.avatarUrl||"https://via.placeholder.com/80?text="+encodeURIComponent(e.name.charAt(0).toUpperCase()),i=e.artistName?`<div class="user-card-artist">${this.escapeHtml(e.artistName)}</div>`:"",s=((o=e._count)==null?void 0:o.patterns)||0,r=e.socialLinks||{},a=this.renderSocialLinks(r);return`
      <div class="user-card" data-user-id="${e.id}">
        <div class="user-card-avatar">
          <img src="${t}" alt="${this.escapeHtml(e.name)}" onerror="this.src='https://via.placeholder.com/80?text=' + encodeURIComponent('${this.escapeHtml(e.name.charAt(0).toUpperCase())}')" />
        </div>
        <div class="user-card-info">
          <div class="user-card-name">${this.escapeHtml(e.name)}</div>
          ${i}
          <div class="user-card-email">${this.escapeHtml(e.email)}</div>
          <div class="user-card-stats">
            <span class="user-card-patterns">${s} pattern${s!==1?"s":""}</span>
          </div>
          ${a}
        </div>
      </div>
    `}renderSocialLinks(e){const t=[],i={twitter:"🐦",instagram:"📷",soundcloud:"🎵",bandcamp:"💿",youtube:"▶️",spotify:"🎧",website:"🌐"};return Object.entries(e).forEach(([s,r])=>{r&&t.push(`<a href="${this.escapeHtml(r)}" target="_blank" rel="noopener noreferrer" class="user-card-social-link" title="${s}">${i[s]||"🔗"}</a>`)}),t.length===0?"":`<div class="user-card-social">${t.join("")}</div>`}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}async show(){if(this.modal){this.modal.style.display="flex",document.body.style.overflow="hidden",await this.loadUsers();const e=document.getElementById("profiles-search-input");e&&setTimeout(()=>e.focus(),100)}}hide(){if(this.modal){this.modal.style.display="none",document.body.style.overflow="";const e=document.getElementById("profiles-search-input");e&&(e.value="")}}}class BM{constructor(){this.modal=null,this.onSave=null,this.currentPattern=null,this.patternType=null,this.elementId=null,this.selectedUsers=[]}init(){this.createModal(),this.attachEventListeners()}createModal(){document.body.insertAdjacentHTML("beforeend",`
      <div class="save-pattern-modal-overlay" id="save-pattern-modal-overlay" style="display: none;">
        <div class="save-pattern-modal">
          <div class="save-pattern-modal-header">
            <h2>Save Pattern</h2>
            <button class="save-pattern-modal-close" id="save-pattern-modal-close" aria-label="Close">&times;</button>
          </div>
          <div class="save-pattern-modal-body">
            <form id="save-pattern-form">
              <div class="form-group">
                <label for="save-pattern-title">Title (optional)</label>
                <input type="text" id="save-pattern-title" placeholder="e.g., My Awesome Beat" />
              </div>

              <div class="form-group">
                <label for="save-pattern-artist">Artist Name (optional)</label>
                <input type="text" id="save-pattern-artist" placeholder="Leave empty to use your default artist name" />
                <small>Override your default artist name for this pattern</small>
              </div>

              <div class="form-group">
                <label for="save-pattern-version-name">Version Name (optional)</label>
                <input type="text" id="save-pattern-version-name" placeholder="e.g., Remix, Live, Studio" />
                <small>Add a label to this version (version number is automatic)</small>
              </div>

              <div class="form-group" id="save-pattern-genre-group" style="display: none;">
                <label for="save-pattern-genre">Genre/Style (optional)</label>
                <select id="save-pattern-genre">
                  <option value="">Select a genre...</option>
                  <optgroup label="Electronic">
                    <option value="Techno">Techno</option>
                    <option value="House">House</option>
                    <option value="Trance">Trance</option>
                    <option value="Dubstep">Dubstep</option>
                    <option value="Drum & Bass">Drum & Bass</option>
                    <option value="Ambient">Ambient</option>
                    <option value="IDM">IDM</option>
                    <option value="Electro">Electro</option>
                    <option value="Synthwave">Synthwave</option>
                    <option value="Industrial">Industrial</option>
                  </optgroup>
                  <optgroup label="Hip Hop & Urban">
                    <option value="Hip Hop">Hip Hop</option>
                    <option value="Trap">Trap</option>
                    <option value="R&B">R&B</option>
                    <option value="Grime">Grime</option>
                    <option value="Drill">Drill</option>
                  </optgroup>
                  <optgroup label="Rock & Alternative">
                    <option value="Rock">Rock</option>
                    <option value="Alternative">Alternative</option>
                    <option value="Indie">Indie</option>
                    <option value="Punk">Punk</option>
                    <option value="Metal">Metal</option>
                    <option value="Post-Rock">Post-Rock</option>
                  </optgroup>
                  <optgroup label="Jazz & Blues">
                    <option value="Jazz">Jazz</option>
                    <option value="Blues">Blues</option>
                    <option value="Smooth Jazz">Smooth Jazz</option>
                    <option value="Bebop">Bebop</option>
                    <option value="Fusion">Fusion</option>
                  </optgroup>
                  <optgroup label="World & Folk">
                    <option value="World">World</option>
                    <option value="Folk">Folk</option>
                    <option value="Traditional">Traditional</option>
                    <option value="Ethnic">Ethnic</option>
                  </optgroup>
                  <optgroup label="Pop & Dance">
                    <option value="Pop">Pop</option>
                    <option value="Dance">Dance</option>
                    <option value="EDM">EDM</option>
                    <option value="Disco">Disco</option>
                    <option value="Funk">Funk</option>
                  </optgroup>
                  <optgroup label="Experimental">
                    <option value="Experimental">Experimental</option>
                    <option value="Noise">Noise</option>
                    <option value="Avant-garde">Avant-garde</option>
                    <option value="Minimal">Minimal</option>
                  </optgroup>
                  <optgroup label="Other">
                    <option value="Cinematic">Cinematic</option>
                    <option value="Game Music">Game Music</option>
                    <option value="Other">Other</option>
                  </optgroup>
                </select>
                <small>Select a genre to help with pattern matching and discovery</small>
              </div>

              <div class="form-group">
                <label class="privacy-toggle-label">
                  <input type="checkbox" id="save-pattern-public" />
                  <span>Make this pattern public</span>
                </label>
                <small>Public patterns can be seen and used by all users</small>
              </div>

              <div class="form-group" id="save-pattern-share-group" style="display: none;">
                <label>Share with specific users (optional)</label>
                <div class="user-search-container">
                  <input type="text" id="save-pattern-user-search" placeholder="Search users by name or email..." />
                  <div class="user-search-results" id="save-pattern-user-results"></div>
                </div>
                <div class="selected-users" id="save-pattern-selected-users"></div>
              </div>

              <div class="save-pattern-modal-footer">
                <button type="button" class="btn-cancel" id="save-pattern-cancel-btn">Cancel</button>
                <button type="submit" class="btn-save" id="save-pattern-save-btn">Save Pattern</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    `),this.modal=document.getElementById("save-pattern-modal-overlay")}attachEventListeners(){const e=document.getElementById("save-pattern-modal-close");e&&e.addEventListener("click",()=>this.hide());const t=document.getElementById("save-pattern-cancel-btn");t&&t.addEventListener("click",()=>this.hide()),this.modal&&this.modal.addEventListener("click",o=>{o.target===this.modal&&this.hide()});const i=document.getElementById("save-pattern-form");i&&i.addEventListener("submit",async o=>{o.preventDefault(),await this.savePattern()});const s=document.getElementById("save-pattern-public"),r=document.getElementById("save-pattern-share-group");s&&r&&s.addEventListener("change",o=>{o.target.checked?(r.style.display="none",this.selectedUsers=[],this.updateSelectedUsers()):r.style.display="block"});const a=document.getElementById("save-pattern-user-search");if(a){let o;a.addEventListener("input",l=>{clearTimeout(o);const c=l.target.value.trim();c.length>=2?o=setTimeout(()=>this.searchUsers(c),300):this.clearUserSearchResults()})}}async searchUsers(e){try{const{usersAPI:t}=await Jt(async()=>{const{usersAPI:s}=await Promise.resolve().then(()=>ns);return{usersAPI:s}},void 0),i=await t.searchUsers(e);this.displayUserSearchResults(i)}catch(t){console.error("Error searching users:",t)}}displayUserSearchResults(e){const t=document.getElementById("save-pattern-user-results");if(t){if(e.length===0){t.innerHTML='<div class="user-search-no-results">No users found</div>';return}t.innerHTML=e.filter(i=>!this.selectedUsers.find(s=>s.id===i.id)).map(i=>`
        <div class="user-search-result-item" data-user-id="${i.id}">
          <img src="${i.avatarUrl||""}" alt="${i.name}" class="user-search-avatar" onerror="this.style.display='none'">
          <div class="user-search-result-info">
            <div class="user-search-result-name">${i.name}</div>
            <div class="user-search-result-email">${i.email}</div>
          </div>
          <button type="button" class="user-search-add-btn">Add</button>
        </div>
      `).join(""),t.querySelectorAll(".user-search-result-item").forEach(i=>{const s=i.querySelector(".user-search-add-btn"),r=i.dataset.userId,a=e.find(o=>o.id===r);s&&a&&s.addEventListener("click",()=>{this.addUserToShare(a),i.remove()})})}}clearUserSearchResults(){const e=document.getElementById("save-pattern-user-results");e&&(e.innerHTML="")}addUserToShare(e){this.selectedUsers.find(i=>i.id===e.id)||(this.selectedUsers.push(e),this.updateSelectedUsers());const t=document.getElementById("save-pattern-user-search");t&&(t.value=""),this.clearUserSearchResults()}removeUserFromShare(e){this.selectedUsers=this.selectedUsers.filter(t=>t.id!==e),this.updateSelectedUsers()}updateSelectedUsers(){const e=document.getElementById("save-pattern-selected-users");if(e){if(this.selectedUsers.length===0){e.innerHTML="";return}e.innerHTML=this.selectedUsers.map(t=>`
      <div class="selected-user-item">
        <img src="${t.avatarUrl||""}" alt="${t.name}" class="selected-user-avatar" onerror="this.style.display='none'">
        <span class="selected-user-name">${t.name}</span>
        <button type="button" class="selected-user-remove" data-user-id="${t.id}">&times;</button>
      </div>
    `).join(""),e.querySelectorAll(".selected-user-remove").forEach(t=>{t.addEventListener("click",()=>{this.removeUserFromShare(t.dataset.userId)})})}}async show(e,t,i=null){var a,o,l,c;if(!this.modal)return;this.currentPattern=e,this.patternType=t,this.elementId=i,this.selectedUsers=[];const s=document.getElementById("save-pattern-genre-group");s&&(s.style.display=t==="master"?"block":"none"),(a=document.getElementById("save-pattern-title"))!=null&&a.value&&(document.getElementById("save-pattern-title").value=""),(o=document.getElementById("save-pattern-artist"))!=null&&o.value&&(document.getElementById("save-pattern-artist").value=""),(l=document.getElementById("save-pattern-version-name"))!=null&&l.value&&(document.getElementById("save-pattern-version-name").value="");const r=document.getElementById("save-pattern-genre");r&&(r.value=""),(c=document.getElementById("save-pattern-public"))!=null&&c.checked&&(document.getElementById("save-pattern-public").checked=!1),this.updateSelectedUsers(),this.clearUserSearchResults(),this.modal.style.display="flex",document.body.style.overflow="hidden"}hide(){this.modal&&(this.modal.style.display="none",document.body.style.overflow="")}async savePattern(){var e,t,i,s,r;if(!this.currentPattern){alert("No pattern to save");return}try{if(!await nu()){alert("Please log in to save patterns");return}const o=((e=document.getElementById("save-pattern-title"))==null?void 0:e.value.trim())||null,l=((t=document.getElementById("save-pattern-artist"))==null?void 0:t.value.trim())||null,c=((i=document.getElementById("save-pattern-version-name"))==null?void 0:i.value.trim())||null,u=((s=document.getElementById("save-pattern-genre"))==null?void 0:s.value.trim())||null,h=((r=document.getElementById("save-pattern-public"))==null?void 0:r.checked)||!1;let d=this.currentPattern;const f=d.split(`
`);let m=0,g=f.length;for(let P=0;P<f.length;P++)if(f[P].trim()===""&&P>0&&f[P-1].trim().startsWith("//")){m=P+1;break}for(let P=f.length-1;P>=0;P--)if(f[P].includes("Made with Strudesk 4000")){g=P;break}d=f.slice(m,g).join(`
`).trim();const y={type:this.patternType,elementId:this.elementId,patternCode:d,title:o,artistName:l,versionName:c,genre:this.patternType==="master"?u:null,isPublic:h,metadata:{}},b=await Vh.createPattern(y);!h&&this.selectedUsers.length>0&&await Vh.sharePattern(b.id,this.selectedUsers.map(P=>P.id)),this.onSave&&this.onSave(b),this.hide(),alert("Pattern saved successfully!")}catch(a){console.error("Error saving pattern:",a),alert("Failed to save pattern: "+(a.message||"Unknown error"))}}setOnSave(e){this.onSave=e}}const Yy={bd:"Bass drum, Kick drum",sd:"Snare drum",rim:"Rimshot",cp:"Clap",hh:"Closed hi-hat",oh:"Open hi-hat",cr:"Crash",rd:"Ride",ht:"High tom",mt:"Medium tom",lt:"Low tom",sh:"Shakers",cb:"Cowbell",tb:"Tambourine",perc:"Other percussions",misc:"Miscellaneous samples",fx:"Effects"},Ar=new Set(["RolandTR808","RolandTR909","RolandTR707","RhythmAce","AkaiLinn","ViscoSpaceDrum","CasioRZ1"]),NM="https://raw.githubusercontent.com/felixroos/dough-samples/main/vcsl.json",xl="vcsl:";let sr=null,kr=null;const Gm="World Instruments",Wm="VCSL Instruments",Xm=["Chordophones","Aerophones","Membranophones","Electrophones","Idiophones"],zh=[{value:"mridangam",label:"Mridangam Percussion Set"}],QM=new Set(zh.map(n=>n.value.toLowerCase())),hc=n=>{if(!n||typeof n!="string")return{rawValue:"",bankValue:"",isVcslInstrument:!1,vcslInstrument:""};if(n.startsWith(xl)){const e=n.slice(xl.length);return{rawValue:n,bankValue:"vcsl",isVcslInstrument:!0,vcslInstrument:e}}return{rawValue:n,bankValue:n,isVcslInstrument:!1,vcslInstrument:""}},Hy=n=>n?n.replace(/[_-]+/g," ").replace(/\s+/g," ").trim().replace(/\b\w/g,e=>e.toUpperCase()):"",RM=n=>{if(!n)return"";if(typeof n=="string")return n;if(Array.isArray(n))return typeof n[0]=="string"?n[0]:"";if(typeof n=="object"){const e=Object.values(n)[0];if(typeof e=="string")return e;if(Array.isArray(e)&&typeof e[0]=="string")return e[0]}return""},LM=(n,e)=>{const t=(n||e||"").toLowerCase();return/(membranophone|idiophone|drum|percussion|bongo|cajon|shaker|triangle|tambourine|clave|cowbell|snare|kick|timpani|gong|cymbal)/i.test(t)?"drums":"world"},IM=(n,e)=>{if(!n||!e)return n;try{return new URL(n,e).toString()}catch{return n}},Zh=(n,e)=>{if(typeof n=="string")return IM(n,e);if(Array.isArray(n))return n.map(t=>Zh(t,e));if(n&&typeof n=="object"){const t={};return Object.entries(n).forEach(([i,s])=>{t[i]=Zh(s,e)}),t}return n},VM=n=>{if(!n||typeof n!="object")return n;const e=n._base||"",t={};return Object.entries(n).forEach(([i,s])=>{i!=="_base"&&(t[i]=Zh(s,e))}),t},zM=n=>{if(!n||typeof n!="string")return"Other";const e=n.match(/^([^/]+)/);if(!e)return"Other";try{const t=decodeURIComponent(e[1]);return t.charAt(0).toUpperCase()+t.slice(1)}catch{return e[1]}},ZM=n=>{const e=Xm.indexOf(n);return e===-1?Xm.length+1:e},jM=async()=>sr||kr||(kr=fetch(NM).then(async n=>{if(!n.ok)throw new Error(`Failed to load VCSL instruments: ${n.status}`);const e=await n.json();VM(e);const i=Object.entries(e||{}).filter(([s])=>s&&s!=="_base").map(([s,r])=>{const a=RM(r),o=zM(a),l=LM(a,o);return{value:s,optionValue:`${xl}${s}`,label:`VCSL · ${Hy(s)}`,category:l,samplePath:a,family:o,familyOrder:ZM(o)}}).sort((s,r)=>s.familyOrder!==r.familyOrder?s.familyOrder-r.familyOrder:s.label.localeCompare(r.label));return sr=i,i}).catch(n=>(console.warn("⚠️ Unable to load VCSL instrument list:",n),sr=[],[])).finally(()=>{kr=null}),kr),Ea={RolandTR808:"Roland TR-808",RolandTR909:"Roland TR-909",RolandTR707:"Roland TR-707",RhythmAce:"Rhythm Ace",AkaiLinn:"Akai Linn",ViscoSpaceDrum:"Visco Space Drum",CasioRZ1:"Casio RZ-1"},Um=/\b(note|n)\s*\(/i,Ym=/\bn\(\s*["'][^"']*["']\s*\)/i,jn=n=>!n||typeof n!="string"?!1:(Um.lastIndex=0,Um.test(n)),Ai=n=>!n||typeof n!="string"?!1:(Ym.lastIndex=0,Ym.test(n)),er=n=>{if(!n)return"Channel";const e=n.match(/element-(\d+)/i);return e&&e[1]?`Channel ${e[1]}`:n},qM=(n,e)=>{const t=er(n),i=e?e.trim():"";if(!i||/^element\s*\d+$/i.test(i))return t;if(/^channel\s*\d+$/i.test(i))return i;const s=i.replace(/^channel\s*\d+\s*(–|-)\s*/i,"");return`${t} – ${s}`},di=(n,e)=>{const t=document.querySelector(`[data-sound-id="${n}"]`);if(!t)return;const i=t.querySelector(".element-title");i&&(i.textContent=qM(n,e));const s=t.querySelector(".config-button");s&&(s.textContent=e&&e.trim()?e.trim():"Configure Sound")},$o=n=>n?Object.prototype.hasOwnProperty.call(Ea,n)?Ea[n]:n.replace(/([a-z])([A-Z])/g,"$1 $2").replace(/([A-Za-z])(\d+)/g,"$1 $2").trim():"",Hm={RolandTR808:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"cp",label:"CP",sample:"cp"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"},{key:"cb",label:"CB",sample:"cb"},{key:"sh",label:"SH",sample:"sh"}],RolandTR909:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"cp",label:"CP",sample:"cp"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],RolandTR707:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],RhythmAce:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],AkaiLinn:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],ViscoSpaceDrum:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}],CasioRZ1:[{key:"bd",label:"BD",sample:"bd"},{key:"sd",label:"SD",sample:"sd"},{key:"hh",label:"HH",sample:"hh"},{key:"oh",label:"OH",sample:"oh"},{key:"cr",label:"CR",sample:"cr"},{key:"rd",label:"RD",sample:"rd"},{key:"lt",label:"LT",sample:"lt"},{key:"mt",label:"MT",sample:"mt"},{key:"ht",label:"HT",sample:"ht"}]},GM=[{id:"roland808-simple-bd-hh",label:"Roland 808 – Kick & Hat",bank:"RolandTR808",description:"Simple BD/HH groove shown in the step editor",pattern:'s("bd ~ hh ~ bd ~ hh ~ bd ~ hh ~ bd ~ hh ~").bank("RolandTR808")',editorBadge:"Step editor"},{id:"drum-beat-generator",label:"Beat Generator",bank:"",description:"Opens in code editor for generative BD patterns",pattern:'s("bd").bank("RolandTR808").segment(16).degradeBy(.5).ribbon(16,1)',editorBadge:"Code"},{id:"random-modifiers",label:"Random Modifiers",bank:"",description:"chooseCycles randomizes BD / HH / SD each cycle",pattern:'s(chooseCycles("bd","hh","sd")).bank("RolandTR808").fast(8)',editorBadge:"Code"},{id:"mridangam-pulse",label:"Mridangam Percussion Set",bank:"",description:"Classical tha · dhi · thom · nam motif on the mridangam bank",pattern:`"tha dhi thom nam".drop("0 -1 -2 -3").sound().bank("mridangam")

/* Available sounds: tha · dhi · dhin · thom · nam · na · ta · ka · ki · gumki · dhum · chaapu · ardha */`,editorBadge:"Code"}],Ky=[{id:"independent-params",label:"Note Names and Filter Pattern",bank:"",description:"note, cutoff, gain and sound controlled independently",pattern:'note("F3 A3 C3 E3").cutoff("<500 1000 2000 [4000 8000]>").gain(.8).s("sawtooth").log()'},{id:"semitones-scale-transpose",label:"Semitones, Scale & Transpose",bank:"",description:"Transposes notes inside the scale by the number of steps",pattern:`"[-8 [2,4,6]]*2".scale('c:ionian').scaleTranspose("<0 -1 -2 -3 -4 -5 -6 -4>*2").note().s("piano")`,useNoteNames:!1},{id:"simple-arpeggios",label:"Simple Arpeggios in Semitones & Chords",bank:"",description:"Combines numeric semitones with chord progressions",pattern:'n("0 1 2 3").chord("<C Am F G>").voicing()',useNoteNames:!1},{id:"simple-backing-track",label:"Simple Backing Track",bank:"",description:"Together with layer, struct and voicings, this can be used to create a basic backing track",pattern:`"<C^7 A7b13 Dm7 G7>*2".layer(
  x => x.voicings("lefthand").struct("[~ x]*2").note(),
  x => x.rootNotes(2).note().s("sawtooth").cutoff(800)
)`},{id:"vcsl-vocal-bed",label:"VCSL World Textures",bank:"",description:"Layered Ball Whistle + Bongo textures from the VCSL set",pattern:'sound("<ballwhistle ~ bongo ~>*2").bank("vcsl").slow(2).room(.35).shape(.2)'},{id:"jazz-blues-in-f",label:"Jazz Blues in F",bank:"",description:"Classic jazz-blues progression with layered voicings and struct patterns",pattern:`(() => {
  const chords = chord(\`<

F7 Bb7 F7 [Cm7 F7]

Bb7 Bo F7 [Am7 D7]

Gm7 C7 [F7 D7] [Gm7 C7]

>\`);

  return stack(
    n("7 8 [10 9] 8").set(chords).voicing().dec(.2),
    chords.struct("- x - x").voicing().room(.5),
    n("0 - 1 -").set(chords).mode("root:g2").voicing()
  );
})()`},{id:"mini-notation-example",label:"Mini-notation Example",bank:"",description:"Layered mini-notation demo showing melody + bass progressions",pattern:`note(\`<

[e5 [b4 c5] d5 [c5 b4]]

[a4 [a4 c5] e5 [d5 c5]]

[b4 [~ c5] d5 e5]

[c5 a4 a4 ~]

[[~ d5] [~ f5] a5 [g5 f5]]

[e5 [~ c5] e5 [d5 c5]]

[b4 [b4 c5] d5 e5]

[c5 a4 a4 ~]

,

[[e2 e3]*4]

[[a2 a3]*4]

[[g#2 g#3]*2 [e2 e3]*2]

[a2 a3 a2 a3 a2 a3 b1 c2]

[[d2 d3]*4]

[[c2 c3]*4]

[[b1 b2]*2 [e2 e3]*2]

[[a1 a2]*4]

>\`)`}],WM=[{id:"sampler-begin",label:"begin",description:"Skip the first section of each triggered sample.",tooltip:"A 0–1 pattern that trims the start of each hit (0.25 removes the first quarter).",pattern:`samples({
  "rave": "rave/AREUREADY.wav"
}, "github:tidalcycles/dirt-samples")

s("rave")
  .begin("<0 0.25 0.5 0.75>")
  .fast(2)`},{id:"sampler-end",label:"end",description:"Cut the tail of the sample instead of the beginning.",tooltip:"Same as .begin but trims from the end (1 = full sample, 0.5 = half length).",pattern:`s("bd*2,oh*4")
  .end("<0.1 0.2 0.5 1>")
  .fast(2)`},{id:"sampler-loop",label:"loop",description:"Keep a sample looping regardless of the cycle length.",tooltip:"Enable sustained looping (1 = on) — tempo is free-running.",pattern:`s("casio")
  .loop(1)`},{id:"sampler-loopBegin",label:"loopBegin",description:"Set the point inside the sample where looping starts.",tooltip:"Choose the loop start within 0–1 of the file; must be before loopEnd.",pattern:`s("space").loop(1)
  .loopBegin("<0 0.125 0.25>")
  ._scope()`},{id:"sampler-loopEnd",label:"loopEnd",description:"Set the point inside the sample where looping ends.",tooltip:"Choose the loop end (0–1). Must be after loopBegin for a valid loop.",pattern:`s("space").loop(1)
  .loopEnd("<1 0.75 0.5 0.25>")
  ._scope()`},{id:"sampler-cut",label:"cut",description:"Use classic drum-machine style choke groups.",tooltip:"Samples in the same cut group (1 here) stop each other when they retrigger.",pattern:`s("[oh hh]*4")
  .cut(1)`},{id:"sampler-clip",label:"clip",description:"Shorten or lengthen the note duration without altering tempo.",tooltip:"Multiplies sustain by the factor; values <1 gate the sample early.",pattern:`note("c a f e")
  .s("piano")
  .clip("<0.5 1 2>")
  .legato(1)`},{id:"sampler-loopAt",label:"loopAt",description:"Time-stretch samples to a specific number of cycles.",tooltip:"Stretches/compresses playback so the loop fits exactly 2 cycles.",pattern:`samples({
  "rhodes": "https://cdn.freesound.org/previews/132/132051_316502-lq.mp3"
})

s("rhodes").loopAt(2)`},{id:"sampler-fit",label:"fit",description:"Resize a sample to the length of each event.",tooltip:"Fits every triggered slice to its event duration — great for breakbeats.",pattern:`samples({
  "rhodes": "https://cdn.freesound.org/previews/132/132051-lq.mp3"
})

s("rhodes/2")
  .fit()`},{id:"sampler-chop",label:"chop",description:"Split samples into equal slices for granular tricks.",tooltip:"Cuts each hit into 4 tiny grains, then reorders/repeats them in two cycles.",pattern:`samples({
  "rhodes": "https://cdn.freesound.org/previews/132/132051-lq.mp3"
})

s("rhodes")
  .chop(4)
  .rev()
  .loopAt(2)`},{id:"sampler-striate",label:"striate",description:"Sequentially scan through chunks of each sample.",tooltip:"Each trigger jumps forward through 6 slices of the source file.",pattern:`s("numbers:0 numbers:1 numbers:2")
  .striate(6)
  .slow(3)`},{id:"sampler-slice",label:"slice",description:"Address slices explicitly using indexes or fractional lists.",tooltip:"Divide the file into slices and trigger them via patterns or fractional lists.",pattern:`samples("github:tidalcycles/dirt-samples")

s("breaks165")
  .slice(8, "0 1 <2 2*2> 3 [4 0] 5 6 7")
  .slow(0.75)

s("breaks125")
  .fit()
  .slice([0, 0.25, 0.5, 0.75], "0 1 1 <2 3>")`},{id:"sampler-splice",label:"splice",description:"Slice like .slice but time-stretches to match step length.",tooltip:"Each slice is warped to fill its step, so rhythms stay tight.",pattern:`samples("github:tidalcycles/dirt-samples")

s("breaks165")
  .splice(8, "0 1 [2 3 0]@2 3 0@2 7")`},{id:"sampler-scrub",label:"scrub",description:"Manually scrub through audio (great for granular tape FX).",tooltip:"Supply 0–1 positions (optionally with :speed) to scrub through the waveform.",pattern:`samples("github:switchangel/pad")
s("swpad:0")
  .scrub("{0.1!2 0.25@3 0.7!2 <0.8:1.5>}%8")

samples("github:yaxu/clean-breaks/main")
s("amen/4")
  .fit()
  .scrub(pattern("{0@3 0@2 4@3}%8").div(16))`},{id:"sampler-speed",label:"speed",description:"Pitch-shift or reverse by changing playback speed.",tooltip:"Positive speeds raise the pitch; negatives play the sample backwards.",pattern:`s("bd*6")
  .speed("1 2 4 1 -2 -4")

speed("1 1.5*2 [2 1.1]")
  .s("piano")
  .clip(1)`}].map(n=>({...n,editorBadge:"Code"}));Ky.forEach(n=>{n.editorBadge||(n.editorBadge="Code")});const dc=[{id:"song-acidic-tooth",label:'Song · "acidic tooth" @by eddyflux',pattern:`// "acidic tooth" @by eddyflux
// @version 1.0

setcps(1)

stack(

  /* Channel 1 */
  stack(
    s("bd*2").mask("<0@4 1@16>"),
    s("hh*8").gain(saw.mul(saw.fast(2))).clip(sine)
    .mask("<0@8 1@16>")
  ).bank('RolandTR909')

  ,

  /* Channel 2 */
  note("[<g1 f1>/8](<3 5>,8)")
  .clip(perlin.range(.15,1.5))
  .release(.1)
  .s("sawtooth")
  .lpf(sine.range(400,800).slow(16))
  .lpq(cosine.range(6,14).slow(3))
  .lpenv(sine.mul(4).slow(4))
  .lpd(.2).lpa(.02)
  .ftype('24db')
  .rarely(add(note(12)))
  .room(.2).shape(.3).postgain(.5)
  .superimpose(x=>x.add(note(12)).delay(.5).bpf(1000))
  .gain("[.2 1@3]*2") // fake sidechain

)`.trim()}],Km=new URL("./assets/samples/voice/Strudesk4000_de.mp3",document.baseURI).href;let ii=null;const Jm=25,eg=25,tg="strudel_channel_history:",fc="strudel_master_history",ha={get(n){try{return window.localStorage.getItem(n)}catch(e){return console.warn("Pattern history storage get failed:",e),null}},set(n,e){try{window.localStorage.setItem(n,e)}catch(t){console.warn("Pattern history storage set failed:",t)}}},Wn=(()=>{const n=new Map;let e=null;const t=u=>{if(!u)return[];try{const h=JSON.parse(u);return Array.isArray(h)?h:[]}catch{return[]}},i=(u,h)=>{ha.set(u,JSON.stringify(h))};return{saveChannelVersion:(u,h)=>{const d=(h||"").trim();if(!u||!d||n.get(u)===d)return;const f=`${tg}${u}`;let m=t(ha.get(f));if(m.length&&m[0].pattern===d){n.set(u,d);return}const g={id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,pattern:d,createdAt:Date.now()};m.unshift(g),m.length>Jm&&(m=m.slice(0,Jm)),i(f,m),n.set(u,d)},getChannelVersions:u=>u?t(ha.get(`${tg}${u}`)):[],markChannelSnapshot:(u,h)=>{u&&n.set(u,(h||"").trim())},saveMasterVersion:u=>{const h=(u||"").trim();if(!h||h===e){e=h;return}let d=t(ha.get(fc));if(d.length&&d[0].pattern===h){e=h;return}const f={id:`${Date.now()}-${Math.random().toString(36).slice(2,8)}`,pattern:h,createdAt:Date.now()};d.unshift(f),d.length>eg&&(d=d.slice(0,eg)),i(fc,d),e=h},getMasterVersions:()=>t(ha.get(fc)),markMasterSnapshot:u=>{e=(u||"").trim()}}})();window.__patternHistory=Wn;const XM=()=>{const n=document.getElementById("pattern-history-modal");if(!n)return{openChannelHistory:()=>{},openMasterHistory:()=>{},close:()=>{}};const e=document.getElementById("pattern-history-title"),t=document.getElementById("pattern-history-list"),i=document.getElementById("pattern-history-tabs"),s=document.getElementById("pattern-history-close");let r=null,a=[],o="local";const l=b=>b.replace(/[&<>"']/g,P=>{switch(P){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#039;";default:return P}}),c=b=>{try{return new Date(b).toLocaleString()}catch{return""}},u=()=>{n.classList.remove("is-open"),n.setAttribute("aria-hidden","true"),r=null,a=[]},h=()=>{n.classList.add("is-open"),n.setAttribute("aria-hidden","false")},d=(b,P={})=>{const{includeMasterSongs:k=!1,isCloudPatterns:w=!1}=P,C=document.createDocumentFragment();if(Array.isArray(b)&&b.length>0)b.forEach((A,Q)=>{const q=document.createElement("div");q.className="pattern-history-entry";let W=A.patternCode||A.pattern||"";const U=W.length>240?`${W.slice(0,240)}…`:W,Z=(Q+1).toString().padStart(2,"0");let Y=c(A.createdAt);if(w){const ne=[];A.title&&ne.push(`"${A.title}"`),A.artistName&&ne.push(`by ${A.artistName}`),A.version&&ne.push(`v${A.version}${A.versionName?` (${A.versionName})`:""}`),A.userCount>0&&ne.push(`${A.userCount} user${A.userCount>1?"s":""}`),ne.length>0&&(Y=ne.join(" • "))}q.innerHTML=`
          <div class="pattern-history-meta">
            <span class="pattern-history-index">#${Z}</span>
            <p class="pattern-history-date">${l(Y)}</p>
          </div>
          <pre class="pattern-history-snippet">${l(U)}</pre>
          <div class="pattern-history-actions">
            <button type="button" class="pattern-history-load" data-version-id="${A.id}" data-is-cloud="${w}">Load</button>
          </div>
        `,C.appendChild(q)});else{const A=document.createElement("p");A.className="pattern-history-empty",A.textContent="No saved versions yet.",C.appendChild(A)}if(k&&dc.length&&o==="local"){const A=document.createElement("h4");A.className="pattern-history-section-title",A.textContent="Songs",C.appendChild(A),dc.forEach((Q,q)=>{const W=document.createElement("div");W.className="pattern-history-entry pattern-history-entry--song";const U=Q.pattern.length>400?`${Q.pattern.slice(0,400)}…`:Q.pattern,Z=(q+1).toString().padStart(2,"0");W.innerHTML=`
          <div class="pattern-history-meta">
            <span class="pattern-history-index">#${Z}</span>
            <p class="pattern-history-date">${l(Q.label)}</p>
          </div>
          <pre class="pattern-history-snippet">${l(U)}</pre>
          <div class="pattern-history-actions">
            <button type="button" class="pattern-history-load" data-song-id="${Q.id}">Load</button>
          </div>
        `,C.appendChild(W)})}t.innerHTML="",t.appendChild(C)};t.addEventListener("click",async b=>{const P=b.target.closest(".pattern-history-load");if(!P||!ii)return;const k=P.dataset.versionId,w=P.dataset.songId,C=P.dataset.isCloud==="true";if(w&&(r==null?void 0:r.type)==="master"){const Q=dc.find(q=>q.id===w);if(!Q)return;ii.applyMasterHistoryEntry(Q.pattern),u();return}let $=a.find(Q=>Q.id===k);if(C&&$)try{const{patternsAPI:Q}=await Jt(async()=>{const{patternsAPI:W}=await Promise.resolve().then(()=>ns);return{patternsAPI:W}},void 0);$=await Q.getPattern(k)}catch(Q){console.error("Error loading cloud pattern:",Q),alert("Failed to load pattern");return}if(!$)return;const A=$.patternCode||$.pattern;A&&((r==null?void 0:r.type)==="channel"?ii.applyChannelHistoryEntry(r.elementId,A):(r==null?void 0:r.type)==="master"&&ii.applyMasterHistoryEntry(A),u())}),s==null||s.addEventListener("click",u),n.addEventListener("click",b=>{b.target===n&&u()});const f=async(b,P=null)=>{try{const{patternsAPI:k,getCurrentUser:w}=await Jt(async()=>{const{patternsAPI:Q,getCurrentUser:q}=await Promise.resolve().then(()=>ns);return{patternsAPI:Q,getCurrentUser:q}},void 0),C=await w();if(!C)return[];const $={type:b};let A=[];return o==="my-patterns"?(A=await k.getPatterns({type:b,isPublic:!1}),A=A.filter(Q=>Q.userId===C.id)):o==="public"?A=await k.getPatterns({type:b,isPublic:!0}):o==="shared"&&(A=await k.getPatterns({type:b,shared:!0})),A}catch(k){return console.error("Error loading cloud patterns:",k),[]}},m=async b=>{if(o=b,i&&i.querySelectorAll(".pattern-history-tab").forEach(P=>{P.classList.toggle("active",P.dataset.tab===b)}),t.innerHTML='<p class="pattern-history-empty">Loading…</p>',b==="local")(r==null?void 0:r.type)==="channel"?(a=Wn.getChannelVersions(r.elementId),d(a)):(r==null?void 0:r.type)==="master"&&(a=Wn.getMasterVersions(),d(a,{includeMasterSongs:!0}));else{const P=await f((r==null?void 0:r.type)||"master",r==null?void 0:r.elementId);a=P,d(P,{isCloudPatterns:!0})}},g=async b=>{if(!b)return;r={type:"channel",elementId:b},e.textContent=`${er(b)} history`,h();const{getCurrentUser:P}=await Jt(async()=>{const{getCurrentUser:w}=await Promise.resolve().then(()=>ns);return{getCurrentUser:w}},void 0),k=await P();i&&(i.style.display=k?"flex":"none"),t.innerHTML='<p class="pattern-history-empty">Loading…</p>',o="local",a=Wn.getChannelVersions(b),d(a)},y=async()=>{r={type:"master"},e.textContent="Master history",h();const{getCurrentUser:b}=await Jt(async()=>{const{getCurrentUser:k}=await Promise.resolve().then(()=>ns);return{getCurrentUser:k}},void 0),P=await b();i&&(i.style.display=P?"flex":"none"),t.innerHTML='<p class="pattern-history-empty">Loading…</p>',o="local",a=Wn.getMasterVersions(),d(a,{includeMasterSongs:!0})};return i&&i.addEventListener("click",b=>{const P=b.target.closest(".pattern-history-tab");P&&m(P.dataset.tab)}),{openChannelHistory:g,openMasterHistory:y,close:u}};let Xo=null;const UM=n=>{var s,r;if(!Xo)return;const e=n.target.closest("[data-history-save]");if(e){n.preventDefault();const a=e.dataset.historySave;if(a==="channel"){const o=e.closest(".sound-element"),l=o==null?void 0:o.getAttribute("data-sound-id");l&&ii&&((s=ii.saveChannelWithEffects)==null||s.call(ii,l))}else a==="master"&&ii&&((r=ii.saveMasterHistoryEntry)==null||r.call(ii));return}const t=n.target.closest('[data-history-target="channel"]');if(t){n.preventDefault();const a=t.closest(".sound-element"),o=a==null?void 0:a.getAttribute("data-sound-id");o&&Xo.openChannelHistory(o);return}n.target.closest("#load-master-history-btn")&&(n.preventDefault(),Xo.openMasterHistory())},ng=()=>{Xo=XM(),document.addEventListener("click",UM)},pc=[{key:"bd",label:"BD",sample:"bd"},{key:"sn",label:"SN",sample:"sd"},{key:"hh",label:"HH",sample:"hh"}],qd={superpiano:"piano",wood:"jazz"},va=["sine","square","triangle","sawtooth","supersaw","pulse"],Er=["piano","supersaw","gtr","casio","jazz","metal","folkharp"],Jy=Object.keys(qd),YM=new Set([...va,...Er,...Jy]),HM=["note()","sound()","bank()","beat()","vowel()","chord()","voicing()","addVoicings()","gain()","adsr()","scale()","pan()","speed()","slow()","fast()","early()","late()","legato()","euclid()","euclidRot()","euclidLegato()","rev()","palindrome()","iter()","iterBack()","ply()","range()","rangex()","range2()","lpf()","lpa()","lpd()","lps()","lpq()","lpattack()","lpdecay()","lpsustain()","lprelease()","orbit()","postgain()","irand()","seg()","hpf()","hpq()","bpf()","bpg()","bpq()","fancor()","lpenv()","ftype()","attack()","decay()","sustain()","release()","tremolo()","resonance()","cutoff()","noise()","tremolosync()","tremoloskew()","tremolodepth()","tremolophase()","tremoloshape()","sometimes()","stack()","clip()","sub()","mul()","div()","floor()","ceil()","ratio()","as()","saw()","sine()","cosine()","tri()","square()","rand()","saw2()","sine2()","cosine2()","tri2()","square2()","rand2()","perlin()","brand()","brandBy()","mouseX()","mouseY()","choose()","wchoose()","chooseCycles()","wchooseCycles()","degradeBy()","degrade()","undegradeBy()","undegrade()","sometimesBy()","sometimes()","someCyclesBy()","someCycles()","often()","rarely()","almostNever()","almostAlways()","never()","always()","lastOf()","firstOf()","when()","chunk()","chunkBack()","fastChunk()","arp()","arpWith()","struct()","mask()","reset()","restart()","hush()","invert()","pick()","pickmod()","pickF()","pickmodF()","pickRestart()","pickmodRestart()","pickReset()","pickmodReset()","inhabit()","inhabitmod()","squeeze()","superimpose()","layer()","off()","echo()","echoWith()","transpose()","scaleTranspose()","rootNotes()","pace()","stepcat()","stepalt()","expand()","contract()","extend()","take()","drop()","polymeter()","shrink()","grow()","tour()","zip()","vib()","vibmod()","add()","anchor()","dict()","penv()","segment()","compress()","zoom()","linger()","fastGap()","inside()","outside()","cpm()","ribbon()","swingBy()","swing()","patt()","dec()","mode()","set()","struct()","pick()","pattack()","pdecay()","prelease()","pcurve()","panchor()","velocity()","fm()","fmh()","fmattack()","fmdecay()","fmsustain()","fmenv()","zrand()","curve()","slide()","deltaSlide()","zmod()","zcrush()","zdelay()","pitchJump()","pitchJumpTime()","lfo()","compressor()","control()","ccn()","ccv()","midimap()","midimaps()","defaultmidimap()","midi()","midiport()","midicmd()","midibend()","miditouch()","progNum()","sysex()","sysexid()","sysexdata()","osc()","mqtt()","xfade()","jux()","juxBy()","coarse()","crush()","distort()","delay()","delaytime()","delayfeedback()","room()","roomsize()","roomfade()","roomlp()","roomdim()","iresponse()","phaser()","phaserdepth()","phasercenter()","phasersweep()","duckorbit()","duckattack()","duckdepth()"],Uo=["stack()","vowel()","beat()","bank()","sound()","chord()","note()"],KM=['sound("sawtooth")','sound("square")','sound("triangle")','sound("sine")','sound("white")','sound("pink")','sound("brown")'],JM=["beat","chord","note","sound","stack"],e3=new Map([['sound("brown")',"pattern-snippet-tag-sound-brown"],['sound("pink")',"pattern-snippet-tag-sound-pink"],['sound("white")',"pattern-snippet-tag-sound-white"]]),t3=new Set(["core"]),n3=new Set(["filters-lp","filters-hp","filters-bp"]),i3=new Set(["filters-lp","filters-hp","filters-bp"]),da=new Map;function mc(n){return n<=20?0:n>=2e4?1:n<=100?(n-20)/80*.25:n<=500?.25+(n-100)/400*.25:n<=5e3?.5+(n-500)/4500*.3:.8+(n-5e3)/15e3*.2}function gc(n){return n<=0?20:n>=1?2e4:n<=.25?20+n/.25*80:n<=.5?100+(n-.25)/.25*400:n<=.8?500+(n-.5)/.3*4500:5e3+(n-.8)/.2*15e3}const Xi={lpf:{min:20,max:2e4,step:10,default:2e4,unit:"Hz"},hpf:{min:20,max:2e4,step:10,default:20,unit:"Hz"},bpf:{min:20,max:2e4,step:10,default:1e3,unit:"Hz"},lpq:{min:0,max:20,step:.1,default:0,unit:""},hpq:{min:0,max:20,step:.1,default:0,unit:""},bpq:{min:0,max:20,step:.1,default:0,unit:""},bpg:{min:-20,max:20,step:.1,default:0,unit:"dB"},attack:{min:0,max:2,step:.01,default:.01,unit:"s"},decay:{min:0,max:2,step:.01,default:.1,unit:"s"},sustain:{min:0,max:1,step:.01,default:.5,unit:""},release:{min:0,max:5,step:.01,default:.1,unit:"s"},lpattack:{min:0,max:2,step:.01,default:.01,unit:"s"},lpdecay:{min:0,max:2,step:.01,default:.1,unit:"s"},lpsustain:{min:0,max:1,step:.01,default:.5,unit:""},lprelease:{min:0,max:5,step:.01,default:.1,unit:"s"},hpattack:{min:0,max:2,step:.01,default:.01,unit:"s"},hpdecay:{min:0,max:2,step:.01,default:.1,unit:"s"},hpsustain:{min:0,max:1,step:.01,default:.5,unit:""},hprelease:{min:0,max:5,step:.01,default:.1,unit:"s"},bpattack:{min:0,max:2,step:.01,default:.01,unit:"s"},bpdecay:{min:0,max:2,step:.01,default:.1,unit:"s"},bpsustain:{min:0,max:1,step:.01,default:.5,unit:""},bprelease:{min:0,max:5,step:.01,default:.1,unit:"s"},bpenv:{min:0,max:1,step:.01,default:.5,unit:""},hpenv:{min:0,max:1,step:.01,default:.5,unit:""},pattack:{min:0,max:2,step:.01,default:.01,unit:"s"},pdecay:{min:0,max:2,step:.01,default:.1,unit:"s"},prelease:{min:0,max:5,step:.01,default:.1,unit:"s"},gain:{min:0,max:2,step:.01,default:.8,unit:""},postgain:{min:0,max:2,step:.01,default:1,unit:""},velocity:{min:0,max:1,step:.01,default:.5,unit:""},pan:{min:-1,max:1,step:.01,default:0,unit:""},slow:{min:.1,max:10,step:.1,default:2,unit:"x"},fast:{min:.1,max:10,step:.1,default:2,unit:"x"},early:{min:0,max:1,step:.01,default:.25,unit:""},late:{min:0,max:1,step:.01,default:.25,unit:""},delay:{min:0,max:1,step:.01,default:0,unit:""},delaytime:{min:0,max:1,step:.01,default:.25,unit:"s"},delayfeedback:{min:0,max:1,step:.01,default:.5,unit:""},room:{min:0,max:5,step:.01,default:0,unit:""},roomsize:{min:0,max:4,step:.01,default:.5,unit:""},roomfade:{min:0,max:1,step:.01,default:.5,unit:""},roomlp:{min:20,max:2e4,step:10,default:20,unit:"Hz"},roomdim:{min:0,max:1,step:.01,default:0,unit:""},iresponse:{min:0,max:1,step:.01,default:0,unit:""},phaser:{min:0,max:1,step:.01,default:0,unit:""},phaserdepth:{min:0,max:1,step:.01,default:.5,unit:""},phasercenter:{min:0,max:1,step:.01,default:.5,unit:""},phasersweep:{min:0,max:1,step:.01,default:.5,unit:""},duckattack:{min:0,max:2,step:.01,default:.01,unit:"s"},duckdepth:{min:0,max:1,step:.01,default:.5,unit:""},tremolo:{min:0,max:1,step:.01,default:0,unit:""},tremolodepth:{min:0,max:1,step:.01,default:.5,unit:""},tremoloskew:{min:0,max:1,step:.01,default:.5,unit:""},tremolophase:{min:0,max:1,step:.01,default:0,unit:""},resonance:{min:0,max:20,step:.1,default:0,unit:""},cutoff:{min:20,max:2e4,step:10,default:2e4,unit:"Hz"},speed:{min:.1,max:10,step:.1,default:1,unit:"x"},legato:{min:0,max:1,step:.01,default:0,unit:""},cpm:{min:60,max:300,step:1,default:120,unit:"BPM"}},$a=[{id:"core",order:0,label:"Core",heading:"Core",matcher:n=>["stack","beat","bank","sound"].includes(n),className:"snippet-group-core"},{id:"amplitude-modulation",order:1,label:"Amplitude Modulation",heading:"Amplitude Modulation",matcher:n=>["tremolo","tremolosync","tremolodepth","tremoloskew","tremolophase","tremoloshape"].includes(n),className:"snippet-group-amplitude-modulation"},{id:"amplitude-envelope",order:2,label:"Amplitude Envelope",heading:"Amplitude Envelope",matcher:n=>["attack","decay","sustain","release","adsr"].includes(n),className:"snippet-group-amplitude-envelope"},{id:"filter-envelope",order:3,label:"Filter Envelope",heading:"Filter Envelope",matcher:n=>["lpattack","lpdecay","lpsustain","lprelease","lpenv"].includes(n),className:"snippet-group-filter-envelope"},{id:"pitch-envelope",order:4,label:"Pitch Envelope",heading:"Pitch Envelope",matcher:n=>["pattack","pdecay","prelease","penv","pcurve","panchor"].includes(n),className:"snippet-group-pitch-envelope"},{id:"dynamics",order:5,label:"Dynamics",heading:"Dynamics",matcher:n=>["gain","velocity","compressor","postgain","xfade"].includes(n),className:"snippet-group-dynamics"},{id:"panning",order:6,label:"Panning",heading:"Panning",matcher:n=>["jux","juxby","pan"].includes(n),className:"snippet-group-panning"},{id:"waveshaping",order:7,label:"Waveshaping",heading:"Waveshaping",matcher:n=>["coarse","crush","distort"].includes(n),className:"snippet-group-waveshaping"},{id:"global-effects",order:8,label:"Global Effects",heading:"Global Effects",matcher:n=>["orbit"].includes(n),className:"snippet-group-global-effects"},{id:"delay",order:9,label:"Delay",heading:"Delay",matcher:n=>["delay","delaytime","delayfeedback"].includes(n),className:"snippet-group-delay"},{id:"reverb",order:10,label:"Reverb",heading:"Reverb",matcher:n=>["room","roomsize","roomfade","roomlp","roomdim","iresponse"].includes(n),className:"snippet-group-reverb"},{id:"phaser",order:11,label:"Phaser",heading:"Phaser",matcher:n=>["phaser","phaserdepth","phasercenter","phasersweep"].includes(n),className:"snippet-group-phaser"},{id:"duck",order:12,label:"Duck",heading:"Duck",matcher:n=>["duckorbit","duckattack","duckdepth"].includes(n),className:"snippet-group-duck"},{id:"filters-hp",order:5,label:"Filters · High-pass",heading:"Filters · High-pass",matcher:n=>n.startsWith("hp"),className:"snippet-group-filters-hp"},{id:"filters-bp",order:6,label:"Filters · Band-pass",heading:"Filters · Band-pass",matcher:n=>n.startsWith("bp"),className:"snippet-group-filters-bp"},{id:"filters-lp",order:7,label:"Filters · Low-pass",heading:"Filters · Low-pass",matcher:n=>n.startsWith("lp")||n==="ftype"||n==="vowel"||n==="applygraduallowpass",className:"snippet-group-filters-lp"},{id:"time",order:8,label:"Time Modifiers",heading:"Time Modifiers",matcher:n=>["slow","fast","early","late","clip","legato","euclid","euclidrot","euclidlegato","rev","palindrome","iter","iterback","ply","segment","compress","zoom","linger","fastgap","inside","outside","cpm","ribbon","swingby","swing"].includes(n),className:"snippet-group-time"},{id:"control-operators",order:9,label:"Control · Operators",heading:"Control Parameters · Operators",matcher:n=>["add","sub","mul","div","floor","ceil","range","rangex","range2","ratio","as"].includes(n),className:"snippet-group-controls"},{id:"signals",order:10,label:"Signals",heading:"Signals",matcher:n=>["saw","sine","cosine","tri","square","rand","saw2","sine2","cosine2","tri2","square2","rand2","perlin","irand","brand","brandby"].includes(n),className:"snippet-group-signals"},{id:"visual-feedback",order:11,label:"Visual Feedback",heading:"Visual Feedback",matcher:(n,e)=>{if(n==="color"||n==="markcss"||["fscope","generategraph","pianoroll","pitchwheel","scope","spiral","wordfall"].includes(n))return!0;if(!e||typeof e!="string")return!1;const t=e.toLowerCase();return t.includes("_punchcard")||t.includes("_pianoroll")||t.includes("_scope")||t.includes("_spiral")||t.includes("_pitchwheel")||t.includes("_spectrum")},className:"snippet-group-visual-feedback"},{id:"synths",order:12,label:"Synths",heading:"Synths",matcher:(n,e)=>n==="sound"?typeof e=="string"&&e.includes('sound("'):["decay","sustain","attack","release","cutoff","noise","vib","vibmod","fm","fmh","fmattack","fmdecay","fmsustain","fmenv","fmwave","zrand","curve","slide","deltaslide","zmod","zcrush","zdelay","pitchjump","pitchjumptime","lfo","tremolo","octave","pw","pwrate","pwsweep","spread","unison","isaw","isaw2","itri","itri2"].includes(n),className:"snippet-group-synths"},{id:"tonal",order:13,label:"Tonal Functions",heading:"Tonal Functions",matcher:n=>["voicing","voicings","addvoicings","scale","transpose","scaletranspose","rootnotes","chord","dict","anchor","mode","below","duck","above","offset","n","note"].includes(n),className:"snippet-group-tonal"},{id:"stepwise",order:14,label:"Stepwise Patterning",heading:"Stepwise Patterning",matcher:n=>["pace","stepcat","stepalt","expand","contract","extend","take","drop","polymeter","shrink","grow","tour","zip"].includes(n),className:"snippet-group-stepwise"},{id:"random",order:15,label:"Random Modifiers",heading:"Random Modifiers",matcher:n=>["choose","wchoose","choosecycles","wchoosecycles","degradeby","degrade","undegradeby","undegrade","sometimesby","sometimes","somecyclesby","somecycles","often","rarely","almostnever","almostalways","never","always"].includes(n),className:"snippet-group-random"},{id:"conditional",order:16,label:"Conditional Modifiers",heading:"Conditional Modifiers",matcher:n=>["lastof","firstof","when","chunk","chunkback","fastchunk","arp","arpwith","struct","mask","reset","restart","hush","invert","pick","pickmod","pickf","pickmodf","pickrestart","pickmodrestart","pickreset","pickmodreset","inhabit","inhabitmod","squeeze"].includes(n),className:"snippet-group-conditional"},{id:"accumulation",order:17,label:"Accumulation Modifiers",heading:"Accumulation Modifiers",matcher:n=>["superimpose","layer","off","echo","echowith"].includes(n),className:"snippet-group-accumulation"},{id:"midi",order:18,label:"MIDI",heading:"MIDI",matcher:n=>n.includes("midi")||n.startsWith("ccn")||n.startsWith("ccv")||n==="prognum"||n==="sysex"||n==="sysexid"||n==="sysexdata"||n==="control",className:"snippet-group-midi",exclude:["pianoroll"]},{id:"device",order:19,label:"Device Motion",heading:"Device Motion",matcher:n=>["orientation","acceleration","accelerate","accelerationx","accelerationy","accelerationz","rotationx","rotationy","rotationz","gravityx","gravityy","gravityz","mousex","mousey"].some(t=>n.includes(t)),className:"snippet-group-device"},{id:"external-communication",order:20,label:"External Communication",heading:"External Communication",matcher:n=>["osc","mqtt"].includes(n),className:"snippet-group-external-communication"},{id:"other",order:Number.MAX_SAFE_INTEGER,label:"Other",heading:"Other",matcher:()=>!0,className:"snippet-group-other"}],Do=$a.reduce((n,e)=>(n.set(e.id,e),n),new Map),s3={sound:["bank","note","chord","delay","room","phaser","gain","lpf","pan"],s:["bank","note","chord","delay","room","phaser","gain","lpf","pan"],note:["chord","scale","voicing","transpose","scaletranspose","rootnotes","attack","decay","release","lpf","gain","pan"],stack:["beat","sound","note","gain","pan"],beat:["sound","s","euclid","mask","slow","fast","rev","iter"],bank:["sound","s","gain","pan","slow","fast","euclid","mask","delay","room","crush","distort"],lpf:["lpenv","lpattack","lpdecay","lpsustain","lprelease","lpq","ftype","hpf","bpf","gain"],hpf:["hpattack","hpdecay","hpsustain","hprelease","hpq","lpf","bpf","gain"],bpf:["bpattack","bpdecay","bpsustain","bprelease","bpq","bpg","lpf","hpf","gain"],lpenv:["lpf","lpattack","lpdecay","lpsustain","lprelease","lpq"],lpattack:["lpf","lpenv","lpdecay","lpsustain","lprelease"],lpdecay:["lpf","lpenv","lpattack","lpsustain","lprelease"],lpsustain:["lpf","lpenv","lpattack","lpdecay","lprelease"],lprelease:["lpf","lpenv","lpattack","lpdecay","lpsustain"],lpq:["lpf","lpenv"],hpq:["hpf"],bpq:["bpf","bpg"],bpg:["bpf","bpq"],ftype:["lpf"],vowel:["lpf","ftype"],attack:["decay","sustain","release","adsr","gain","lpf"],decay:["attack","sustain","release","adsr","gain"],sustain:["attack","decay","release","adsr","gain"],release:["attack","decay","sustain","adsr","gain"],adsr:["attack","decay","sustain","release","gain"],pattack:["pdecay","prelease","penv","pcurve","panchor"],pdecay:["pattack","prelease","penv","pcurve"],prelease:["pattack","pdecay","penv","pcurve"],penv:["pattack","pdecay","prelease","pcurve","panchor"],pcurve:["penv","pattack","pdecay","prelease"],panchor:["penv","pattack"],delay:["delaytime","delayfeedback"],delaytime:["delay","delayfeedback"],delayfeedback:["delay","delaytime"],room:["roomsize","roomfade","roomlp","roomdim","iresponse"],roomsize:["room","roomfade","roomlp","roomdim"],roomfade:["room","roomsize","roomlp"],roomlp:["room","roomsize","roomfade"],roomdim:["room","roomsize"],iresponse:["room","roomsize"],phaser:["phaserdepth","phasercenter","phasersweep"],phaserdepth:["phaser","phasercenter","phasersweep"],phasercenter:["phaser","phaserdepth","phasersweep"],phasersweep:["phaser","phaserdepth","phasercenter"],duckorbit:["duckattack","duckdepth"],duckattack:["duckorbit","duckdepth"],duckdepth:["duckorbit","duckattack"],gain:["velocity","compressor","postgain","pan","delay","room"],velocity:["gain","attack","decay"],compressor:["gain","postgain"],postgain:["gain","compressor"],xfade:["gain"],pan:["jux","juxby","gain"],jux:["juxby","pan"],juxby:["jux","pan"],crush:["distort","coarse","gain"],distort:["crush","coarse","gain"],coarse:["crush","distort"],slow:["fast","early","late","clip","legato","swing"],fast:["slow","early","late","clip","legato"],early:["late","slow","fast","clip"],late:["early","slow","fast","clip"],clip:["slow","fast","legato","early","late"],legato:["clip","early","late","slow","fast"],euclid:["euclidrot","euclidlegato","mask","beat","slow","fast"],euclidrot:["euclid","euclidlegato","mask"],euclidlegato:["euclid","euclidrot","mask"],rev:["palindrome","iter","iterback"],palindrome:["rev","iter","iterback"],iter:["iterback","rev","palindrome"],iterback:["iter","rev","palindrome"],ply:["segment","compress","zoom"],segment:["ply","compress","zoom","ribbon"],compress:["ply","segment"],zoom:["linger","fastgap","ply","segment"],linger:["zoom","fastgap"],fastgap:["zoom","linger"],inside:["outside","clip"],outside:["inside","clip"],swing:["swingby","cpm","slow","fast"],swingby:["swing","cpm"],cpm:["swing","swingby"],ribbon:["segment","ply"],add:["sub","mul","div","range","rangex"],sub:["add","mul","div","range"],mul:["add","sub","div","range"],div:["add","sub","mul","range"],range:["rangex","range2","add","sub","mul"],rangex:["range","range2"],range2:["range","rangex"],floor:["ceil","ratio"],ceil:["floor","ratio"],ratio:["floor","ceil"],as:["range"],saw:["sine","tri","square","rand","range"],sine:["saw","cosine","tri","square","range"],cosine:["sine","saw","tri","square"],tri:["saw","sine","square","rand"],square:["saw","sine","tri","rand"],rand:["saw","sine","tri","square","irand","brand"],saw2:["sine2","tri2","square2","rand2"],sine2:["saw2","cosine2","tri2","square2"],cosine2:["sine2","saw2","tri2","square2"],tri2:["saw2","sine2","square2","rand2"],square2:["saw2","sine2","tri2","rand2"],rand2:["saw2","sine2","tri2","square2"],perlin:["rand","brand","range"],irand:["rand","brand"],brand:["rand","irand","brandby"],brandby:["brand"],chord:["voicing","addvoicings","scale","transpose","scaletranspose","rootnotes","dict","mode","note"],voicing:["chord","addvoicings","scale","transpose","note"],addvoicings:["voicing","chord"],scale:["chord","voicing","transpose","scaletranspose","rootnotes","dict","mode","note"],transpose:["scale","scaletranspose","chord","note","offset"],scaletranspose:["scale","transpose","chord"],rootnotes:["scale","chord","transpose"],dict:["chord","scale","note"],anchor:["penv","pcurve","panchor","scale"],mode:["scale","chord","note"],below:["above","note","chord"],above:["below","note","chord"],offset:["transpose","scale","note"],n:["note","chord","scale","voicing","transpose"],cutoff:["lpf","resonance","lpenv"],resonance:["cutoff","lpf","lpq"],noise:["sound","cutoff","lpf"],vib:["vibmod","tremolo"],vibmod:["vib"],fm:["fmh","fmattack","fmdecay","fmsustain","fmenv","fmwave"],fmh:["fm","fmattack","fmdecay"],fmattack:["fm","fmdecay","fmsustain","fmenv"],fmdecay:["fm","fmattack","fmsustain","fmenv"],fmsustain:["fm","fmattack","fmdecay","fmenv"],fmenv:["fm","fmattack","fmdecay","fmsustain"],fmwave:["fm"],zrand:["rand","brand"],curve:["slide","deltaslide"],slide:["curve","deltaslide"],deltaslide:["slide","curve"],zmod:["vib","vibmod"],zcrush:["crush","distort"],zdelay:["delay","delaytime"],pitchjump:["pitchjumptime","penv"],pitchjumptime:["pitchjump"],lfo:["tremolo","vib"],octave:["transpose","note"],pw:["pwrate","pwsweep"],pwrate:["pw","pwsweep"],pwsweep:["pw","pwrate"],spread:["unison","pan"],unison:["spread"],isaw:["isaw2","itri","itri2"],isaw2:["isaw","itri","itri2"],itri:["isaw","isaw2","itri2"],itri2:["isaw","isaw2","itri"],tremolo:["tremolosync","tremolodepth","tremoloskew","tremolophase","tremoloshape","lfo"],tremolosync:["tremolo","tremolodepth"],tremolodepth:["tremolo","tremolosync"],tremoloskew:["tremolo","tremolophase"],tremolophase:["tremolo","tremoloshape"],tremoloshape:["tremolo","tremolophase"],choose:["wchoose","sometimes","rarely"],wchoose:["choose","sometimes"],choosecycles:["wchoosecycles","somecycles"],wchoosecycles:["choosecycles","somecycles"],degradeby:["degrade","sometimes"],degrade:["degradeby","sometimes"],undegradeby:["undegrade"],undegrade:["undegradeby"],sometimesby:["sometimes","rarely","often"],sometimes:["sometimesby","rarely","often","choose"],somecyclesby:["somecycles","choosecycles"],somecycles:["somecyclesby","choosecycles"],often:["sometimes","rarely","almostalways"],rarely:["sometimes","often","almostnever"],almostnever:["rarely","never"],almostalways:["often","always"],never:["almostnever"],always:["almostalways"],lastof:["firstof","when","mask"],firstof:["lastof","when","mask"],when:["lastof","firstof","mask","struct"],chunk:["chunkback","fastchunk","mask","struct"],chunkback:["chunk","fastchunk","mask"],fastchunk:["chunk","chunkback","mask"],arp:["arpwith","chord","voicing","note"],arpwith:["arp","chord"],struct:["mask","pick","when","beat"],mask:["struct","when","euclid","beat","chunk"],reset:["restart","pickreset"],restart:["reset","pickrestart"],hush:["silence"],invert:["rev","palindrome"],pick:["pickmod","pickf","pickmodf","struct","mask"],pickmod:["pick","pickmodf","struct"],pickf:["pick","pickmodf","struct"],pickmodf:["pick","pickf","struct"],pickrestart:["pickmodrestart","restart"],pickmodrestart:["pickrestart"],pickreset:["pickmodreset","reset"],pickmodreset:["pickreset"],inhabit:["inhabitmod","mask","struct"],inhabitmod:["inhabit","mask"],squeeze:["compress","segment"],superimpose:["layer","off","echo"],layer:["superimpose","off"],off:["superimpose","layer"],echo:["echowith","delay","superimpose"],echowith:["echo"],pace:["stepcat","stepalt","polymeter","slow","fast"],stepcat:["pace","stepalt","polymeter"],stepalt:["pace","stepcat"],expand:["contract","extend","take","drop"],contract:["expand","extend","take","drop"],extend:["expand","contract","take","drop"],take:["drop","extend","expand","contract"],drop:["take","extend","expand","contract"],polymeter:["pace","stepcat","slow","fast"],shrink:["grow","compress"],grow:["shrink","expand"],tour:["zip","iter"],zip:["tour","iter"],orientation:["acceleration","rotationx","rotationy","rotationz"],acceleration:["accelerationx","accelerationy","accelerationz","gravityx","gravityy","gravityz"],accelerate:["acceleration"],accelerationx:["accelerationy","accelerationz","gravityx"],accelerationy:["accelerationx","accelerationz","gravityy"],accelerationz:["accelerationx","accelerationy","gravityz"],rotationx:["rotationy","rotationz","orientation"],rotationy:["rotationx","rotationz","orientation"],rotationz:["rotationx","rotationy","orientation"],gravityx:["gravityy","gravityz","accelerationx"],gravityy:["gravityx","gravityz","accelerationy"],gravityz:["gravityx","gravityy","accelerationz"],mousex:["mousey","pan","range"],mousey:["mousex","gain","range"],osc:["mqtt"],mqtt:["osc"],midi:["midiport","midicmd","midibend","miditouch"],midiport:["midi"],midicmd:["midi"],midibend:["midi","miditouch"],miditouch:["midi","midibend"],midimap:["midimaps","defaultmidimap"],midimaps:["midimap","defaultmidimap"],defaultmidimap:["midimap","midimaps"],ccn:["ccv","control"],ccv:["ccn","control"],control:["ccn","ccv"],prognum:["midi"],sysex:["sysexid","sysexdata"],sysexid:["sysex","sysexdata"],sysexdata:["sysex","sysexid"],orbit:["duckorbit","pan"],scope:["fscope","pianoroll","spiral"],fscope:["scope","pianoroll"],pianoroll:["scope","fscope"],spiral:["scope"],pitchwheel:["penv"],color:["markcss"],markcss:["color"],vowel:["ftype","lpf"],speed:["slow","fast"],seg:["segment"],fancor:["lpf"],patt:["struct"],dec:["decay"],set:["struct"],irand:["rand","brand"]};function $i(n){if(!n||typeof n!="string")return"";const e=n.replace(/^[.]+/,""),t=e.match(/^([a-zA-Z0-9_]+)/);return(t?t[1]:e).toLowerCase()}function Oc(n){if(!n||typeof n!="string")return!1;if(Uo.includes(n))return!0;const e=n.toLowerCase();return JM.some(t=>{const i=`.${t}`,s=`${t}(`;return e.includes(i)||e.includes(s)})}function yc(n){if(!n||typeof n!="string")return"";const e=n.replace(/^[.]+/,"").toLowerCase();for(const[t,i]of e3.entries()){const s=t.toLowerCase();if(e===s||e.includes(s))return i}return""}function jh(n){const e=document.createElement("div");return e.innerHTML=n||"",(e.textContent||e.innerText||"").trim()}let bc=null,Mo=null;async function qh(){return Mo||(bc||(bc=Jt(()=>import("./index-CuqbEPxt.js"),[]).then(n=>{var i;const e=((i=n==null?void 0:n.reference)==null?void 0:i.docs)||{},t=new Map;for(const s of Object.values(e)){if(!s||!s.name)continue;const r=s.name.trim().toLowerCase();if(!r||t.has(r))continue;const a=Array.isArray(s.params)?s.params.map(o=>{var l;return{name:(o==null?void 0:o.name)||"",types:Array.isArray((l=o==null?void 0:o.type)==null?void 0:l.names)?o.type.names.slice():[],description:jh((o==null?void 0:o.description)||"")}}):[];t.set(r,{name:s.name.trim(),descriptionHtml:s.description||"",descriptionText:jh(s.description||""),params:a})}return t}).catch(n=>(console.warn("⚠️ Unable to load Strudel reference docs:",n),new Map))),Mo=await bc,Mo)}function vc(n){return n?(typeof n.descriptionText=="string"||(n.descriptionText=jh(n.descriptionHtml||"")),n.descriptionText):""}function eb(n){if(!n)return null;const e=n.toLowerCase(),t=e.match(/between\s+([-\d.]+)\s+and\s+([-\d.]+)/);if(t)return`${t[1]}-${t[2]}`;const i=e.match(/([-\d.]+)\s*-\s*([-\d.]+)/);return i?`${i[1]}-${i[2]}`:null}function r3(n){if(!n)return"";const e=n.name||"value",t=n.types||[],i=n.description||"",s=eb(i);return t.includes("number")?s?`${e}:${s}`:`${e}:number`:t.includes("string")?`${e}`:t.includes("Pattern")?`${e}:pattern`:e}function Sc(n){if(!n)return"";const e=n.name||"value",t=n.types||[],i=n.description||"",s=eb(i);return t.includes("number")?s?`${e} (number ${s})`:`${e} (number)`:t.includes("string")?`${e} (string)`:t.includes("Pattern")?`${e} (pattern)`:i?`${e} (${i})`:e}function ig(n,e){if(!n||typeof n!="string"||!n.endsWith("()"))return n;const t=(e==null?void 0:e.params)||[];if(!t.length)return n;const i=t.map(r3).filter(Boolean);return i.length?`${n.slice(0,-1)}${i.join(", ")})`:n}let Cn=null,gs=null,sg=!1;function a3(){if(Cn&&document.body.contains(Cn))return Cn;if(Cn=document.createElement("div"),Cn.id="pattern-snippet-tooltip",Cn.className="pattern-snippet-tooltip",Cn.setAttribute("role","tooltip"),Cn.setAttribute("aria-hidden","true"),document.body.appendChild(Cn),!sg){sg=!0;const n=()=>Gn();window.addEventListener("scroll",n,!0),window.addEventListener("resize",n,{passive:!0}),document.addEventListener("keydown",e=>{e.key==="Escape"&&Gn()},!0)}return Cn}function Gn(n=gs){Cn&&(Cn.classList.remove("visible"),Cn.style.display="none",Cn.style.visibility="hidden",Cn.innerHTML="",Cn.setAttribute("aria-hidden","true"),n&&n instanceof HTMLElement&&n.removeAttribute("aria-describedby"),gs&&gs!==n&&gs.removeAttribute("aria-describedby"),gs=null)}function wc(n){if(!n||!(n instanceof HTMLElement)||!document.body.contains(n))return;const e=a3();gs&&gs!==n&&Gn(gs);const t=n.dataset.tooltipTitle||n.textContent||"",i=n.dataset.tooltipDescription||"",s=n.dataset.tooltipParams||"";if(e.innerHTML="",t){const f=document.createElement("div");f.className="pattern-snippet-tooltip-title",f.textContent=t,e.appendChild(f)}if(i){const f=document.createElement("div");f.className="pattern-snippet-tooltip-body",i.split(`
`).forEach((m,g)=>{const y=m.trim();y&&(g>0&&f.appendChild(document.createElement("br")),f.appendChild(document.createTextNode(y)))}),f.childNodes.length>0&&e.appendChild(f)}if(s){const f=document.createElement("div");f.className="pattern-snippet-tooltip-params",s.split(`
`).forEach(m=>{const g=m.trim();if(!g)return;const y=document.createElement("div");y.textContent=g,f.appendChild(y)}),f.childElementCount>0&&e.appendChild(f)}e.style.display="block",e.style.visibility="hidden",e.classList.remove("visible");const r=n.getBoundingClientRect(),a=window.innerWidth||document.documentElement.clientWidth||0,o=window.innerHeight||document.documentElement.clientHeight||0,l=e.getBoundingClientRect(),c=8;let u=r.bottom+c;if(u+l.height>o-12){const f=r.top-l.height-c;f>=12?u=f:u=Math.max(12,o-l.height-12)}let h=r.left+r.width/2-l.width/2;const d=a-l.width-12;h>d&&(h=d),h<12&&(h=12),e.style.left=`${Math.round(h)}px`,e.style.top=`${Math.round(u)}px`,e.style.visibility="visible",e.classList.add("visible"),e.setAttribute("aria-hidden","false"),e.id||(e.id="pattern-snippet-tooltip"),n.setAttribute("aria-describedby",e.id),gs=n}let Pc=null,xc=null,rg="",Cc=null;function tb(n){return!n||typeof n!="string"?"":n.replace(/\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").replace(/\s+/g," ").trim()}function o3(n,e){if(!e)return n;const t=tb(e),i=new Set((t.match(/\.[a-zA-Z_][a-zA-Z0-9_]*/g)||[]).map(s=>$i(s)));return n.filter(s=>{const r=$i(s);return Xi[r]?!0:!i.has(r)})}async function ag(n=""){const e=tb(n);if(e===rg&&Cc)return Cc;xc||(Pc||(Pc=(async()=>{const r=new Map;HM.forEach(g=>{const y=$i(g);!r.has(y)&&g&&r.set(y,g)});const a=await qh();a.forEach((g,y)=>{r.has(y)||/^[a-z][\w]*$/i.test(g.name)&&r.set(y,`${g.name}()`)});const o=$a.reduce((g,y)=>(g.set(y.id,{snippets:[]}),g),new Map),l=new Set(Uo.map(g=>$i(g))),c=new Map;Array.from(r.entries()).sort((g,y)=>g[0].localeCompare(y[0])).forEach(([g,y])=>{const b=a.get(g),P=$a.find(w=>w.exclude&&w.exclude.includes(g)?!1:w.matcher(g,y,b))||Do.get("other"),k=o.get(P.id);k&&k.snippets.push({snippet:y,groupId:P.id,className:P.className,heading:P.heading}),l.has(g)&&c.set(g,{snippet:y,groupId:P.id,className:P.className,heading:P.heading})});const u=Uo.map(g=>{const y=$i(g);return c.get(y)||{snippet:g,groupId:"core",className:Do.get("core").className,heading:Do.get("core").heading}}).filter(Boolean).sort((g,y)=>g.snippet.localeCompare(y.snippet)),h=[],d=new Set;u.forEach(g=>{const{snippet:y,groupId:b,className:P,heading:k}=g;h.push({snippet:y,groupId:b,className:P,heading:k})}),[...$a].sort((g,y)=>g.heading.localeCompare(y.heading)).forEach(g=>{const y=o.get(g.id);!y||!y.snippets.length||(d.has(g.id)||d.add(g.id),y.snippets.slice().sort((b,P)=>b.snippet.localeCompare(P.snippet)).forEach(({snippet:b,className:P,heading:k})=>{Uo.includes(b)||h.push({snippet:b,groupId:g.id,className:P,heading:k})}))});const m=Do.get("synths");return m&&KM.forEach(g=>{h.some(y=>y.snippet===g)||h.push({snippet:g,groupId:m.id,className:m.className,heading:m.heading})}),xc=h,h})()),await Pc);const t=xc||[],i=o3(t.map(r=>r.snippet),e),s=t.filter(r=>i.includes(r.snippet));return rg=e,Cc=s,s}function To(n){if(!n||typeof n!="string")return n;const e=n.trim();return qd[e.toLowerCase()]||e}function Ac(n){if(!n||typeof n!="string")return n;let e=n;for(const[t,i]of Object.entries(qd)){const s=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),r=new RegExp(`(\\.s\\(["'])${s}(["']\\))`,"gi");e=e.replace(r,(o,l,c)=>`${l}${i}${c}`);const a=new RegExp(`(sound\\(["'])${s}(["']\\))`,"gi");e=e.replace(a,(o,l,c)=>`${l}${i}${c}`)}return e}function og(n){if(!n||typeof n!="string")return!1;for(const e of YM){const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");if(new RegExp(`\\.s\\(["']${t}["']\\)`,"i").test(n))return!0}return/\b(note|n)\s*\(/.test(n)}function l3(n){if(!n||typeof n!="string")return"";const e=n.trim();if(!e)return"";if(e.includes("sound(")||e.includes("s(")||jn(e))return e;const t=e.split(/\s+/).filter(a=>a.trim()),i=[],s=[];for(const a of t)if(a)if(a.startsWith("."))s.push(a);else{const o=a.split("(")[0].trim();o&&(Yy.hasOwnProperty(o.toLowerCase())||o.length>0)&&i.push(o)}if(i.length===0)return e;let r=`sound("${i.join(" ")}")`;return s.length>0&&(r+=s.join("")),r}function ki(n){let e=4,t=4;if(typeof n=="string"&&n.includes("/")){const[a,o]=n.split("/"),l=parseInt(a,10),c=parseInt(o,10);Number.isFinite(l)&&l>0&&(e=l),Number.isFinite(c)&&c>0&&(t=c)}const i=16/t,s=Math.max(1,Math.round(i)),r=Math.max(e,1)*s;return{signature:`${e}/${t}`,numerator:e,denominator:t,stepsPerBeat:s,totalSteps:r}}const u3=(n,e,t,i)=>{const s=(n-90)*Math.PI/180;return[t+Math.cos(s)*e,i+Math.sin(s)*e]},lg=(n,e,t,i,s=0)=>{const r=(n+s)*360;return u3(r,e*n,t,i)};function ug(n,e){let{from:t=0,to:i=3,margin:s=40,cx:r=100,cy:a=100,rotate:o=0,thickness:l=s/2,color:c="#4c51bf",cap:u="round",stretch:h=1,fromOpacity:d=1,toOpacity:f=1}=e;t*=h,i*=h,o*=h,n.lineWidth=l,n.lineCap=u,n.strokeStyle=c,n.globalAlpha=d,n.beginPath();let[m,g]=lg(t,s,r,a,o);n.moveTo(m,g);const y=1/60;let b=t;for(;b<=i;){const[P,k]=lg(b,s,r,a,o);n.globalAlpha=(b-t)/(i-t)*f,n.lineTo(P,k),b+=y}n.stroke(),n.globalAlpha=1}class cg{constructor(){ii=this,this.activeElements=new Set,this.initialized=!1,this.currentEditingElementId=null,this.mutedElements=new Set,this.soloedElements=new Set,this.elementCounter=4,this.masterActive=!1,this.masterPatternField=null,this._applyingVisualizer=!1,this.elementEffects={},this.elementFilters={},this.elementSynthesis={},this.currentTimeSignature="4/4",this.currentTimeSignatureMetrics=ki(this.currentTimeSignature),this.masterPunchcardContainer=null,this.masterPunchcardHeaderNote=null,this.masterPunchcardCanvas=null,this.masterPunchcardCtx=null,this.masterPunchcardPlaceholder=null,this.masterPunchcardIsRendering=!1,this.masterPunchcardPendingRefresh=!1,this.masterPunchcardResizeTimer=null,this.externalVisualizerCanvas=null,this.externalVisualizerObserver=null,this.externalVisualizerType=null,this.scopeAnimationFrame=null,this.barchartAnimationFrame=null,this.scopeDataArray=null,this.spectrumDataArray=null,this.activeVisualizerLoop=null,this.introSamplePlayed=!1,this._introSampleActivationHandler=null,this.nativeHighlightingEnabled=!1,this.nativeHighlightingDisabled=!1,this.nativeHighlightRetryCount=0,this.nativeHighlightRetryTimer=null,this.visualizerFullscreenBtn=null,this.handleVisualizerFullscreenChange=this.handleVisualizerFullscreenChange.bind(this),document.addEventListener("fullscreenchange",this.handleVisualizerFullscreenChange),document.addEventListener("webkitfullscreenchange",this.handleVisualizerFullscreenChange),document.addEventListener("mozfullscreenchange",this.handleVisualizerFullscreenChange),document.addEventListener("MSFullscreenChange",this.handleVisualizerFullscreenChange)}async init(){I.appInstance=this,Ut.onUpdate("tempo",i=>{I.setTempo(i)}),Ut.onUpdate("key",i=>{I.setKey(i),console.log(`🎹 Key changed to: ${i}`)}),Ut.onUpdate("scale",i=>{I.setScale(i),console.log(`🎼 Scale changed to: ${i||"(none)"}`)}),Ut.onUpdate("timeSignature",i=>{if(this.currentTimeSignature=i||"4/4",this.currentTimeSignatureMetrics=ki(this.currentTimeSignature),I.setTimeSignature(i),console.log(`🎵 Time signature changed to: ${i}`),typeof this.applyTimeSignatureToDrumGrid=="function")try{this.applyTimeSignatureToDrumGrid(this.currentTimeSignature)}catch(s){console.warn("⚠️ Could not update drum grid for new time signature:",s)}this.refreshMasterPunchcard("time-signature-change").catch(s=>{console.warn("⚠️ Could not refresh punchcard after time signature change:",s)})}),Ut.setSoundTrigger((i,s)=>{I.isAudioReady()&&(s.type==="synthesized"?I.playSynthesizedSound(i,s.pattern).catch(r=>{console.error(`Error triggering control sound for ${i}:`,r)}):s.type==="strudel"&&I.playStrudelPattern(i,s.pattern).catch(r=>{console.error(`Error triggering control sound for ${i}:`,r)}))}),this.registerElements(),this.setupElementControls(),I.onSoundsReady(()=>{console.log("🎉 Sounds are ready - activating green dots"),this.setAllElementsLoaded(),Ut.updateStatus("Ready - Click elements to start/stop patterns (Press Escape to stop all)"),this.enableNativeStrudelHighlighting()}),I.onMasterPatternUpdate(async()=>{console.log("🔄 Master pattern updated - refreshing display"),this.updateMasterPatternDisplay(),this.updateActiveElementsDisplay(),this.refreshMasterPunchcard("master-update").catch(i=>{console.warn("⚠️ Could not refresh punchcard after master update:",i)})}),I.onMasterStateChange((i,s)=>{console.log(`🎚️ Master state changed: ${i?"playing":"stopped"}, elements: ${s.join(", ")}`),this.masterActive=i;const r=document.getElementById("play-master-btn"),a=document.querySelector(".master-active-dot");r&&(i?(r.textContent="⏸",r.title="Pause Master",r.classList.add("active")):(r.textContent="▶",r.title="Play Master",r.classList.remove("active"))),a&&(i?a.classList.add("active"):a.classList.remove("active")),s.forEach(o=>{this.updateStatusDots(o,!0,i)}),i||document.querySelectorAll(".element-circle").forEach(o=>{o.classList.remove("playing")}),i?(this.hideMasterPunchcardPlaceholder(),this.enableNativeStrudelHighlighting()):this.showMasterPunchcardPlaceholder()}),this.setupAudioInitialization(),this.setupMasterChannel();const e=i=>{console.log("Key pressed:",i.key),(i.key==="Escape"||i.keyCode===27)&&(console.log("🛑 Emergency stop activated (Escape key pressed)"),i.preventDefault(),i.stopPropagation(),I.stopAllSounds(),Ut.updateStatus("🛑 All sounds stopped"),this.activeElements.clear(),this.updateActiveElementsDisplay(),Lt.elements.forEach(s=>{const r=this.elementHasPattern(s.id);this.updateStatusDots(s.id,r,!1)}))};document.addEventListener("keydown",e,!0),window.addEventListener("keydown",e,!0),console.log("✅ Escape key handler registered");const t=document.getElementById("stop-all-btn");t?(t.addEventListener("click",()=>{console.log("🛑 Stop All button clicked"),I.stopAllSounds(),Ut.updateStatus("🛑 All sounds stopped"),this.activeElements.clear(),this.updateActiveElementsDisplay(),Lt.elements.forEach(i=>{const s=this.elementHasPattern(i.id);this.updateStatusDots(i.id,s,!1)})}),console.log("✅ Stop All button handler registered")):console.warn("⚠️ Stop All button not found in DOM"),this.initialized=!0,this.setAllElementsNotLoaded(),this.migrateLocalStorageQuotes(),this.loadAllElementConfigs(),this.setupModal(),this.setupAddElementButton(),Ut.updateStatus("Ready - Click anywhere to enable audio (Press Escape to stop all sounds)"),setTimeout(()=>{try{H$(),this.enableNativeStrudelHighlighting()}catch(i){console.warn("⚠️ Strudel REPL editor initialization failed (non-critical):",i.message),console.log("💡 Pattern editing will use plain textareas instead")}},100),console.log("Interactive Sound App initialized"),console.log("💡 Tip: Press Escape key or click Stop All button to silence everything")}initializeElementVisualizations(e=null,t=null){(e?[e]:document.querySelectorAll(".sound-element")).forEach(s=>{const r=t||s.dataset.soundId;if(!r)return;s.querySelector(".config-button");const a=this.loadElementConfig(r);if(a&&a.pattern&&a.pattern.trim()!==""){this.updateSynthesisSectionVisibility(r,a.pattern);const l=a.title&&a.title.trim()?a.title:a.bank?Ea[a.bank]||a.bank:"";di(r,l)}else di(r,"")})}setupMasterChannel(){const e=document.getElementById("master-volume"),t=document.getElementById("master-pan"),i=document.getElementById("master-mute-btn"),s=document.getElementById("master-volume-value"),r=document.getElementById("master-pan-value");if(e){const a=parseFloat(e.value);I.masterVolume=a/100,s&&(s.textContent=Math.round(a)),console.log(`🎚️ Master volume slider initialized: ${a}% (${I.masterVolume})`),e.addEventListener("input",o=>{const l=parseFloat(o.target.value);console.log(`🎚️ Master volume slider changed: ${l}%`),I.setMasterVolume(l/100),s&&(s.textContent=Math.round(l)),I.updateMasterPattern(this.soloedElements,this.mutedElements)}),I.isAudioReady()&&I.masterGainNode?(console.log(`🎚️ Audio already ready, setting master volume to ${a}%`),I.setMasterVolume(a/100)):console.log("🎚️ Audio not ready yet, master volume will be set on initialization")}else console.warn("⚠️ Master volume slider not found in DOM");if(t){const a=parseFloat(t.value);I.masterPan=a,r&&(r.textContent=a.toFixed(2)),console.log(`🎚️ Master pan slider initialized: ${a}`),t.addEventListener("input",o=>{const l=parseFloat(o.target.value);console.log(`🎚️ Master pan slider changed: ${l}`),I.setMasterPan(l),r&&(r.textContent=l.toFixed(2)),I.updateMasterPattern(this.soloedElements,this.mutedElements)}),I.isAudioReady()&&I.masterPanNode?(console.log(`🎚️ Audio already ready, setting master pan to ${a}`),I.setMasterPan(a)):console.log("🎚️ Audio not ready yet, master pan will be set on initialization")}else console.warn("⚠️ Master pan slider not found in DOM");i&&i.addEventListener("click",()=>{console.log("🎚️ Master mute button clicked");const a=I.toggleMasterMute();i.textContent=a?"🔇":"🔊",i.title=a?"Unmute Master":"Mute Master",console.log(`🎚️ Master mute toggled: ${a?"MUTED":"UNMUTED"}`)}),this.setupMasterPatternControls(),this.setupMasterPunchcard(),console.log("✅ Master channel controls setup complete")}tryPlayIntroSample(){if(this.introSamplePlayed||!Km||!I)return;const e=typeof I.getAudioContext=="function"?I.getAudioContext():null,t=I.isAudioReady()&&e,i=()=>{try{I.playAudioFile("intro-sample",Km),this.introSamplePlayed=!0,this.detachIntroSampleActivationHandlers()}catch(s){console.warn("⚠️ Unable to play intro sample automatically:",s)}};t?e.state!=="running"?e.resume().then(()=>{i()}).catch(s=>{console.warn("⚠️ Unable to resume audio context for intro sample:",s),this.attachIntroSampleActivationHandlers()}):i():this.attachIntroSampleActivationHandlers()}attachIntroSampleActivationHandlers(){this._introSampleActivationHandler||this.introSamplePlayed||(this._introSampleActivationHandler=()=>{if(I!=null&&I.getAudioContext){const e=I.getAudioContext();e&&e.state==="suspended"&&e.resume().catch(()=>{})}this.tryPlayIntroSample()},document.addEventListener("pointerdown",this._introSampleActivationHandler,{passive:!0}),document.addEventListener("keydown",this._introSampleActivationHandler))}detachIntroSampleActivationHandlers(){this._introSampleActivationHandler&&(document.removeEventListener("pointerdown",this._introSampleActivationHandler),document.removeEventListener("keydown",this._introSampleActivationHandler),this._introSampleActivationHandler=null)}setupMasterPatternControls(){this.masterPatternField=document.getElementById("master-pattern");const e=document.getElementById("play-master-btn"),t=document.getElementById("update-master-btn"),i=document.querySelector(".master-active-dot");if(!this.masterPatternField){console.warn("⚠️ Master pattern field not found in DOM");return}e&&(e.addEventListener("click",async()=>{if(this.masterActive)console.log("⏸️ Pause Master button clicked"),(await I.stopMasterPattern()).success&&(this.masterActive=!1,I.masterActive=!1,e.textContent="▶",e.title="Play Master",e.classList.remove("active"),i&&i.classList.remove("active"),console.log("✅ Master playback paused"));else{console.log("▶️ Play Master button clicked");const o="modal-preview";if(I.isPlaying(o)){console.log("⏹️ Stopping modal preview before playing master"),I.stopSound(o);const u=document.getElementById("modal-preview-btn");u&&(u.textContent="▶ Preview Pattern",u.classList.remove("active"))}const l=dt("master-pattern").trim();if(l&&l!==I.getMasterPatternCode()){if(I.masterPattern=I.formatMasterPatternWithTempoComment(l),typeof this.syncElementsFromMasterPattern=="function")try{this.syncElementsFromMasterPattern(I.masterPattern)}catch(u){console.warn("⚠️ Could not sync elements from master code before play:",u)}console.log("📝 Updated master pattern code directly before playing")}this.selectedVisualizer&&this.selectedVisualizer!=="punchcard"?(console.log(`🎨 Preparing canvas for visualizer "${this.selectedVisualizer}"`),this.prepareCanvasForExternalVisualizer()):this.showMasterPunchcardPlaceholder(),console.log(`🎨 Applying visualizer "${this.selectedVisualizer||"punchcard"}" before playing`);try{await this.applyVisualizerToMaster()}catch(u){console.warn("⚠️ Error applying visualizer, continuing with playback:",u)}const c=await I.playMasterPattern();c.success?(this.masterActive=!0,e.textContent="⏸",e.title="Pause Master",e.classList.add("active"),i&&i.classList.add("active"),console.log("✅ Master playback started")):(console.error("❌ Failed to play master:",c.error),alert(`Failed to play master: ${c.error}`))}}),this._masterSpacebarHandlerAttached||(this._masterSpacebarHandlerAttached=!0,document.addEventListener("keydown",async o=>{var h;if(o.code!=="Space")return;const l=document.activeElement,c=(h=l==null?void 0:l.tagName)==null?void 0:h.toLowerCase();l!=null&&l.isContentEditable||c==="textarea"||c==="input"&&(l==null?void 0:l.type)!=="button"&&(l==null?void 0:l.type)!=="checkbox"&&(l==null?void 0:l.type)!=="range"||c==="select"||(o.preventDefault(),e.click())})));const s=document.getElementById("export-audio-btn");s&&s.addEventListener("click",async()=>{if(console.log("🎵 Export Audio button clicked"),!I.getMasterPatternCode()||I.getMasterPatternCode().trim()===""){alert("No master pattern to export. Please create a pattern first.");return}const o=prompt("Enter export duration in seconds (default: 16):","16");if(o===null)return;const l=parseInt(o)||16;s.disabled=!0,s.textContent="⏳ Exporting...";try{const c=await I.exportAudioWAV(l);c.success?(c.warning?alert(`⚠️ Audio exported as ${c.format.toUpperCase()}!

${c.warning}`):alert(`✅ Audio exported successfully as ${c.format.toUpperCase()}!`),console.log("✅ Audio export complete")):(alert(`❌ Export failed: ${c.error}`),console.error("❌ Audio export failed:",c.error))}catch(c){alert(`❌ Export error: ${c.message}`),console.error("❌ Audio export error:",c)}finally{s.disabled=!1,s.textContent="🎵 Export Audio"}}),t&&t.addEventListener("click",async()=>{console.log("💾 Update Master button clicked");const o=dt("master-pattern").trim();if(!o){alert("Master pattern is empty");return}const l=await I.setMasterPatternCode(o);l.success?(console.log("✅ Master pattern code updated"),alert("Master pattern updated successfully!")):(console.error("❌ Failed to update master:",l.error),alert(`Failed to update master: ${l.error}`))});const r=document.getElementById("copy-code-btn");r&&r.addEventListener("click",async()=>{const o=this.masterPatternField.value.trim();if(!o){alert("Master pattern is empty");return}try{const l="// Created with Strudesk 4000 by eKommissar",c=o.startsWith(l)?o:`${l}

${o}`;await navigator.clipboard.writeText(c);const u=r.textContent;r.textContent="✓ Copied!",r.title="Copied!",setTimeout(()=>{r.textContent=u,r.title="Copy Code"},2e3),console.log("✅ Master pattern code copied to clipboard")}catch(l){console.error("❌ Failed to copy code:",l),alert("Failed to copy code to clipboard")}});const a=document.getElementById("clear-all-btn");a&&a.addEventListener("click",()=>{confirm("Are you sure you want to clear all? This will clear the master pattern and all element configurations.")&&(console.log("🗑️ Clear All button clicked"),this.resetAll())}),console.log("✅ Master pattern controls setup complete")}setupMasterPunchcard(){if(this.masterPunchcardContainer=document.getElementById("master-punchcard"),this.masterPunchcardCanvas=document.getElementById("master-punchcard-canvas"),this.masterPunchcardPlaceholder=this.masterPunchcardContainer?this.masterPunchcardContainer.querySelector(".punchcard-placeholder"):null,!this.masterPunchcardContainer||!this.masterPunchcardCanvas){console.warn("⚠️ Master punchcard elements not found in DOM");return}const e=this.getMasterPunchcardContext();e&&(window.__strudelVisualizerCtx=e),this.selectedVisualizer="scope";const t=document.getElementById("visualizer-select");this.visualizerSelect=t,t&&(t.value=this.selectedVisualizer,t.addEventListener("change",async i=>{this.selectedVisualizer=i.target.value,console.log(`🎨 Visualizer changed to: ${this.selectedVisualizer}`),this.selectedVisualizer!=="punchcard"?this.prepareCanvasForExternalVisualizer():this.showMasterPunchcardPlaceholder(),await this.applyVisualizerToMaster(),this.refreshMasterPunchcard("visualizer-change").catch(s=>{console.warn("⚠️ Unable to refresh punchcard after visualizer change:",s)})})),this.visualizerFullscreenBtn=document.getElementById("visualizer-fullscreen-btn"),this.visualizerFullscreenBtn&&(this.visualizerFullscreenBtn.addEventListener("click",()=>{this.toggleVisualizerFullscreen()}),this.updateVisualizerFullscreenButton(!1)),this.showMasterPunchcardPlaceholder(),window.addEventListener("resize",()=>{this.masterPunchcardResizeTimer&&clearTimeout(this.masterPunchcardResizeTimer),this.masterPunchcardResizeTimer=setTimeout(()=>{this.refreshMasterPunchcard("resize").catch(i=>{console.warn("⚠️ Unable to refresh punchcard after resize:",i)})},150)}),this.refreshMasterPunchcard("initial").catch(i=>{console.warn("⚠️ Unable to render initial punchcard:",i)})}getCurrentFullscreenElement(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||null}async toggleVisualizerFullscreen(){if(!this.masterPunchcardContainer)return;if(this.getCurrentFullscreenElement()===this.masterPunchcardContainer){document.exitFullscreen?await document.exitFullscreen():document.webkitExitFullscreen?await document.webkitExitFullscreen():document.mozCancelFullScreen?await document.mozCancelFullScreen():document.msExitFullscreen&&await document.msExitFullscreen();return}const t=this.masterPunchcardContainer.requestFullscreen||this.masterPunchcardContainer.webkitRequestFullscreen||this.masterPunchcardContainer.mozRequestFullScreen||this.masterPunchcardContainer.msRequestFullscreen;if(t)try{await t.call(this.masterPunchcardContainer)}catch(i){console.warn("⚠️ Unable to enter visualizer fullscreen:",i)}}updateVisualizerFullscreenButton(e){this.visualizerFullscreenBtn&&(this.visualizerFullscreenBtn.classList.toggle("is-active",e),this.visualizerFullscreenBtn.setAttribute("aria-label",e?"Exit visualizer fullscreen":"Enter visualizer fullscreen"))}handleVisualizerFullscreenChange(){const t=this.getCurrentFullscreenElement()===this.masterPunchcardContainer;this.masterPunchcardContainer&&this.masterPunchcardContainer.classList.toggle("is-fullscreen",t),this.updateVisualizerFullscreenButton(t),this.refreshMasterPunchcard("fullscreen-change").catch(i=>{console.warn("⚠️ Unable to refresh punchcard after fullscreen change:",i)})}async applyVisualizerToMaster(){var h;console.log(`🎨 Applying visualizer "${this.selectedVisualizer}" to master pattern`),this.scopeSpectrumObserver=null,this.scopeSpectrumCopyLoop=null,this.teardownExternalVisualizerCanvas(),this.stopVisualizerAnimation(),this.selectedVisualizer!=="pianoroll"&&document.querySelectorAll('canvas[data-processed="true"]').forEach(f=>{f.id!=="master-punchcard-canvas"&&f.remove()}),this.prepareCanvasForExternalVisualizer();let e=I.getMasterPatternCode();if(!e||e.trim()===""){if(I.trackedPatterns&&I.trackedPatterns.size>0&&(console.log(`🔄 Master pattern is empty but ${I.trackedPatterns.size} tracked pattern(s) found - rebuilding master pattern`),I.updateMasterPattern(new Set,new Set),e=I.getMasterPatternCode()),!e||e.trim()===""){const d=dt("master-pattern").trim();d&&d!==""&&(console.log("📝 Reading master pattern from editor"),e=d)}(!e||e.trim()==="")&&(console.warn("⚠️ No master pattern to apply visualizer to, using silence"),e="silence")}e=e.replace(/\/\/.*$/gm,""),e=e.replace(/\/\*[\s\S]*?\*\//g,d=>/\/\*\s*Channel\s+\d+\s*\*\//i.test(d)?d:""),e=e.replace(/\n\s*\n/g,`
`).trim();const t=(d,f)=>{let m=1;for(let g=f+1;g<d.length;g++)if(d[g]==="(")m++;else if(d[g]===")"&&(m--,m===0))return g;return-1};["scope","tscope","fscope","spectrum","visual","pianoroll","barchart"].forEach(d=>{const f=new RegExp(`\\.\\s*_?${d}\\s*\\(`,"gi");let m;for(;(m=f.exec(e))!==null;){const g=m.index,y=m.index+m[0].length-1,b=t(e,y);if(b!==-1)e=e.substring(0,g)+e.substring(b+1),f.lastIndex=0;else break}}),e=e.trim().replace(/\.\s*$/,"").replace(/\.\.+/g,".").trim();let s=e;const r="master-punchcard-canvas";if(this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart"||this.selectedVisualizer==="spectrum"){I.setupVisualizerAnalyser(),await new Promise(m=>setTimeout(m,100));const d=r,f=((h=window.strudel)==null?void 0:h.getAnalyserById)||globalThis.getAnalyserById;if(f)try{const m=f(d);m&&m.context===I.audioContext?console.log(`✅ Verified analyser "${d}" is ready in correct audio context`):console.warn(`⚠️ Analyser "${d}" not ready or in wrong context`)}catch(m){console.warn("⚠️ Could not verify analyser:",m.message)}}const a=document.getElementById(r);if(a){a.style.position="relative",a.style.display="block",a.style.visibility="visible",a.style.opacity="1",a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%",a.id=r;const d=document.getElementById("master-punchcard");if(d&&a.parentNode!==d&&d.appendChild(a),d){const f=d.getBoundingClientRect(),m=window.devicePixelRatio||1,g=Math.max(f.width||320,320),y=Math.max(f.height||200,200);a.width=g*m,a.height=y*m,a.style.width=`${g}px`,a.style.height=`${y}px`,(this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart"||this.selectedVisualizer==="spectrum")&&(a.offsetHeight,console.log(`✅ Canvas "${r}" is ready for ${this.selectedVisualizer}:`,{id:a.id,width:a.width,height:a.height,visible:a.style.display!=="none",inDOM:document.contains(a)}))}}else console.error(`❌ Canvas "${r}" not found!`);if((this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart"||this.selectedVisualizer==="spectrum")&&(a&&a.id!==r&&(a.id=r),this.masterPunchcardCanvas.style.display="block"),this.selectedVisualizer==="pianoroll")try{const d=uu(r,{contextType:"2d"});window.__strudelVisualizerCtx=d,console.log(`✅ Registered canvas "${r}" with getDrawContext for ${this.selectedVisualizer}`)}catch(d){console.warn(`⚠️ Failed to register canvas with getDrawContext for ${this.selectedVisualizer}:`,d)}this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart"?s=e:this.selectedVisualizer==="spectrum"?s=`${e}._spectrum({
        id: '${r}',
        ctx: (window.__strudelVisualizerCtx || (document.getElementById('master-punchcard-canvas') && document.getElementById('master-punchcard-canvas').getContext && document.getElementById('master-punchcard-canvas').getContext('2d'))),
        thickness: 3,
        speed: 1,
        min: -80,
        max: 0
      })`:this.selectedVisualizer==="pianoroll"&&(this.externalVisualizerType="pianoroll",this.watchForExternalVisualizerCanvas("pianoroll"),this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="none"),s=`${e}.pianoroll({ 
          cycles: 4,
          playhead: 0.5,
          fill: true,
          fillActive: true,
          stroke: true,
          strokeActive: true,
          autorange: true,
          colorizeInactive: true,
          background: '#05060a'
        })`),console.log(`🎨 Pattern with visualizer: ${s.substring(0,150)}...`),console.log("🎨 Full pattern with visualizer:",s),(!s||s.trim()==="")&&(console.warn("⚠️ Pattern with visualizer is empty, using base pattern"),s=e||"silence");const l=this.selectedVisualizer==="scope"||this.selectedVisualizer==="barchart",c=!l&&this.selectedVisualizer!=="punchcard";let u=!0;c?(u=new RegExp(`\\.\\s*_?${this.selectedVisualizer}\\s*\\(`).test(s),u?console.log(`✅ Visualizer "${this.selectedVisualizer}" found in pattern`):console.error(`❌ Visualizer "${this.selectedVisualizer}" not found in pattern! Pattern:`,s)):l&&console.log(`✅ Using internal analyser visualizer for ${this.selectedVisualizer}`),await I.setMasterPatternCode(s),this.selectedVisualizer==="scope"?this.startScopeVisualizerLoop():this.selectedVisualizer==="barchart"?this.startBarchartVisualizerLoop():this.selectedVisualizer==="pianoroll"&&(this.watchForExternalVisualizerCanvas("pianoroll"),this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="none"),this.hideMasterPunchcardPlaceholder()),this.refreshMasterPunchcard("visualizer-applied").catch(d=>{console.warn("⚠️ Unable to refresh punchcard after applying visualizer:",d)})}showMasterPunchcardPlaceholder(){this.masterPunchcardContainer&&(this.masterPunchcardPlaceholder&&this.masterPunchcardPlaceholder.classList.remove("hidden"),this.masterPunchcardCanvas&&this.masterPunchcardCtx&&(this.masterPunchcardCtx.setTransform(1,0,0,1,0,0),this.masterPunchcardCtx.clearRect(0,0,this.masterPunchcardCanvas.width,this.masterPunchcardCanvas.height)))}async refreshMasterPunchcard(e="auto"){if(!this.masterPunchcardContainer)return;const t=I.getMasterPatternCode();if(!t||t.trim()===""){this.showMasterPunchcardPlaceholder();return}const i=this.shouldUseSpiralVisualizer(t),s=!i&&this.shouldUseScopeVisualizer(t),r=!i&&!s&&this.shouldUseSpectrumVisualizer(t),a=!i&&!s&&!r&&this.shouldUsePitchwheelVisualizer(t),o=!i&&!s&&!r&&!a&&this.shouldUsePianorollVisualizer(t),l=!i&&!s&&!r&&!a&&!o&&this.shouldUseBarchartVisualizer(t);r&&this.selectedVisualizer!=="spectrum"&&(!this.selectedVisualizer||["scope","punchcard","barchart"].includes(this.selectedVisualizer))&&(this.selectedVisualizer="spectrum",this.visualizerSelect&&(this.visualizerSelect.value="spectrum")),o&&this.selectedVisualizer!=="pianoroll"&&(!this.selectedVisualizer||["scope","punchcard","barchart","spectrum"].includes(this.selectedVisualizer))&&(this.selectedVisualizer="pianoroll",this.visualizerSelect&&(this.visualizerSelect.value="pianoroll"));const c=this.selectedVisualizer||"punchcard";if(c==="scope"){this.prepareCanvasForExternalVisualizer(),this.startScopeVisualizerLoop(),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(c==="barchart"){this.prepareCanvasForExternalVisualizer(),this.startBarchartVisualizerLoop(),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(c==="spectrum"){this.prepareCanvasForExternalVisualizer(),this.watchForExternalVisualizerCanvas("spectrum"),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(c==="pianoroll"){this.watchForExternalVisualizerCanvas("pianoroll"),this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="none"),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(c!=="scope"&&c!=="barchart"&&this.stopVisualizerAnimation(),s||r||i||a||o||l){(this.selectedVisualizer||"punchcard")==="punchcard"&&s&&this.watchForExternalVisualizerCanvas("scope"),o&&(this.watchForExternalVisualizerCanvas("pianoroll"),this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="none")),this.prepareCanvasForExternalVisualizer(),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardIsRendering=!1;return}if(this.masterPunchcardIsRendering){this.masterPunchcardPendingRefresh=!0;return}this.masterPunchcardIsRendering=!0;try{const u=this.currentTimeSignatureMetrics||ki(this.currentTimeSignature||"4/4"),h=await this.computeMasterPunchcardData(t,u);if(!h||h.error){const f=h!=null&&h.error?`Unable to render punchcard: ${h.error}`:"Unable to render punchcard.";console.warn(f,{reason:e,data:h}),this.showMasterPunchcardPlaceholder();return}if(!h.counts||h.counts.length===0){this.showMasterPunchcardPlaceholder();return}if(Math.max(...h.counts)<=0){this.showMasterPunchcardPlaceholder();return}this.renderMasterPunchcard(u,h)}finally{this.masterPunchcardIsRendering=!1,this.masterPunchcardPendingRefresh&&(this.masterPunchcardPendingRefresh=!1,this.refreshMasterPunchcard("queued-refresh").catch(u=>{console.warn("⚠️ Queued punchcard refresh failed:",u)}))}}renderMasterPunchcard(e,t){!this.masterPunchcardContainer||!this.masterPunchcardCanvas||(this.hideMasterPunchcardPlaceholder(),this.drawMasterPunchcardCanvas(e,t))}prepareCanvasForExternalVisualizer(){if(!this.masterPunchcardContainer||!this.masterPunchcardCanvas){console.warn("⚠️ Canvas elements not found for visualizer");return}const e=this.masterPunchcardCanvas.id;if(console.log(`🎨 Preparing canvas for external visualizer: ${e}`),!document.getElementById(e)){console.error(`❌ Canvas "${e}" not found via getElementById!`);return}console.log(`✅ Canvas "${e}" is accessible via getElementById`),this.hideMasterPunchcardPlaceholder(),this.masterPunchcardCanvas.style.position="relative",this.masterPunchcardCanvas.style.left="0",this.masterPunchcardCanvas.style.top="0",this.masterPunchcardCanvas.style.width="100%",this.masterPunchcardCanvas.style.height="100%",this.masterPunchcardCanvas.style.display="block";const i=["scope","barchart","spectrum"];this.masterPunchcardCanvas.style.background=i.includes(this.selectedVisualizer)?"#05060a":"rgba(255, 255, 255, 0.9)";let s;try{s=uu(e,{contextType:"2d"}),console.log(`✅ Got draw context via getDrawContext for ${e}`)}catch(r){console.warn("⚠️ getDrawContext failed, falling back to native:",r),s=this.masterPunchcardCanvas.getContext("2d")}if(s&&(this.sizeCanvasToContainer(this.masterPunchcardCanvas,s),window.__strudelVisualizerCtx=s,window.strudel&&window.strudel.controls))try{window.strudel.controls.setCanvas(e),console.log(`✅ Registered canvas "${e}" with Strudel controls`)}catch(r){console.log("ℹ️ Could not register with strudel.controls:",r.message)}}sizeCanvasToContainer(e,t){if(!e||!this.masterPunchcardContainer)return;const i=this.masterPunchcardContainer.getBoundingClientRect(),s=Math.max(i.width||this.masterPunchcardContainer.offsetWidth||320,240),r=Math.max(i.height||this.masterPunchcardContainer.offsetHeight||200,220),a=window.devicePixelRatio||1;e.width=s*a,e.height=r*a,e.style.width="100%",e.style.height="100%",e.style.display="block",e.style.opacity="1",t&&(t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,e.width,e.height),t.setTransform(a,0,0,a,0,0))}ensureVisualizerAnalyser(){return I?(I.visualizerAnalyser||typeof I.setupVisualizerAnalyser=="function"&&I.setupVisualizerAnalyser(),I.visualizerAnalyser||null):null}stopVisualizerAnimation(){this.scopeAnimationFrame&&(cancelAnimationFrame(this.scopeAnimationFrame),this.scopeAnimationFrame=null),this.barchartAnimationFrame&&(cancelAnimationFrame(this.barchartAnimationFrame),this.barchartAnimationFrame=null),this.activeVisualizerLoop=null}drawVisualizerMessage(e){const t=this.masterPunchcardCanvas,i=this.getMasterPunchcardContext();if(!t||!i)return;this.sizeCanvasToContainer(t,i);const s=window.devicePixelRatio||1,r=t.width/s,a=t.height/s;i.fillStyle="rgba(5, 6, 10, 0.92)",i.fillRect(0,0,r,a),i.fillStyle="#94a3b8",i.font='14px "Fira Sans", "Inter", system-ui, sans-serif',i.textAlign="center",i.textBaseline="middle",i.fillText(e,r/2,a/2)}startScopeVisualizerLoop(){if(this.activeVisualizerLoop==="scope")return;const e=this.masterPunchcardCanvas,t=this.getMasterPunchcardContext();if(!e||!t)return;const i=this.ensureVisualizerAnalyser();if(!i){this.drawVisualizerMessage("Scope analyser unavailable");return}const s=i.fftSize||2048;(!this.scopeDataArray||this.scopeDataArray.length!==s)&&(this.scopeDataArray=new Uint8Array(s)),this.activeVisualizerLoop="scope";const r=()=>{if(this.selectedVisualizer!=="scope"){this.stopVisualizerAnimation();return}const a=this.getMasterPunchcardContext();if(!a){this.stopVisualizerAnimation();return}this.hideMasterPunchcardPlaceholder(),this.masterPunchcardCanvas.style.display="block",this.sizeCanvasToContainer(e,a),i.getByteTimeDomainData(this.scopeDataArray);const o=window.devicePixelRatio||1,l=e.width/o,c=e.height/o;a.fillStyle="rgba(5, 6, 10, 0.92)",a.fillRect(0,0,l,c);const u=c/2;a.strokeStyle="#38bdf8",a.lineWidth=2,a.beginPath();const h=l/this.scopeDataArray.length;let d=0;for(let f=0;f<this.scopeDataArray.length;f++){const g=this.scopeDataArray[f]/128*c/2;f===0?a.moveTo(d,g):a.lineTo(d,g),d+=h}a.lineTo(l,u),a.stroke(),a.strokeStyle="rgba(14, 165, 233, 0.4)",a.beginPath(),a.moveTo(0,u),a.lineTo(l,u),a.stroke(),this.scopeAnimationFrame=requestAnimationFrame(r)};r()}startBarchartVisualizerLoop(){var l;if(this.activeVisualizerLoop==="barchart")return;const e=this.masterPunchcardCanvas,t=this.getMasterPunchcardContext();if(!e||!t)return;const i=this.ensureVisualizerAnalyser();if(!i){this.drawVisualizerMessage("Spectrum analyser unavailable");return}const s=i.frequencyBinCount||1024;(!this.spectrumDataArray||this.spectrumDataArray.length!==s)&&(this.spectrumDataArray=new Uint8Array(s));const a=(((l=i.context)==null?void 0:l.sampleRate)||44100)/2;this.activeVisualizerLoop="barchart";const o=()=>{if(this.selectedVisualizer!=="barchart"){this.stopVisualizerAnimation();return}const c=this.getMasterPunchcardContext();if(!c){this.stopVisualizerAnimation();return}this.hideMasterPunchcardPlaceholder(),this.masterPunchcardCanvas.style.display="block",this.sizeCanvasToContainer(e,c),i.getByteFrequencyData(this.spectrumDataArray);const u=window.devicePixelRatio||1,h=e.width/u,d=e.height/u;c.fillStyle="rgba(5, 6, 10, 0.92)",c.fillRect(0,0,h,d);const f=Math.min(200,Math.floor(h/2)),m=[];for(let y=0;y<this.spectrumDataArray.length;y++){const b=y/this.spectrumDataArray.length*a;if(b>=20&&b<=2e4){const P=mc(b),k=this.spectrumDataArray[y]/255;m.push({position:P,value:k,frequency:b})}}m.sort((y,b)=>y.position-b.position);const g=h/f;for(let y=0;y<f;y++){const b=y/f,P=1/f,k=b<.3?P*4:b<.6?P*2:P,w=m.filter(W=>Math.abs(W.position-b)<k);let C=w.length>0?Math.max(...w.map(W=>W.value)):0;if(C===0&&m.length>0){let W=0,U=1/0;for(const Z of m){const Y=Math.abs(Z.position-b);if(Y<U)U=Y,W=Z.value;else if(Y>U)break}C=W}const $=Math.max(C*d,2),A=b*h,Q=d-$,q=c.createLinearGradient(A,Q,A,d);q.addColorStop(0,"rgba(56, 189, 248, 0.95)"),q.addColorStop(1,"rgba(14, 116, 144, 0.75)"),c.fillStyle=q,c.fillRect(A,Q,g+1,$)}this.barchartAnimationFrame=requestAnimationFrame(o)};o()}teardownExternalVisualizerCanvas(){this.externalVisualizerObserver&&(this.externalVisualizerObserver.disconnect(),this.externalVisualizerObserver=null),this.externalVisualizerCanvas&&this.externalVisualizerCanvas.parentNode&&this.externalVisualizerCanvas.remove(),this.externalVisualizerCanvas=null,this.externalVisualizerType=null,this.masterPunchcardCanvas&&(this.masterPunchcardCanvas.style.display="")}attachExternalVisualizerCanvas(e){return!e||!this.masterPunchcardContainer?!1:(this.masterPunchcardCanvas.style.display="none",this.hideMasterPunchcardPlaceholder(),this.masterPunchcardContainer.style.position===""&&(this.masterPunchcardContainer.style.position="relative"),e.dataset.visualizerAttached="true",e.style.position="relative",e.style.left="0",e.style.top="0",e.style.pointerEvents="auto",this.sizeCanvasToContainer(e,e.getContext("2d")),this.masterPunchcardContainer.appendChild(e),this.externalVisualizerCanvas=e,!0)}watchForExternalVisualizerCanvas(e){const t=()=>{const i=this.findExternalVisualizerCanvasCandidate(e);return i?this.attachExternalVisualizerCanvas(i):!1};t()||(this.externalVisualizerObserver=new MutationObserver(()=>{t()&&this.externalVisualizerObserver&&(this.externalVisualizerObserver.disconnect(),this.externalVisualizerObserver=null)}),this.externalVisualizerObserver.observe(document.body,{childList:!0,subtree:!0}))}findExternalVisualizerCanvasCandidate(e){const t=Array.from(document.querySelectorAll("canvas"));for(const i of t)if(i!==this.masterPunchcardCanvas&&i.dataset.visualizerAttached!=="true"&&(e==="pianoroll"&&this.isPianorollCanvas(i)||e==="scope"&&this.isScopeCanvas(i)||e==="spectrum"&&this.isSpectrumCanvas(i)))return i;return null}isPianorollCanvas(e){if(!e)return!1;if(e.dataset.pianoroll!==void 0)return!0;const t=e.className||"";if(/pianoroll/i.test(t))return!0;const i=e.getBoundingClientRect();return i.width===0||i.height===0?!1:i.width>window.innerWidth*.6&&i.height>window.innerHeight*.4}isScopeCanvas(e){if(!e)return!1;const t=(e.id||"").toLowerCase(),i=(e.className||"").toLowerCase();if(t.includes("scope")||i.includes("scope")||e.dataset.scope!==void 0)return!0;const s=e.getBoundingClientRect();return s.width>window.innerWidth*.5&&s.height<260}isSpectrumCanvas(e){if(!e)return!1;const t=(e.id||"").toLowerCase(),i=(e.className||"").toLowerCase();if(t.includes("spectrum")||i.includes("spectrum")||e.dataset.spectrum!==void 0)return!0;const s=e.getBoundingClientRect();return s.width>window.innerWidth*.5&&s.height<400}hideMasterPunchcardPlaceholder(){this.masterPunchcardPlaceholder&&this.masterPunchcardPlaceholder.classList.add("hidden")}shouldUseSpiralVisualizer(e){return e?/\.\s*_?spiral\s*\(/i.test(e):!1}shouldUseScopeVisualizer(e){return e?/\.\s*_?(?:t?scope)\s*\(/i.test(e):!1}shouldUseSpectrumVisualizer(e){return e?/\.\s*_?spectrum\s*\(/i.test(e):!1}shouldUsePitchwheelVisualizer(e){return e?/\.\s*_?pitchwheel\s*\(/i.test(e):!1}shouldUsePianorollVisualizer(e){return e?/\.\s*_?pianoroll\s*\(/i.test(e):!1}shouldUseBarchartVisualizer(e){return e?/\.\s*_?barchart\s*\(/i.test(e):!1}extractSpiralOptions(e){if(!e)return{};const t=e.match(/\.\s*_?spiral\s*\(\s*\{([^}]*)\}\s*\)/i);if(!t)return{};const i={};return t[1].split(",").forEach(r=>{const[a,o]=r.split(":");if(!a||!o)return;const l=a.trim(),c=o.trim(),u=Number(c.replace(/[^0-9.+-eE]/g,""));Number.isNaN(u)?/true|false/i.test(c)?i[l]=/^true$/i.test(c):i[l]=c.replace(/['"]/g,""):i[l]=u}),i}getMasterPunchcardContext(){if(!this.masterPunchcardCanvas)return null;if(!this.masterPunchcardCtx)try{this.masterPunchcardCtx=uu(this.masterPunchcardCanvas.id,{contextType:"2d"})}catch(e){console.warn("⚠️ Falling back to native canvas context:",e),this.masterPunchcardCtx=this.masterPunchcardCanvas.getContext("2d")}return this.masterPunchcardCtx}drawMasterPunchcardCanvas(e,t){const i=this.masterPunchcardCanvas,s=this.getMasterPunchcardContext();if(!i||!s)return;const r=this.masterPunchcardContainer.getBoundingClientRect(),a=Math.max(r.width||this.masterPunchcardContainer.offsetWidth||600,240),o=Math.max(r.height||this.masterPunchcardContainer.offsetHeight||200,200),l=window.devicePixelRatio||1;(i.width!==a*l||i.height!==o*l)&&(i.width=a*l,i.height=o*l,i.style.width=`${a}px`,i.style.height=`${o}px`),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,i.width,i.height),s.save(),s.setTransform(l,0,0,l,0,0);const c=16,u=a-c*2,h=o-c*3,d=c,f=o-c*1.5,m=s.createLinearGradient(0,0,a,o);m.addColorStop(0,"rgba(102, 126, 234, 0.06)"),m.addColorStop(1,"rgba(118, 75, 162, 0.08)"),s.fillStyle=m,s.fillRect(0,0,a,o);const{counts:g,hits:y}=t,{totalSteps:b,stepsPerBeat:P}=e;g.length!==b&&console.warn("⚠️ Punchcard data length mismatch",{expected:b,received:g.length});const k=Math.max(...g,1e-4),w=u/b;s.strokeStyle="rgba(102, 126, 234, 0.25)",s.lineWidth=1,s.beginPath();for(let C=0;C<=b;C+=P){const $=d+C*w;s.moveTo($,f),s.lineTo($,f-h)}s.stroke(),g.forEach((C,$)=>{const A=Math.max(C/k,0),Q=h*A,q=d+$*w,W=f-Q;if(Q<=2){s.fillStyle="rgba(148, 163, 184, 0.35)",s.fillRect(q+w*.3,f-3,w*.4,3);return}const U=s.createLinearGradient(q,W,q,f);U.addColorStop(0,"rgba(102, 126, 234, 0.9)"),U.addColorStop(1,"rgba(118, 75, 162, 0.85)"),s.fillStyle=U;const Z=q+w*.2,Y=w*.6,ne=Math.min(w*.3,8);typeof s.roundRect=="function"?(s.beginPath(),s.roundRect(Z,W,Y,Q,ne),s.fill()):s.fillRect(Z,W,Y,Q);const re=y==null?void 0:y[$];if(re&&re.length){s.fillStyle="rgba(26, 32, 44, 0.75)",s.font='10px "Fira Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',s.textAlign="center",s.textBaseline="bottom";const ve=re.slice(0,2).join(" • ");s.fillText(ve,q+w/2,W-4)}}),s.strokeStyle="rgba(79, 70, 229, 0.55)",s.lineWidth=1.5,s.beginPath(),s.moveTo(d,f),s.lineTo(d+u,f),s.stroke(),s.restore()}renderMasterSpiral(e,t,i={}){if(!this.masterPunchcardContainer||!this.masterPunchcardCanvas)return;const s=t.events||[];if(!s.length){this.showMasterPunchcardPlaceholder();return}this.hideMasterPunchcardPlaceholder(),this.drawMasterSpiralCanvas(e,s,i)}drawMasterSpiralCanvas(e,t,i={}){const s=this.masterPunchcardCanvas,r=this.getMasterPunchcardContext();if(!s||!r)return;const a=this.masterPunchcardContainer.getBoundingClientRect(),o=Math.max(a.width||this.masterPunchcardContainer.offsetWidth||320,240),l=Math.max(a.height||this.masterPunchcardContainer.offsetHeight||240,220),c=window.devicePixelRatio||1;(s.width!==o*c||s.height!==l*c)&&(s.width=o*c,s.height=l*c,s.style.width=`${o}px`,s.style.height=`${l}px`),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,s.width,s.height),r.save(),r.setTransform(c,0,0,c,0,0);const u=Number.isFinite(i.padding)?i.padding:32,h=Number.isFinite(i.inset)?i.inset:3,d=Number.isFinite(i.stretch)?i.stretch:1,f=Number.isFinite(i.rotations)?i.rotations:Math.max(e.numerator??4,4),m=Number.isFinite(i.steady)?i.steady:.9,g=Number.isFinite(i.thickness)?i.thickness:6,y=typeof i.cap=="string"?i.cap:"round",b=r.createLinearGradient(0,0,o,l);b.addColorStop(0,"rgba(102, 126, 234, 0.08)"),b.addColorStop(1,"rgba(118, 75, 162, 0.12)"),r.fillStyle=b,r.fillRect(0,0,o,l);const P=o/2,k=l/2,C=Math.max(Math.min(o,l)/2-u,40)/Math.max(f+h+1,1),A=m*0,Q={margin:C,cx:P,cy:k,stretch:d,cap:y,thickness:g},q="rgba(76, 81, 191, 0.85)",W="rgba(148, 163, 184, 0.35)",U=Math.max(...t.map(ne=>ne.weight??1),1),Z=f;t.forEach(ne=>{const re=Number.isFinite(ne.begin)?ne.begin:0,ve=Number.isFinite(ne.endClipped)?ne.endClipped:Number.isFinite(ne.end)?ne.end:re,Ce=Number.isFinite(ne.weight)?Math.max(ne.weight,.1):1,De=ne.color||q,Ue=h+re*Z,Pt=h+Math.max(ve,re)*Z;ug(r,{...Q,from:Ue,to:Pt,rotate:A,thickness:Q.thickness*(.6+Ce/U*.8),color:De})});const Y=h+Z+1;ug(r,{...Q,from:h,to:Y,rotate:A,color:W,thickness:Q.thickness*.6,fromOpacity:.35,toOpacity:.1}),r.restore()}async computeMasterPunchcardData(e,t){try{I.strudelLoaded||await I.initStrudel()}catch(P){return console.warn("⚠️ Unable to initialize Strudel for punchcard:",P),{error:"Strudel is not ready yet."}}if(!window.strudel||typeof window.strudel.evaluate!="function")return{error:"Strudel evaluate function is unavailable."};let i=e;console.log("═══════════════════════════════════════════════════════════"),console.log("🔍 PUNCHCARD EVALUATION - Original pattern:"),console.log("   Full pattern:",i),console.log("───────────────────────────────────────────────────────────"),i=i.replace(/\/\/.*$/gm,""),i=i.replace(/\/\*[\s\S]*?\*\//g,""),i=i.replace(/\n\s*\n/g,`
`).trim(),i=i.replace(/\)\s*\.\s*\((gain|pan)\s*\(/g,").$1("),/\)\s*\.\s*(gain|pan)\s*\(/.test(i)||(i=i.replace(/([a-zA-Z_$][a-zA-Z0-9_$]*\s*\([^()]*\)(?:\s*\.\s*[a-zA-Z_$][a-zA-Z0-9_$]*\s*\([^()]*\))*)\s*\.\s*(gain|pan)\s*\(/g,(P,k,w)=>k.trim().startsWith("(")?P:`(${k}).${w}(`)),console.log("🔍 PUNCHCARD EVALUATION - After removing comments and fixing modifiers:"),console.log("   Pattern:",i),console.log("───────────────────────────────────────────────────────────");const r=(P,k)=>{let w=1;for(let C=k+1;C<P.length;C++)if(P[C]==="(")w++;else if(P[C]===")"&&(w--,w===0))return C;return-1},a=["scope","tscope","fscope","spectrum","visual","spiral"];if(a.forEach(P=>{const k=new RegExp(`\\.\\s*_?${P}\\s*\\(`,"gi");let w,C=0;for(;(w=k.exec(i))!==null;){const $=w.index,A=w.index+w[0].length-1,Q=r(i,A);if(Q!==-1)i=i.substring(0,$)+i.substring(Q+1),C++,console.log(`  Stripped .${P}(...) occurrence #${C}`),k.lastIndex=0;else{console.warn(`  Could not find matching ) for .${P}( at position ${A}`);break}}}),i=i.trim(),i=i.replace(/\.\s*$/,"").replace(/\.\.+/g,".").trim(),console.log("🔍 PUNCHCARD EVALUATION - After stripping:"),console.log("   Stripped pattern:",i),console.log("───────────────────────────────────────────────────────────"),!i||i.trim()==="")return console.warn("⚠️ Pattern is empty after stripping visualizers"),{error:"Pattern is empty after removing visualizers."};if(a.some(P=>new RegExp(`\\.\\s*_?${P}\\s*\\(`,"i").test(i)))return console.warn("═══════════════════════════════════════════════════════════"),console.warn("⚠️ PUNCHCARD EVALUATION - FAILED TO STRIP VISUALIZERS"),console.warn("   Pattern still contains visualizers after stripping:"),console.warn("   ",i),console.warn("   This will cause Mini parser errors. Skipping punchcard evaluation."),console.warn("═══════════════════════════════════════════════════════════"),{error:"Pattern contains visualizers that could not be stripped."};if(console.log("✅ PUNCHCARD EVALUATION - Ready to evaluate (no visualizers detected)"),console.log("═══════════════════════════════════════════════════════════"),!i||i.trim()==="")return console.warn("⚠️ Pattern is empty after stripping - cannot evaluate"),{error:"Pattern is empty after processing"};console.log("📝 Final pattern to evaluate:",i);try{await I.ensurePatternResourcesLoaded(i)}catch(P){console.warn("⚠️ Unable to preload resources for punchcard evaluation:",P)}const l=P=>{if(P==null)return 0;if(typeof P=="number")return P;if(typeof P.valueOf=="function"){const w=P.valueOf();if(typeof w=="number"&&!Number.isNaN(w))return w}if(typeof P=="object"&&P!==null&&"n"in P&&"d"in P){const w=Number(P.n??0),C=Number(P.d??1);return C!==0?w/C:0}const k=Number(P);return Number.isFinite(k)?k:0},c=P=>P?typeof P=="string"?P:P.label?P.label:P.sample?P.sample:P.s?P.s:P.note?P.note:P.n?P.n:P.sound?P.sound:P.instrument?P.instrument:null:null;let u;try{const P=await Vb(i,mM,{wrapAsync:!1,addReturn:!1,emitMiniLocations:!1});u=P==null?void 0:P.pattern,console.log("🔍 Evaluated pattern object:",u)}catch(P){return console.error("❌ Failed to evaluate pattern for punchcard:",P),{error:(P==null?void 0:P.message)||"Pattern evaluation failed."}}if(!u&&window.strudel&&typeof window.strudel.evaluate=="function"){console.log("🔁 strudelCoreEvaluate returned no pattern - attempting fallback via window.strudel.evaluate");try{const P=`globalThis.__punchcard_pattern = ${i}`;console.log("🔍 Fallback evaluation code:",P.substring(0,200));const k=await window.strudel.evaluate(P);if(globalThis.__punchcard_pattern)u=globalThis.__punchcard_pattern,console.log("🔍 Fallback pattern object from globalThis:",u);else if(k&&typeof k.queryArc=="function")u=k,console.log("🔍 Fallback pattern object from eval result:",u);else if(k&&k._Pattern)u=k,console.log("🔍 Fallback pattern object (has _Pattern):",u);else{const w=await window.strudel.evaluate(i);w&&(typeof w.queryArc=="function"||w._Pattern)&&(u=w,console.log("🔍 Fallback pattern object from direct eval:",u))}}catch(P){console.warn("⚠️ Fallback evaluation failed:",P),console.warn("⚠️ Pattern that failed:",i.substring(0,200))}}if(!(u&&(typeof u.queryArc=="function"||typeof u.query=="function"||u._Pattern===!0))){if(console.warn("⚠️ Pattern did not return a valid Strudel pattern object"),console.warn("⚠️ Pattern object type:",typeof u),console.warn("⚠️ Pattern object:",u),console.warn("⚠️ Pattern that failed:",i.substring(0,300)),window.strudel&&typeof window.strudel.evaluate=="function")try{const k=`(${i})`,w=await window.strudel.evaluate(k);w&&(typeof w.queryArc=="function"||typeof w.query=="function"||w._Pattern===!0)&&(u=w,console.log("✅ Last attempt succeeded with wrapped pattern"))}catch(k){console.warn("⚠️ Last attempt also failed:",k)}if(!(u&&(typeof u.queryArc=="function"||typeof u.query=="function"||u._Pattern===!0)))return{error:"Pattern expression did not return a Strudel pattern."}}let d;try{if(typeof u.queryArc=="function")d=u.queryArc(0,1)||[];else if(typeof u.query=="function")d=u.query(0,1)||[];else if(u.__steps&&typeof u.__steps=="object")d=[],console.warn("⚠️ Pattern has _Pattern but no queryArc/query - attempting to extract haps from __steps");else throw new Error("Pattern object does not have queryArc, query, or __steps")}catch(P){return console.error("❌ Failed to query pattern arc for punchcard:",P),{error:(P==null?void 0:P.message)||"Pattern queryArc failed."}}try{delete globalThis.__punchcard_pattern}catch{globalThis.__punchcard_pattern=void 0}const f={events:d.map(P=>{const k=P==null?void 0:P.part,w=P==null?void 0:P.whole,C=l(k?k.begin??k.start??0:(w==null?void 0:w.begin)??0);let $=l(k?k.end??k.finish??k.begin??0:(w==null?void 0:w.end)??(w==null?void 0:w.begin)??0);(!Number.isFinite($)||$<C)&&($=C);const A=(P==null?void 0:P.value)??null,Q=c(A),q=A&&typeof A=="object"?A.note??A.n??null:null,W=A&&typeof A=="object"?A.sound??A.s??null:null,U=A&&typeof A=="object"?A.sample??null:null,Z=A&&typeof A=="object"?A.instrument??null:null,Y=A&&typeof A=="object"?A.source??A.path??null:null,ne=typeof A=="string"?A:null,re=A&&typeof A=="object"&&A.velocity!=null?Number(A.velocity):1,ve=A&&typeof A=="object"&&A.gain!=null?Number(A.gain):1,Ce=(Number.isFinite(re)?re:1)*(Number.isFinite(ve)?ve:1);return{begin:C,end:$,endClipped:l((P==null?void 0:P.endClipped)??$),wholeBegin:l((w==null?void 0:w.begin)??C),wholeEnd:l((w==null?void 0:w.end)??$),label:Q,weight:Number.isFinite(Ce)&&Ce>0?Ce:1,color:A&&typeof A=="object"&&A.color?A.color:null,tags:Array.isArray(P==null?void 0:P.tags)?P.tags:[],meta:{label:Q,note:q,sound:W,sample:U,instrument:Z,source:Y,rawString:ne}}})};if(!f||f.error)return console.warn("⚠️ Parsed result has error:",f==null?void 0:f.error),{error:(f==null?void 0:f.error)||"Unknown error from Strudel evaluation."};const{totalSteps:m}=t,g=new Array(m).fill(0),y=new Array(m).fill(null).map(()=>[]),b=f.events||[];return b.forEach(P=>{if(!P)return;const{begin:k,end:w,endClipped:C,label:$,weight:A}=P,Q=(Number(k)%1+1)%1,q=Number.isFinite(C)?C:w;let W=(Number(q)%1+1)%1;(!Number.isFinite(W)||W<Q)&&(W=Q);const U=Math.min(m-1,Math.max(0,Math.floor(Q*m))),Z=Math.min(m-1,Math.max(U,Math.ceil(W*m)-1)),Y=Number.isFinite(A)?Math.max(A,.1):1;for(let ne=U;ne<=Z;ne+=1)if(g[ne]+=Y,$){const re=y[ne];re.includes($)||re.push($)}}),{counts:g,hits:y,events:b}}enableNativeStrudelHighlighting(e=500){if(this.nativeHighlightingEnabled||this.nativeHighlightingDisabled)return;const t=(globalThis==null?void 0:globalThis.Strudel)||(globalThis==null?void 0:globalThis.strudel)||(window==null?void 0:window.Strudel)||(window==null?void 0:window.strudel),i=t&&typeof t.enableHighlighting=="function"?t.enableHighlighting:null;if(i)try{i.call(t),this.nativeHighlightingEnabled=!0,this.nativeHighlightRetryCount=0,this.nativeHighlightRetryTimer&&(clearTimeout(this.nativeHighlightRetryTimer),this.nativeHighlightRetryTimer=null),console.log("✅ Enabled Strudel.enableHighlighting()");return}catch(r){console.warn("⚠️ Strudel.enableHighlighting() failed:",r),this.nativeHighlightingDisabled=!0;return}if(this.nativeHighlightRetryTimer)return;if(this.nativeHighlightRetryCount>=5){console.warn("⚠️ Strudel.enableHighlighting() unavailable; falling back without editor highlights."),this.nativeHighlightingDisabled=!0,this.nativeHighlightRetryCount=0;return}this.nativeHighlightRetryCount+=1;const s=Math.min(e*2,4e3);this.nativeHighlightRetryTimer=setTimeout(()=>{this.nativeHighlightRetryTimer=null,this.enableNativeStrudelHighlighting(s)},s)}updateMasterPatternDisplay(){if(!this.masterPatternField)return;const e=I.getMasterPatternCode();e&&e.trim()!==""?($t("master-pattern",e),this.masterPatternField.placeholder="",console.log(`📝 Updated master pattern display: ${e.substring(0,100)}...`)):($t("master-pattern",""),this.masterPatternField.placeholder="Combined pattern will appear here...")}updateMasterIndicators(){Lt.elements.forEach(e=>{const t=e.id,i=document.querySelector(`[data-sound-id="${t}"]`);if(i){const s=i.querySelector(".master-status-indicator");s&&(I.trackedPatterns.has(t)?s.classList.add("active"):s.classList.remove("active"))}})}registerElements(e=null){(e||Lt.elements.map(i=>{const s=document.querySelector(i.selector);return s?{element:s,elementId:i.id}:null}).filter(i=>i!==null)).forEach(({element:i,elementId:s})=>{i&&(i.getAttribute("data-sound-id"),i.addEventListener("click",r=>{if(r.target.classList.contains("config-button")||r.target.classList.contains("pause-button")||r.target.classList.contains("solo-button")||r.target.classList.contains("mute-button")||r.target.classList.contains("gain-slider")||r.target.classList.contains("pan-slider")||r.target.classList.contains("collapsible-toggle")||r.target.classList.contains("collapsible-content")||r.target.classList.contains("effect-slider")||r.target.classList.contains("filter-slider")||r.target.closest(".collapsible-section"))return;const a=i.getAttribute("data-sound-id");console.log(`🖱️ Click triggered for ${a}`),this.activeElements.has(a)?this.deactivateElement(a,i,"click"):this.activateElement(a,i,"click")}))})}setupElementControls(){Lt.elements.forEach(e=>{const t=document.querySelector(e.selector);if(!t)return;const i=e.id,s=t.querySelector(".gain-slider"),r=t.querySelector(".pan-slider");if(s){const c=parseFloat(s.value);I.setElementGain(i,c),s.addEventListener("input",u=>{u.stopPropagation();const h=parseFloat(u.target.value);I.setElementGain(i,h),I.updateTrackedElementGain(i,h),this.updateMasterPatternDisplay()})}if(r){const c=parseFloat(r.value);I.setElementPan(i,c),r.addEventListener("input",u=>{u.stopPropagation();const h=parseFloat(u.target.value);I.setElementPan(i,h),I.updateTrackedElementPan(i,h),this.updateMasterPatternDisplay()})}const a=t.querySelector(".pause-button");a&&a.addEventListener("click",async c=>{c.stopPropagation(),await this.handlePauseButton(i)});const o=t.querySelector(".solo-button");o&&o.addEventListener("click",c=>{c.stopPropagation(),this.handleSoloButton(i,o)});const l=t.querySelector(".mute-button");l&&l.addEventListener("click",c=>{c.stopPropagation(),this.handleMuteButton(i,l)}),this.setupCollapsibleSections(t,i)})}setupCollapsibleSections(e,t){if(!e||!t){console.warn("⚠️ setupCollapsibleSections: Invalid element or elementId",{element:e,elementId:t});return}const i=e.querySelectorAll(".collapsible-toggle");console.log(`🎛️ Setting up collapsible sections for ${t}: ${i.length} toggle buttons found`),i.forEach(s=>{s.addEventListener("click",r=>{r.stopPropagation(),s.classList.toggle("active");const a=s.nextElementSibling;a&&a.classList.contains("collapsible-content")&&a.classList.toggle("active")})}),this.setupFilterDropdowns(e,t),this.setupEffectsDropdowns(e,t),this.setupSynthesisDropdowns(e,t)}setupFilterDropdowns(e,t){const i=e.querySelector(".filters-content");if(!i)return;i.innerHTML="",[{key:"hpf",label:"HPF",params:[{key:"hpf",label:"Frequency",unit:"Hz"},{key:"hpq",label:"HPQ",unit:""}]},{key:"lpf",label:"LPF",params:[{key:"lpf",label:"Frequency",unit:"Hz"},{key:"lpq",label:"LPQ",unit:""}]},{key:"bpf",label:"BPF",params:[{key:"bpf",label:"Frequency",unit:"Hz"},{key:"bpq",label:"Q",unit:""}]}].forEach((r,a)=>{const o=document.createElement("div");o.className="filter-collapsible-row";const c={hpf:"snippet-group-filters-hp",lpf:"snippet-group-filters-lp",bpf:"snippet-group-filters-bp"}[r.key]||"";o.innerHTML=`
        <button class="filter-toggle ${c}" data-filter-key="${r.key}">
          <span class="toggle-icon">▶</span> ${r.label}
        </button>
        <div class="filter-sliders-container" style="display: none;">
          <!-- Sliders will be added here -->
        </div>
      `,i.appendChild(o);const u=o.querySelector(".filter-toggle"),h=o.querySelector(".filter-sliders-container");u.addEventListener("click",d=>{d.stopPropagation(),u.classList.toggle("active");const f=u.classList.contains("active");h.style.display=f?"block":"none";const m=u.querySelector(".toggle-icon");m.textContent=f?"▼":"▶",f&&h.children.length===0&&r.params.forEach(g=>{const y=Xi[g.key];if(!y)return;let b=y.default.toString();g.key==="bpg"&&g.unit==="dB"?b=`${y.default>=0?"+":""}${y.default.toFixed(1)} dB`:g.unit&&(b=`${y.default}${g.unit?" "+g.unit:""}`);const P=document.createElement("div");P.className="slider-row",P.innerHTML=`
              <div class="slider-label-row">
                <label>${g.label}</label>
                <span class="slider-value">${b}</span>
              </div>
              <input type="range" class="filter-slider" data-filter-type="${r.key}" data-param-key="${g.key}" 
                     min="${y.min}" max="${y.max}" step="${y.step}" 
                     value="${y.default}" />
            `,h.appendChild(P);const k=P.querySelector(".filter-slider");k&&!k.dataset.hasListener&&(k.dataset.hasListener="true",k.addEventListener("input",async w=>{const C=parseFloat(w.target.value),$=P.querySelector(".slider-value");if($)if(g.key.includes("f"))$.textContent=Math.round(C)+" Hz";else if(g.key==="bpg"&&g.unit==="dB"){const A=C>=0?"+":"";$.textContent=`${A}${C.toFixed(1)} dB`}else $.textContent=C.toFixed(1)+(g.unit?" "+g.unit:"");await this.updateElementFilters(t)}))})})})}setupEffectsDropdowns(e,t){const i=e.querySelector(".effects-content");if(!i)return;i.innerHTML="",[{key:"delay",label:"Delay",params:[{key:"delay",label:"Delay Mix"},{key:"delayfeedback",label:"Delay Feedback"},{key:"delaytime",label:"Delay Time"}]},{key:"room",label:"Reverb",params:[{key:"room",label:"Room Mix"},{key:"roomsize",label:"Room Size"},{key:"roomlp",label:"Low-pass"},{key:"roomdim",label:"Dimension"},{key:"roomfade",label:"Fade"},{key:"iresponse",label:"Impulse Response"}]}].forEach(r=>{const a=document.createElement("div");a.className="effect-collapsible-row";const l={delay:"snippet-group-delay",room:"snippet-group-reverb"}[r.key]||"";a.innerHTML=`
        <button class="effect-toggle ${l}" data-effect-key="${r.key}">
          <span class="toggle-icon">▶</span> ${r.label}
        </button>
        <div class="effect-sliders-container" style="display: none;">
          <!-- Sliders will be added here -->
        </div>
      `,i.appendChild(a);const c=a.querySelector(".effect-toggle"),u=a.querySelector(".effect-sliders-container");c.addEventListener("click",async h=>{h.stopPropagation(),c.classList.toggle("active");const d=c.classList.contains("active");u.style.display=d?"block":"none";const f=c.querySelector(".toggle-icon");f.textContent=d?"▼":"▶",d&&u.children.length===0&&r.params.forEach(m=>{const g=Xi[m.key];if(!g)return;const y=document.createElement("div");y.className="slider-row",y.innerHTML=`
              <div class="slider-label-row">
                <label>${m.label}</label>
                <span class="slider-value">${g.default.toFixed(2)}${g.unit?" "+g.unit:""}</span>
              </div>
              <input type="range" class="effect-slider" data-effect-key="${m.key}" 
                     min="${g.min}" max="${g.max}" step="${g.step}" 
                     value="${g.default}" />
            `,u.appendChild(y);const b=y.querySelector(".effect-slider");b&&!b.dataset.hasListener&&(b.dataset.hasListener="true",b.addEventListener("input",async P=>{const k=parseFloat(P.target.value),w=y.querySelector(".slider-value");w&&(w.textContent=k.toFixed(2)+(g.unit?" "+g.unit:"")),await this.updateElementEffects(t)}))}),await this.updateElementEffects(t)})})}setupSynthesisDropdowns(e,t){const i=e.querySelector(".synthesis-content");if(!i)return;i.innerHTML="";const s=document.createElement("div");s.className="synthesis-sliders-container",[{key:"attack",label:"Attack",min:0,max:2,step:.01,default:.01,unit:"s"},{key:"decay",label:"Decay",min:0,max:2,step:.01,default:.1,unit:"s"},{key:"sustain",label:"Sustain",min:0,max:1,step:.01,default:.5,unit:""},{key:"release",label:"Release",min:0,max:5,step:.01,default:.1,unit:"s"}].forEach(a=>{const o=document.createElement("div");o.className="slider-row",o.innerHTML=`
        <div class="slider-label-row">
          <label>${a.label}</label>
          <span class="slider-value">${a.default.toFixed(2)}${a.unit?" "+a.unit:""}</span>
        </div>
        <input type="range" class="synth-slider ${a.key}-slider" 
               min="${a.min}" max="${a.max}" step="${a.step}" 
               value="${a.default}" />
      `,s.appendChild(o);const l=o.querySelector(".synth-slider");l&&!l.dataset.hasListener&&(l.dataset.hasListener="true",l.addEventListener("input",async c=>{const u=parseFloat(c.target.value),h=o.querySelector(".slider-value");h&&(h.textContent=u.toFixed(2)+(a.unit?" "+a.unit:"")),await this.updateElementSynthesis(t)}))}),i.appendChild(s)}async updateElementEffects(e){const t=document.querySelector(`[data-sound-id="${e}"]`);if(!t)return;const i=t.querySelectorAll(".effect-collapsible-row"),s={};i.forEach(a=>{const l=a.querySelector(".effect-toggle").classList.contains("active"),c=a.querySelectorAll(".effect-slider");l&&c.length>0&&c.forEach(u=>{const h=u.dataset.effectKey;h&&(s[h]=parseFloat(u.value))})}),this.elementEffects||(this.elementEffects={}),this.elementEffects[e]=s,console.log(`🎛️ Effects updated for ${e}:`,this.elementEffects[e]),this._effectsApplyTimers=this._effectsApplyTimers||new Map,this._effectsApplyTimers.has(e)&&clearTimeout(this._effectsApplyTimers.get(e));const r=setTimeout(()=>{this.applyEffectsAndFiltersToPattern(e),this._effectsApplyTimers.delete(e)},150);this._effectsApplyTimers.set(e,r)}async updateElementFilters(e){const t=document.querySelector(`[data-sound-id="${e}"]`);if(!t)return;const i=t.querySelectorAll(".filter-collapsible-row"),s={};i.forEach(a=>{const l=a.querySelector(".filter-toggle").classList.contains("active"),c=a.querySelectorAll(".filter-slider");l&&c.length>0&&c.forEach(u=>{const h=u.dataset.paramKey;h&&(s[h]=parseFloat(u.value))})}),this.elementFilters||(this.elementFilters={}),this.elementFilters[e]=s,console.log(`🔊 Filters updated for ${e}:`,this.elementFilters[e]),this._filtersApplyTimers=this._filtersApplyTimers||new Map,this._filtersApplyTimers.has(e)&&clearTimeout(this._filtersApplyTimers.get(e));const r=setTimeout(()=>{this.applyEffectsAndFiltersToPattern(e),this._filtersApplyTimers.delete(e)},150);this._filtersApplyTimers.set(e,r)}async updateElementSynthesis(e){const t=document.querySelector(`[data-sound-id="${e}"]`);if(!t)return;const i=t.querySelector(".attack-slider"),s=t.querySelector(".decay-slider"),r=t.querySelector(".sustain-slider"),a=t.querySelector(".release-slider"),o=i?parseFloat(i.value):.01,l=s?parseFloat(s.value):.1,c=r?parseFloat(r.value):.5,u=a?parseFloat(a.value):.1;this.elementSynthesis||(this.elementSynthesis={}),this.elementSynthesis[e]={attack:o,decay:l,sustain:c,release:u},console.log(`🎹 Synthesis updated for ${e}:`,this.elementSynthesis[e]),this._synthApplyTimers=this._synthApplyTimers||new Map,this._synthApplyTimers.has(e)&&clearTimeout(this._synthApplyTimers.get(e));const h=setTimeout(()=>{this.applyEffectsAndFiltersToPattern(e),this._synthApplyTimers.delete(e)},150);this._synthApplyTimers.set(e,h)}getPatternWithEffects(e,t){var c,u,h;if(!t)return t;const i=((c=this.elementEffects)==null?void 0:c[e])||{},s=((u=this.elementFilters)==null?void 0:u[e])||{},r=((h=this.elementSynthesis)==null?void 0:h[e])||{},a=(d,f)=>{if(f===void 0)return!1;const m=Xi[d];return m?f!==m.default:!0},o=(d,f)=>{if(f===void 0)return"";const m=Xi[d];return(m==null?void 0:m.unit)==="Hz"||d==="roomlp"?Math.round(f):f.toFixed(2)};let l=[];return a("delay",i.delay)&&l.push(`.delay(${o("delay",i.delay)})`),a("delayfeedback",i.delayfeedback)&&l.push(`.delayfeedback(${o("delayfeedback",i.delayfeedback)})`),a("delaytime",i.delaytime)&&l.push(`.delaytime(${o("delaytime",i.delaytime)})`),a("room",i.room)&&l.push(`.room(${o("room",i.room)})`),a("roomsize",i.roomsize)&&l.push(`.roomsize(${o("roomsize",i.roomsize)})`),a("roomlp",i.roomlp)&&i.roomlp<Xi.roomlp.default&&l.push(`.roomlp(${o("roomlp",i.roomlp)})`),a("roomdim",i.roomdim)&&l.push(`.roomdim(${o("roomdim",i.roomdim)})`),a("roomfade",i.roomfade)&&l.push(`.roomfade(${o("roomfade",i.roomfade)})`),a("iresponse",i.iresponse)&&l.push(`.iresponse(${o("iresponse",i.iresponse)})`),s.lpf!==void 0&&s.lpf<2e4&&l.push(`.lpf(${Math.round(s.lpf)})`),s.hpf!==void 0&&s.hpf>20&&l.push(`.hpf(${Math.round(s.hpf)})`),s.bpf!==void 0&&l.push(`.bpf(${Math.round(s.bpf)})`),s.bpq!==void 0&&s.bpq>0&&l.push(`.bpq(${s.bpq.toFixed(1)})`),s.lpq!==void 0&&s.lpq>0&&l.push(`.lpq(${s.lpq.toFixed(1)})`),s.hpq!==void 0&&s.hpq>0&&l.push(`.hpq(${s.hpq.toFixed(1)})`),r.attack!==void 0&&r.attack!==.01&&l.push(`.attack(${r.attack.toFixed(2)})`),r.decay!==void 0&&r.decay!==.1&&l.push(`.decay(${r.decay.toFixed(2)})`),r.sustain!==void 0&&r.sustain!==.5&&l.push(`.sustain(${r.sustain.toFixed(2)})`),r.release!==void 0&&r.release!==.1&&l.push(`.release(${r.release.toFixed(2)})`),l.length>0?t+l.join(""):t}async applyEffectsAndFiltersToPattern(e){const t=this.loadElementConfig(e);if(!t||!t.pattern)return;const i=t.pattern,s=this.getPatternWithEffects(e,i);s!==i&&console.log(`🎚️ Applying effects/filters/synthesis to ${e}: ${s}`),I.trackedPatterns&&I.trackedPatterns.has(e)?(await I.updatePatternInPlace(e,s,!0),this.updateMasterPatternDisplay()):I.isPlaying(e)||await I.cachePatternForElement(e,s)}applyChannelHistoryEntry(e,t){var r,a;if(!e||!t)return;const i=t.trim(),s=this.loadElementConfig(e)||{};Wn.markChannelSnapshot(e,i),this.saveElementConfig(e,{...s,pattern:i},!0),this.currentEditingElementId!==e&&this.openModal(e),setTimeout(()=>{$t("modal-pattern",i)},50),(a=(r=this.uiController)==null?void 0:r.updateStatus)==null||a.call(r,`Loaded history for ${e}. Save to apply.`)}applyMasterHistoryEntry(e){var i,s;if(!e)return;const t=e.trim();$t("master-pattern",t),I.masterPattern=t,Wn.markMasterSnapshot(t),this.updateMasterPatternDisplay(),(s=(i=this.uiController)==null?void 0:i.updateStatus)==null||s.call(i,"Loaded master pattern history entry.")}async saveChannelWithEffects(e){var a,o,l,c;const t=this.loadElementConfig(e);if(!t||!t.pattern){(o=(a=this.uiController)==null?void 0:a.updateStatus)==null||o.call(a,"Nothing to save for this channel.");return}const i=this.getPatternWithEffects(e,t.pattern),{getCurrentUser:s}=await Jt(async()=>{const{getCurrentUser:u}=await Promise.resolve().then(()=>ns);return{getCurrentUser:u}},void 0);if(await s()&&window.savePatternDialog)await window.savePatternDialog.show(i,"channel",e),window.savePatternDialog.setOnSave(async u=>{var d,f;const h={...t,pattern:i};this.saveElementConfig(e,h,!1),Wn.markChannelSnapshot(e,i),(f=(d=this.uiController)==null?void 0:d.updateStatus)==null||f.call(d,`Saved channel ${e} to cloud.`)});else{const u={...t,pattern:i};this.saveElementConfig(e,u,!1),Wn.markChannelSnapshot(e,i),(c=(l=this.uiController)==null?void 0:l.updateStatus)==null||c.call(l,`Saved channel ${e} locally.`)}}async saveMasterHistoryEntry(){var a,o,l,c;const e=document.getElementById("master-pattern"),i=((e?e.value:"")||"").trim();if(!i){(o=(a=this.uiController)==null?void 0:a.updateStatus)==null||o.call(a,"Master pattern is empty.");return}const{getCurrentUser:s}=await Jt(async()=>{const{getCurrentUser:u}=await Promise.resolve().then(()=>ns);return{getCurrentUser:u}},void 0);await s()&&window.savePatternDialog?(await window.savePatternDialog.show(i,"master",null),window.savePatternDialog.setOnSave(async u=>{var h,d;Wn.saveMasterVersion(i),Wn.markMasterSnapshot(i),I.masterPattern=i,this.updateMasterPatternDisplay(),(d=(h=this.uiController)==null?void 0:h.updateStatus)==null||d.call(h,"Saved master pattern to cloud.")})):(Wn.saveMasterVersion(i),Wn.markMasterSnapshot(i),I.masterPattern=i,this.updateMasterPatternDisplay(),(c=(l=this.uiController)==null?void 0:l.updateStatus)==null||c.call(l,"Saved master pattern locally."))}updateSynthesisSectionVisibility(e,t){const i=document.querySelector(`[data-sound-id="${e}"]`);if(!i)return;const s=i.querySelector(".synthesis-section");if(!s)return;const r=Ac(t);og(r)?(s.style.display="block",console.log(`🎹 Showing synthesis section for ${e} (synth pattern detected)`)):(s.style.display="none",console.log(`🎹 Hiding synthesis section for ${e} (not a synth pattern)`))}async handlePauseButton(e){const t=document.querySelector(`[data-sound-id="${e}"]`);if(!t)return;const i=t.querySelector(".element-indicator"),s=t.querySelector(".pause-button");(s==null?void 0:s.classList.contains("paused"))?(s==null||s.classList.remove("paused"),i==null||i.classList.remove("paused"),this.elementHasPattern(e)&&await I.triggerSound(e),console.log(`▶️ Resumed ${e}`)):(s==null||s.classList.add("paused"),i==null||i.classList.add("paused"),i==null||i.classList.remove("looped"),I.pauseSound(e),console.log(`⏸️ Paused ${e}`))}handleSoloButton(e,t){this.soloedElements.has(e)?(this.soloedElements.delete(e),t.classList.remove("active"),console.log(`🎵 Unsolo: ${e}`)):(this.soloedElements.add(e),t.classList.add("active"),console.log(`🎵 Solo: ${e}`)),this.updateElementAudioStates()}handleMuteButton(e,t){this.mutedElements.has(e)?(this.mutedElements.delete(e),t.classList.remove("active"),console.log(`🔊 Unmute: ${e}`)):(this.mutedElements.add(e),t.classList.add("active"),console.log(`🔇 Mute: ${e}`)),this.updateElementAudioStates()}updateElementAudioStates(){const e=this.soloedElements.size>0;Lt.elements.forEach(t=>{const i=t.id,s=this.mutedElements.has(i),r=this.soloedElements.has(i);let a;s?a=0:e?a=r?1:0:a=1;const o=document.querySelector(`[data-sound-id="${i}"]`);if(o){const l=o.querySelector(".gain-slider"),c=l?parseFloat(l.value):.8;I.setElementGain(i,c*a)}}),I.updateMasterPattern(this.soloedElements,this.mutedElements),this.updateMasterPatternDisplay()}activateElement(e,t,i){if(console.log(`🎵 Activating ${e} via ${i}`),this.masterActive&&I.trackedPatterns.has(e)){console.log(`   ⚠️ Master is playing and ${e} is tracked - ignoring individual activation`),Ut.updateStatus(`Cannot play ${e} individually while master is active. Stop master first.`);return}Ut.setElementState(t,"focus"),this.updateStatusDots(e,this.elementHasPattern(e),!1),Ut.updateStatus("Ready")}deactivateElement(e,t,i){if(console.log(`🔇 Deactivating ${e} (was triggered by ${i})`),this.activeElements.has(e)){this.activeElements.delete(e),console.log(`   Stopping sound for ${e}`),I.stopSound(e);const s=this.elementHasPattern(e);this.updateStatusDots(e,s,!1),Ut.setElementState(t,null),this.updateActiveElementsDisplay(),this.activeElements.size===0&&Ut.updateStatus("Ready")}}updateActiveElementsDisplay(){const e=Array.from(this.activeElements).map(i=>{const s=Lt.getElementConfig(i);return(s==null?void 0:s.description)||i});Ut.updateActiveElements(e);const t=document.getElementById("slots-info");if(t){const i=I.trackedPatterns?Array.from(I.trackedPatterns.keys()):[],s=new Set([...this.activeElements,...i]);if(s.size===0)t.textContent="None active";else{const r=Array.from(s).map(a=>{var f,m;const o=(f=I.strudelPatternSlots)==null?void 0:f.get(a),l=(m=I.trackedPatterns)==null?void 0:m.has(a),c=this.activeElements.has(a);let u="";try{const g=localStorage.getItem(`element-config-${a}`);g&&(u=JSON.parse(g).pattern||"")}catch{}if(!u){const g=Lt.getElementConfig(a);u=(g==null?void 0:g.pattern)||""}let h="";c&&l?h=" (A+M)":c?h=" (A)":l&&(h=" (M)");const d=o?`${a}→${o}${h}`:`${a}${h}`;if(u&&u.trim()){const g=u.length>80?u.substring(0,80)+"...":u;return`${d}: ${g}`}else return d});t.textContent=r.join(" | ")}}}elementHasPattern(e){const t=Lt.getElementConfig(e);if(t!=null&&t.pattern&&t.pattern.trim()!=="")return!0;try{const i=localStorage.getItem(`element-config-${e}`);if(i){const s=JSON.parse(i);if(s.pattern&&s.pattern.trim()!=="")return!0}}catch{}return!1}updateStatusDots(e,t,i){const s=document.querySelector(`[data-sound-id="${e}"]`);if(!s)return;const r=s.querySelector(".loaded-dot"),a=s.querySelector(".playing-dot"),o=s.querySelector(".element-circle");if(r&&(t?r.classList.remove("active"):r.classList.add("active")),a){const l=this.loadElementConfig(e);l&&l.pattern&&l.pattern.trim()!==""?(a.classList.add("active"),i?a.classList.add("is-playing"):a.classList.remove("is-playing")):(a.classList.remove("active"),a.classList.remove("is-playing"))}o&&(i?(o.classList.add("playing"),console.log(`🟢 Circle turned green for ${e} (playing)`)):o.classList.remove("playing"))}isDrumPattern(e){if(!e||typeof e!="string")return!1;const t=e.match(/sound\(["']([^"']+)["']\)|s\(["']([^"']+)["']\)/);if(!t)return!1;const i=t[1]||t[2];return i?i.split(/\s+/).filter(a=>a.trim()).some(a=>Yy.hasOwnProperty(a.toLowerCase())):!1}convertNumericPatternToNoteNames(e,t,i){if(!e||!i)return e;const s=y=>typeof y=="string"&&/[b]/i.test(y),r=new Map([["Abb","G"],["Bbb","A"],["Cbb","Bb"],["Dbb","C"],["Ebb","D"],["Fbb","Eb"],["Gbb","F"],["A##","B"],["B##","C#"],["C##","D"],["D##","E"],["E##","F#"],["F##","G"],["G##","A"],["Fb","E"],["Cb","B"],["E#","F"],["B#","C"]]),a=new Map([["A#","Bb"],["C#","Db"],["D#","Eb"],["F#","Gb"],["G#","Ab"]]);function o(y,b){const P=y.match(/^([A-Ga-g])([#b]{0,2})(-?\d+)?$/);if(!P)return y;const k=P[1].toUpperCase(),w=P[2]||"",C=P[3]||"",$=`${k}${w}`;if(r.has($))return`${r.get($)}${C}`;if(b&&w==="#"){const A=a.get(`${k}#`);if(A)return`${A}${C}`}return`${k}${w}${C}`}const c={major:"major",minor:"minor",chromatic:"chromatic",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic",ionian:"major",aeolian:"minor","melodic minor":"melodic minor","dorian b2":"dorian b2","lydian augmented":"lydian augmented","lydian dominant":"lydian dominant","mixolydian b6":"mixolydian b6","locrian #2":"locrian #2",altered:"altered","harmonic minor":"harmonic minor","locrian #6":"locrian #6","ionian #5":"ionian #5","dorian #4":"dorian #4","phrygian dominant":"phrygian dominant","lydian #2":"lydian #2",ultralocrian:"ultralocrian","harmonic major":"harmonic major","dorian b5":"dorian b5","phrygian b4":"phrygian b4","lydian b3":"lydian b3","mixolydian b2":"mixolydian b2","lydian augmented #2":"lydian augmented #2","locrian bb7":"locrian bb7","major pentatonic":"major pentatonic","suspended pentatonic":"suspended pentatonic","man gong":"man gong",ritusen:"ritusen","minor pentatonic mode 5":"minor pentatonic","minor pentatonic":"minor pentatonic","blues minor pentatonic":"minor pentatonic","major pentatonic mode 3":"major pentatonic",egyptian:"egyptian","minor pentatonic mode 5":"minor pentatonic","whole tone":"whole tone","half-whole diminished":"dominant diminished","whole-half diminished":"diminished","minor blues":"blues"}[i]||i;let u="C";if(t){const y=t.trim().match(/^([a-gA-G])([#b]?)/);y?u=`${y[1].toUpperCase()}${y[2]||""}`:u=t.trim()}const h=`${u} ${c}`,d=Lo.get(h);if(!d||!d.notes||d.notes.length===0)return console.warn(`⚠️ Could not get scale notes for "${h}"`),e;const f=s(u),m=d.notes.map(y=>o(`${y}`,f).replace(/-?\d+$/,""));console.log(`🎼 Scale "${h}" notes:`,m);const g=/\b(n|note)\s*\(\s*(["'])([^"']+)\2\s*\)/g;return e.replace(g,(y,b,P,k)=>{const w=/(\s+|[,;:<>()[\]{}|\\/]+|\*+)/g,C=[];let $=0,A;for(;(A=w.exec(k))!==null;)A.index>$&&C.push({type:"number",value:k.substring($,A.index)}),C.push({type:"separator",value:A[0]}),$=A.index+A[0].length;$<k.length&&C.push({type:"number",value:k.substring($)});const Q=[];for(const q of C)if(q.type==="separator")Q.push(q.value);else{const W=parseInt(q.value.trim(),10);if(isNaN(W))Q.push(q.value);else{const U=m.length||1,Z=Math.floor(W/U),Y=(W%U+U)%U,ne=m[Y],ve=4+Z,Ce=o(`${ne}${ve}`,f);Q.push(Ce)}}return`note(${P}${Q.join("")}${P})`})}getAllScaleNotesAsPattern(e,t){if(!t)return"";const s={major:"major",minor:"minor",chromatic:"chromatic",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic",ionian:"major",aeolian:"minor","dorian b2":"dorian b2","lydian augmented":"lydian augmented","lydian dominant":"lydian dominant","mixolydian b6":"mixolydian b6","locrian #2":"locrian #2",altered:"altered","harmonic minor":"harmonic minor","locrian #6":"locrian #6","ionian #5":"ionian #5","dorian #4":"dorian #4","phrygian dominant":"phrygian dominant","lydian #2":"lydian #2",ultralocrian:"ultralocrian","harmonic major":"harmonic major","dorian b5":"dorian b5","phrygian b4":"phrygian b4","lydian b3":"lydian b3","mixolydian b2":"mixolydian b2","lydian augmented #2":"lydian augmented #2","locrian bb7":"locrian bb7","major pentatonic":"major pentatonic","minor pentatonic":"minor pentatonic","suspended pentatonic":"suspended pentatonic","man gong":"man gong",ritusen:"ritusen","major pentatonic mode 3":"major pentatonic","minor pentatonic mode 5":"minor pentatonic","blues minor pentatonic":"minor pentatonic","whole tone":"whole tone","half-whole diminished":"dominant diminished","whole-half diminished":"diminished","minor blues":"blues"}[t]||t;let r="C";if(e){const u=e.trim().match(/^([a-gA-G])([#b]?)/);u?r=`${u[1].toUpperCase()}${u[2]||""}`:r=e.trim()}const a=`${r} ${s}`,o=Lo.get(a);if(!o||!o.notes||o.notes.length===0)return console.warn(`⚠️ Could not get scale notes for "${a}"`),"";const l=o.notes;return console.log(`🎼 Scale "${a}" notes:`,l),`n("${Array.from({length:l.length},(u,h)=>h).join(" ")}")`}getAllScaleNotesAsNoteNames(e,t){if(!t)return"";const s={major:"major",minor:"minor",harmonicMinor:"harmonic minor",melodicMinor:"melodic minor",dorian:"dorian",phrygian:"phrygian",lydian:"lydian",mixolydian:"mixolydian",locrian:"locrian",blues:"blues",pentatonicMajor:"major pentatonic",pentatonicMinor:"minor pentatonic"}[t]||t;let r="C";if(e){const u=e.trim().match(/^([a-gA-G])([#b]?)/);u?r=`${u[1].toUpperCase()}${u[2]||""}`:r=e.trim()}const a=`${r} ${s}`,o=Lo.get(a);if(!o||!o.notes||o.notes.length===0)return console.warn(`⚠️ Could not get scale notes for "${a}"`),"";const l=o.notes;return console.log(`🎼 Scale "${a}" notes:`,l),`note("${l.map(u=>`${u}4`).join(" ")}")`}resetAll(){console.log("🔄 Resetting all elements and master pattern..."),I.stopAllSounds(),document.querySelectorAll(".sound-element").forEach(s=>{const r=s.dataset.soundId;r&&parseInt(r.replace("element-",""))>4&&(console.log(`🗑️ Removing dynamically created element: ${r}`),s.remove())}),this.elementCounter=4,console.log("🗑️ Clearing all localStorage..."),localStorage.clear(),I.trackedPatterns.clear(),I.updateMasterPattern(),this.masterPatternField&&($t("master-pattern",""),this.masterPatternField.placeholder="Combined pattern will appear here..."),document.querySelectorAll(".sound-element").forEach(s=>{const r=s.dataset.soundId;if(r){const a=Lt.getElementConfig(r);a&&(a.pattern="",a.description="No sound assigned",a.title="",a.sampleUrl="",a.bank=void 0,a.key=void 0,a.scale=void 0,a.keepNotesAsWritten=!1),I.removeElementFromMaster(r),di(r,""),this.updateStatusDots(r,!1,!1);const o=s.querySelector(".element-circle");o&&o.classList.remove("playing");const l=s.querySelector(".master-status-indicator");l&&l.classList.remove("active");const c=s.querySelector(".gain-slider"),u=s.querySelector(".pan-slider");c&&(c.value=.8),u&&(u.value=0),s.querySelectorAll(".filter-collapsible-row").forEach(m=>{const g=m.querySelector(".filter-toggle"),y=m.querySelector(".filter-sliders-container");if(g){g.classList.remove("active");const b=g.querySelector(".toggle-icon");b&&(b.textContent="▶")}y&&(y.style.display="none",y.innerHTML="")}),s.querySelectorAll(".effect-collapsible-row").forEach(m=>{const g=m.querySelector(".effect-toggle"),y=m.querySelector(".effect-sliders-container");if(g){g.classList.remove("active");const b=g.querySelector(".toggle-icon");b&&(b.textContent="▶")}y&&(y.style.display="none",y.innerHTML="")});const f=s.querySelector(".synthesis-section");if(f){f.style.display="none";const m=f.querySelector(".synthesis-content");m&&(m.innerHTML="")}}}),this.activeElements.clear(),this.mutedElements.clear(),this.soloedElements.clear(),this.elementEffects={},this.elementFilters={},this.elementSynthesis={},this.masterActive=!1,this.currentEditingElementId=null,this.selectedVisualizer="scope";const i=document.getElementById("visualizer-select");if(i&&(i.value="scope"),this.masterPunchcardCanvas){const s=this.masterPunchcardCanvas.getContext("2d");s&&s.clearRect(0,0,this.masterPunchcardCanvas.width,this.masterPunchcardCanvas.height)}this.updateActiveElementsDisplay(),this.updateMasterPatternDisplay(),this.updateMasterIndicators(),Ut.updateStatus("✅ All cleared")}setAllElementsNotLoaded(){Lt.elements.forEach(e=>{this.updateStatusDots(e.id,!1,!1)}),console.log("🔴 All element status dots marked as NOT loaded (red)")}setAllElementsLoaded(){Lt.elements.forEach(e=>{let t=!1;if(e.pattern&&e.pattern.trim()!==""&&(t=!0),!t)try{const i=localStorage.getItem(`element-config-${e.id}`);if(i){const s=JSON.parse(i);s.pattern&&s.pattern.trim()!==""&&(t=!0)}}catch{}this.updateStatusDots(e.id,t,!1)}),console.log("✅ Element status dots updated based on configured patterns")}setupAudioInitialization(){const e=async t=>{I.isAudioReady()||(await I.initialize()?(Ut.updateStatus("Audio enabled - Loading sounds..."),document.removeEventListener("click",e),document.removeEventListener("touchstart",e),document.removeEventListener("keydown",e),document.removeEventListener("mousedown",e)):Ut.updateStatus("Click to enable audio (required for sound playback)"))};document.addEventListener("click",e,{once:!1}),document.addEventListener("touchstart",e,{once:!1}),document.addEventListener("keydown",e,{once:!1}),document.addEventListener("mousedown",e,{once:!1})}loadAllElementConfigs(){Lt.elements.forEach(e=>{const t=this.loadElementConfig(e.id);if(t){const i=t.title&&t.title.trim()?t.title:t.bank&&t.bank.trim()?Ea[t.bank]||t.bank.replace("github:tidalcycles/",""):"";di(e.id,i),t.pattern!==void 0&&(e.pattern=t.pattern),t.title!==void 0&&(e.description=t.title)}else di(e.id,e.description||"")})}migrateLocalStorageQuotes(){try{console.log("🔧 Migrating localStorage to fix fancy quotes...");let e=0;for(let t=0;t<localStorage.length;t++){const i=localStorage.key(t);if(i&&i.startsWith("element-config-"))try{const s=localStorage.getItem(i);if(s){const r=JSON.parse(s);if(r&&r.pattern){const a=r.pattern,o=a.replace(/[""]/g,'"').replace(/['']/g,"'");a!==o&&(r.pattern=o,localStorage.setItem(i,JSON.stringify(r)),e++,console.log(`  ✅ Fixed quotes in ${i}`))}}}catch(s){console.warn(`  ⚠️ Could not migrate ${i}:`,s)}}e>0?console.log(`✅ Migrated ${e} patterns with fancy quotes`):console.log("✅ No patterns needed migration")}catch(e){console.error("Error during localStorage migration:",e)}}loadElementConfig(e){try{const t=localStorage.getItem(`element-config-${e}`);if(t){const i=JSON.parse(t);if(i&&i.pattern&&(i.pattern=i.pattern.replace(/[""]/g,'"').replace(/['']/g,"'"),i.pattern=Ac(i.pattern)),i&&i.bank){const s=To(i.bank);s!==i.bank&&console.log(`🔁 Normalized synth bank from "${i.bank}" to "${s}" for ${e}`),i.bank=s}return i}}catch(t){console.error(`Error loading config for ${e}:`,t)}return null}saveElementConfig(e,t,i=!1){try{if(t.bank&&typeof t.bank=="string"){const u=To(t.bank);u!==t.bank&&(console.log(`🔁 Normalized bank selection from "${t.bank}" to "${u}" before saving`),t.bank=u)}if(t.pattern&&typeof t.pattern=="string"){const u=Ac(t.pattern);u!==t.pattern&&(console.log("🔁 Updated pattern to use canonical synth names before saving"),t.pattern=u),Wn.saveChannelVersion(e,t.pattern)}localStorage.setItem(`element-config-${e}`,JSON.stringify(t));const s=Lt.getElementConfig(e);s&&(t.pattern!==void 0&&(s.pattern=t.pattern),t.title!==void 0&&(s.description=t.title),t.sampleUrl&&t.sampleUrl.trim()!==""?(s.audioFile=t.sampleUrl,s.type="audio"):(s.audioFile=void 0,s.type="strudel"));const r=t.title&&t.title.trim()?t.title:t.bank?Ea[t.bank]||t.bank.replace("github:tidalcycles/",""):"";di(e,r);const a=document.querySelector(`[data-sound-id="${e}"]`);if(a){const u=t.pattern&&og(t.pattern),h=a.querySelector(".synthesis-section");h&&u&&(h.style.display="block",console.log(`✅ ${e}: Synthesis section shown for synth pattern`))}const o=t.pattern&&t.pattern.trim()!=="",l=this.activeElements.has(e);this.updateStatusDots(e,o,!1),this.updateSynthesisSectionVisibility(e,t.pattern);const c=I.masterActive;if(t.pattern!==void 0&&(I.invalidatePatternCache(e),I.preEvaluatePattern(e,t.pattern).catch(u=>{console.log(`⚠️ Failed to pre-evaluate pattern for ${e}:`,u)})),!i&&t.pattern!==void 0&&t.pattern.trim()!==""){const u=document.querySelector(`[data-sound-id="${e}"]`);let h=.8,d=0;if(u){const m=u.querySelector(".gain-slider"),g=u.querySelector(".pan-slider");m&&(h=parseFloat(m.value)),g&&(d=parseFloat(g.value))}const f=I.saveElementToMaster(e,t.pattern,h,d);if(f.success){if(I.updateMasterPattern(this.soloedElements,this.mutedElements),!c&&I.masterActive){if(typeof I.stopMasterPattern=="function")try{I.stopMasterPattern()}catch(m){console.warn("⚠️ Could not stop master after save:",m)}I.masterActive=!1}if(!c&&window.strudel&&window.strudel.scheduler&&window.strudel.scheduler.started)try{window.strudel.scheduler.stop()}catch(m){console.warn("⚠️ Could not stop scheduler after save:",m)}this.updateMasterPatternDisplay(),this.updateMasterIndicators(),console.log(`✅ Pattern saved to master for ${e}`)}else console.error(`❌ Failed to save pattern to master for ${e}:`,f.error)}console.log(`✅ Saved config for ${e}:`,t)}catch(s){console.error(`Error saving config for ${e}:`,s)}}setupModal(){const e=document.getElementById("config-modal");if(!e)return;const t=this,i=document.getElementById("modal-pattern-bank"),s=document.getElementById("modal-sample-url"),r=document.getElementById("modal-sample-name"),a=document.getElementById("modal-add-sample-btn"),o=document.getElementById("modal-sample-file"),l=M=>{const _={baseUrl:"./",samplePath:""};if(!M||typeof M!="string")return _;const T=M.trim();if(!T)return _;try{const N=new URL(T),L=N.pathname||"",z=L.endsWith("/")&&L.length>1?L.slice(0,-1):L,V=z.lastIndexOf("/");if(V!==-1){const G=z.slice(V+1)||"",ae=z.slice(0,V+1);return{baseUrl:`${N.origin}${ae}`,samplePath:G||T}}return{baseUrl:`${N.origin}/`,samplePath:z||N.origin}}catch{const N=T.replace(/\\/g,"/"),L=N.lastIndexOf("/");return L!==-1?{baseUrl:N.slice(0,L+1),samplePath:N.slice(L+1)||N}:{baseUrl:"./",samplePath:N||"sample.wav"}}},c=(M="")=>M.replace(/[\r\n]+/g,"").trim(),u=(M="")=>JSON.stringify(M??""),h=(M,_,T)=>{const N=u(M||"sample"),L=c(T||M||""),z=u(L),V=c(_||"./"),G=u(V||"./"),ae=`samples({
  ${N}: ${z}
}, { baseUrl: ${G} })`,pe=`sound(${N})`,se=`(${ae},
 ${pe})`,He=(dt("modal-pattern")||"").trim(),We=He?`${He}

${se}`:se;$t("modal-pattern",We),typeof re=="function"&&re(),r.value="",s.value="",o&&(o.value=""),r.focus()};a&&a.addEventListener("click",()=>{if(!r||!s)return;const M=r.value.trim(),_=s.value.trim(),T=o&&o.files&&o.files.length>0;if(!M||!_&&!T){alert("Please provide a Sample Name and either a Sample URL or select a file.");return}if(_){const{baseUrl:N,samplePath:L}=l(_);h(M,N,L||M)}else if(T){const N=o.files[0],L=new FileReader;L.onload=z=>{const V=z.target.result;typeof V=="string"&&V.length>0?h(M,"./",V):alert("Unable to read the selected file. Please try again.")},L.onerror=()=>{alert("Unable to read the selected file. Please try again.")},L.readAsDataURL(N)}});const d=()=>{i&&i.querySelectorAll('option[data-source="specialty-vcsl"]').forEach(M=>M.remove())},f=(M=i?i.value:"")=>{if(!i)return;const _=i.value,T=M??_;let N=Array.from(i.children).find(se=>se.tagName==="OPTGROUP"&&se.label&&se.label.toLowerCase()==="drums"),L=Array.from(i.children).find(se=>se.tagName==="OPTGROUP"&&se.label&&se.label.toLowerCase().includes("waveform")),z=Array.from(i.children).find(se=>se.tagName==="OPTGROUP"&&se.label&&se.label.toLowerCase().includes("synth")),V=Array.from(i.children).find(se=>se.tagName==="OPTGROUP"&&se.label===Gm),G=Array.from(i.children).find(se=>se.tagName==="OPTGROUP"&&se.label===Wm);N||(N=document.createElement("optgroup"),N.label="Drums",i.insertBefore(N,i.firstChild)),L||(L=document.createElement("optgroup"),L.label="Basic Waveforms",N.nextSibling?i.insertBefore(L,N.nextSibling):i.appendChild(L)),z||(z=document.createElement("optgroup"),z.label="Sample-based Synths",L.nextSibling?i.insertBefore(z,L.nextSibling):i.appendChild(z)),V||(V=document.createElement("optgroup"),V.label=Gm,z.nextSibling?i.insertBefore(V,z.nextSibling):i.appendChild(V)),G||(G=document.createElement("optgroup"),G.label=Wm,i.appendChild(G)),N.innerHTML="";const ae=document.createElement("option");ae.value="",ae.textContent="Default",N.appendChild(ae),Array.from(Ar).sort((se,de)=>$o(se).localeCompare($o(de))).forEach(se=>{const de=document.createElement("option");de.value=se,de.textContent=$o(se),N.appendChild(de)}),V.innerHTML="",G.innerHTML="",zh.forEach(({value:se,label:de})=>{const He=document.createElement("option");He.value=se,He.textContent=de,se.toLowerCase()==="vcsl"?G.appendChild(He):V.appendChild(He)}),d(),Array.isArray(sr)&&sr.length>0?sr.forEach(se=>{const de=document.createElement("option");de.value=se.optionValue,de.textContent=se.label,de.dataset.source="specialty-vcsl",de.dataset.instrument=se.value,G.appendChild(de)}):kr||jM().then(()=>{f(M)}).catch(()=>{}),T&&i.querySelector(`option[value="${T}"]`)?i.value=T:_&&i.querySelector(`option[value="${_}"]`)?i.value=_:i.value=""};f();const m=document.getElementById("modal-drum-grid-section"),g=document.getElementById("modal-drum-grid-timesig"),y=(()=>{if(typeof localStorage>"u")return null;try{return localStorage.getItem("drumGridEditorMode")}catch{return null}})(),b={active:!1,totalSteps:0,built:!1,patternEditorEnabled:y?y==="code":!0,updatingFromPattern:!1,updatingFromGrid:!1,currentBankRows:null,checkboxes:{},numBars:1,currentBar:1,barTokens:[]},P=document.getElementById("modal-pattern-editor-select"),k=e.querySelector(".pattern-label-row");let w=e.querySelector(".pattern-snippet-container"),C=w?w.querySelector(".pattern-snippet-list"):null,$=w?w.querySelector(".pattern-snippet-search"):null;const A=document.getElementById("modal-presets-toggle"),Q=document.getElementById("modal-presets-content"),q=document.getElementById("modal-drum-presets"),W=document.getElementById("modal-tonal-presets"),U=document.getElementById("modal-sampler-presets"),Z=document.getElementById("modal-preview-btn"),Y=M=>{!A||!Q||(A.setAttribute("aria-expanded",M.toString()),Q.classList.toggle("is-open",M),Q.setAttribute("aria-hidden",(!M).toString()))},ne=()=>{Q&&Q.hasAttribute("hidden")&&Q.removeAttribute("hidden"),Y(!1)},re=()=>{if(!Z)return;const M=dt("modal-pattern"),_=!!(M&&M.trim().length>0);Z.disabled=!_};let ve=null;(async()=>{var V;const M=dt("modal-pattern"),_=$?$.value.trim().toLowerCase():"",[T,N]=await Promise.all([ag(M),qh()]);if(!w){w=document.createElement("div"),w.className="pattern-snippet-container",w.setAttribute("aria-disabled","false");const G=document.createElement("span");G.className="pattern-snippet-heading",G.textContent="Add to pattern:",w.appendChild(G),$=document.createElement("input"),$.type="search",$.className="pattern-snippet-search",$.setAttribute("placeholder","Search tags…"),$.setAttribute("aria-label","Search snippet tags"),w.appendChild($),C=document.createElement("div"),C.className="pattern-snippet-list",w.appendChild(C),k?k.insertAdjacentElement("afterend",w):(V=e.querySelector(".form-group"))==null||V.insertAdjacentElement("afterbegin",w)}C||(C=w.querySelector(".pattern-snippet-list")),$||($=w.querySelector(".pattern-snippet-search")),this.selectedTagKey||(this.selectedTagKey=null);let L=this.selectedTagKey;const z=(G,ae,pe,se)=>{Gn(),G.innerHTML="";const de=!!(se&&se.trim().length),He=se||"",We=new Map,Ge=[];ae.forEach(oe=>{const Ve=typeof oe=="string"?oe:oe.snippet,je=typeof oe=="string"?"other":oe.groupId||"other",gt=typeof oe=="string"?"":oe.className||"",st=(typeof oe=="string"?"Other":oe.heading)||"Other",it=$i(Ve),Tt=pe.get(it);let Me=ig(Ve,Tt);it==="bank"&&Me.includes("display bank(bank)")&&(Me="bank()");const Qt=Me.replace(/^[.]+/,"");let _t=Qt;const we=Qt.match(/^sound\s*\(\s*["']([^"']+)["']\s*\)/i);we&&we[1]?_t=`sound("${we[1]}")`:_t=_t.replace(/\([^)]*\)/g,"()");const Ft=_t.toLowerCase(),Zi=st.toLowerCase();He&&!Ft.includes(He)&&!it.includes(He)&&!Zi.includes(He)||(We.has(je)||(We.set(je,{id:je,heading:st,className:gt,items:[]}),Ge.push(We.get(je))),We.get(je).items.push({snippet:Ve,insertionSnippet:Qt,displayLabel:_t,key:it,className:gt,heading:st,referenceEntry:Tt}))}),Ge.sort((oe,Ve)=>{const je=(oe.heading||"").toLowerCase(),gt=(Ve.heading||"").toLowerCase();return je.localeCompare(gt)});let Ae=!1;const fe=new Map;if(ae.forEach(oe=>{const Ve=typeof oe=="string"?oe:oe.snippet,je=$i(Ve);fe.has(je)||fe.set(je,oe)}),Ge.forEach(oe=>{if(!Array.isArray(oe.items)||!oe.items.length)return;oe.items.sort((Me,Qt)=>{const _t=(Me.displayLabel||"").toLowerCase(),we=(Qt.displayLabel||"").toLowerCase();return _t<we?-1:_t>we?1:0}),Ae=!0;const Ve=document.createElement("div");Ve.className="pattern-snippet-group",Ve.dataset.groupId=oe.id;const je=n3.has(oe.id)?i3:t3,gt=da.has(oe.id)?da.get(oe.id):je.has(oe.id),st=de?!0:gt;da.has(oe.id)||da.set(oe.id,gt);const it=document.createElement("button");it.type="button",it.className="pattern-snippet-group-heading",it.textContent=oe.heading,it.setAttribute("aria-expanded",st?"true":"false");const Tt=document.createElement("div");Tt.className="pattern-snippet-group-items",st||Ve.classList.add("collapsed"),it.addEventListener("click",()=>{Gn();const Qt=!Ve.classList.toggle("collapsed");it.setAttribute("aria-expanded",Qt?"true":"false"),da.set(oe.id,Qt)}),oe.items.forEach(Me=>{var B,_e,Wt,Ke;const Qt=document.createElement("div");Qt.className="pattern-snippet-item",Qt.dataset.snippetKey=$i(Me.snippet);const _t=$i(Me.snippet);let we=Xi[_t];if(!we&&Me.snippet){const Te=Me.snippet.match(/\(([a-zA-Z_]+):number\)/),ge=Me.snippet.match(/\(([0-9.]+)\)/);if(Te||ge){let Le=ge?parseFloat(ge[1]):null;if(Te&&!Le){const ct=Te[1];Xi[_t]?we=Xi[_t]:ct.includes("attack")||ct.includes("decay")||ct.includes("release")?we={min:0,max:2,step:.01,default:.01,unit:"s"}:ct.includes("sustain")||ct.includes("modulation")||ct.includes("env")?we={min:0,max:1,step:.01,default:.5,unit:""}:we={min:0,max:1,step:.01,default:.5,unit:""}}else if(ge&&Le!==null){let ct=Math.max(0,Le*.1),lt=Le*10,ze=Le<1?.01:Le<10?.1:1;Le>=20&&Le<=2e4?(ct=20,lt=2e4,ze=10):Le>=0&&Le<=1?(ct=0,lt=1,ze=.01):Le>=-1&&Le<=1&&(ct=-1,lt=1,ze=.01),we={min:ct,max:lt,step:ze,default:Le,unit:""}}}}if(!!we){const Te=document.createElement("button");Te.type="button";const ge=yc(Me.snippet),Le=!ge&&Me.groupId!=="core"&&Oc(Me.snippet),ct=[Me.className||"",ge,Le?"pattern-snippet-tag-core":""].filter(Boolean).join(" ");Te.className=`pattern-snippet-tag ${ct}`.trim(),Te.dataset.snippet=Me.snippet,Te.dataset.insertion=Me.insertionSnippet;let lt=Me.displayLabel;const ze=lt.match(/\(([a-zA-Z_]+):number\)/);ze?lt=`${ze[1]}()`:lt.includes('sound("')&&lt.includes('")')?lt=Me.displayLabel:lt=lt.replace(/\([^)]*\)/g,"()"),Te.textContent=lt,Te.setAttribute("aria-label",Me.displayLabel);const ht=document.createElement("div");ht.className="slider-row snippet-slider-row",ht.style.display="none",ht.style.width="100%",ht.style.marginTop="8px",ht.style.padding="8px",ht.style.backgroundColor="rgba(102, 126, 234, 0.05)",ht.style.border="1px solid rgba(102, 126, 234, 0.2)",ht.style.borderRadius="4px";const On=document.createElement("label");On.textContent=Me.displayLabel.replace(/\(\)$/,""),On.style.fontSize="0.75rem",On.style.fontWeight="600",On.style.color="#4c51bf",On.style.marginBottom="4px";const Rt=document.createElement("div");Rt.style.display="flex",Rt.style.alignItems="center",Rt.style.gap="8px",Rt.style.width="100%";const qe=document.createElement("input");qe.type="range",qe.className="snippet-slider",qe.dataset.snippet=Me.snippet,qe.dataset.tagKey=_t,qe.style.flex="1";let rt;const ke=_t,wt=we.unit==="Hz"&&(_t==="lpf"||_t==="hpf"||_t==="bpf"||_t==="cutoff"||_t==="roomlp");if(wt){qe.min="0",qe.max="1",qe.step="0.001";const Pn=(()=>{const xn=dt("modal-pattern")||"",xe=new RegExp(`\\.${ke}\\(([^)]+)\\)`,"g").exec(xn);return xe?xe[1]:null})();let Yt=Pn?parseFloat(Pn):we.default;Yt=Math.max(we.min,Math.min(we.max,Yt));const ui=mc(Yt);qe.value=String(ui),rt=document.createElement("span"),rt.className="slider-value",rt.style.minWidth="60px",rt.style.textAlign="right",rt.style.fontSize="0.75rem",rt.style.fontWeight="600",rt.textContent=Math.round(Yt)+" "+we.unit,qe.addEventListener("input",xn=>{const nn=parseFloat(xn.target.value),xe=gc(nn);rt.textContent=Math.round(xe)+" "+we.unit})}else{qe.min=String(we.min),qe.max=String(we.max),qe.step=String(we.step);const Pn=(()=>{const Yt=dt("modal-pattern")||"",xn=new RegExp(`\\.${ke}\\(([^)]+)\\)`,"g").exec(Yt);return xn?xn[1]:null})();qe.value=String(Pn||we.default),rt=document.createElement("span"),rt.className="slider-value",rt.style.minWidth="60px",rt.style.textAlign="right",rt.style.fontSize="0.75rem",rt.style.fontWeight="600",rt.textContent=qe.value+(we.unit?" "+we.unit:""),qe.addEventListener("input",Yt=>{const ui=Yt.target.value;rt.textContent=ui+(we.unit?" "+we.unit:"")})}qe.addEventListener("change",Pi=>{let Pn=Pi.target.value;if(wt){const xe=parseFloat(Pn),on=gc(xe);Pn=Math.round(on),rt.textContent=Pn+" "+we.unit}else rt.textContent=Pn+(we.unit?" "+we.unit:"");const Yt=dt("modal-pattern")||"",ui=`.${ke}(${Pn})`,xn=new RegExp(`\\.${ke}\\([^)]*\\)`,"g");if(xn.test(Yt)){const xe=Yt.replace(xn,ui);$t("modal-pattern",xe)}else{const xe=Yt.trim()+ui;$t("modal-pattern",xe)}}),Te.addEventListener("click",Pi=>{if(Pi.stopPropagation(),Pi.preventDefault(),ht.style.display==="none"||ht.style.display===""){ht.style.display="flex",ht.style.flexDirection="column",ht.style.gap="4px";const Yt=dt("modal-pattern")||"",xn=new RegExp(`\\.${ke}\\(([^)]+)\\)`,"g").exec(Yt);if(xn){let nn=xn[1];if(wt){const xe=parseFloat(nn),on=Math.max(we.min,Math.min(we.max,xe)),As=mc(on);qe.value=String(As),rt.textContent=Math.round(on)+" "+we.unit}else qe.value=nn,rt.textContent=nn+(we.unit?" "+we.unit:"")}else{let nn=qe.value;if(wt){const As=parseFloat(qe.value);nn=Math.round(gc(As))}const xe=`.${ke}(${nn})`,on=Yt.trim()+xe;$t("modal-pattern",on)}}});const tn=((B=Me.referenceEntry)==null?void 0:B.name)||Me.displayLabel.replace(/^[.]+/,"").trim(),wn=vc(Me.referenceEntry),vr=Array.isArray((_e=Me.referenceEntry)==null?void 0:_e.params)?Me.referenceEntry.params.map(Sc).filter(Boolean).join(`
`):"";Te.dataset.tooltipTitle=tn||Me.displayLabel,Te.dataset.tooltipDescription=wn||"",Te.dataset.tooltipParams=vr||"";const Xt=()=>wc(Te),Xs=()=>Gn(Te);Te.addEventListener("mouseenter",Xt),Te.addEventListener("mouseleave",Xs),Te.addEventListener("focus",Xt),Te.addEventListener("blur",Xs),Rt.appendChild(qe),Rt.appendChild(rt),ht.appendChild(On),ht.appendChild(Rt),Qt.appendChild(Te),Qt.appendChild(ht)}else{const Te=document.createElement("button");Te.type="button";const ge=yc(Me.snippet),Le=!ge&&Me.groupId!=="core"&&Oc(Me.snippet),ct=[Me.className||"",ge,Le?"pattern-snippet-tag-core":""].filter(Boolean).join(" ");Te.className=`pattern-snippet-tag ${ct}`.trim(),Te.dataset.snippet=Me.snippet,Te.dataset.insertion=Me.insertionSnippet,Te.textContent=Me.displayLabel,Te.setAttribute("aria-label",Me.displayLabel);const lt=((Wt=Me.referenceEntry)==null?void 0:Wt.name)||Me.displayLabel.replace(/^[.]+/,"").trim(),ze=vc(Me.referenceEntry),ht=Array.isArray((Ke=Me.referenceEntry)==null?void 0:Ke.params)?Me.referenceEntry.params.map(Sc).filter(Boolean).join(`
`):"";Te.dataset.tooltipTitle=lt||Me.displayLabel,Te.dataset.tooltipDescription=ze||"",Te.dataset.tooltipParams=ht||"";const On=()=>wc(Te),Rt=()=>Gn(Te);Te.addEventListener("mouseenter",On),Te.addEventListener("mouseleave",Rt),Te.addEventListener("focus",On),Te.addEventListener("blur",Rt),Te.addEventListener("click",Rt),Qt.appendChild(Te)}Tt.appendChild(Qt);const Zi=L||t.selectedTagKey;if(Zi&&_t===Zi){const Te=s3[_t];if(Te&&Array.isArray(Te)&&Te.length>0){const ge=document.createElement("div");ge.className="pattern-snippet-suggestions";const Le=document.createElement("div");Le.className="pattern-snippet-suggestions-label",Le.textContent="Suggested:",ge.appendChild(Le);const ct=document.createElement("div");ct.className="pattern-snippet-suggestions-list";const ze=Te.filter(ht=>fe.has(ht)).slice(0,8);ze.forEach(ht=>{const On=fe.get(ht),Rt=typeof On=="string"?On:On.snippet,qe=$i(Rt),rt=pe.get(qe),wt=ig(Rt,rt).replace(/^[.]+/,"");let tn=wt;tn=tn.replace(/\([^)]*\)/g,"()");let wn="other",vr="";for(const on of $a)if(on.matcher(qe,Rt)){wn=on.id,vr=on.className;break}const Xt=document.createElement("button");Xt.type="button";const Xs=yc(Rt),Pi=!Xs&&wn!=="core"&&Oc(Rt),Pn=[vr,Xs,Pi?"pattern-snippet-tag-core":"","pattern-snippet-tag-suggested"].filter(Boolean).join(" ");Xt.className=`pattern-snippet-tag ${Pn}`.trim(),Xt.dataset.snippet=Rt,Xt.dataset.insertion=wt,Xt.textContent=tn,Xt.setAttribute("aria-label",tn),Xt.addEventListener("click",on=>{on.stopPropagation(),!w.classList.contains("disabled")&&b.patternEditorEnabled&&(L=qe,t.selectedTagKey=qe,Gn(Xt),bm("modal-pattern",wt),typeof ve=="function"&&ve().catch(As=>console.warn("⚠️ Unable to refresh snippet tags:",As)))});const Yt=(rt==null?void 0:rt.name)||tn.replace(/^[.]+/,"").trim(),ui=vc(rt),xn=Array.isArray(rt==null?void 0:rt.params)?rt.params.map(Sc).filter(Boolean).join(`
`):"";Xt.dataset.tooltipTitle=Yt||tn,Xt.dataset.tooltipDescription=ui||"",Xt.dataset.tooltipParams=xn||"";const nn=()=>wc(Xt),xe=()=>Gn(Xt);Xt.addEventListener("mouseenter",nn),Xt.addEventListener("mouseleave",xe),Xt.addEventListener("focus",nn),Xt.addEventListener("blur",xe),ct.appendChild(Xt)}),ze.length>0&&(ge.appendChild(ct),Tt.appendChild(ge))}}}),Ve.appendChild(it),Ve.appendChild(Tt),G.appendChild(Ve)}),!Ae){const oe=document.createElement("div");oe.className="pattern-snippet-empty",oe.textContent="No tags match your search.",G.appendChild(oe)}};C&&z(C,T,N,_),ve=async()=>{if(!C)return;const G=await ag(dt("modal-pattern")),ae=await qh(),pe=$?$.value.trim().toLowerCase():"";L=t.selectedTagKey,z(C,G,ae,pe)},t.refreshSnippetButtons=ve,C&&!C.dataset.listenersAttached&&(C.addEventListener("click",G=>{const ae=G.target.closest(".pattern-snippet-tag");if(!ae||w.classList.contains("disabled")||!b.patternEditorEnabled)return;const pe=ae.closest(".pattern-snippet-item");if(pe&&pe.dataset.snippetKey){const He=pe.dataset.snippetKey;if(Xi[He])return}const se=ae.dataset.insertion||ae.dataset.snippet;if(!se)return;const de=$i(se);L=de,t.selectedTagKey=de,Gn(ae),bm("modal-pattern",se),typeof ve=="function"&&ve().catch(He=>console.warn("⚠️ Unable to refresh snippet tags:",He))}),C.addEventListener("mouseleave",()=>{Gn()}),C.addEventListener("scroll",()=>{Gn()}),C.dataset.listenersAttached="true"),$&&!$.dataset.listenerAttached&&($.addEventListener("input",()=>{Gn(),typeof ve=="function"&&ve().catch(G=>console.warn("⚠️ Unable to refresh snippet tags:",G))}),$.dataset.listenerAttached="true")})().catch(M=>{console.warn("⚠️ Unable to prepare pattern snippet tags:",M)}),re();const De=M=>{try{if(!e)return;this.currentEditingElementId=M,he(!0),P&&(P.value="code");const _=document.getElementById("modal-element-id");_&&(_.textContent=M||"");const T=this.loadElementConfig?this.loadElementConfig(M):null,N=(T==null?void 0:T.bank)||"",L=(T==null?void 0:T.vcslInstrument)||"",z=N==="vcsl"&&L?`${xl}${L}`:N;f(z),i&&(i.value=z);const V=(T==null?void 0:T.pattern)||"";$t("modal-pattern",V||"");const G=document.getElementById("modal-key-select"),ae=document.getElementById("modal-scale-select");G&&(T!=null&&T.key||(T==null?void 0:T.key)==="")&&(G.value=T.key||""),ae&&(T!=null&&T.scale||(T==null?void 0:T.scale)==="")&&(ae.value=T.scale||"chromatic"),p(),re(),br(),In(),ne(),e.style.display="block"}catch(_){console.warn("⚠️ Failed to open modal:",_)}},Ue=()=>{try{if(!e)return;e.style.display="none",I&&typeof I.stopSound=="function"&&I.stopSound("modal-preview")}catch(M){console.warn("⚠️ Failed to close modal:",M)}};if(Z&&!Z.dataset.listenerAttached){let M=!1;Z.addEventListener("click",async()=>{const _="modal-preview";if(I.trackedPatterns&&I.trackedPatterns.has(_)){I.stopSound&&I.stopSound(_);try{const se=I.trackedPatterns?I.trackedPatterns.size:0;M&&se===0&&I.stopMasterPattern&&await I.stopMasterPattern()}catch{}M=!1,Z.textContent="▶ Preview Pattern",Z.classList.remove("active"),Ut.updateStatus("⏹ Preview stopped");return}b.active&&Li();let N=dt("modal-pattern");if(!N||!N.trim()){Ut.updateStatus("⚠️ No pattern to preview");return}const z=(i?hc(i.value):{bankValue:""}).bankValue;console.log("🎵 Preview: Original pattern:",N),console.log("🎵 Preview: Bank value:",z);const V=[...va,...Er],G=z&&V.includes(z.toLowerCase()),ae=z&&Ar.has(z);if(z&&z!=="")if(ae&&!G)if(N.includes(".bank("))N=N.replace(/\.bank\(["'][^"']*["']\)/g,`.bank("${z}")`);else if(N.includes(".gain(")||N.includes(".pan(")||N.includes(".fast(")||N.includes(".slow(")){const se=N.match(/(\.(gain|pan|fast|slow)\([^)]*\))/);if(se){const de=se.index;N=N.slice(0,de)+`.bank("${z}")`+N.slice(de)}else N=`${N}.bank("${z}")`}else N=`${N}.bank("${z}")`;else G&&(N=N.replace(/\.bank\(["'][^"']*["']\)/g,""),N=N.replace(/\.+$/,"").trim());else N=N.replace(/\.bank\(["'][^"']*["']\)/g,""),N=N.replace(/\.+$/,"").trim();console.log("🎵 Preview: Final pattern before preview:",N);const pe=this.currentEditingElementId;if(pe){const se=I.elementGainValues.get(pe)||.8,de=I.elementPanValues.get(pe)||0,He=se*.501;I.elementGainValues.set(_,He),I.elementPanValues.set(_,de),console.log(`🎵 Preview: Using gain=${He} (${se} * 0.501 for -6dB), pan=${de} from element ${pe}`)}if(z&&z!==""){console.log(`🎵 Preview: Ensuring bank "${z}" is loaded...`);try{await I.loadBank(z),console.log(`✅ Preview: Bank "${z}" loaded successfully`)}catch(se){console.warn(`⚠️ Preview: Could not load bank "${z}":`,se)}}Ut.updateStatus("▶ Previewing pattern…"),Z.textContent="⏹ Stop Preview",Z.classList.add("active");try{const se=!!I.masterActive;await I.playStrudelPattern(_,N),!I.masterActive&&I.playMasterPattern&&await I.playMasterPattern(),M=!se&&!!I.masterActive,Ut.updateStatus("✅ Preview playing")}catch(se){console.error("Preview failed:",se),Ut.updateStatus("⚠️ Preview failed – check console for details"),Z.textContent="▶ Preview Pattern",Z.classList.remove("active")}}),Z.dataset.listenerAttached="true"}const Pt=M=>{Gn(),K$("modal-pattern",M);const _=document.getElementById("modal-pattern");_&&_.classList.toggle("pattern-editor-readonly",!M),w&&(w.classList.toggle("disabled",!M),w.setAttribute("aria-disabled",(!M).toString())),$&&($.disabled=!M)},yt=()=>{var T;P&&(P.value=b.patternEditorEnabled?"code":"step"),Pt(b.patternEditorEnabled);const M=document.getElementById("modal-pattern-editor-wrapper");M&&(M.style.display=b.patternEditorEnabled?"block":"none",ue()),w&&(w.style.display=b.patternEditorEnabled?"block":"none");const _=(T=document.getElementById("modal-time-signature-select"))==null?void 0:T.closest(".form-group");_&&(_.style.display=b.patternEditorEnabled?"none":"block")},ue=()=>{const M=document.getElementById("modal-note-conversion-control");if(!M)return;const _=dt("modal-pattern"),T=_&&jn(_);T&&Ai(_),T?M.style.display="block":M.style.display="none"},Je=document.getElementById("modal-pattern");if(Je&&!Je.dataset.previewListenerAttached){const M=_=>{if(!_||typeof _!="string"||!_.includes("(silence)")||!/\b(note|n)\s*\(/i.test(_))return _;const T=_.trim().startsWith("(silence)"),N=_.trim().match(/^\(silence\)\.\s*([\s\S]+)$/);if(T&&N){const z=N[1].trim().replace(/^\.+/,""),V=_.search(/\b(note|n)\s*\(/i);if(V>=0){let G=_.indexOf("(",V),ae=0,pe=-1;for(let se=G;se<_.length;se++){const de=_[se];if(de==="(")ae++;else if(de===")"&&(ae--,ae===0)){pe=se;break}}if(pe>G){let de=`${_.substring(V,pe+1).trim()}`;return z&&!/^\s*$/.test(z)&&(de=`${de}.${z}`.replace(/\.\.+/g,".").replace(/\.($|\s)/,"$1").trim()),de}}}let L=_.replace(/\(silence\)/g,"").replace(/\.\.+/g,".").trim();return L=L.replace(/^\./,"").trim(),L};Je.addEventListener("input",()=>{const _=dt("modal-pattern"),T=M(_);T!==_&&$t("modal-pattern",T),re(),ue(),T&&Ai(T)&&(Ct=T),Ie=!1,zi(dt("modal-pattern"),!0);const N=document.getElementById("modal-key-scale-group"),L=dt("modal-pattern"),z=L&&jn(L),V=i?i.value:"",G=V&&Er.includes(V.toLowerCase());N&&(N.style.display=z||G?"block":"none"),typeof ve=="function"&&ve().catch(ae=>console.warn("⚠️ Unable to refresh snippet tags:",ae))}),Je.dataset.previewListenerAttached="true"}const he=M=>{b.patternEditorEnabled=!!M,yt();try{typeof localStorage<"u"&&localStorage.setItem("drumGridEditorMode",b.patternEditorEnabled?"code":"step")}catch{}},Et=M=>{const _=hc(M);return _.bankValue&&Ar.has(_.bankValue)},Ze=M=>{g&&(g.textContent=`${M.signature} · ${M.totalSteps} steps`)},me=()=>{const M=document.getElementById("modal-drum-grid-bar-count"),_=document.getElementById("modal-drum-grid-bar-arrow-left"),T=document.getElementById("modal-drum-grid-bar-arrow-right");M&&(b.numBars===1?M.textContent="1 bar":M.textContent=`Bar ${b.currentBar} of ${b.numBars}`),_&&(_.style.display=b.numBars>1&&b.currentBar>1?"flex":"none"),T&&(T.style.display=b.numBars>1&&b.currentBar<b.numBars?"flex":"none")},Ye=M=>{if(M<1||M>b.numBars)return;const _=document.getElementById("modal-time-signature-select"),T=(_==null?void 0:_.value)||this.currentTimeSignature||"4/4",N=ki(T);Jn(N),b.currentBar=M,me();const L=i?i.value:"";if(b.built=!1,Tn(N,L),!b.barTokens||!b.barTokens.length){const z=dt("modal-pattern"),V=Nt(z);en(N,V||[])}else ot(N);Qi(N)},xt=()=>{const M=document.getElementById("modal-time-signature-select"),_=(M==null?void 0:M.value)||this.currentTimeSignature||"4/4",T=ki(_);Jn(T),b.numBars++,ot(T);const N=T.totalSteps;b.barTokens[b.numBars-1]=new Array(N).fill("~"),me(),Ye(b.numBars)},ai=()=>{!b.active||b.updatingFromPattern||Li()},Tn=(M,_)=>{if(!m)return;const T=_&&Hm[_]?Hm[_]:pc;if(!(!b.built||b.totalSteps!==M.totalSteps||JSON.stringify(b.currentBankRows)!==JSON.stringify(T)))return;const L=document.getElementById("modal-drum-grid-container");if(!L){console.error("❌ ensureDrumGridBuilt: Drum grid container not found!"),console.error("   Looking for: modal-drum-grid-container"),console.error("   Modal exists:",!!m),m&&console.error("   Drum grid section children:",Array.from(m.children).map(z=>z.id||z.className));return}console.log("🔨 Building drum grid with",T.length,"rows,",M.totalSteps,"steps"),console.log("   Grid container found:",L,"current children:",L.children.length),L.innerHTML="",b.checkboxes={},b.currentBankRows=T,T.forEach(({key:z,label:V,sample:G})=>{const ae=document.createElement("div");ae.className="drum-grid-row",ae.setAttribute("data-row",z);const pe=document.createElement("span");pe.className="drum-grid-row-label",pe.textContent=V,ae.appendChild(pe);const se=document.createElement("div");se.className="drum-grid-steps",se.id=`drum-grid-steps-${z}`,se.style.gridTemplateColumns=`repeat(${M.totalSteps}, minmax(18px, 1fr))`,b.checkboxes[z]=[],M.totalSteps*b.numBars;const de=(b.currentBar-1)*M.totalSteps,He=de+M.totalSteps;for(let We=de;We<He;We+=1){const Ge=document.createElement("div");Ge.className="drum-grid-step";const Ae=We-de;Ae>0&&Ae%4===0&&Ge.classList.add("quarter-boundary");const fe=document.createElement("input");fe.type="checkbox",fe.dataset.row=z,fe.dataset.step=String(We),fe.dataset.bar=String(b.currentBar),fe.addEventListener("change",ai),Ge.appendChild(fe),se.appendChild(Ge),b.checkboxes[z].push(fe)}ae.appendChild(se),L.appendChild(ae)}),ot(M),Qi(M),b.totalSteps=M.totalSteps,b.built=!0},Nt=M=>{if(!M||typeof M!="string")return null;const _=M.match(/(?:s|sound)\(\s*["'`]([^"'`]+)["'`]\s*\)/i);if(!_||!_[1])return null;const T=_[1].trim();return T?T.split(/\s+/).filter(Boolean):null};function mn(M){if(!M)return[];const _=M.trim();if(!_||_==="~")return[];let T=_;return(T.startsWith("[")&&T.endsWith("]")||T.startsWith("{")&&T.endsWith("}"))&&(T=T.slice(1,-1)),T=T.replace(/[,]+/g," "),T.split(/\s+/).map(N=>N.trim()).filter(Boolean)}function ot(M){b.barTokens||(b.barTokens=[]);const _=M.totalSteps,T=Math.max(1,b.numBars);for(b.barTokens.length>T&&(b.barTokens.length=T);b.barTokens.length<T;)b.barTokens.push(new Array(_).fill("~"));b.barTokens=b.barTokens.map(N=>{const L=Array.isArray(N)?N.slice(0,_):[];for(;L.length<_;)L.push("~");return L})}function en(M,_){const T=M.totalSteps,N=Math.max(1,b.numBars),L=T*N;let z=Array.isArray(_)?_.slice(0,L):[];z.length<L&&(z=z.concat(new Array(L-z.length).fill("~"))),b.barTokens=[];for(let V=0;V<N;V++){const G=V*T;b.barTokens.push(z.slice(G,G+T))}ot(M)}function Jn(M){if(!b.active||b.updatingFromPattern||!b.checkboxes)return;const _=b.currentBar-1;if(_<0)return;ot(M);const T=M.totalSteps,N=b.currentBankRows||pc,L=new Array(T).fill("~");for(let z=0;z<T;z+=1){const V=[];N.forEach(({key:G,sample:ae})=>{const pe=b.checkboxes[G],se=pe?pe[z]:null;se&&se.checked&&V.push(ae)}),V.length===1?L[z]=V[0]:V.length>1&&(L[z]=`[${V.join(" ")}]`)}b.barTokens[_]=L}function Qi(M){if(!b.checkboxes)return;ot(M);const _=b.currentBar-1,T=b.barTokens[_];if(!T)return;(b.currentBankRows||pc).forEach(({key:L,sample:z})=>{const V=b.checkboxes[L];V&&V.forEach((G,ae)=>{if(!G)return;const pe=mn(T[ae]);G.checked=pe.includes(z)})})}function ds(){return Array.isArray(b.barTokens)?b.barTokens.flat():[]}const Ri=(M,_)=>{if(!m||!b.active)return;const T=Nt(M),N=_.totalSteps;if(T&&T.length){const L=Math.max(1,Math.ceil(T.length/N));b.numBars!==L&&(b.numBars=L,b.currentBar>b.numBars&&(b.currentBar=b.numBars),me()),en(_,T)}else b.barTokens.length?ot(_):en(_,[]);b.updatingFromPattern=!0,Qi(_),b.updatingFromPattern=!1},Ps=M=>(ot(M),ds()),Li=()=>{if(!m||!b.active||!i)return;const M=document.getElementById("modal-time-signature-select"),_=(M==null?void 0:M.value)||this.currentTimeSignature||"4/4",T=ki(_);Jn(T);const L=Ps(T).join(" "),z=i.value,V=z&&z!==""?`.bank("${z}")`:"",G=`s("${L}")${V}`;b.updatingFromGrid=!0,$t("modal-pattern",G),b.updatingFromGrid=!1},Ii=(M,_)=>{if(!m){console.warn("⚠️ Drum grid section not found");return}const T=i?i.value:"";console.log("🎹 Showing drum grid for bank:",T,"metrics:",M);const N=document.getElementById("modal-drum-grid-container");if(!N){console.error("❌ Drum grid container not found!");return}console.log("✅ Grid container found:",N),Tn(M,T),Ze(M),m.style.display="block",b.active=!0,Ri(_,M),me();const L=N.querySelectorAll(".drum-grid-row");console.log("✅ Drum grid shown, active:",b.active,"rows:",L.length)},oi=()=>{m&&(m.style.display="none",b.active=!1,b.built=!1,b.numBars=1,b.currentBar=1,me())};yt();const In=()=>{if(!i){console.log("⚠️ refreshDrumGridForCurrentState: bankSelect not found");return}const M=i.value,_=Et(M);if(console.log("🔄 refreshDrumGridForCurrentState: bankValue=",M,"isDrum=",_,"patternEditorEnabled=",b.patternEditorEnabled),P&&(P.style.display=_?"block":"none"),!_){console.log("📝 Not a drum bank, enabling pattern editor"),he(!0),oi(),yt();return}const T=dt("modal-pattern");if(T&&T.trim(),Nt(T),b.patternEditorEnabled){console.log("📝 Pattern editor enabled, hiding drum grid"),oi(),yt();return}console.log("🎹 Showing drum grid for drum bank");const N=document.getElementById("modal-time-signature-select"),L=(N==null?void 0:N.value)||this.currentTimeSignature||"4/4",z=ki(L);console.log("🎹 Calling showDrumGrid with metrics:",z,"pattern:",T),Ii(z,T)},Se=document.getElementById("modal-pattern");Se&&Se.addEventListener("input",()=>{if(!b.active||b.updatingFromGrid||!i||!Et(i.value))return;const M=document.getElementById("modal-time-signature-select"),_=(M==null?void 0:M.value)||this.currentTimeSignature||"4/4",T=ki(_),N=Se.value?Se.value.trim():"",L=Nt(Se.value);if(N&&(!L||L.length===0)){he(!0),oi();return}Ri(Se.value,T)});const Zt=M=>{var V;if(!M)return;const _=this.currentEditingElementId;if(_){const G=document.getElementById("modal-title");G&&(G.value=M.label);const ae=document.getElementById("modal-element-id");if(ae&&(ae.textContent=er(_)),di(_,M.label),typeof this.saveElementConfig=="function"){const se={...((V=this.loadElementConfig)==null?void 0:V.call(this,_))||{},title:M.label};this.saveElementConfig(_,se,!0)}}const T=typeof M.bank=="string"?M.bank:"",N=()=>{if(typeof M.useNoteNames=="boolean")return M.useNoteNames;const G=M.pattern||"";return G.includes("note(")||G.includes('note("')},L=()=>{if(M.pattern){const G=document.getElementById("modal-keep-notes-as-written");G&&(G.checked=N()),$t("modal-pattern",M.pattern.trim()),re()}T&&Et(T)?(he(!1),In()):(he(!0),oi(),yt()),Se&&Se.focus()},z=document.getElementById("modal-keep-notes-as-written");if(z&&(z.checked=N()),i){const G=T||"";if(i.value!==G){i.value=G,i.dispatchEvent(new Event("change",{bubbles:!0})),setTimeout(L,60);return}}L()};ne();const Ne=M=>{if(!M||!M.classList.contains("has-tooltip"))return;const _=M.getBoundingClientRect();if(_.width===0&&_.height===0){requestAnimationFrame(()=>Ne(M));return}const T=(e==null?void 0:e.querySelector(".modal-presets-content"))||e,N=T?T.getBoundingClientRect():{left:0,width:window.innerWidth},L=N.left+N.width/2,V=_.left+_.width/2>L;M.classList.toggle("tooltip-align-right",V),M.classList.toggle("tooltip-align-left",!V)};let bt=null;const et=()=>{bt||(bt=requestAnimationFrame(()=>{bt=null;const M=e==null?void 0:e.querySelectorAll(".modal-preset-button.has-tooltip");M==null||M.forEach(_=>Ne(_))}))};window.addEventListener("resize",et);const ei=(M,_)=>{!M||!Array.isArray(_)||(M.innerHTML="",_.forEach(T=>{const N=document.createElement("button");N.type="button",N.className="modal-preset-button";const L=T.editorBadge?`<span class="modal-preset-badge${T.editorBadge.toLowerCase().includes("code")?" is-code":T.editorBadge.toLowerCase().includes("step")?" is-step":""}">${T.editorBadge}</span>`:"",z=T.secondaryLabel?`<div class="modal-preset-secondary-row">${T.secondaryLabel}</div>`:"";N.innerHTML=`
          <div class="modal-preset-heading-row">
            <strong>${T.label}</strong>
            ${L}
          </div>
          ${z}
          ${T.description?`<span class="modal-preset-description">${T.description}</span>`:""}
        `,T.tooltip&&(N.classList.add("has-tooltip"),N.setAttribute("data-tooltip",T.tooltip),N.addEventListener("mouseenter",()=>Ne(N)),N.addEventListener("focus",()=>Ne(N)),requestAnimationFrame(()=>Ne(N))),N.addEventListener("click",()=>Zt(T)),M.appendChild(N)}),et())},xs=()=>{e.querySelectorAll(".modal-presets-subtoggle").forEach(_=>{const T=_.getAttribute("data-target"),N=T?document.getElementById(T):_.nextElementSibling;if(!N)return;const L=V=>{_.setAttribute("aria-expanded",String(V)),N.classList.toggle("is-open",V)},z=N.classList.contains("is-open");L(z),_.addEventListener("click",()=>{const V=_.getAttribute("aria-expanded")!=="true";L(V)})})};A&&Q&&A.addEventListener("click",()=>{const _=!(A.getAttribute("aria-expanded")==="true");Y(_)}),ei(q,GM),ei(W,Ky),ei(U,WM),xs(),P&&P.addEventListener("change",M=>{const _=M.target.value==="code";he(_),In()});const gn=document.getElementById("modal-time-signature-select");gn&&gn.addEventListener("change",M=>{const _=M.target.value;if(_&&(this.currentTimeSignature=_,b.active)){const T=ki(_),N=dt("modal-pattern"),L=i?i.value:"";Tn(T,L),Ze(T),Ii(T,N)}});const li=document.getElementById("modal-drum-grid-bar-count"),Vn=document.getElementById("modal-drum-grid-add-bar"),Mt=document.getElementById("modal-drum-grid-bar-arrow-left"),Vi=document.getElementById("modal-drum-grid-bar-arrow-right");li&&(li.addEventListener("click",()=>{const M=b.currentBar<b.numBars?b.currentBar+1:1;Ye(M)}),li.style.cursor="pointer",li.title="Click to switch between bars"),Mt&&Mt.addEventListener("click",M=>{M.stopPropagation(),b.currentBar>1&&Ye(b.currentBar-1)}),Vi&&Vi.addEventListener("click",M=>{M.stopPropagation(),b.currentBar<b.numBars&&Ye(b.currentBar+1)}),Vn&&Vn.addEventListener("click",M=>{M.stopPropagation(),xt()}),this.applyTimeSignatureToDrumGrid=M=>{if(!m||!b.active)return;const _=ki(M||"4/4"),T=dt("modal-pattern"),N=i?i.value:"";Tn(_,N),Ze(_),Ii(_,T)};const Cs=e.querySelector(".modal-close");Cs&&Cs.addEventListener("click",Ue);const St=document.getElementById("modal-sample-file");St&&St.addEventListener("change",M=>{var z,V;const _=M.target.files&&M.target.files.length>0?M.target.files[0]:null,T=(z=document.getElementById("modal-pattern-bank"))==null?void 0:z.closest(".form-group"),N=(V=document.getElementById("modal-time-signature-select"))==null?void 0:V.closest(".form-group"),L=document.getElementById("modal-title");if(_){if(T&&(T.style.display="none"),N&&(N.style.display="none"),L){const ae=_.name.replace(/\.[^/.]+$/,"");L.value=ae}}else T&&(T.style.display="block")});const mt=document.getElementById("modal-key-select"),Ht=document.getElementById("modal-scale-select"),K={container:document.getElementById("modal-scale-chord-suggestions"),title:document.getElementById("modal-scale-chord-title"),characteristic:document.getElementById("modal-scale-characteristic"),dropdown:document.getElementById("modal-chord-progression-select")},te=(M,_)=>{try{const T=M.trim(),N=_.map(z=>z);return tx.fromRomanNumerals(T,N).filter(Boolean).map((z,V)=>!z||z===""?_[V]:z)}catch(T){return console.warn("Error converting Roman numerals to chords:",T,"Romans:",_),_.map(N=>N.replace(/b/g,"♭").replace(/#/g,"♯"))}},H={ionian:{displayName:"Ionian (Major)",colorTone:"7 (natural)",progressions:{"2-chord":[{label:"I – IV",romans:["I","IV"]},{label:"I – V",romans:["I","V"]},{label:"I – vi",romans:["I","vi"]}],"3-chord":[{label:"I – IV – V",romans:["I","IV","V"]},{label:"I – V – vi",romans:["I","V","vi"]},{label:"I – iii – vi",romans:["I","iii","vi"]}],"4-chord":[{label:"I – IV – V – I",romans:["I","IV","V","I"]},{label:"I – vi – IV – V",romans:["I","vi","IV","V"]},{label:"I – V – vi – IV (pop classic)",romans:["I","V","vi","IV"]}]}},dorian:{displayName:"Dorian",colorTone:"natural 6 in a minor scale",progressions:{"2-chord":[{label:"i – IV",romans:["i","IV"]},{label:"i – ii",romans:["i","ii"]}],"3-chord":[{label:"i – IV – v",romans:["i","IV","v"]},{label:"i – ii – IV",romans:["i","ii","IV"]},{label:"i – IV – VII",romans:["i","IV","VII"]}],"4-chord":[{label:"i – IV – i – v",romans:["i","IV","i","v"]},{label:"i – ii – IV – i",romans:["i","ii","IV","i"]},{label:"i – IV – vii° – i",romans:["i","IV","vii°","i"]}]}},phrygian:{displayName:"Phrygian",colorTone:"♭2 (very dark/tense)",progressions:{"2-chord":[{label:"i – ♭II",romans:["i","bII"]},{label:"i – v",romans:["i","v"]}],"3-chord":[{label:"i – ♭II – i",romans:["i","bII","i"]},{label:"i – v – ♭II",romans:["i","v","bII"]}],"4-chord":[{label:"i – ♭II – vii – i",romans:["i","bII","vii","i"]},{label:"i – v – ♭II – i",romans:["i","v","bII","i"]}]}},lydian:{displayName:"Lydian",colorTone:"♯4 (bright, dreamy, floaty)",progressions:{"2-chord":[{label:"I – II",romans:["I","II"]},{label:"I – Vmaj7",romans:["I","Vmaj7"]}],"3-chord":[{label:"I – II – I",romans:["I","II","I"]},{label:"I – V – II",romans:["I","V","II"]}],"4-chord":[{label:"I – II – V – I",romans:["I","II","V","I"]},{label:"I – vii – II – I",romans:["I","vii","II","I"]}]}},mixolydian:{displayName:"Mixolydian",colorTone:"♭7 (rock-dominant sound)",progressions:{"2-chord":[{label:"I – ♭VII",romans:["I","bVII"]},{label:"I – v",romans:["I","v"]}],"3-chord":[{label:"I – ♭VII – IV",romans:["I","bVII","IV"]},{label:"I – IV – ♭VII",romans:["I","IV","bVII"]}],"4-chord":[{label:"I – ♭VII – IV – I",romans:["I","bVII","IV","I"]},{label:"I – v – ♭VII – IV",romans:["I","v","bVII","IV"]}]}},aeolian:{displayName:"Aeolian (Natural Minor)",colorTone:"♭6",progressions:{"2-chord":[{label:"i – ♭VI",romans:["i","bVI"]},{label:"i – ♭VII",romans:["i","bVII"]}],"3-chord":[{label:"i – ♭VII – ♭VI",romans:["i","bVII","bVI"]},{label:"i – iv – ♭VI",romans:["i","iv","bVI"]}],"4-chord":[{label:"i – ♭VII – ♭VI – v",romans:["i","bVII","bVI","v"]},{label:"i – iv – ♭VII – ♭VI",romans:["i","iv","bVII","bVI"]}]}},locrian:{displayName:"Locrian",colorTone:"♭2, ♭5 (very unstable)",progressions:{"2-chord":[{label:"iø – ♭II",romans:["iø","bII"]},{label:"iø – v",romans:["iø","v"]}],"3-chord":[{label:"iø – ♭II – iø",romans:["iø","bII","iø"]},{label:"iø – v – ♭II",romans:["iø","v","bII"]}],"4-chord":[{label:"iø – ♭II – v – iø",romans:["iø","bII","v","iø"]}]}},"melodic minor":{displayName:"Melodic Minor (Jazz Minor)",colorTone:"i−maj7",progressions:{"2-chord":[{label:"i−maj7 – IV7",romans:["imMaj7","IV7"]}],"3-chord":[{label:"i−maj7 – IV7 – v",romans:["imMaj7","IV7","v"]}],"4-chord":[{label:"i−maj7 – ii – IV7 – i−maj7",romans:["imMaj7","ii","IV7","imMaj7"]}]}},"lydian dominant":{displayName:"Lydian Dominant",colorTone:"♯11",progressions:{"2-chord":[{label:"I7 – II",romans:["I7","II"]}],"3-chord":[{label:"I7 – ♭VII – II",romans:["I7","bVII","II"]}],"4-chord":[{label:"I7 – iiø – ♭VII – I7",romans:["I7","iiø","bVII","I7"]}]}},altered:{displayName:"Altered (Super-Locrian)",colorTone:"V7alt",progressions:{"2-chord":[{label:"V7alt → i",romans:["V7alt","i"]},{label:"V7alt → Imaj7",romans:["V7alt","Imaj7"]}],"3-chord":[{label:"iiø – V7alt – i",romans:["iiø","V7alt","i"]}]}},"harmonic minor":{displayName:"Harmonic Minor",colorTone:"i−maj7",progressions:{"2-chord":[{label:"i – V",romans:["i","V"]}],"3-chord":[{label:"i – iv – V",romans:["i","iv","V"]}],"4-chord":[{label:"i – iv – V – i",romans:["i","iv","V","i"]}]}},"phrygian dominant":{displayName:"Phrygian Dominant",colorTone:"Major chord on ♭II + dominant on V",progressions:{"2-chord":[{label:"i – ♭II",romans:["i","bII"]},{label:"V – i",romans:["V","i"]}],"3-chord":[{label:"V – ♭II – i",romans:["V","bII","i"]}],"4-chord":[{label:"i – ♭II – V – i",romans:["i","bII","V","i"]}]}},"dorian #4":{displayName:"Ukrainian Dorian (Dorian ♯4)",colorTone:"Dorian ♯4",progressions:{"2-chord":[{label:"i – IV",romans:["i","IV"]}],"3-chord":[{label:"i – ♭VII – IV",romans:["i","bVII","IV"]}],"4-chord":[{label:"i – iv – ♭VII – IV",romans:["i","iv","bVII","IV"]}]}},"whole tone":{displayName:"Whole Tone",colorTone:"V7♯5",progressions:{"2-chord":[{label:"V7♯5 – V7♯5",romans:["V7#5","V7#5"]},{label:"V7♯5 – I",romans:["V7#5","I"]}],"3-chord":[{label:"V7♯5 – ♭III+ – V7♯5",romans:["V7#5","bIII+","V7#5"]}]}},"half-whole diminished":{displayName:"Half–Whole Diminished",colorTone:"V7♭9♯11♭13",progressions:{"2-chord":[{label:"V7♭9 – V7♭9",romans:["V7b9","V7b9"]}],"3-chord":[{label:"iiø – V7♭9 – i",romans:["iiø","V7b9","i"]}]}},"whole-half diminished":{displayName:"Whole–Half Diminished",colorTone:"°7",progressions:{"2-chord":[{label:"°7 – °7",romans:["°7","°7"]}],"3-chord":[{label:"°7 – °7 – °7",romans:["°7","°7","°7"]}],"4-chord":[{label:"°7 – ♭III – vi – °7",romans:["°7","bIII","vi","°7"]}]}}},ce=M=>!M||typeof M!="string"?"":M.replace(/bb(?=\d)/gi,"♭♭").replace(/b(?=\d)/gi,"♭").replace(/#(?=\d)/g,"♯").split(/\s+/).filter(Boolean).map(T=>T.charAt(0).toUpperCase()+T.slice(1)).join(" "),p=()=>{if(!K.container||!K.dropdown)return;const M=mt?(mt.value||"").trim():"",_=Ht?(Ht.value||"").trim():"";if(K.dropdown.innerHTML='<option value="">Select a progression...</option>',!M||!_){K.container.style.display="none",K.container.dataset.state="idle",K.title&&(K.title.textContent="Select a key and scale to view chord progressions."),K.characteristic&&(K.characteristic.textContent="");return}const T=_.toLowerCase(),N=H[T],L=(N==null?void 0:N.displayName)||ce(_);if(K.container.style.display="block",K.title&&(K.title.textContent=`${M} ${L} Chord Progressions`),!N||!N.progressions){K.container.dataset.state="placeholder",K.characteristic&&(K.characteristic.textContent="No chord progressions available for this scale yet.");return}K.container.dataset.state="ready",K.characteristic&&(K.characteristic.textContent=`Color tone: ${N.colorTone||"N/A"}`),["2-chord","3-chord","4-chord"].forEach(V=>{const G=N.progressions[V];if(G&&G.length>0){const ae=document.createElement("optgroup");ae.label=V.charAt(0).toUpperCase()+V.slice(1).replace("-"," "),G.forEach(pe=>{const se=document.createElement("option"),de=te(M,pe.romans),He=de.length>0?`${pe.label} (${de.join(" – ")})`:pe.label;se.value=JSON.stringify({romans:pe.romans,label:pe.label}),se.textContent=He,ae.appendChild(se)}),K.dropdown.appendChild(ae)}})};p(),K.dropdown&&K.dropdown.addEventListener("change",M=>{const _=M.target.value;if(!(!_||_===""))try{const T=JSON.parse(_),N=mt?(mt.value||"").trim():"";if(!N){console.warn("No key selected for chord progression");return}const L=te(N,T.romans);if(L.length>0){let V=dt("modal-pattern")||"";V=V.replace(/\bn\s*\([^)]*\)\s*\.\s*scale\s*\([^)]*\)(?:\s*\.\s*[a-zA-Z]+\s*\([^)]*\))*/gi,""),V=V.replace(/\bn\s*\(["'][^"']*["']\)\s*\.\s*scale\s*\(["'][^"']*["']\)(?:\s*\.\s*[a-zA-Z]+\s*\([^)]*\))*/gi,""),V=V.replace(/^\s*\.\s*/,"").replace(/\s*\.\s*$/,"").trim();const ae=`n().chord("<${L.join(" ")}>").voicing()`;$t("modal-pattern",ae)}}catch(T){console.warn("Error parsing chord progression data:",T)}});const S=M=>{if(typeof M!="string")return!1;let _=0,T=!1,N="";for(let L=0;L<M.length;L++){const z=M[L];if(T){if(z==="\\"){L++;continue}z===N&&(T=!1,N="");continue}if(z==='"'||z==="'"){T=!0,N=z;continue}if(z==="("&&_++,z===")"&&_--,_<0)return!1}return!T&&_===0},v=(M,_,T=!1)=>{if(!M||!M.trim())return M;let N=M.trim();if(T){const L=/\.\s*bank\s*\(\s*["'][^"']*["']\s*\)/gi;L.test(N)?N=N.replace(L,`.bank("${_}")`):N=`${N}.bank("${_}")`}else{const L=/\.\s*(s|sound)\s*\(\s*["'][^"']*["']\s*\)/gi;L.test(N)?N=N.replace(L,`.s("${_}")`):N=`${N}.s("${_}")`}return N},x=M=>{if(!M||!M.trim())return"";const _=M.trim();if(/(\.\s*(bank|s|sound)\s*\()|(\b(note|n|stack|sound)\s*\()/i.test(_))return _;const N=l3(_);return N?N.trim():""},F=(M,_,T,N)=>{let z=(M||"").trim();const V=/\.\s*(s|sound|scale)\s*\(/i.test(z);z?(!z.startsWith("(")||!z.endsWith(")"))&&(V||(z=`(${z})`)):z="(silence)";const G=z.match(/\.\s*scale\s*\(\s*['"]([^'"]+)['"]\s*\)/i),ae=G?G[1]:null,pe=z.match(/\.\s*(s|sound)\s*\(\s*["']([^"']+)["']\s*\)/i),se=pe?pe[2]:null;let de=z.replace(/\.\s*scale\s*\([^)]*\)/gi,"").replace(/\.\s*(s|sound)\s*\([^)]*\)/gi,"");if(T&&T.trim()!==""||_&&_.trim()!==""){const We=_&&_.trim()!==""?_.trim().toLowerCase():"c",Ge=T&&T.trim()!==""?T.trim():"major";de=`${de}.scale('${We}:${Ge}')`}else ae&&(de=`${de}.scale('${ae}')`);return se&&(de=`${de}.s("${se}")`),de},X=(M=!1)=>{p();const _=dt("modal-pattern"),T=mt&&mt.value||null,N=Ht&&Ht.value||null;if(console.log(`🎼 applyKeyScaleToPattern called: keyValue="${T}", scaleValue="${N}"`),!T&&!N){console.log("⚠️ No key/scale selected, skipping");return}const L=document.getElementById("modal-keep-notes-as-written"),z=M||L&&L.checked,V=T&&T.trim()!==""?T:null,G=N&&N.trim()!==""?N:null;if(!_||_.trim()===""||!jn(_)){let Ae=null;if(_&&_.trim()!==""){const oe=_.match(/\.\s*(s|sound)\s*\(\s*["']([^"']+)["']\s*\)/i);oe&&oe[2]&&(Ae=oe[2])}if(!Ae){const oe=document.getElementById("modal-pattern-bank");oe&&oe.value&&(Ae=oe.value.toLowerCase())}let fe="";if(z){if(typeof this.getAllScaleNotesAsNoteNames=="function"&&(fe=this.getAllScaleNotesAsNoteNames(T||"C",N||"chromatic")||""),!fe){const oe=this.getAllScaleNotesAsPattern(T||"C",N||"chromatic");oe&&(fe=this.convertNumericPatternToNoteNames(oe,T||"C",N||"chromatic"))}}else{const oe=this.getAllScaleNotesAsPattern(T||"C",N||"chromatic");if(oe){const Ve=oe.match(/(?:note|n)\s*\(\s*["']([^"']+)["']\s*\)/),je=Ve?Ve[1]:"0 1 2 3 4 5",gt=`${(T||"C").toLowerCase()}:${N||"chromatic"}`;fe=`n("${je}").scale('${gt}')`}}if(!fe){console.warn("⚠️ Could not generate scale notes for empty/non-note pattern");return}Ae&&(fe=`${fe}.s("${Ae}")`),S(fe)?($t("modal-pattern",fe),console.log(`🎼 Inserted scale notes for empty/non-note pattern: ${fe}`)):console.warn("⚠️ Generated scale-notes pattern failed quick syntax check; not applying");return}const ae=/\b(note|n)\s*\(/.test(_),pe=/\b(note|n)\s*\(\s*["'][a-g][#b]?/.test(_),se=/\b(note|n)\s*\(\s*["'][a-g][#b]?[a-z0-9]*\s*[a-z]/.test(_)||/\b(note|n)\s*\(\s*["'][^"']*\b(maj|min|m|dim|aug|sus|add|7|9|11|13)\b/i.test(_),de=/\.\s*chord\s*\(/i.test(_),He=/\b(note|n)\s*\(\s*["'][^"']*[a-g][#b]?\s/.test(_),We=pe||se||He||de,Ge=ae&&!We&&!de;if(We&&!Ge){console.log("ℹ️ Pattern uses explicit note names – skipping key/scale rewrite");return}if(ae&&Ai(_)&&!We&&!de){const Ae=wi(V,G);if(!Ae){console.log("ℹ️ Numeric pattern: no scale selected, skipping rewrite");return}let fe=Gs(_,Ae);fe=fe.replace(/\.\s*scale\s*\([^)]*\)/gi,""),fe=Gs(fe,Ae),$t("modal-pattern",fe),zi(fe,!0),console.log(`ℹ️ Numeric pattern preserved; appended scale modifier ${Ae}`);return}if(z&&pe&&!de){const Ae=I.convertNoteNamesToSemitones(_),fe=V||"C",oe=G||"chromatic";let Ve=Ae?this.convertNumericPatternToNoteNames(Ae,fe,oe):null;if((!Ve||Ve===_)&&(Ve=this.convertNumericPatternToNoteNames(_,fe,oe)),Ve&&Ve!==_){const je=wi(V,G);je&&(ie=je),Ie=!0,zi(Ve,!0),$t("modal-pattern",Ve),V&&(I.currentKey=V),G&&(I.currentScale=G);const gt=document.getElementById("modal-pattern");if(gt){try{gt.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{gt.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}}console.log(`🎼 Converted note names to new key/scale: ${Ve.substring(0,120)}...`);return}else console.log(`⚠️ Note names unchanged after conversion attempt (key=${fe}, scale=${oe})`)}if(!de&&Ge){console.log(`🎼 applyKeyScaleToPattern: keyValue="${T}", scaleValue="${N}", pattern="${_.substring(0,50)}..."`);let Ae=_;if(G&&(V||G))if(z){const oe=/\b(note|n)\s*\(\s*["'][a-gA-G][#b]?\d/.test(_);if(/\b(n|note)\s*\(\s*["'][\d\s]+["']/.test(_)&&!oe)Ae=this.convertNumericPatternToNoteNames(_,V,G),console.log(`🎼 Converted numeric pattern to note names in ${G}: ${Ae.substring(0,100)}...`);else if(oe){const je=I.convertNoteNamesToSemitones(_);je&&je!==_?(Ae=this.convertNumericPatternToNoteNames(je,V,G),console.log(`🎼 Converted note names to ${G} scale: ${Ae.substring(0,100)}...`)):Ae=this.convertNumericPatternToNoteNames(_,V,G)}try{const je=this.getAllScaleNotesAsPattern(V||"C",G||"chromatic");if(je){const st=this.convertNumericPatternToNoteNames(je,V||"C",G||"chromatic").match(/\b(note|n)\s*\(\s*["']([^"']+)["']\s*\)/i),it=Ae.match(/\b(note|n)\s*\(\s*["']([^"']+)["']\s*\)/i);if(st&&it){const Tt=st[2];Ae=Ae.replace(/\b(note|n)\s*\(\s*["'][^"']+["']\s*\)/i,(Me,Qt)=>`${Qt}("${Tt}")`),console.log(`🎼 Resized note names to match scale: ${Tt}`)}}}catch{}}else{const oe=F(_,V,G);if(S(oe)){Ae=oe;const Ve=Ae.match(/\b(n|note)\s*\(\s*["']([^"']+)["']\s*\)/i);if(Ve&&Ve[2]){const je=Ve[2].trim().split(/\s+/).map(st=>parseInt(st,10)).filter(st=>!isNaN(st)),gt=this.getAllScaleNotesAsPattern(V||"C",G||"chromatic");if(gt){const st=gt.match(/\b(n|note)\s*\(\s*["']([^"']+)["']\s*\)/i),it=st?st[2]:null;if(it){const Tt=it.trim().split(/\s+/).length;je.length!==Tt&&(Ae=Ae.replace(/\b(n|note)\s*\(\s*["'][^"']+["']\s*\)/i,(Me,Qt)=>`${Qt}("${it}")`),console.log(`🎼 Resized numeric degrees to match scale (${Tt} steps): ${it}`))}}}}else Ae=_;console.log(`🎼 Semitone mode: upserted scale=${G} key=${V}`)}let fe=Ae;if(console.log(`🎼 applyKeyScaleToPattern: result="${fe?fe.substring(0,80):"null"}..."`),console.log(`🎼 Pattern comparison - original length: ${_.length}, new length: ${fe?fe.length:0}, same: ${fe===_}`),!z&&fe&&Ai(fe)){const oe=Kr(fe,V,G);oe&&oe!==fe&&(fe=oe,console.log(`🎼 Normalized numeric pattern to scale degrees (${G||"chromatic"})`))}if(!z&&fe&&(V||G))try{const oe=this.getAllScaleNotesAsPattern(V||"C",G||"chromatic"),Ve=oe&&oe.match(/\b(n|note)\s*\(\s*["']([^"']+)["']\s*\)/i),je=Ve?Ve[2]:null,gt=fe.match(/\b(n|note)\s*\(\s*["']([^"']+)["']\s*\)/i);if(je&&gt&&gt[2]){const Me=gt[2].trim().split(/\s+/);Me.every(we=>/^-?\d+$/.test(we))&&Me.every((we,Ft)=>parseInt(we,10)===Ft)&&(fe=fe.replace(/\b(n|note)\s*\(\s*["'][^"']+["']\s*\)/i,(we,Ft)=>`${Ft}("${je}")`),console.log(`🎼 Resized numeric degrees to match scale (${G||"chromatic"}): ${je}`))}const st=V||"C",it=G||"chromatic",Tt=this.convertNumericPatternToNoteNames(fe,st,it);if(Tt){const Me=I.convertNoteNamesToScaleDegrees(Tt,st,it);Me&&S(Me)&&(fe=Me,console.log(`🎼 Normalized numeric degrees to scale length (${it})`))}}catch(oe){console.warn("⚠️ Degree resize failed:",oe)}if(z&&(V||G)){const oe=wi(V||null,G||null);oe&&(ie=oe)}if(fe){!z&&Ai(fe)&&(fe=Kr(fe,V,G),Ct=fe),Ie=!1,zi(fe,!0),$t("modal-pattern",fe),V&&(I.currentKey=V),G&&(I.currentScale=G);const oe=document.getElementById("modal-pattern");if(oe){try{oe.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{oe.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}}console.log(`✅ Applied key/scale to pattern immediately: ${fe.substring(0,100)}...`)}else console.log("⚠️ Pattern unchanged - applyGlobalSettingsToPattern returned null or undefined")}else if(!de&&We&&!z){const Ae=J(_);let fe=V||null,oe=G||null;Ae&&(fe=fe||Ae.key||null,oe=oe||Ae.scale||null);const Ve=fe||"C",je=oe||"chromatic",gt=I.convertNoteNamesToScaleDegrees(_,Ve,je),it=(Kr(gt||_,V,G)||_).replace(/\.\s*scale\s*\([^)]*\)/gi,""),Tt=Gs(it,wi(V,G));if(S(Tt)){$t("modal-pattern",Tt),V&&(I.currentKey=V),G&&(I.currentScale=G);const Me=document.getElementById("modal-pattern");if(Me){try{Me.dispatchEvent(new Event("input",{bubbles:!0}))}catch{}try{Me.dispatchEvent(new Event("change",{bubbles:!0}))}catch{}}console.log(`✅ Converted note names to semitone degrees for scale: ${Tt.substring(0,120)}...`)}else console.log("⚠️ Conversion to semitones or upsert failed validation; leaving pattern unchanged")}else console.log(`⚠️ Cannot apply scale - hasChordModifier: ${de}, isNumericPattern: ${Ge}, hasNoteFunction: ${ae}, hasExplicitNotes: ${We}`)};mt&&!mt.dataset.listenerAttached&&(mt.addEventListener("change",()=>{X(!1)}),mt.dataset.listenerAttached="true"),Ht&&!Ht.dataset.listenerAttached&&(Ht.addEventListener("change",()=>{X(!1)}),Ht.dataset.listenerAttached="true");const J=M=>{const _=M.match(/\.\s*scale\s*\(\s*['"]([^'"]+)['"]\s*\)/i);if(_&&_[1]){const T=_[1];if(T.includes(":")){const[N,L]=T.split(":");return{key:N.trim(),scale:L.trim()}}else return{key:"C",scale:T.trim()}}return null};let ie=null,be=null,Ie=!1,Ct=null,_n=null,Fn=null,Si=null;const wi=(M,_)=>{const T=M&&M.trim()!=="",N=_&&_.trim()!=="";if(!T&&!N)return null;const L=T?M.trim().toLowerCase():"c",z=N?_.trim():"major";return`.scale('${L}:${z}')`},zn=M=>{if(!M||typeof M!="string")return null;const _=M.match(/\bnote\s*\(\s*["']([^"']+)["']/i);if(!_||!_[1])return null;const N=_[1].match(/([a-gA-G])([#b]?)/);if(!N)return null;const L=N[1].toUpperCase(),z=N[2]?N[2]:"";return`${L}${z}`},zi=(M,_=!1)=>{if(!M||!jn(M)){be=null,Ie=!1;return}if(Ie&&!_)return;if(Ai(M)){be=M;return}const T=I.convertNoteNamesToSemitones(M);T&&Ai(T)&&(be=T)},Gs=(M,_)=>{if(!M||!_||/\.\s*scale\s*\(/i.test(M))return M;const T=M.search(/\.(s|sound)\s*\(/i);if(T!==-1){const L=M.slice(0,T),z=M.slice(T);return`${L}${_}${z}`}const N=M.trim();return N.startsWith("(")&&N.endsWith(")")?`${M}${_}`:`(${M})${_}`},Kr=(M,_,T)=>{if(!M||!Ai(M))return M;const N=!_||!_.trim()||!T||!T.trim()?J(M):null,L=_&&_.trim()||(N==null?void 0:N.key)||"C",z=T&&T.trim()||(N==null?void 0:N.scale)||"chromatic",V=this.convertNumericPatternToNoteNames(M,L,z);if(!V)return M;const G=I.convertNoteNamesToScaleDegrees(V,L,z);if(G&&Ai(G)){const ae=I.getScaleSemitoneSteps(L,z);if(!ae||ae.length===0)return G;const pe=ae.length;return(de=>{const He=/\b(n|note)\s*\(\s*(["'])([\s\S]*?)\2\s*\)/gi;return de.replace(He,(We,Ge,Ae,fe)=>{const oe=fe.trim().split(/\s+/);if(oe.length<=pe)return We;const Ve=oe.map(st=>{const it=parseInt(st,10);return Number.isFinite(it)?it:null});if(Ve.some(st=>st===null)||!Ve.every((st,it)=>st===it))return We;const gt=Array.from({length:pe},(st,it)=>String(it)).join(" ");return`${Ge}(${Ae}${gt}${Ae})`})})(G)}return M},iu=(M,_,T=!1)=>{if(!M||!jn(M))return M;const N=I.patternHasNoteNames&&I.patternHasNoteNames(M)||/\b(note|n)\s*\(\s*["'][^"']*[a-gA-G][#b]?\d/i.test(M),L=I.patternHasNumericNotePattern&&I.patternHasNumericNotePattern(M)||/\b(note|n)\s*\(\s*["'][\d\s\-~<>[\]]+["']/i.test(M)&&!N;if(_){if(L&&!N){Ie||(be=M),Ie=!0;const z=J(M),V=document.getElementById("modal-key-select"),G=document.getElementById("modal-scale-select");let ae=V&&V.value||null,pe=G&&G.value||null;return z&&(ae=z.key,pe=z.scale,console.log(`🎼 Using scale from pattern .scale() modifier: ${ae}:${pe}`)),ae||pe?t.convertNumericPatternToNoteNames(M,ae,pe||"major"):(console.log("⚠️ No key/scale selected, using C major for conversion"),t.convertNumericPatternToNoteNames(M,"C","major"))}return M}else{if(N&&!L){if(Ie=!1,be&&Ai(be))return console.log("🔁 Restoring semitone snapshot for note-name toggle"),be;const z=J(M);let V=null,G=null;if(z)V=z.key,G=z.scale;else{const pe=zn(M);if(pe)V=pe,G="chromatic";else{const se=document.getElementById("modal-key-select"),de=document.getElementById("modal-scale-select");V=se&&se.value||"C",G=de&&de.value||"chromatic"}}let ae=I.convertNoteNamesToScaleDegrees(M,V||"C",G||"chromatic");if(ae&&ae!==M){const pe=wi(V||"C",G||"chromatic");return pe&&(ae=Gs(ae,pe)),console.log(`🔄 Converted note names to scale degrees: ${ae.substring(0,80)}...`),zi(ae,!0),Ct=ae,ae}return M}return M}},Ws=document.getElementById("modal-keep-notes-as-written");Ws&&!Ws.dataset.listenerAttached&&(Ws.addEventListener("change",()=>{const M=dt("modal-pattern"),_=Ws.checked;let T;_&&Fn&&Si&&M===Si?(T=Fn,console.log("🔁 Restoring original note-name pattern from snapshot")):!_&&_n&&M===_n&&Ct?(T=Ct,console.log("🔁 Restoring canonical numeric pattern from snapshot")):T=iu(M,_,!0);const N=document.getElementById("modal-key-select"),L=document.getElementById("modal-scale-select");if(_?Ie=!0:Ie=!1,_&&T){const z=/\.\s*scale\s*\((['"])(?:(?=(\\?))\2.)*?\1\)/gi,V=T.match(z);if(V&&V.length>0)ie=V[V.length-1];else{const G=wi(N==null?void 0:N.value,L==null?void 0:L.value);G&&(ie=G)}T=T.replace(z,""),T=T.replace(/\.\s*scale\s*\([^)]*\)/gi,""),T=T.replace(/\.+/g,".").replace(/\.\s*\./g,".").trim(),T=T.replace(/\.+$/,"").trim(),console.log("🗑️ Removed .scale() modifier when switching to note names")}else!_&&T&&ie&&(T=Gs(T,ie));T!==M?($t("modal-pattern",T),_?(Ct=M,_n=T,Ie=!0,Fn=null,Si=null):(_n=null,Ie=!1,M&&jn(M)?(Fn=M,Si=T):(Fn=null,Si=null),zi(T,!0)),console.log(`🔄 Converted pattern ${_?"to note names":"to semitones"}: ${T.substring(0,100)}...`)):_||(_n=null,Ie=!1,Fn=null,Si=null,zi(M,!0)),br()}),Ws.dataset.listenerAttached="true");const br=()=>{const M=document.getElementById("modal-key-scale-group");if(!M)return;document.getElementById("modal-keep-notes-as-written");const _=dt("modal-pattern"),T=_&&jn(_);M.style.display=T?"block":"none"};zi(dt("modal-pattern"),!0);const su=M=>M.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),ru=(M,_)=>{if(!M||!_)return M;let T=M.trim();const N=(z,V,G)=>{if(!G)return z;const ae=new RegExp(`\\s*\\.\\s*${V}\\s*\\(\\s*${su(G)}\\s*\\)\\s*$`,"i");let pe=z;for(;ae.test(pe);)pe=pe.replace(ae,"").trim();return pe};return typeof _.gain=="number"&&Math.abs(_.gain-1)>1e-6&&(T=N(T,"gain",_.gain.toFixed(2))),typeof _.pan=="number"&&Math.abs(_.pan)>1e-6&&(T=N(T,"pan",_.pan.toFixed(2))),T=(z=>{let V=z;for(;V.startsWith("(")&&V.endsWith(")");){let G=0,ae=!0;for(let pe=0;pe<V.length;pe++){const se=V[pe];if(se==="("?G++:se===")"&&G--,G===0&&pe<V.length-1){ae=!1;break}}if(ae&&G===0)V=V.slice(1,-1).trim();else break}return V})(T.trim()),T};this.syncElementsFromMasterPattern=M=>{var _,T;if(!M||typeof M!="string"){console.warn("⚠️ Cannot sync elements - master pattern missing or invalid");return}try{const N=/^\/\/\s*Controls Selected Tempo:[^\n]*\n?/im;let L=M.replace(N,"").trim();if(!L){console.warn("⚠️ Master pattern empty after sanitizing, skipping element sync");return}let z=L;const V=L.indexOf("stack(");if(V!==-1){const se=L.indexOf("(",V);if(se!==-1){let de=1,He=se+1,We=!1,Ge=null;for(;He<L.length&&de>0;){const Ae=L[He],fe=L[He-1];if(We)Ae===Ge&&fe!=="\\"&&(We=!1,Ge=null);else if(Ae==='"'||Ae==="'")We=!0,Ge=Ae;else if(Ae==="(")de++;else if(Ae===")"&&(de--,de===0)){z=L.slice(se+1,He);break}He++}}}const G=/\s*\/\*\s*Channel\s+(\d+)\s*\*\/([\s\S]*?)(?=(\s*\/\*\s*Channel\s+\d+\s*\*\/)|$)/g;let ae;const pe=[];for(;(ae=G.exec(z))!==null;){const se=parseInt(ae[1],10);if(!Number.isFinite(se)||se<1)continue;let de=ae[2].trim();if(!de||(de=de.replace(/^,+/,"").replace(/,+$/,"").trim(),!de))continue;const He=((_=ae[0])==null?void 0:_.trim())||de,We=`element-${se}`,Ge=(T=I.trackedPatterns)==null?void 0:T.get(We),fe=ru(de,Ge)||de,Ve={...this.loadElementConfig(We)||{},pattern:fe};if(this.saveElementConfig(We,Ve,!0),I.trackedPatterns){const je=(Ge==null?void 0:Ge.gain)??(typeof I.getElementGain=="function"?I.getElementGain(We):.8),gt=(Ge==null?void 0:Ge.pan)??(typeof I.getElementPan=="function"?I.getElementPan(We):0),st=(Ge==null?void 0:Ge.muted)??!1,it=(Ge==null?void 0:Ge.soloed)??!1;I.trackedPatterns.set(We,{rawPattern:He,pattern:fe,gain:je,pan:gt,muted:st,soloed:it})}if(this.currentEditingElementId===We){const je=dt("modal-pattern");if((je==null?void 0:je.trim())!==de.trim()&&($t("modal-pattern",de),console.log(`📝 Updated modal editor for ${We} to match master pattern`)),b.active&&i&&Et(i.value)){console.log("🔁 Refreshing drum grid to match updated pattern"),b.updatingFromPattern=!0;const st=document.getElementById("modal-time-signature-select"),it=(st==null?void 0:st.value)||this.currentTimeSignature||"4/4",Tt=ki(it);Ri(de,Tt),b.updatingFromPattern=!1}}pe.push(We)}pe.length>0?console.log(`🔄 Synced master pattern changes to elements: ${pe.join(", ")}`):console.warn("ℹ️ No channel definitions found while syncing master pattern")}catch(N){console.warn("⚠️ Failed to sync master pattern to elements:",N)}},setTimeout(()=>{const M=dt("modal-pattern"),_=mt&&mt.value||null,T=Ht&&Ht.value||null;M&&jn(M)&&(_||T)&&(console.log(`🎼 Applying initial key/scale on modal open: key="${_}", scale="${T}"`),X())},200),i&&!i.dataset.listenerAttached&&i.addEventListener("change",async M=>{var Me,Qt,_t;const _=M.target.value,T=hc(_),N=T.bankValue;console.log("📦 Bank select changed to:",_),i.value!==_&&(i.value=_);const L=this.currentEditingElementId,z=(we={},Ft=!0)=>{if(!L)return;const B={...this.loadElementConfig(L)||{},...we};T.isVcslInstrument?B.vcslInstrument=T.vcslInstrument:"vcslInstrument"in B&&delete B.vcslInstrument,this.saveElementConfig(L,B,Ft)};if(N&&N!==""){St&&(St.value="");const we=(Me=document.getElementById("modal-pattern-bank"))==null?void 0:Me.closest(".form-group");we&&(we.style.display="block"),br(),this.selectedTagKey="bank",typeof this.refreshSnippetButtons=="function"&&setTimeout(()=>{this.refreshSnippetButtons().catch(Ft=>console.warn("⚠️ Unable to refresh snippet tags:",Ft))},100)}else br(),this.selectedTagKey=null,typeof this.refreshSnippetButtons=="function"&&setTimeout(()=>{this.refreshSnippetButtons().catch(we=>console.warn("⚠️ Unable to refresh snippet tags:",we))},100);if(!L){console.warn("⚠️ No elementId when bank changed");return}const V=document.getElementById("status-text"),G=document.getElementById("modal-pattern"),ae=!!(I!=null&&I.masterActive),pe=dt("modal-pattern");N&&N!==""&&(!pe||pe.trim()==="")&&G&&(G.placeholder='Drums and Percussion: s("bd sd rim cp hh oh cr rd ht mt lt sh cb tb perc misc fx"), Synths: note("c3 d3 [e3 f3]")');const se=(Qt=document.getElementById("modal-sample-url"))==null?void 0:Qt.closest(".form-group"),de=(_t=document.getElementById("modal-sample-file"))==null?void 0:_t.closest(".form-group"),He=document.getElementById("modal-sample-name-group"),We=N&&N!=="";if(se&&(se.style.display=We?"none":"block"),de&&(de.style.display=We?"none":"block"),He&&(He.style.display=We?"none":"block"),!N||N===""){console.log("📦 Using Default (no bank)"),G.placeholder="",V&&(V.textContent="📦 Using Default samples");const we=document.getElementById("modal-title");we.value="Default";const Ft=document.getElementById("modal-element-id");Ft&&(Ft.textContent=er(L)),di(L,"Default"),z({title:"Default",bank:void 0},!1),console.log(`📝 Saved title "Default" for ${L}`);let Zi=dt("modal-pattern").trim(),B=x(Zi);B&&B.trim()!==""?(B=B.replace(/\.\s*bank\s*\(\s*["'][^"']*["']\s*\)/gi,""),B=B.replace(/\.+/g,".").replace(/\.\s*\./g,".").trim(),B=B.replace(/\.+$/,"").trim(),$t("modal-pattern",B),G.placeholder="",console.log(`📝 Removed .bank() modifier only, preserving pattern: ${B.substring(0,80)}...`)):G.placeholder=""}else{const we=(_e,Wt)=>{if(!_e||_e.trim()==="")return Wt;let Ke=_e.trim();return!Ke.endsWith(".")&&!Wt.startsWith(".")&&(Ke+="."),Ke+=Wt,Ke.replace(/\.\.+/g,".").replace(/\.\s+\./g,".").trim()};if(T.isVcslInstrument){const _e=T.vcslInstrument,Wt=Hy(_e),Ke=document.getElementById("modal-title");V&&(V.textContent=`🎙️ VCSL Instrument: ${Wt}`),Ke&&(Ke.value=Wt);const Te=document.getElementById("modal-element-id");Te&&(Te.textContent=er(L)),di(L,Wt),z({title:Wt,bank:"vcsl"},!0);let ge=dt("modal-pattern").trim(),Le=x(ge);const ct=/sound\s*\(\s*["'][^"']*["']\s*\)/i,lt=Le&&Le.trim()!==""?Le:"";lt?ct.test(lt)?Le=lt.replace(ct,`sound("${_e}")`):lt.includes(".s(")?Le=lt.replace(/\.s\s*\(\s*["'][^"']*["']\s*\)/i,`.sound("${_e}")`):Le=we(lt,`sound("${_e}")`):Le=`sound("${_e}")`,Le=v(Le,"vcsl",!0),$t("modal-pattern",Le),G.placeholder="",setTimeout(()=>{ue()},50);return}const Ft=To(N);if([...va,...Er].includes(Ft)||Jy.includes(N)){const _e=document.getElementById("modal-title"),Wt={piano:"Piano",supersaw:"Saw Synth",gtr:"Guitar",casio:"Casio",wood:"Jazz",jazz:"Jazz",metal:"Metal",folkharp:"Folk Harp",superpiano:"Piano"},Ke=Wt[Ft]||Wt[N]||Ft.charAt(0).toUpperCase()+Ft.slice(1);console.log(`🎹 Using synth sound: ${Ft}`),V&&(V.textContent=`🎹 Using ${Ke}`),_e.value=Ke;const Te=document.getElementById("modal-element-id");Te&&(Te.textContent=er(L)),di(L,Ke),z({title:Ke,bank:N}),console.log(`📝 Saved title "${Ke}" for ${L}`);let ge=dt("modal-pattern").trim(),Le=x(ge);Le&&Le.trim()!==""?(console.log(`🎹 BANK CHANGE: Updating .s() modifier only, preserving pattern: ${Le.substring(0,80)}...`),Le=v(Le,Ft,!1),console.log(`🎹 BANK CHANGE: Updated pattern: ${Le.substring(0,80)}...`)):(Le=`note("c3").s("${Ft}")`,console.log(`🎹 BANK CHANGE: Created minimal pattern with .s("${Ft}")`)),$t("modal-pattern",Le),G.placeholder="";const ct=document.getElementById("modal-keep-notes-as-written");ct&&(ct.checked=!0,console.log("🎹 Set note names toggle to ON for synth/waveform")),setTimeout(()=>{ue()},50);const lt=dt("modal-pattern");console.log(`🎹 BANK CHANGE: Verified textarea contains: ${lt}`)}else{console.log(`📦 Loading bank: ${N}`),V&&(V.textContent=`📦 Loading bank: ${N}...`);const _e=["RolandTR808","RolandTR909","RolandTR707","RhythmAce","AkaiLinn","ViscoSpaceDrum","CasioRZ1"],Wt=[...va,...Er,"insect","wind","east","crow","space","numbers","superpiano","jazz"],Ke=(N==null?void 0:N.toLowerCase())||"",Te=QM.has(Ke),ge=_e.includes(N)||Wt.includes(Ke);let Le=!1;if(Te)try{Le=await I.loadBank(Ke),Le?(console.log(`✅ Specialty sample bank loaded: ${Ke}`),V&&(V.textContent=`✅ Bank loaded: ${Ke}`)):(console.log(`⚠️ Specialty sample bank "${Ke}" may not be fully loaded`),V&&(V.textContent=`⚠️ Bank "${Ke}" may not be available`))}catch(ct){console.error(`Error loading specialty bank ${Ke}:`,ct),Le=!1,V&&(V.textContent=`⚠️ Error loading bank: ${Ke}`)}else if(ge)Le=!0,console.log(`✅ Built-in bank/waveform: ${N} (no loading required)`),V&&(V.textContent=`✅ Built-in: ${N}`);else try{Le=await I.loadBank(N),Le?(console.log(`✅ Bank loaded: ${N}`),V&&(V.textContent=`✅ Bank loaded: ${N}`)):(console.log(`⚠️ Bank "${N}" may not be fully loaded, but continuing...`),V&&(V.textContent=`⚠️ Bank "${N}" may not be available`))}catch(ct){console.error(`Error loading bank ${N}:`,ct),Le=!1,V&&(V.textContent=`⚠️ Error loading bank: ${N}`)}try{const ct=document.getElementById("modal-title");let lt;const ze=zh.find(wt=>wt.value===Ke);N.startsWith("github:")?lt=N.replace("github:tidalcycles/",""):Ar.has(N)?lt=$o(N):ze?lt=ze.label:lt=N,ct.value=lt;const ht=document.getElementById("modal-element-id");if(ht&&(ht.textContent=er(L)),di(L,lt),this.activeElements.has(L)){console.log(`🛑 Stopping sound for ${L} (bank selected, not auto-playing)`),I.stopSound(L),this.activeElements.delete(L);const wt=document.querySelector(`[data-sound-id="${L}"]`);if(wt){const tn=wt.querySelector(".element-circle");tn&&tn.classList.remove("playing"),this.updateStatusDots(L,!0,!1)}}const On=this.loadElementConfig(L)||{};try{const wt={...On,title:lt,bank:N};localStorage.setItem(`elementConfig_${L}`,JSON.stringify(wt)),console.log(`📝 Saved title "${lt}" and bank "${N}" for ${L} (NOT saved to master)`)}catch(wt){console.warn("⚠️ Could not save config:",wt)}let Rt=dt("modal-pattern").trim();console.log(`📝 Bank change: currentPattern="${Rt.substring(0,100)}..."`);let qe=x(Rt);console.log(`📝 Bank change: normalizedPattern="${qe.substring(0,100)}..."`);const rt=Ar.has(N),ke=va.includes(Ke)||Er.includes(Ke)||["sawtooth","square","triangle","sine"].includes(Ke);if(console.log(`📝 Bank change: isDrumBank=${rt}, isSynthOrWaveform=${ke}, isSpecialSampleBank=${Te}, bankValue="${N}"`),rt||Te){const wt=Te?Ke:N;if(qe&&qe.trim()!==""){const tn=qe;qe=v(qe,wt,!0),console.log(`📝 Updated .bank("${wt}") modifier`),console.log(`   Before: ${tn.substring(0,80)}...`),console.log(`   After: ${qe.substring(0,80)}...`)}else Te?qe=`${wt==="mridangam"?'sound("tha dhi thom nam")':'sound("ahh ~ ohh")'}.bank("${wt}")`:qe=`s("bd").bank("${wt}")`,console.log(`📝 Created minimal pattern with .bank("${wt}")`);$t("modal-pattern",qe),G.placeholder=""}else if(ke){const wt=To(N);if(qe&&qe.trim()!==""){const wn=qe;qe=v(qe,wt,!1),console.log(`📝 Updated .s("${wt}") modifier`),console.log(`   Before: ${wn.substring(0,80)}...`),console.log(`   After: ${qe.substring(0,80)}...`)}else qe=`note("c3").s("${wt}")`,console.log(`📝 Created minimal pattern with .s("${wt}")`);$t("modal-pattern",qe),G.placeholder="";const tn=document.getElementById("modal-keep-notes-as-written");tn&&(tn.checked=!0,console.log("📝 Set note names toggle to ON for synth/waveform"))}else G.placeholder='Add a pattern, e.g., sound("bd").bank("CustomBank")';console.log(`📝 Final pattern in editor: ${dt("modal-pattern").substring(0,100)}...`),setTimeout(()=>{ue()},50)}catch(ct){console.error("Error loading bank:",ct)}}}const Ge=document.getElementById("modal-title"),Ae=Ge?Ge.value.trim():"",fe=G?G.value.trim():"";let oe;fe&&fe.includes("(")&&fe.includes(")")&&(fe.match(/\([^)]+\)/g)||[]).some(we=>we.includes("drum")||we.includes("Kick")||we.includes("hi-hat"))?oe=x(fe):oe=fe;const Ve=document.getElementById("modal-keep-notes-as-written"),je=Ve&&Ve.checked;if(oe&&jn(oe)&&!Ai(oe)&&!je){const we=I.convertPatternForScale(oe);we&&we!==oe&&(oe=we,G&&$t("modal-pattern",we))}if(!ae&&this.activeElements.has(L)){console.log(`🛑 Stopping sound for ${L} (bank changed, not auto-playing)`),I.stopSound(L),this.activeElements.delete(L);const we=document.querySelector(`[data-sound-id="${L}"]`);if(we){const Ft=we.querySelector(".element-circle");Ft&&Ft.classList.remove("playing"),this.updateStatusDots(L,!0,!1)}}else ae&&console.log(`⏭️ Master running – skipping element stop for ${L}`);const gt=document.querySelector(`[data-sound-id="${L}"]`);if(!ae&&gt){const we=gt.querySelector(".loop-button");we&&we.classList.contains("active")&&(console.log(`🛑 Stopping loop for ${L} (bank changed)`),we.classList.remove("active"),I.stopSound(L))}const st=document.getElementById("modal-keep-notes-as-written"),it=st?st.checked:!1;this.saveElementConfig(L,{title:Ae||bankDisplayName,pattern:oe,bank:N||void 0,keepNotesAsWritten:it},!0),console.log(`💾 Saved config with bank: ${N}`),I.invalidatePatternCache(L),oe&&(await I.preEvaluatePattern(L,oe),console.log(`📦 Pre-evaluated pattern for ${L} (silent, ready for manual trigger)`));const Tt=N&&Ar.has(N);console.log("📦 Bank change: isDrum=",Tt,"bankValue=",N),Tt?(console.log("📦 Drum bank selected – preserving current editor mode"),b.patternEditorEnabled?In():(b.built=!1,setTimeout(()=>{In()},0))):(console.log("📦 Not a drum bank, using code editor"),he(!0),In())});const io=e.querySelector(".btn-cancel");io&&io.addEventListener("click",()=>{Ue()});const so=e.querySelector(".btn-save");so&&so.addEventListener("click",()=>{if(!this.currentEditingElementId)return;b.active&&Li();let M=document.getElementById("modal-title").value.trim();M==="No sound assigned"&&(M="");const _=dt("modal-pattern").trim();let T;_.includes(".bank(")||_.includes(".s(")||_.includes(".synth(")||jn(_)||_.includes("sound(")||_.includes("s(")?T=_:T=x(_);const N=document.getElementById("modal-keep-notes-as-written"),L=N?N.checked:!1;if(T&&jn(T)){const Ge=/\b(note|n)\s*\(\s*["'][a-gA-G][#b]?\d/.test(T),Ae=/\b(n|note)\s*\(\s*["'][\d\s\-]+["']/.test(T)&&!/\b(note|n)\s*\(\s*["'][a-gA-G]/.test(T);Ge&&!Ae?console.log(`📝 Preserving note names format: ${T.substring(0,50)}...`):Ae&&!Ge&&console.log(`📝 Preserving semitones format: ${T.substring(0,50)}...`)}const z=L,V=document.getElementById("modal-key-select"),G=document.getElementById("modal-scale-select"),ae=V&&V.value||null,pe=G&&G.value||null;if(console.log(`🎼 Modal save: Reading key/scale from dropdowns - elementKey="${ae}", elementScale="${pe}", modalKeySelect.value="${V==null?void 0:V.value}", modalScaleSelect.value="${G==null?void 0:G.value}"`),T&&jn(T)&&(ae||pe)){const Ge=/\b(note|n)\s*\(/.test(T),Ae=/\b(note|n)\s*\(\s*["'][a-gA-G][#b]?\d/.test(T),fe=/\b(n|note)\s*\(\s*["'][\d\s\-]+["']/.test(T)&&!/\b(note|n)\s*\(\s*["'][a-gA-G]/.test(T),oe=/\.\s*chord\s*\(/i.test(T),Ve=Ge&&fe&&!Ae&&!oe;if(console.log(`🎼 Modal save: pattern="${T.substring(0,50)}...", hasNoteFunction=${Ge}, hasNoteNames=${Ae}, hasNumericNotes=${fe}, isNumericPattern=${Ve}, elementKey="${ae}", elementScale="${pe}"`),!oe&&Ve&&!Ae){const je=I.applyGlobalSettingsToPattern(T,!1,!1,ae||null,pe||null);console.log(`🎼 Modal save: patternWithScale="${je?je.substring(0,80):"null"}..."`),je&&je!==T?(T=je,$t("modal-pattern",T),console.log(`✅ Applied key/scale to pattern: ${T.substring(0,80)}...`)):console.log("⚠️ Scale not applied - pattern unchanged or applyGlobalSettingsToPattern returned same pattern")}else console.log(Ae?"📝 Pattern uses note names - preserving format, not applying scale modifier":`⚠️ Scale not applied - hasChordModifier=${oe}, isNumericPattern=${Ve}`)}else console.log(`⚠️ Key/Scale not applied - pattern: ${!!T}, hasNoteCall: ${T?jn(T):!1}, elementKey: ${ae}, elementScale: ${pe}`);const se=document.getElementById("modal-sample-url").value.trim(),de=document.getElementById("modal-sample-file"),He=i?i.value:"";let We=se;if(de.files&&de.files.length>0){const Ge=de.files[0],Ae=new FileReader;Ae.onload=fe=>{We=fe.target.result,this.saveElementConfig(this.currentEditingElementId,{title:M||this.currentEditingElementId,pattern:T,sampleUrl:We,fileName:Ge.name,bank:He||void 0,keepNotesAsWritten:z,key:ae,scale:pe}),Ue()},Ae.readAsDataURL(Ge)}else this.saveElementConfig(this.currentEditingElementId,{title:M||this.currentEditingElementId,pattern:T,sampleUrl:We,bank:He||void 0,keepNotesAsWritten:z,key:ae,scale:pe}),Ue()}),e.addEventListener("click",M=>{M.target===e&&Ue()}),document.addEventListener("keydown",M=>{M.key==="Escape"&&e.style.display!=="none"&&Ue()}),document.querySelectorAll(".config-button").forEach(M=>{M.addEventListener("click",_=>{_.stopPropagation();const T=M.closest(".sound-element");if(T){const N=T.getAttribute("data-sound-id");N&&De(N)}})}),this.openConfigModal=De}isOverlapping(e,t){return!(e.x+e.width<t.x||t.x+t.width<e.x||e.y+e.height<t.y||t.y+t.height<e.y)}setupAddElementButton(){const e=document.getElementById("add-element-btn");e&&e.addEventListener("click",()=>{this.createNewElement()})}createNewElement(){this.elementCounter++;const e=`element-${this.elementCounter}`,t=this.elementCounter;console.log(`➕ Creating new element: ${e}`);const i=document.querySelector(".elements-container"),s=document.getElementById("add-element-btn");if(!i||!s)return;const r=`
      <div class="sound-element" data-sound-id="${e}">
        <input type="range" class="gain-slider" min="0" max="1" step="0.01" value="0.8" orient="vertical" />
        <div class="volume-label">Gain</div>
        <div class="channel-label">Channel ${t}</div>
        <input type="range" class="pan-slider" min="-1" max="1" step="0.01" value="0" orient="horizontal" />
        <div class="pan-label">Pan</div>
        <div class="status-dots">
          <div class="status-dot loaded-dot" title="Sound Loaded"></div>
          <div class="status-dot playing-dot" title="Playing"></div>
        </div>
        <div class="master-status-indicator" title="Pattern saved to Master">M</div>
        <div class="element-title">Element ${t}</div>
        <div class="element-indicator"></div>
        <div class="element-circle"></div>
        <div class="spiral-visualization-container" style="display: none;"></div>
        <div class="element-controls">
          <button class="solo-button" title="Solo">S</button>
          <button class="mute-button" title="Mute">M</button>
        </div>
        
        <!-- Synthesis Section (ADSR Envelope) - Only for synth sounds -->
        <div class="collapsible-section synthesis-section" style="display: none;">
          <button class="collapsible-toggle" data-target="synthesis">
            <span class="toggle-icon">▶</span> Synthesis
          </button>
          <div class="collapsible-content synthesis-content">
            <div class="slider-row">
              <label>Attack</label>
              <input type="range" class="synth-slider attack-slider" min="0" max="2" step="0.01" value="0.01" />
              <span class="slider-value">0.01</span>
            </div>
            <div class="slider-row">
              <label>Decay</label>
              <input type="range" class="synth-slider decay-slider" min="0" max="2" step="0.01" value="0.1" />
              <span class="slider-value">0.1</span>
            </div>
            <div class="slider-row">
              <label>Sustain</label>
              <input type="range" class="synth-slider sustain-slider" min="0" max="1" step="0.01" value="0.5" />
              <span class="slider-value">0.5</span>
            </div>
            <div class="slider-row">
              <label>Release</label>
              <input type="range" class="synth-slider release-slider" min="0" max="5" step="0.01" value="0.1" />
              <span class="slider-value">0.1</span>
            </div>
          </div>
        </div>
        
        <!-- Filters Section -->
        <div class="collapsible-section">
          <button class="collapsible-toggle" data-target="filters">
            <span class="toggle-icon">▶</span> Filters
          </button>
          <div class="collapsible-content filters-content">
            <div class="slider-row">
              <label>Low-pass</label>
              <span class="slider-endpoint slider-endpoint--min">20 Hz</span>
              <input type="range" class="filter-slider lpf-slider" min="20" max="20000" step="10" value="20000" />
              <span class="slider-value">20000</span>
              <span class="slider-endpoint slider-endpoint--max">20 kHz</span>
            </div>
            <div class="slider-row">
              <label>High-pass</label>
              <span class="slider-endpoint slider-endpoint--min">20 Hz</span>
              <input type="range" class="filter-slider hpf-slider" min="20" max="20000" step="10" value="20" />
              <span class="slider-value">20</span>
              <span class="slider-endpoint slider-endpoint--max">20 kHz</span>
            </div>
            <div class="slider-row">
              <label>Resonance</label>
              <input type="range" class="filter-slider resonance-slider" min="0" max="20" step="0.1" value="0" />
              <span class="slider-value">0</span>
            </div>
          </div>
        </div>
        
        <!-- Effects Section -->
        <div class="collapsible-section">
          <button class="collapsible-toggle" data-target="effects">
            <span class="toggle-icon">▶</span> Effects
          </button>
          <div class="collapsible-content effects-content">
            <div class="slider-row">
              <label>Reverb</label>
              <input type="range" class="effect-slider reverb-slider" min="0" max="1" step="0.01" value="0" />
              <span class="slider-value">0</span>
            </div>
            <div class="slider-row">
              <label>Delay</label>
              <input type="range" class="effect-slider delay-slider" min="0" max="1" step="0.01" value="0" />
              <span class="slider-value">0</span>
            </div>
            <div class="slider-row">
              <label>Distortion</label>
              <input type="range" class="effect-slider distortion-slider" min="0" max="10" step="0.1" value="0" />
              <span class="slider-value">0</span>
            </div>
          </div>
        </div>
        
        <div class="element-action-buttons">
        <button class="config-button">Configure Sound</button>
          <div class="history-button-row">
            <button class="history-button" type="button" data-history-target="channel">Load</button>
            <button class="history-button history-button--primary" type="button" data-history-save="channel">Save</button>
          </div>
        </div>
      </div>
    `;s.insertAdjacentHTML("beforebegin",r);const a=document.querySelector(`[data-sound-id="${e}"]`);if(a){Lt.elements.push({id:e,selector:`[data-sound-id="${e}"]`,type:"strudel",pattern:"",description:"No sound assigned"}),this.registerElements([{element:a,elementId:e}]),this.setupElementControlsForElement(a,e);const o=a.querySelector(".config-button");o&&this.openConfigModal&&o.addEventListener("click",c=>{c.stopPropagation(),this.openConfigModal(e)});const l=a.querySelector(".config-button");if(l&&(l.textContent="Configure Sound"),di(e,""),this.initializeElementVisualizations(a,e),l){const c=this.loadElementConfig(e);(!c||!c.pattern||c.pattern.trim()==="")&&(l.textContent="Configure Sound")}console.log(`✅ Element ${e} created and fully initialized`)}}setupElementControlsForElement(e,t){if(!e||!t)return;const i=e.querySelector(".gain-slider"),s=e.querySelector(".pan-slider");if(i){const o=parseFloat(i.value);I.setElementGain(t,o),i.addEventListener("input",l=>{l.stopPropagation();const c=parseFloat(l.target.value);I.setElementGain(t,c),I.updateTrackedElementGain(t,c),this.updateMasterPatternDisplay()})}if(s){const o=parseFloat(s.value);I.setElementPan(t,o),s.addEventListener("input",l=>{l.stopPropagation();const c=parseFloat(l.target.value);I.setElementPan(t,c),I.updateTrackedElementPan(t,c),this.updateMasterPatternDisplay()})}const r=e.querySelector(".solo-button");r&&r.addEventListener("click",o=>{o.stopPropagation(),this.handleSoloButton(t,r)});const a=e.querySelector(".mute-button");a&&a.addEventListener("click",o=>{o.stopPropagation(),this.handleMuteButton(t,a)}),this.setupCollapsibleSections(e,t)}}let _o=null,fa=null,pa=null,Fo=null,kc=null;async function hg(){fa=new TM,fa.init(),fa.setOnLoginSuccess(a=>{_o=a,Ec(a)});try{const a=await nu();a?(_o=a,Ec(a)):$c()}catch{$c()}const n=document.getElementById("header-login-btn");n&&n.addEventListener("click",()=>{fa&&fa.show()});const e=document.getElementById("user-menu-button"),t=document.getElementById("user-menu-dropdown");e&&t&&(e.addEventListener("click",a=>{a.stopPropagation(),t.classList.toggle("active")}),document.addEventListener("click",a=>{!e.contains(a.target)&&!t.contains(a.target)&&t.classList.remove("active")}));const i=document.getElementById("user-logout-btn");i&&i.addEventListener("click",async()=>{try{await jd.logout(),_o=null,$c(),t.classList.remove("active")}catch(a){console.error("Logout error:",a)}});const s=document.getElementById("user-profile-link");s&&s.addEventListener("click",async a=>{a.preventDefault(),pa&&await pa.show(),t.classList.remove("active")}),pa=new _M,pa.init(),pa.setOnUpdate(a=>{_o=a,Ec(a)}),Fo=new FM,Fo.init();const r=document.getElementById("user-profiles-link");r&&r.addEventListener("click",async a=>{a.preventDefault(),Fo&&await Fo.show(),t.classList.remove("active")}),kc=new BM,kc.init(),window.savePatternDialog=kc}function Ec(n){const e=document.getElementById("header-login-btn"),t=document.getElementById("user-menu"),i=document.getElementById("user-name"),s=document.getElementById("user-avatar");e&&(e.style.display="none"),t&&(t.style.display="block"),i&&(i.textContent=n.name||n.email),s&&n.avatarUrl&&(s.src=n.avatarUrl,s.style.display="block")}function $c(){const n=document.getElementById("header-login-btn"),e=document.getElementById("user-menu");n&&(n.style.display="block"),e&&(e.style.display="none")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{new cg().init(),ng(),hg()}):(new cg().init(),ng(),hg());export{S3 as A,b3 as B,m3 as C,w3 as D,Bc as E,tx as F,v3 as G,Lo as H,Rg as I,Qg as J,Kv as K,kl as L,Ig as M,td as N,mS as O,Dg as P,Rn as Q,gS as R,Al as S,ed as T,Jv as U,nd as V,Ng as W,_g as X,A3 as Y,p3 as a,El as b,fS as c,Xh as d,Fc as e,Lg as f,zg as g,kg as h,Kh as i,ja as j,ur as k,Vg as l,Ag as m,Vt as n,pS as o,gr as p,Sg as q,ow as r,Uh as s,ss as t,g3 as u,f3 as v,O3 as w,d3 as x,y3 as y,aw as z};
