import{P as Re,l as J,Y as Ee,F as ze,n as Oe,z as Ne,a as We,p as De,f as H,i as se,v as $e}from"./strudel-core-cY4HxVpV.js";const G=(t="test-canvas",e)=>{let{contextType:a="2d",pixelated:n=!1,pixelRatio:i=window.devicePixelRatio}=e||{},r=document.querySelector("#"+t);if(!r){r=document.createElement("canvas"),r.id=t,r.width=window.innerWidth*i,r.height=window.innerHeight*i,r.style="pointer-events:none;width:100%;height:100%;position:fixed;top:0;left:0",n&&(r.style.imageRendering="pixelated"),document.body.prepend(r);let l;window.addEventListener("resize",()=>{l&&clearTimeout(l),l=setTimeout(()=>{r.width=window.innerWidth*i,r.height=window.innerHeight*i},200)})}return r.getContext(a,{willReadFrequently:!0})};let L={};function be(t){L[t]!==void 0&&(cancelAnimationFrame(L[t]),delete L[t])}function je(t){Object.keys(L).forEach(e=>(!t||e.startsWith(t))&&be(e))}let I={};H.prototype.draw=function(t,e){if(typeof window>"u")return this;let{id:a=1,lookbehind:n=0,lookahead:i=0}=e,r=Math.max(se(),0);be(a),n=Math.abs(n),I[a]=(I[a]||[]).filter(f=>!f.isInFuture(r));let l=this.queryArc(r,r+i).filter(f=>f.hasOnset());I[a]=I[a].concat(l);let c;const o=()=>{const f=se(),p=f+i;I[a]=I[a].filter(u=>u.isInNearPast(n,f));let h=Math.max(c||p,p-1/10);const m=this.queryArc(h,p).filter(u=>u.hasOnset());I[a]=I[a].concat(m),c=p,t(I[a],f,p,this),L[a]=requestAnimationFrame(o)};return L[a]=requestAnimationFrame(o),this};const Ue=(t=!0,e)=>{const a=G();t&&a.clearRect(0,0,a.canvas.width,a.canvas.height),je(e)};H.prototype.onPaint=function(t){return this.withState(e=>{e.controls.painters||(e.controls.painters=[]),e.controls.painters.push(t)})};H.prototype.getPainters=function(){let t=[];return this.queryArc(0,0,{painters:t}),t};class Le{constructor(e,a){this.onFrame=e,this.onError=a}start(){const e=this;let a=requestAnimationFrame(function n(i){try{e.onFrame(i)}catch(r){e.onError(r)}a=requestAnimationFrame(n)});e.cancel=()=>{cancelAnimationFrame(a)}}stop(){this.cancel&&this.cancel()}}class Xe{constructor(e,a){this.visibleHaps=[],this.lastFrame=null,this.drawTime=a,this.painters=[],this.framer=new Le(()=>{if(!this.scheduler){console.warn("Drawer: no scheduler");return}const n=Math.abs(this.drawTime[0]),i=this.drawTime[1],r=this.scheduler.now()+i;if(this.lastFrame===null){this.lastFrame=r;return}const l=this.scheduler.pattern.queryArc(Math.max(this.lastFrame,r-1/10),r);this.lastFrame=r,this.visibleHaps=(this.visibleHaps||[]).filter(o=>o.whole&&o.endClipped>=r-n-i).concat(l.filter(o=>o.hasOnset()));const c=r-i;e(this.visibleHaps,c,this,this.painters)},n=>{console.warn("draw error",n)})}setDrawTime(e){this.drawTime=e}invalidate(e=this.scheduler,a){if(!e)return;a=a??e.now(),this.scheduler=e;let[n,i]=this.drawTime;const[r,l]=[Math.max(a,0),a+i+.1];this.visibleHaps=this.visibleHaps.filter(o=>{var f;return((f=o.whole)==null?void 0:f.begin)<a}),this.painters=[];const c=e.pattern.queryArc(r,l,{painters:this.painters});this.visibleHaps=this.visibleHaps.concat(c)}start(e){this.scheduler=e,this.invalidate(),this.framer.start()}stop(){this.framer&&this.framer.stop()}}function Ze(t){return typeof window>"u"?"#fff":getComputedStyle(document.documentElement).getPropertyValue(t)}let ye={background:"#222",foreground:"#75baff",caret:"#ffcc00",selection:"rgba(128, 203, 196, 0.5)",selectionMatch:"#036dd626",lineHighlight:"#00000050",gutterBackground:"transparent",gutterForeground:"#8a919966"};function N(){return ye}function Ge(t){ye=t}let ce="#22222210";H.prototype.animate=function({callback:t,sync:e=!1,smear:a=.5}={}){window.frame&&cancelAnimationFrame(window.frame);const n=G();let{clientWidth:i,clientHeight:r}=n.canvas;i*=window.devicePixelRatio,r*=window.devicePixelRatio;let l=a===0?"99":Number((1-a)*100).toFixed(0);l=l.length===1?`0${l}`:l,ce=`#200010${l}`;const c=o=>{let f;o=Math.round(o),f=this.slow(1e3).queryArc(o,o),n.fillStyle=ce,n.fillRect(0,0,i,r),f.forEach(p=>{let{x:h,y:m,w:u,h:k,s:y,r:b,angle:d=0,fill:q="darkseagreen"}=p.value;if(u*=i,k*=r,b!==void 0&&d!==void 0){const v=d*2*Math.PI,[x,F]=[(i-u)/2,(r-k)/2];h=x+Math.cos(v)*b*x,m=F+Math.sin(v)*b*F}else h*=i-u,m*=r-k;const w={...p.value,x:h,y:m,w:u,h:k};n.fillStyle=q,y==="rect"?n.fillRect(h,m,u,k):y==="ellipse"&&(n.beginPath(),n.ellipse(h+u/2,m+k/2,u/2,k/2,0,0,2*Math.PI),n.fill()),t&&t(n,w,p)}),window.frame=requestAnimationFrame(c)};return window.frame=requestAnimationFrame(c),$e};const{x:we,y:Je,w:et,h:tt,angle:at,r:rt,fill:it,smear:nt}=Re("x","y","w","h","angle","r","fill","smear"),ot=J("rescale",function(t,e){return e.mul(we(t).w(t).y(t).h(t))}),lt=J("moveXY",function(t,e,a){return a.add(we(t).y(e))}),st=J("zoomIn",function(t,e){const a=Ne(1).sub(t).div(2);return e.rescale(t).move(a,a)}),fe={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function ct(t){return t=t.toLowerCase(),t[0]==="#"?de(t):fe[t]!==void 0?de(fe[t]):-1}function de(t){return t=t.slice(1),parseInt(t,16)}const Q=(t,e,a)=>t*(a-e)+e,he=t=>{let{value:e}=t;typeof t.value!="object"&&(e={value:e});let{note:a,n,freq:i,s:r}=e;if(i)return We(i);if(a=a??n,typeof a=="string")try{return De(a)}catch{return 0}return typeof a=="number"?a:r?"_"+r:e};H.prototype.pianoroll=function(t={}){let{cycles:e=4,playhead:a=.5,overscan:n=0,hideNegative:i=!1,ctx:r=G(),id:l=1}=t,c=-e*a,o=e*(1-a);const f=(p,h)=>(!i||p.whole.begin>=0)&&p.isWithinTime(h+c,h+o);return this.draw((p,h)=>{ee({...t,time:h,ctx:r,haps:p.filter(m=>f(m,h))})},{lookbehind:c-n,lookahead:o+n,id:l}),this};function ft(t){return Ee(t)?t.pianoroll():e=>e.pianoroll(t)}function ee({time:t,haps:e,cycles:a=4,playhead:n=.5,flipTime:i=0,flipValues:r=0,hideNegative:l=!1,inactive:c=N().foreground,active:o=N().foreground,background:f="transparent",smear:p=0,playheadColor:h=N().foreground,minMidi:m=10,maxMidi:u=90,autorange:k=0,timeframe:y,fold:b=1,vertical:d=0,labels:q=!1,fill:w=1,fillActive:v=!1,strokeActive:x=!0,stroke:F,hideInactive:S=0,colorizeInactive:A=1,fontFamily:R,ctx:s,id:E}={}){const P=s.canvas.width,W=s.canvas.height;let D=-a*n,Y=a*(1-n);E&&(e=e.filter(g=>g.hasTag(E))),y&&(console.warn("timeframe is deprecated! use from/to instead"),D=0,Y=y);const $=d?W:P,C=d?P:W;let z=d?[$,0]:[0,$];const O=Y-D,te=d?[0,C]:[C,0];let U=u-m+1,j=C/U,X=[];i&&z.reverse(),r&&te.reverse();const{min:ke,max:xe,values:Pe}=e.reduce(({min:g,max:T,values:V},B)=>{const M=he(B);return{min:M<g?M:g,max:M>T?M:T,values:V.includes(M)?V:[...V,M]}},{min:1/0,max:-1/0,values:[]});k&&(m=ke,u=xe,U=u-m+1),X=Pe.sort((g,T)=>typeof g=="number"&&typeof T=="number"?g-T:typeof g=="number"?1:String(g).localeCompare(String(T))),j=b?C/X.length:C/U,s.fillStyle=f,s.globalAlpha=1,p||(s.clearRect(0,0,P,W),s.fillRect(0,0,P,W)),e.forEach(g=>{var le;const T=g.whole.begin<=t&&g.endClipped>t;let V=F??(x&&T),B=!T&&w||T&&v;if(S&&!T)return;let M=(le=g.value)==null?void 0:le.color;o=M||o,c=A&&M||c,M=T?o:c,s.fillStyle=B?M:"transparent",s.strokeStyle=M;const{velocity:Ae=1,gain:Te=1}=g.value||{};s.globalAlpha=Ae*Te;const Me=(g.whole.begin-(i?Y:D))/O,ae=Q(Me,...z);let _=Q(g.duration/O,0,$);const re=he(g),qe=b?X.indexOf(re)/X.length:(Number(re)-m)/U,ie=Q(qe,...te);let ne=0;const oe=Q(t/O,...z);let K;if(d?K=[ie+1-(r?j:0),$-oe+ae+ne+1-(i?0:_),j-2,_-2]:K=[ae-oe+ne+1-(i?_:0),ie+1-(r?0:j),_-2,j-2],V&&s.strokeRect(...K),B&&s.fillRect(...K),q){const Fe=g.value.note??g.value.s+(g.value.n?`:${g.value.n}`:""),{label:Se,activeLabel:Ce}=g.value,Ie=(T&&Ce||Se)??Fe;let He=d?_:j*.75;s.font=`${He}px ${R||"monospace"}`,s.fillStyle=B?"black":M,s.textBaseline="top",s.fillText(Ie,...K)}}),s.globalAlpha=1;const Z=Q(-D/O,...z);return s.strokeStyle=h,s.beginPath(),d?(s.moveTo(0,Z),s.lineTo(C,Z)):(s.moveTo(Z,0),s.lineTo(Z,C)),s.stroke(),this}function ve(t,e={}){let[a,n]=t;a=Math.abs(a);const i=n+a,r=i!==0?a/i:0;return{fold:1,...e,cycles:i,playhead:r}}const Ye=(t={})=>(e,a,n,i)=>ee({ctx:e,time:a,haps:n,...ve(i,t)});H.prototype.punchcard=function(t){return this.onPaint(Ye(t))};H.prototype.wordfall=function(t){return this.punchcard({vertical:1,labels:1,stroke:0,fillActive:1,active:"white",...t})};function dt(t){const{drawTime:e,...a}=t;ee({...ve(e),...a})}function Ve(t,e,a,n){const i=(t-90)*Math.PI/180;return[a+Math.cos(i)*e,n+Math.sin(i)*e]}const ue=(t,e,a,n,i=0)=>Ve((t+i)*360,e*t,a,n);function pe(t){let{ctx:e,from:a=0,to:n=3,margin:i=50,cx:r=100,cy:l=100,rotate:c=0,thickness:o=i/2,color:f=N().foreground,cap:p="round",stretch:h=1,fromOpacity:m=1,toOpacity:u=1}=t;a*=h,n*=h,c*=h,e.lineWidth=o,e.lineCap=p,e.strokeStyle=f,e.globalAlpha=m,e.beginPath();let[k,y]=ue(a,i,r,l,c);e.moveTo(k,y);const b=1/60;let d=a;for(;d<=n;){const[q,w]=ue(d,i,r,l,c);e.globalAlpha=(d-a)/(n-a)*u,e.lineTo(q,w),d+=b}e.stroke()}function Be(t){let{stretch:e=1,size:a=80,thickness:n=a/2,cap:i="butt",inset:r=3,playheadColor:l="#ffffff",playheadLength:c=.02,playheadThickness:o=n,padding:f=0,steady:p=1,activeColor:h=N().foreground,inactiveColor:m=N().gutterForeground,colorizeInactive:u=0,fade:k=!0,ctx:y,time:b,haps:d,drawTime:q,id:w}=t;w&&(d=d.filter(P=>P.hasTag(w)));const[v,x]=[y.canvas.width,y.canvas.height];y.clearRect(0,0,v*2,x*2);const[F,S]=[v/2,x/2],A={margin:a/e,cx:F,cy:S,stretch:e,cap:i,thickness:n},R={...A,thickness:o,from:r-c,to:r,color:l},[s]=q,E=p*b;d.forEach(P=>{var O;const W=P.whole.begin<=b&&P.endClipped>b,D=P.whole.begin-b+r,Y=P.endClipped-b+r-f,$=((O=P.value)==null?void 0:O.color)||h,C=u||W?$:m,z=k?1-Math.abs((P.whole.begin-b)/s):1;pe({ctx:y,...A,from:D,to:Y,rotate:E,color:C,fromOpacity:z,toOpacity:z})}),pe({ctx:y,...R,rotate:E})}H.prototype.spiral=function(t={}){return this.onPaint((e,a,n,i)=>Be({ctx:e,time:a,haps:n,drawTime:i,...t}))};const _e=Oe(36),ge=(t,e,a,n)=>{n=n*Math.PI*2;const i=Math.sin(n)*a+t,r=Math.cos(n)*a+e;return[i,r]},me=(t,e)=>.5-Math.log2(t/e)%1;function Ke({haps:t,ctx:e,id:a,hapcircles:n=1,circle:i=0,edo:r=12,root:l=_e,thickness:c=3,hapRadius:o=6,mode:f="flake",margin:p=10}={}){const h=f==="polygon",m=f==="flake",u=e.canvas.width,k=e.canvas.height;e.clearRect(0,0,u,k);const y=N().foreground,b=Math.min(u,k)/2-c/2-o-p,d=u/2,q=k/2;a&&(t=t.filter(v=>v.hasTag(a))),e.strokeStyle=y,e.fillStyle=y,e.globalAlpha=1,e.lineWidth=c,i&&(e.beginPath(),e.arc(d,q,b,0,2*Math.PI),e.stroke()),r&&(Array.from({length:r},(v,x)=>{const F=me(l*Math.pow(2,x/r),l),[S,A]=ge(d,q,b,F);e.beginPath(),e.arc(S,A,o,0,2*Math.PI),e.fill()}),e.stroke());let w=[];e.lineWidth=o,t.forEach(v=>{let x;try{x=ze(v)}catch{return}const F=me(x,l),[S,A]=ge(d,q,b,F),R=v.value.color||y;e.strokeStyle=R,e.fillStyle=R;const{velocity:s=1,gain:E=1}=v.value||{},P=s*E;e.globalAlpha=P,w.push([S,A,F,R,P]),e.beginPath(),n&&(e.moveTo(S+o,A),e.arc(S,A,o,0,2*Math.PI),e.fill()),m&&(e.moveTo(d,q),e.lineTo(S,A)),e.stroke()}),e.strokeStyle=y,e.globalAlpha=1,h&&w.length&&(w=w.sort((v,x)=>v[2]-x[2]),e.beginPath(),e.moveTo(w[0][0],w[0][1]),w.forEach(([v,x,F,S,A])=>{e.strokeStyle=S,e.globalAlpha=A,e.lineTo(v,x)}),e.lineTo(w[0][0],w[0][1]),e.stroke())}H.prototype.pitchwheel=function(t={}){let{ctx:e=G(),id:a=1}=t;return this.tag(a).onPaint((n,i,r)=>Ke({...t,ctx:e,haps:r.filter(l=>l.isActive(i)),id:a}))};export{Xe as Drawer,Le as Framer,ee as __pianoroll,at as angle,Ue as cleanupDraw,fe as colorMap,ct as convertColorToNumber,de as convertHexToNumber,dt as drawPianoroll,it as fill,Ze as getComputedPropertyValue,G as getDrawContext,ve as getDrawOptions,Ye as getPunchcardPainter,N as getTheme,tt as h,lt as moveXY,ft as pianoroll,Ke as pitchwheel,rt as r,ot as rescale,Ge as setTheme,nt as smear,et as w,we as x,Je as y,st as zoomIn};
